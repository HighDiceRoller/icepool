<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.6.0"/>
    <title>icepool API documentation</title>
            <link rel="icon" href="favicon.png"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="icepool/function.html">function</a></li>
                    <li><a href="icepool/typing.html">typing</a></li>
                    <li><a href="icepool/evaluator.html">evaluator</a></li>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#d">d</a>
            </li>
            <li>
                    <a class="function" href="#z">z</a>
            </li>
            <li>
                    <a class="function" href="#coin">coin</a>
            </li>
            <li>
                    <a class="function" href="#stochastic_round">stochastic_round</a>
            </li>
            <li>
                    <a class="function" href="#one_hot">one_hot</a>
            </li>
            <li>
                    <a class="class" href="#Outcome">Outcome</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#Die">Die</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Die.__init__">Die</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.unary_operator">unary_operator</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.binary_operator">binary_operator</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.keys">keys</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.values">values</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.items">items</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.simplify">simplify</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.reroll">reroll</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.filter">filter</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.split">split</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.truncate">truncate</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.clip">clip</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.set_range">set_range</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.set_outcomes">set_outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.trim">trim</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.map">map</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.map_and_time">map_and_time</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.mean_time_to_sum">mean_time_to_sum</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.explode">explode</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.if_else">if_else</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.is_in">is_in</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.count">count</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.pool">pool</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.keep">keep</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.lowest">lowest</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.highest">highest</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.middle">middle</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.map_to_pool">map_to_pool</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.explode_to_pool">explode_to_pool</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.reroll_to_pool">reroll_to_pool</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.abs">abs</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.round">round</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.stochastic_round">stochastic_round</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.trunc">trunc</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.floor">floor</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.ceil">ceil</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.zero">zero</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.zero_outcome">zero_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.cmp">cmp</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.sign">sign</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.equals">equals</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Population">Population</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Population.keys">keys</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.values">values</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.items">items</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.common_outcome_length">common_outcome_length</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.is_empty">is_empty</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.min_outcome">min_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.max_outcome">max_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.nearest">nearest</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantity">quantity</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantities">quantities</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.denominator">denominator</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.scale_quantities">scale_quantities</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.has_zero_quantities">has_zero_quantities</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probability">probability</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probabilities">probabilities</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.mode">mode</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.modal_quantity">modal_quantity</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.kolmogorov_smirnov">kolmogorov_smirnov</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.cramer_von_mises">cramer_von_mises</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.median">median</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.median_low">median_low</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.median_high">median_high</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantile">quantile</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantile_low">quantile_low</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantile_high">quantile_high</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.mean">mean</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.variance">variance</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.standard_deviation">standard_deviation</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.sd">sd</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.standardized_moment">standardized_moment</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.skewness">skewness</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.excess_kurtosis">excess_kurtosis</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.entropy">entropy</a>
                        </li>
                        <li>
                                <a class="variable" href="#Population.marginals">marginals</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.covariance">covariance</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.correlation">correlation</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.to_one_hot">to_one_hot</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.sample">sample</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.format">format</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#tupleize">tupleize</a>
            </li>
            <li>
                    <a class="function" href="#vectorize">vectorize</a>
            </li>
            <li>
                    <a class="class" href="#Vector">Vector</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Vector.unary_operator">unary_operator</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.abs">abs</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.round">round</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.trunc">trunc</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.floor">floor</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.ceil">ceil</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.binary_operator">binary_operator</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.reverse_binary_operator">reverse_binary_operator</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.append">append</a>
                        </li>
                        <li>
                                <a class="function" href="#Vector.concatenate">concatenate</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Symbols">Symbols</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Symbols.__init__">Symbols</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.additive_union">additive_union</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.difference">difference</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.intersection">intersection</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.union">union</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.symmetric_difference">symmetric_difference</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.multiply_counts">multiply_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.divide_counts">divide_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.count_subset">count_subset</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.modulo_counts">modulo_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.issubset">issubset</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.issuperset">issuperset</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.isdisjoint">isdisjoint</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.has_negative_counts">has_negative_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Symbols.count">count</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#Again">Again</a>
            </li>
            <li>
                    <a class="class" href="#CountsKeysView">CountsKeysView</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CountsKeysView.__init__">CountsKeysView</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CountsValuesView">CountsValuesView</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CountsValuesView.__init__">CountsValuesView</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CountsItemsView">CountsItemsView</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CountsItemsView.__init__">CountsItemsView</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#from_cumulative">from_cumulative</a>
            </li>
            <li>
                    <a class="function" href="#from_rv">from_rv</a>
            </li>
            <li>
                    <a class="function" href="#lowest">lowest</a>
            </li>
            <li>
                    <a class="function" href="#highest">highest</a>
            </li>
            <li>
                    <a class="function" href="#middle">middle</a>
            </li>
            <li>
                    <a class="function" href="#min_outcome">min_outcome</a>
            </li>
            <li>
                    <a class="function" href="#max_outcome">max_outcome</a>
            </li>
            <li>
                    <a class="function" href="#align">align</a>
            </li>
            <li>
                    <a class="function" href="#align_range">align_range</a>
            </li>
            <li>
                    <a class="function" href="#commonize_denominator">commonize_denominator</a>
            </li>
            <li>
                    <a class="function" href="#reduce">reduce</a>
            </li>
            <li>
                    <a class="function" href="#accumulate">accumulate</a>
            </li>
            <li>
                    <a class="function" href="#map">map</a>
            </li>
            <li>
                    <a class="function" href="#map_function">map_function</a>
            </li>
            <li>
                    <a class="function" href="#map_and_time">map_and_time</a>
            </li>
            <li>
                    <a class="function" href="#map_to_pool">map_to_pool</a>
            </li>
            <li>
                    <a class="variable" href="#Reroll">Reroll</a>
            </li>
            <li>
                    <a class="class" href="#RerollType">RerollType</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#RerollType.Reroll">Reroll</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Pool">Pool</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Pool.__init__">Pool</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.clear_cache">clear_cache</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.raw_size">raw_size</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.denominator">denominator</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.unique_dice">unique_dice</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.output_arity">output_arity</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.min_outcome">min_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.max_outcome">max_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.additive_union">additive_union</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#standard_pool">standard_pool</a>
            </li>
            <li>
                    <a class="class" href="#MultisetGenerator">MultisetGenerator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MultisetGenerator.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetGenerator.output_arity">output_arity</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetGenerator.denominator">denominator</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetGenerator.equals">equals</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetGenerator.order">order</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetGenerator.min_outcome">min_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetGenerator.max_outcome">max_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetGenerator.sample">sample</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Alignment">Alignment</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Alignment.__init__">Alignment</a>
                        </li>
                        <li>
                                <a class="function" href="#Alignment.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Alignment.output_arity">output_arity</a>
                        </li>
                        <li>
                                <a class="function" href="#Alignment.denominator">denominator</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MultisetExpression">MultisetExpression</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MultisetExpression.order">order</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.additive_union">additive_union</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.difference">difference</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.intersection">intersection</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.union">union</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.symmetric_difference">symmetric_difference</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.keep_outcomes">keep_outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.drop_outcomes">drop_outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.map_counts">map_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.multiply_counts">multiply_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.divide_counts">divide_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.modulo_counts">modulo_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.keep_counts">keep_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.unique">unique</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.keep">keep</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.lowest">lowest</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.highest">highest</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.pair_le">pair_le</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.evaluate">evaluate</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.expand">expand</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.sum">sum</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.count">count</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.any">any</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.highest_outcome_and_count">highest_outcome_and_count</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.all_counts">all_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.largest_count">largest_count</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.largest_count_and_outcome">largest_count_and_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.count_subset">count_subset</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.largest_straight">largest_straight</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.largest_straight_and_outcome">largest_straight_and_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.all_straights">all_straights</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.all_straights_reduce_counts">all_straights_reduce_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.argsort">argsort</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.issubset">issubset</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.issuperset">issuperset</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.isdisjoint">isdisjoint</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.compair_lt">compair_lt</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.compair_le">compair_le</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.compair_gt">compair_gt</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.compair_ge">compair_ge</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.compair_eq">compair_eq</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetExpression.compair_ne">compair_ne</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MultisetEvaluator">MultisetEvaluator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MultisetEvaluator.next_state">next_state</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.final_outcome">final_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.order">order</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.alignment">alignment</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.range_alignment">range_alignment</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.prefix_generators">prefix_generators</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.validate_arity">validate_arity</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.evaluate">evaluate</a>
                        </li>
                        <li>
                                <a class="function" href="#MultisetEvaluator.sample">sample</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Order">Order</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Order.Ascending">Ascending</a>
                        </li>
                        <li>
                                <a class="variable" href="#Order.Descending">Descending</a>
                        </li>
                        <li>
                                <a class="variable" href="#Order.Any">Any</a>
                        </li>
                        <li>
                                <a class="function" href="#Order.merge">merge</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Deck">Deck</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Deck.__init__">Deck</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.keys">keys</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.values">values</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.items">items</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.size">size</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.deal">deal</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.additive_union">additive_union</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.difference">difference</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.intersection">intersection</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.union">union</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.symmetric_difference">symmetric_difference</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.multiply_counts">multiply_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.divide_counts">divide_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.modulo_counts">modulo_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.map">map</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Deal">Deal</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Deal.__init__">Deal</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.deck">deck</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.hand_sizes">hand_sizes</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.total_cards_dealt">total_cards_dealt</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.output_arity">output_arity</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.denominator">denominator</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MultiDeal">MultiDeal</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MultiDeal.__init__">MultiDeal</a>
                        </li>
                        <li>
                                <a class="function" href="#MultiDeal.deck">deck</a>
                        </li>
                        <li>
                                <a class="function" href="#MultiDeal.hand_sizes">hand_sizes</a>
                        </li>
                        <li>
                                <a class="function" href="#MultiDeal.total_cards_dealt">total_cards_dealt</a>
                        </li>
                        <li>
                                <a class="function" href="#MultiDeal.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#MultiDeal.output_arity">output_arity</a>
                        </li>
                        <li>
                                <a class="function" href="#MultiDeal.denominator">denominator</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#multiset_function">multiset_function</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
icepool    </h1>

                        <div class="docstring"><p>Package for computing dice and card probabilities.</p>

<p>Starting with <code>v0.25.1</code>, you can replace <code>latest</code> in the URL with an old version
number to get the documentation for that version.</p>

<p>See <a href="https://highdiceroller.github.io/icepool/notebooks/lab/index.html">this JupyterLite distribution</a>
for examples.</p>

<p><a href="https://github.com/HighDiceRoller/icepool">Visit the project page.</a></p>

<p>General conventions:</p>

<ul>
<li>Instances are immutable (apart from internal caching). Anything that looks
like it mutates an instance actually returns a separate instance with the
change.</li>
<li>Unless explictly specified otherwise, elements with zero quantity, rolls, etc.
are considered.</li>
</ul>
</div>

                        <input id="mod-icepool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-icepool-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Package for computing dice and card probabilities.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="sd">Starting with `v0.25.1`, you can replace `latest` in the URL with an old version</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">number to get the documentation for that version.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="sd">See [this JupyterLite distribution](https://highdiceroller.github.io/icepool/notebooks/lab/index.html)</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">for examples.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="sd">[Visit the project page.](https://github.com/HighDiceRoller/icepool)</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">General conventions:</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">* Instances are immutable (apart from internal caching). Anything that looks</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">    like it mutates an instance actually returns a separate instance with the</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="sd">    change.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">* Unless explictly specified otherwise, elements with zero quantity, rolls, etc.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">    are considered.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;google&#39;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;1.5.0a4&#39;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Final</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span> <span class="nn">icepool.typing</span> <span class="kn">import</span> <span class="n">Outcome</span><span class="p">,</span> <span class="n">Order</span><span class="p">,</span> <span class="n">RerollType</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="n">Reroll</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="n">RerollType</span><span class="o">.</span><span class="n">Reroll</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">&quot;&quot;&quot;Indicates that an outcome should be rerolled (with unlimited depth).</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">This can be used in place of outcomes in many places. See individual function</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">and method descriptions for details.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">This effectively removes the outcome from the probability space, along with its</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">contribution to the denominator.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">This can be used for conditional probability by removing all outcomes not</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">consistent with the given observations.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">Operation in specific cases:</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="sd">* When used with `Again`, only that stage is rerolled, not the entire `Again`</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="sd">    tree.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="sd">* To reroll with limited depth, use `Die.reroll()`, or `Again` with no</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="sd">    modification.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">* When used with `MultisetEvaluator`, the entire evaluation is rerolled.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="c1"># Expose certain names at top-level.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="kn">from</span> <span class="nn">icepool.function</span> <span class="kn">import</span> <span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="fm">__getattr__</span><span class="p">,</span> <span class="n">coin</span><span class="p">,</span> <span class="n">stochastic_round</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>                              <span class="n">one_hot</span><span class="p">,</span> <span class="n">iter_cartesian_product</span><span class="p">,</span> <span class="n">from_cumulative</span><span class="p">,</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>                              <span class="n">from_rv</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>                              <span class="n">align_range</span><span class="p">,</span> <span class="n">commonize_denominator</span><span class="p">,</span> <span class="n">reduce</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>                              <span class="n">accumulate</span><span class="p">,</span> <span class="nb">map</span><span class="p">,</span> <span class="n">map_function</span><span class="p">,</span> <span class="n">map_and_time</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>                              <span class="n">map_to_pool</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="kn">from</span> <span class="nn">icepool.population.base</span> <span class="kn">import</span> <span class="n">Population</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="kn">from</span> <span class="nn">icepool.population.die</span> <span class="kn">import</span> <span class="n">implicit_convert_to_die</span><span class="p">,</span> <span class="n">Die</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="kn">from</span> <span class="nn">icepool.collection.vector</span> <span class="kn">import</span> <span class="n">cartesian_product</span><span class="p">,</span> <span class="n">tupleize</span><span class="p">,</span> <span class="n">vectorize</span><span class="p">,</span> <span class="n">Vector</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="kn">from</span> <span class="nn">icepool.collection.symbols</span> <span class="kn">import</span> <span class="n">Symbols</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="kn">from</span> <span class="nn">icepool.population.again</span> <span class="kn">import</span> <span class="n">AgainExpression</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="n">Again</span><span class="p">:</span> <span class="n">Final</span> <span class="o">=</span> <span class="n">AgainExpression</span><span class="p">(</span><span class="n">is_additive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">&quot;&quot;&quot;A symbol indicating that the die should be rolled again, usually with some operation applied.</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">This is designed to be used with the `Die()` constructor.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">`AgainExpression`s should not be fed to functions or methods other than</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">`Die()`, but it can be used with operators. Examples:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">* `Again + 6`: Roll again and add 6.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">* `Again + Again`: Roll again twice and sum.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">The `again_count`, `again_depth`, and `again_end` arguments to `Die()`</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">affect how these arguments are processed. At most one of `again_count` or</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">`again_depth` may be provided; if neither are provided, the behavior is as</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">`again_depth=1.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">For finer control over rolling processes, use e.g. `Die.map()` instead.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">#### Count mode</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">When `again_count` is provided, we start with one roll queued and execute one </span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">roll at a time. For every `Again` we roll, we queue another roll.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">If we run out of rolls, we sum the rolls to find the result. If the total number</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">of rolls (not including the initial roll) would exceed `again_count`, we reroll</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">the entire process, effectively conditioning the process on not rolling more</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">than `again_count` extra dice.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">This mode only allows &quot;additive&quot; expressions to be used with `Again`, which</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">means that only the following operators are allowed:</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">* Binary `+`</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">* `n @ AgainExpression`, where `n` is a non-negative `int` or `Population`.</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">Furthermore, the `+` operator is assumed to be associative and commutative.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">For example, `str` or `tuple` outcomes will not produce elements with a definite</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a><span class="sd">order.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">#### Depth mode</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">When `again_depth=0`, `again_end` is directly substituted</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">for each occurence of `Again`. For other values of `again_depth`, the result for</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">`again_depth-1` is substituted for each occurence of `Again`.</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a><span class="sd">If `again_end=icepool.Reroll`, then any `AgainExpression`s in the final depth</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="sd">are rerolled.</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a><span class="sd">#### Rerolls</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="sd">`Reroll` only rerolls that particular die, not the entire process. Any such</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="sd">rerolls do not count against the `again_count` or `again_depth` limit.</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a><span class="sd">If `again_end=icepool.Reroll`:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a><span class="sd">* Count mode: Any result that would cause the number of rolls to exceed</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="sd">    `again_count` is rerolled.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">* Depth mode: Any `AgainExpression`s in the final depth level are rerolled.</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="kn">from</span> <span class="nn">icepool.population.die_with_truth</span> <span class="kn">import</span> <span class="n">DieWithTruth</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="kn">from</span> <span class="nn">icepool.collection.counts</span> <span class="kn">import</span> <span class="n">CountsKeysView</span><span class="p">,</span> <span class="n">CountsValuesView</span><span class="p">,</span> <span class="n">CountsItemsView</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="kn">from</span> <span class="nn">icepool.population.keep</span> <span class="kn">import</span> <span class="n">lowest</span><span class="p">,</span> <span class="n">highest</span><span class="p">,</span> <span class="n">middle</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="kn">from</span> <span class="nn">icepool.generator.pool</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">standard_pool</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="kn">from</span> <span class="nn">icepool.generator.keep</span> <span class="kn">import</span> <span class="n">KeepGenerator</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="kn">from</span> <span class="nn">icepool.generator.compound_keep</span> <span class="kn">import</span> <span class="n">CompoundKeepGenerator</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="kn">from</span> <span class="nn">icepool.generator.mixture</span> <span class="kn">import</span> <span class="n">MixtureGenerator</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="kn">from</span> <span class="nn">icepool.generator.multiset_generator</span> <span class="kn">import</span> <span class="n">MultisetGenerator</span><span class="p">,</span> <span class="n">InitialMultisetGenerator</span><span class="p">,</span> <span class="n">NextMultisetGenerator</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="kn">from</span> <span class="nn">icepool.generator.alignment</span> <span class="kn">import</span> <span class="n">Alignment</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="kn">from</span> <span class="nn">icepool.evaluator.multiset_evaluator</span> <span class="kn">import</span> <span class="n">MultisetEvaluator</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="kn">from</span> <span class="nn">icepool.population.deck</span> <span class="kn">import</span> <span class="n">Deck</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="kn">from</span> <span class="nn">icepool.generator.deal</span> <span class="kn">import</span> <span class="n">Deal</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="kn">from</span> <span class="nn">icepool.generator.multi_deal</span> <span class="kn">import</span> <span class="n">MultiDeal</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="kn">from</span> <span class="nn">icepool.expression.multiset_expression</span> <span class="kn">import</span> <span class="n">MultisetExpression</span><span class="p">,</span> <span class="n">implicit_convert_to_expression</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="kn">from</span> <span class="nn">icepool.expression.multiset_function</span> <span class="kn">import</span> <span class="n">multiset_function</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="kn">import</span> <span class="nn">icepool.expression</span> <span class="k">as</span> <span class="nn">expression</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="kn">import</span> <span class="nn">icepool.generator</span> <span class="k">as</span> <span class="nn">generator</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="kn">import</span> <span class="nn">icepool.evaluator</span> <span class="k">as</span> <span class="nn">evaluator</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="kn">import</span> <span class="nn">icepool.typing</span> <span class="k">as</span> <span class="nn">typing</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>    <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;coin&#39;</span><span class="p">,</span> <span class="s1">&#39;stochastic_round&#39;</span><span class="p">,</span> <span class="s1">&#39;one_hot&#39;</span><span class="p">,</span> <span class="s1">&#39;Outcome&#39;</span><span class="p">,</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>    <span class="s1">&#39;Population&#39;</span><span class="p">,</span> <span class="s1">&#39;tupleize&#39;</span><span class="p">,</span> <span class="s1">&#39;vectorize&#39;</span><span class="p">,</span> <span class="s1">&#39;Vector&#39;</span><span class="p">,</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">,</span> <span class="s1">&#39;Again&#39;</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="s1">&#39;CountsKeysView&#39;</span><span class="p">,</span> <span class="s1">&#39;CountsValuesView&#39;</span><span class="p">,</span> <span class="s1">&#39;CountsItemsView&#39;</span><span class="p">,</span> <span class="s1">&#39;from_cumulative&#39;</span><span class="p">,</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="s1">&#39;from_rv&#39;</span><span class="p">,</span> <span class="s1">&#39;lowest&#39;</span><span class="p">,</span> <span class="s1">&#39;highest&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;min_outcome&#39;</span><span class="p">,</span> <span class="s1">&#39;max_outcome&#39;</span><span class="p">,</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="s1">&#39;align&#39;</span><span class="p">,</span> <span class="s1">&#39;align_range&#39;</span><span class="p">,</span> <span class="s1">&#39;commonize_denominator&#39;</span><span class="p">,</span> <span class="s1">&#39;reduce&#39;</span><span class="p">,</span> <span class="s1">&#39;accumulate&#39;</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="s1">&#39;map_function&#39;</span><span class="p">,</span> <span class="s1">&#39;map_and_time&#39;</span><span class="p">,</span> <span class="s1">&#39;map_to_pool&#39;</span><span class="p">,</span> <span class="s1">&#39;Reroll&#39;</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    <span class="s1">&#39;RerollType&#39;</span><span class="p">,</span> <span class="s1">&#39;Pool&#39;</span><span class="p">,</span> <span class="s1">&#39;standard_pool&#39;</span><span class="p">,</span> <span class="s1">&#39;MultisetGenerator&#39;</span><span class="p">,</span> <span class="s1">&#39;Alignment&#39;</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>    <span class="s1">&#39;MultisetExpression&#39;</span><span class="p">,</span> <span class="s1">&#39;MultisetEvaluator&#39;</span><span class="p">,</span> <span class="s1">&#39;Order&#39;</span><span class="p">,</span> <span class="s1">&#39;Deck&#39;</span><span class="p">,</span> <span class="s1">&#39;Deal&#39;</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="s1">&#39;MultiDeal&#39;</span><span class="p">,</span> <span class="s1">&#39;multiset_function&#39;</span><span class="p">,</span> <span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;typing&#39;</span><span class="p">,</span> <span class="s1">&#39;evaluator&#39;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="d">
                            <input id="d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@cache</div>

        <span class="def">def</span>
        <span class="name">d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="d-20"><a href="#d-20"><span class="linenos">20</span></a><span class="nd">@cache</span>
</span><span id="d-21"><a href="#d-21"><span class="linenos">21</span></a><span class="k">def</span> <span class="nf">d</span><span class="p">(</span><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int]&#39;</span><span class="p">:</span>
</span><span id="d-22"><a href="#d-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A standard die, uniformly distributed from `1` to `sides` inclusive.</span>
</span><span id="d-23"><a href="#d-23"><span class="linenos">23</span></a>
</span><span id="d-24"><a href="#d-24"><span class="linenos">24</span></a><span class="sd">    Don&#39;t confuse this with `icepool.Die()`:</span>
</span><span id="d-25"><a href="#d-25"><span class="linenos">25</span></a>
</span><span id="d-26"><a href="#d-26"><span class="linenos">26</span></a><span class="sd">    * `icepool.Die([6])`: A `Die` that always rolls the integer 6.</span>
</span><span id="d-27"><a href="#d-27"><span class="linenos">27</span></a><span class="sd">    * `icepool.d(6)`: A d6.</span>
</span><span id="d-28"><a href="#d-28"><span class="linenos">28</span></a>
</span><span id="d-29"><a href="#d-29"><span class="linenos">29</span></a><span class="sd">    You can also import individual standard dice from the `icepool` module, e.g.</span>
</span><span id="d-30"><a href="#d-30"><span class="linenos">30</span></a><span class="sd">    `from icepool import d6`.</span>
</span><span id="d-31"><a href="#d-31"><span class="linenos">31</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="d-32"><a href="#d-32"><span class="linenos">32</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sides</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="d-33"><a href="#d-33"><span class="linenos">33</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;sides must be an int.&#39;</span><span class="p">)</span>
</span><span id="d-34"><a href="#d-34"><span class="linenos">34</span></a>    <span class="k">elif</span> <span class="n">sides</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="d-35"><a href="#d-35"><span class="linenos">35</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;sides must be at least 1.&#39;</span><span class="p">)</span>
</span><span id="d-36"><a href="#d-36"><span class="linenos">36</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sides</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A standard die, uniformly distributed from <code>1</code> to <code>sides</code> inclusive.</p>

<p>Don't confuse this with <code><a href="#Die">Die()</a></code>:</p>

<ul>
<li><code><a href="#Die">Die</a>([6])</code>: A <code><a href="#Die">Die</a></code> that always rolls the integer 6.</li>
<li><code><a href="#d">d</a>(6)</code>: A d6.</li>
</ul>

<p>You can also import individual standard dice from the <code><a href="">icepool</a></code> module, e.g.
<code>from icepool import d6</code>.</p>
</div>


                </section>
                <section id="z">
                            <input id="z-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@cache</div>

        <span class="def">def</span>
        <span class="name">z</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="z-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#z"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="z-39"><a href="#z-39"><span class="linenos">39</span></a><span class="nd">@cache</span>
</span><span id="z-40"><a href="#z-40"><span class="linenos">40</span></a><span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int]&#39;</span><span class="p">:</span>
</span><span id="z-41"><a href="#z-41"><span class="linenos">41</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A die uniformly distributed from `0` to `sides - 1` inclusive.</span>
</span><span id="z-42"><a href="#z-42"><span class="linenos">42</span></a><span class="sd">    </span>
</span><span id="z-43"><a href="#z-43"><span class="linenos">43</span></a><span class="sd">    Equal to d(sides) - 1.</span>
</span><span id="z-44"><a href="#z-44"><span class="linenos">44</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="z-45"><a href="#z-45"><span class="linenos">45</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sides</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="z-46"><a href="#z-46"><span class="linenos">46</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;sides must be an int.&#39;</span><span class="p">)</span>
</span><span id="z-47"><a href="#z-47"><span class="linenos">47</span></a>    <span class="k">elif</span> <span class="n">sides</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="z-48"><a href="#z-48"><span class="linenos">48</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;sides must be at least 1.&#39;</span><span class="p">)</span>
</span><span id="z-49"><a href="#z-49"><span class="linenos">49</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sides</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A die uniformly distributed from <code>0</code> to <code>sides - 1</code> inclusive.</p>

<p>Equal to d(sides) - 1.</p>
</div>


                </section>
                <section id="coin">
                            <input id="coin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">coin</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span>,</span><span class="param">	<span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">max_denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="coin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#coin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="coin-75"><a href="#coin-75"><span class="linenos"> 75</span></a><span class="k">def</span> <span class="nf">coin</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Fraction</span><span class="p">,</span>
</span><span id="coin-76"><a href="#coin-76"><span class="linenos"> 76</span></a>         <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="coin-77"><a href="#coin-77"><span class="linenos"> 77</span></a>         <span class="o">/</span><span class="p">,</span>
</span><span id="coin-78"><a href="#coin-78"><span class="linenos"> 78</span></a>         <span class="o">*</span><span class="p">,</span>
</span><span id="coin-79"><a href="#coin-79"><span class="linenos"> 79</span></a>         <span class="n">max_denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool]&#39;</span><span class="p">:</span>
</span><span id="coin-80"><a href="#coin-80"><span class="linenos"> 80</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A `Die` that rolls `True` with probability `n / d`, and `False` otherwise.</span>
</span><span id="coin-81"><a href="#coin-81"><span class="linenos"> 81</span></a>
</span><span id="coin-82"><a href="#coin-82"><span class="linenos"> 82</span></a><span class="sd">    If `n &lt;= 0` or `n &gt;= d` the result will have only one outcome.</span>
</span><span id="coin-83"><a href="#coin-83"><span class="linenos"> 83</span></a>
</span><span id="coin-84"><a href="#coin-84"><span class="linenos"> 84</span></a><span class="sd">    Args:</span>
</span><span id="coin-85"><a href="#coin-85"><span class="linenos"> 85</span></a><span class="sd">        n: An int numerator, or a non-integer probability.</span>
</span><span id="coin-86"><a href="#coin-86"><span class="linenos"> 86</span></a><span class="sd">        d: An int denominator. Should not be provided if the first argument is</span>
</span><span id="coin-87"><a href="#coin-87"><span class="linenos"> 87</span></a><span class="sd">            not an int.</span>
</span><span id="coin-88"><a href="#coin-88"><span class="linenos"> 88</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="coin-89"><a href="#coin-89"><span class="linenos"> 89</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="coin-90"><a href="#coin-90"><span class="linenos"> 90</span></a>        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="coin-91"><a href="#coin-91"><span class="linenos"> 91</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="coin-92"><a href="#coin-92"><span class="linenos"> 92</span></a>                <span class="s1">&#39;If a non-int numerator is provided, a denominator must not be provided.&#39;</span>
</span><span id="coin-93"><a href="#coin-93"><span class="linenos"> 93</span></a>            <span class="p">)</span>
</span><span id="coin-94"><a href="#coin-94"><span class="linenos"> 94</span></a>        <span class="n">fraction</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="coin-95"><a href="#coin-95"><span class="linenos"> 95</span></a>        <span class="k">if</span> <span class="n">max_denominator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="coin-96"><a href="#coin-96"><span class="linenos"> 96</span></a>            <span class="n">fraction</span> <span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">max_denominator</span><span class="p">)</span>
</span><span id="coin-97"><a href="#coin-97"><span class="linenos"> 97</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">numerator</span>
</span><span id="coin-98"><a href="#coin-98"><span class="linenos"> 98</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">fraction</span><span class="o">.</span><span class="n">denominator</span>
</span><span id="coin-99"><a href="#coin-99"><span class="linenos"> 99</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="coin-100"><a href="#coin-100"><span class="linenos">100</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">:</span>
</span><span id="coin-101"><a href="#coin-101"><span class="linenos">101</span></a>        <span class="n">data</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</span><span id="coin-102"><a href="#coin-102"><span class="linenos">102</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="coin-103"><a href="#coin-103"><span class="linenos">103</span></a>        <span class="n">data</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
</span><span id="coin-104"><a href="#coin-104"><span class="linenos">104</span></a>
</span><span id="coin-105"><a href="#coin-105"><span class="linenos">105</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Die">Die</a></code> that rolls <code>True</code> with probability <code>n / d</code>, and <code>False</code> otherwise.</p>

<p>If <code>n &lt;= 0</code> or <code>n &gt;= d</code> the result will have only one outcome.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>n:</strong>  An int numerator, or a non-integer probability.</li>
<li><strong>d:</strong>  An int denominator. Should not be provided if the first argument is
not an int.</li>
</ul>
</div>


                </section>
                <section id="stochastic_round">
                            <input id="stochastic_round-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stochastic_round</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">x</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">max_denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="stochastic_round-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stochastic_round"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stochastic_round-108"><a href="#stochastic_round-108"><span class="linenos">108</span></a><span class="k">def</span> <span class="nf">stochastic_round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
</span><span id="stochastic_round-109"><a href="#stochastic_round-109"><span class="linenos">109</span></a>                     <span class="o">/</span><span class="p">,</span>
</span><span id="stochastic_round-110"><a href="#stochastic_round-110"><span class="linenos">110</span></a>                     <span class="o">*</span><span class="p">,</span>
</span><span id="stochastic_round-111"><a href="#stochastic_round-111"><span class="linenos">111</span></a>                     <span class="n">max_denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int]&#39;</span><span class="p">:</span>
</span><span id="stochastic_round-112"><a href="#stochastic_round-112"><span class="linenos">112</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Randomly rounds a value up or down to the nearest integer according to the two distances.</span>
</span><span id="stochastic_round-113"><a href="#stochastic_round-113"><span class="linenos">113</span></a><span class="sd">        </span>
</span><span id="stochastic_round-114"><a href="#stochastic_round-114"><span class="linenos">114</span></a><span class="sd">    Specificially, rounds `x` up with probability `x - floor(x)` and down</span>
</span><span id="stochastic_round-115"><a href="#stochastic_round-115"><span class="linenos">115</span></a><span class="sd">    otherwise, producing a `Die` with up to two outcomes.</span>
</span><span id="stochastic_round-116"><a href="#stochastic_round-116"><span class="linenos">116</span></a>
</span><span id="stochastic_round-117"><a href="#stochastic_round-117"><span class="linenos">117</span></a><span class="sd">    Args:</span>
</span><span id="stochastic_round-118"><a href="#stochastic_round-118"><span class="linenos">118</span></a><span class="sd">        max_denominator: If provided, each rounding will be performed</span>
</span><span id="stochastic_round-119"><a href="#stochastic_round-119"><span class="linenos">119</span></a><span class="sd">            using `fractions.Fraction.limit_denominator(max_denominator)`.</span>
</span><span id="stochastic_round-120"><a href="#stochastic_round-120"><span class="linenos">120</span></a><span class="sd">            Otherwise, the rounding will be performed without</span>
</span><span id="stochastic_round-121"><a href="#stochastic_round-121"><span class="linenos">121</span></a><span class="sd">            `limit_denominator`.</span>
</span><span id="stochastic_round-122"><a href="#stochastic_round-122"><span class="linenos">122</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="stochastic_round-123"><a href="#stochastic_round-123"><span class="linenos">123</span></a>    <span class="n">integer_part</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="stochastic_round-124"><a href="#stochastic_round-124"><span class="linenos">124</span></a>    <span class="n">fractional_part</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">integer_part</span>
</span><span id="stochastic_round-125"><a href="#stochastic_round-125"><span class="linenos">125</span></a>    <span class="k">return</span> <span class="n">integer_part</span> <span class="o">+</span> <span class="n">coin</span><span class="p">(</span><span class="n">fractional_part</span><span class="p">,</span>
</span><span id="stochastic_round-126"><a href="#stochastic_round-126"><span class="linenos">126</span></a>                               <span class="n">max_denominator</span><span class="o">=</span><span class="n">max_denominator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Randomly rounds a value up or down to the nearest integer according to the two distances.</p>

<p>Specificially, rounds <code>x</code> up with probability <code>x - floor(x)</code> and down
otherwise, producing a <code><a href="#Die">Die</a></code> with up to two outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>max_denominator:</strong>  If provided, each rounding will be performed
using <code>fractions.Fraction.limit_denominator(max_denominator)</code>.
Otherwise, the rounding will be performed without
<code>limit_denominator</code>.</li>
</ul>
</div>


                </section>
                <section id="one_hot">
                            <input id="one_hot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">one_hot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="one_hot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#one_hot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="one_hot-129"><a href="#one_hot-129"><span class="linenos">129</span></a><span class="k">def</span> <span class="nf">one_hot</span><span class="p">(</span><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[bool, ...]]&#39;</span><span class="p">:</span>
</span><span id="one_hot-130"><a href="#one_hot-130"><span class="linenos">130</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A `Die` with `Vector` outcomes with one element set to `True` uniformly at random and the rest `False`.</span>
</span><span id="one_hot-131"><a href="#one_hot-131"><span class="linenos">131</span></a>
</span><span id="one_hot-132"><a href="#one_hot-132"><span class="linenos">132</span></a><span class="sd">    This is an easy (if somewhat expensive) way of representing how many dice</span>
</span><span id="one_hot-133"><a href="#one_hot-133"><span class="linenos">133</span></a><span class="sd">    in a pool rolled each number. For example, the outcomes of `10 @ one_hot(6)`</span>
</span><span id="one_hot-134"><a href="#one_hot-134"><span class="linenos">134</span></a><span class="sd">    are the `(ones, twos, threes, fours, fives, sixes)` rolled in 10d6.</span>
</span><span id="one_hot-135"><a href="#one_hot-135"><span class="linenos">135</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="one_hot-136"><a href="#one_hot-136"><span class="linenos">136</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="one_hot-137"><a href="#one_hot-137"><span class="linenos">137</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sides</span><span class="p">):</span>
</span><span id="one_hot-138"><a href="#one_hot-138"><span class="linenos">138</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="n">sides</span>
</span><span id="one_hot-139"><a href="#one_hot-139"><span class="linenos">139</span></a>        <span class="n">outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="one_hot-140"><a href="#one_hot-140"><span class="linenos">140</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="one_hot-141"><a href="#one_hot-141"><span class="linenos">141</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Die">Die</a></code> with <code><a href="#Vector">Vector</a></code> outcomes with one element set to <code>True</code> uniformly at random and the rest <code>False</code>.</p>

<p>This is an easy (if somewhat expensive) way of representing how many dice
in a pool rolled each number. For example, the outcomes of <code>10 @ one_hot(6)</code>
are the <code>(ones, twos, threes, fours, fives, sixes)</code> rolled in 10d6.</p>
</div>


                </section>
                <section id="Outcome">
                            <input id="Outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Outcome</span><wbr>(<span class="base">typing.Hashable</span>, <span class="base">typing.Protocol[-T_contra]</span>):

                <label class="view-source-button" for="Outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Outcome-70"><a href="#Outcome-70"><span class="linenos">70</span></a><span class="k">class</span> <span class="nc">Outcome</span><span class="p">(</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">[</span><span class="n">T_contra</span><span class="p">]):</span>
</span><span id="Outcome-71"><a href="#Outcome-71"><span class="linenos">71</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol to attempt to verify that outcome types are hashable and sortable.</span>
</span><span id="Outcome-72"><a href="#Outcome-72"><span class="linenos">72</span></a>
</span><span id="Outcome-73"><a href="#Outcome-73"><span class="linenos">73</span></a><span class="sd">    Far from foolproof, e.g. it cannot enforce total ordering.</span>
</span><span id="Outcome-74"><a href="#Outcome-74"><span class="linenos">74</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Outcome-75"><a href="#Outcome-75"><span class="linenos">75</span></a>
</span><span id="Outcome-76"><a href="#Outcome-76"><span class="linenos">76</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Outcome-77"><a href="#Outcome-77"><span class="linenos">77</span></a>        <span class="o">...</span>
</span></pre></div>


            <div class="docstring"><p>Protocol to attempt to verify that outcome types are hashable and sortable.</p>

<p>Far from foolproof, e.g. it cannot enforce total ordering.</p>
</div>


                </section>
                <section id="Die">
                            <input id="Die-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Die</span><wbr>(<span class="base"><a href="#Population">icepool.Population[+T_co]</a></span>):

                <label class="view-source-button" for="Die-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die-44"><a href="#Die-44"><span class="linenos">  44</span></a><span class="k">class</span> <span class="nc">Die</span><span class="p">(</span><span class="n">Population</span><span class="p">[</span><span class="n">T_co</span><span class="p">]):</span>
</span><span id="Die-45"><a href="#Die-45"><span class="linenos">  45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sampling with replacement. Quantities represent weights.</span>
</span><span id="Die-46"><a href="#Die-46"><span class="linenos">  46</span></a>
</span><span id="Die-47"><a href="#Die-47"><span class="linenos">  47</span></a><span class="sd">    Dice are immutable. Methods do not modify the `Die` in-place;</span>
</span><span id="Die-48"><a href="#Die-48"><span class="linenos">  48</span></a><span class="sd">    rather they return a `Die` representing the result.</span>
</span><span id="Die-49"><a href="#Die-49"><span class="linenos">  49</span></a>
</span><span id="Die-50"><a href="#Die-50"><span class="linenos">  50</span></a><span class="sd">    It *is* (mostly) well-defined to have a `Die` with zero-quantity outcomes.</span>
</span><span id="Die-51"><a href="#Die-51"><span class="linenos">  51</span></a><span class="sd">    These can be useful in a few cases, such as:</span>
</span><span id="Die-52"><a href="#Die-52"><span class="linenos">  52</span></a>
</span><span id="Die-53"><a href="#Die-53"><span class="linenos">  53</span></a><span class="sd">    * `MultisetEvaluator` will iterate through zero-quantity outcomes,</span>
</span><span id="Die-54"><a href="#Die-54"><span class="linenos">  54</span></a><span class="sd">        rather than possibly skipping that outcome. (Though in most cases it&#39;s</span>
</span><span id="Die-55"><a href="#Die-55"><span class="linenos">  55</span></a><span class="sd">        better to use `MultisetEvaluator.alignment()`.)</span>
</span><span id="Die-56"><a href="#Die-56"><span class="linenos">  56</span></a><span class="sd">    * `icepool.align()` and the like are convenient for making dice share the</span>
</span><span id="Die-57"><a href="#Die-57"><span class="linenos">  57</span></a><span class="sd">        same set of outcomes.</span>
</span><span id="Die-58"><a href="#Die-58"><span class="linenos">  58</span></a>
</span><span id="Die-59"><a href="#Die-59"><span class="linenos">  59</span></a><span class="sd">    However, zero-quantity outcomes have a computational cost like any other</span>
</span><span id="Die-60"><a href="#Die-60"><span class="linenos">  60</span></a><span class="sd">    outcome. Unless you have a specific use case in mind, it&#39;s best to leave</span>
</span><span id="Die-61"><a href="#Die-61"><span class="linenos">  61</span></a><span class="sd">    them out.</span>
</span><span id="Die-62"><a href="#Die-62"><span class="linenos">  62</span></a>
</span><span id="Die-63"><a href="#Die-63"><span class="linenos">  63</span></a><span class="sd">    Most operators and methods will not introduce zero-quantity outcomes if</span>
</span><span id="Die-64"><a href="#Die-64"><span class="linenos">  64</span></a><span class="sd">    their arguments do not have any; nor remove zero-quantity outcomes.</span>
</span><span id="Die-65"><a href="#Die-65"><span class="linenos">  65</span></a>
</span><span id="Die-66"><a href="#Die-66"><span class="linenos">  66</span></a><span class="sd">    It&#39;s also possible to have &quot;empty&quot; dice with no outcomes at all,</span>
</span><span id="Die-67"><a href="#Die-67"><span class="linenos">  67</span></a><span class="sd">    though these have little use other than being sentinel values.</span>
</span><span id="Die-68"><a href="#Die-68"><span class="linenos">  68</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Die-69"><a href="#Die-69"><span class="linenos">  69</span></a>
</span><span id="Die-70"><a href="#Die-70"><span class="linenos">  70</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span>
</span><span id="Die-71"><a href="#Die-71"><span class="linenos">  71</span></a>
</span><span id="Die-72"><a href="#Die-72"><span class="linenos">  72</span></a>    <span class="nd">@property</span>
</span><span id="Die-73"><a href="#Die-73"><span class="linenos">  73</span></a>    <span class="k">def</span> <span class="nf">_new_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="Die-74"><a href="#Die-74"><span class="linenos">  74</span></a>        <span class="k">return</span> <span class="n">Die</span>
</span><span id="Die-75"><a href="#Die-75"><span class="linenos">  75</span></a>
</span><span id="Die-76"><a href="#Die-76"><span class="linenos">  76</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Die-77"><a href="#Die-77"><span class="linenos">  77</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="Die-78"><a href="#Die-78"><span class="linenos">  78</span></a>        <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Die-79"><a href="#Die-79"><span class="linenos">  79</span></a>        <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-80"><a href="#Die-80"><span class="linenos">  80</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="Die-81"><a href="#Die-81"><span class="linenos">  81</span></a>        <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-82"><a href="#Die-82"><span class="linenos">  82</span></a>        <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-83"><a href="#Die-83"><span class="linenos">  83</span></a>        <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;Outcome | Die | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-84"><a href="#Die-84"><span class="linenos">  84</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-85"><a href="#Die-85"><span class="linenos">  85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for a `Die`.</span>
</span><span id="Die-86"><a href="#Die-86"><span class="linenos">  86</span></a>
</span><span id="Die-87"><a href="#Die-87"><span class="linenos">  87</span></a><span class="sd">        Don&#39;t confuse this with `d()`:</span>
</span><span id="Die-88"><a href="#Die-88"><span class="linenos">  88</span></a>
</span><span id="Die-89"><a href="#Die-89"><span class="linenos">  89</span></a><span class="sd">        * `Die([6])`: A `Die` that always rolls the `int` 6.</span>
</span><span id="Die-90"><a href="#Die-90"><span class="linenos">  90</span></a><span class="sd">        * `d(6)`: A d6.</span>
</span><span id="Die-91"><a href="#Die-91"><span class="linenos">  91</span></a>
</span><span id="Die-92"><a href="#Die-92"><span class="linenos">  92</span></a><span class="sd">        Also, don&#39;t confuse this with `Pool()`:</span>
</span><span id="Die-93"><a href="#Die-93"><span class="linenos">  93</span></a>
</span><span id="Die-94"><a href="#Die-94"><span class="linenos">  94</span></a><span class="sd">        * `Die([1, 2, 3, 4, 5, 6])`: A d6.</span>
</span><span id="Die-95"><a href="#Die-95"><span class="linenos">  95</span></a><span class="sd">        * `Pool([1, 2, 3, 4, 5, 6])`: A `Pool` of six dice that always rolls one</span>
</span><span id="Die-96"><a href="#Die-96"><span class="linenos">  96</span></a><span class="sd">            of each number.</span>
</span><span id="Die-97"><a href="#Die-97"><span class="linenos">  97</span></a>
</span><span id="Die-98"><a href="#Die-98"><span class="linenos">  98</span></a><span class="sd">        Here are some different ways of constructing a d6:</span>
</span><span id="Die-99"><a href="#Die-99"><span class="linenos">  99</span></a>
</span><span id="Die-100"><a href="#Die-100"><span class="linenos"> 100</span></a><span class="sd">        * Just import it: `from icepool import d6`</span>
</span><span id="Die-101"><a href="#Die-101"><span class="linenos"> 101</span></a><span class="sd">        * Use the `d()` function: `icepool.d(6)`</span>
</span><span id="Die-102"><a href="#Die-102"><span class="linenos"> 102</span></a><span class="sd">        * Use a d6 that you already have: `Die(d6)` or `Die([d6])`</span>
</span><span id="Die-103"><a href="#Die-103"><span class="linenos"> 103</span></a><span class="sd">        * Mix a d3 and a d3+3: `Die([d3, d3+3])`</span>
</span><span id="Die-104"><a href="#Die-104"><span class="linenos"> 104</span></a><span class="sd">        * Use a dict: `Die({1:1, 2:1, 3:1, 4:1, 5:1, 6:1})`</span>
</span><span id="Die-105"><a href="#Die-105"><span class="linenos"> 105</span></a><span class="sd">        * Give the faces as a sequence: `Die([1, 2, 3, 4, 5, 6])`</span>
</span><span id="Die-106"><a href="#Die-106"><span class="linenos"> 106</span></a>
</span><span id="Die-107"><a href="#Die-107"><span class="linenos"> 107</span></a><span class="sd">        All quantities must be non-negative, though they can be zero.</span>
</span><span id="Die-108"><a href="#Die-108"><span class="linenos"> 108</span></a>
</span><span id="Die-109"><a href="#Die-109"><span class="linenos"> 109</span></a><span class="sd">        Several methods and functions foward **kwargs to this constructor.</span>
</span><span id="Die-110"><a href="#Die-110"><span class="linenos"> 110</span></a><span class="sd">        However, these only affect the construction of the returned or yielded</span>
</span><span id="Die-111"><a href="#Die-111"><span class="linenos"> 111</span></a><span class="sd">        dice. Any other implicit conversions of arguments or operands to dice</span>
</span><span id="Die-112"><a href="#Die-112"><span class="linenos"> 112</span></a><span class="sd">        will be done with the default keyword arguments.</span>
</span><span id="Die-113"><a href="#Die-113"><span class="linenos"> 113</span></a>
</span><span id="Die-114"><a href="#Die-114"><span class="linenos"> 114</span></a><span class="sd">        EXPERIMENTAL: Use `icepool.Again` to roll the dice again, usually with</span>
</span><span id="Die-115"><a href="#Die-115"><span class="linenos"> 115</span></a><span class="sd">        some modification. See the `Again` documentation for details.</span>
</span><span id="Die-116"><a href="#Die-116"><span class="linenos"> 116</span></a>
</span><span id="Die-117"><a href="#Die-117"><span class="linenos"> 117</span></a><span class="sd">        Denominator: For a flat set of outcomes, the denominator is just the</span>
</span><span id="Die-118"><a href="#Die-118"><span class="linenos"> 118</span></a><span class="sd">        sum of the corresponding quantities. If the outcomes themselves have</span>
</span><span id="Die-119"><a href="#Die-119"><span class="linenos"> 119</span></a><span class="sd">        secondary denominators, then the overall denominator will be minimized</span>
</span><span id="Die-120"><a href="#Die-120"><span class="linenos"> 120</span></a><span class="sd">        while preserving the relative weighting of the primary outcomes.</span>
</span><span id="Die-121"><a href="#Die-121"><span class="linenos"> 121</span></a>
</span><span id="Die-122"><a href="#Die-122"><span class="linenos"> 122</span></a><span class="sd">        Args:</span>
</span><span id="Die-123"><a href="#Die-123"><span class="linenos"> 123</span></a><span class="sd">            outcomes: The faces of the `Die`. This can be one of the following:</span>
</span><span id="Die-124"><a href="#Die-124"><span class="linenos"> 124</span></a><span class="sd">                * A `Sequence` of outcomes. Duplicates will contribute</span>
</span><span id="Die-125"><a href="#Die-125"><span class="linenos"> 125</span></a><span class="sd">                    quantity for each appearance.</span>
</span><span id="Die-126"><a href="#Die-126"><span class="linenos"> 126</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Die-127"><a href="#Die-127"><span class="linenos"> 127</span></a>
</span><span id="Die-128"><a href="#Die-128"><span class="linenos"> 128</span></a><span class="sd">                Individual outcomes can each be one of the following:</span>
</span><span id="Die-129"><a href="#Die-129"><span class="linenos"> 129</span></a>
</span><span id="Die-130"><a href="#Die-130"><span class="linenos"> 130</span></a><span class="sd">                * An outcome, which must be hashable and totally orderable.</span>
</span><span id="Die-131"><a href="#Die-131"><span class="linenos"> 131</span></a><span class="sd">                    * For convenience, `tuple`s containing `Population`s will be</span>
</span><span id="Die-132"><a href="#Die-132"><span class="linenos"> 132</span></a><span class="sd">                        `tupleize`d into a `Population` of `tuple`s.</span>
</span><span id="Die-133"><a href="#Die-133"><span class="linenos"> 133</span></a><span class="sd">                        This does not apply to subclasses of `tuple`s such as `namedtuple`</span>
</span><span id="Die-134"><a href="#Die-134"><span class="linenos"> 134</span></a><span class="sd">                        or other classes such as `Vector`.</span>
</span><span id="Die-135"><a href="#Die-135"><span class="linenos"> 135</span></a><span class="sd">                * A `Die`, which will be flattened into the result.</span>
</span><span id="Die-136"><a href="#Die-136"><span class="linenos"> 136</span></a><span class="sd">                    The quantity assigned to a `Die` is shared among its</span>
</span><span id="Die-137"><a href="#Die-137"><span class="linenos"> 137</span></a><span class="sd">                    outcomes. The total denominator will be scaled up if</span>
</span><span id="Die-138"><a href="#Die-138"><span class="linenos"> 138</span></a><span class="sd">                    necessary.</span>
</span><span id="Die-139"><a href="#Die-139"><span class="linenos"> 139</span></a><span class="sd">                * `icepool.Reroll`, which will drop itself from consideration.</span>
</span><span id="Die-140"><a href="#Die-140"><span class="linenos"> 140</span></a><span class="sd">                * EXPERIMENTAL: `icepool.Again`. See the documentation for</span>
</span><span id="Die-141"><a href="#Die-141"><span class="linenos"> 141</span></a><span class="sd">                    `Again` for details.</span>
</span><span id="Die-142"><a href="#Die-142"><span class="linenos"> 142</span></a><span class="sd">            times: Multiplies the quantity of each element of `outcomes`.</span>
</span><span id="Die-143"><a href="#Die-143"><span class="linenos"> 143</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Die-144"><a href="#Die-144"><span class="linenos"> 144</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Die-145"><a href="#Die-145"><span class="linenos"> 145</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Die-146"><a href="#Die-146"><span class="linenos"> 146</span></a><span class="sd">            again_count, again_depth, again_end: These affect how `Again`</span>
</span><span id="Die-147"><a href="#Die-147"><span class="linenos"> 147</span></a><span class="sd">                expressions are handled. See the `Again` documentation for</span>
</span><span id="Die-148"><a href="#Die-148"><span class="linenos"> 148</span></a><span class="sd">                details.</span>
</span><span id="Die-149"><a href="#Die-149"><span class="linenos"> 149</span></a><span class="sd">        Raises:</span>
</span><span id="Die-150"><a href="#Die-150"><span class="linenos"> 150</span></a><span class="sd">            ValueError: `None` is not a valid outcome for a `Die`.</span>
</span><span id="Die-151"><a href="#Die-151"><span class="linenos"> 151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-152"><a href="#Die-152"><span class="linenos"> 152</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die-153"><a href="#Die-153"><span class="linenos"> 153</span></a>
</span><span id="Die-154"><a href="#Die-154"><span class="linenos"> 154</span></a>        <span class="c1"># Check for Again.</span>
</span><span id="Die-155"><a href="#Die-155"><span class="linenos"> 155</span></a>        <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-156"><a href="#Die-156"><span class="linenos"> 156</span></a>            <span class="k">if</span> <span class="n">again_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-157"><a href="#Die-157"><span class="linenos"> 157</span></a>                <span class="k">if</span> <span class="n">again_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-158"><a href="#Die-158"><span class="linenos"> 158</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-159"><a href="#Die-159"><span class="linenos"> 159</span></a>                        <span class="s1">&#39;At most one of again_count and again_depth may be used.&#39;</span>
</span><span id="Die-160"><a href="#Die-160"><span class="linenos"> 160</span></a>                    <span class="p">)</span>
</span><span id="Die-161"><a href="#Die-161"><span class="linenos"> 161</span></a>                <span class="k">if</span> <span class="n">again_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-162"><a href="#Die-162"><span class="linenos"> 162</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-163"><a href="#Die-163"><span class="linenos"> 163</span></a>                        <span class="s1">&#39;again_end cannot be used with again_count.&#39;</span><span class="p">)</span>
</span><span id="Die-164"><a href="#Die-164"><span class="linenos"> 164</span></a>                <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">evaluate_agains_using_count</span><span class="p">(</span>
</span><span id="Die-165"><a href="#Die-165"><span class="linenos"> 165</span></a>                    <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">again_count</span><span class="p">)</span>
</span><span id="Die-166"><a href="#Die-166"><span class="linenos"> 166</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-167"><a href="#Die-167"><span class="linenos"> 167</span></a>                <span class="k">if</span> <span class="n">again_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-168"><a href="#Die-168"><span class="linenos"> 168</span></a>                    <span class="n">again_depth</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Die-169"><a href="#Die-169"><span class="linenos"> 169</span></a>                <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">evaluate_agains_using_depth</span><span class="p">(</span>
</span><span id="Die-170"><a href="#Die-170"><span class="linenos"> 170</span></a>                    <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">again_depth</span><span class="p">,</span> <span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-171"><a href="#Die-171"><span class="linenos"> 171</span></a>
</span><span id="Die-172"><a href="#Die-172"><span class="linenos"> 172</span></a>        <span class="c1"># Agains have been replaced by this point.</span>
</span><span id="Die-173"><a href="#Die-173"><span class="linenos"> 173</span></a>        <span class="n">outcomes</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">T_co</span> <span class="o">|</span> <span class="n">Die</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">icepool</span><span class="o">.</span><span class="n">RerollType</span><span class="p">],</span>
</span><span id="Die-174"><a href="#Die-174"><span class="linenos"> 174</span></a>                        <span class="n">outcomes</span><span class="p">)</span>
</span><span id="Die-175"><a href="#Die-175"><span class="linenos"> 175</span></a>
</span><span id="Die-176"><a href="#Die-176"><span class="linenos"> 176</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Die-177"><a href="#Die-177"><span class="linenos"> 177</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die-178"><a href="#Die-178"><span class="linenos"> 178</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die-179"><a href="#Die-179"><span class="linenos"> 179</span></a>
</span><span id="Die-180"><a href="#Die-180"><span class="linenos"> 180</span></a>        <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_die</span><span class="p">(</span>
</span><span id="Die-181"><a href="#Die-181"><span class="linenos"> 181</span></a>            <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die-182"><a href="#Die-182"><span class="linenos"> 182</span></a>
</span><span id="Die-183"><a href="#Die-183"><span class="linenos"> 183</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span><span id="Die-184"><a href="#Die-184"><span class="linenos"> 184</span></a>
</span><span id="Die-185"><a href="#Die-185"><span class="linenos"> 185</span></a>    <span class="nd">@classmethod</span>
</span><span id="Die-186"><a href="#Die-186"><span class="linenos"> 186</span></a>    <span class="k">def</span> <span class="nf">_new_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-187"><a href="#Die-187"><span class="linenos"> 187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new `Die` using already-processed arguments.</span>
</span><span id="Die-188"><a href="#Die-188"><span class="linenos"> 188</span></a>
</span><span id="Die-189"><a href="#Die-189"><span class="linenos"> 189</span></a><span class="sd">        Args:</span>
</span><span id="Die-190"><a href="#Die-190"><span class="linenos"> 190</span></a><span class="sd">            data: At this point, this is a Counts.</span>
</span><span id="Die-191"><a href="#Die-191"><span class="linenos"> 191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-192"><a href="#Die-192"><span class="linenos"> 192</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Population</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Die-193"><a href="#Die-193"><span class="linenos"> 193</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="Die-194"><a href="#Die-194"><span class="linenos"> 194</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die-195"><a href="#Die-195"><span class="linenos"> 195</span></a>
</span><span id="Die-196"><a href="#Die-196"><span class="linenos"> 196</span></a>    <span class="c1"># Defined separately from the superclass to help typing.</span>
</span><span id="Die-197"><a href="#Die-197"><span class="linenos"> 197</span></a>    <span class="k">def</span> <span class="nf">unary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;icepool.Die[T_co]&#39;</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Die-198"><a href="#Die-198"><span class="linenos"> 198</span></a>                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die-199"><a href="#Die-199"><span class="linenos"> 199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs the unary operation on the outcomes.</span>
</span><span id="Die-200"><a href="#Die-200"><span class="linenos"> 200</span></a>
</span><span id="Die-201"><a href="#Die-201"><span class="linenos"> 201</span></a><span class="sd">        This is used for the standard unary operators</span>
</span><span id="Die-202"><a href="#Die-202"><span class="linenos"> 202</span></a><span class="sd">        `-, +, abs, ~, round, trunc, floor, ceil`</span>
</span><span id="Die-203"><a href="#Die-203"><span class="linenos"> 203</span></a><span class="sd">        as well as the additional methods</span>
</span><span id="Die-204"><a href="#Die-204"><span class="linenos"> 204</span></a><span class="sd">        `zero, bool`.</span>
</span><span id="Die-205"><a href="#Die-205"><span class="linenos"> 205</span></a>
</span><span id="Die-206"><a href="#Die-206"><span class="linenos"> 206</span></a><span class="sd">        This is NOT used for the `[]` operator; when used directly, this is</span>
</span><span id="Die-207"><a href="#Die-207"><span class="linenos"> 207</span></a><span class="sd">        interpreted as a `Mapping` operation and returns the count corresponding</span>
</span><span id="Die-208"><a href="#Die-208"><span class="linenos"> 208</span></a><span class="sd">        to a given outcome. See `marginals()` for applying the `[]` operator to</span>
</span><span id="Die-209"><a href="#Die-209"><span class="linenos"> 209</span></a><span class="sd">        outcomes.</span>
</span><span id="Die-210"><a href="#Die-210"><span class="linenos"> 210</span></a>
</span><span id="Die-211"><a href="#Die-211"><span class="linenos"> 211</span></a><span class="sd">        Returns:</span>
</span><span id="Die-212"><a href="#Die-212"><span class="linenos"> 212</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die-213"><a href="#Die-213"><span class="linenos"> 213</span></a>
</span><span id="Die-214"><a href="#Die-214"><span class="linenos"> 214</span></a><span class="sd">        Raises:</span>
</span><span id="Die-215"><a href="#Die-215"><span class="linenos"> 215</span></a><span class="sd">            ValueError: If tuples are of mismatched length.</span>
</span><span id="Die-216"><a href="#Die-216"><span class="linenos"> 216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-217"><a href="#Die-217"><span class="linenos"> 217</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unary_operator</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Die-218"><a href="#Die-218"><span class="linenos"> 218</span></a>
</span><span id="Die-219"><a href="#Die-219"><span class="linenos"> 219</span></a>    <span class="k">def</span> <span class="nf">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Die-220"><a href="#Die-220"><span class="linenos"> 220</span></a>                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die-221"><a href="#Die-221"><span class="linenos"> 221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs the operation on pairs of outcomes.</span>
</span><span id="Die-222"><a href="#Die-222"><span class="linenos"> 222</span></a>
</span><span id="Die-223"><a href="#Die-223"><span class="linenos"> 223</span></a><span class="sd">        By the time this is called, the other operand has already been</span>
</span><span id="Die-224"><a href="#Die-224"><span class="linenos"> 224</span></a><span class="sd">        converted to a `Die`.</span>
</span><span id="Die-225"><a href="#Die-225"><span class="linenos"> 225</span></a>
</span><span id="Die-226"><a href="#Die-226"><span class="linenos"> 226</span></a><span class="sd">        If one side of a binary operator is a tuple and the other is not, the</span>
</span><span id="Die-227"><a href="#Die-227"><span class="linenos"> 227</span></a><span class="sd">        binary operator is applied to each element of the tuple with the</span>
</span><span id="Die-228"><a href="#Die-228"><span class="linenos"> 228</span></a><span class="sd">        non-tuple side. For example, the following are equivalent:</span>
</span><span id="Die-229"><a href="#Die-229"><span class="linenos"> 229</span></a>
</span><span id="Die-230"><a href="#Die-230"><span class="linenos"> 230</span></a><span class="sd">        ```python</span>
</span><span id="Die-231"><a href="#Die-231"><span class="linenos"> 231</span></a><span class="sd">        cartesian_product(d6, d8) * 2</span>
</span><span id="Die-232"><a href="#Die-232"><span class="linenos"> 232</span></a><span class="sd">        cartesian_product(d6 * 2, d8 * 2)</span>
</span><span id="Die-233"><a href="#Die-233"><span class="linenos"> 233</span></a><span class="sd">        ```</span>
</span><span id="Die-234"><a href="#Die-234"><span class="linenos"> 234</span></a>
</span><span id="Die-235"><a href="#Die-235"><span class="linenos"> 235</span></a><span class="sd">        This is used for the standard binary operators</span>
</span><span id="Die-236"><a href="#Die-236"><span class="linenos"> 236</span></a><span class="sd">        `+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^`</span>
</span><span id="Die-237"><a href="#Die-237"><span class="linenos"> 237</span></a><span class="sd">        and the standard binary comparators</span>
</span><span id="Die-238"><a href="#Die-238"><span class="linenos"> 238</span></a><span class="sd">        `&lt;, &lt;=, &gt;=, &gt;, ==, !=, cmp`.</span>
</span><span id="Die-239"><a href="#Die-239"><span class="linenos"> 239</span></a>
</span><span id="Die-240"><a href="#Die-240"><span class="linenos"> 240</span></a><span class="sd">        `==` and `!=` additionally set the truth value of the `Die` according to</span>
</span><span id="Die-241"><a href="#Die-241"><span class="linenos"> 241</span></a><span class="sd">        whether the dice themselves are the same or not.</span>
</span><span id="Die-242"><a href="#Die-242"><span class="linenos"> 242</span></a>
</span><span id="Die-243"><a href="#Die-243"><span class="linenos"> 243</span></a><span class="sd">        The `@` operator does NOT use this method directly.</span>
</span><span id="Die-244"><a href="#Die-244"><span class="linenos"> 244</span></a><span class="sd">        It rolls the left `Die`, which must have integer outcomes,</span>
</span><span id="Die-245"><a href="#Die-245"><span class="linenos"> 245</span></a><span class="sd">        then rolls the right `Die` that many times and sums the outcomes.</span>
</span><span id="Die-246"><a href="#Die-246"><span class="linenos"> 246</span></a>
</span><span id="Die-247"><a href="#Die-247"><span class="linenos"> 247</span></a><span class="sd">        Returns:</span>
</span><span id="Die-248"><a href="#Die-248"><span class="linenos"> 248</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die-249"><a href="#Die-249"><span class="linenos"> 249</span></a>
</span><span id="Die-250"><a href="#Die-250"><span class="linenos"> 250</span></a><span class="sd">        Raises:</span>
</span><span id="Die-251"><a href="#Die-251"><span class="linenos"> 251</span></a><span class="sd">            ValueError: If tuples are of mismatched length within one of the</span>
</span><span id="Die-252"><a href="#Die-252"><span class="linenos"> 252</span></a><span class="sd">                dice or between the dice.</span>
</span><span id="Die-253"><a href="#Die-253"><span class="linenos"> 253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-254"><a href="#Die-254"><span class="linenos"> 254</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die-255"><a href="#Die-255"><span class="linenos"> 255</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span>
</span><span id="Die-256"><a href="#Die-256"><span class="linenos"> 256</span></a>             <span class="n">quantity_self</span><span class="p">),</span> <span class="p">(</span><span class="n">outcome_other</span><span class="p">,</span>
</span><span id="Die-257"><a href="#Die-257"><span class="linenos"> 257</span></a>                              <span class="n">quantity_other</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
</span><span id="Die-258"><a href="#Die-258"><span class="linenos"> 258</span></a>                                  <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="Die-259"><a href="#Die-259"><span class="linenos"> 259</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span> <span class="n">outcome_other</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Die-260"><a href="#Die-260"><span class="linenos"> 260</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity_self</span> <span class="o">*</span> <span class="n">quantity_other</span>
</span><span id="Die-261"><a href="#Die-261"><span class="linenos"> 261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-262"><a href="#Die-262"><span class="linenos"> 262</span></a>
</span><span id="Die-263"><a href="#Die-263"><span class="linenos"> 263</span></a>    <span class="c1"># Basic access.</span>
</span><span id="Die-264"><a href="#Die-264"><span class="linenos"> 264</span></a>
</span><span id="Die-265"><a href="#Die-265"><span class="linenos"> 265</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Die-266"><a href="#Die-266"><span class="linenos"> 266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Die-267"><a href="#Die-267"><span class="linenos"> 267</span></a>
</span><span id="Die-268"><a href="#Die-268"><span class="linenos"> 268</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Die-269"><a href="#Die-269"><span class="linenos"> 269</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Die-270"><a href="#Die-270"><span class="linenos"> 270</span></a>
</span><span id="Die-271"><a href="#Die-271"><span class="linenos"> 271</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Die-272"><a href="#Die-272"><span class="linenos"> 272</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-273"><a href="#Die-273"><span class="linenos"> 273</span></a>
</span><span id="Die-274"><a href="#Die-274"><span class="linenos"> 274</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-275"><a href="#Die-275"><span class="linenos"> 275</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Die-276"><a href="#Die-276"><span class="linenos"> 276</span></a>
</span><span id="Die-277"><a href="#Die-277"><span class="linenos"> 277</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Die-278"><a href="#Die-278"><span class="linenos"> 278</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Die-279"><a href="#Die-279"><span class="linenos"> 279</span></a>
</span><span id="Die-280"><a href="#Die-280"><span class="linenos"> 280</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-281"><a href="#Die-281"><span class="linenos"> 281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of outcomes. &quot;&quot;&quot;</span>
</span><span id="Die-282"><a href="#Die-282"><span class="linenos"> 282</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Die-283"><a href="#Die-283"><span class="linenos"> 283</span></a>
</span><span id="Die-284"><a href="#Die-284"><span class="linenos"> 284</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Die-285"><a href="#Die-285"><span class="linenos"> 285</span></a>        <span class="k">return</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Die-286"><a href="#Die-286"><span class="linenos"> 286</span></a>
</span><span id="Die-287"><a href="#Die-287"><span class="linenos"> 287</span></a>    <span class="c1"># Quantity management.</span>
</span><span id="Die-288"><a href="#Die-288"><span class="linenos"> 288</span></a>
</span><span id="Die-289"><a href="#Die-289"><span class="linenos"> 289</span></a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-290"><a href="#Die-290"><span class="linenos"> 290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divides all quantities by their greatest common denominator. &quot;&quot;&quot;</span>
</span><span id="Die-291"><a href="#Die-291"><span class="linenos"> 291</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">simplify</span><span class="p">())</span>
</span><span id="Die-292"><a href="#Die-292"><span class="linenos"> 292</span></a>
</span><span id="Die-293"><a href="#Die-293"><span class="linenos"> 293</span></a>    <span class="c1"># Rerolls and other outcome management.</span>
</span><span id="Die-294"><a href="#Die-294"><span class="linenos"> 294</span></a>
</span><span id="Die-295"><a href="#Die-295"><span class="linenos"> 295</span></a>    <span class="k">def</span> <span class="nf">_select_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
</span><span id="Die-296"><a href="#Die-296"><span class="linenos"> 296</span></a>                         <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Die-297"><a href="#Die-297"><span class="linenos"> 297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a set of outcomes of self that fit the given condition.&quot;&quot;&quot;</span>
</span><span id="Die-298"><a href="#Die-298"><span class="linenos"> 298</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">which</span><span class="p">):</span>
</span><span id="Die-299"><a href="#Die-299"><span class="linenos"> 299</span></a>            <span class="k">if</span> <span class="n">star</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-300"><a href="#Die-300"><span class="linenos"> 300</span></a>                <span class="n">star</span> <span class="o">=</span> <span class="n">guess_star</span><span class="p">(</span><span class="n">which</span><span class="p">)</span>
</span><span id="Die-301"><a href="#Die-301"><span class="linenos"> 301</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die-302"><a href="#Die-302"><span class="linenos"> 302</span></a>                <span class="c1"># Need TypeVarTuple to check this.</span>
</span><span id="Die-303"><a href="#Die-303"><span class="linenos"> 303</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="Die-304"><a href="#Die-304"><span class="linenos"> 304</span></a>                    <span class="n">outcome</span>
</span><span id="Die-305"><a href="#Die-305"><span class="linenos"> 305</span></a>                    <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-306"><a href="#Die-306"><span class="linenos"> 306</span></a>                    <span class="k">if</span> <span class="n">which</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-307"><a href="#Die-307"><span class="linenos"> 307</span></a>                <span class="p">}</span>
</span><span id="Die-308"><a href="#Die-308"><span class="linenos"> 308</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-309"><a href="#Die-309"><span class="linenos"> 309</span></a>                <span class="k">return</span> <span class="p">{</span>
</span><span id="Die-310"><a href="#Die-310"><span class="linenos"> 310</span></a>                    <span class="n">outcome</span>
</span><span id="Die-311"><a href="#Die-311"><span class="linenos"> 311</span></a>                    <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="k">if</span> <span class="n">which</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Die-312"><a href="#Die-312"><span class="linenos"> 312</span></a>                <span class="p">}</span>
</span><span id="Die-313"><a href="#Die-313"><span class="linenos"> 313</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-314"><a href="#Die-314"><span class="linenos"> 314</span></a>            <span class="c1"># Collection.</span>
</span><span id="Die-315"><a href="#Die-315"><span class="linenos"> 315</span></a>            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-316"><a href="#Die-316"><span class="linenos"> 316</span></a>                       <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">which</span><span class="p">)</span>
</span><span id="Die-317"><a href="#Die-317"><span class="linenos"> 317</span></a>
</span><span id="Die-318"><a href="#Die-318"><span class="linenos"> 318</span></a>    <span class="k">def</span> <span class="nf">reroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-319"><a href="#Die-319"><span class="linenos"> 319</span></a>               <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-320"><a href="#Die-320"><span class="linenos"> 320</span></a>               <span class="o">/</span><span class="p">,</span>
</span><span id="Die-321"><a href="#Die-321"><span class="linenos"> 321</span></a>               <span class="o">*</span><span class="p">,</span>
</span><span id="Die-322"><a href="#Die-322"><span class="linenos"> 322</span></a>               <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-323"><a href="#Die-323"><span class="linenos"> 323</span></a>               <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-324"><a href="#Die-324"><span class="linenos"> 324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rerolls the given outcomes.</span>
</span><span id="Die-325"><a href="#Die-325"><span class="linenos"> 325</span></a>
</span><span id="Die-326"><a href="#Die-326"><span class="linenos"> 326</span></a><span class="sd">        Args:</span>
</span><span id="Die-327"><a href="#Die-327"><span class="linenos"> 327</span></a><span class="sd">            which: Selects which outcomes to reroll. Options:</span>
</span><span id="Die-328"><a href="#Die-328"><span class="linenos"> 328</span></a><span class="sd">                * A collection of outcomes to reroll.</span>
</span><span id="Die-329"><a href="#Die-329"><span class="linenos"> 329</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-330"><a href="#Die-330"><span class="linenos"> 330</span></a><span class="sd">                    should be rerolled.</span>
</span><span id="Die-331"><a href="#Die-331"><span class="linenos"> 331</span></a><span class="sd">                * If not provided, the min outcome will be rerolled.</span>
</span><span id="Die-332"><a href="#Die-332"><span class="linenos"> 332</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die-333"><a href="#Die-333"><span class="linenos"> 333</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die-334"><a href="#Die-334"><span class="linenos"> 334</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die-335"><a href="#Die-335"><span class="linenos"> 335</span></a><span class="sd">                signature.</span>
</span><span id="Die-336"><a href="#Die-336"><span class="linenos"> 336</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die-337"><a href="#Die-337"><span class="linenos"> 337</span></a><span class="sd">                If `None`, rerolls an unlimited number of times.</span>
</span><span id="Die-338"><a href="#Die-338"><span class="linenos"> 338</span></a>
</span><span id="Die-339"><a href="#Die-339"><span class="linenos"> 339</span></a><span class="sd">        Returns:</span>
</span><span id="Die-340"><a href="#Die-340"><span class="linenos"> 340</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die-341"><a href="#Die-341"><span class="linenos"> 341</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die-342"><a href="#Die-342"><span class="linenos"> 342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-343"><a href="#Die-343"><span class="linenos"> 343</span></a>
</span><span id="Die-344"><a href="#Die-344"><span class="linenos"> 344</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-345"><a href="#Die-345"><span class="linenos"> 345</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()}</span>
</span><span id="Die-346"><a href="#Die-346"><span class="linenos"> 346</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-347"><a href="#Die-347"><span class="linenos"> 347</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die-348"><a href="#Die-348"><span class="linenos"> 348</span></a>
</span><span id="Die-349"><a href="#Die-349"><span class="linenos"> 349</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-350"><a href="#Die-350"><span class="linenos"> 350</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-351"><a href="#Die-351"><span class="linenos"> 351</span></a>                <span class="n">outcome</span><span class="p">:</span> <span class="n">quantity</span>
</span><span id="Die-352"><a href="#Die-352"><span class="linenos"> 352</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-353"><a href="#Die-353"><span class="linenos"> 353</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outcome_set</span>
</span><span id="Die-354"><a href="#Die-354"><span class="linenos"> 354</span></a>            <span class="p">}</span>
</span><span id="Die-355"><a href="#Die-355"><span class="linenos"> 355</span></a>        <span class="k">elif</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-356"><a href="#Die-356"><span class="linenos"> 356</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;reroll depth cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Die-357"><a href="#Die-357"><span class="linenos"> 357</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-358"><a href="#Die-358"><span class="linenos"> 358</span></a>            <span class="n">total_reroll_quantity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">quantity</span>
</span><span id="Die-359"><a href="#Die-359"><span class="linenos"> 359</span></a>                                        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-360"><a href="#Die-360"><span class="linenos"> 360</span></a>                                        <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span><span class="p">)</span>
</span><span id="Die-361"><a href="#Die-361"><span class="linenos"> 361</span></a>            <span class="n">total_stop_quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">total_reroll_quantity</span>
</span><span id="Die-362"><a href="#Die-362"><span class="linenos"> 362</span></a>            <span class="n">rerollable_factor</span> <span class="o">=</span> <span class="n">total_reroll_quantity</span><span class="o">**</span><span class="n">depth</span>
</span><span id="Die-363"><a href="#Die-363"><span class="linenos"> 363</span></a>            <span class="n">stop_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rerollable_factor</span>
</span><span id="Die-364"><a href="#Die-364"><span class="linenos"> 364</span></a>                           <span class="o">*</span> <span class="n">total_reroll_quantity</span><span class="p">)</span> <span class="o">//</span> <span class="n">total_stop_quantity</span>
</span><span id="Die-365"><a href="#Die-365"><span class="linenos"> 365</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-366"><a href="#Die-366"><span class="linenos"> 366</span></a>                <span class="n">outcome</span><span class="p">:</span> <span class="p">(</span><span class="n">rerollable_factor</span> <span class="o">*</span>
</span><span id="Die-367"><a href="#Die-367"><span class="linenos"> 367</span></a>                          <span class="n">quantity</span> <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span> <span class="k">else</span> <span class="n">stop_factor</span> <span class="o">*</span>
</span><span id="Die-368"><a href="#Die-368"><span class="linenos"> 368</span></a>                          <span class="n">quantity</span><span class="p">)</span>
</span><span id="Die-369"><a href="#Die-369"><span class="linenos"> 369</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-370"><a href="#Die-370"><span class="linenos"> 370</span></a>            <span class="p">}</span>
</span><span id="Die-371"><a href="#Die-371"><span class="linenos"> 371</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-372"><a href="#Die-372"><span class="linenos"> 372</span></a>
</span><span id="Die-373"><a href="#Die-373"><span class="linenos"> 373</span></a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-374"><a href="#Die-374"><span class="linenos"> 374</span></a>               <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
</span><span id="Die-375"><a href="#Die-375"><span class="linenos"> 375</span></a>               <span class="o">/</span><span class="p">,</span>
</span><span id="Die-376"><a href="#Die-376"><span class="linenos"> 376</span></a>               <span class="o">*</span><span class="p">,</span>
</span><span id="Die-377"><a href="#Die-377"><span class="linenos"> 377</span></a>               <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-378"><a href="#Die-378"><span class="linenos"> 378</span></a>               <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-379"><a href="#Die-379"><span class="linenos"> 379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rerolls until getting one of the given outcomes.</span>
</span><span id="Die-380"><a href="#Die-380"><span class="linenos"> 380</span></a>
</span><span id="Die-381"><a href="#Die-381"><span class="linenos"> 381</span></a><span class="sd">        Essentially the complement of `reroll()`.</span>
</span><span id="Die-382"><a href="#Die-382"><span class="linenos"> 382</span></a>
</span><span id="Die-383"><a href="#Die-383"><span class="linenos"> 383</span></a><span class="sd">        Args:</span>
</span><span id="Die-384"><a href="#Die-384"><span class="linenos"> 384</span></a><span class="sd">            which: Selects which outcomes to reroll until. Options:</span>
</span><span id="Die-385"><a href="#Die-385"><span class="linenos"> 385</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-386"><a href="#Die-386"><span class="linenos"> 386</span></a><span class="sd">                    should be accepted.</span>
</span><span id="Die-387"><a href="#Die-387"><span class="linenos"> 387</span></a><span class="sd">                * A collection of outcomes to reroll until.</span>
</span><span id="Die-388"><a href="#Die-388"><span class="linenos"> 388</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die-389"><a href="#Die-389"><span class="linenos"> 389</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die-390"><a href="#Die-390"><span class="linenos"> 390</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die-391"><a href="#Die-391"><span class="linenos"> 391</span></a><span class="sd">                signature.</span>
</span><span id="Die-392"><a href="#Die-392"><span class="linenos"> 392</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die-393"><a href="#Die-393"><span class="linenos"> 393</span></a><span class="sd">                If `None`, rerolls an unlimited number of times.</span>
</span><span id="Die-394"><a href="#Die-394"><span class="linenos"> 394</span></a>
</span><span id="Die-395"><a href="#Die-395"><span class="linenos"> 395</span></a><span class="sd">        Returns:</span>
</span><span id="Die-396"><a href="#Die-396"><span class="linenos"> 396</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die-397"><a href="#Die-397"><span class="linenos"> 397</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die-398"><a href="#Die-398"><span class="linenos"> 398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-399"><a href="#Die-399"><span class="linenos"> 399</span></a>
</span><span id="Die-400"><a href="#Die-400"><span class="linenos"> 400</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">which</span><span class="p">):</span>
</span><span id="Die-401"><a href="#Die-401"><span class="linenos"> 401</span></a>            <span class="k">if</span> <span class="n">star</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-402"><a href="#Die-402"><span class="linenos"> 402</span></a>                <span class="n">star</span> <span class="o">=</span> <span class="n">guess_star</span><span class="p">(</span><span class="n">which</span><span class="p">)</span>
</span><span id="Die-403"><a href="#Die-403"><span class="linenos"> 403</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die-404"><a href="#Die-404"><span class="linenos"> 404</span></a>
</span><span id="Die-405"><a href="#Die-405"><span class="linenos"> 405</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-406"><a href="#Die-406"><span class="linenos"> 406</span></a>                    <span class="n">outcome</span>
</span><span id="Die-407"><a href="#Die-407"><span class="linenos"> 407</span></a>                    <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-408"><a href="#Die-408"><span class="linenos"> 408</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-409"><a href="#Die-409"><span class="linenos"> 409</span></a>                <span class="p">}</span>
</span><span id="Die-410"><a href="#Die-410"><span class="linenos"> 410</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-411"><a href="#Die-411"><span class="linenos"> 411</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-412"><a href="#Die-412"><span class="linenos"> 412</span></a>                    <span class="n">outcome</span>
</span><span id="Die-413"><a href="#Die-413"><span class="linenos"> 413</span></a>                    <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Die-414"><a href="#Die-414"><span class="linenos"> 414</span></a>                <span class="p">}</span>
</span><span id="Die-415"><a href="#Die-415"><span class="linenos"> 415</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-416"><a href="#Die-416"><span class="linenos"> 416</span></a>            <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-417"><a href="#Die-417"><span class="linenos"> 417</span></a>                <span class="n">not_outcome</span>
</span><span id="Die-418"><a href="#Die-418"><span class="linenos"> 418</span></a>                <span class="k">for</span> <span class="n">not_outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="k">if</span> <span class="n">not_outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">which</span>
</span><span id="Die-419"><a href="#Die-419"><span class="linenos"> 419</span></a>            <span class="p">}</span>
</span><span id="Die-420"><a href="#Die-420"><span class="linenos"> 420</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reroll</span><span class="p">(</span><span class="n">not_outcomes</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
</span><span id="Die-421"><a href="#Die-421"><span class="linenos"> 421</span></a>
</span><span id="Die-422"><a href="#Die-422"><span class="linenos"> 422</span></a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-423"><a href="#Die-423"><span class="linenos"> 423</span></a>              <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-424"><a href="#Die-424"><span class="linenos"> 424</span></a>              <span class="o">/</span><span class="p">,</span>
</span><span id="Die-425"><a href="#Die-425"><span class="linenos"> 425</span></a>              <span class="o">*</span><span class="p">,</span>
</span><span id="Die-426"><a href="#Die-426"><span class="linenos"> 426</span></a>              <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Die-427"><a href="#Die-427"><span class="linenos"> 427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Splits this die into one containing selected items and another containing the rest.</span>
</span><span id="Die-428"><a href="#Die-428"><span class="linenos"> 428</span></a>
</span><span id="Die-429"><a href="#Die-429"><span class="linenos"> 429</span></a><span class="sd">        The total denominator is preserved.</span>
</span><span id="Die-430"><a href="#Die-430"><span class="linenos"> 430</span></a><span class="sd">        </span>
</span><span id="Die-431"><a href="#Die-431"><span class="linenos"> 431</span></a><span class="sd">        Equivalent to `self.filter(), self.reroll()`.</span>
</span><span id="Die-432"><a href="#Die-432"><span class="linenos"> 432</span></a>
</span><span id="Die-433"><a href="#Die-433"><span class="linenos"> 433</span></a><span class="sd">        Args:</span>
</span><span id="Die-434"><a href="#Die-434"><span class="linenos"> 434</span></a><span class="sd">            which: Selects which outcomes to reroll until. Options:</span>
</span><span id="Die-435"><a href="#Die-435"><span class="linenos"> 435</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-436"><a href="#Die-436"><span class="linenos"> 436</span></a><span class="sd">                    should be accepted.</span>
</span><span id="Die-437"><a href="#Die-437"><span class="linenos"> 437</span></a><span class="sd">                * A collection of outcomes to reroll until.</span>
</span><span id="Die-438"><a href="#Die-438"><span class="linenos"> 438</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die-439"><a href="#Die-439"><span class="linenos"> 439</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die-440"><a href="#Die-440"><span class="linenos"> 440</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die-441"><a href="#Die-441"><span class="linenos"> 441</span></a><span class="sd">                signature.</span>
</span><span id="Die-442"><a href="#Die-442"><span class="linenos"> 442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-443"><a href="#Die-443"><span class="linenos"> 443</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-444"><a href="#Die-444"><span class="linenos"> 444</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()}</span>
</span><span id="Die-445"><a href="#Die-445"><span class="linenos"> 445</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-446"><a href="#Die-446"><span class="linenos"> 446</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die-447"><a href="#Die-447"><span class="linenos"> 447</span></a>
</span><span id="Die-448"><a href="#Die-448"><span class="linenos"> 448</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die-449"><a href="#Die-449"><span class="linenos"> 449</span></a>        <span class="n">not_selected</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die-450"><a href="#Die-450"><span class="linenos"> 450</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-451"><a href="#Die-451"><span class="linenos"> 451</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span><span class="p">:</span>
</span><span id="Die-452"><a href="#Die-452"><span class="linenos"> 452</span></a>                <span class="n">selected</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="Die-453"><a href="#Die-453"><span class="linenos"> 453</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-454"><a href="#Die-454"><span class="linenos"> 454</span></a>                <span class="n">not_selected</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="Die-455"><a href="#Die-455"><span class="linenos"> 455</span></a>
</span><span id="Die-456"><a href="#Die-456"><span class="linenos"> 456</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="p">(</span><span class="n">selected</span><span class="p">),</span> <span class="n">Die</span><span class="p">(</span><span class="n">not_selected</span><span class="p">)</span>
</span><span id="Die-457"><a href="#Die-457"><span class="linenos"> 457</span></a>
</span><span id="Die-458"><a href="#Die-458"><span class="linenos"> 458</span></a>    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-459"><a href="#Die-459"><span class="linenos"> 459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Truncates the outcomes of this `Die` to the given range.</span>
</span><span id="Die-460"><a href="#Die-460"><span class="linenos"> 460</span></a>
</span><span id="Die-461"><a href="#Die-461"><span class="linenos"> 461</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die-462"><a href="#Die-462"><span class="linenos"> 462</span></a><span class="sd">        If one of the arguments is not provided, that side will not be truncated.</span>
</span><span id="Die-463"><a href="#Die-463"><span class="linenos"> 463</span></a>
</span><span id="Die-464"><a href="#Die-464"><span class="linenos"> 464</span></a><span class="sd">        This effectively rerolls outcomes outside the given range.</span>
</span><span id="Die-465"><a href="#Die-465"><span class="linenos"> 465</span></a><span class="sd">        If instead you want to replace those outcomes with the nearest endpoint,</span>
</span><span id="Die-466"><a href="#Die-466"><span class="linenos"> 466</span></a><span class="sd">        use `clip()`.</span>
</span><span id="Die-467"><a href="#Die-467"><span class="linenos"> 467</span></a>
</span><span id="Die-468"><a href="#Die-468"><span class="linenos"> 468</span></a><span class="sd">        Not to be confused with `trunc(die)`, which performs integer truncation</span>
</span><span id="Die-469"><a href="#Die-469"><span class="linenos"> 469</span></a><span class="sd">        on each outcome.</span>
</span><span id="Die-470"><a href="#Die-470"><span class="linenos"> 470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-471"><a href="#Die-471"><span class="linenos"> 471</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-472"><a href="#Die-472"><span class="linenos"> 472</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">min_outcome</span><span class="p">)</span>
</span><span id="Die-473"><a href="#Die-473"><span class="linenos"> 473</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-474"><a href="#Die-474"><span class="linenos"> 474</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-475"><a href="#Die-475"><span class="linenos"> 475</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-476"><a href="#Die-476"><span class="linenos"> 476</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">max_outcome</span><span class="p">)</span>
</span><span id="Die-477"><a href="#Die-477"><span class="linenos"> 477</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-478"><a href="#Die-478"><span class="linenos"> 478</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-479"><a href="#Die-479"><span class="linenos"> 479</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]}</span>
</span><span id="Die-480"><a href="#Die-480"><span class="linenos"> 480</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-481"><a href="#Die-481"><span class="linenos"> 481</span></a>
</span><span id="Die-482"><a href="#Die-482"><span class="linenos"> 482</span></a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-483"><a href="#Die-483"><span class="linenos"> 483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clips the outcomes of this `Die` to the given values.</span>
</span><span id="Die-484"><a href="#Die-484"><span class="linenos"> 484</span></a>
</span><span id="Die-485"><a href="#Die-485"><span class="linenos"> 485</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die-486"><a href="#Die-486"><span class="linenos"> 486</span></a><span class="sd">        If one of the arguments is not provided, that side will not be clipped.</span>
</span><span id="Die-487"><a href="#Die-487"><span class="linenos"> 487</span></a>
</span><span id="Die-488"><a href="#Die-488"><span class="linenos"> 488</span></a><span class="sd">        This is not the same as rerolling outcomes beyond this range;</span>
</span><span id="Die-489"><a href="#Die-489"><span class="linenos"> 489</span></a><span class="sd">        the outcome is simply adjusted to fit within the range.</span>
</span><span id="Die-490"><a href="#Die-490"><span class="linenos"> 490</span></a><span class="sd">        This will typically cause some quantity to bunch up at the endpoint.</span>
</span><span id="Die-491"><a href="#Die-491"><span class="linenos"> 491</span></a><span class="sd">        If you want to reroll outcomes beyond this range, use `truncate()`.</span>
</span><span id="Die-492"><a href="#Die-492"><span class="linenos"> 492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-493"><a href="#Die-493"><span class="linenos"> 493</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die-494"><a href="#Die-494"><span class="linenos"> 494</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-495"><a href="#Die-495"><span class="linenos"> 495</span></a>            <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&lt;=</span> <span class="n">min_outcome</span><span class="p">:</span>
</span><span id="Die-496"><a href="#Die-496"><span class="linenos"> 496</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">min_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die-497"><a href="#Die-497"><span class="linenos"> 497</span></a>            <span class="k">elif</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&gt;=</span> <span class="n">max_outcome</span><span class="p">:</span>
</span><span id="Die-498"><a href="#Die-498"><span class="linenos"> 498</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">max_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die-499"><a href="#Die-499"><span class="linenos"> 499</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-500"><a href="#Die-500"><span class="linenos"> 500</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die-501"><a href="#Die-501"><span class="linenos"> 501</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-502"><a href="#Die-502"><span class="linenos"> 502</span></a>
</span><span id="Die-503"><a href="#Die-503"><span class="linenos"> 503</span></a>    <span class="k">def</span> <span class="nf">set_range</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">,</span>
</span><span id="Die-504"><a href="#Die-504"><span class="linenos"> 504</span></a>                  <span class="n">min_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-505"><a href="#Die-505"><span class="linenos"> 505</span></a>                  <span class="n">max_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die-506"><a href="#Die-506"><span class="linenos"> 506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the outcomes of this `Die` to the given `int` range (inclusive).</span>
</span><span id="Die-507"><a href="#Die-507"><span class="linenos"> 507</span></a>
</span><span id="Die-508"><a href="#Die-508"><span class="linenos"> 508</span></a><span class="sd">        This may remove outcomes (if they are not within the range)</span>
</span><span id="Die-509"><a href="#Die-509"><span class="linenos"> 509</span></a><span class="sd">        and/or add zero-quantity outcomes (if they are in range but not present</span>
</span><span id="Die-510"><a href="#Die-510"><span class="linenos"> 510</span></a><span class="sd">        in this `Die`).</span>
</span><span id="Die-511"><a href="#Die-511"><span class="linenos"> 511</span></a>
</span><span id="Die-512"><a href="#Die-512"><span class="linenos"> 512</span></a><span class="sd">        Args:</span>
</span><span id="Die-513"><a href="#Die-513"><span class="linenos"> 513</span></a><span class="sd">            min_outcome: The min outcome of the result.</span>
</span><span id="Die-514"><a href="#Die-514"><span class="linenos"> 514</span></a><span class="sd">                If omitted, the min outcome of this `Die` will be used.</span>
</span><span id="Die-515"><a href="#Die-515"><span class="linenos"> 515</span></a><span class="sd">            max_outcome: The max outcome of the result.</span>
</span><span id="Die-516"><a href="#Die-516"><span class="linenos"> 516</span></a><span class="sd">                If omitted, the max outcome of this `Die` will be used.</span>
</span><span id="Die-517"><a href="#Die-517"><span class="linenos"> 517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-518"><a href="#Die-518"><span class="linenos"> 518</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-519"><a href="#Die-519"><span class="linenos"> 519</span></a>            <span class="n">min_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="Die-520"><a href="#Die-520"><span class="linenos"> 520</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-521"><a href="#Die-521"><span class="linenos"> 521</span></a>            <span class="n">max_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Die-522"><a href="#Die-522"><span class="linenos"> 522</span></a>
</span><span id="Die-523"><a href="#Die-523"><span class="linenos"> 523</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Die-524"><a href="#Die-524"><span class="linenos"> 524</span></a>
</span><span id="Die-525"><a href="#Die-525"><span class="linenos"> 525</span></a>    <span class="k">def</span> <span class="nf">set_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-526"><a href="#Die-526"><span class="linenos"> 526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the set of outcomes to the argument.</span>
</span><span id="Die-527"><a href="#Die-527"><span class="linenos"> 527</span></a>
</span><span id="Die-528"><a href="#Die-528"><span class="linenos"> 528</span></a><span class="sd">        This may remove outcomes (if they are not present in the argument)</span>
</span><span id="Die-529"><a href="#Die-529"><span class="linenos"> 529</span></a><span class="sd">        and/or add zero-quantity outcomes (if they are not present in this `Die`).</span>
</span><span id="Die-530"><a href="#Die-530"><span class="linenos"> 530</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-531"><a href="#Die-531"><span class="linenos"> 531</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">}</span>
</span><span id="Die-532"><a href="#Die-532"><span class="linenos"> 532</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-533"><a href="#Die-533"><span class="linenos"> 533</span></a>
</span><span id="Die-534"><a href="#Die-534"><span class="linenos"> 534</span></a>    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-535"><a href="#Die-535"><span class="linenos"> 535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes all zero-quantity outcomes. &quot;&quot;&quot;</span>
</span><span id="Die-536"><a href="#Die-536"><span class="linenos"> 536</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Die-537"><a href="#Die-537"><span class="linenos"> 537</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-538"><a href="#Die-538"><span class="linenos"> 538</span></a>
</span><span id="Die-539"><a href="#Die-539"><span class="linenos"> 539</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-540"><a href="#Die-540"><span class="linenos"> 540</span></a>    <span class="k">def</span> <span class="nf">_popped_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-541"><a href="#Die-541"><span class="linenos"> 541</span></a>        <span class="n">die</span> <span class="o">=</span> <span class="n">Die</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_min</span><span class="p">())</span>
</span><span id="Die-542"><a href="#Die-542"><span class="linenos"> 542</span></a>        <span class="k">return</span> <span class="n">die</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die-543"><a href="#Die-543"><span class="linenos"> 543</span></a>
</span><span id="Die-544"><a href="#Die-544"><span class="linenos"> 544</span></a>    <span class="k">def</span> <span class="nf">_pop_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-545"><a href="#Die-545"><span class="linenos"> 545</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `Die` with the min outcome removed, and the quantity of the removed outcome.</span>
</span><span id="Die-546"><a href="#Die-546"><span class="linenos"> 546</span></a>
</span><span id="Die-547"><a href="#Die-547"><span class="linenos"> 547</span></a><span class="sd">        Raises:</span>
</span><span id="Die-548"><a href="#Die-548"><span class="linenos"> 548</span></a><span class="sd">            IndexError: If this `Die` has no outcome to pop.</span>
</span><span id="Die-549"><a href="#Die-549"><span class="linenos"> 549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-550"><a href="#Die-550"><span class="linenos"> 550</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_min</span>
</span><span id="Die-551"><a href="#Die-551"><span class="linenos"> 551</span></a>
</span><span id="Die-552"><a href="#Die-552"><span class="linenos"> 552</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-553"><a href="#Die-553"><span class="linenos"> 553</span></a>    <span class="k">def</span> <span class="nf">_popped_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-554"><a href="#Die-554"><span class="linenos"> 554</span></a>        <span class="n">die</span> <span class="o">=</span> <span class="n">Die</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_max</span><span class="p">())</span>
</span><span id="Die-555"><a href="#Die-555"><span class="linenos"> 555</span></a>        <span class="k">return</span> <span class="n">die</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Die-556"><a href="#Die-556"><span class="linenos"> 556</span></a>
</span><span id="Die-557"><a href="#Die-557"><span class="linenos"> 557</span></a>    <span class="k">def</span> <span class="nf">_pop_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-558"><a href="#Die-558"><span class="linenos"> 558</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `Die` with the max outcome removed, and the quantity of the removed outcome.</span>
</span><span id="Die-559"><a href="#Die-559"><span class="linenos"> 559</span></a>
</span><span id="Die-560"><a href="#Die-560"><span class="linenos"> 560</span></a><span class="sd">        Raises:</span>
</span><span id="Die-561"><a href="#Die-561"><span class="linenos"> 561</span></a><span class="sd">            IndexError: If this `Die` has no outcome to pop.</span>
</span><span id="Die-562"><a href="#Die-562"><span class="linenos"> 562</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-563"><a href="#Die-563"><span class="linenos"> 563</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_max</span>
</span><span id="Die-564"><a href="#Die-564"><span class="linenos"> 564</span></a>
</span><span id="Die-565"><a href="#Die-565"><span class="linenos"> 565</span></a>    <span class="c1"># Processes.</span>
</span><span id="Die-566"><a href="#Die-566"><span class="linenos"> 566</span></a>
</span><span id="Die-567"><a href="#Die-567"><span class="linenos"> 567</span></a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span>
</span><span id="Die-568"><a href="#Die-568"><span class="linenos"> 568</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-569"><a href="#Die-569"><span class="linenos"> 569</span></a>        <span class="n">repl</span><span class="p">:</span>
</span><span id="Die-570"><a href="#Die-570"><span class="linenos"> 570</span></a>        <span class="s1">&#39;Callable[..., U | Die[U] | icepool.RerollType | icepool.AgainExpression] | Mapping[T_co, U | Die[U] | icepool.RerollType | icepool.AgainExpression]&#39;</span><span class="p">,</span>
</span><span id="Die-571"><a href="#Die-571"><span class="linenos"> 571</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="Die-572"><a href="#Die-572"><span class="linenos"> 572</span></a>        <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-573"><a href="#Die-573"><span class="linenos"> 573</span></a>        <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-574"><a href="#Die-574"><span class="linenos"> 574</span></a>        <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-575"><a href="#Die-575"><span class="linenos"> 575</span></a>        <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-576"><a href="#Die-576"><span class="linenos"> 576</span></a>        <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-577"><a href="#Die-577"><span class="linenos"> 577</span></a>        <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;U | Die[U] | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-578"><a href="#Die-578"><span class="linenos"> 578</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die-579"><a href="#Die-579"><span class="linenos"> 579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps outcomes of the `Die` to other outcomes.</span>
</span><span id="Die-580"><a href="#Die-580"><span class="linenos"> 580</span></a>
</span><span id="Die-581"><a href="#Die-581"><span class="linenos"> 581</span></a><span class="sd">        This is also useful for representing processes.</span>
</span><span id="Die-582"><a href="#Die-582"><span class="linenos"> 582</span></a>
</span><span id="Die-583"><a href="#Die-583"><span class="linenos"> 583</span></a><span class="sd">        As `icepool.map(repl, self, ...)`.</span>
</span><span id="Die-584"><a href="#Die-584"><span class="linenos"> 584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-585"><a href="#Die-585"><span class="linenos"> 585</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span>
</span><span id="Die-586"><a href="#Die-586"><span class="linenos"> 586</span></a>                           <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-587"><a href="#Die-587"><span class="linenos"> 587</span></a>                           <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-588"><a href="#Die-588"><span class="linenos"> 588</span></a>                           <span class="n">star</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
</span><span id="Die-589"><a href="#Die-589"><span class="linenos"> 589</span></a>                           <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">,</span>
</span><span id="Die-590"><a href="#Die-590"><span class="linenos"> 590</span></a>                           <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="Die-591"><a href="#Die-591"><span class="linenos"> 591</span></a>                           <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die-592"><a href="#Die-592"><span class="linenos"> 592</span></a>                           <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-593"><a href="#Die-593"><span class="linenos"> 593</span></a>
</span><span id="Die-594"><a href="#Die-594"><span class="linenos"> 594</span></a>    <span class="k">def</span> <span class="nf">map_and_time</span><span class="p">(</span>
</span><span id="Die-595"><a href="#Die-595"><span class="linenos"> 595</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-596"><a href="#Die-596"><span class="linenos"> 596</span></a>            <span class="n">repl</span><span class="p">:</span>
</span><span id="Die-597"><a href="#Die-597"><span class="linenos"> 597</span></a>        <span class="s1">&#39;Callable[..., T_co | Die[T_co] | icepool.RerollType] | Mapping[T_co, T_co | Die[T_co] | icepool.RerollType]&#39;</span><span class="p">,</span>
</span><span id="Die-598"><a href="#Die-598"><span class="linenos"> 598</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die-599"><a href="#Die-599"><span class="linenos"> 599</span></a>            <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-600"><a href="#Die-600"><span class="linenos"> 600</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-601"><a href="#Die-601"><span class="linenos"> 601</span></a>            <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[tuple[T_co, int]]&#39;</span><span class="p">:</span>
</span><span id="Die-602"><a href="#Die-602"><span class="linenos"> 602</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Repeatedly map outcomes of the state to other outcomes, while also</span>
</span><span id="Die-603"><a href="#Die-603"><span class="linenos"> 603</span></a><span class="sd">        counting timesteps.</span>
</span><span id="Die-604"><a href="#Die-604"><span class="linenos"> 604</span></a>
</span><span id="Die-605"><a href="#Die-605"><span class="linenos"> 605</span></a><span class="sd">        This is useful for representing processes.</span>
</span><span id="Die-606"><a href="#Die-606"><span class="linenos"> 606</span></a>
</span><span id="Die-607"><a href="#Die-607"><span class="linenos"> 607</span></a><span class="sd">        As `map_and_time(repl, self, ...)`.</span>
</span><span id="Die-608"><a href="#Die-608"><span class="linenos"> 608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-609"><a href="#Die-609"><span class="linenos"> 609</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map_and_time</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span>
</span><span id="Die-610"><a href="#Die-610"><span class="linenos"> 610</span></a>                                    <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-611"><a href="#Die-611"><span class="linenos"> 611</span></a>                                    <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-612"><a href="#Die-612"><span class="linenos"> 612</span></a>                                    <span class="n">star</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
</span><span id="Die-613"><a href="#Die-613"><span class="linenos"> 613</span></a>                                    <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">)</span>
</span><span id="Die-614"><a href="#Die-614"><span class="linenos"> 614</span></a>
</span><span id="Die-615"><a href="#Die-615"><span class="linenos"> 615</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-616"><a href="#Die-616"><span class="linenos"> 616</span></a>    <span class="k">def</span> <span class="nf">_mean_time_to_sum_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Fraction</span><span class="p">]:</span>
</span><span id="Die-617"><a href="#Die-617"><span class="linenos"> 617</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>
</span><span id="Die-618"><a href="#Die-618"><span class="linenos"> 618</span></a>
</span><span id="Die-619"><a href="#Die-619"><span class="linenos"> 619</span></a>    <span class="k">def</span> <span class="nf">mean_time_to_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Die-620"><a href="#Die-620"><span class="linenos"> 620</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The mean number of rolls until the cumulative sum is greater or equal to the target.</span>
</span><span id="Die-621"><a href="#Die-621"><span class="linenos"> 621</span></a>
</span><span id="Die-622"><a href="#Die-622"><span class="linenos"> 622</span></a><span class="sd">        Args:</span>
</span><span id="Die-623"><a href="#Die-623"><span class="linenos"> 623</span></a><span class="sd">            target: The target sum.</span>
</span><span id="Die-624"><a href="#Die-624"><span class="linenos"> 624</span></a>
</span><span id="Die-625"><a href="#Die-625"><span class="linenos"> 625</span></a><span class="sd">        Raises:</span>
</span><span id="Die-626"><a href="#Die-626"><span class="linenos"> 626</span></a><span class="sd">            ValueError: If `self` has negative outcomes.</span>
</span><span id="Die-627"><a href="#Die-627"><span class="linenos"> 627</span></a><span class="sd">            ZeroDivisionError: If `self.mean() == 0`.</span>
</span><span id="Die-628"><a href="#Die-628"><span class="linenos"> 628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-629"><a href="#Die-629"><span class="linenos"> 629</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Die-630"><a href="#Die-630"><span class="linenos"> 630</span></a>
</span><span id="Die-631"><a href="#Die-631"><span class="linenos"> 631</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="p">):</span>
</span><span id="Die-632"><a href="#Die-632"><span class="linenos"> 632</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
</span><span id="Die-633"><a href="#Die-633"><span class="linenos"> 633</span></a>
</span><span id="Die-634"><a href="#Die-634"><span class="linenos"> 634</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-635"><a href="#Die-635"><span class="linenos"> 635</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-636"><a href="#Die-636"><span class="linenos"> 636</span></a>                <span class="s1">&#39;mean_time_to_sum does not handle negative outcomes.&#39;</span><span class="p">)</span>
</span><span id="Die-637"><a href="#Die-637"><span class="linenos"> 637</span></a>        <span class="n">time_per_effect</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">(),</span>
</span><span id="Die-638"><a href="#Die-638"><span class="linenos"> 638</span></a>                                   <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="Die-639"><a href="#Die-639"><span class="linenos"> 639</span></a>
</span><span id="Die-640"><a href="#Die-640"><span class="linenos"> 640</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="p">),</span> <span class="n">target</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Die-641"><a href="#Die-641"><span class="linenos"> 641</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">time_per_effect</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reroll</span><span class="p">(</span>
</span><span id="Die-642"><a href="#Die-642"><span class="linenos"> 642</span></a>                <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Die-643"><a href="#Die-643"><span class="linenos"> 643</span></a>                <span class="n">depth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_time_to_sum</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Die-644"><a href="#Die-644"><span class="linenos"> 644</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="Die-645"><a href="#Die-645"><span class="linenos"> 645</span></a>
</span><span id="Die-646"><a href="#Die-646"><span class="linenos"> 646</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Die-647"><a href="#Die-647"><span class="linenos"> 647</span></a>
</span><span id="Die-648"><a href="#Die-648"><span class="linenos"> 648</span></a>    <span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-649"><a href="#Die-649"><span class="linenos"> 649</span></a>                <span class="n">which</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-650"><a href="#Die-650"><span class="linenos"> 650</span></a>                <span class="o">/</span><span class="p">,</span>
</span><span id="Die-651"><a href="#Die-651"><span class="linenos"> 651</span></a>                <span class="o">*</span><span class="p">,</span>
</span><span id="Die-652"><a href="#Die-652"><span class="linenos"> 652</span></a>                <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-653"><a href="#Die-653"><span class="linenos"> 653</span></a>                <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
</span><span id="Die-654"><a href="#Die-654"><span class="linenos"> 654</span></a>                <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-655"><a href="#Die-655"><span class="linenos"> 655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Causes outcomes to be rolled again and added to the total.</span>
</span><span id="Die-656"><a href="#Die-656"><span class="linenos"> 656</span></a>
</span><span id="Die-657"><a href="#Die-657"><span class="linenos"> 657</span></a><span class="sd">        Args:</span>
</span><span id="Die-658"><a href="#Die-658"><span class="linenos"> 658</span></a><span class="sd">            which: Which outcomes to explode. Options:</span>
</span><span id="Die-659"><a href="#Die-659"><span class="linenos"> 659</span></a><span class="sd">                * A single outcome to explode.</span>
</span><span id="Die-660"><a href="#Die-660"><span class="linenos"> 660</span></a><span class="sd">                * An collection of outcomes to explode.</span>
</span><span id="Die-661"><a href="#Die-661"><span class="linenos"> 661</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-662"><a href="#Die-662"><span class="linenos"> 662</span></a><span class="sd">                    should be exploded.</span>
</span><span id="Die-663"><a href="#Die-663"><span class="linenos"> 663</span></a><span class="sd">                * If not supplied, the max outcome will explode.</span>
</span><span id="Die-664"><a href="#Die-664"><span class="linenos"> 664</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die-665"><a href="#Die-665"><span class="linenos"> 665</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die-666"><a href="#Die-666"><span class="linenos"> 666</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die-667"><a href="#Die-667"><span class="linenos"> 667</span></a><span class="sd">                signature.</span>
</span><span id="Die-668"><a href="#Die-668"><span class="linenos"> 668</span></a><span class="sd">            depth: The maximum number of additional dice to roll, not counting</span>
</span><span id="Die-669"><a href="#Die-669"><span class="linenos"> 669</span></a><span class="sd">                the initial roll.</span>
</span><span id="Die-670"><a href="#Die-670"><span class="linenos"> 670</span></a><span class="sd">                If not supplied, a default value will be used.</span>
</span><span id="Die-671"><a href="#Die-671"><span class="linenos"> 671</span></a><span class="sd">            end: Once `depth` is reached, further explosions will be treated</span>
</span><span id="Die-672"><a href="#Die-672"><span class="linenos"> 672</span></a><span class="sd">                as this value. By default, a zero value will be used.</span>
</span><span id="Die-673"><a href="#Die-673"><span class="linenos"> 673</span></a><span class="sd">                `icepool.Reroll` will make one extra final roll, rerolling until</span>
</span><span id="Die-674"><a href="#Die-674"><span class="linenos"> 674</span></a><span class="sd">                a non-exploding outcome is reached.</span>
</span><span id="Die-675"><a href="#Die-675"><span class="linenos"> 675</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-676"><a href="#Die-676"><span class="linenos"> 676</span></a>
</span><span id="Die-677"><a href="#Die-677"><span class="linenos"> 677</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-678"><a href="#Die-678"><span class="linenos"> 678</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()}</span>
</span><span id="Die-679"><a href="#Die-679"><span class="linenos"> 679</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-680"><a href="#Die-680"><span class="linenos"> 680</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die-681"><a href="#Die-681"><span class="linenos"> 681</span></a>
</span><span id="Die-682"><a href="#Die-682"><span class="linenos"> 682</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-683"><a href="#Die-683"><span class="linenos"> 683</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;depth cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Die-684"><a href="#Die-684"><span class="linenos"> 684</span></a>        <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-685"><a href="#Die-685"><span class="linenos"> 685</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die-686"><a href="#Die-686"><span class="linenos"> 686</span></a>
</span><span id="Die-687"><a href="#Die-687"><span class="linenos"> 687</span></a>        <span class="k">def</span> <span class="nf">map_final</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die-688"><a href="#Die-688"><span class="linenos"> 688</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span><span class="p">:</span>
</span><span id="Die-689"><a href="#Die-689"><span class="linenos"> 689</span></a>                <span class="k">return</span> <span class="n">outcome</span> <span class="o">+</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span>
</span><span id="Die-690"><a href="#Die-690"><span class="linenos"> 690</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-691"><a href="#Die-691"><span class="linenos"> 691</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Die-692"><a href="#Die-692"><span class="linenos"> 692</span></a>
</span><span id="Die-693"><a href="#Die-693"><span class="linenos"> 693</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">map_final</span><span class="p">,</span> <span class="n">again_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">again_end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
</span><span id="Die-694"><a href="#Die-694"><span class="linenos"> 694</span></a>
</span><span id="Die-695"><a href="#Die-695"><span class="linenos"> 695</span></a>    <span class="k">def</span> <span class="nf">if_else</span><span class="p">(</span>
</span><span id="Die-696"><a href="#Die-696"><span class="linenos"> 696</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-697"><a href="#Die-697"><span class="linenos"> 697</span></a>        <span class="n">outcome_if_true</span><span class="p">:</span> <span class="n">U</span> <span class="o">|</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">,</span>
</span><span id="Die-698"><a href="#Die-698"><span class="linenos"> 698</span></a>        <span class="n">outcome_if_false</span><span class="p">:</span> <span class="n">U</span> <span class="o">|</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">,</span>
</span><span id="Die-699"><a href="#Die-699"><span class="linenos"> 699</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="Die-700"><a href="#Die-700"><span class="linenos"> 700</span></a>        <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-701"><a href="#Die-701"><span class="linenos"> 701</span></a>        <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-702"><a href="#Die-702"><span class="linenos"> 702</span></a>        <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;U | Die[U] | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-703"><a href="#Die-703"><span class="linenos"> 703</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die-704"><a href="#Die-704"><span class="linenos"> 704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ternary conditional operator.</span>
</span><span id="Die-705"><a href="#Die-705"><span class="linenos"> 705</span></a>
</span><span id="Die-706"><a href="#Die-706"><span class="linenos"> 706</span></a><span class="sd">        This replaces truthy outcomes with the first argument and falsy outcomes</span>
</span><span id="Die-707"><a href="#Die-707"><span class="linenos"> 707</span></a><span class="sd">        with the second argument.</span>
</span><span id="Die-708"><a href="#Die-708"><span class="linenos"> 708</span></a>
</span><span id="Die-709"><a href="#Die-709"><span class="linenos"> 709</span></a><span class="sd">        Args:</span>
</span><span id="Die-710"><a href="#Die-710"><span class="linenos"> 710</span></a><span class="sd">            again_count, again_depth, again_end: Forwarded to the final die constructor.</span>
</span><span id="Die-711"><a href="#Die-711"><span class="linenos"> 711</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-712"><a href="#Die-712"><span class="linenos"> 712</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="Die-713"><a href="#Die-713"><span class="linenos"> 713</span></a>            <span class="p">{</span>
</span><span id="Die-714"><a href="#Die-714"><span class="linenos"> 714</span></a>                <span class="kc">True</span><span class="p">:</span> <span class="n">outcome_if_true</span><span class="p">,</span>
</span><span id="Die-715"><a href="#Die-715"><span class="linenos"> 715</span></a>                <span class="kc">False</span><span class="p">:</span> <span class="n">outcome_if_false</span>
</span><span id="Die-716"><a href="#Die-716"><span class="linenos"> 716</span></a>            <span class="p">},</span>
</span><span id="Die-717"><a href="#Die-717"><span class="linenos"> 717</span></a>            <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="Die-718"><a href="#Die-718"><span class="linenos"> 718</span></a>            <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die-719"><a href="#Die-719"><span class="linenos"> 719</span></a>            <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-720"><a href="#Die-720"><span class="linenos"> 720</span></a>
</span><span id="Die-721"><a href="#Die-721"><span class="linenos"> 721</span></a>    <span class="k">def</span> <span class="nf">is_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[bool]&#39;</span><span class="p">:</span>
</span><span id="Die-722"><a href="#Die-722"><span class="linenos"> 722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A die that returns True iff the roll of the die is contained in the target.&quot;&quot;&quot;</span>
</span><span id="Die-723"><a href="#Die-723"><span class="linenos"> 723</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target</span><span class="p">)</span>
</span><span id="Die-724"><a href="#Die-724"><span class="linenos"> 724</span></a>
</span><span id="Die-725"><a href="#Die-725"><span class="linenos"> 725</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die-726"><a href="#Die-726"><span class="linenos"> 726</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll this dice a number of times and count how many are in the target.&quot;&quot;&quot;</span>
</span><span id="Die-727"><a href="#Die-727"><span class="linenos"> 727</span></a>        <span class="k">return</span> <span class="n">rolls</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_in</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="Die-728"><a href="#Die-728"><span class="linenos"> 728</span></a>
</span><span id="Die-729"><a href="#Die-729"><span class="linenos"> 729</span></a>    <span class="c1"># Pools and sums.</span>
</span><span id="Die-730"><a href="#Die-730"><span class="linenos"> 730</span></a>
</span><span id="Die-731"><a href="#Die-731"><span class="linenos"> 731</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-732"><a href="#Die-732"><span class="linenos"> 732</span></a>    <span class="k">def</span> <span class="nf">_sum_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;Die&#39;</span><span class="p">]:</span>
</span><span id="Die-733"><a href="#Die-733"><span class="linenos"> 733</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="Die-734"><a href="#Die-734"><span class="linenos"> 734</span></a>
</span><span id="Die-735"><a href="#Die-735"><span class="linenos"> 735</span></a>    <span class="k">def</span> <span class="nf">_sum_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-736"><a href="#Die-736"><span class="linenos"> 736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll this `Die` `rolls` times and sum the results.</span>
</span><span id="Die-737"><a href="#Die-737"><span class="linenos"> 737</span></a>
</span><span id="Die-738"><a href="#Die-738"><span class="linenos"> 738</span></a><span class="sd">        If `rolls` is negative, roll the `Die` `abs(rolls)` times and negate</span>
</span><span id="Die-739"><a href="#Die-739"><span class="linenos"> 739</span></a><span class="sd">        the result.</span>
</span><span id="Die-740"><a href="#Die-740"><span class="linenos"> 740</span></a>
</span><span id="Die-741"><a href="#Die-741"><span class="linenos"> 741</span></a><span class="sd">        If you instead want to replace tuple (or other sequence) outcomes with</span>
</span><span id="Die-742"><a href="#Die-742"><span class="linenos"> 742</span></a><span class="sd">        their sum, use `die.map(sum)`.</span>
</span><span id="Die-743"><a href="#Die-743"><span class="linenos"> 743</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-744"><a href="#Die-744"><span class="linenos"> 744</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_cache</span><span class="p">:</span>
</span><span id="Die-745"><a href="#Die-745"><span class="linenos"> 745</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_cache</span><span class="p">[</span><span class="n">rolls</span><span class="p">]</span>
</span><span id="Die-746"><a href="#Die-746"><span class="linenos"> 746</span></a>
</span><span id="Die-747"><a href="#Die-747"><span class="linenos"> 747</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-748"><a href="#Die-748"><span class="linenos"> 748</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_all</span><span class="p">(</span><span class="o">-</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-749"><a href="#Die-749"><span class="linenos"> 749</span></a>        <span class="k">elif</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-750"><a href="#Die-750"><span class="linenos"> 750</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
</span><span id="Die-751"><a href="#Die-751"><span class="linenos"> 751</span></a>        <span class="k">elif</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die-752"><a href="#Die-752"><span class="linenos"> 752</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Die-753"><a href="#Die-753"><span class="linenos"> 753</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-754"><a href="#Die-754"><span class="linenos"> 754</span></a>            <span class="c1"># Binary split seems to perform much worse.</span>
</span><span id="Die-755"><a href="#Die-755"><span class="linenos"> 755</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_all</span><span class="p">(</span><span class="n">rolls</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Die-756"><a href="#Die-756"><span class="linenos"> 756</span></a>
</span><span id="Die-757"><a href="#Die-757"><span class="linenos"> 757</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sum_cache</span><span class="p">[</span><span class="n">rolls</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="Die-758"><a href="#Die-758"><span class="linenos"> 758</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Die-759"><a href="#Die-759"><span class="linenos"> 759</span></a>
</span><span id="Die-760"><a href="#Die-760"><span class="linenos"> 760</span></a>    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-761"><a href="#Die-761"><span class="linenos"> 761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll the left `Die`, then roll the right `Die` that many times and sum the outcomes.&quot;&quot;&quot;</span>
</span><span id="Die-762"><a href="#Die-762"><span class="linenos"> 762</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-763"><a href="#Die-763"><span class="linenos"> 763</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-764"><a href="#Die-764"><span class="linenos"> 764</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-765"><a href="#Die-765"><span class="linenos"> 765</span></a>
</span><span id="Die-766"><a href="#Die-766"><span class="linenos"> 766</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die-767"><a href="#Die-767"><span class="linenos"> 767</span></a>
</span><span id="Die-768"><a href="#Die-768"><span class="linenos"> 768</span></a>        <span class="n">max_abs_die_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()),</span>
</span><span id="Die-769"><a href="#Die-769"><span class="linenos"> 769</span></a>                                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()))</span>
</span><span id="Die-770"><a href="#Die-770"><span class="linenos"> 770</span></a>        <span class="k">for</span> <span class="n">die_count</span><span class="p">,</span> <span class="n">die_count_quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-771"><a href="#Die-771"><span class="linenos"> 771</span></a>            <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">max_abs_die_count</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">die_count</span><span class="p">))</span>
</span><span id="Die-772"><a href="#Die-772"><span class="linenos"> 772</span></a>            <span class="n">subresult</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_sum_all</span><span class="p">(</span><span class="n">die_count</span><span class="p">)</span>
</span><span id="Die-773"><a href="#Die-773"><span class="linenos"> 773</span></a>            <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">subresult_quantity</span> <span class="ow">in</span> <span class="n">subresult</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-774"><a href="#Die-774"><span class="linenos"> 774</span></a>                <span class="n">data</span><span class="p">[</span>
</span><span id="Die-775"><a href="#Die-775"><span class="linenos"> 775</span></a>                    <span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">subresult_quantity</span> <span class="o">*</span> <span class="n">die_count_quantity</span> <span class="o">*</span> <span class="n">factor</span>
</span><span id="Die-776"><a href="#Die-776"><span class="linenos"> 776</span></a>
</span><span id="Die-777"><a href="#Die-777"><span class="linenos"> 777</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-778"><a href="#Die-778"><span class="linenos"> 778</span></a>
</span><span id="Die-779"><a href="#Die-779"><span class="linenos"> 779</span></a>    <span class="k">def</span> <span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;int | Die[int]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-780"><a href="#Die-780"><span class="linenos"> 780</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll the left `Die`, then roll the right `Die` that many times and sum the outcomes.&quot;&quot;&quot;</span>
</span><span id="Die-781"><a href="#Die-781"><span class="linenos"> 781</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-782"><a href="#Die-782"><span class="linenos"> 782</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-783"><a href="#Die-783"><span class="linenos"> 783</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-784"><a href="#Die-784"><span class="linenos"> 784</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Die-785"><a href="#Die-785"><span class="linenos"> 785</span></a>
</span><span id="Die-786"><a href="#Die-786"><span class="linenos"> 786</span></a>    <span class="k">def</span> <span class="nf">pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Pool[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-787"><a href="#Die-787"><span class="linenos"> 787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a `Pool` from this `Die`.</span>
</span><span id="Die-788"><a href="#Die-788"><span class="linenos"> 788</span></a>
</span><span id="Die-789"><a href="#Die-789"><span class="linenos"> 789</span></a><span class="sd">        You might subscript the pool immediately afterwards, e.g.</span>
</span><span id="Die-790"><a href="#Die-790"><span class="linenos"> 790</span></a><span class="sd">        `d6.pool(5)[-1, ..., 1]` takes the difference between the highest and</span>
</span><span id="Die-791"><a href="#Die-791"><span class="linenos"> 791</span></a><span class="sd">        lowest of 5d6.</span>
</span><span id="Die-792"><a href="#Die-792"><span class="linenos"> 792</span></a>
</span><span id="Die-793"><a href="#Die-793"><span class="linenos"> 793</span></a><span class="sd">        Args:</span>
</span><span id="Die-794"><a href="#Die-794"><span class="linenos"> 794</span></a><span class="sd">            rolls: The number of copies of this `Die` to put in the pool.</span>
</span><span id="Die-795"><a href="#Die-795"><span class="linenos"> 795</span></a><span class="sd">                Or, a sequence of one `int` per die acting as</span>
</span><span id="Die-796"><a href="#Die-796"><span class="linenos"> 796</span></a><span class="sd">                `keep_tuple`. Note that `...` cannot be used in the</span>
</span><span id="Die-797"><a href="#Die-797"><span class="linenos"> 797</span></a><span class="sd">                argument to this method, as the argument determines the size of</span>
</span><span id="Die-798"><a href="#Die-798"><span class="linenos"> 798</span></a><span class="sd">                the pool.</span>
</span><span id="Die-799"><a href="#Die-799"><span class="linenos"> 799</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-800"><a href="#Die-800"><span class="linenos"> 800</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die-801"><a href="#Die-801"><span class="linenos"> 801</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">rolls</span><span class="p">})</span>
</span><span id="Die-802"><a href="#Die-802"><span class="linenos"> 802</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-803"><a href="#Die-803"><span class="linenos"> 803</span></a>            <span class="n">pool_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-804"><a href="#Die-804"><span class="linenos"> 804</span></a>            <span class="c1"># Haven&#39;t dealt with narrowing return type.</span>
</span><span id="Die-805"><a href="#Die-805"><span class="linenos"> 805</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">pool_size</span><span class="p">})[</span><span class="n">rolls</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-806"><a href="#Die-806"><span class="linenos"> 806</span></a>
</span><span id="Die-807"><a href="#Die-807"><span class="linenos"> 807</span></a>    <span class="nd">@overload</span>
</span><span id="Die-808"><a href="#Die-808"><span class="linenos"> 808</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-809"><a href="#Die-809"><span class="linenos"> 809</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects elements after drawing and sorting and sums them.</span>
</span><span id="Die-810"><a href="#Die-810"><span class="linenos"> 810</span></a>
</span><span id="Die-811"><a href="#Die-811"><span class="linenos"> 811</span></a><span class="sd">        Args:</span>
</span><span id="Die-812"><a href="#Die-812"><span class="linenos"> 812</span></a><span class="sd">            rolls: A sequence of `int` specifying how many times to count each</span>
</span><span id="Die-813"><a href="#Die-813"><span class="linenos"> 813</span></a><span class="sd">                element in ascending order.</span>
</span><span id="Die-814"><a href="#Die-814"><span class="linenos"> 814</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-815"><a href="#Die-815"><span class="linenos"> 815</span></a>
</span><span id="Die-816"><a href="#Die-816"><span class="linenos"> 816</span></a>    <span class="nd">@overload</span>
</span><span id="Die-817"><a href="#Die-817"><span class="linenos"> 817</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-818"><a href="#Die-818"><span class="linenos"> 818</span></a>             <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span id="Die-819"><a href="#Die-819"><span class="linenos"> 819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects elements after drawing and sorting and sums them.</span>
</span><span id="Die-820"><a href="#Die-820"><span class="linenos"> 820</span></a>
</span><span id="Die-821"><a href="#Die-821"><span class="linenos"> 821</span></a><span class="sd">        Args:</span>
</span><span id="Die-822"><a href="#Die-822"><span class="linenos"> 822</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die-823"><a href="#Die-823"><span class="linenos"> 823</span></a><span class="sd">            index: One of the following:</span>
</span><span id="Die-824"><a href="#Die-824"><span class="linenos"> 824</span></a><span class="sd">            * An `int`. This will count only the roll at the specified index.</span>
</span><span id="Die-825"><a href="#Die-825"><span class="linenos"> 825</span></a><span class="sd">            In this case, the result is a `Die` rather than a generator.</span>
</span><span id="Die-826"><a href="#Die-826"><span class="linenos"> 826</span></a><span class="sd">            * A `slice`. The selected dice are counted once each.</span>
</span><span id="Die-827"><a href="#Die-827"><span class="linenos"> 827</span></a><span class="sd">            * A sequence of one `int` for each `Die`.</span>
</span><span id="Die-828"><a href="#Die-828"><span class="linenos"> 828</span></a><span class="sd">                Each roll is counted that many times, which could be multiple or</span>
</span><span id="Die-829"><a href="#Die-829"><span class="linenos"> 829</span></a><span class="sd">                negative times.</span>
</span><span id="Die-830"><a href="#Die-830"><span class="linenos"> 830</span></a>
</span><span id="Die-831"><a href="#Die-831"><span class="linenos"> 831</span></a><span class="sd">                Up to one `...` (`Ellipsis`) may be used.</span>
</span><span id="Die-832"><a href="#Die-832"><span class="linenos"> 832</span></a><span class="sd">                `...` will be replaced with a number of zero</span>
</span><span id="Die-833"><a href="#Die-833"><span class="linenos"> 833</span></a><span class="sd">                counts depending on the `rolls`.</span>
</span><span id="Die-834"><a href="#Die-834"><span class="linenos"> 834</span></a><span class="sd">                This number may be &quot;negative&quot; if more `int`s are provided than</span>
</span><span id="Die-835"><a href="#Die-835"><span class="linenos"> 835</span></a><span class="sd">                `rolls`. Specifically:</span>
</span><span id="Die-836"><a href="#Die-836"><span class="linenos"> 836</span></a>
</span><span id="Die-837"><a href="#Die-837"><span class="linenos"> 837</span></a><span class="sd">                * If `index` is shorter than `rolls`, `...`</span>
</span><span id="Die-838"><a href="#Die-838"><span class="linenos"> 838</span></a><span class="sd">                    acts as enough zero counts to make up the difference.</span>
</span><span id="Die-839"><a href="#Die-839"><span class="linenos"> 839</span></a><span class="sd">                    E.g. `(1, ..., 1)` on five dice would act as</span>
</span><span id="Die-840"><a href="#Die-840"><span class="linenos"> 840</span></a><span class="sd">                    `(1, 0, 0, 0, 1)`.</span>
</span><span id="Die-841"><a href="#Die-841"><span class="linenos"> 841</span></a><span class="sd">                * If `index` has length equal to `rolls`, `...` has no effect.</span>
</span><span id="Die-842"><a href="#Die-842"><span class="linenos"> 842</span></a><span class="sd">                    E.g. `(1, ..., 1)` on two dice would act as `(1, 1)`.</span>
</span><span id="Die-843"><a href="#Die-843"><span class="linenos"> 843</span></a><span class="sd">                * If `index` is longer than `rolls` and `...` is on one side,</span>
</span><span id="Die-844"><a href="#Die-844"><span class="linenos"> 844</span></a><span class="sd">                    elements will be dropped from `index` on the side with `...`.</span>
</span><span id="Die-845"><a href="#Die-845"><span class="linenos"> 845</span></a><span class="sd">                    E.g. `(..., 1, 2, 3)` on two dice would act as `(2, 3)`.</span>
</span><span id="Die-846"><a href="#Die-846"><span class="linenos"> 846</span></a><span class="sd">                * If `index` is longer than `rolls` and `...`</span>
</span><span id="Die-847"><a href="#Die-847"><span class="linenos"> 847</span></a><span class="sd">                    is in the middle, the counts will be as the sum of two</span>
</span><span id="Die-848"><a href="#Die-848"><span class="linenos"> 848</span></a><span class="sd">                    one-sided `...`.</span>
</span><span id="Die-849"><a href="#Die-849"><span class="linenos"> 849</span></a><span class="sd">                    E.g. `(-1, ..., 1)` acts like `(-1, ...)` plus `(..., 1)`.</span>
</span><span id="Die-850"><a href="#Die-850"><span class="linenos"> 850</span></a><span class="sd">                    If `rolls` was 1 this would have the -1 and 1 cancel each other out.</span>
</span><span id="Die-851"><a href="#Die-851"><span class="linenos"> 851</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-852"><a href="#Die-852"><span class="linenos"> 852</span></a>
</span><span id="Die-853"><a href="#Die-853"><span class="linenos"> 853</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-854"><a href="#Die-854"><span class="linenos"> 854</span></a>             <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="Die-855"><a href="#Die-855"><span class="linenos"> 855</span></a>             <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-856"><a href="#Die-856"><span class="linenos"> 856</span></a>             <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-857"><a href="#Die-857"><span class="linenos"> 857</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects elements after drawing and sorting and sums them.</span>
</span><span id="Die-858"><a href="#Die-858"><span class="linenos"> 858</span></a>
</span><span id="Die-859"><a href="#Die-859"><span class="linenos"> 859</span></a><span class="sd">        Args:</span>
</span><span id="Die-860"><a href="#Die-860"><span class="linenos"> 860</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die-861"><a href="#Die-861"><span class="linenos"> 861</span></a><span class="sd">            index: One of the following:</span>
</span><span id="Die-862"><a href="#Die-862"><span class="linenos"> 862</span></a><span class="sd">            * An `int`. This will count only the roll at the specified index.</span>
</span><span id="Die-863"><a href="#Die-863"><span class="linenos"> 863</span></a><span class="sd">            In this case, the result is a `Die` rather than a generator.</span>
</span><span id="Die-864"><a href="#Die-864"><span class="linenos"> 864</span></a><span class="sd">            * A `slice`. The selected dice are counted once each.</span>
</span><span id="Die-865"><a href="#Die-865"><span class="linenos"> 865</span></a><span class="sd">            * A sequence of `int`s with length equal to `rolls`.</span>
</span><span id="Die-866"><a href="#Die-866"><span class="linenos"> 866</span></a><span class="sd">                Each roll is counted that many times, which could be multiple or</span>
</span><span id="Die-867"><a href="#Die-867"><span class="linenos"> 867</span></a><span class="sd">                negative times.</span>
</span><span id="Die-868"><a href="#Die-868"><span class="linenos"> 868</span></a>
</span><span id="Die-869"><a href="#Die-869"><span class="linenos"> 869</span></a><span class="sd">                Up to one `...` (`Ellipsis`) may be used. If no `...` is used,</span>
</span><span id="Die-870"><a href="#Die-870"><span class="linenos"> 870</span></a><span class="sd">                the `rolls` argument may be omitted.</span>
</span><span id="Die-871"><a href="#Die-871"><span class="linenos"> 871</span></a>
</span><span id="Die-872"><a href="#Die-872"><span class="linenos"> 872</span></a><span class="sd">                `...` will be replaced with a number of zero counts in order</span>
</span><span id="Die-873"><a href="#Die-873"><span class="linenos"> 873</span></a><span class="sd">                to make up any missing elements compared to `rolls`.</span>
</span><span id="Die-874"><a href="#Die-874"><span class="linenos"> 874</span></a><span class="sd">                This number may be &quot;negative&quot; if more `int`s are provided than</span>
</span><span id="Die-875"><a href="#Die-875"><span class="linenos"> 875</span></a><span class="sd">                `rolls`. Specifically:</span>
</span><span id="Die-876"><a href="#Die-876"><span class="linenos"> 876</span></a>
</span><span id="Die-877"><a href="#Die-877"><span class="linenos"> 877</span></a><span class="sd">                * If `index` is shorter than `rolls`, `...`</span>
</span><span id="Die-878"><a href="#Die-878"><span class="linenos"> 878</span></a><span class="sd">                    acts as enough zero counts to make up the difference.</span>
</span><span id="Die-879"><a href="#Die-879"><span class="linenos"> 879</span></a><span class="sd">                    E.g. `(1, ..., 1)` on five dice would act as</span>
</span><span id="Die-880"><a href="#Die-880"><span class="linenos"> 880</span></a><span class="sd">                    `(1, 0, 0, 0, 1)`.</span>
</span><span id="Die-881"><a href="#Die-881"><span class="linenos"> 881</span></a><span class="sd">                * If `index` has length equal to `rolls`, `...` has no effect.</span>
</span><span id="Die-882"><a href="#Die-882"><span class="linenos"> 882</span></a><span class="sd">                    E.g. `(1, ..., 1)` on two dice would act as `(1, 1)`.</span>
</span><span id="Die-883"><a href="#Die-883"><span class="linenos"> 883</span></a><span class="sd">                * If `index` is longer than `rolls` and `...` is on one side,</span>
</span><span id="Die-884"><a href="#Die-884"><span class="linenos"> 884</span></a><span class="sd">                    elements will be dropped from `index` on the side with `...`.</span>
</span><span id="Die-885"><a href="#Die-885"><span class="linenos"> 885</span></a><span class="sd">                    E.g. `(..., 1, 2, 3)` on two dice would act as `(2, 3)`.</span>
</span><span id="Die-886"><a href="#Die-886"><span class="linenos"> 886</span></a><span class="sd">                * If `index` is longer than `rolls` and `...`</span>
</span><span id="Die-887"><a href="#Die-887"><span class="linenos"> 887</span></a><span class="sd">                    is in the middle, the counts will be as the sum of two</span>
</span><span id="Die-888"><a href="#Die-888"><span class="linenos"> 888</span></a><span class="sd">                    one-sided `...`.</span>
</span><span id="Die-889"><a href="#Die-889"><span class="linenos"> 889</span></a><span class="sd">                    E.g. `(-1, ..., 1)` acts like `(-1, ...)` plus `(..., 1)`.</span>
</span><span id="Die-890"><a href="#Die-890"><span class="linenos"> 890</span></a><span class="sd">                    If `rolls` was 1 this would have the -1 and 1 cancel each other out.</span>
</span><span id="Die-891"><a href="#Die-891"><span class="linenos"> 891</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-892"><a href="#Die-892"><span class="linenos"> 892</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die-893"><a href="#Die-893"><span class="linenos"> 893</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-894"><a href="#Die-894"><span class="linenos"> 894</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-895"><a href="#Die-895"><span class="linenos"> 895</span></a>                    <span class="s1">&#39;If the number of rolls is an integer, an index argument must be provided.&#39;</span>
</span><span id="Die-896"><a href="#Die-896"><span class="linenos"> 896</span></a>                <span class="p">)</span>
</span><span id="Die-897"><a href="#Die-897"><span class="linenos"> 897</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die-898"><a href="#Die-898"><span class="linenos"> 898</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Die-899"><a href="#Die-899"><span class="linenos"> 899</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-900"><a href="#Die-900"><span class="linenos"> 900</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-901"><a href="#Die-901"><span class="linenos"> 901</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-902"><a href="#Die-902"><span class="linenos"> 902</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-903"><a href="#Die-903"><span class="linenos"> 903</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only one index sequence can be given.&#39;</span><span class="p">)</span>
</span><span id="Die-904"><a href="#Die-904"><span class="linenos"> 904</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rolls</span><span class="p">))</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-905"><a href="#Die-905"><span class="linenos"> 905</span></a>
</span><span id="Die-906"><a href="#Die-906"><span class="linenos"> 906</span></a>    <span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-907"><a href="#Die-907"><span class="linenos"> 907</span></a>               <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-908"><a href="#Die-908"><span class="linenos"> 908</span></a>               <span class="o">/</span><span class="p">,</span>
</span><span id="Die-909"><a href="#Die-909"><span class="linenos"> 909</span></a>               <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-910"><a href="#Die-910"><span class="linenos"> 910</span></a>               <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-911"><a href="#Die-911"><span class="linenos"> 911</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll several of this `Die` and return the lowest result, or the sum of some of the lowest.</span>
</span><span id="Die-912"><a href="#Die-912"><span class="linenos"> 912</span></a>
</span><span id="Die-913"><a href="#Die-913"><span class="linenos"> 913</span></a><span class="sd">        The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="Die-914"><a href="#Die-914"><span class="linenos"> 914</span></a>
</span><span id="Die-915"><a href="#Die-915"><span class="linenos"> 915</span></a><span class="sd">        Args:</span>
</span><span id="Die-916"><a href="#Die-916"><span class="linenos"> 916</span></a><span class="sd">            rolls: The number of dice to roll. All dice will have the same</span>
</span><span id="Die-917"><a href="#Die-917"><span class="linenos"> 917</span></a><span class="sd">                outcomes as `self`.</span>
</span><span id="Die-918"><a href="#Die-918"><span class="linenos"> 918</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="Die-919"><a href="#Die-919"><span class="linenos"> 919</span></a><span class="sd">                * If neither are provided, the single lowest die will be taken.</span>
</span><span id="Die-920"><a href="#Die-920"><span class="linenos"> 920</span></a><span class="sd">                * If only `keep` is provided, the `keep` lowest dice will be summed.</span>
</span><span id="Die-921"><a href="#Die-921"><span class="linenos"> 921</span></a><span class="sd">                * If only `drop` is provided, the `drop` lowest dice will be dropped</span>
</span><span id="Die-922"><a href="#Die-922"><span class="linenos"> 922</span></a><span class="sd">                    and the rest will be summed.</span>
</span><span id="Die-923"><a href="#Die-923"><span class="linenos"> 923</span></a><span class="sd">                * If both are provided, `drop` lowest dice will be dropped, then</span>
</span><span id="Die-924"><a href="#Die-924"><span class="linenos"> 924</span></a><span class="sd">                    the next `keep` lowest dice will be summed.</span>
</span><span id="Die-925"><a href="#Die-925"><span class="linenos"> 925</span></a>
</span><span id="Die-926"><a href="#Die-926"><span class="linenos"> 926</span></a><span class="sd">        Returns:</span>
</span><span id="Die-927"><a href="#Die-927"><span class="linenos"> 927</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die-928"><a href="#Die-928"><span class="linenos"> 928</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-929"><a href="#Die-929"><span class="linenos"> 929</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">lowest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="Die-930"><a href="#Die-930"><span class="linenos"> 930</span></a>        <span class="n">canonical</span> <span class="o">=</span> <span class="n">canonical_slice</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-931"><a href="#Die-931"><span class="linenos"> 931</span></a>        <span class="k">if</span> <span class="n">canonical</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">canonical</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die-932"><a href="#Die-932"><span class="linenos"> 932</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-933"><a href="#Die-933"><span class="linenos"> 933</span></a>        <span class="c1"># Expression evaluators are difficult to type.</span>
</span><span id="Die-934"><a href="#Die-934"><span class="linenos"> 934</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-935"><a href="#Die-935"><span class="linenos"> 935</span></a>
</span><span id="Die-936"><a href="#Die-936"><span class="linenos"> 936</span></a>    <span class="k">def</span> <span class="nf">_lowest_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-937"><a href="#Die-937"><span class="linenos"> 937</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll this die several times and keep the lowest.&quot;&quot;&quot;</span>
</span><span id="Die-938"><a href="#Die-938"><span class="linenos"> 938</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-939"><a href="#Die-939"><span class="linenos"> 939</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
</span><span id="Die-940"><a href="#Die-940"><span class="linenos"> 940</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">from_cumulative</span><span class="p">(</span>
</span><span id="Die-941"><a href="#Die-941"><span class="linenos"> 941</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="n">rolls</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&gt;=&#39;</span><span class="p">)],</span>
</span><span id="Die-942"><a href="#Die-942"><span class="linenos"> 942</span></a>            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Die-943"><a href="#Die-943"><span class="linenos"> 943</span></a>
</span><span id="Die-944"><a href="#Die-944"><span class="linenos"> 944</span></a>    <span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-945"><a href="#Die-945"><span class="linenos"> 945</span></a>                <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-946"><a href="#Die-946"><span class="linenos"> 946</span></a>                <span class="o">/</span><span class="p">,</span>
</span><span id="Die-947"><a href="#Die-947"><span class="linenos"> 947</span></a>                <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-948"><a href="#Die-948"><span class="linenos"> 948</span></a>                <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-949"><a href="#Die-949"><span class="linenos"> 949</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll several of this `Die` and return the highest result, or the sum of some of the highest.</span>
</span><span id="Die-950"><a href="#Die-950"><span class="linenos"> 950</span></a>
</span><span id="Die-951"><a href="#Die-951"><span class="linenos"> 951</span></a><span class="sd">        The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="Die-952"><a href="#Die-952"><span class="linenos"> 952</span></a>
</span><span id="Die-953"><a href="#Die-953"><span class="linenos"> 953</span></a><span class="sd">        Args:</span>
</span><span id="Die-954"><a href="#Die-954"><span class="linenos"> 954</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die-955"><a href="#Die-955"><span class="linenos"> 955</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="Die-956"><a href="#Die-956"><span class="linenos"> 956</span></a><span class="sd">                * If neither are provided, the single highest die will be taken.</span>
</span><span id="Die-957"><a href="#Die-957"><span class="linenos"> 957</span></a><span class="sd">                * If only `keep` is provided, the `keep` highest dice will be summed.</span>
</span><span id="Die-958"><a href="#Die-958"><span class="linenos"> 958</span></a><span class="sd">                * If only `drop` is provided, the `drop` highest dice will be dropped</span>
</span><span id="Die-959"><a href="#Die-959"><span class="linenos"> 959</span></a><span class="sd">                    and the rest will be summed.</span>
</span><span id="Die-960"><a href="#Die-960"><span class="linenos"> 960</span></a><span class="sd">                * If both are provided, `drop` highest dice will be dropped, then</span>
</span><span id="Die-961"><a href="#Die-961"><span class="linenos"> 961</span></a><span class="sd">                    the next `keep` highest dice will be summed.</span>
</span><span id="Die-962"><a href="#Die-962"><span class="linenos"> 962</span></a>
</span><span id="Die-963"><a href="#Die-963"><span class="linenos"> 963</span></a><span class="sd">        Returns:</span>
</span><span id="Die-964"><a href="#Die-964"><span class="linenos"> 964</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die-965"><a href="#Die-965"><span class="linenos"> 965</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-966"><a href="#Die-966"><span class="linenos"> 966</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">highest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="Die-967"><a href="#Die-967"><span class="linenos"> 967</span></a>        <span class="n">canonical</span> <span class="o">=</span> <span class="n">canonical_slice</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-968"><a href="#Die-968"><span class="linenos"> 968</span></a>        <span class="k">if</span> <span class="n">canonical</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">rolls</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">canonical</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="n">rolls</span><span class="p">:</span>
</span><span id="Die-969"><a href="#Die-969"><span class="linenos"> 969</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-970"><a href="#Die-970"><span class="linenos"> 970</span></a>        <span class="c1"># Expression evaluators are difficult to type.</span>
</span><span id="Die-971"><a href="#Die-971"><span class="linenos"> 971</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-972"><a href="#Die-972"><span class="linenos"> 972</span></a>
</span><span id="Die-973"><a href="#Die-973"><span class="linenos"> 973</span></a>    <span class="k">def</span> <span class="nf">_highest_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-974"><a href="#Die-974"><span class="linenos"> 974</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll this die several times and keep the highest.&quot;&quot;&quot;</span>
</span><span id="Die-975"><a href="#Die-975"><span class="linenos"> 975</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-976"><a href="#Die-976"><span class="linenos"> 976</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
</span><span id="Die-977"><a href="#Die-977"><span class="linenos"> 977</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">from_cumulative</span><span class="p">(</span>
</span><span id="Die-978"><a href="#Die-978"><span class="linenos"> 978</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="n">rolls</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">)])</span>
</span><span id="Die-979"><a href="#Die-979"><span class="linenos"> 979</span></a>
</span><span id="Die-980"><a href="#Die-980"><span class="linenos"> 980</span></a>    <span class="k">def</span> <span class="nf">middle</span><span class="p">(</span>
</span><span id="Die-981"><a href="#Die-981"><span class="linenos"> 981</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-982"><a href="#Die-982"><span class="linenos"> 982</span></a>            <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-983"><a href="#Die-983"><span class="linenos"> 983</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die-984"><a href="#Die-984"><span class="linenos"> 984</span></a>            <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-985"><a href="#Die-985"><span class="linenos"> 985</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="Die-986"><a href="#Die-986"><span class="linenos"> 986</span></a>            <span class="n">tie</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="Die-987"><a href="#Die-987"><span class="linenos"> 987</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll several of this `Die` and sum the sorted results in the middle.</span>
</span><span id="Die-988"><a href="#Die-988"><span class="linenos"> 988</span></a>
</span><span id="Die-989"><a href="#Die-989"><span class="linenos"> 989</span></a><span class="sd">        The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="Die-990"><a href="#Die-990"><span class="linenos"> 990</span></a>
</span><span id="Die-991"><a href="#Die-991"><span class="linenos"> 991</span></a><span class="sd">        Args:</span>
</span><span id="Die-992"><a href="#Die-992"><span class="linenos"> 992</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die-993"><a href="#Die-993"><span class="linenos"> 993</span></a><span class="sd">            keep: The number of outcomes to sum. If this is greater than the</span>
</span><span id="Die-994"><a href="#Die-994"><span class="linenos"> 994</span></a><span class="sd">                current keep_size, all are kept.</span>
</span><span id="Die-995"><a href="#Die-995"><span class="linenos"> 995</span></a><span class="sd">            tie: What to do if `keep` is odd but the current keep_size</span>
</span><span id="Die-996"><a href="#Die-996"><span class="linenos"> 996</span></a><span class="sd">                is even, or vice versa.</span>
</span><span id="Die-997"><a href="#Die-997"><span class="linenos"> 997</span></a><span class="sd">                * &#39;error&#39; (default): Raises `IndexError`.</span>
</span><span id="Die-998"><a href="#Die-998"><span class="linenos"> 998</span></a><span class="sd">                * &#39;high&#39;: The higher outcome is taken.</span>
</span><span id="Die-999"><a href="#Die-999"><span class="linenos"> 999</span></a><span class="sd">                * &#39;low&#39;: The lower outcome is taken.</span>
</span><span id="Die-1000"><a href="#Die-1000"><span class="linenos">1000</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1001"><a href="#Die-1001"><span class="linenos">1001</span></a>        <span class="c1"># Expression evaluators are difficult to type.</span>
</span><span id="Die-1002"><a href="#Die-1002"><span class="linenos">1002</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">middle</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">tie</span><span class="o">=</span><span class="n">tie</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-1003"><a href="#Die-1003"><span class="linenos">1003</span></a>
</span><span id="Die-1004"><a href="#Die-1004"><span class="linenos">1004</span></a>    <span class="k">def</span> <span class="nf">map_to_pool</span><span class="p">(</span>
</span><span id="Die-1005"><a href="#Die-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-1006"><a href="#Die-1006"><span class="linenos">1006</span></a>        <span class="n">repl</span><span class="p">:</span>
</span><span id="Die-1007"><a href="#Die-1007"><span class="linenos">1007</span></a>        <span class="s1">&#39;Callable[..., Sequence[icepool.Die[U] | U] | Mapping[icepool.Die[U], int] | Mapping[U, int] | icepool.Reroll] | None&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-1008"><a href="#Die-1008"><span class="linenos">1008</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="Die-1009"><a href="#Die-1009"><span class="linenos">1009</span></a>        <span class="o">*</span><span class="n">extra_args</span><span class="p">:</span> <span class="s1">&#39;Outcome | icepool.Die | icepool.MultisetExpression&#39;</span><span class="p">,</span>
</span><span id="Die-1010"><a href="#Die-1010"><span class="linenos">1010</span></a>        <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-1011"><a href="#Die-1011"><span class="linenos">1011</span></a>        <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-1012"><a href="#Die-1012"><span class="linenos">1012</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultisetGenerator[U, tuple[int]]&#39;</span><span class="p">:</span>
</span><span id="Die-1013"><a href="#Die-1013"><span class="linenos">1013</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Maps outcomes of this `Die` to `Pools`, creating a `MultisetGenerator`.</span>
</span><span id="Die-1014"><a href="#Die-1014"><span class="linenos">1014</span></a>
</span><span id="Die-1015"><a href="#Die-1015"><span class="linenos">1015</span></a><span class="sd">        As `icepool.map_to_pool(repl, self, ...)`.</span>
</span><span id="Die-1016"><a href="#Die-1016"><span class="linenos">1016</span></a>
</span><span id="Die-1017"><a href="#Die-1017"><span class="linenos">1017</span></a><span class="sd">        If no argument is provided, the outcomes will be used to construct a</span>
</span><span id="Die-1018"><a href="#Die-1018"><span class="linenos">1018</span></a><span class="sd">        mixture of pools directly, similar to the inverse of `pool.expand()`.</span>
</span><span id="Die-1019"><a href="#Die-1019"><span class="linenos">1019</span></a><span class="sd">        Note that this is not particularly efficient since it does not make much</span>
</span><span id="Die-1020"><a href="#Die-1020"><span class="linenos">1020</span></a><span class="sd">        use of dynamic programming.</span>
</span><span id="Die-1021"><a href="#Die-1021"><span class="linenos">1021</span></a>
</span><span id="Die-1022"><a href="#Die-1022"><span class="linenos">1022</span></a><span class="sd">        Args:</span>
</span><span id="Die-1023"><a href="#Die-1023"><span class="linenos">1023</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Die-1024"><a href="#Die-1024"><span class="linenos">1024</span></a><span class="sd">                * A callable that takes in one outcome per element of args and</span>
</span><span id="Die-1025"><a href="#Die-1025"><span class="linenos">1025</span></a><span class="sd">                    produces a `Pool` (or something convertible to such).</span>
</span><span id="Die-1026"><a href="#Die-1026"><span class="linenos">1026</span></a><span class="sd">                * A mapping from old outcomes to `Pool` </span>
</span><span id="Die-1027"><a href="#Die-1027"><span class="linenos">1027</span></a><span class="sd">                    (or something convertible to such).</span>
</span><span id="Die-1028"><a href="#Die-1028"><span class="linenos">1028</span></a><span class="sd">                    In this case args must have exactly one element.</span>
</span><span id="Die-1029"><a href="#Die-1029"><span class="linenos">1029</span></a><span class="sd">                The new outcomes may be dice rather than just single outcomes.</span>
</span><span id="Die-1030"><a href="#Die-1030"><span class="linenos">1030</span></a><span class="sd">                The special value `icepool.Reroll` will reroll that old outcome.</span>
</span><span id="Die-1031"><a href="#Die-1031"><span class="linenos">1031</span></a><span class="sd">            star: If `True`, the first of the args will be unpacked before </span>
</span><span id="Die-1032"><a href="#Die-1032"><span class="linenos">1032</span></a><span class="sd">                giving them to `repl`.</span>
</span><span id="Die-1033"><a href="#Die-1033"><span class="linenos">1033</span></a><span class="sd">                If not provided, it will be guessed based on the signature of </span>
</span><span id="Die-1034"><a href="#Die-1034"><span class="linenos">1034</span></a><span class="sd">                `repl` and the number of arguments.</span>
</span><span id="Die-1035"><a href="#Die-1035"><span class="linenos">1035</span></a><span class="sd">            denominator: If provided, the denominator of the result will be this</span>
</span><span id="Die-1036"><a href="#Die-1036"><span class="linenos">1036</span></a><span class="sd">                value. Otherwise it will be the minimum to correctly weight the</span>
</span><span id="Die-1037"><a href="#Die-1037"><span class="linenos">1037</span></a><span class="sd">                pools.</span>
</span><span id="Die-1038"><a href="#Die-1038"><span class="linenos">1038</span></a>
</span><span id="Die-1039"><a href="#Die-1039"><span class="linenos">1039</span></a><span class="sd">        Returns:</span>
</span><span id="Die-1040"><a href="#Die-1040"><span class="linenos">1040</span></a><span class="sd">            A `MultisetGenerator` representing the mixture of `Pool`s. Note  </span>
</span><span id="Die-1041"><a href="#Die-1041"><span class="linenos">1041</span></a><span class="sd">            that this is not technically a `Pool`, though it supports most of </span>
</span><span id="Die-1042"><a href="#Die-1042"><span class="linenos">1042</span></a><span class="sd">            the same operations.</span>
</span><span id="Die-1043"><a href="#Die-1043"><span class="linenos">1043</span></a>
</span><span id="Die-1044"><a href="#Die-1044"><span class="linenos">1044</span></a><span class="sd">        Raises:</span>
</span><span id="Die-1045"><a href="#Die-1045"><span class="linenos">1045</span></a><span class="sd">            ValueError: If `denominator` cannot be made consistent with the </span>
</span><span id="Die-1046"><a href="#Die-1046"><span class="linenos">1046</span></a><span class="sd">                resulting mixture of pools.</span>
</span><span id="Die-1047"><a href="#Die-1047"><span class="linenos">1047</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1048"><a href="#Die-1048"><span class="linenos">1048</span></a>        <span class="k">if</span> <span class="n">repl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-1049"><a href="#Die-1049"><span class="linenos">1049</span></a>            <span class="n">repl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="Die-1050"><a href="#Die-1050"><span class="linenos">1050</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map_to_pool</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span>
</span><span id="Die-1051"><a href="#Die-1051"><span class="linenos">1051</span></a>                                   <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-1052"><a href="#Die-1052"><span class="linenos">1052</span></a>                                   <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-1053"><a href="#Die-1053"><span class="linenos">1053</span></a>                                   <span class="n">star</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
</span><span id="Die-1054"><a href="#Die-1054"><span class="linenos">1054</span></a>                                   <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">)</span>
</span><span id="Die-1055"><a href="#Die-1055"><span class="linenos">1055</span></a>
</span><span id="Die-1056"><a href="#Die-1056"><span class="linenos">1056</span></a>    <span class="k">def</span> <span class="nf">explode_to_pool</span><span class="p">(</span>
</span><span id="Die-1057"><a href="#Die-1057"><span class="linenos">1057</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-1058"><a href="#Die-1058"><span class="linenos">1058</span></a>            <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-1059"><a href="#Die-1059"><span class="linenos">1059</span></a>            <span class="n">which</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-1060"><a href="#Die-1060"><span class="linenos">1060</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die-1061"><a href="#Die-1061"><span class="linenos">1061</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="Die-1062"><a href="#Die-1062"><span class="linenos">1062</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-1063"><a href="#Die-1063"><span class="linenos">1063</span></a>            <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultisetGenerator[T_co, tuple[int]]&#39;</span><span class="p">:</span>
</span><span id="Die-1064"><a href="#Die-1064"><span class="linenos">1064</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Causes outcomes to be rolled again, keeping that outcome as an individual die in a pool.</span>
</span><span id="Die-1065"><a href="#Die-1065"><span class="linenos">1065</span></a><span class="sd">        </span>
</span><span id="Die-1066"><a href="#Die-1066"><span class="linenos">1066</span></a><span class="sd">        Args:</span>
</span><span id="Die-1067"><a href="#Die-1067"><span class="linenos">1067</span></a><span class="sd">            rolls: The number of initial dice.</span>
</span><span id="Die-1068"><a href="#Die-1068"><span class="linenos">1068</span></a><span class="sd">            which: Which outcomes to explode. Options:</span>
</span><span id="Die-1069"><a href="#Die-1069"><span class="linenos">1069</span></a><span class="sd">                * A single outcome to explode.</span>
</span><span id="Die-1070"><a href="#Die-1070"><span class="linenos">1070</span></a><span class="sd">                * An collection of outcomes to explode.</span>
</span><span id="Die-1071"><a href="#Die-1071"><span class="linenos">1071</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-1072"><a href="#Die-1072"><span class="linenos">1072</span></a><span class="sd">                    should be exploded.</span>
</span><span id="Die-1073"><a href="#Die-1073"><span class="linenos">1073</span></a><span class="sd">                * If not supplied, the max outcome will explode.</span>
</span><span id="Die-1074"><a href="#Die-1074"><span class="linenos">1074</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die-1075"><a href="#Die-1075"><span class="linenos">1075</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die-1076"><a href="#Die-1076"><span class="linenos">1076</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die-1077"><a href="#Die-1077"><span class="linenos">1077</span></a><span class="sd">                signature.</span>
</span><span id="Die-1078"><a href="#Die-1078"><span class="linenos">1078</span></a><span class="sd">            depth: The maximum depth of explosions for an individual dice.</span>
</span><span id="Die-1079"><a href="#Die-1079"><span class="linenos">1079</span></a>
</span><span id="Die-1080"><a href="#Die-1080"><span class="linenos">1080</span></a><span class="sd">        Returns:</span>
</span><span id="Die-1081"><a href="#Die-1081"><span class="linenos">1081</span></a><span class="sd">            A `MultisetGenerator` representing the mixture of `Pool`s. Note  </span>
</span><span id="Die-1082"><a href="#Die-1082"><span class="linenos">1082</span></a><span class="sd">            that this is not technically a `Pool`, though it supports most of </span>
</span><span id="Die-1083"><a href="#Die-1083"><span class="linenos">1083</span></a><span class="sd">            the same operations.</span>
</span><span id="Die-1084"><a href="#Die-1084"><span class="linenos">1084</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1085"><a href="#Die-1085"><span class="linenos">1085</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-1086"><a href="#Die-1086"><span class="linenos">1086</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-1087"><a href="#Die-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-1088"><a href="#Die-1088"><span class="linenos">1088</span></a>            <span class="n">explode_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()}</span>
</span><span id="Die-1089"><a href="#Die-1089"><span class="linenos">1089</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1090"><a href="#Die-1090"><span class="linenos">1090</span></a>            <span class="n">explode_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die-1091"><a href="#Die-1091"><span class="linenos">1091</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">explode_set</span><span class="p">:</span>
</span><span id="Die-1092"><a href="#Die-1092"><span class="linenos">1092</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-1093"><a href="#Die-1093"><span class="linenos">1093</span></a>        <span class="n">explode</span><span class="p">,</span> <span class="n">not_explode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">explode_set</span><span class="p">)</span>
</span><span id="Die-1094"><a href="#Die-1094"><span class="linenos">1094</span></a>
</span><span id="Die-1095"><a href="#Die-1095"><span class="linenos">1095</span></a>        <span class="n">single_data</span><span class="p">:</span> <span class="s1">&#39;MutableMapping[icepool.Vector[int], int]&#39;</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
</span><span id="Die-1096"><a href="#Die-1096"><span class="linenos">1096</span></a>            <span class="nb">int</span><span class="p">)</span>
</span><span id="Die-1097"><a href="#Die-1097"><span class="linenos">1097</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Die-1098"><a href="#Die-1098"><span class="linenos">1098</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="n">explode</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span>
</span><span id="Die-1099"><a href="#Die-1099"><span class="linenos">1099</span></a>                <span class="n">depth</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">not_explode</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Die-1100"><a href="#Die-1100"><span class="linenos">1100</span></a>            <span class="n">single_data</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">Vector</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]</span> <span class="o">+=</span> <span class="n">weight</span>
</span><span id="Die-1101"><a href="#Die-1101"><span class="linenos">1101</span></a>        <span class="n">single_data</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span>
</span><span id="Die-1102"><a href="#Die-1102"><span class="linenos">1102</span></a>            <span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))]</span> <span class="o">+=</span> <span class="n">explode</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Die-1103"><a href="#Die-1103"><span class="linenos">1103</span></a>
</span><span id="Die-1104"><a href="#Die-1104"><span class="linenos">1104</span></a>        <span class="n">single_count_die</span><span class="p">:</span> <span class="s1">&#39;Die[icepool.Vector[int]]&#39;</span> <span class="o">=</span> <span class="n">Die</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>
</span><span id="Die-1105"><a href="#Die-1105"><span class="linenos">1105</span></a>        <span class="n">count_die</span> <span class="o">=</span> <span class="n">rolls</span> <span class="o">@</span> <span class="n">single_count_die</span>
</span><span id="Die-1106"><a href="#Die-1106"><span class="linenos">1106</span></a>
</span><span id="Die-1107"><a href="#Die-1107"><span class="linenos">1107</span></a>        <span class="k">return</span> <span class="n">count_die</span><span class="o">.</span><span class="n">map_to_pool</span><span class="p">(</span>
</span><span id="Die-1108"><a href="#Die-1108"><span class="linenos">1108</span></a>            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">nx</span><span class="p">:</span> <span class="p">[</span><span class="n">explode</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">not_explode</span><span class="p">]</span> <span class="o">*</span> <span class="n">nx</span><span class="p">)</span>
</span><span id="Die-1109"><a href="#Die-1109"><span class="linenos">1109</span></a>
</span><span id="Die-1110"><a href="#Die-1110"><span class="linenos">1110</span></a>    <span class="k">def</span> <span class="nf">reroll_to_pool</span><span class="p">(</span>
</span><span id="Die-1111"><a href="#Die-1111"><span class="linenos">1111</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die-1112"><a href="#Die-1112"><span class="linenos">1112</span></a>        <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-1113"><a href="#Die-1113"><span class="linenos">1113</span></a>        <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
</span><span id="Die-1114"><a href="#Die-1114"><span class="linenos">1114</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="Die-1115"><a href="#Die-1115"><span class="linenos">1115</span></a>        <span class="n">max_rerolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-1116"><a href="#Die-1116"><span class="linenos">1116</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="Die-1117"><a href="#Die-1117"><span class="linenos">1117</span></a>        <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-1118"><a href="#Die-1118"><span class="linenos">1118</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="s1">&#39;lowest&#39;</span><span class="p">,</span> <span class="s1">&#39;highest&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span>
</span><span id="Die-1119"><a href="#Die-1119"><span class="linenos">1119</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultisetGenerator[T_co, tuple[int]]&#39;</span><span class="p">:</span>
</span><span id="Die-1120"><a href="#Die-1120"><span class="linenos">1120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Applies a limited number of rerolls shared across a pool.</span>
</span><span id="Die-1121"><a href="#Die-1121"><span class="linenos">1121</span></a>
</span><span id="Die-1122"><a href="#Die-1122"><span class="linenos">1122</span></a><span class="sd">        Each die can only be rerolled once (effectively `depth=1`), and no more</span>
</span><span id="Die-1123"><a href="#Die-1123"><span class="linenos">1123</span></a><span class="sd">        than `max_rerolls` dice may be rerolled.</span>
</span><span id="Die-1124"><a href="#Die-1124"><span class="linenos">1124</span></a><span class="sd">        </span>
</span><span id="Die-1125"><a href="#Die-1125"><span class="linenos">1125</span></a><span class="sd">        Args:</span>
</span><span id="Die-1126"><a href="#Die-1126"><span class="linenos">1126</span></a><span class="sd">            rolls: How many dice in the pool.</span>
</span><span id="Die-1127"><a href="#Die-1127"><span class="linenos">1127</span></a><span class="sd">            which: Selects which outcomes are eligible to be rerolled. Options:</span>
</span><span id="Die-1128"><a href="#Die-1128"><span class="linenos">1128</span></a><span class="sd">                * A collection of outcomes to reroll.</span>
</span><span id="Die-1129"><a href="#Die-1129"><span class="linenos">1129</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-1130"><a href="#Die-1130"><span class="linenos">1130</span></a><span class="sd">                    could be rerolled.</span>
</span><span id="Die-1131"><a href="#Die-1131"><span class="linenos">1131</span></a><span class="sd">            max_rerolls: The maximum number of dice to reroll. </span>
</span><span id="Die-1132"><a href="#Die-1132"><span class="linenos">1132</span></a><span class="sd">                Note that each die can only be rerolled once, so if the number </span>
</span><span id="Die-1133"><a href="#Die-1133"><span class="linenos">1133</span></a><span class="sd">                of eligible dice is less than this, the excess rerolls have no</span>
</span><span id="Die-1134"><a href="#Die-1134"><span class="linenos">1134</span></a><span class="sd">                effect.</span>
</span><span id="Die-1135"><a href="#Die-1135"><span class="linenos">1135</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die-1136"><a href="#Die-1136"><span class="linenos">1136</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die-1137"><a href="#Die-1137"><span class="linenos">1137</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die-1138"><a href="#Die-1138"><span class="linenos">1138</span></a><span class="sd">                signature.</span>
</span><span id="Die-1139"><a href="#Die-1139"><span class="linenos">1139</span></a><span class="sd">            mode: How dice are selected for rerolling if there are more eligible</span>
</span><span id="Die-1140"><a href="#Die-1140"><span class="linenos">1140</span></a><span class="sd">                dice than `max_rerolls`. Options:</span>
</span><span id="Die-1141"><a href="#Die-1141"><span class="linenos">1141</span></a><span class="sd">                * `&#39;random&#39;` (default): Eligible dice will be chosen uniformly</span>
</span><span id="Die-1142"><a href="#Die-1142"><span class="linenos">1142</span></a><span class="sd">                    at random.</span>
</span><span id="Die-1143"><a href="#Die-1143"><span class="linenos">1143</span></a><span class="sd">                * `&#39;lowest&#39;`: The lowest eligible dice will be rerolled.</span>
</span><span id="Die-1144"><a href="#Die-1144"><span class="linenos">1144</span></a><span class="sd">                * `&#39;highest&#39;`: The highest eligible dice will be rerolled.</span>
</span><span id="Die-1145"><a href="#Die-1145"><span class="linenos">1145</span></a><span class="sd">                * `&#39;drop&#39;`: All dice that ended up on an outcome selected by </span>
</span><span id="Die-1146"><a href="#Die-1146"><span class="linenos">1146</span></a><span class="sd">                    `which` will be dropped. This includes both dice that rolled</span>
</span><span id="Die-1147"><a href="#Die-1147"><span class="linenos">1147</span></a><span class="sd">                    into `which` initially and were not rerolled, and dice that</span>
</span><span id="Die-1148"><a href="#Die-1148"><span class="linenos">1148</span></a><span class="sd">                    were rerolled but rolled into `which` again. This can be</span>
</span><span id="Die-1149"><a href="#Die-1149"><span class="linenos">1149</span></a><span class="sd">                    considerably more efficient than the other modes.</span>
</span><span id="Die-1150"><a href="#Die-1150"><span class="linenos">1150</span></a>
</span><span id="Die-1151"><a href="#Die-1151"><span class="linenos">1151</span></a><span class="sd">        Returns:</span>
</span><span id="Die-1152"><a href="#Die-1152"><span class="linenos">1152</span></a><span class="sd">            A `MultisetGenerator` representing the mixture of `Pool`s. Note  </span>
</span><span id="Die-1153"><a href="#Die-1153"><span class="linenos">1153</span></a><span class="sd">            that this is not technically a `Pool`, though it supports most of </span>
</span><span id="Die-1154"><a href="#Die-1154"><span class="linenos">1154</span></a><span class="sd">            the same operations.</span>
</span><span id="Die-1155"><a href="#Die-1155"><span class="linenos">1155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1156"><a href="#Die-1156"><span class="linenos">1156</span></a>        <span class="n">rerollable_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die-1157"><a href="#Die-1157"><span class="linenos">1157</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">rerollable_set</span><span class="p">:</span>
</span><span id="Die-1158"><a href="#Die-1158"><span class="linenos">1158</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-1159"><a href="#Die-1159"><span class="linenos">1159</span></a>
</span><span id="Die-1160"><a href="#Die-1160"><span class="linenos">1160</span></a>        <span class="n">rerollable_die</span><span class="p">,</span> <span class="n">not_rerollable_die</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rerollable_set</span><span class="p">)</span>
</span><span id="Die-1161"><a href="#Die-1161"><span class="linenos">1161</span></a>        <span class="n">single_is_rerollable</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">coin</span><span class="p">(</span><span class="n">rerollable_die</span><span class="o">.</span><span class="n">denominator</span><span class="p">(),</span>
</span><span id="Die-1162"><a href="#Die-1162"><span class="linenos">1162</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Die-1163"><a href="#Die-1163"><span class="linenos">1163</span></a>        <span class="n">rerollable</span> <span class="o">=</span> <span class="n">rolls</span> <span class="o">@</span> <span class="n">single_is_rerollable</span>
</span><span id="Die-1164"><a href="#Die-1164"><span class="linenos">1164</span></a>
</span><span id="Die-1165"><a href="#Die-1165"><span class="linenos">1165</span></a>        <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Die</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="Die-1166"><a href="#Die-1166"><span class="linenos">1166</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Computes the composition of the pool.</span>
</span><span id="Die-1167"><a href="#Die-1167"><span class="linenos">1167</span></a>
</span><span id="Die-1168"><a href="#Die-1168"><span class="linenos">1168</span></a><span class="sd">            Returns:</span>
</span><span id="Die-1169"><a href="#Die-1169"><span class="linenos">1169</span></a><span class="sd">                initial_rerollable: The number of dice that initially fell into</span>
</span><span id="Die-1170"><a href="#Die-1170"><span class="linenos">1170</span></a><span class="sd">                    the rerollable set.</span>
</span><span id="Die-1171"><a href="#Die-1171"><span class="linenos">1171</span></a><span class="sd">                rerolled_to_rerollable: The number of dice that were rerolled,</span>
</span><span id="Die-1172"><a href="#Die-1172"><span class="linenos">1172</span></a><span class="sd">                    but fell into the rerollable set again.</span>
</span><span id="Die-1173"><a href="#Die-1173"><span class="linenos">1173</span></a><span class="sd">                not_rerollable: The number of dice that ended up outside the</span>
</span><span id="Die-1174"><a href="#Die-1174"><span class="linenos">1174</span></a><span class="sd">                    rerollable set, including both initial and rerolled dice.</span>
</span><span id="Die-1175"><a href="#Die-1175"><span class="linenos">1175</span></a><span class="sd">                not_rerolled: The number of dice that were eligible for</span>
</span><span id="Die-1176"><a href="#Die-1176"><span class="linenos">1176</span></a><span class="sd">                    rerolling but were not rerolled.</span>
</span><span id="Die-1177"><a href="#Die-1177"><span class="linenos">1177</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Die-1178"><a href="#Die-1178"><span class="linenos">1178</span></a>            <span class="n">initial_not_rerollable</span> <span class="o">=</span> <span class="n">rolls</span> <span class="o">-</span> <span class="n">initial_rerollable</span>
</span><span id="Die-1179"><a href="#Die-1179"><span class="linenos">1179</span></a>            <span class="n">rerolled</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">,</span> <span class="n">max_rerolls</span><span class="p">)</span>
</span><span id="Die-1180"><a href="#Die-1180"><span class="linenos">1180</span></a>            <span class="n">not_rerolled</span> <span class="o">=</span> <span class="n">initial_rerollable</span> <span class="o">-</span> <span class="n">rerolled</span>
</span><span id="Die-1181"><a href="#Die-1181"><span class="linenos">1181</span></a>
</span><span id="Die-1182"><a href="#Die-1182"><span class="linenos">1182</span></a>            <span class="k">def</span> <span class="nf">second_split</span><span class="p">(</span><span class="n">rerolled_to_rerollable</span><span class="p">):</span>
</span><span id="Die-1183"><a href="#Die-1183"><span class="linenos">1183</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Splits the rerolled dice into those that fell into the rerollable and not-rerollable sets.&quot;&quot;&quot;</span>
</span><span id="Die-1184"><a href="#Die-1184"><span class="linenos">1184</span></a>                <span class="n">rerolled_to_not_rerollable</span> <span class="o">=</span> <span class="n">rerolled</span> <span class="o">-</span> <span class="n">rerolled_to_rerollable</span>
</span><span id="Die-1185"><a href="#Die-1185"><span class="linenos">1185</span></a>                <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">tupleize</span><span class="p">(</span>
</span><span id="Die-1186"><a href="#Die-1186"><span class="linenos">1186</span></a>                    <span class="n">initial_rerollable</span><span class="p">,</span> <span class="n">rerolled_to_rerollable</span><span class="p">,</span>
</span><span id="Die-1187"><a href="#Die-1187"><span class="linenos">1187</span></a>                    <span class="n">initial_not_rerollable</span> <span class="o">+</span> <span class="n">rerolled_to_not_rerollable</span><span class="p">,</span>
</span><span id="Die-1188"><a href="#Die-1188"><span class="linenos">1188</span></a>                    <span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die-1189"><a href="#Die-1189"><span class="linenos">1189</span></a>
</span><span id="Die-1190"><a href="#Die-1190"><span class="linenos">1190</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">second_split</span><span class="p">,</span>
</span><span id="Die-1191"><a href="#Die-1191"><span class="linenos">1191</span></a>                               <span class="n">rerolled</span> <span class="o">@</span> <span class="n">single_is_rerollable</span><span class="p">,</span>
</span><span id="Die-1192"><a href="#Die-1192"><span class="linenos">1192</span></a>                               <span class="n">star</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Die-1193"><a href="#Die-1193"><span class="linenos">1193</span></a>
</span><span id="Die-1194"><a href="#Die-1194"><span class="linenos">1194</span></a>        <span class="n">pool_composition</span> <span class="o">=</span> <span class="n">rerollable</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">star</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Die-1195"><a href="#Die-1195"><span class="linenos">1195</span></a>
</span><span id="Die-1196"><a href="#Die-1196"><span class="linenos">1196</span></a>        <span class="k">def</span> <span class="nf">make_pool</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">,</span> <span class="n">rerolled_to_rerollable</span><span class="p">,</span>
</span><span id="Die-1197"><a href="#Die-1197"><span class="linenos">1197</span></a>                      <span class="n">not_rerollable</span><span class="p">,</span> <span class="n">not_rerolled</span><span class="p">):</span>
</span><span id="Die-1198"><a href="#Die-1198"><span class="linenos">1198</span></a>            <span class="n">common</span> <span class="o">=</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span>
</span><span id="Die-1199"><a href="#Die-1199"><span class="linenos">1199</span></a>                <span class="n">rerolled_to_rerollable</span><span class="p">)</span> <span class="o">+</span> <span class="n">not_rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span>
</span><span id="Die-1200"><a href="#Die-1200"><span class="linenos">1200</span></a>                    <span class="n">not_rerollable</span><span class="p">)</span>
</span><span id="Die-1201"><a href="#Die-1201"><span class="linenos">1201</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
</span><span id="Die-1202"><a href="#Die-1202"><span class="linenos">1202</span></a>                <span class="k">return</span> <span class="n">common</span> <span class="o">+</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die-1203"><a href="#Die-1203"><span class="linenos">1203</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;lowest&#39;</span><span class="p">:</span>
</span><span id="Die-1204"><a href="#Die-1204"><span class="linenos">1204</span></a>                <span class="k">return</span> <span class="n">common</span> <span class="o">+</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span>
</span><span id="Die-1205"><a href="#Die-1205"><span class="linenos">1205</span></a>                    <span class="n">initial_rerollable</span><span class="p">)</span><span class="o">.</span><span class="n">highest</span><span class="p">(</span><span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die-1206"><a href="#Die-1206"><span class="linenos">1206</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;highest&#39;</span><span class="p">:</span>
</span><span id="Die-1207"><a href="#Die-1207"><span class="linenos">1207</span></a>                <span class="k">return</span> <span class="n">common</span> <span class="o">+</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">)</span><span class="o">.</span><span class="n">lowest</span><span class="p">(</span>
</span><span id="Die-1208"><a href="#Die-1208"><span class="linenos">1208</span></a>                    <span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die-1209"><a href="#Die-1209"><span class="linenos">1209</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;drop&#39;</span><span class="p">:</span>
</span><span id="Die-1210"><a href="#Die-1210"><span class="linenos">1210</span></a>                <span class="k">return</span> <span class="n">not_rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">not_rerollable</span><span class="p">)</span>
</span><span id="Die-1211"><a href="#Die-1211"><span class="linenos">1211</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1212"><a href="#Die-1212"><span class="linenos">1212</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-1213"><a href="#Die-1213"><span class="linenos">1213</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid reroll_priority &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;. Allowed values are &#39;random&#39;, &#39;lowest&#39;, &#39;highest&#39;, &#39;drop&#39;.&quot;</span>
</span><span id="Die-1214"><a href="#Die-1214"><span class="linenos">1214</span></a>                <span class="p">)</span>
</span><span id="Die-1215"><a href="#Die-1215"><span class="linenos">1215</span></a>
</span><span id="Die-1216"><a href="#Die-1216"><span class="linenos">1216</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">rolls</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="n">max_rerolls</span><span class="p">))</span>
</span><span id="Die-1217"><a href="#Die-1217"><span class="linenos">1217</span></a>
</span><span id="Die-1218"><a href="#Die-1218"><span class="linenos">1218</span></a>        <span class="k">return</span> <span class="n">pool_composition</span><span class="o">.</span><span class="n">map_to_pool</span><span class="p">(</span><span class="n">make_pool</span><span class="p">,</span>
</span><span id="Die-1219"><a href="#Die-1219"><span class="linenos">1219</span></a>                                            <span class="n">star</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Die-1220"><a href="#Die-1220"><span class="linenos">1220</span></a>                                            <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">)</span>
</span><span id="Die-1221"><a href="#Die-1221"><span class="linenos">1221</span></a>
</span><span id="Die-1222"><a href="#Die-1222"><span class="linenos">1222</span></a>    <span class="c1"># Unary operators.</span>
</span><span id="Die-1223"><a href="#Die-1223"><span class="linenos">1223</span></a>
</span><span id="Die-1224"><a href="#Die-1224"><span class="linenos">1224</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-1225"><a href="#Die-1225"><span class="linenos">1225</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">)</span>
</span><span id="Die-1226"><a href="#Die-1226"><span class="linenos">1226</span></a>
</span><span id="Die-1227"><a href="#Die-1227"><span class="linenos">1227</span></a>    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-1228"><a href="#Die-1228"><span class="linenos">1228</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</span><span id="Die-1229"><a href="#Die-1229"><span class="linenos">1229</span></a>
</span><span id="Die-1230"><a href="#Die-1230"><span class="linenos">1230</span></a>    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-1231"><a href="#Die-1231"><span class="linenos">1231</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">invert</span><span class="p">)</span>
</span><span id="Die-1232"><a href="#Die-1232"><span class="linenos">1232</span></a>
</span><span id="Die-1233"><a href="#Die-1233"><span class="linenos">1233</span></a>    <span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-1234"><a href="#Die-1234"><span class="linenos">1234</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</span><span id="Die-1235"><a href="#Die-1235"><span class="linenos">1235</span></a>
</span><span id="Die-1236"><a href="#Die-1236"><span class="linenos">1236</span></a>    <span class="fm">__abs__</span> <span class="o">=</span> <span class="nb">abs</span>
</span><span id="Die-1237"><a href="#Die-1237"><span class="linenos">1237</span></a>
</span><span id="Die-1238"><a href="#Die-1238"><span class="linenos">1238</span></a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1239"><a href="#Die-1239"><span class="linenos">1239</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>
</span><span id="Die-1240"><a href="#Die-1240"><span class="linenos">1240</span></a>
</span><span id="Die-1241"><a href="#Die-1241"><span class="linenos">1241</span></a>    <span class="fm">__round__</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="Die-1242"><a href="#Die-1242"><span class="linenos">1242</span></a>
</span><span id="Die-1243"><a href="#Die-1243"><span class="linenos">1243</span></a>    <span class="k">def</span> <span class="nf">stochastic_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-1244"><a href="#Die-1244"><span class="linenos">1244</span></a>                         <span class="o">*</span><span class="p">,</span>
</span><span id="Die-1245"><a href="#Die-1245"><span class="linenos">1245</span></a>                         <span class="n">max_denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die-1246"><a href="#Die-1246"><span class="linenos">1246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Randomly rounds outcomes up or down to the nearest integer according to the two distances.</span>
</span><span id="Die-1247"><a href="#Die-1247"><span class="linenos">1247</span></a><span class="sd">        </span>
</span><span id="Die-1248"><a href="#Die-1248"><span class="linenos">1248</span></a><span class="sd">        Specificially, rounds `x` up with probability `x - floor(x)` and down</span>
</span><span id="Die-1249"><a href="#Die-1249"><span class="linenos">1249</span></a><span class="sd">        otherwise.</span>
</span><span id="Die-1250"><a href="#Die-1250"><span class="linenos">1250</span></a>
</span><span id="Die-1251"><a href="#Die-1251"><span class="linenos">1251</span></a><span class="sd">        Args:</span>
</span><span id="Die-1252"><a href="#Die-1252"><span class="linenos">1252</span></a><span class="sd">            max_denominator: If provided, each rounding will be performed</span>
</span><span id="Die-1253"><a href="#Die-1253"><span class="linenos">1253</span></a><span class="sd">                using `fractions.Fraction.limit_denominator(max_denominator)`.</span>
</span><span id="Die-1254"><a href="#Die-1254"><span class="linenos">1254</span></a><span class="sd">                Otherwise, the rounding will be performed without</span>
</span><span id="Die-1255"><a href="#Die-1255"><span class="linenos">1255</span></a><span class="sd">                `limit_denominator`.</span>
</span><span id="Die-1256"><a href="#Die-1256"><span class="linenos">1256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1257"><a href="#Die-1257"><span class="linenos">1257</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">stochastic_round</span><span class="p">(</span>
</span><span id="Die-1258"><a href="#Die-1258"><span class="linenos">1258</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">max_denominator</span><span class="o">=</span><span class="n">max_denominator</span><span class="p">))</span>
</span><span id="Die-1259"><a href="#Die-1259"><span class="linenos">1259</span></a>
</span><span id="Die-1260"><a href="#Die-1260"><span class="linenos">1260</span></a>    <span class="k">def</span> <span class="nf">trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1261"><a href="#Die-1261"><span class="linenos">1261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">)</span>
</span><span id="Die-1262"><a href="#Die-1262"><span class="linenos">1262</span></a>
</span><span id="Die-1263"><a href="#Die-1263"><span class="linenos">1263</span></a>    <span class="n">__trunc__</span> <span class="o">=</span> <span class="n">trunc</span>
</span><span id="Die-1264"><a href="#Die-1264"><span class="linenos">1264</span></a>
</span><span id="Die-1265"><a href="#Die-1265"><span class="linenos">1265</span></a>    <span class="k">def</span> <span class="nf">floor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1266"><a href="#Die-1266"><span class="linenos">1266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
</span><span id="Die-1267"><a href="#Die-1267"><span class="linenos">1267</span></a>
</span><span id="Die-1268"><a href="#Die-1268"><span class="linenos">1268</span></a>    <span class="n">__floor__</span> <span class="o">=</span> <span class="n">floor</span>
</span><span id="Die-1269"><a href="#Die-1269"><span class="linenos">1269</span></a>
</span><span id="Die-1270"><a href="#Die-1270"><span class="linenos">1270</span></a>    <span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1271"><a href="#Die-1271"><span class="linenos">1271</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">)</span>
</span><span id="Die-1272"><a href="#Die-1272"><span class="linenos">1272</span></a>
</span><span id="Die-1273"><a href="#Die-1273"><span class="linenos">1273</span></a>    <span class="n">__ceil__</span> <span class="o">=</span> <span class="n">ceil</span>
</span><span id="Die-1274"><a href="#Die-1274"><span class="linenos">1274</span></a>
</span><span id="Die-1275"><a href="#Die-1275"><span class="linenos">1275</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Die-1276"><a href="#Die-1276"><span class="linenos">1276</span></a>    <span class="k">def</span> <span class="nf">_zero</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="Die-1277"><a href="#Die-1277"><span class="linenos">1277</span></a>        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">0</span>
</span><span id="Die-1278"><a href="#Die-1278"><span class="linenos">1278</span></a>
</span><span id="Die-1279"><a href="#Die-1279"><span class="linenos">1279</span></a>    <span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die-1280"><a href="#Die-1280"><span class="linenos">1280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Zeros all outcomes of this die.</span>
</span><span id="Die-1281"><a href="#Die-1281"><span class="linenos">1281</span></a>
</span><span id="Die-1282"><a href="#Die-1282"><span class="linenos">1282</span></a><span class="sd">        This is done by multiplying all outcomes by `0`.</span>
</span><span id="Die-1283"><a href="#Die-1283"><span class="linenos">1283</span></a>
</span><span id="Die-1284"><a href="#Die-1284"><span class="linenos">1284</span></a><span class="sd">        The result will have the same denominator as this die.</span>
</span><span id="Die-1285"><a href="#Die-1285"><span class="linenos">1285</span></a>
</span><span id="Die-1286"><a href="#Die-1286"><span class="linenos">1286</span></a><span class="sd">        Raises:</span>
</span><span id="Die-1287"><a href="#Die-1287"><span class="linenos">1287</span></a><span class="sd">            ValueError: If the zeros did not resolve to a single outcome.</span>
</span><span id="Die-1288"><a href="#Die-1288"><span class="linenos">1288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1289"><a href="#Die-1289"><span class="linenos">1289</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_zero</span><span class="p">)</span>
</span><span id="Die-1290"><a href="#Die-1290"><span class="linenos">1290</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die-1291"><a href="#Die-1291"><span class="linenos">1291</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;zero() did not resolve to a single outcome.&#39;</span><span class="p">)</span>
</span><span id="Die-1292"><a href="#Die-1292"><span class="linenos">1292</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Die-1293"><a href="#Die-1293"><span class="linenos">1293</span></a>
</span><span id="Die-1294"><a href="#Die-1294"><span class="linenos">1294</span></a>    <span class="k">def</span> <span class="nf">zero_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Die-1295"><a href="#Die-1295"><span class="linenos">1295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A zero-outcome for this die.</span>
</span><span id="Die-1296"><a href="#Die-1296"><span class="linenos">1296</span></a>
</span><span id="Die-1297"><a href="#Die-1297"><span class="linenos">1297</span></a><span class="sd">        E.g. `0` for a `Die` whose outcomes are `int`s.</span>
</span><span id="Die-1298"><a href="#Die-1298"><span class="linenos">1298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1299"><a href="#Die-1299"><span class="linenos">1299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die-1300"><a href="#Die-1300"><span class="linenos">1300</span></a>
</span><span id="Die-1301"><a href="#Die-1301"><span class="linenos">1301</span></a>    <span class="c1"># Binary operators.</span>
</span><span id="Die-1302"><a href="#Die-1302"><span class="linenos">1302</span></a>
</span><span id="Die-1303"><a href="#Die-1303"><span class="linenos">1303</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1304"><a href="#Die-1304"><span class="linenos">1304</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1305"><a href="#Die-1305"><span class="linenos">1305</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1306"><a href="#Die-1306"><span class="linenos">1306</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1307"><a href="#Die-1307"><span class="linenos">1307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="Die-1308"><a href="#Die-1308"><span class="linenos">1308</span></a>
</span><span id="Die-1309"><a href="#Die-1309"><span class="linenos">1309</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1310"><a href="#Die-1310"><span class="linenos">1310</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1311"><a href="#Die-1311"><span class="linenos">1311</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1312"><a href="#Die-1312"><span class="linenos">1312</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1313"><a href="#Die-1313"><span class="linenos">1313</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="Die-1314"><a href="#Die-1314"><span class="linenos">1314</span></a>
</span><span id="Die-1315"><a href="#Die-1315"><span class="linenos">1315</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1316"><a href="#Die-1316"><span class="linenos">1316</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1317"><a href="#Die-1317"><span class="linenos">1317</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1318"><a href="#Die-1318"><span class="linenos">1318</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1319"><a href="#Die-1319"><span class="linenos">1319</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Die-1320"><a href="#Die-1320"><span class="linenos">1320</span></a>
</span><span id="Die-1321"><a href="#Die-1321"><span class="linenos">1321</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1322"><a href="#Die-1322"><span class="linenos">1322</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1323"><a href="#Die-1323"><span class="linenos">1323</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1324"><a href="#Die-1324"><span class="linenos">1324</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1325"><a href="#Die-1325"><span class="linenos">1325</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Die-1326"><a href="#Die-1326"><span class="linenos">1326</span></a>
</span><span id="Die-1327"><a href="#Die-1327"><span class="linenos">1327</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1328"><a href="#Die-1328"><span class="linenos">1328</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1329"><a href="#Die-1329"><span class="linenos">1329</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1330"><a href="#Die-1330"><span class="linenos">1330</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1331"><a href="#Die-1331"><span class="linenos">1331</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>
</span><span id="Die-1332"><a href="#Die-1332"><span class="linenos">1332</span></a>
</span><span id="Die-1333"><a href="#Die-1333"><span class="linenos">1333</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1334"><a href="#Die-1334"><span class="linenos">1334</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1335"><a href="#Die-1335"><span class="linenos">1335</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1336"><a href="#Die-1336"><span class="linenos">1336</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1337"><a href="#Die-1337"><span class="linenos">1337</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>
</span><span id="Die-1338"><a href="#Die-1338"><span class="linenos">1338</span></a>
</span><span id="Die-1339"><a href="#Die-1339"><span class="linenos">1339</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1340"><a href="#Die-1340"><span class="linenos">1340</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1341"><a href="#Die-1341"><span class="linenos">1341</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1342"><a href="#Die-1342"><span class="linenos">1342</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1343"><a href="#Die-1343"><span class="linenos">1343</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>
</span><span id="Die-1344"><a href="#Die-1344"><span class="linenos">1344</span></a>
</span><span id="Die-1345"><a href="#Die-1345"><span class="linenos">1345</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1346"><a href="#Die-1346"><span class="linenos">1346</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1347"><a href="#Die-1347"><span class="linenos">1347</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1348"><a href="#Die-1348"><span class="linenos">1348</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1349"><a href="#Die-1349"><span class="linenos">1349</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>
</span><span id="Die-1350"><a href="#Die-1350"><span class="linenos">1350</span></a>
</span><span id="Die-1351"><a href="#Die-1351"><span class="linenos">1351</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1352"><a href="#Die-1352"><span class="linenos">1352</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1353"><a href="#Die-1353"><span class="linenos">1353</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1354"><a href="#Die-1354"><span class="linenos">1354</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1355"><a href="#Die-1355"><span class="linenos">1355</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">)</span>
</span><span id="Die-1356"><a href="#Die-1356"><span class="linenos">1356</span></a>
</span><span id="Die-1357"><a href="#Die-1357"><span class="linenos">1357</span></a>    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1358"><a href="#Die-1358"><span class="linenos">1358</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1359"><a href="#Die-1359"><span class="linenos">1359</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1360"><a href="#Die-1360"><span class="linenos">1360</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1361"><a href="#Die-1361"><span class="linenos">1361</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">)</span>
</span><span id="Die-1362"><a href="#Die-1362"><span class="linenos">1362</span></a>
</span><span id="Die-1363"><a href="#Die-1363"><span class="linenos">1363</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1364"><a href="#Die-1364"><span class="linenos">1364</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1365"><a href="#Die-1365"><span class="linenos">1365</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1366"><a href="#Die-1366"><span class="linenos">1366</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1367"><a href="#Die-1367"><span class="linenos">1367</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="Die-1368"><a href="#Die-1368"><span class="linenos">1368</span></a>
</span><span id="Die-1369"><a href="#Die-1369"><span class="linenos">1369</span></a>    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1370"><a href="#Die-1370"><span class="linenos">1370</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1371"><a href="#Die-1371"><span class="linenos">1371</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1372"><a href="#Die-1372"><span class="linenos">1372</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1373"><a href="#Die-1373"><span class="linenos">1373</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="Die-1374"><a href="#Die-1374"><span class="linenos">1374</span></a>
</span><span id="Die-1375"><a href="#Die-1375"><span class="linenos">1375</span></a>    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1376"><a href="#Die-1376"><span class="linenos">1376</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1377"><a href="#Die-1377"><span class="linenos">1377</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1378"><a href="#Die-1378"><span class="linenos">1378</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1379"><a href="#Die-1379"><span class="linenos">1379</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">)</span>
</span><span id="Die-1380"><a href="#Die-1380"><span class="linenos">1380</span></a>
</span><span id="Die-1381"><a href="#Die-1381"><span class="linenos">1381</span></a>    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1382"><a href="#Die-1382"><span class="linenos">1382</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1383"><a href="#Die-1383"><span class="linenos">1383</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1384"><a href="#Die-1384"><span class="linenos">1384</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1385"><a href="#Die-1385"><span class="linenos">1385</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">)</span>
</span><span id="Die-1386"><a href="#Die-1386"><span class="linenos">1386</span></a>
</span><span id="Die-1387"><a href="#Die-1387"><span class="linenos">1387</span></a>    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1388"><a href="#Die-1388"><span class="linenos">1388</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1389"><a href="#Die-1389"><span class="linenos">1389</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1390"><a href="#Die-1390"><span class="linenos">1390</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1391"><a href="#Die-1391"><span class="linenos">1391</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">)</span>
</span><span id="Die-1392"><a href="#Die-1392"><span class="linenos">1392</span></a>
</span><span id="Die-1393"><a href="#Die-1393"><span class="linenos">1393</span></a>    <span class="k">def</span> <span class="fm">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1394"><a href="#Die-1394"><span class="linenos">1394</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1395"><a href="#Die-1395"><span class="linenos">1395</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1396"><a href="#Die-1396"><span class="linenos">1396</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1397"><a href="#Die-1397"><span class="linenos">1397</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">)</span>
</span><span id="Die-1398"><a href="#Die-1398"><span class="linenos">1398</span></a>
</span><span id="Die-1399"><a href="#Die-1399"><span class="linenos">1399</span></a>    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1400"><a href="#Die-1400"><span class="linenos">1400</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1401"><a href="#Die-1401"><span class="linenos">1401</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1402"><a href="#Die-1402"><span class="linenos">1402</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1403"><a href="#Die-1403"><span class="linenos">1403</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">)</span>
</span><span id="Die-1404"><a href="#Die-1404"><span class="linenos">1404</span></a>
</span><span id="Die-1405"><a href="#Die-1405"><span class="linenos">1405</span></a>    <span class="k">def</span> <span class="fm">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1406"><a href="#Die-1406"><span class="linenos">1406</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1407"><a href="#Die-1407"><span class="linenos">1407</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1408"><a href="#Die-1408"><span class="linenos">1408</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1409"><a href="#Die-1409"><span class="linenos">1409</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">)</span>
</span><span id="Die-1410"><a href="#Die-1410"><span class="linenos">1410</span></a>
</span><span id="Die-1411"><a href="#Die-1411"><span class="linenos">1411</span></a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1412"><a href="#Die-1412"><span class="linenos">1412</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1413"><a href="#Die-1413"><span class="linenos">1413</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1414"><a href="#Die-1414"><span class="linenos">1414</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1415"><a href="#Die-1415"><span class="linenos">1415</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">)</span>
</span><span id="Die-1416"><a href="#Die-1416"><span class="linenos">1416</span></a>
</span><span id="Die-1417"><a href="#Die-1417"><span class="linenos">1417</span></a>    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1418"><a href="#Die-1418"><span class="linenos">1418</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1419"><a href="#Die-1419"><span class="linenos">1419</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1420"><a href="#Die-1420"><span class="linenos">1420</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1421"><a href="#Die-1421"><span class="linenos">1421</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">)</span>
</span><span id="Die-1422"><a href="#Die-1422"><span class="linenos">1422</span></a>
</span><span id="Die-1423"><a href="#Die-1423"><span class="linenos">1423</span></a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1424"><a href="#Die-1424"><span class="linenos">1424</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1425"><a href="#Die-1425"><span class="linenos">1425</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1426"><a href="#Die-1426"><span class="linenos">1426</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1427"><a href="#Die-1427"><span class="linenos">1427</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">)</span>
</span><span id="Die-1428"><a href="#Die-1428"><span class="linenos">1428</span></a>
</span><span id="Die-1429"><a href="#Die-1429"><span class="linenos">1429</span></a>    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1430"><a href="#Die-1430"><span class="linenos">1430</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1431"><a href="#Die-1431"><span class="linenos">1431</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1432"><a href="#Die-1432"><span class="linenos">1432</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1433"><a href="#Die-1433"><span class="linenos">1433</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">)</span>
</span><span id="Die-1434"><a href="#Die-1434"><span class="linenos">1434</span></a>
</span><span id="Die-1435"><a href="#Die-1435"><span class="linenos">1435</span></a>    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1436"><a href="#Die-1436"><span class="linenos">1436</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1437"><a href="#Die-1437"><span class="linenos">1437</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1438"><a href="#Die-1438"><span class="linenos">1438</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1439"><a href="#Die-1439"><span class="linenos">1439</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">)</span>
</span><span id="Die-1440"><a href="#Die-1440"><span class="linenos">1440</span></a>
</span><span id="Die-1441"><a href="#Die-1441"><span class="linenos">1441</span></a>    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1442"><a href="#Die-1442"><span class="linenos">1442</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1443"><a href="#Die-1443"><span class="linenos">1443</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1444"><a href="#Die-1444"><span class="linenos">1444</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1445"><a href="#Die-1445"><span class="linenos">1445</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">)</span>
</span><span id="Die-1446"><a href="#Die-1446"><span class="linenos">1446</span></a>
</span><span id="Die-1447"><a href="#Die-1447"><span class="linenos">1447</span></a>    <span class="c1"># Comparators.</span>
</span><span id="Die-1448"><a href="#Die-1448"><span class="linenos">1448</span></a>
</span><span id="Die-1449"><a href="#Die-1449"><span class="linenos">1449</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[bool]&#39;</span><span class="p">:</span>
</span><span id="Die-1450"><a href="#Die-1450"><span class="linenos">1450</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1451"><a href="#Die-1451"><span class="linenos">1451</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1452"><a href="#Die-1452"><span class="linenos">1452</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1453"><a href="#Die-1453"><span class="linenos">1453</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">)</span>
</span><span id="Die-1454"><a href="#Die-1454"><span class="linenos">1454</span></a>
</span><span id="Die-1455"><a href="#Die-1455"><span class="linenos">1455</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[bool]&#39;</span><span class="p">:</span>
</span><span id="Die-1456"><a href="#Die-1456"><span class="linenos">1456</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1457"><a href="#Die-1457"><span class="linenos">1457</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1458"><a href="#Die-1458"><span class="linenos">1458</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1459"><a href="#Die-1459"><span class="linenos">1459</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">)</span>
</span><span id="Die-1460"><a href="#Die-1460"><span class="linenos">1460</span></a>
</span><span id="Die-1461"><a href="#Die-1461"><span class="linenos">1461</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[bool]&#39;</span><span class="p">:</span>
</span><span id="Die-1462"><a href="#Die-1462"><span class="linenos">1462</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1463"><a href="#Die-1463"><span class="linenos">1463</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1464"><a href="#Die-1464"><span class="linenos">1464</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1465"><a href="#Die-1465"><span class="linenos">1465</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">)</span>
</span><span id="Die-1466"><a href="#Die-1466"><span class="linenos">1466</span></a>
</span><span id="Die-1467"><a href="#Die-1467"><span class="linenos">1467</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[bool]&#39;</span><span class="p">:</span>
</span><span id="Die-1468"><a href="#Die-1468"><span class="linenos">1468</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1469"><a href="#Die-1469"><span class="linenos">1469</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1470"><a href="#Die-1470"><span class="linenos">1470</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1471"><a href="#Die-1471"><span class="linenos">1471</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>
</span><span id="Die-1472"><a href="#Die-1472"><span class="linenos">1472</span></a>
</span><span id="Die-1473"><a href="#Die-1473"><span class="linenos">1473</span></a>    <span class="c1"># Equality operators. These produce a `DieWithTruth`.</span>
</span><span id="Die-1474"><a href="#Die-1474"><span class="linenos">1474</span></a>
</span><span id="Die-1475"><a href="#Die-1475"><span class="linenos">1475</span></a>    <span class="c1"># The result has a truth value, but is not a bool.</span>
</span><span id="Die-1476"><a href="#Die-1476"><span class="linenos">1476</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.DieWithTruth[bool]&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-1477"><a href="#Die-1477"><span class="linenos">1477</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1478"><a href="#Die-1478"><span class="linenos">1478</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1479"><a href="#Die-1479"><span class="linenos">1479</span></a>        <span class="n">other_die</span><span class="p">:</span> <span class="n">Die</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1480"><a href="#Die-1480"><span class="linenos">1480</span></a>
</span><span id="Die-1481"><a href="#Die-1481"><span class="linenos">1481</span></a>        <span class="k">def</span> <span class="nf">data_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Counts</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="Die-1482"><a href="#Die-1482"><span class="linenos">1482</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other_die</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">)</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Die-1483"><a href="#Die-1483"><span class="linenos">1483</span></a>
</span><span id="Die-1484"><a href="#Die-1484"><span class="linenos">1484</span></a>        <span class="k">def</span> <span class="nf">truth_value_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Die-1485"><a href="#Die-1485"><span class="linenos">1485</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1486"><a href="#Die-1486"><span class="linenos">1486</span></a>
</span><span id="Die-1487"><a href="#Die-1487"><span class="linenos">1487</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">DieWithTruth</span><span class="p">(</span><span class="n">data_callback</span><span class="p">,</span> <span class="n">truth_value_callback</span><span class="p">)</span>
</span><span id="Die-1488"><a href="#Die-1488"><span class="linenos">1488</span></a>
</span><span id="Die-1489"><a href="#Die-1489"><span class="linenos">1489</span></a>    <span class="c1"># The result has a truth value, but is not a bool.</span>
</span><span id="Die-1490"><a href="#Die-1490"><span class="linenos">1490</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.DieWithTruth[bool]&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Die-1491"><a href="#Die-1491"><span class="linenos">1491</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">):</span>
</span><span id="Die-1492"><a href="#Die-1492"><span class="linenos">1492</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1493"><a href="#Die-1493"><span class="linenos">1493</span></a>        <span class="n">other_die</span><span class="p">:</span> <span class="n">Die</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1494"><a href="#Die-1494"><span class="linenos">1494</span></a>
</span><span id="Die-1495"><a href="#Die-1495"><span class="linenos">1495</span></a>        <span class="k">def</span> <span class="nf">data_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Counts</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="Die-1496"><a href="#Die-1496"><span class="linenos">1496</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other_die</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">)</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Die-1497"><a href="#Die-1497"><span class="linenos">1497</span></a>
</span><span id="Die-1498"><a href="#Die-1498"><span class="linenos">1498</span></a>        <span class="k">def</span> <span class="nf">truth_value_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Die-1499"><a href="#Die-1499"><span class="linenos">1499</span></a>            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1500"><a href="#Die-1500"><span class="linenos">1500</span></a>
</span><span id="Die-1501"><a href="#Die-1501"><span class="linenos">1501</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">DieWithTruth</span><span class="p">(</span><span class="n">data_callback</span><span class="p">,</span> <span class="n">truth_value_callback</span><span class="p">)</span>
</span><span id="Die-1502"><a href="#Die-1502"><span class="linenos">1502</span></a>
</span><span id="Die-1503"><a href="#Die-1503"><span class="linenos">1503</span></a>    <span class="k">def</span> <span class="nf">cmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die-1504"><a href="#Die-1504"><span class="linenos">1504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `Die` with outcomes 1, -1, and 0.</span>
</span><span id="Die-1505"><a href="#Die-1505"><span class="linenos">1505</span></a>
</span><span id="Die-1506"><a href="#Die-1506"><span class="linenos">1506</span></a><span class="sd">        The quantities are equal to the positive outcome of `self &gt; other`,</span>
</span><span id="Die-1507"><a href="#Die-1507"><span class="linenos">1507</span></a><span class="sd">        `self &lt; other`, and the remainder respectively.</span>
</span><span id="Die-1508"><a href="#Die-1508"><span class="linenos">1508</span></a>
</span><span id="Die-1509"><a href="#Die-1509"><span class="linenos">1509</span></a><span class="sd">        This will include all three outcomes even if they have zero quantity.</span>
</span><span id="Die-1510"><a href="#Die-1510"><span class="linenos">1510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1511"><a href="#Die-1511"><span class="linenos">1511</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1512"><a href="#Die-1512"><span class="linenos">1512</span></a>
</span><span id="Die-1513"><a href="#Die-1513"><span class="linenos">1513</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die-1514"><a href="#Die-1514"><span class="linenos">1514</span></a>
</span><span id="Die-1515"><a href="#Die-1515"><span class="linenos">1515</span></a>        <span class="n">lt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span>
</span><span id="Die-1516"><a href="#Die-1516"><span class="linenos">1516</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">:</span>
</span><span id="Die-1517"><a href="#Die-1517"><span class="linenos">1517</span></a>            <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die-1518"><a href="#Die-1518"><span class="linenos">1518</span></a>        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Die-1519"><a href="#Die-1519"><span class="linenos">1519</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
</span><span id="Die-1520"><a href="#Die-1520"><span class="linenos">1520</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die-1521"><a href="#Die-1521"><span class="linenos">1521</span></a>        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span>
</span><span id="Die-1522"><a href="#Die-1522"><span class="linenos">1522</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">:</span>
</span><span id="Die-1523"><a href="#Die-1523"><span class="linenos">1523</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die-1524"><a href="#Die-1524"><span class="linenos">1524</span></a>
</span><span id="Die-1525"><a href="#Die-1525"><span class="linenos">1525</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-1526"><a href="#Die-1526"><span class="linenos">1526</span></a>
</span><span id="Die-1527"><a href="#Die-1527"><span class="linenos">1527</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Die-1528"><a href="#Die-1528"><span class="linenos">1528</span></a>    <span class="k">def</span> <span class="nf">_sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-1529"><a href="#Die-1529"><span class="linenos">1529</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">Die</span><span class="o">.</span><span class="n">_zero</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="Die-1530"><a href="#Die-1530"><span class="linenos">1530</span></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">:</span>
</span><span id="Die-1531"><a href="#Die-1531"><span class="linenos">1531</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="Die-1532"><a href="#Die-1532"><span class="linenos">1532</span></a>        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">:</span>
</span><span id="Die-1533"><a href="#Die-1533"><span class="linenos">1533</span></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Die-1534"><a href="#Die-1534"><span class="linenos">1534</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1535"><a href="#Die-1535"><span class="linenos">1535</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Die-1536"><a href="#Die-1536"><span class="linenos">1536</span></a>
</span><span id="Die-1537"><a href="#Die-1537"><span class="linenos">1537</span></a>    <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die-1538"><a href="#Die-1538"><span class="linenos">1538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Outcomes become 1 if greater than `zero()`, -1 if less than `zero()`, and 0 otherwise.</span>
</span><span id="Die-1539"><a href="#Die-1539"><span class="linenos">1539</span></a>
</span><span id="Die-1540"><a href="#Die-1540"><span class="linenos">1540</span></a><span class="sd">        Note that for `float`s, +0.0, -0.0, and nan all become 0.</span>
</span><span id="Die-1541"><a href="#Die-1541"><span class="linenos">1541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1542"><a href="#Die-1542"><span class="linenos">1542</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_sign</span><span class="p">)</span>
</span><span id="Die-1543"><a href="#Die-1543"><span class="linenos">1543</span></a>
</span><span id="Die-1544"><a href="#Die-1544"><span class="linenos">1544</span></a>    <span class="c1"># Equality and hashing.</span>
</span><span id="Die-1545"><a href="#Die-1545"><span class="linenos">1545</span></a>
</span><span id="Die-1546"><a href="#Die-1546"><span class="linenos">1546</span></a>    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Die-1547"><a href="#Die-1547"><span class="linenos">1547</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Die-1548"><a href="#Die-1548"><span class="linenos">1548</span></a>            <span class="s1">&#39;A `Die` only has a truth value if it is the result of == or !=.</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Die-1549"><a href="#Die-1549"><span class="linenos">1549</span></a>            <span class="s1">&#39;This could result from trying to use a die in an if-statement,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Die-1550"><a href="#Die-1550"><span class="linenos">1550</span></a>            <span class="s1">&#39;in which case you should use `die.if_else()` instead.</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Die-1551"><a href="#Die-1551"><span class="linenos">1551</span></a>            <span class="s1">&#39;Or it could result from trying to use a `Die` inside a tuple or vector outcome,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Die-1552"><a href="#Die-1552"><span class="linenos">1552</span></a>            <span class="s1">&#39;in which case you should use `tupleize()` or `vectorize().&#39;</span><span class="p">)</span>
</span><span id="Die-1553"><a href="#Die-1553"><span class="linenos">1553</span></a>
</span><span id="Die-1554"><a href="#Die-1554"><span class="linenos">1554</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-1555"><a href="#Die-1555"><span class="linenos">1555</span></a>    <span class="k">def</span> <span class="nf">_hash_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Die-1556"><a href="#Die-1556"><span class="linenos">1556</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A tuple that uniquely (as `equals()`) identifies this die.</span>
</span><span id="Die-1557"><a href="#Die-1557"><span class="linenos">1557</span></a>
</span><span id="Die-1558"><a href="#Die-1558"><span class="linenos">1558</span></a><span class="sd">        Apart from being hashable and totally orderable, this is not guaranteed</span>
</span><span id="Die-1559"><a href="#Die-1559"><span class="linenos">1559</span></a><span class="sd">        to be in any particular format or have any other properties.</span>
</span><span id="Die-1560"><a href="#Die-1560"><span class="linenos">1560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1561"><a href="#Die-1561"><span class="linenos">1561</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Die-1562"><a href="#Die-1562"><span class="linenos">1562</span></a>
</span><span id="Die-1563"><a href="#Die-1563"><span class="linenos">1563</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-1564"><a href="#Die-1564"><span class="linenos">1564</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-1565"><a href="#Die-1565"><span class="linenos">1565</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span><span class="p">)</span>
</span><span id="Die-1566"><a href="#Die-1566"><span class="linenos">1566</span></a>
</span><span id="Die-1567"><a href="#Die-1567"><span class="linenos">1567</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-1568"><a href="#Die-1568"><span class="linenos">1568</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="Die-1569"><a href="#Die-1569"><span class="linenos">1569</span></a>
</span><span id="Die-1570"><a href="#Die-1570"><span class="linenos">1570</span></a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">simplify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Die-1571"><a href="#Die-1571"><span class="linenos">1571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`True` iff both dice have the same outcomes and quantities.</span>
</span><span id="Die-1572"><a href="#Die-1572"><span class="linenos">1572</span></a>
</span><span id="Die-1573"><a href="#Die-1573"><span class="linenos">1573</span></a><span class="sd">        This is `False` if `other` is not a `Die`, even if it would convert</span>
</span><span id="Die-1574"><a href="#Die-1574"><span class="linenos">1574</span></a><span class="sd">        to an equal `Die`.</span>
</span><span id="Die-1575"><a href="#Die-1575"><span class="linenos">1575</span></a>
</span><span id="Die-1576"><a href="#Die-1576"><span class="linenos">1576</span></a><span class="sd">        Truth value does NOT matter.</span>
</span><span id="Die-1577"><a href="#Die-1577"><span class="linenos">1577</span></a>
</span><span id="Die-1578"><a href="#Die-1578"><span class="linenos">1578</span></a><span class="sd">        If one `Die` has a zero-quantity outcome and the other `Die` does not</span>
</span><span id="Die-1579"><a href="#Die-1579"><span class="linenos">1579</span></a><span class="sd">        contain that outcome, they are treated as unequal by this function.</span>
</span><span id="Die-1580"><a href="#Die-1580"><span class="linenos">1580</span></a>
</span><span id="Die-1581"><a href="#Die-1581"><span class="linenos">1581</span></a><span class="sd">        The `==` and `!=` operators have a dual purpose; they return a `Die`</span>
</span><span id="Die-1582"><a href="#Die-1582"><span class="linenos">1582</span></a><span class="sd">        with a truth value determined by this method.</span>
</span><span id="Die-1583"><a href="#Die-1583"><span class="linenos">1583</span></a><span class="sd">        Only dice returned by these methods have a truth value. The data of</span>
</span><span id="Die-1584"><a href="#Die-1584"><span class="linenos">1584</span></a><span class="sd">        these dice is lazily evaluated since the caller may only be interested</span>
</span><span id="Die-1585"><a href="#Die-1585"><span class="linenos">1585</span></a><span class="sd">        in the `Die` value or the truth value.</span>
</span><span id="Die-1586"><a href="#Die-1586"><span class="linenos">1586</span></a>
</span><span id="Die-1587"><a href="#Die-1587"><span class="linenos">1587</span></a><span class="sd">        Args:</span>
</span><span id="Die-1588"><a href="#Die-1588"><span class="linenos">1588</span></a><span class="sd">            simplify: If `True`, the dice will be simplified before comparing.</span>
</span><span id="Die-1589"><a href="#Die-1589"><span class="linenos">1589</span></a><span class="sd">                Otherwise, e.g. a 2:2 coin is not `equals()` to a 1:1 coin.</span>
</span><span id="Die-1590"><a href="#Die-1590"><span class="linenos">1590</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1591"><a href="#Die-1591"><span class="linenos">1591</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die-1592"><a href="#Die-1592"><span class="linenos">1592</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Die-1593"><a href="#Die-1593"><span class="linenos">1593</span></a>
</span><span id="Die-1594"><a href="#Die-1594"><span class="linenos">1594</span></a>        <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
</span><span id="Die-1595"><a href="#Die-1595"><span class="linenos">1595</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">_hash_key</span>
</span><span id="Die-1596"><a href="#Die-1596"><span class="linenos">1596</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1597"><a href="#Die-1597"><span class="linenos">1597</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash_key</span>
</span><span id="Die-1598"><a href="#Die-1598"><span class="linenos">1598</span></a>
</span><span id="Die-1599"><a href="#Die-1599"><span class="linenos">1599</span></a>    <span class="c1"># Strings.</span>
</span><span id="Die-1600"><a href="#Die-1600"><span class="linenos">1600</span></a>
</span><span id="Die-1601"><a href="#Die-1601"><span class="linenos">1601</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Die-1602"><a href="#Die-1602"><span class="linenos">1602</span></a>        <span class="n">inner</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Die-1603"><a href="#Die-1603"><span class="linenos">1603</span></a>                          <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Die-1604"><a href="#Die-1604"><span class="linenos">1604</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="s1">&#39;({&#39;</span> <span class="o">+</span> <span class="n">inner</span> <span class="o">+</span> <span class="s1">&#39;})&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Sampling with replacement. Quantities represent weights.</p>

<p>Dice are immutable. Methods do not modify the <code><a href="#Die">Die</a></code> in-place;
rather they return a <code><a href="#Die">Die</a></code> representing the result.</p>

<p>It <em>is</em> (mostly) well-defined to have a <code><a href="#Die">Die</a></code> with zero-quantity outcomes.
These can be useful in a few cases, such as:</p>

<ul>
<li><code><a href="#MultisetEvaluator">MultisetEvaluator</a></code> will iterate through zero-quantity outcomes,
rather than possibly skipping that outcome. (Though in most cases it's
better to use <code><a href="#MultisetEvaluator.alignment">MultisetEvaluator.alignment()</a></code>.)</li>
<li><code><a href="#align">align()</a></code> and the like are convenient for making dice share the
same set of outcomes.</li>
</ul>

<p>However, zero-quantity outcomes have a computational cost like any other
outcome. Unless you have a specific use case in mind, it's best to leave
them out.</p>

<p>Most operators and methods will not introduce zero-quantity outcomes if
their arguments do not have any; nor remove zero-quantity outcomes.</p>

<p>It's also possible to have "empty" dice with no outcomes at all,
though these have little use other than being sentinel values.</p>
</div>


                            <div id="Die.__init__" class="classattr">
                                        <input id="Die.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Die</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">times</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_end</span><span class="p">:</span> <span class="n"><a href="#Outcome">Outcome</a></span> <span class="o">|</span> <span class="n"><a href="#Die">Die</a></span> <span class="o">|</span> <span class="n"><a href="#RerollType">RerollType</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Die.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.__init__-76"><a href="#Die.__init__-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Die.__init__-77"><a href="#Die.__init__-77"><span class="linenos"> 77</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="Die.__init__-78"><a href="#Die.__init__-78"><span class="linenos"> 78</span></a>        <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Die.__init__-79"><a href="#Die.__init__-79"><span class="linenos"> 79</span></a>        <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.__init__-80"><a href="#Die.__init__-80"><span class="linenos"> 80</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="Die.__init__-81"><a href="#Die.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.__init__-82"><a href="#Die.__init__-82"><span class="linenos"> 82</span></a>        <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.__init__-83"><a href="#Die.__init__-83"><span class="linenos"> 83</span></a>        <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;Outcome | Die | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.__init__-84"><a href="#Die.__init__-84"><span class="linenos"> 84</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.__init__-85"><a href="#Die.__init__-85"><span class="linenos"> 85</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for a `Die`.</span>
</span><span id="Die.__init__-86"><a href="#Die.__init__-86"><span class="linenos"> 86</span></a>
</span><span id="Die.__init__-87"><a href="#Die.__init__-87"><span class="linenos"> 87</span></a><span class="sd">        Don&#39;t confuse this with `d()`:</span>
</span><span id="Die.__init__-88"><a href="#Die.__init__-88"><span class="linenos"> 88</span></a>
</span><span id="Die.__init__-89"><a href="#Die.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        * `Die([6])`: A `Die` that always rolls the `int` 6.</span>
</span><span id="Die.__init__-90"><a href="#Die.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        * `d(6)`: A d6.</span>
</span><span id="Die.__init__-91"><a href="#Die.__init__-91"><span class="linenos"> 91</span></a>
</span><span id="Die.__init__-92"><a href="#Die.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        Also, don&#39;t confuse this with `Pool()`:</span>
</span><span id="Die.__init__-93"><a href="#Die.__init__-93"><span class="linenos"> 93</span></a>
</span><span id="Die.__init__-94"><a href="#Die.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        * `Die([1, 2, 3, 4, 5, 6])`: A d6.</span>
</span><span id="Die.__init__-95"><a href="#Die.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        * `Pool([1, 2, 3, 4, 5, 6])`: A `Pool` of six dice that always rolls one</span>
</span><span id="Die.__init__-96"><a href="#Die.__init__-96"><span class="linenos"> 96</span></a><span class="sd">            of each number.</span>
</span><span id="Die.__init__-97"><a href="#Die.__init__-97"><span class="linenos"> 97</span></a>
</span><span id="Die.__init__-98"><a href="#Die.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        Here are some different ways of constructing a d6:</span>
</span><span id="Die.__init__-99"><a href="#Die.__init__-99"><span class="linenos"> 99</span></a>
</span><span id="Die.__init__-100"><a href="#Die.__init__-100"><span class="linenos">100</span></a><span class="sd">        * Just import it: `from icepool import d6`</span>
</span><span id="Die.__init__-101"><a href="#Die.__init__-101"><span class="linenos">101</span></a><span class="sd">        * Use the `d()` function: `icepool.d(6)`</span>
</span><span id="Die.__init__-102"><a href="#Die.__init__-102"><span class="linenos">102</span></a><span class="sd">        * Use a d6 that you already have: `Die(d6)` or `Die([d6])`</span>
</span><span id="Die.__init__-103"><a href="#Die.__init__-103"><span class="linenos">103</span></a><span class="sd">        * Mix a d3 and a d3+3: `Die([d3, d3+3])`</span>
</span><span id="Die.__init__-104"><a href="#Die.__init__-104"><span class="linenos">104</span></a><span class="sd">        * Use a dict: `Die({1:1, 2:1, 3:1, 4:1, 5:1, 6:1})`</span>
</span><span id="Die.__init__-105"><a href="#Die.__init__-105"><span class="linenos">105</span></a><span class="sd">        * Give the faces as a sequence: `Die([1, 2, 3, 4, 5, 6])`</span>
</span><span id="Die.__init__-106"><a href="#Die.__init__-106"><span class="linenos">106</span></a>
</span><span id="Die.__init__-107"><a href="#Die.__init__-107"><span class="linenos">107</span></a><span class="sd">        All quantities must be non-negative, though they can be zero.</span>
</span><span id="Die.__init__-108"><a href="#Die.__init__-108"><span class="linenos">108</span></a>
</span><span id="Die.__init__-109"><a href="#Die.__init__-109"><span class="linenos">109</span></a><span class="sd">        Several methods and functions foward **kwargs to this constructor.</span>
</span><span id="Die.__init__-110"><a href="#Die.__init__-110"><span class="linenos">110</span></a><span class="sd">        However, these only affect the construction of the returned or yielded</span>
</span><span id="Die.__init__-111"><a href="#Die.__init__-111"><span class="linenos">111</span></a><span class="sd">        dice. Any other implicit conversions of arguments or operands to dice</span>
</span><span id="Die.__init__-112"><a href="#Die.__init__-112"><span class="linenos">112</span></a><span class="sd">        will be done with the default keyword arguments.</span>
</span><span id="Die.__init__-113"><a href="#Die.__init__-113"><span class="linenos">113</span></a>
</span><span id="Die.__init__-114"><a href="#Die.__init__-114"><span class="linenos">114</span></a><span class="sd">        EXPERIMENTAL: Use `icepool.Again` to roll the dice again, usually with</span>
</span><span id="Die.__init__-115"><a href="#Die.__init__-115"><span class="linenos">115</span></a><span class="sd">        some modification. See the `Again` documentation for details.</span>
</span><span id="Die.__init__-116"><a href="#Die.__init__-116"><span class="linenos">116</span></a>
</span><span id="Die.__init__-117"><a href="#Die.__init__-117"><span class="linenos">117</span></a><span class="sd">        Denominator: For a flat set of outcomes, the denominator is just the</span>
</span><span id="Die.__init__-118"><a href="#Die.__init__-118"><span class="linenos">118</span></a><span class="sd">        sum of the corresponding quantities. If the outcomes themselves have</span>
</span><span id="Die.__init__-119"><a href="#Die.__init__-119"><span class="linenos">119</span></a><span class="sd">        secondary denominators, then the overall denominator will be minimized</span>
</span><span id="Die.__init__-120"><a href="#Die.__init__-120"><span class="linenos">120</span></a><span class="sd">        while preserving the relative weighting of the primary outcomes.</span>
</span><span id="Die.__init__-121"><a href="#Die.__init__-121"><span class="linenos">121</span></a>
</span><span id="Die.__init__-122"><a href="#Die.__init__-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="Die.__init__-123"><a href="#Die.__init__-123"><span class="linenos">123</span></a><span class="sd">            outcomes: The faces of the `Die`. This can be one of the following:</span>
</span><span id="Die.__init__-124"><a href="#Die.__init__-124"><span class="linenos">124</span></a><span class="sd">                * A `Sequence` of outcomes. Duplicates will contribute</span>
</span><span id="Die.__init__-125"><a href="#Die.__init__-125"><span class="linenos">125</span></a><span class="sd">                    quantity for each appearance.</span>
</span><span id="Die.__init__-126"><a href="#Die.__init__-126"><span class="linenos">126</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Die.__init__-127"><a href="#Die.__init__-127"><span class="linenos">127</span></a>
</span><span id="Die.__init__-128"><a href="#Die.__init__-128"><span class="linenos">128</span></a><span class="sd">                Individual outcomes can each be one of the following:</span>
</span><span id="Die.__init__-129"><a href="#Die.__init__-129"><span class="linenos">129</span></a>
</span><span id="Die.__init__-130"><a href="#Die.__init__-130"><span class="linenos">130</span></a><span class="sd">                * An outcome, which must be hashable and totally orderable.</span>
</span><span id="Die.__init__-131"><a href="#Die.__init__-131"><span class="linenos">131</span></a><span class="sd">                    * For convenience, `tuple`s containing `Population`s will be</span>
</span><span id="Die.__init__-132"><a href="#Die.__init__-132"><span class="linenos">132</span></a><span class="sd">                        `tupleize`d into a `Population` of `tuple`s.</span>
</span><span id="Die.__init__-133"><a href="#Die.__init__-133"><span class="linenos">133</span></a><span class="sd">                        This does not apply to subclasses of `tuple`s such as `namedtuple`</span>
</span><span id="Die.__init__-134"><a href="#Die.__init__-134"><span class="linenos">134</span></a><span class="sd">                        or other classes such as `Vector`.</span>
</span><span id="Die.__init__-135"><a href="#Die.__init__-135"><span class="linenos">135</span></a><span class="sd">                * A `Die`, which will be flattened into the result.</span>
</span><span id="Die.__init__-136"><a href="#Die.__init__-136"><span class="linenos">136</span></a><span class="sd">                    The quantity assigned to a `Die` is shared among its</span>
</span><span id="Die.__init__-137"><a href="#Die.__init__-137"><span class="linenos">137</span></a><span class="sd">                    outcomes. The total denominator will be scaled up if</span>
</span><span id="Die.__init__-138"><a href="#Die.__init__-138"><span class="linenos">138</span></a><span class="sd">                    necessary.</span>
</span><span id="Die.__init__-139"><a href="#Die.__init__-139"><span class="linenos">139</span></a><span class="sd">                * `icepool.Reroll`, which will drop itself from consideration.</span>
</span><span id="Die.__init__-140"><a href="#Die.__init__-140"><span class="linenos">140</span></a><span class="sd">                * EXPERIMENTAL: `icepool.Again`. See the documentation for</span>
</span><span id="Die.__init__-141"><a href="#Die.__init__-141"><span class="linenos">141</span></a><span class="sd">                    `Again` for details.</span>
</span><span id="Die.__init__-142"><a href="#Die.__init__-142"><span class="linenos">142</span></a><span class="sd">            times: Multiplies the quantity of each element of `outcomes`.</span>
</span><span id="Die.__init__-143"><a href="#Die.__init__-143"><span class="linenos">143</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Die.__init__-144"><a href="#Die.__init__-144"><span class="linenos">144</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Die.__init__-145"><a href="#Die.__init__-145"><span class="linenos">145</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Die.__init__-146"><a href="#Die.__init__-146"><span class="linenos">146</span></a><span class="sd">            again_count, again_depth, again_end: These affect how `Again`</span>
</span><span id="Die.__init__-147"><a href="#Die.__init__-147"><span class="linenos">147</span></a><span class="sd">                expressions are handled. See the `Again` documentation for</span>
</span><span id="Die.__init__-148"><a href="#Die.__init__-148"><span class="linenos">148</span></a><span class="sd">                details.</span>
</span><span id="Die.__init__-149"><a href="#Die.__init__-149"><span class="linenos">149</span></a><span class="sd">        Raises:</span>
</span><span id="Die.__init__-150"><a href="#Die.__init__-150"><span class="linenos">150</span></a><span class="sd">            ValueError: `None` is not a valid outcome for a `Die`.</span>
</span><span id="Die.__init__-151"><a href="#Die.__init__-151"><span class="linenos">151</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.__init__-152"><a href="#Die.__init__-152"><span class="linenos">152</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die.__init__-153"><a href="#Die.__init__-153"><span class="linenos">153</span></a>
</span><span id="Die.__init__-154"><a href="#Die.__init__-154"><span class="linenos">154</span></a>        <span class="c1"># Check for Again.</span>
</span><span id="Die.__init__-155"><a href="#Die.__init__-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.__init__-156"><a href="#Die.__init__-156"><span class="linenos">156</span></a>            <span class="k">if</span> <span class="n">again_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.__init__-157"><a href="#Die.__init__-157"><span class="linenos">157</span></a>                <span class="k">if</span> <span class="n">again_depth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.__init__-158"><a href="#Die.__init__-158"><span class="linenos">158</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.__init__-159"><a href="#Die.__init__-159"><span class="linenos">159</span></a>                        <span class="s1">&#39;At most one of again_count and again_depth may be used.&#39;</span>
</span><span id="Die.__init__-160"><a href="#Die.__init__-160"><span class="linenos">160</span></a>                    <span class="p">)</span>
</span><span id="Die.__init__-161"><a href="#Die.__init__-161"><span class="linenos">161</span></a>                <span class="k">if</span> <span class="n">again_end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.__init__-162"><a href="#Die.__init__-162"><span class="linenos">162</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.__init__-163"><a href="#Die.__init__-163"><span class="linenos">163</span></a>                        <span class="s1">&#39;again_end cannot be used with again_count.&#39;</span><span class="p">)</span>
</span><span id="Die.__init__-164"><a href="#Die.__init__-164"><span class="linenos">164</span></a>                <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">evaluate_agains_using_count</span><span class="p">(</span>
</span><span id="Die.__init__-165"><a href="#Die.__init__-165"><span class="linenos">165</span></a>                    <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">again_count</span><span class="p">)</span>
</span><span id="Die.__init__-166"><a href="#Die.__init__-166"><span class="linenos">166</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.__init__-167"><a href="#Die.__init__-167"><span class="linenos">167</span></a>                <span class="k">if</span> <span class="n">again_depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.__init__-168"><a href="#Die.__init__-168"><span class="linenos">168</span></a>                    <span class="n">again_depth</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Die.__init__-169"><a href="#Die.__init__-169"><span class="linenos">169</span></a>                <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">evaluate_agains_using_depth</span><span class="p">(</span>
</span><span id="Die.__init__-170"><a href="#Die.__init__-170"><span class="linenos">170</span></a>                    <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">again_depth</span><span class="p">,</span> <span class="n">again_end</span><span class="p">)</span>
</span><span id="Die.__init__-171"><a href="#Die.__init__-171"><span class="linenos">171</span></a>
</span><span id="Die.__init__-172"><a href="#Die.__init__-172"><span class="linenos">172</span></a>        <span class="c1"># Agains have been replaced by this point.</span>
</span><span id="Die.__init__-173"><a href="#Die.__init__-173"><span class="linenos">173</span></a>        <span class="n">outcomes</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">T_co</span> <span class="o">|</span> <span class="n">Die</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">icepool</span><span class="o">.</span><span class="n">RerollType</span><span class="p">],</span>
</span><span id="Die.__init__-174"><a href="#Die.__init__-174"><span class="linenos">174</span></a>                        <span class="n">outcomes</span><span class="p">)</span>
</span><span id="Die.__init__-175"><a href="#Die.__init__-175"><span class="linenos">175</span></a>
</span><span id="Die.__init__-176"><a href="#Die.__init__-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Die.__init__-177"><a href="#Die.__init__-177"><span class="linenos">177</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die.__init__-178"><a href="#Die.__init__-178"><span class="linenos">178</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die.__init__-179"><a href="#Die.__init__-179"><span class="linenos">179</span></a>
</span><span id="Die.__init__-180"><a href="#Die.__init__-180"><span class="linenos">180</span></a>        <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_die</span><span class="p">(</span>
</span><span id="Die.__init__-181"><a href="#Die.__init__-181"><span class="linenos">181</span></a>            <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die.__init__-182"><a href="#Die.__init__-182"><span class="linenos">182</span></a>
</span><span id="Die.__init__-183"><a href="#Die.__init__-183"><span class="linenos">183</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructor for a <code><a href="#Die">Die</a></code>.</p>

<p>Don't confuse this with <code><a href="#d">d()</a></code>:</p>

<ul>
<li><code>Die([6])</code>: A <code><a href="#Die">Die</a></code> that always rolls the <code>int</code> 6.</li>
<li><code>d(6)</code>: A d6.</li>
</ul>

<p>Also, don't confuse this with <code><a href="#Pool">Pool()</a></code>:</p>

<ul>
<li><code>Die([1, 2, 3, 4, 5, 6])</code>: A d6.</li>
<li><code>Pool([1, 2, 3, 4, 5, 6])</code>: A <code><a href="#Pool">Pool</a></code> of six dice that always rolls one
of each number.</li>
</ul>

<p>Here are some different ways of constructing a d6:</p>

<ul>
<li>Just import it: <code>from icepool import d6</code></li>
<li>Use the <code><a href="#d">d()</a></code> function: <code><a href="#d">d</a>(6)</code></li>
<li>Use a d6 that you already have: <code>Die(d6)</code> or <code>Die([d6])</code></li>
<li>Mix a d3 and a d3+3: <code>Die([d3, d3+3])</code></li>
<li>Use a dict: <code>Die({1:1, 2:1, 3:1, 4:1, 5:1, 6:1})</code></li>
<li>Give the faces as a sequence: <code>Die([1, 2, 3, 4, 5, 6])</code></li>
</ul>

<p>All quantities must be non-negative, though they can be zero.</p>

<p>Several methods and functions foward **kwargs to this constructor.
However, these only affect the construction of the returned or yielded
dice. Any other implicit conversions of arguments or operands to dice
will be done with the default keyword arguments.</p>

<p>EXPERIMENTAL: Use <code><a href="#Again">Again</a></code> to roll the dice again, usually with
some modification. See the <code><a href="#Again">Again</a></code> documentation for details.</p>

<p>Denominator: For a flat set of outcomes, the denominator is just the
sum of the corresponding quantities. If the outcomes themselves have
secondary denominators, then the overall denominator will be minimized
while preserving the relative weighting of the primary outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>outcomes:</strong>  The faces of the <code><a href="#Die">Die</a></code>. This can be one of the following:</p>

<ul>
<li>A <code>Sequence</code> of outcomes. Duplicates will contribute
quantity for each appearance.</li>
<li>A <code>Mapping</code> from outcomes to quantities.</li>
</ul>

<p>Individual outcomes can each be one of the following:</p>

<ul>
<li>An outcome, which must be hashable and totally orderable.
<ul>
<li>For convenience, <code>tuple</code>s containing <code><a href="#Population">Population</a></code>s will be
<code><a href="#tupleize">tupleize</a></code>d into a <code><a href="#Population">Population</a></code> of <code>tuple</code>s.
This does not apply to subclasses of <code>tuple</code>s such as <code>namedtuple</code>
or other classes such as <code><a href="#Vector">Vector</a></code>.</li>
</ul></li>
<li>A <code><a href="#Die">Die</a></code>, which will be flattened into the result.
The quantity assigned to a <code><a href="#Die">Die</a></code> is shared among its
outcomes. The total denominator will be scaled up if
necessary.</li>
<li><code><a href="#Reroll">Reroll</a></code>, which will drop itself from consideration.</li>
<li>EXPERIMENTAL: <code><a href="#Again">Again</a></code>. See the documentation for
<code><a href="#Again">Again</a></code> for details.</li>
</ul></li>
<li><strong>times:</strong>  Multiplies the quantity of each element of <code><a href="#Die.outcomes">outcomes</a></code>.
<code>times</code> can either be a sequence of the same length as
<code><a href="#Die.outcomes">outcomes</a></code> or a single <code>int</code> to apply to all elements of
<code><a href="#Die.outcomes">outcomes</a></code>.</li>
<li><strong>again_count, again_depth, again_end:</strong>  These affect how <code><a href="#Again">Again</a></code>
expressions are handled. See the <code><a href="#Again">Again</a></code> documentation for
details.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  <code>None</code> is not a valid outcome for a <code><a href="#Die">Die</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Die.unary_operator" class="classattr">
                                        <input id="Die.unary_operator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unary_operator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>,</span><span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.unary_operator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.unary_operator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.unary_operator-197"><a href="#Die.unary_operator-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">unary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;icepool.Die[T_co]&#39;</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Die.unary_operator-198"><a href="#Die.unary_operator-198"><span class="linenos">198</span></a>                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die.unary_operator-199"><a href="#Die.unary_operator-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs the unary operation on the outcomes.</span>
</span><span id="Die.unary_operator-200"><a href="#Die.unary_operator-200"><span class="linenos">200</span></a>
</span><span id="Die.unary_operator-201"><a href="#Die.unary_operator-201"><span class="linenos">201</span></a><span class="sd">        This is used for the standard unary operators</span>
</span><span id="Die.unary_operator-202"><a href="#Die.unary_operator-202"><span class="linenos">202</span></a><span class="sd">        `-, +, abs, ~, round, trunc, floor, ceil`</span>
</span><span id="Die.unary_operator-203"><a href="#Die.unary_operator-203"><span class="linenos">203</span></a><span class="sd">        as well as the additional methods</span>
</span><span id="Die.unary_operator-204"><a href="#Die.unary_operator-204"><span class="linenos">204</span></a><span class="sd">        `zero, bool`.</span>
</span><span id="Die.unary_operator-205"><a href="#Die.unary_operator-205"><span class="linenos">205</span></a>
</span><span id="Die.unary_operator-206"><a href="#Die.unary_operator-206"><span class="linenos">206</span></a><span class="sd">        This is NOT used for the `[]` operator; when used directly, this is</span>
</span><span id="Die.unary_operator-207"><a href="#Die.unary_operator-207"><span class="linenos">207</span></a><span class="sd">        interpreted as a `Mapping` operation and returns the count corresponding</span>
</span><span id="Die.unary_operator-208"><a href="#Die.unary_operator-208"><span class="linenos">208</span></a><span class="sd">        to a given outcome. See `marginals()` for applying the `[]` operator to</span>
</span><span id="Die.unary_operator-209"><a href="#Die.unary_operator-209"><span class="linenos">209</span></a><span class="sd">        outcomes.</span>
</span><span id="Die.unary_operator-210"><a href="#Die.unary_operator-210"><span class="linenos">210</span></a>
</span><span id="Die.unary_operator-211"><a href="#Die.unary_operator-211"><span class="linenos">211</span></a><span class="sd">        Returns:</span>
</span><span id="Die.unary_operator-212"><a href="#Die.unary_operator-212"><span class="linenos">212</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die.unary_operator-213"><a href="#Die.unary_operator-213"><span class="linenos">213</span></a>
</span><span id="Die.unary_operator-214"><a href="#Die.unary_operator-214"><span class="linenos">214</span></a><span class="sd">        Raises:</span>
</span><span id="Die.unary_operator-215"><a href="#Die.unary_operator-215"><span class="linenos">215</span></a><span class="sd">            ValueError: If tuples are of mismatched length.</span>
</span><span id="Die.unary_operator-216"><a href="#Die.unary_operator-216"><span class="linenos">216</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.unary_operator-217"><a href="#Die.unary_operator-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unary_operator</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs the unary operation on the outcomes.</p>

<p>This is used for the standard unary operators
<code>-, +, abs, ~, round, trunc, floor, ceil</code>
as well as the additional methods
<code>zero, bool</code>.</p>

<p>This is NOT used for the <code>[]</code> operator; when used directly, this is
interpreted as a <code>Mapping</code> operation and returns the count corresponding
to a given outcome. See <code><a href="#Die.marginals">marginals()</a></code> for applying the <code>[]</code> operator to
outcomes.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the result.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If tuples are of mismatched length.</li>
</ul>
</div>


                            </div>
                            <div id="Die.binary_operator" class="classattr">
                                        <input id="Die.binary_operator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">binary_operator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n"><a href="#Die">Die</a></span>,</span><span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.binary_operator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.binary_operator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.binary_operator-219"><a href="#Die.binary_operator-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Die.binary_operator-220"><a href="#Die.binary_operator-220"><span class="linenos">220</span></a>                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die.binary_operator-221"><a href="#Die.binary_operator-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs the operation on pairs of outcomes.</span>
</span><span id="Die.binary_operator-222"><a href="#Die.binary_operator-222"><span class="linenos">222</span></a>
</span><span id="Die.binary_operator-223"><a href="#Die.binary_operator-223"><span class="linenos">223</span></a><span class="sd">        By the time this is called, the other operand has already been</span>
</span><span id="Die.binary_operator-224"><a href="#Die.binary_operator-224"><span class="linenos">224</span></a><span class="sd">        converted to a `Die`.</span>
</span><span id="Die.binary_operator-225"><a href="#Die.binary_operator-225"><span class="linenos">225</span></a>
</span><span id="Die.binary_operator-226"><a href="#Die.binary_operator-226"><span class="linenos">226</span></a><span class="sd">        If one side of a binary operator is a tuple and the other is not, the</span>
</span><span id="Die.binary_operator-227"><a href="#Die.binary_operator-227"><span class="linenos">227</span></a><span class="sd">        binary operator is applied to each element of the tuple with the</span>
</span><span id="Die.binary_operator-228"><a href="#Die.binary_operator-228"><span class="linenos">228</span></a><span class="sd">        non-tuple side. For example, the following are equivalent:</span>
</span><span id="Die.binary_operator-229"><a href="#Die.binary_operator-229"><span class="linenos">229</span></a>
</span><span id="Die.binary_operator-230"><a href="#Die.binary_operator-230"><span class="linenos">230</span></a><span class="sd">        ```python</span>
</span><span id="Die.binary_operator-231"><a href="#Die.binary_operator-231"><span class="linenos">231</span></a><span class="sd">        cartesian_product(d6, d8) * 2</span>
</span><span id="Die.binary_operator-232"><a href="#Die.binary_operator-232"><span class="linenos">232</span></a><span class="sd">        cartesian_product(d6 * 2, d8 * 2)</span>
</span><span id="Die.binary_operator-233"><a href="#Die.binary_operator-233"><span class="linenos">233</span></a><span class="sd">        ```</span>
</span><span id="Die.binary_operator-234"><a href="#Die.binary_operator-234"><span class="linenos">234</span></a>
</span><span id="Die.binary_operator-235"><a href="#Die.binary_operator-235"><span class="linenos">235</span></a><span class="sd">        This is used for the standard binary operators</span>
</span><span id="Die.binary_operator-236"><a href="#Die.binary_operator-236"><span class="linenos">236</span></a><span class="sd">        `+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^`</span>
</span><span id="Die.binary_operator-237"><a href="#Die.binary_operator-237"><span class="linenos">237</span></a><span class="sd">        and the standard binary comparators</span>
</span><span id="Die.binary_operator-238"><a href="#Die.binary_operator-238"><span class="linenos">238</span></a><span class="sd">        `&lt;, &lt;=, &gt;=, &gt;, ==, !=, cmp`.</span>
</span><span id="Die.binary_operator-239"><a href="#Die.binary_operator-239"><span class="linenos">239</span></a>
</span><span id="Die.binary_operator-240"><a href="#Die.binary_operator-240"><span class="linenos">240</span></a><span class="sd">        `==` and `!=` additionally set the truth value of the `Die` according to</span>
</span><span id="Die.binary_operator-241"><a href="#Die.binary_operator-241"><span class="linenos">241</span></a><span class="sd">        whether the dice themselves are the same or not.</span>
</span><span id="Die.binary_operator-242"><a href="#Die.binary_operator-242"><span class="linenos">242</span></a>
</span><span id="Die.binary_operator-243"><a href="#Die.binary_operator-243"><span class="linenos">243</span></a><span class="sd">        The `@` operator does NOT use this method directly.</span>
</span><span id="Die.binary_operator-244"><a href="#Die.binary_operator-244"><span class="linenos">244</span></a><span class="sd">        It rolls the left `Die`, which must have integer outcomes,</span>
</span><span id="Die.binary_operator-245"><a href="#Die.binary_operator-245"><span class="linenos">245</span></a><span class="sd">        then rolls the right `Die` that many times and sums the outcomes.</span>
</span><span id="Die.binary_operator-246"><a href="#Die.binary_operator-246"><span class="linenos">246</span></a>
</span><span id="Die.binary_operator-247"><a href="#Die.binary_operator-247"><span class="linenos">247</span></a><span class="sd">        Returns:</span>
</span><span id="Die.binary_operator-248"><a href="#Die.binary_operator-248"><span class="linenos">248</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die.binary_operator-249"><a href="#Die.binary_operator-249"><span class="linenos">249</span></a>
</span><span id="Die.binary_operator-250"><a href="#Die.binary_operator-250"><span class="linenos">250</span></a><span class="sd">        Raises:</span>
</span><span id="Die.binary_operator-251"><a href="#Die.binary_operator-251"><span class="linenos">251</span></a><span class="sd">            ValueError: If tuples are of mismatched length within one of the</span>
</span><span id="Die.binary_operator-252"><a href="#Die.binary_operator-252"><span class="linenos">252</span></a><span class="sd">                dice or between the dice.</span>
</span><span id="Die.binary_operator-253"><a href="#Die.binary_operator-253"><span class="linenos">253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.binary_operator-254"><a href="#Die.binary_operator-254"><span class="linenos">254</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die.binary_operator-255"><a href="#Die.binary_operator-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span>
</span><span id="Die.binary_operator-256"><a href="#Die.binary_operator-256"><span class="linenos">256</span></a>             <span class="n">quantity_self</span><span class="p">),</span> <span class="p">(</span><span class="n">outcome_other</span><span class="p">,</span>
</span><span id="Die.binary_operator-257"><a href="#Die.binary_operator-257"><span class="linenos">257</span></a>                              <span class="n">quantity_other</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
</span><span id="Die.binary_operator-258"><a href="#Die.binary_operator-258"><span class="linenos">258</span></a>                                  <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="Die.binary_operator-259"><a href="#Die.binary_operator-259"><span class="linenos">259</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span> <span class="n">outcome_other</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Die.binary_operator-260"><a href="#Die.binary_operator-260"><span class="linenos">260</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity_self</span> <span class="o">*</span> <span class="n">quantity_other</span>
</span><span id="Die.binary_operator-261"><a href="#Die.binary_operator-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs the operation on pairs of outcomes.</p>

<p>By the time this is called, the other operand has already been
converted to a <code><a href="#Die">Die</a></code>.</p>

<p>If one side of a binary operator is a tuple and the other is not, the
binary operator is applied to each element of the tuple with the
non-tuple side. For example, the following are equivalent:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">cartesian_product</span><span class="p">(</span><span class="n">d6</span><span class="p">,</span> <span class="n">d8</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">cartesian_product</span><span class="p">(</span><span class="n">d6</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">d8</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>

<p>This is used for the standard binary operators
<code>+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^</code>
and the standard binary comparators
<code>&lt;, &lt;=, &gt;=, &gt;, ==, !=, cmp</code>.</p>

<p><code>==</code> and <code>!=</code> additionally set the truth value of the <code><a href="#Die">Die</a></code> according to
whether the dice themselves are the same or not.</p>

<p>The <code>@</code> operator does NOT use this method directly.
It rolls the left <code><a href="#Die">Die</a></code>, which must have integer outcomes,
then rolls the right <code><a href="#Die">Die</a></code> that many times and sums the outcomes.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the result.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If tuples are of mismatched length within one of the
dice or between the dice.</li>
</ul>
</div>


                            </div>
                            <div id="Die.keys" class="classattr">
                                        <input id="Die.keys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">CountsKeysView</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.keys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.keys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.keys-265"><a href="#Die.keys-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Die.keys-266"><a href="#Die.keys-266"><span class="linenos">266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes within the population in sorted order.</p>
</div>


                            </div>
                            <div id="Die.values" class="classattr">
                                        <input id="Die.values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsValuesView">CountsValuesView</a></span>:</span></span>

                <label class="view-source-button" for="Die.values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.values-268"><a href="#Die.values-268"><span class="linenos">268</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Die.values-269"><a href="#Die.values-269"><span class="linenos">269</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The quantities within the population in outcome order.</p>
</div>


                            </div>
                            <div id="Die.items" class="classattr">
                                        <input id="Die.items-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">items</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsItemsView">CountsItemsView</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.items-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.items"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.items-271"><a href="#Die.items-271"><span class="linenos">271</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Die.items-272"><a href="#Die.items-272"><span class="linenos">272</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The (outcome, quantity)s of the population in sorted order.</p>
</div>


                            </div>
                            <div id="Die.simplify" class="classattr">
                                        <input id="Die.simplify-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">simplify</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.simplify-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.simplify"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.simplify-289"><a href="#Die.simplify-289"><span class="linenos">289</span></a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.simplify-290"><a href="#Die.simplify-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divides all quantities by their greatest common denominator. &quot;&quot;&quot;</span>
</span><span id="Die.simplify-291"><a href="#Die.simplify-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">simplify</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Divides all quantities by their greatest common denominator.</p>
</div>


                            </div>
                            <div id="Die.reroll" class="classattr">
                                        <input id="Die.reroll-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reroll</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.reroll-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.reroll"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.reroll-318"><a href="#Die.reroll-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">reroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.reroll-319"><a href="#Die.reroll-319"><span class="linenos">319</span></a>               <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.reroll-320"><a href="#Die.reroll-320"><span class="linenos">320</span></a>               <span class="o">/</span><span class="p">,</span>
</span><span id="Die.reroll-321"><a href="#Die.reroll-321"><span class="linenos">321</span></a>               <span class="o">*</span><span class="p">,</span>
</span><span id="Die.reroll-322"><a href="#Die.reroll-322"><span class="linenos">322</span></a>               <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.reroll-323"><a href="#Die.reroll-323"><span class="linenos">323</span></a>               <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.reroll-324"><a href="#Die.reroll-324"><span class="linenos">324</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rerolls the given outcomes.</span>
</span><span id="Die.reroll-325"><a href="#Die.reroll-325"><span class="linenos">325</span></a>
</span><span id="Die.reroll-326"><a href="#Die.reroll-326"><span class="linenos">326</span></a><span class="sd">        Args:</span>
</span><span id="Die.reroll-327"><a href="#Die.reroll-327"><span class="linenos">327</span></a><span class="sd">            which: Selects which outcomes to reroll. Options:</span>
</span><span id="Die.reroll-328"><a href="#Die.reroll-328"><span class="linenos">328</span></a><span class="sd">                * A collection of outcomes to reroll.</span>
</span><span id="Die.reroll-329"><a href="#Die.reroll-329"><span class="linenos">329</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.reroll-330"><a href="#Die.reroll-330"><span class="linenos">330</span></a><span class="sd">                    should be rerolled.</span>
</span><span id="Die.reroll-331"><a href="#Die.reroll-331"><span class="linenos">331</span></a><span class="sd">                * If not provided, the min outcome will be rerolled.</span>
</span><span id="Die.reroll-332"><a href="#Die.reroll-332"><span class="linenos">332</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die.reroll-333"><a href="#Die.reroll-333"><span class="linenos">333</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die.reroll-334"><a href="#Die.reroll-334"><span class="linenos">334</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die.reroll-335"><a href="#Die.reroll-335"><span class="linenos">335</span></a><span class="sd">                signature.</span>
</span><span id="Die.reroll-336"><a href="#Die.reroll-336"><span class="linenos">336</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die.reroll-337"><a href="#Die.reroll-337"><span class="linenos">337</span></a><span class="sd">                If `None`, rerolls an unlimited number of times.</span>
</span><span id="Die.reroll-338"><a href="#Die.reroll-338"><span class="linenos">338</span></a>
</span><span id="Die.reroll-339"><a href="#Die.reroll-339"><span class="linenos">339</span></a><span class="sd">        Returns:</span>
</span><span id="Die.reroll-340"><a href="#Die.reroll-340"><span class="linenos">340</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die.reroll-341"><a href="#Die.reroll-341"><span class="linenos">341</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die.reroll-342"><a href="#Die.reroll-342"><span class="linenos">342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.reroll-343"><a href="#Die.reroll-343"><span class="linenos">343</span></a>
</span><span id="Die.reroll-344"><a href="#Die.reroll-344"><span class="linenos">344</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.reroll-345"><a href="#Die.reroll-345"><span class="linenos">345</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()}</span>
</span><span id="Die.reroll-346"><a href="#Die.reroll-346"><span class="linenos">346</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.reroll-347"><a href="#Die.reroll-347"><span class="linenos">347</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die.reroll-348"><a href="#Die.reroll-348"><span class="linenos">348</span></a>
</span><span id="Die.reroll-349"><a href="#Die.reroll-349"><span class="linenos">349</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.reroll-350"><a href="#Die.reroll-350"><span class="linenos">350</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll-351"><a href="#Die.reroll-351"><span class="linenos">351</span></a>                <span class="n">outcome</span><span class="p">:</span> <span class="n">quantity</span>
</span><span id="Die.reroll-352"><a href="#Die.reroll-352"><span class="linenos">352</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die.reroll-353"><a href="#Die.reroll-353"><span class="linenos">353</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outcome_set</span>
</span><span id="Die.reroll-354"><a href="#Die.reroll-354"><span class="linenos">354</span></a>            <span class="p">}</span>
</span><span id="Die.reroll-355"><a href="#Die.reroll-355"><span class="linenos">355</span></a>        <span class="k">elif</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.reroll-356"><a href="#Die.reroll-356"><span class="linenos">356</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;reroll depth cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Die.reroll-357"><a href="#Die.reroll-357"><span class="linenos">357</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.reroll-358"><a href="#Die.reroll-358"><span class="linenos">358</span></a>            <span class="n">total_reroll_quantity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">quantity</span>
</span><span id="Die.reroll-359"><a href="#Die.reroll-359"><span class="linenos">359</span></a>                                        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die.reroll-360"><a href="#Die.reroll-360"><span class="linenos">360</span></a>                                        <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span><span class="p">)</span>
</span><span id="Die.reroll-361"><a href="#Die.reroll-361"><span class="linenos">361</span></a>            <span class="n">total_stop_quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">total_reroll_quantity</span>
</span><span id="Die.reroll-362"><a href="#Die.reroll-362"><span class="linenos">362</span></a>            <span class="n">rerollable_factor</span> <span class="o">=</span> <span class="n">total_reroll_quantity</span><span class="o">**</span><span class="n">depth</span>
</span><span id="Die.reroll-363"><a href="#Die.reroll-363"><span class="linenos">363</span></a>            <span class="n">stop_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rerollable_factor</span>
</span><span id="Die.reroll-364"><a href="#Die.reroll-364"><span class="linenos">364</span></a>                           <span class="o">*</span> <span class="n">total_reroll_quantity</span><span class="p">)</span> <span class="o">//</span> <span class="n">total_stop_quantity</span>
</span><span id="Die.reroll-365"><a href="#Die.reroll-365"><span class="linenos">365</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll-366"><a href="#Die.reroll-366"><span class="linenos">366</span></a>                <span class="n">outcome</span><span class="p">:</span> <span class="p">(</span><span class="n">rerollable_factor</span> <span class="o">*</span>
</span><span id="Die.reroll-367"><a href="#Die.reroll-367"><span class="linenos">367</span></a>                          <span class="n">quantity</span> <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span> <span class="k">else</span> <span class="n">stop_factor</span> <span class="o">*</span>
</span><span id="Die.reroll-368"><a href="#Die.reroll-368"><span class="linenos">368</span></a>                          <span class="n">quantity</span><span class="p">)</span>
</span><span id="Die.reroll-369"><a href="#Die.reroll-369"><span class="linenos">369</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die.reroll-370"><a href="#Die.reroll-370"><span class="linenos">370</span></a>            <span class="p">}</span>
</span><span id="Die.reroll-371"><a href="#Die.reroll-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rerolls the given outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>which:</strong>  Selects which outcomes to reroll. Options:
<ul>
<li>A collection of outcomes to reroll.</li>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be rerolled.</li>
<li>If not provided, the min outcome will be rerolled.</li>
</ul></li>
<li><strong>star:</strong>  Whether outcomes should be unpacked into separate arguments
before sending them to a callable <code>which</code>.
If not provided, this will be guessed based on the function
signature.</li>
<li><strong>depth:</strong>  The maximum number of times to reroll.
If <code>None</code>, rerolls an unlimited number of times.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the reroll.
  If the reroll would never terminate, the result has no outcomes.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.filter" class="classattr">
                                        <input id="Die.filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">filter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.filter-373"><a href="#Die.filter-373"><span class="linenos">373</span></a>    <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.filter-374"><a href="#Die.filter-374"><span class="linenos">374</span></a>               <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
</span><span id="Die.filter-375"><a href="#Die.filter-375"><span class="linenos">375</span></a>               <span class="o">/</span><span class="p">,</span>
</span><span id="Die.filter-376"><a href="#Die.filter-376"><span class="linenos">376</span></a>               <span class="o">*</span><span class="p">,</span>
</span><span id="Die.filter-377"><a href="#Die.filter-377"><span class="linenos">377</span></a>               <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.filter-378"><a href="#Die.filter-378"><span class="linenos">378</span></a>               <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.filter-379"><a href="#Die.filter-379"><span class="linenos">379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Rerolls until getting one of the given outcomes.</span>
</span><span id="Die.filter-380"><a href="#Die.filter-380"><span class="linenos">380</span></a>
</span><span id="Die.filter-381"><a href="#Die.filter-381"><span class="linenos">381</span></a><span class="sd">        Essentially the complement of `reroll()`.</span>
</span><span id="Die.filter-382"><a href="#Die.filter-382"><span class="linenos">382</span></a>
</span><span id="Die.filter-383"><a href="#Die.filter-383"><span class="linenos">383</span></a><span class="sd">        Args:</span>
</span><span id="Die.filter-384"><a href="#Die.filter-384"><span class="linenos">384</span></a><span class="sd">            which: Selects which outcomes to reroll until. Options:</span>
</span><span id="Die.filter-385"><a href="#Die.filter-385"><span class="linenos">385</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.filter-386"><a href="#Die.filter-386"><span class="linenos">386</span></a><span class="sd">                    should be accepted.</span>
</span><span id="Die.filter-387"><a href="#Die.filter-387"><span class="linenos">387</span></a><span class="sd">                * A collection of outcomes to reroll until.</span>
</span><span id="Die.filter-388"><a href="#Die.filter-388"><span class="linenos">388</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die.filter-389"><a href="#Die.filter-389"><span class="linenos">389</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die.filter-390"><a href="#Die.filter-390"><span class="linenos">390</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die.filter-391"><a href="#Die.filter-391"><span class="linenos">391</span></a><span class="sd">                signature.</span>
</span><span id="Die.filter-392"><a href="#Die.filter-392"><span class="linenos">392</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die.filter-393"><a href="#Die.filter-393"><span class="linenos">393</span></a><span class="sd">                If `None`, rerolls an unlimited number of times.</span>
</span><span id="Die.filter-394"><a href="#Die.filter-394"><span class="linenos">394</span></a>
</span><span id="Die.filter-395"><a href="#Die.filter-395"><span class="linenos">395</span></a><span class="sd">        Returns:</span>
</span><span id="Die.filter-396"><a href="#Die.filter-396"><span class="linenos">396</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die.filter-397"><a href="#Die.filter-397"><span class="linenos">397</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die.filter-398"><a href="#Die.filter-398"><span class="linenos">398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.filter-399"><a href="#Die.filter-399"><span class="linenos">399</span></a>
</span><span id="Die.filter-400"><a href="#Die.filter-400"><span class="linenos">400</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">which</span><span class="p">):</span>
</span><span id="Die.filter-401"><a href="#Die.filter-401"><span class="linenos">401</span></a>            <span class="k">if</span> <span class="n">star</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.filter-402"><a href="#Die.filter-402"><span class="linenos">402</span></a>                <span class="n">star</span> <span class="o">=</span> <span class="n">guess_star</span><span class="p">(</span><span class="n">which</span><span class="p">)</span>
</span><span id="Die.filter-403"><a href="#Die.filter-403"><span class="linenos">403</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die.filter-404"><a href="#Die.filter-404"><span class="linenos">404</span></a>
</span><span id="Die.filter-405"><a href="#Die.filter-405"><span class="linenos">405</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.filter-406"><a href="#Die.filter-406"><span class="linenos">406</span></a>                    <span class="n">outcome</span>
</span><span id="Die.filter-407"><a href="#Die.filter-407"><span class="linenos">407</span></a>                    <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.filter-408"><a href="#Die.filter-408"><span class="linenos">408</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Die.filter-409"><a href="#Die.filter-409"><span class="linenos">409</span></a>                <span class="p">}</span>
</span><span id="Die.filter-410"><a href="#Die.filter-410"><span class="linenos">410</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.filter-411"><a href="#Die.filter-411"><span class="linenos">411</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.filter-412"><a href="#Die.filter-412"><span class="linenos">412</span></a>                    <span class="n">outcome</span>
</span><span id="Die.filter-413"><a href="#Die.filter-413"><span class="linenos">413</span></a>                    <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">which</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Die.filter-414"><a href="#Die.filter-414"><span class="linenos">414</span></a>                <span class="p">}</span>
</span><span id="Die.filter-415"><a href="#Die.filter-415"><span class="linenos">415</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.filter-416"><a href="#Die.filter-416"><span class="linenos">416</span></a>            <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.filter-417"><a href="#Die.filter-417"><span class="linenos">417</span></a>                <span class="n">not_outcome</span>
</span><span id="Die.filter-418"><a href="#Die.filter-418"><span class="linenos">418</span></a>                <span class="k">for</span> <span class="n">not_outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="k">if</span> <span class="n">not_outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">which</span>
</span><span id="Die.filter-419"><a href="#Die.filter-419"><span class="linenos">419</span></a>            <span class="p">}</span>
</span><span id="Die.filter-420"><a href="#Die.filter-420"><span class="linenos">420</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reroll</span><span class="p">(</span><span class="n">not_outcomes</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rerolls until getting one of the given outcomes.</p>

<p>Essentially the complement of <code><a href="#Die.reroll">reroll()</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>which:</strong>  Selects which outcomes to reroll until. Options:
<ul>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be accepted.</li>
<li>A collection of outcomes to reroll until.</li>
</ul></li>
<li><strong>star:</strong>  Whether outcomes should be unpacked into separate arguments
before sending them to a callable <code>which</code>.
If not provided, this will be guessed based on the function
signature.</li>
<li><strong>depth:</strong>  The maximum number of times to reroll.
If <code>None</code>, rerolls an unlimited number of times.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the reroll.
  If the reroll would never terminate, the result has no outcomes.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.split" class="classattr">
                                        <input id="Die.split-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Die.split-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.split"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.split-422"><a href="#Die.split-422"><span class="linenos">422</span></a>    <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.split-423"><a href="#Die.split-423"><span class="linenos">423</span></a>              <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.split-424"><a href="#Die.split-424"><span class="linenos">424</span></a>              <span class="o">/</span><span class="p">,</span>
</span><span id="Die.split-425"><a href="#Die.split-425"><span class="linenos">425</span></a>              <span class="o">*</span><span class="p">,</span>
</span><span id="Die.split-426"><a href="#Die.split-426"><span class="linenos">426</span></a>              <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Die.split-427"><a href="#Die.split-427"><span class="linenos">427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Splits this die into one containing selected items and another containing the rest.</span>
</span><span id="Die.split-428"><a href="#Die.split-428"><span class="linenos">428</span></a>
</span><span id="Die.split-429"><a href="#Die.split-429"><span class="linenos">429</span></a><span class="sd">        The total denominator is preserved.</span>
</span><span id="Die.split-430"><a href="#Die.split-430"><span class="linenos">430</span></a><span class="sd">        </span>
</span><span id="Die.split-431"><a href="#Die.split-431"><span class="linenos">431</span></a><span class="sd">        Equivalent to `self.filter(), self.reroll()`.</span>
</span><span id="Die.split-432"><a href="#Die.split-432"><span class="linenos">432</span></a>
</span><span id="Die.split-433"><a href="#Die.split-433"><span class="linenos">433</span></a><span class="sd">        Args:</span>
</span><span id="Die.split-434"><a href="#Die.split-434"><span class="linenos">434</span></a><span class="sd">            which: Selects which outcomes to reroll until. Options:</span>
</span><span id="Die.split-435"><a href="#Die.split-435"><span class="linenos">435</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.split-436"><a href="#Die.split-436"><span class="linenos">436</span></a><span class="sd">                    should be accepted.</span>
</span><span id="Die.split-437"><a href="#Die.split-437"><span class="linenos">437</span></a><span class="sd">                * A collection of outcomes to reroll until.</span>
</span><span id="Die.split-438"><a href="#Die.split-438"><span class="linenos">438</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die.split-439"><a href="#Die.split-439"><span class="linenos">439</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die.split-440"><a href="#Die.split-440"><span class="linenos">440</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die.split-441"><a href="#Die.split-441"><span class="linenos">441</span></a><span class="sd">                signature.</span>
</span><span id="Die.split-442"><a href="#Die.split-442"><span class="linenos">442</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.split-443"><a href="#Die.split-443"><span class="linenos">443</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.split-444"><a href="#Die.split-444"><span class="linenos">444</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()}</span>
</span><span id="Die.split-445"><a href="#Die.split-445"><span class="linenos">445</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.split-446"><a href="#Die.split-446"><span class="linenos">446</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die.split-447"><a href="#Die.split-447"><span class="linenos">447</span></a>
</span><span id="Die.split-448"><a href="#Die.split-448"><span class="linenos">448</span></a>        <span class="n">selected</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die.split-449"><a href="#Die.split-449"><span class="linenos">449</span></a>        <span class="n">not_selected</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die.split-450"><a href="#Die.split-450"><span class="linenos">450</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die.split-451"><a href="#Die.split-451"><span class="linenos">451</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span><span class="p">:</span>
</span><span id="Die.split-452"><a href="#Die.split-452"><span class="linenos">452</span></a>                <span class="n">selected</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="Die.split-453"><a href="#Die.split-453"><span class="linenos">453</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.split-454"><a href="#Die.split-454"><span class="linenos">454</span></a>                <span class="n">not_selected</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span>
</span><span id="Die.split-455"><a href="#Die.split-455"><span class="linenos">455</span></a>
</span><span id="Die.split-456"><a href="#Die.split-456"><span class="linenos">456</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="p">(</span><span class="n">selected</span><span class="p">),</span> <span class="n">Die</span><span class="p">(</span><span class="n">not_selected</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Splits this die into one containing selected items and another containing the rest.</p>

<p>The total denominator is preserved.</p>

<p>Equivalent to <code>self.filter(), self.reroll()</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>which:</strong>  Selects which outcomes to reroll until. Options:
<ul>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be accepted.</li>
<li>A collection of outcomes to reroll until.</li>
</ul></li>
<li><strong>star:</strong>  Whether outcomes should be unpacked into separate arguments
before sending them to a callable <code>which</code>.
If not provided, this will be guessed based on the function
signature.</li>
</ul>
</div>


                            </div>
                            <div id="Die.truncate" class="classattr">
                                        <input id="Die.truncate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">truncate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.truncate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.truncate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.truncate-458"><a href="#Die.truncate-458"><span class="linenos">458</span></a>    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.truncate-459"><a href="#Die.truncate-459"><span class="linenos">459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Truncates the outcomes of this `Die` to the given range.</span>
</span><span id="Die.truncate-460"><a href="#Die.truncate-460"><span class="linenos">460</span></a>
</span><span id="Die.truncate-461"><a href="#Die.truncate-461"><span class="linenos">461</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die.truncate-462"><a href="#Die.truncate-462"><span class="linenos">462</span></a><span class="sd">        If one of the arguments is not provided, that side will not be truncated.</span>
</span><span id="Die.truncate-463"><a href="#Die.truncate-463"><span class="linenos">463</span></a>
</span><span id="Die.truncate-464"><a href="#Die.truncate-464"><span class="linenos">464</span></a><span class="sd">        This effectively rerolls outcomes outside the given range.</span>
</span><span id="Die.truncate-465"><a href="#Die.truncate-465"><span class="linenos">465</span></a><span class="sd">        If instead you want to replace those outcomes with the nearest endpoint,</span>
</span><span id="Die.truncate-466"><a href="#Die.truncate-466"><span class="linenos">466</span></a><span class="sd">        use `clip()`.</span>
</span><span id="Die.truncate-467"><a href="#Die.truncate-467"><span class="linenos">467</span></a>
</span><span id="Die.truncate-468"><a href="#Die.truncate-468"><span class="linenos">468</span></a><span class="sd">        Not to be confused with `trunc(die)`, which performs integer truncation</span>
</span><span id="Die.truncate-469"><a href="#Die.truncate-469"><span class="linenos">469</span></a><span class="sd">        on each outcome.</span>
</span><span id="Die.truncate-470"><a href="#Die.truncate-470"><span class="linenos">470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.truncate-471"><a href="#Die.truncate-471"><span class="linenos">471</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.truncate-472"><a href="#Die.truncate-472"><span class="linenos">472</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">min_outcome</span><span class="p">)</span>
</span><span id="Die.truncate-473"><a href="#Die.truncate-473"><span class="linenos">473</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.truncate-474"><a href="#Die.truncate-474"><span class="linenos">474</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.truncate-475"><a href="#Die.truncate-475"><span class="linenos">475</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.truncate-476"><a href="#Die.truncate-476"><span class="linenos">476</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">max_outcome</span><span class="p">)</span>
</span><span id="Die.truncate-477"><a href="#Die.truncate-477"><span class="linenos">477</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.truncate-478"><a href="#Die.truncate-478"><span class="linenos">478</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.truncate-479"><a href="#Die.truncate-479"><span class="linenos">479</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]}</span>
</span><span id="Die.truncate-480"><a href="#Die.truncate-480"><span class="linenos">480</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Truncates the outcomes of this <code><a href="#Die">Die</a></code> to the given range.</p>

<p>The endpoints are included in the result if applicable.
If one of the arguments is not provided, that side will not be truncated.</p>

<p>This effectively rerolls outcomes outside the given range.
If instead you want to replace those outcomes with the nearest endpoint,
use <code><a href="#Die.clip">clip()</a></code>.</p>

<p>Not to be confused with <code>trunc(die)</code>, which performs integer truncation
on each outcome.</p>
</div>


                            </div>
                            <div id="Die.clip" class="classattr">
                                        <input id="Die.clip-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clip</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.clip-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.clip"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.clip-482"><a href="#Die.clip-482"><span class="linenos">482</span></a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.clip-483"><a href="#Die.clip-483"><span class="linenos">483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clips the outcomes of this `Die` to the given values.</span>
</span><span id="Die.clip-484"><a href="#Die.clip-484"><span class="linenos">484</span></a>
</span><span id="Die.clip-485"><a href="#Die.clip-485"><span class="linenos">485</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die.clip-486"><a href="#Die.clip-486"><span class="linenos">486</span></a><span class="sd">        If one of the arguments is not provided, that side will not be clipped.</span>
</span><span id="Die.clip-487"><a href="#Die.clip-487"><span class="linenos">487</span></a>
</span><span id="Die.clip-488"><a href="#Die.clip-488"><span class="linenos">488</span></a><span class="sd">        This is not the same as rerolling outcomes beyond this range;</span>
</span><span id="Die.clip-489"><a href="#Die.clip-489"><span class="linenos">489</span></a><span class="sd">        the outcome is simply adjusted to fit within the range.</span>
</span><span id="Die.clip-490"><a href="#Die.clip-490"><span class="linenos">490</span></a><span class="sd">        This will typically cause some quantity to bunch up at the endpoint.</span>
</span><span id="Die.clip-491"><a href="#Die.clip-491"><span class="linenos">491</span></a><span class="sd">        If you want to reroll outcomes beyond this range, use `truncate()`.</span>
</span><span id="Die.clip-492"><a href="#Die.clip-492"><span class="linenos">492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.clip-493"><a href="#Die.clip-493"><span class="linenos">493</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die.clip-494"><a href="#Die.clip-494"><span class="linenos">494</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die.clip-495"><a href="#Die.clip-495"><span class="linenos">495</span></a>            <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&lt;=</span> <span class="n">min_outcome</span><span class="p">:</span>
</span><span id="Die.clip-496"><a href="#Die.clip-496"><span class="linenos">496</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">min_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die.clip-497"><a href="#Die.clip-497"><span class="linenos">497</span></a>            <span class="k">elif</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&gt;=</span> <span class="n">max_outcome</span><span class="p">:</span>
</span><span id="Die.clip-498"><a href="#Die.clip-498"><span class="linenos">498</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">max_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die.clip-499"><a href="#Die.clip-499"><span class="linenos">499</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.clip-500"><a href="#Die.clip-500"><span class="linenos">500</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die.clip-501"><a href="#Die.clip-501"><span class="linenos">501</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Clips the outcomes of this <code><a href="#Die">Die</a></code> to the given values.</p>

<p>The endpoints are included in the result if applicable.
If one of the arguments is not provided, that side will not be clipped.</p>

<p>This is not the same as rerolling outcomes beyond this range;
the outcome is simply adjusted to fit within the range.
This will typically cause some quantity to bunch up at the endpoint.
If you want to reroll outcomes beyond this range, use <code><a href="#Die.truncate">truncate()</a></code>.</p>
</div>


                            </div>
                            <div id="Die.set_range" class="classattr">
                                        <input id="Die.set_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_range</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">min_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.set_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.set_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.set_range-503"><a href="#Die.set_range-503"><span class="linenos">503</span></a>    <span class="k">def</span> <span class="nf">set_range</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">,</span>
</span><span id="Die.set_range-504"><a href="#Die.set_range-504"><span class="linenos">504</span></a>                  <span class="n">min_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.set_range-505"><a href="#Die.set_range-505"><span class="linenos">505</span></a>                  <span class="n">max_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die.set_range-506"><a href="#Die.set_range-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the outcomes of this `Die` to the given `int` range (inclusive).</span>
</span><span id="Die.set_range-507"><a href="#Die.set_range-507"><span class="linenos">507</span></a>
</span><span id="Die.set_range-508"><a href="#Die.set_range-508"><span class="linenos">508</span></a><span class="sd">        This may remove outcomes (if they are not within the range)</span>
</span><span id="Die.set_range-509"><a href="#Die.set_range-509"><span class="linenos">509</span></a><span class="sd">        and/or add zero-quantity outcomes (if they are in range but not present</span>
</span><span id="Die.set_range-510"><a href="#Die.set_range-510"><span class="linenos">510</span></a><span class="sd">        in this `Die`).</span>
</span><span id="Die.set_range-511"><a href="#Die.set_range-511"><span class="linenos">511</span></a>
</span><span id="Die.set_range-512"><a href="#Die.set_range-512"><span class="linenos">512</span></a><span class="sd">        Args:</span>
</span><span id="Die.set_range-513"><a href="#Die.set_range-513"><span class="linenos">513</span></a><span class="sd">            min_outcome: The min outcome of the result.</span>
</span><span id="Die.set_range-514"><a href="#Die.set_range-514"><span class="linenos">514</span></a><span class="sd">                If omitted, the min outcome of this `Die` will be used.</span>
</span><span id="Die.set_range-515"><a href="#Die.set_range-515"><span class="linenos">515</span></a><span class="sd">            max_outcome: The max outcome of the result.</span>
</span><span id="Die.set_range-516"><a href="#Die.set_range-516"><span class="linenos">516</span></a><span class="sd">                If omitted, the max outcome of this `Die` will be used.</span>
</span><span id="Die.set_range-517"><a href="#Die.set_range-517"><span class="linenos">517</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.set_range-518"><a href="#Die.set_range-518"><span class="linenos">518</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.set_range-519"><a href="#Die.set_range-519"><span class="linenos">519</span></a>            <span class="n">min_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="Die.set_range-520"><a href="#Die.set_range-520"><span class="linenos">520</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.set_range-521"><a href="#Die.set_range-521"><span class="linenos">521</span></a>            <span class="n">max_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Die.set_range-522"><a href="#Die.set_range-522"><span class="linenos">522</span></a>
</span><span id="Die.set_range-523"><a href="#Die.set_range-523"><span class="linenos">523</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Sets the outcomes of this <code><a href="#Die">Die</a></code> to the given <code>int</code> range (inclusive).</p>

<p>This may remove outcomes (if they are not within the range)
and/or add zero-quantity outcomes (if they are in range but not present
in this <code><a href="#Die">Die</a></code>).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>min_outcome:</strong>  The min outcome of the result.
If omitted, the min outcome of this <code><a href="#Die">Die</a></code> will be used.</li>
<li><strong>max_outcome:</strong>  The max outcome of the result.
If omitted, the max outcome of this <code><a href="#Die">Die</a></code> will be used.</li>
</ul>
</div>


                            </div>
                            <div id="Die.set_outcomes" class="classattr">
                                        <input id="Die.set_outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcomes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.set_outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.set_outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.set_outcomes-525"><a href="#Die.set_outcomes-525"><span class="linenos">525</span></a>    <span class="k">def</span> <span class="nf">set_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.set_outcomes-526"><a href="#Die.set_outcomes-526"><span class="linenos">526</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets the set of outcomes to the argument.</span>
</span><span id="Die.set_outcomes-527"><a href="#Die.set_outcomes-527"><span class="linenos">527</span></a>
</span><span id="Die.set_outcomes-528"><a href="#Die.set_outcomes-528"><span class="linenos">528</span></a><span class="sd">        This may remove outcomes (if they are not present in the argument)</span>
</span><span id="Die.set_outcomes-529"><a href="#Die.set_outcomes-529"><span class="linenos">529</span></a><span class="sd">        and/or add zero-quantity outcomes (if they are not present in this `Die`).</span>
</span><span id="Die.set_outcomes-530"><a href="#Die.set_outcomes-530"><span class="linenos">530</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.set_outcomes-531"><a href="#Die.set_outcomes-531"><span class="linenos">531</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">}</span>
</span><span id="Die.set_outcomes-532"><a href="#Die.set_outcomes-532"><span class="linenos">532</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets the set of outcomes to the argument.</p>

<p>This may remove outcomes (if they are not present in the argument)
and/or add zero-quantity outcomes (if they are not present in this <code><a href="#Die">Die</a></code>).</p>
</div>


                            </div>
                            <div id="Die.trim" class="classattr">
                                        <input id="Die.trim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.trim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.trim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.trim-534"><a href="#Die.trim-534"><span class="linenos">534</span></a>    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.trim-535"><a href="#Die.trim-535"><span class="linenos">535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Removes all zero-quantity outcomes. &quot;&quot;&quot;</span>
</span><span id="Die.trim-536"><a href="#Die.trim-536"><span class="linenos">536</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Die.trim-537"><a href="#Die.trim-537"><span class="linenos">537</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes all zero-quantity outcomes.</p>
</div>


                            </div>
                            <div id="Die.map" class="classattr">
                                        <input id="Die.map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">extra_args</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.map-567"><a href="#Die.map-567"><span class="linenos">567</span></a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span>
</span><span id="Die.map-568"><a href="#Die.map-568"><span class="linenos">568</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.map-569"><a href="#Die.map-569"><span class="linenos">569</span></a>        <span class="n">repl</span><span class="p">:</span>
</span><span id="Die.map-570"><a href="#Die.map-570"><span class="linenos">570</span></a>        <span class="s1">&#39;Callable[..., U | Die[U] | icepool.RerollType | icepool.AgainExpression] | Mapping[T_co, U | Die[U] | icepool.RerollType | icepool.AgainExpression]&#39;</span><span class="p">,</span>
</span><span id="Die.map-571"><a href="#Die.map-571"><span class="linenos">571</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="Die.map-572"><a href="#Die.map-572"><span class="linenos">572</span></a>        <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.map-573"><a href="#Die.map-573"><span class="linenos">573</span></a>        <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.map-574"><a href="#Die.map-574"><span class="linenos">574</span></a>        <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.map-575"><a href="#Die.map-575"><span class="linenos">575</span></a>        <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.map-576"><a href="#Die.map-576"><span class="linenos">576</span></a>        <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.map-577"><a href="#Die.map-577"><span class="linenos">577</span></a>        <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;U | Die[U] | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.map-578"><a href="#Die.map-578"><span class="linenos">578</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die.map-579"><a href="#Die.map-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps outcomes of the `Die` to other outcomes.</span>
</span><span id="Die.map-580"><a href="#Die.map-580"><span class="linenos">580</span></a>
</span><span id="Die.map-581"><a href="#Die.map-581"><span class="linenos">581</span></a><span class="sd">        This is also useful for representing processes.</span>
</span><span id="Die.map-582"><a href="#Die.map-582"><span class="linenos">582</span></a>
</span><span id="Die.map-583"><a href="#Die.map-583"><span class="linenos">583</span></a><span class="sd">        As `icepool.map(repl, self, ...)`.</span>
</span><span id="Die.map-584"><a href="#Die.map-584"><span class="linenos">584</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.map-585"><a href="#Die.map-585"><span class="linenos">585</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span>
</span><span id="Die.map-586"><a href="#Die.map-586"><span class="linenos">586</span></a>                           <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.map-587"><a href="#Die.map-587"><span class="linenos">587</span></a>                           <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.map-588"><a href="#Die.map-588"><span class="linenos">588</span></a>                           <span class="n">star</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
</span><span id="Die.map-589"><a href="#Die.map-589"><span class="linenos">589</span></a>                           <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">,</span>
</span><span id="Die.map-590"><a href="#Die.map-590"><span class="linenos">590</span></a>                           <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="Die.map-591"><a href="#Die.map-591"><span class="linenos">591</span></a>                           <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die.map-592"><a href="#Die.map-592"><span class="linenos">592</span></a>                           <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Maps outcomes of the <code><a href="#Die">Die</a></code> to other outcomes.</p>

<p>This is also useful for representing processes.</p>

<p>As <code><a href="#map">map</a>(repl, self, ...)</code>.</p>
</div>


                            </div>
                            <div id="Die.map_and_time" class="classattr">
                                        <input id="Die.map_and_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_and_time</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">]]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">extra_args</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Die.map_and_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.map_and_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.map_and_time-594"><a href="#Die.map_and_time-594"><span class="linenos">594</span></a>    <span class="k">def</span> <span class="nf">map_and_time</span><span class="p">(</span>
</span><span id="Die.map_and_time-595"><a href="#Die.map_and_time-595"><span class="linenos">595</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.map_and_time-596"><a href="#Die.map_and_time-596"><span class="linenos">596</span></a>            <span class="n">repl</span><span class="p">:</span>
</span><span id="Die.map_and_time-597"><a href="#Die.map_and_time-597"><span class="linenos">597</span></a>        <span class="s1">&#39;Callable[..., T_co | Die[T_co] | icepool.RerollType] | Mapping[T_co, T_co | Die[T_co] | icepool.RerollType]&#39;</span><span class="p">,</span>
</span><span id="Die.map_and_time-598"><a href="#Die.map_and_time-598"><span class="linenos">598</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die.map_and_time-599"><a href="#Die.map_and_time-599"><span class="linenos">599</span></a>            <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.map_and_time-600"><a href="#Die.map_and_time-600"><span class="linenos">600</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.map_and_time-601"><a href="#Die.map_and_time-601"><span class="linenos">601</span></a>            <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[tuple[T_co, int]]&#39;</span><span class="p">:</span>
</span><span id="Die.map_and_time-602"><a href="#Die.map_and_time-602"><span class="linenos">602</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Repeatedly map outcomes of the state to other outcomes, while also</span>
</span><span id="Die.map_and_time-603"><a href="#Die.map_and_time-603"><span class="linenos">603</span></a><span class="sd">        counting timesteps.</span>
</span><span id="Die.map_and_time-604"><a href="#Die.map_and_time-604"><span class="linenos">604</span></a>
</span><span id="Die.map_and_time-605"><a href="#Die.map_and_time-605"><span class="linenos">605</span></a><span class="sd">        This is useful for representing processes.</span>
</span><span id="Die.map_and_time-606"><a href="#Die.map_and_time-606"><span class="linenos">606</span></a>
</span><span id="Die.map_and_time-607"><a href="#Die.map_and_time-607"><span class="linenos">607</span></a><span class="sd">        As `map_and_time(repl, self, ...)`.</span>
</span><span id="Die.map_and_time-608"><a href="#Die.map_and_time-608"><span class="linenos">608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.map_and_time-609"><a href="#Die.map_and_time-609"><span class="linenos">609</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map_and_time</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span>
</span><span id="Die.map_and_time-610"><a href="#Die.map_and_time-610"><span class="linenos">610</span></a>                                    <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.map_and_time-611"><a href="#Die.map_and_time-611"><span class="linenos">611</span></a>                                    <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.map_and_time-612"><a href="#Die.map_and_time-612"><span class="linenos">612</span></a>                                    <span class="n">star</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
</span><span id="Die.map_and_time-613"><a href="#Die.map_and_time-613"><span class="linenos">613</span></a>                                    <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Repeatedly map outcomes of the state to other outcomes, while also
counting timesteps.</p>

<p>This is useful for representing processes.</p>

<p>As <code>map_and_time(repl, self, ...)</code>.</p>
</div>


                            </div>
                            <div id="Die.mean_time_to_sum" class="classattr">
                                        <input id="Die.mean_time_to_sum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mean_time_to_sum</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">target</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span>:</span></span>

                <label class="view-source-button" for="Die.mean_time_to_sum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.mean_time_to_sum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.mean_time_to_sum-619"><a href="#Die.mean_time_to_sum-619"><span class="linenos">619</span></a>    <span class="k">def</span> <span class="nf">mean_time_to_sum</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Die.mean_time_to_sum-620"><a href="#Die.mean_time_to_sum-620"><span class="linenos">620</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The mean number of rolls until the cumulative sum is greater or equal to the target.</span>
</span><span id="Die.mean_time_to_sum-621"><a href="#Die.mean_time_to_sum-621"><span class="linenos">621</span></a>
</span><span id="Die.mean_time_to_sum-622"><a href="#Die.mean_time_to_sum-622"><span class="linenos">622</span></a><span class="sd">        Args:</span>
</span><span id="Die.mean_time_to_sum-623"><a href="#Die.mean_time_to_sum-623"><span class="linenos">623</span></a><span class="sd">            target: The target sum.</span>
</span><span id="Die.mean_time_to_sum-624"><a href="#Die.mean_time_to_sum-624"><span class="linenos">624</span></a>
</span><span id="Die.mean_time_to_sum-625"><a href="#Die.mean_time_to_sum-625"><span class="linenos">625</span></a><span class="sd">        Raises:</span>
</span><span id="Die.mean_time_to_sum-626"><a href="#Die.mean_time_to_sum-626"><span class="linenos">626</span></a><span class="sd">            ValueError: If `self` has negative outcomes.</span>
</span><span id="Die.mean_time_to_sum-627"><a href="#Die.mean_time_to_sum-627"><span class="linenos">627</span></a><span class="sd">            ZeroDivisionError: If `self.mean() == 0`.</span>
</span><span id="Die.mean_time_to_sum-628"><a href="#Die.mean_time_to_sum-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.mean_time_to_sum-629"><a href="#Die.mean_time_to_sum-629"><span class="linenos">629</span></a>        <span class="n">target</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Die.mean_time_to_sum-630"><a href="#Die.mean_time_to_sum-630"><span class="linenos">630</span></a>
</span><span id="Die.mean_time_to_sum-631"><a href="#Die.mean_time_to_sum-631"><span class="linenos">631</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="p">):</span>
</span><span id="Die.mean_time_to_sum-632"><a href="#Die.mean_time_to_sum-632"><span class="linenos">632</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="p">[</span><span class="n">target</span><span class="p">]</span>
</span><span id="Die.mean_time_to_sum-633"><a href="#Die.mean_time_to_sum-633"><span class="linenos">633</span></a>
</span><span id="Die.mean_time_to_sum-634"><a href="#Die.mean_time_to_sum-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.mean_time_to_sum-635"><a href="#Die.mean_time_to_sum-635"><span class="linenos">635</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.mean_time_to_sum-636"><a href="#Die.mean_time_to_sum-636"><span class="linenos">636</span></a>                <span class="s1">&#39;mean_time_to_sum does not handle negative outcomes.&#39;</span><span class="p">)</span>
</span><span id="Die.mean_time_to_sum-637"><a href="#Die.mean_time_to_sum-637"><span class="linenos">637</span></a>        <span class="n">time_per_effect</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">(),</span>
</span><span id="Die.mean_time_to_sum-638"><a href="#Die.mean_time_to_sum-638"><span class="linenos">638</span></a>                                   <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
</span><span id="Die.mean_time_to_sum-639"><a href="#Die.mean_time_to_sum-639"><span class="linenos">639</span></a>
</span><span id="Die.mean_time_to_sum-640"><a href="#Die.mean_time_to_sum-640"><span class="linenos">640</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="p">),</span> <span class="n">target</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Die.mean_time_to_sum-641"><a href="#Die.mean_time_to_sum-641"><span class="linenos">641</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">time_per_effect</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">reroll</span><span class="p">(</span>
</span><span id="Die.mean_time_to_sum-642"><a href="#Die.mean_time_to_sum-642"><span class="linenos">642</span></a>                <span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="Die.mean_time_to_sum-643"><a href="#Die.mean_time_to_sum-643"><span class="linenos">643</span></a>                <span class="n">depth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_time_to_sum</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Die.mean_time_to_sum-644"><a href="#Die.mean_time_to_sum-644"><span class="linenos">644</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_mean_time_to_sum_cache</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="Die.mean_time_to_sum-645"><a href="#Die.mean_time_to_sum-645"><span class="linenos">645</span></a>
</span><span id="Die.mean_time_to_sum-646"><a href="#Die.mean_time_to_sum-646"><span class="linenos">646</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>The mean number of rolls until the cumulative sum is greater or equal to the target.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>target:</strong>  The target sum.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If <code>self</code> has negative outcomes.</li>
<li><strong>ZeroDivisionError:</strong>  If <code>self.mean() == 0</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Die.explode" class="classattr">
                                        <input id="Die.explode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">explode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span>,</span><span class="param">	<span class="n">end</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.explode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.explode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.explode-648"><a href="#Die.explode-648"><span class="linenos">648</span></a>    <span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.explode-649"><a href="#Die.explode-649"><span class="linenos">649</span></a>                <span class="n">which</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.explode-650"><a href="#Die.explode-650"><span class="linenos">650</span></a>                <span class="o">/</span><span class="p">,</span>
</span><span id="Die.explode-651"><a href="#Die.explode-651"><span class="linenos">651</span></a>                <span class="o">*</span><span class="p">,</span>
</span><span id="Die.explode-652"><a href="#Die.explode-652"><span class="linenos">652</span></a>                <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.explode-653"><a href="#Die.explode-653"><span class="linenos">653</span></a>                <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
</span><span id="Die.explode-654"><a href="#Die.explode-654"><span class="linenos">654</span></a>                <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.explode-655"><a href="#Die.explode-655"><span class="linenos">655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Causes outcomes to be rolled again and added to the total.</span>
</span><span id="Die.explode-656"><a href="#Die.explode-656"><span class="linenos">656</span></a>
</span><span id="Die.explode-657"><a href="#Die.explode-657"><span class="linenos">657</span></a><span class="sd">        Args:</span>
</span><span id="Die.explode-658"><a href="#Die.explode-658"><span class="linenos">658</span></a><span class="sd">            which: Which outcomes to explode. Options:</span>
</span><span id="Die.explode-659"><a href="#Die.explode-659"><span class="linenos">659</span></a><span class="sd">                * A single outcome to explode.</span>
</span><span id="Die.explode-660"><a href="#Die.explode-660"><span class="linenos">660</span></a><span class="sd">                * An collection of outcomes to explode.</span>
</span><span id="Die.explode-661"><a href="#Die.explode-661"><span class="linenos">661</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.explode-662"><a href="#Die.explode-662"><span class="linenos">662</span></a><span class="sd">                    should be exploded.</span>
</span><span id="Die.explode-663"><a href="#Die.explode-663"><span class="linenos">663</span></a><span class="sd">                * If not supplied, the max outcome will explode.</span>
</span><span id="Die.explode-664"><a href="#Die.explode-664"><span class="linenos">664</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die.explode-665"><a href="#Die.explode-665"><span class="linenos">665</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die.explode-666"><a href="#Die.explode-666"><span class="linenos">666</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die.explode-667"><a href="#Die.explode-667"><span class="linenos">667</span></a><span class="sd">                signature.</span>
</span><span id="Die.explode-668"><a href="#Die.explode-668"><span class="linenos">668</span></a><span class="sd">            depth: The maximum number of additional dice to roll, not counting</span>
</span><span id="Die.explode-669"><a href="#Die.explode-669"><span class="linenos">669</span></a><span class="sd">                the initial roll.</span>
</span><span id="Die.explode-670"><a href="#Die.explode-670"><span class="linenos">670</span></a><span class="sd">                If not supplied, a default value will be used.</span>
</span><span id="Die.explode-671"><a href="#Die.explode-671"><span class="linenos">671</span></a><span class="sd">            end: Once `depth` is reached, further explosions will be treated</span>
</span><span id="Die.explode-672"><a href="#Die.explode-672"><span class="linenos">672</span></a><span class="sd">                as this value. By default, a zero value will be used.</span>
</span><span id="Die.explode-673"><a href="#Die.explode-673"><span class="linenos">673</span></a><span class="sd">                `icepool.Reroll` will make one extra final roll, rerolling until</span>
</span><span id="Die.explode-674"><a href="#Die.explode-674"><span class="linenos">674</span></a><span class="sd">                a non-exploding outcome is reached.</span>
</span><span id="Die.explode-675"><a href="#Die.explode-675"><span class="linenos">675</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.explode-676"><a href="#Die.explode-676"><span class="linenos">676</span></a>
</span><span id="Die.explode-677"><a href="#Die.explode-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.explode-678"><a href="#Die.explode-678"><span class="linenos">678</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()}</span>
</span><span id="Die.explode-679"><a href="#Die.explode-679"><span class="linenos">679</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.explode-680"><a href="#Die.explode-680"><span class="linenos">680</span></a>            <span class="n">outcome_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die.explode-681"><a href="#Die.explode-681"><span class="linenos">681</span></a>
</span><span id="Die.explode-682"><a href="#Die.explode-682"><span class="linenos">682</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.explode-683"><a href="#Die.explode-683"><span class="linenos">683</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;depth cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Die.explode-684"><a href="#Die.explode-684"><span class="linenos">684</span></a>        <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.explode-685"><a href="#Die.explode-685"><span class="linenos">685</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die.explode-686"><a href="#Die.explode-686"><span class="linenos">686</span></a>
</span><span id="Die.explode-687"><a href="#Die.explode-687"><span class="linenos">687</span></a>        <span class="k">def</span> <span class="nf">map_final</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die.explode-688"><a href="#Die.explode-688"><span class="linenos">688</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcome_set</span><span class="p">:</span>
</span><span id="Die.explode-689"><a href="#Die.explode-689"><span class="linenos">689</span></a>                <span class="k">return</span> <span class="n">outcome</span> <span class="o">+</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span>
</span><span id="Die.explode-690"><a href="#Die.explode-690"><span class="linenos">690</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.explode-691"><a href="#Die.explode-691"><span class="linenos">691</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Die.explode-692"><a href="#Die.explode-692"><span class="linenos">692</span></a>
</span><span id="Die.explode-693"><a href="#Die.explode-693"><span class="linenos">693</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">map_final</span><span class="p">,</span> <span class="n">again_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">again_end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Causes outcomes to be rolled again and added to the total.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>which:</strong>  Which outcomes to explode. Options:
<ul>
<li>A single outcome to explode.</li>
<li>An collection of outcomes to explode.</li>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be exploded.</li>
<li>If not supplied, the max outcome will explode.</li>
</ul></li>
<li><strong>star:</strong>  Whether outcomes should be unpacked into separate arguments
before sending them to a callable <code>which</code>.
If not provided, this will be guessed based on the function
signature.</li>
<li><strong>depth:</strong>  The maximum number of additional dice to roll, not counting
the initial roll.
If not supplied, a default value will be used.</li>
<li><strong>end:</strong>  Once <code>depth</code> is reached, further explosions will be treated
as this value. By default, a zero value will be used.
<code><a href="#Reroll">Reroll</a></code> will make one extra final roll, rerolling until
a non-exploding outcome is reached.</li>
</ul>
</div>


                            </div>
                            <div id="Die.if_else" class="classattr">
                                        <input id="Die.if_else-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">if_else</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outcome_if_true</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]]</span>,</span><span class="param">	<span class="n">outcome_if_false</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.if_else-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.if_else"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.if_else-695"><a href="#Die.if_else-695"><span class="linenos">695</span></a>    <span class="k">def</span> <span class="nf">if_else</span><span class="p">(</span>
</span><span id="Die.if_else-696"><a href="#Die.if_else-696"><span class="linenos">696</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.if_else-697"><a href="#Die.if_else-697"><span class="linenos">697</span></a>        <span class="n">outcome_if_true</span><span class="p">:</span> <span class="n">U</span> <span class="o">|</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">,</span>
</span><span id="Die.if_else-698"><a href="#Die.if_else-698"><span class="linenos">698</span></a>        <span class="n">outcome_if_false</span><span class="p">:</span> <span class="n">U</span> <span class="o">|</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">,</span>
</span><span id="Die.if_else-699"><a href="#Die.if_else-699"><span class="linenos">699</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="Die.if_else-700"><a href="#Die.if_else-700"><span class="linenos">700</span></a>        <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.if_else-701"><a href="#Die.if_else-701"><span class="linenos">701</span></a>        <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.if_else-702"><a href="#Die.if_else-702"><span class="linenos">702</span></a>        <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;U | Die[U] | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.if_else-703"><a href="#Die.if_else-703"><span class="linenos">703</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[U]&#39;</span><span class="p">:</span>
</span><span id="Die.if_else-704"><a href="#Die.if_else-704"><span class="linenos">704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Ternary conditional operator.</span>
</span><span id="Die.if_else-705"><a href="#Die.if_else-705"><span class="linenos">705</span></a>
</span><span id="Die.if_else-706"><a href="#Die.if_else-706"><span class="linenos">706</span></a><span class="sd">        This replaces truthy outcomes with the first argument and falsy outcomes</span>
</span><span id="Die.if_else-707"><a href="#Die.if_else-707"><span class="linenos">707</span></a><span class="sd">        with the second argument.</span>
</span><span id="Die.if_else-708"><a href="#Die.if_else-708"><span class="linenos">708</span></a>
</span><span id="Die.if_else-709"><a href="#Die.if_else-709"><span class="linenos">709</span></a><span class="sd">        Args:</span>
</span><span id="Die.if_else-710"><a href="#Die.if_else-710"><span class="linenos">710</span></a><span class="sd">            again_count, again_depth, again_end: Forwarded to the final die constructor.</span>
</span><span id="Die.if_else-711"><a href="#Die.if_else-711"><span class="linenos">711</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.if_else-712"><a href="#Die.if_else-712"><span class="linenos">712</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
</span><span id="Die.if_else-713"><a href="#Die.if_else-713"><span class="linenos">713</span></a>            <span class="p">{</span>
</span><span id="Die.if_else-714"><a href="#Die.if_else-714"><span class="linenos">714</span></a>                <span class="kc">True</span><span class="p">:</span> <span class="n">outcome_if_true</span><span class="p">,</span>
</span><span id="Die.if_else-715"><a href="#Die.if_else-715"><span class="linenos">715</span></a>                <span class="kc">False</span><span class="p">:</span> <span class="n">outcome_if_false</span>
</span><span id="Die.if_else-716"><a href="#Die.if_else-716"><span class="linenos">716</span></a>            <span class="p">},</span>
</span><span id="Die.if_else-717"><a href="#Die.if_else-717"><span class="linenos">717</span></a>            <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="Die.if_else-718"><a href="#Die.if_else-718"><span class="linenos">718</span></a>            <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die.if_else-719"><a href="#Die.if_else-719"><span class="linenos">719</span></a>            <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Ternary conditional operator.</p>

<p>This replaces truthy outcomes with the first argument and falsy outcomes
with the second argument.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>again_count, again_depth, again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>
</div>


                            </div>
                            <div id="Die.is_in" class="classattr">
                                        <input id="Die.is_in-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_in</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.is_in-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.is_in"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.is_in-721"><a href="#Die.is_in-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">is_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[bool]&#39;</span><span class="p">:</span>
</span><span id="Die.is_in-722"><a href="#Die.is_in-722"><span class="linenos">722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A die that returns True iff the roll of the die is contained in the target.&quot;&quot;&quot;</span>
</span><span id="Die.is_in-723"><a href="#Die.is_in-723"><span class="linenos">723</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A die that returns True iff the roll of the die is contained in the target.</p>
</div>


                            </div>
                            <div id="Die.count" class="classattr">
                                        <input id="Die.count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.count-725"><a href="#Die.count-725"><span class="linenos">725</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die.count-726"><a href="#Die.count-726"><span class="linenos">726</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll this dice a number of times and count how many are in the target.&quot;&quot;&quot;</span>
</span><span id="Die.count-727"><a href="#Die.count-727"><span class="linenos">727</span></a>        <span class="k">return</span> <span class="n">rolls</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_in</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Roll this dice a number of times and count how many are in the target.</p>
</div>


                            </div>
                            <div id="Die.pool" class="classattr">
                                        <input id="Die.pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Pool">Pool</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.pool-786"><a href="#Die.pool-786"><span class="linenos">786</span></a>    <span class="k">def</span> <span class="nf">pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Pool[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.pool-787"><a href="#Die.pool-787"><span class="linenos">787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a `Pool` from this `Die`.</span>
</span><span id="Die.pool-788"><a href="#Die.pool-788"><span class="linenos">788</span></a>
</span><span id="Die.pool-789"><a href="#Die.pool-789"><span class="linenos">789</span></a><span class="sd">        You might subscript the pool immediately afterwards, e.g.</span>
</span><span id="Die.pool-790"><a href="#Die.pool-790"><span class="linenos">790</span></a><span class="sd">        `d6.pool(5)[-1, ..., 1]` takes the difference between the highest and</span>
</span><span id="Die.pool-791"><a href="#Die.pool-791"><span class="linenos">791</span></a><span class="sd">        lowest of 5d6.</span>
</span><span id="Die.pool-792"><a href="#Die.pool-792"><span class="linenos">792</span></a>
</span><span id="Die.pool-793"><a href="#Die.pool-793"><span class="linenos">793</span></a><span class="sd">        Args:</span>
</span><span id="Die.pool-794"><a href="#Die.pool-794"><span class="linenos">794</span></a><span class="sd">            rolls: The number of copies of this `Die` to put in the pool.</span>
</span><span id="Die.pool-795"><a href="#Die.pool-795"><span class="linenos">795</span></a><span class="sd">                Or, a sequence of one `int` per die acting as</span>
</span><span id="Die.pool-796"><a href="#Die.pool-796"><span class="linenos">796</span></a><span class="sd">                `keep_tuple`. Note that `...` cannot be used in the</span>
</span><span id="Die.pool-797"><a href="#Die.pool-797"><span class="linenos">797</span></a><span class="sd">                argument to this method, as the argument determines the size of</span>
</span><span id="Die.pool-798"><a href="#Die.pool-798"><span class="linenos">798</span></a><span class="sd">                the pool.</span>
</span><span id="Die.pool-799"><a href="#Die.pool-799"><span class="linenos">799</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.pool-800"><a href="#Die.pool-800"><span class="linenos">800</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die.pool-801"><a href="#Die.pool-801"><span class="linenos">801</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">rolls</span><span class="p">})</span>
</span><span id="Die.pool-802"><a href="#Die.pool-802"><span class="linenos">802</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.pool-803"><a href="#Die.pool-803"><span class="linenos">803</span></a>            <span class="n">pool_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.pool-804"><a href="#Die.pool-804"><span class="linenos">804</span></a>            <span class="c1"># Haven&#39;t dealt with narrowing return type.</span>
</span><span id="Die.pool-805"><a href="#Die.pool-805"><span class="linenos">805</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">pool_size</span><span class="p">})[</span><span class="n">rolls</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Creates a <code><a href="#Pool">Pool</a></code> from this <code><a href="#Die">Die</a></code>.</p>

<p>You might subscript the pool immediately afterwards, e.g.
<code>d6.pool(5)[-1, ..., 1]</code> takes the difference between the highest and
lowest of 5d6.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of copies of this <code><a href="#Die">Die</a></code> to put in the pool.
Or, a sequence of one <code>int</code> per die acting as
<code>keep_tuple</code>. Note that <code>...</code> cannot be used in the
argument to this method, as the argument determines the size of
the pool.</li>
</ul>
</div>


                            </div>
                            <div id="Die.keep" class="classattr">
                                        <input id="Die.keep-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keep</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">ellipsis</span><span class="p">],</span> <span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.keep-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.keep"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.keep-853"><a href="#Die.keep-853"><span class="linenos">853</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.keep-854"><a href="#Die.keep-854"><span class="linenos">854</span></a>             <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="Die.keep-855"><a href="#Die.keep-855"><span class="linenos">855</span></a>             <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.keep-856"><a href="#Die.keep-856"><span class="linenos">856</span></a>             <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.keep-857"><a href="#Die.keep-857"><span class="linenos">857</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects elements after drawing and sorting and sums them.</span>
</span><span id="Die.keep-858"><a href="#Die.keep-858"><span class="linenos">858</span></a>
</span><span id="Die.keep-859"><a href="#Die.keep-859"><span class="linenos">859</span></a><span class="sd">        Args:</span>
</span><span id="Die.keep-860"><a href="#Die.keep-860"><span class="linenos">860</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die.keep-861"><a href="#Die.keep-861"><span class="linenos">861</span></a><span class="sd">            index: One of the following:</span>
</span><span id="Die.keep-862"><a href="#Die.keep-862"><span class="linenos">862</span></a><span class="sd">            * An `int`. This will count only the roll at the specified index.</span>
</span><span id="Die.keep-863"><a href="#Die.keep-863"><span class="linenos">863</span></a><span class="sd">            In this case, the result is a `Die` rather than a generator.</span>
</span><span id="Die.keep-864"><a href="#Die.keep-864"><span class="linenos">864</span></a><span class="sd">            * A `slice`. The selected dice are counted once each.</span>
</span><span id="Die.keep-865"><a href="#Die.keep-865"><span class="linenos">865</span></a><span class="sd">            * A sequence of `int`s with length equal to `rolls`.</span>
</span><span id="Die.keep-866"><a href="#Die.keep-866"><span class="linenos">866</span></a><span class="sd">                Each roll is counted that many times, which could be multiple or</span>
</span><span id="Die.keep-867"><a href="#Die.keep-867"><span class="linenos">867</span></a><span class="sd">                negative times.</span>
</span><span id="Die.keep-868"><a href="#Die.keep-868"><span class="linenos">868</span></a>
</span><span id="Die.keep-869"><a href="#Die.keep-869"><span class="linenos">869</span></a><span class="sd">                Up to one `...` (`Ellipsis`) may be used. If no `...` is used,</span>
</span><span id="Die.keep-870"><a href="#Die.keep-870"><span class="linenos">870</span></a><span class="sd">                the `rolls` argument may be omitted.</span>
</span><span id="Die.keep-871"><a href="#Die.keep-871"><span class="linenos">871</span></a>
</span><span id="Die.keep-872"><a href="#Die.keep-872"><span class="linenos">872</span></a><span class="sd">                `...` will be replaced with a number of zero counts in order</span>
</span><span id="Die.keep-873"><a href="#Die.keep-873"><span class="linenos">873</span></a><span class="sd">                to make up any missing elements compared to `rolls`.</span>
</span><span id="Die.keep-874"><a href="#Die.keep-874"><span class="linenos">874</span></a><span class="sd">                This number may be &quot;negative&quot; if more `int`s are provided than</span>
</span><span id="Die.keep-875"><a href="#Die.keep-875"><span class="linenos">875</span></a><span class="sd">                `rolls`. Specifically:</span>
</span><span id="Die.keep-876"><a href="#Die.keep-876"><span class="linenos">876</span></a>
</span><span id="Die.keep-877"><a href="#Die.keep-877"><span class="linenos">877</span></a><span class="sd">                * If `index` is shorter than `rolls`, `...`</span>
</span><span id="Die.keep-878"><a href="#Die.keep-878"><span class="linenos">878</span></a><span class="sd">                    acts as enough zero counts to make up the difference.</span>
</span><span id="Die.keep-879"><a href="#Die.keep-879"><span class="linenos">879</span></a><span class="sd">                    E.g. `(1, ..., 1)` on five dice would act as</span>
</span><span id="Die.keep-880"><a href="#Die.keep-880"><span class="linenos">880</span></a><span class="sd">                    `(1, 0, 0, 0, 1)`.</span>
</span><span id="Die.keep-881"><a href="#Die.keep-881"><span class="linenos">881</span></a><span class="sd">                * If `index` has length equal to `rolls`, `...` has no effect.</span>
</span><span id="Die.keep-882"><a href="#Die.keep-882"><span class="linenos">882</span></a><span class="sd">                    E.g. `(1, ..., 1)` on two dice would act as `(1, 1)`.</span>
</span><span id="Die.keep-883"><a href="#Die.keep-883"><span class="linenos">883</span></a><span class="sd">                * If `index` is longer than `rolls` and `...` is on one side,</span>
</span><span id="Die.keep-884"><a href="#Die.keep-884"><span class="linenos">884</span></a><span class="sd">                    elements will be dropped from `index` on the side with `...`.</span>
</span><span id="Die.keep-885"><a href="#Die.keep-885"><span class="linenos">885</span></a><span class="sd">                    E.g. `(..., 1, 2, 3)` on two dice would act as `(2, 3)`.</span>
</span><span id="Die.keep-886"><a href="#Die.keep-886"><span class="linenos">886</span></a><span class="sd">                * If `index` is longer than `rolls` and `...`</span>
</span><span id="Die.keep-887"><a href="#Die.keep-887"><span class="linenos">887</span></a><span class="sd">                    is in the middle, the counts will be as the sum of two</span>
</span><span id="Die.keep-888"><a href="#Die.keep-888"><span class="linenos">888</span></a><span class="sd">                    one-sided `...`.</span>
</span><span id="Die.keep-889"><a href="#Die.keep-889"><span class="linenos">889</span></a><span class="sd">                    E.g. `(-1, ..., 1)` acts like `(-1, ...)` plus `(..., 1)`.</span>
</span><span id="Die.keep-890"><a href="#Die.keep-890"><span class="linenos">890</span></a><span class="sd">                    If `rolls` was 1 this would have the -1 and 1 cancel each other out.</span>
</span><span id="Die.keep-891"><a href="#Die.keep-891"><span class="linenos">891</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.keep-892"><a href="#Die.keep-892"><span class="linenos">892</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die.keep-893"><a href="#Die.keep-893"><span class="linenos">893</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.keep-894"><a href="#Die.keep-894"><span class="linenos">894</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.keep-895"><a href="#Die.keep-895"><span class="linenos">895</span></a>                    <span class="s1">&#39;If the number of rolls is an integer, an index argument must be provided.&#39;</span>
</span><span id="Die.keep-896"><a href="#Die.keep-896"><span class="linenos">896</span></a>                <span class="p">)</span>
</span><span id="Die.keep-897"><a href="#Die.keep-897"><span class="linenos">897</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die.keep-898"><a href="#Die.keep-898"><span class="linenos">898</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="Die.keep-899"><a href="#Die.keep-899"><span class="linenos">899</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.keep-900"><a href="#Die.keep-900"><span class="linenos">900</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Die.keep-901"><a href="#Die.keep-901"><span class="linenos">901</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.keep-902"><a href="#Die.keep-902"><span class="linenos">902</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.keep-903"><a href="#Die.keep-903"><span class="linenos">903</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only one index sequence can be given.&#39;</span><span class="p">)</span>
</span><span id="Die.keep-904"><a href="#Die.keep-904"><span class="linenos">904</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rolls</span><span class="p">))</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Selects elements after drawing and sorting and sums them.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of dice to roll.</li>
<li><strong>index:</strong>  One of the following:</li>
<li><ul>
<li>An <code>int</code>. This will count only the roll at the specified index.</li>
</ul></li>

<p><li>In this case, the result is a <code><a href="#Die">Die</a></code> rather than a generator.</li>
<li><ul>
<li>A <code>slice</code>. The selected dice are counted once each.</li></p>

</ul></li>
<li><ul>
<li>A sequence of <code>int</code>s with length equal to <code>rolls</code>.
Each roll is counted that many times, which could be multiple or
negative times.</li>
</ul>

<p>Up to one <code>...</code> (<code>Ellipsis</code>) may be used. If no <code>...</code> is used,
the <code>rolls</code> argument may be omitted.</p>

<p><code>...</code> will be replaced with a number of zero counts in order

<p>to make up any missing elements compared to <code>rolls</code>.
This number may be "negative" if more <code>int</code>s are provided than
<code>rolls</code>. Specifically:</p></p>

<ul>
<li>If <code>index</code> is shorter than <code>rolls</code>, <code>...</code>
acts as enough zero counts to make up the difference.
E.g. <code>(1, ..., 1)</code> on five dice would act as
<code>(1, 0, 0, 0, 1)</code>.</li>
<li>If <code>index</code> has length equal to <code>rolls</code>, <code>...</code> has no effect.
E.g. <code>(1, ..., 1)</code> on two dice would act as <code>(1, 1)</code>.</li>
<li>If <code>index</code> is longer than <code>rolls</code> and <code>...</code> is on one side,
elements will be dropped from <code>index</code> on the side with <code>...</code>.
E.g. <code>(..., 1, 2, 3)</code> on two dice would act as <code>(2, 3)</code>.</li>
<li>If <code>index</code> is longer than <code>rolls</code> and <code>...</code>
is in the middle, the counts will be as the sum of two
one-sided <code>...</code>.
E.g. <code>(-1, ..., 1)</code> acts like <code>(-1, ...)</code> plus <code>(..., 1)</code>.
If <code>rolls</code> was 1 this would have the -1 and 1 cancel each other out.</li>
</ul></li>

<p></ul></p>
</div>


                            </div>
                            <div id="Die.lowest" class="classattr">
                                        <input id="Die.lowest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lowest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.lowest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.lowest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.lowest-906"><a href="#Die.lowest-906"><span class="linenos">906</span></a>    <span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.lowest-907"><a href="#Die.lowest-907"><span class="linenos">907</span></a>               <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die.lowest-908"><a href="#Die.lowest-908"><span class="linenos">908</span></a>               <span class="o">/</span><span class="p">,</span>
</span><span id="Die.lowest-909"><a href="#Die.lowest-909"><span class="linenos">909</span></a>               <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.lowest-910"><a href="#Die.lowest-910"><span class="linenos">910</span></a>               <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.lowest-911"><a href="#Die.lowest-911"><span class="linenos">911</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll several of this `Die` and return the lowest result, or the sum of some of the lowest.</span>
</span><span id="Die.lowest-912"><a href="#Die.lowest-912"><span class="linenos">912</span></a>
</span><span id="Die.lowest-913"><a href="#Die.lowest-913"><span class="linenos">913</span></a><span class="sd">        The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="Die.lowest-914"><a href="#Die.lowest-914"><span class="linenos">914</span></a>
</span><span id="Die.lowest-915"><a href="#Die.lowest-915"><span class="linenos">915</span></a><span class="sd">        Args:</span>
</span><span id="Die.lowest-916"><a href="#Die.lowest-916"><span class="linenos">916</span></a><span class="sd">            rolls: The number of dice to roll. All dice will have the same</span>
</span><span id="Die.lowest-917"><a href="#Die.lowest-917"><span class="linenos">917</span></a><span class="sd">                outcomes as `self`.</span>
</span><span id="Die.lowest-918"><a href="#Die.lowest-918"><span class="linenos">918</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="Die.lowest-919"><a href="#Die.lowest-919"><span class="linenos">919</span></a><span class="sd">                * If neither are provided, the single lowest die will be taken.</span>
</span><span id="Die.lowest-920"><a href="#Die.lowest-920"><span class="linenos">920</span></a><span class="sd">                * If only `keep` is provided, the `keep` lowest dice will be summed.</span>
</span><span id="Die.lowest-921"><a href="#Die.lowest-921"><span class="linenos">921</span></a><span class="sd">                * If only `drop` is provided, the `drop` lowest dice will be dropped</span>
</span><span id="Die.lowest-922"><a href="#Die.lowest-922"><span class="linenos">922</span></a><span class="sd">                    and the rest will be summed.</span>
</span><span id="Die.lowest-923"><a href="#Die.lowest-923"><span class="linenos">923</span></a><span class="sd">                * If both are provided, `drop` lowest dice will be dropped, then</span>
</span><span id="Die.lowest-924"><a href="#Die.lowest-924"><span class="linenos">924</span></a><span class="sd">                    the next `keep` lowest dice will be summed.</span>
</span><span id="Die.lowest-925"><a href="#Die.lowest-925"><span class="linenos">925</span></a>
</span><span id="Die.lowest-926"><a href="#Die.lowest-926"><span class="linenos">926</span></a><span class="sd">        Returns:</span>
</span><span id="Die.lowest-927"><a href="#Die.lowest-927"><span class="linenos">927</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die.lowest-928"><a href="#Die.lowest-928"><span class="linenos">928</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.lowest-929"><a href="#Die.lowest-929"><span class="linenos">929</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">lowest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="Die.lowest-930"><a href="#Die.lowest-930"><span class="linenos">930</span></a>        <span class="n">canonical</span> <span class="o">=</span> <span class="n">canonical_slice</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.lowest-931"><a href="#Die.lowest-931"><span class="linenos">931</span></a>        <span class="k">if</span> <span class="n">canonical</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">canonical</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die.lowest-932"><a href="#Die.lowest-932"><span class="linenos">932</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lowest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.lowest-933"><a href="#Die.lowest-933"><span class="linenos">933</span></a>        <span class="c1"># Expression evaluators are difficult to type.</span>
</span><span id="Die.lowest-934"><a href="#Die.lowest-934"><span class="linenos">934</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Roll several of this <code><a href="#Die">Die</a></code> and return the lowest result, or the sum of some of the lowest.</p>

<p>The outcomes should support addition and multiplication if <code>keep != 1</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of dice to roll. All dice will have the same
outcomes as <code>self</code>.</li>
<li><strong>keep, drop:</strong>  These arguments work together:
<ul>
<li>If neither are provided, the single lowest die will be taken.</li>
<li>If only <code><a href="#Die.keep">keep</a></code> is provided, the <code><a href="#Die.keep">keep</a></code> lowest dice will be summed.</li>
<li>If only <code>drop</code> is provided, the <code>drop</code> lowest dice will be dropped
and the rest will be summed.</li>
<li>If both are provided, <code>drop</code> lowest dice will be dropped, then
the next <code><a href="#Die.keep">keep</a></code> lowest dice will be summed.</li>
</ul></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the probability distribution of the sum.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.highest" class="classattr">
                                        <input id="Die.highest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">highest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.highest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.highest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.highest-944"><a href="#Die.highest-944"><span class="linenos">944</span></a>    <span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.highest-945"><a href="#Die.highest-945"><span class="linenos">945</span></a>                <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die.highest-946"><a href="#Die.highest-946"><span class="linenos">946</span></a>                <span class="o">/</span><span class="p">,</span>
</span><span id="Die.highest-947"><a href="#Die.highest-947"><span class="linenos">947</span></a>                <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.highest-948"><a href="#Die.highest-948"><span class="linenos">948</span></a>                <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.highest-949"><a href="#Die.highest-949"><span class="linenos">949</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll several of this `Die` and return the highest result, or the sum of some of the highest.</span>
</span><span id="Die.highest-950"><a href="#Die.highest-950"><span class="linenos">950</span></a>
</span><span id="Die.highest-951"><a href="#Die.highest-951"><span class="linenos">951</span></a><span class="sd">        The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="Die.highest-952"><a href="#Die.highest-952"><span class="linenos">952</span></a>
</span><span id="Die.highest-953"><a href="#Die.highest-953"><span class="linenos">953</span></a><span class="sd">        Args:</span>
</span><span id="Die.highest-954"><a href="#Die.highest-954"><span class="linenos">954</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die.highest-955"><a href="#Die.highest-955"><span class="linenos">955</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="Die.highest-956"><a href="#Die.highest-956"><span class="linenos">956</span></a><span class="sd">                * If neither are provided, the single highest die will be taken.</span>
</span><span id="Die.highest-957"><a href="#Die.highest-957"><span class="linenos">957</span></a><span class="sd">                * If only `keep` is provided, the `keep` highest dice will be summed.</span>
</span><span id="Die.highest-958"><a href="#Die.highest-958"><span class="linenos">958</span></a><span class="sd">                * If only `drop` is provided, the `drop` highest dice will be dropped</span>
</span><span id="Die.highest-959"><a href="#Die.highest-959"><span class="linenos">959</span></a><span class="sd">                    and the rest will be summed.</span>
</span><span id="Die.highest-960"><a href="#Die.highest-960"><span class="linenos">960</span></a><span class="sd">                * If both are provided, `drop` highest dice will be dropped, then</span>
</span><span id="Die.highest-961"><a href="#Die.highest-961"><span class="linenos">961</span></a><span class="sd">                    the next `keep` highest dice will be summed.</span>
</span><span id="Die.highest-962"><a href="#Die.highest-962"><span class="linenos">962</span></a>
</span><span id="Die.highest-963"><a href="#Die.highest-963"><span class="linenos">963</span></a><span class="sd">        Returns:</span>
</span><span id="Die.highest-964"><a href="#Die.highest-964"><span class="linenos">964</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die.highest-965"><a href="#Die.highest-965"><span class="linenos">965</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.highest-966"><a href="#Die.highest-966"><span class="linenos">966</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">highest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="Die.highest-967"><a href="#Die.highest-967"><span class="linenos">967</span></a>        <span class="n">canonical</span> <span class="o">=</span> <span class="n">canonical_slice</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.highest-968"><a href="#Die.highest-968"><span class="linenos">968</span></a>        <span class="k">if</span> <span class="n">canonical</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">rolls</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">canonical</span><span class="o">.</span><span class="n">stop</span> <span class="o">==</span> <span class="n">rolls</span><span class="p">:</span>
</span><span id="Die.highest-969"><a href="#Die.highest-969"><span class="linenos">969</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.highest-970"><a href="#Die.highest-970"><span class="linenos">970</span></a>        <span class="c1"># Expression evaluators are difficult to type.</span>
</span><span id="Die.highest-971"><a href="#Die.highest-971"><span class="linenos">971</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Roll several of this <code><a href="#Die">Die</a></code> and return the highest result, or the sum of some of the highest.</p>

<p>The outcomes should support addition and multiplication if <code>keep != 1</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of dice to roll.</li>
<li><strong>keep, drop:</strong>  These arguments work together:
<ul>
<li>If neither are provided, the single highest die will be taken.</li>
<li>If only <code><a href="#Die.keep">keep</a></code> is provided, the <code><a href="#Die.keep">keep</a></code> highest dice will be summed.</li>
<li>If only <code>drop</code> is provided, the <code>drop</code> highest dice will be dropped
and the rest will be summed.</li>
<li>If both are provided, <code>drop</code> highest dice will be dropped, then
the next <code><a href="#Die.keep">keep</a></code> highest dice will be summed.</li>
</ul></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the probability distribution of the sum.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.middle" class="classattr">
                                        <input id="Die.middle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">middle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">tie</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.middle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.middle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.middle-980"><a href="#Die.middle-980"><span class="linenos"> 980</span></a>    <span class="k">def</span> <span class="nf">middle</span><span class="p">(</span>
</span><span id="Die.middle-981"><a href="#Die.middle-981"><span class="linenos"> 981</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.middle-982"><a href="#Die.middle-982"><span class="linenos"> 982</span></a>            <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die.middle-983"><a href="#Die.middle-983"><span class="linenos"> 983</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die.middle-984"><a href="#Die.middle-984"><span class="linenos"> 984</span></a>            <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.middle-985"><a href="#Die.middle-985"><span class="linenos"> 985</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="Die.middle-986"><a href="#Die.middle-986"><span class="linenos"> 986</span></a>            <span class="n">tie</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="Die.middle-987"><a href="#Die.middle-987"><span class="linenos"> 987</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Roll several of this `Die` and sum the sorted results in the middle.</span>
</span><span id="Die.middle-988"><a href="#Die.middle-988"><span class="linenos"> 988</span></a>
</span><span id="Die.middle-989"><a href="#Die.middle-989"><span class="linenos"> 989</span></a><span class="sd">        The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="Die.middle-990"><a href="#Die.middle-990"><span class="linenos"> 990</span></a>
</span><span id="Die.middle-991"><a href="#Die.middle-991"><span class="linenos"> 991</span></a><span class="sd">        Args:</span>
</span><span id="Die.middle-992"><a href="#Die.middle-992"><span class="linenos"> 992</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die.middle-993"><a href="#Die.middle-993"><span class="linenos"> 993</span></a><span class="sd">            keep: The number of outcomes to sum. If this is greater than the</span>
</span><span id="Die.middle-994"><a href="#Die.middle-994"><span class="linenos"> 994</span></a><span class="sd">                current keep_size, all are kept.</span>
</span><span id="Die.middle-995"><a href="#Die.middle-995"><span class="linenos"> 995</span></a><span class="sd">            tie: What to do if `keep` is odd but the current keep_size</span>
</span><span id="Die.middle-996"><a href="#Die.middle-996"><span class="linenos"> 996</span></a><span class="sd">                is even, or vice versa.</span>
</span><span id="Die.middle-997"><a href="#Die.middle-997"><span class="linenos"> 997</span></a><span class="sd">                * &#39;error&#39; (default): Raises `IndexError`.</span>
</span><span id="Die.middle-998"><a href="#Die.middle-998"><span class="linenos"> 998</span></a><span class="sd">                * &#39;high&#39;: The higher outcome is taken.</span>
</span><span id="Die.middle-999"><a href="#Die.middle-999"><span class="linenos"> 999</span></a><span class="sd">                * &#39;low&#39;: The lower outcome is taken.</span>
</span><span id="Die.middle-1000"><a href="#Die.middle-1000"><span class="linenos">1000</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.middle-1001"><a href="#Die.middle-1001"><span class="linenos">1001</span></a>        <span class="c1"># Expression evaluators are difficult to type.</span>
</span><span id="Die.middle-1002"><a href="#Die.middle-1002"><span class="linenos">1002</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span><span class="o">.</span><span class="n">middle</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">tie</span><span class="o">=</span><span class="n">tie</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Roll several of this <code><a href="#Die">Die</a></code> and sum the sorted results in the middle.</p>

<p>The outcomes should support addition and multiplication if <code>keep != 1</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of dice to roll.</li>
<li><strong>keep:</strong>  The number of outcomes to sum. If this is greater than the
current keep_size, all are kept.</li>
<li><strong>tie:</strong>  What to do if <code><a href="#Die.keep">keep</a></code> is odd but the current keep_size
is even, or vice versa.
<ul>
<li>'error' (default): Raises <code>IndexError</code>.</li>
<li>'high': The higher outcome is taken.</li>
<li>'low': The lower outcome is taken.</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="Die.map_to_pool" class="classattr">
                                        <input id="Die.map_to_pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_to_pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="o">~</span><span class="n">U</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="o">&lt;</span><span class="n"><a href="#RerollType.Reroll">RerollType.Reroll</a></span><span class="p">:</span> <span class="s1">&#39;Reroll&#39;</span><span class="o">&gt;</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">extra_args</span><span class="p">:</span> <span class="n"><a href="#Outcome">Outcome</a></span> <span class="o">|</span> <span class="n"><a href="#Die">Die</a></span> <span class="o">|</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Die.map_to_pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.map_to_pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.map_to_pool-1004"><a href="#Die.map_to_pool-1004"><span class="linenos">1004</span></a>    <span class="k">def</span> <span class="nf">map_to_pool</span><span class="p">(</span>
</span><span id="Die.map_to_pool-1005"><a href="#Die.map_to_pool-1005"><span class="linenos">1005</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1006"><a href="#Die.map_to_pool-1006"><span class="linenos">1006</span></a>        <span class="n">repl</span><span class="p">:</span>
</span><span id="Die.map_to_pool-1007"><a href="#Die.map_to_pool-1007"><span class="linenos">1007</span></a>        <span class="s1">&#39;Callable[..., Sequence[icepool.Die[U] | U] | Mapping[icepool.Die[U], int] | Mapping[U, int] | icepool.Reroll] | None&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1008"><a href="#Die.map_to_pool-1008"><span class="linenos">1008</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1009"><a href="#Die.map_to_pool-1009"><span class="linenos">1009</span></a>        <span class="o">*</span><span class="n">extra_args</span><span class="p">:</span> <span class="s1">&#39;Outcome | icepool.Die | icepool.MultisetExpression&#39;</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1010"><a href="#Die.map_to_pool-1010"><span class="linenos">1010</span></a>        <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1011"><a href="#Die.map_to_pool-1011"><span class="linenos">1011</span></a>        <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.map_to_pool-1012"><a href="#Die.map_to_pool-1012"><span class="linenos">1012</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultisetGenerator[U, tuple[int]]&#39;</span><span class="p">:</span>
</span><span id="Die.map_to_pool-1013"><a href="#Die.map_to_pool-1013"><span class="linenos">1013</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Maps outcomes of this `Die` to `Pools`, creating a `MultisetGenerator`.</span>
</span><span id="Die.map_to_pool-1014"><a href="#Die.map_to_pool-1014"><span class="linenos">1014</span></a>
</span><span id="Die.map_to_pool-1015"><a href="#Die.map_to_pool-1015"><span class="linenos">1015</span></a><span class="sd">        As `icepool.map_to_pool(repl, self, ...)`.</span>
</span><span id="Die.map_to_pool-1016"><a href="#Die.map_to_pool-1016"><span class="linenos">1016</span></a>
</span><span id="Die.map_to_pool-1017"><a href="#Die.map_to_pool-1017"><span class="linenos">1017</span></a><span class="sd">        If no argument is provided, the outcomes will be used to construct a</span>
</span><span id="Die.map_to_pool-1018"><a href="#Die.map_to_pool-1018"><span class="linenos">1018</span></a><span class="sd">        mixture of pools directly, similar to the inverse of `pool.expand()`.</span>
</span><span id="Die.map_to_pool-1019"><a href="#Die.map_to_pool-1019"><span class="linenos">1019</span></a><span class="sd">        Note that this is not particularly efficient since it does not make much</span>
</span><span id="Die.map_to_pool-1020"><a href="#Die.map_to_pool-1020"><span class="linenos">1020</span></a><span class="sd">        use of dynamic programming.</span>
</span><span id="Die.map_to_pool-1021"><a href="#Die.map_to_pool-1021"><span class="linenos">1021</span></a>
</span><span id="Die.map_to_pool-1022"><a href="#Die.map_to_pool-1022"><span class="linenos">1022</span></a><span class="sd">        Args:</span>
</span><span id="Die.map_to_pool-1023"><a href="#Die.map_to_pool-1023"><span class="linenos">1023</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Die.map_to_pool-1024"><a href="#Die.map_to_pool-1024"><span class="linenos">1024</span></a><span class="sd">                * A callable that takes in one outcome per element of args and</span>
</span><span id="Die.map_to_pool-1025"><a href="#Die.map_to_pool-1025"><span class="linenos">1025</span></a><span class="sd">                    produces a `Pool` (or something convertible to such).</span>
</span><span id="Die.map_to_pool-1026"><a href="#Die.map_to_pool-1026"><span class="linenos">1026</span></a><span class="sd">                * A mapping from old outcomes to `Pool` </span>
</span><span id="Die.map_to_pool-1027"><a href="#Die.map_to_pool-1027"><span class="linenos">1027</span></a><span class="sd">                    (or something convertible to such).</span>
</span><span id="Die.map_to_pool-1028"><a href="#Die.map_to_pool-1028"><span class="linenos">1028</span></a><span class="sd">                    In this case args must have exactly one element.</span>
</span><span id="Die.map_to_pool-1029"><a href="#Die.map_to_pool-1029"><span class="linenos">1029</span></a><span class="sd">                The new outcomes may be dice rather than just single outcomes.</span>
</span><span id="Die.map_to_pool-1030"><a href="#Die.map_to_pool-1030"><span class="linenos">1030</span></a><span class="sd">                The special value `icepool.Reroll` will reroll that old outcome.</span>
</span><span id="Die.map_to_pool-1031"><a href="#Die.map_to_pool-1031"><span class="linenos">1031</span></a><span class="sd">            star: If `True`, the first of the args will be unpacked before </span>
</span><span id="Die.map_to_pool-1032"><a href="#Die.map_to_pool-1032"><span class="linenos">1032</span></a><span class="sd">                giving them to `repl`.</span>
</span><span id="Die.map_to_pool-1033"><a href="#Die.map_to_pool-1033"><span class="linenos">1033</span></a><span class="sd">                If not provided, it will be guessed based on the signature of </span>
</span><span id="Die.map_to_pool-1034"><a href="#Die.map_to_pool-1034"><span class="linenos">1034</span></a><span class="sd">                `repl` and the number of arguments.</span>
</span><span id="Die.map_to_pool-1035"><a href="#Die.map_to_pool-1035"><span class="linenos">1035</span></a><span class="sd">            denominator: If provided, the denominator of the result will be this</span>
</span><span id="Die.map_to_pool-1036"><a href="#Die.map_to_pool-1036"><span class="linenos">1036</span></a><span class="sd">                value. Otherwise it will be the minimum to correctly weight the</span>
</span><span id="Die.map_to_pool-1037"><a href="#Die.map_to_pool-1037"><span class="linenos">1037</span></a><span class="sd">                pools.</span>
</span><span id="Die.map_to_pool-1038"><a href="#Die.map_to_pool-1038"><span class="linenos">1038</span></a>
</span><span id="Die.map_to_pool-1039"><a href="#Die.map_to_pool-1039"><span class="linenos">1039</span></a><span class="sd">        Returns:</span>
</span><span id="Die.map_to_pool-1040"><a href="#Die.map_to_pool-1040"><span class="linenos">1040</span></a><span class="sd">            A `MultisetGenerator` representing the mixture of `Pool`s. Note  </span>
</span><span id="Die.map_to_pool-1041"><a href="#Die.map_to_pool-1041"><span class="linenos">1041</span></a><span class="sd">            that this is not technically a `Pool`, though it supports most of </span>
</span><span id="Die.map_to_pool-1042"><a href="#Die.map_to_pool-1042"><span class="linenos">1042</span></a><span class="sd">            the same operations.</span>
</span><span id="Die.map_to_pool-1043"><a href="#Die.map_to_pool-1043"><span class="linenos">1043</span></a>
</span><span id="Die.map_to_pool-1044"><a href="#Die.map_to_pool-1044"><span class="linenos">1044</span></a><span class="sd">        Raises:</span>
</span><span id="Die.map_to_pool-1045"><a href="#Die.map_to_pool-1045"><span class="linenos">1045</span></a><span class="sd">            ValueError: If `denominator` cannot be made consistent with the </span>
</span><span id="Die.map_to_pool-1046"><a href="#Die.map_to_pool-1046"><span class="linenos">1046</span></a><span class="sd">                resulting mixture of pools.</span>
</span><span id="Die.map_to_pool-1047"><a href="#Die.map_to_pool-1047"><span class="linenos">1047</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.map_to_pool-1048"><a href="#Die.map_to_pool-1048"><span class="linenos">1048</span></a>        <span class="k">if</span> <span class="n">repl</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.map_to_pool-1049"><a href="#Die.map_to_pool-1049"><span class="linenos">1049</span></a>            <span class="n">repl</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
</span><span id="Die.map_to_pool-1050"><a href="#Die.map_to_pool-1050"><span class="linenos">1050</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map_to_pool</span><span class="p">(</span><span class="n">repl</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1051"><a href="#Die.map_to_pool-1051"><span class="linenos">1051</span></a>                                   <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1052"><a href="#Die.map_to_pool-1052"><span class="linenos">1052</span></a>                                   <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1053"><a href="#Die.map_to_pool-1053"><span class="linenos">1053</span></a>                                   <span class="n">star</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
</span><span id="Die.map_to_pool-1054"><a href="#Die.map_to_pool-1054"><span class="linenos">1054</span></a>                                   <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Maps outcomes of this <code><a href="#Die">Die</a></code> to <code>Pools</code>, creating a <code><a href="#MultisetGenerator">MultisetGenerator</a></code>.</p>

<p>As <code><a href="#map_to_pool">map_to_pool</a>(repl, self, ...)</code>.</p>

<p>If no argument is provided, the outcomes will be used to construct a
mixture of pools directly, similar to the inverse of <code>pool.expand()</code>.
Note that this is not particularly efficient since it does not make much
use of dynamic programming.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>repl:</strong>  One of the following:
<ul>
<li>A callable that takes in one outcome per element of args and
produces a <code><a href="#Pool">Pool</a></code> (or something convertible to such).</li>
<li>A mapping from old outcomes to <code><a href="#Pool">Pool</a></code> 
(or something convertible to such).
In this case args must have exactly one element.
The new outcomes may be dice rather than just single outcomes.
The special value <code><a href="#Reroll">Reroll</a></code> will reroll that old outcome.</li>
</ul></li>
<li><strong>star:</strong>  If <code>True</code>, the first of the args will be unpacked before 
giving them to <code>repl</code>.
If not provided, it will be guessed based on the signature of 
<code>repl</code> and the number of arguments.</li>
<li><strong>denominator:</strong>  If provided, the denominator of the result will be this
value. Otherwise it will be the minimum to correctly weight the
pools.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#MultisetGenerator">MultisetGenerator</a></code> representing the mixture of <code><a href="#Pool">Pool</a></code>s. Note<br />
  that this is not technically a <code><a href="#Pool">Pool</a></code>, though it supports most of 
  the same operations.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If <code><a href="#Die.denominator">denominator</a></code> cannot be made consistent with the 
resulting mixture of pools.</li>
</ul>
</div>


                            </div>
                            <div id="Die.explode_to_pool" class="classattr">
                                        <input id="Die.explode_to_pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">explode_to_pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Die.explode_to_pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.explode_to_pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.explode_to_pool-1056"><a href="#Die.explode_to_pool-1056"><span class="linenos">1056</span></a>    <span class="k">def</span> <span class="nf">explode_to_pool</span><span class="p">(</span>
</span><span id="Die.explode_to_pool-1057"><a href="#Die.explode_to_pool-1057"><span class="linenos">1057</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.explode_to_pool-1058"><a href="#Die.explode_to_pool-1058"><span class="linenos">1058</span></a>            <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die.explode_to_pool-1059"><a href="#Die.explode_to_pool-1059"><span class="linenos">1059</span></a>            <span class="n">which</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.explode_to_pool-1060"><a href="#Die.explode_to_pool-1060"><span class="linenos">1060</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die.explode_to_pool-1061"><a href="#Die.explode_to_pool-1061"><span class="linenos">1061</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="Die.explode_to_pool-1062"><a href="#Die.explode_to_pool-1062"><span class="linenos">1062</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.explode_to_pool-1063"><a href="#Die.explode_to_pool-1063"><span class="linenos">1063</span></a>            <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultisetGenerator[T_co, tuple[int]]&#39;</span><span class="p">:</span>
</span><span id="Die.explode_to_pool-1064"><a href="#Die.explode_to_pool-1064"><span class="linenos">1064</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Causes outcomes to be rolled again, keeping that outcome as an individual die in a pool.</span>
</span><span id="Die.explode_to_pool-1065"><a href="#Die.explode_to_pool-1065"><span class="linenos">1065</span></a><span class="sd">        </span>
</span><span id="Die.explode_to_pool-1066"><a href="#Die.explode_to_pool-1066"><span class="linenos">1066</span></a><span class="sd">        Args:</span>
</span><span id="Die.explode_to_pool-1067"><a href="#Die.explode_to_pool-1067"><span class="linenos">1067</span></a><span class="sd">            rolls: The number of initial dice.</span>
</span><span id="Die.explode_to_pool-1068"><a href="#Die.explode_to_pool-1068"><span class="linenos">1068</span></a><span class="sd">            which: Which outcomes to explode. Options:</span>
</span><span id="Die.explode_to_pool-1069"><a href="#Die.explode_to_pool-1069"><span class="linenos">1069</span></a><span class="sd">                * A single outcome to explode.</span>
</span><span id="Die.explode_to_pool-1070"><a href="#Die.explode_to_pool-1070"><span class="linenos">1070</span></a><span class="sd">                * An collection of outcomes to explode.</span>
</span><span id="Die.explode_to_pool-1071"><a href="#Die.explode_to_pool-1071"><span class="linenos">1071</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.explode_to_pool-1072"><a href="#Die.explode_to_pool-1072"><span class="linenos">1072</span></a><span class="sd">                    should be exploded.</span>
</span><span id="Die.explode_to_pool-1073"><a href="#Die.explode_to_pool-1073"><span class="linenos">1073</span></a><span class="sd">                * If not supplied, the max outcome will explode.</span>
</span><span id="Die.explode_to_pool-1074"><a href="#Die.explode_to_pool-1074"><span class="linenos">1074</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die.explode_to_pool-1075"><a href="#Die.explode_to_pool-1075"><span class="linenos">1075</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die.explode_to_pool-1076"><a href="#Die.explode_to_pool-1076"><span class="linenos">1076</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die.explode_to_pool-1077"><a href="#Die.explode_to_pool-1077"><span class="linenos">1077</span></a><span class="sd">                signature.</span>
</span><span id="Die.explode_to_pool-1078"><a href="#Die.explode_to_pool-1078"><span class="linenos">1078</span></a><span class="sd">            depth: The maximum depth of explosions for an individual dice.</span>
</span><span id="Die.explode_to_pool-1079"><a href="#Die.explode_to_pool-1079"><span class="linenos">1079</span></a>
</span><span id="Die.explode_to_pool-1080"><a href="#Die.explode_to_pool-1080"><span class="linenos">1080</span></a><span class="sd">        Returns:</span>
</span><span id="Die.explode_to_pool-1081"><a href="#Die.explode_to_pool-1081"><span class="linenos">1081</span></a><span class="sd">            A `MultisetGenerator` representing the mixture of `Pool`s. Note  </span>
</span><span id="Die.explode_to_pool-1082"><a href="#Die.explode_to_pool-1082"><span class="linenos">1082</span></a><span class="sd">            that this is not technically a `Pool`, though it supports most of </span>
</span><span id="Die.explode_to_pool-1083"><a href="#Die.explode_to_pool-1083"><span class="linenos">1083</span></a><span class="sd">            the same operations.</span>
</span><span id="Die.explode_to_pool-1084"><a href="#Die.explode_to_pool-1084"><span class="linenos">1084</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.explode_to_pool-1085"><a href="#Die.explode_to_pool-1085"><span class="linenos">1085</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.explode_to_pool-1086"><a href="#Die.explode_to_pool-1086"><span class="linenos">1086</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.explode_to_pool-1087"><a href="#Die.explode_to_pool-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="n">which</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.explode_to_pool-1088"><a href="#Die.explode_to_pool-1088"><span class="linenos">1088</span></a>            <span class="n">explode_set</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()}</span>
</span><span id="Die.explode_to_pool-1089"><a href="#Die.explode_to_pool-1089"><span class="linenos">1089</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.explode_to_pool-1090"><a href="#Die.explode_to_pool-1090"><span class="linenos">1090</span></a>            <span class="n">explode_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die.explode_to_pool-1091"><a href="#Die.explode_to_pool-1091"><span class="linenos">1091</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">explode_set</span><span class="p">:</span>
</span><span id="Die.explode_to_pool-1092"><a href="#Die.explode_to_pool-1092"><span class="linenos">1092</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.explode_to_pool-1093"><a href="#Die.explode_to_pool-1093"><span class="linenos">1093</span></a>        <span class="n">explode</span><span class="p">,</span> <span class="n">not_explode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">explode_set</span><span class="p">)</span>
</span><span id="Die.explode_to_pool-1094"><a href="#Die.explode_to_pool-1094"><span class="linenos">1094</span></a>
</span><span id="Die.explode_to_pool-1095"><a href="#Die.explode_to_pool-1095"><span class="linenos">1095</span></a>        <span class="n">single_data</span><span class="p">:</span> <span class="s1">&#39;MutableMapping[icepool.Vector[int], int]&#39;</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
</span><span id="Die.explode_to_pool-1096"><a href="#Die.explode_to_pool-1096"><span class="linenos">1096</span></a>            <span class="nb">int</span><span class="p">)</span>
</span><span id="Die.explode_to_pool-1097"><a href="#Die.explode_to_pool-1097"><span class="linenos">1097</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Die.explode_to_pool-1098"><a href="#Die.explode_to_pool-1098"><span class="linenos">1098</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="n">explode</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="n">i</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span>
</span><span id="Die.explode_to_pool-1099"><a href="#Die.explode_to_pool-1099"><span class="linenos">1099</span></a>                <span class="n">depth</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">not_explode</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Die.explode_to_pool-1100"><a href="#Die.explode_to_pool-1100"><span class="linenos">1100</span></a>            <span class="n">single_data</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">Vector</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">))]</span> <span class="o">+=</span> <span class="n">weight</span>
</span><span id="Die.explode_to_pool-1101"><a href="#Die.explode_to_pool-1101"><span class="linenos">1101</span></a>        <span class="n">single_data</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">Vector</span><span class="p">(</span>
</span><span id="Die.explode_to_pool-1102"><a href="#Die.explode_to_pool-1102"><span class="linenos">1102</span></a>            <span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))]</span> <span class="o">+=</span> <span class="n">explode</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Die.explode_to_pool-1103"><a href="#Die.explode_to_pool-1103"><span class="linenos">1103</span></a>
</span><span id="Die.explode_to_pool-1104"><a href="#Die.explode_to_pool-1104"><span class="linenos">1104</span></a>        <span class="n">single_count_die</span><span class="p">:</span> <span class="s1">&#39;Die[icepool.Vector[int]]&#39;</span> <span class="o">=</span> <span class="n">Die</span><span class="p">(</span><span class="n">single_data</span><span class="p">)</span>
</span><span id="Die.explode_to_pool-1105"><a href="#Die.explode_to_pool-1105"><span class="linenos">1105</span></a>        <span class="n">count_die</span> <span class="o">=</span> <span class="n">rolls</span> <span class="o">@</span> <span class="n">single_count_die</span>
</span><span id="Die.explode_to_pool-1106"><a href="#Die.explode_to_pool-1106"><span class="linenos">1106</span></a>
</span><span id="Die.explode_to_pool-1107"><a href="#Die.explode_to_pool-1107"><span class="linenos">1107</span></a>        <span class="k">return</span> <span class="n">count_die</span><span class="o">.</span><span class="n">map_to_pool</span><span class="p">(</span>
</span><span id="Die.explode_to_pool-1108"><a href="#Die.explode_to_pool-1108"><span class="linenos">1108</span></a>            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">nx</span><span class="p">:</span> <span class="p">[</span><span class="n">explode</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="p">[</span><span class="n">not_explode</span><span class="p">]</span> <span class="o">*</span> <span class="n">nx</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Causes outcomes to be rolled again, keeping that outcome as an individual die in a pool.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of initial dice.</li>
<li><strong>which:</strong>  Which outcomes to explode. Options:
<ul>
<li>A single outcome to explode.</li>
<li>An collection of outcomes to explode.</li>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be exploded.</li>
<li>If not supplied, the max outcome will explode.</li>
</ul></li>
<li><strong>star:</strong>  Whether outcomes should be unpacked into separate arguments
before sending them to a callable <code>which</code>.
If not provided, this will be guessed based on the function
signature.</li>
<li><strong>depth:</strong>  The maximum depth of explosions for an individual dice.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#MultisetGenerator">MultisetGenerator</a></code> representing the mixture of <code><a href="#Pool">Pool</a></code>s. Note<br />
  that this is not technically a <code><a href="#Pool">Pool</a></code>, though it supports most of 
  the same operations.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.reroll_to_pool" class="classattr">
                                        <input id="Die.reroll_to_pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reroll_to_pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">which</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">max_rerolls</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="s1">&#39;lowest&#39;</span><span class="p">,</span> <span class="s1">&#39;highest&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Die.reroll_to_pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.reroll_to_pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.reroll_to_pool-1110"><a href="#Die.reroll_to_pool-1110"><span class="linenos">1110</span></a>    <span class="k">def</span> <span class="nf">reroll_to_pool</span><span class="p">(</span>
</span><span id="Die.reroll_to_pool-1111"><a href="#Die.reroll_to_pool-1111"><span class="linenos">1111</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1112"><a href="#Die.reroll_to_pool-1112"><span class="linenos">1112</span></a>        <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1113"><a href="#Die.reroll_to_pool-1113"><span class="linenos">1113</span></a>        <span class="n">which</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
</span><span id="Die.reroll_to_pool-1114"><a href="#Die.reroll_to_pool-1114"><span class="linenos">1114</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1115"><a href="#Die.reroll_to_pool-1115"><span class="linenos">1115</span></a>        <span class="n">max_rerolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1116"><a href="#Die.reroll_to_pool-1116"><span class="linenos">1116</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1117"><a href="#Die.reroll_to_pool-1117"><span class="linenos">1117</span></a>        <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1118"><a href="#Die.reroll_to_pool-1118"><span class="linenos">1118</span></a>        <span class="n">mode</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="s1">&#39;lowest&#39;</span><span class="p">,</span> <span class="s1">&#39;highest&#39;</span><span class="p">,</span> <span class="s1">&#39;drop&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;random&#39;</span>
</span><span id="Die.reroll_to_pool-1119"><a href="#Die.reroll_to_pool-1119"><span class="linenos">1119</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultisetGenerator[T_co, tuple[int]]&#39;</span><span class="p">:</span>
</span><span id="Die.reroll_to_pool-1120"><a href="#Die.reroll_to_pool-1120"><span class="linenos">1120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Applies a limited number of rerolls shared across a pool.</span>
</span><span id="Die.reroll_to_pool-1121"><a href="#Die.reroll_to_pool-1121"><span class="linenos">1121</span></a>
</span><span id="Die.reroll_to_pool-1122"><a href="#Die.reroll_to_pool-1122"><span class="linenos">1122</span></a><span class="sd">        Each die can only be rerolled once (effectively `depth=1`), and no more</span>
</span><span id="Die.reroll_to_pool-1123"><a href="#Die.reroll_to_pool-1123"><span class="linenos">1123</span></a><span class="sd">        than `max_rerolls` dice may be rerolled.</span>
</span><span id="Die.reroll_to_pool-1124"><a href="#Die.reroll_to_pool-1124"><span class="linenos">1124</span></a><span class="sd">        </span>
</span><span id="Die.reroll_to_pool-1125"><a href="#Die.reroll_to_pool-1125"><span class="linenos">1125</span></a><span class="sd">        Args:</span>
</span><span id="Die.reroll_to_pool-1126"><a href="#Die.reroll_to_pool-1126"><span class="linenos">1126</span></a><span class="sd">            rolls: How many dice in the pool.</span>
</span><span id="Die.reroll_to_pool-1127"><a href="#Die.reroll_to_pool-1127"><span class="linenos">1127</span></a><span class="sd">            which: Selects which outcomes are eligible to be rerolled. Options:</span>
</span><span id="Die.reroll_to_pool-1128"><a href="#Die.reroll_to_pool-1128"><span class="linenos">1128</span></a><span class="sd">                * A collection of outcomes to reroll.</span>
</span><span id="Die.reroll_to_pool-1129"><a href="#Die.reroll_to_pool-1129"><span class="linenos">1129</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.reroll_to_pool-1130"><a href="#Die.reroll_to_pool-1130"><span class="linenos">1130</span></a><span class="sd">                    could be rerolled.</span>
</span><span id="Die.reroll_to_pool-1131"><a href="#Die.reroll_to_pool-1131"><span class="linenos">1131</span></a><span class="sd">            max_rerolls: The maximum number of dice to reroll. </span>
</span><span id="Die.reroll_to_pool-1132"><a href="#Die.reroll_to_pool-1132"><span class="linenos">1132</span></a><span class="sd">                Note that each die can only be rerolled once, so if the number </span>
</span><span id="Die.reroll_to_pool-1133"><a href="#Die.reroll_to_pool-1133"><span class="linenos">1133</span></a><span class="sd">                of eligible dice is less than this, the excess rerolls have no</span>
</span><span id="Die.reroll_to_pool-1134"><a href="#Die.reroll_to_pool-1134"><span class="linenos">1134</span></a><span class="sd">                effect.</span>
</span><span id="Die.reroll_to_pool-1135"><a href="#Die.reroll_to_pool-1135"><span class="linenos">1135</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Die.reroll_to_pool-1136"><a href="#Die.reroll_to_pool-1136"><span class="linenos">1136</span></a><span class="sd">                before sending them to a callable `which`.</span>
</span><span id="Die.reroll_to_pool-1137"><a href="#Die.reroll_to_pool-1137"><span class="linenos">1137</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Die.reroll_to_pool-1138"><a href="#Die.reroll_to_pool-1138"><span class="linenos">1138</span></a><span class="sd">                signature.</span>
</span><span id="Die.reroll_to_pool-1139"><a href="#Die.reroll_to_pool-1139"><span class="linenos">1139</span></a><span class="sd">            mode: How dice are selected for rerolling if there are more eligible</span>
</span><span id="Die.reroll_to_pool-1140"><a href="#Die.reroll_to_pool-1140"><span class="linenos">1140</span></a><span class="sd">                dice than `max_rerolls`. Options:</span>
</span><span id="Die.reroll_to_pool-1141"><a href="#Die.reroll_to_pool-1141"><span class="linenos">1141</span></a><span class="sd">                * `&#39;random&#39;` (default): Eligible dice will be chosen uniformly</span>
</span><span id="Die.reroll_to_pool-1142"><a href="#Die.reroll_to_pool-1142"><span class="linenos">1142</span></a><span class="sd">                    at random.</span>
</span><span id="Die.reroll_to_pool-1143"><a href="#Die.reroll_to_pool-1143"><span class="linenos">1143</span></a><span class="sd">                * `&#39;lowest&#39;`: The lowest eligible dice will be rerolled.</span>
</span><span id="Die.reroll_to_pool-1144"><a href="#Die.reroll_to_pool-1144"><span class="linenos">1144</span></a><span class="sd">                * `&#39;highest&#39;`: The highest eligible dice will be rerolled.</span>
</span><span id="Die.reroll_to_pool-1145"><a href="#Die.reroll_to_pool-1145"><span class="linenos">1145</span></a><span class="sd">                * `&#39;drop&#39;`: All dice that ended up on an outcome selected by </span>
</span><span id="Die.reroll_to_pool-1146"><a href="#Die.reroll_to_pool-1146"><span class="linenos">1146</span></a><span class="sd">                    `which` will be dropped. This includes both dice that rolled</span>
</span><span id="Die.reroll_to_pool-1147"><a href="#Die.reroll_to_pool-1147"><span class="linenos">1147</span></a><span class="sd">                    into `which` initially and were not rerolled, and dice that</span>
</span><span id="Die.reroll_to_pool-1148"><a href="#Die.reroll_to_pool-1148"><span class="linenos">1148</span></a><span class="sd">                    were rerolled but rolled into `which` again. This can be</span>
</span><span id="Die.reroll_to_pool-1149"><a href="#Die.reroll_to_pool-1149"><span class="linenos">1149</span></a><span class="sd">                    considerably more efficient than the other modes.</span>
</span><span id="Die.reroll_to_pool-1150"><a href="#Die.reroll_to_pool-1150"><span class="linenos">1150</span></a>
</span><span id="Die.reroll_to_pool-1151"><a href="#Die.reroll_to_pool-1151"><span class="linenos">1151</span></a><span class="sd">        Returns:</span>
</span><span id="Die.reroll_to_pool-1152"><a href="#Die.reroll_to_pool-1152"><span class="linenos">1152</span></a><span class="sd">            A `MultisetGenerator` representing the mixture of `Pool`s. Note  </span>
</span><span id="Die.reroll_to_pool-1153"><a href="#Die.reroll_to_pool-1153"><span class="linenos">1153</span></a><span class="sd">            that this is not technically a `Pool`, though it supports most of </span>
</span><span id="Die.reroll_to_pool-1154"><a href="#Die.reroll_to_pool-1154"><span class="linenos">1154</span></a><span class="sd">            the same operations.</span>
</span><span id="Die.reroll_to_pool-1155"><a href="#Die.reroll_to_pool-1155"><span class="linenos">1155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.reroll_to_pool-1156"><a href="#Die.reroll_to_pool-1156"><span class="linenos">1156</span></a>        <span class="n">rerollable_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_outcomes</span><span class="p">(</span><span class="n">which</span><span class="p">,</span> <span class="n">star</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1157"><a href="#Die.reroll_to_pool-1157"><span class="linenos">1157</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">rerollable_set</span><span class="p">:</span>
</span><span id="Die.reroll_to_pool-1158"><a href="#Die.reroll_to_pool-1158"><span class="linenos">1158</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1159"><a href="#Die.reroll_to_pool-1159"><span class="linenos">1159</span></a>
</span><span id="Die.reroll_to_pool-1160"><a href="#Die.reroll_to_pool-1160"><span class="linenos">1160</span></a>        <span class="n">rerollable_die</span><span class="p">,</span> <span class="n">not_rerollable_die</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rerollable_set</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1161"><a href="#Die.reroll_to_pool-1161"><span class="linenos">1161</span></a>        <span class="n">single_is_rerollable</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">coin</span><span class="p">(</span><span class="n">rerollable_die</span><span class="o">.</span><span class="n">denominator</span><span class="p">(),</span>
</span><span id="Die.reroll_to_pool-1162"><a href="#Die.reroll_to_pool-1162"><span class="linenos">1162</span></a>                                            <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Die.reroll_to_pool-1163"><a href="#Die.reroll_to_pool-1163"><span class="linenos">1163</span></a>        <span class="n">rerollable</span> <span class="o">=</span> <span class="n">rolls</span> <span class="o">@</span> <span class="n">single_is_rerollable</span>
</span><span id="Die.reroll_to_pool-1164"><a href="#Die.reroll_to_pool-1164"><span class="linenos">1164</span></a>
</span><span id="Die.reroll_to_pool-1165"><a href="#Die.reroll_to_pool-1165"><span class="linenos">1165</span></a>        <span class="k">def</span> <span class="nf">split</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Die</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="Die.reroll_to_pool-1166"><a href="#Die.reroll_to_pool-1166"><span class="linenos">1166</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Computes the composition of the pool.</span>
</span><span id="Die.reroll_to_pool-1167"><a href="#Die.reroll_to_pool-1167"><span class="linenos">1167</span></a>
</span><span id="Die.reroll_to_pool-1168"><a href="#Die.reroll_to_pool-1168"><span class="linenos">1168</span></a><span class="sd">            Returns:</span>
</span><span id="Die.reroll_to_pool-1169"><a href="#Die.reroll_to_pool-1169"><span class="linenos">1169</span></a><span class="sd">                initial_rerollable: The number of dice that initially fell into</span>
</span><span id="Die.reroll_to_pool-1170"><a href="#Die.reroll_to_pool-1170"><span class="linenos">1170</span></a><span class="sd">                    the rerollable set.</span>
</span><span id="Die.reroll_to_pool-1171"><a href="#Die.reroll_to_pool-1171"><span class="linenos">1171</span></a><span class="sd">                rerolled_to_rerollable: The number of dice that were rerolled,</span>
</span><span id="Die.reroll_to_pool-1172"><a href="#Die.reroll_to_pool-1172"><span class="linenos">1172</span></a><span class="sd">                    but fell into the rerollable set again.</span>
</span><span id="Die.reroll_to_pool-1173"><a href="#Die.reroll_to_pool-1173"><span class="linenos">1173</span></a><span class="sd">                not_rerollable: The number of dice that ended up outside the</span>
</span><span id="Die.reroll_to_pool-1174"><a href="#Die.reroll_to_pool-1174"><span class="linenos">1174</span></a><span class="sd">                    rerollable set, including both initial and rerolled dice.</span>
</span><span id="Die.reroll_to_pool-1175"><a href="#Die.reroll_to_pool-1175"><span class="linenos">1175</span></a><span class="sd">                not_rerolled: The number of dice that were eligible for</span>
</span><span id="Die.reroll_to_pool-1176"><a href="#Die.reroll_to_pool-1176"><span class="linenos">1176</span></a><span class="sd">                    rerolling but were not rerolled.</span>
</span><span id="Die.reroll_to_pool-1177"><a href="#Die.reroll_to_pool-1177"><span class="linenos">1177</span></a><span class="sd">            &quot;&quot;&quot;</span>
</span><span id="Die.reroll_to_pool-1178"><a href="#Die.reroll_to_pool-1178"><span class="linenos">1178</span></a>            <span class="n">initial_not_rerollable</span> <span class="o">=</span> <span class="n">rolls</span> <span class="o">-</span> <span class="n">initial_rerollable</span>
</span><span id="Die.reroll_to_pool-1179"><a href="#Die.reroll_to_pool-1179"><span class="linenos">1179</span></a>            <span class="n">rerolled</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">,</span> <span class="n">max_rerolls</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1180"><a href="#Die.reroll_to_pool-1180"><span class="linenos">1180</span></a>            <span class="n">not_rerolled</span> <span class="o">=</span> <span class="n">initial_rerollable</span> <span class="o">-</span> <span class="n">rerolled</span>
</span><span id="Die.reroll_to_pool-1181"><a href="#Die.reroll_to_pool-1181"><span class="linenos">1181</span></a>
</span><span id="Die.reroll_to_pool-1182"><a href="#Die.reroll_to_pool-1182"><span class="linenos">1182</span></a>            <span class="k">def</span> <span class="nf">second_split</span><span class="p">(</span><span class="n">rerolled_to_rerollable</span><span class="p">):</span>
</span><span id="Die.reroll_to_pool-1183"><a href="#Die.reroll_to_pool-1183"><span class="linenos">1183</span></a><span class="w">                </span><span class="sd">&quot;&quot;&quot;Splits the rerolled dice into those that fell into the rerollable and not-rerollable sets.&quot;&quot;&quot;</span>
</span><span id="Die.reroll_to_pool-1184"><a href="#Die.reroll_to_pool-1184"><span class="linenos">1184</span></a>                <span class="n">rerolled_to_not_rerollable</span> <span class="o">=</span> <span class="n">rerolled</span> <span class="o">-</span> <span class="n">rerolled_to_rerollable</span>
</span><span id="Die.reroll_to_pool-1185"><a href="#Die.reroll_to_pool-1185"><span class="linenos">1185</span></a>                <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">tupleize</span><span class="p">(</span>
</span><span id="Die.reroll_to_pool-1186"><a href="#Die.reroll_to_pool-1186"><span class="linenos">1186</span></a>                    <span class="n">initial_rerollable</span><span class="p">,</span> <span class="n">rerolled_to_rerollable</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1187"><a href="#Die.reroll_to_pool-1187"><span class="linenos">1187</span></a>                    <span class="n">initial_not_rerollable</span> <span class="o">+</span> <span class="n">rerolled_to_not_rerollable</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1188"><a href="#Die.reroll_to_pool-1188"><span class="linenos">1188</span></a>                    <span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1189"><a href="#Die.reroll_to_pool-1189"><span class="linenos">1189</span></a>
</span><span id="Die.reroll_to_pool-1190"><a href="#Die.reroll_to_pool-1190"><span class="linenos">1190</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">second_split</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1191"><a href="#Die.reroll_to_pool-1191"><span class="linenos">1191</span></a>                               <span class="n">rerolled</span> <span class="o">@</span> <span class="n">single_is_rerollable</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1192"><a href="#Die.reroll_to_pool-1192"><span class="linenos">1192</span></a>                               <span class="n">star</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1193"><a href="#Die.reroll_to_pool-1193"><span class="linenos">1193</span></a>
</span><span id="Die.reroll_to_pool-1194"><a href="#Die.reroll_to_pool-1194"><span class="linenos">1194</span></a>        <span class="n">pool_composition</span> <span class="o">=</span> <span class="n">rerollable</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">star</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1195"><a href="#Die.reroll_to_pool-1195"><span class="linenos">1195</span></a>
</span><span id="Die.reroll_to_pool-1196"><a href="#Die.reroll_to_pool-1196"><span class="linenos">1196</span></a>        <span class="k">def</span> <span class="nf">make_pool</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">,</span> <span class="n">rerolled_to_rerollable</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1197"><a href="#Die.reroll_to_pool-1197"><span class="linenos">1197</span></a>                      <span class="n">not_rerollable</span><span class="p">,</span> <span class="n">not_rerolled</span><span class="p">):</span>
</span><span id="Die.reroll_to_pool-1198"><a href="#Die.reroll_to_pool-1198"><span class="linenos">1198</span></a>            <span class="n">common</span> <span class="o">=</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span>
</span><span id="Die.reroll_to_pool-1199"><a href="#Die.reroll_to_pool-1199"><span class="linenos">1199</span></a>                <span class="n">rerolled_to_rerollable</span><span class="p">)</span> <span class="o">+</span> <span class="n">not_rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span>
</span><span id="Die.reroll_to_pool-1200"><a href="#Die.reroll_to_pool-1200"><span class="linenos">1200</span></a>                    <span class="n">not_rerollable</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1201"><a href="#Die.reroll_to_pool-1201"><span class="linenos">1201</span></a>            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;random&#39;</span><span class="p">:</span>
</span><span id="Die.reroll_to_pool-1202"><a href="#Die.reroll_to_pool-1202"><span class="linenos">1202</span></a>                <span class="k">return</span> <span class="n">common</span> <span class="o">+</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1203"><a href="#Die.reroll_to_pool-1203"><span class="linenos">1203</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;lowest&#39;</span><span class="p">:</span>
</span><span id="Die.reroll_to_pool-1204"><a href="#Die.reroll_to_pool-1204"><span class="linenos">1204</span></a>                <span class="k">return</span> <span class="n">common</span> <span class="o">+</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span>
</span><span id="Die.reroll_to_pool-1205"><a href="#Die.reroll_to_pool-1205"><span class="linenos">1205</span></a>                    <span class="n">initial_rerollable</span><span class="p">)</span><span class="o">.</span><span class="n">highest</span><span class="p">(</span><span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1206"><a href="#Die.reroll_to_pool-1206"><span class="linenos">1206</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;highest&#39;</span><span class="p">:</span>
</span><span id="Die.reroll_to_pool-1207"><a href="#Die.reroll_to_pool-1207"><span class="linenos">1207</span></a>                <span class="k">return</span> <span class="n">common</span> <span class="o">+</span> <span class="n">rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">initial_rerollable</span><span class="p">)</span><span class="o">.</span><span class="n">lowest</span><span class="p">(</span>
</span><span id="Die.reroll_to_pool-1208"><a href="#Die.reroll_to_pool-1208"><span class="linenos">1208</span></a>                    <span class="n">not_rerolled</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1209"><a href="#Die.reroll_to_pool-1209"><span class="linenos">1209</span></a>            <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;drop&#39;</span><span class="p">:</span>
</span><span id="Die.reroll_to_pool-1210"><a href="#Die.reroll_to_pool-1210"><span class="linenos">1210</span></a>                <span class="k">return</span> <span class="n">not_rerollable_die</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">not_rerollable</span><span class="p">)</span>
</span><span id="Die.reroll_to_pool-1211"><a href="#Die.reroll_to_pool-1211"><span class="linenos">1211</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.reroll_to_pool-1212"><a href="#Die.reroll_to_pool-1212"><span class="linenos">1212</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.reroll_to_pool-1213"><a href="#Die.reroll_to_pool-1213"><span class="linenos">1213</span></a>                    <span class="sa">f</span><span class="s2">&quot;Invalid reroll_priority &#39;</span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2">&#39;. Allowed values are &#39;random&#39;, &#39;lowest&#39;, &#39;highest&#39;, &#39;drop&#39;.&quot;</span>
</span><span id="Die.reroll_to_pool-1214"><a href="#Die.reroll_to_pool-1214"><span class="linenos">1214</span></a>                <span class="p">)</span>
</span><span id="Die.reroll_to_pool-1215"><a href="#Die.reroll_to_pool-1215"><span class="linenos">1215</span></a>
</span><span id="Die.reroll_to_pool-1216"><a href="#Die.reroll_to_pool-1216"><span class="linenos">1216</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">rolls</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="n">max_rerolls</span><span class="p">))</span>
</span><span id="Die.reroll_to_pool-1217"><a href="#Die.reroll_to_pool-1217"><span class="linenos">1217</span></a>
</span><span id="Die.reroll_to_pool-1218"><a href="#Die.reroll_to_pool-1218"><span class="linenos">1218</span></a>        <span class="k">return</span> <span class="n">pool_composition</span><span class="o">.</span><span class="n">map_to_pool</span><span class="p">(</span><span class="n">make_pool</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1219"><a href="#Die.reroll_to_pool-1219"><span class="linenos">1219</span></a>                                            <span class="n">star</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="Die.reroll_to_pool-1220"><a href="#Die.reroll_to_pool-1220"><span class="linenos">1220</span></a>                                            <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Applies a limited number of rerolls shared across a pool.</p>

<p>Each die can only be rerolled once (effectively <code>depth=1</code>), and no more
than <code>max_rerolls</code> dice may be rerolled.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  How many dice in the pool.</li>
<li><strong>which:</strong>  Selects which outcomes are eligible to be rerolled. Options:
<ul>
<li>A collection of outcomes to reroll.</li>
<li>A callable that takes an outcome and returns <code>True</code> if it
could be rerolled.</li>
</ul></li>
<li><strong>max_rerolls:</strong>  The maximum number of dice to reroll. 
Note that each die can only be rerolled once, so if the number 
of eligible dice is less than this, the excess rerolls have no
effect.</li>
<li><strong>star:</strong>  Whether outcomes should be unpacked into separate arguments
before sending them to a callable <code>which</code>.
If not provided, this will be guessed based on the function
signature.</li>
<li><strong>mode:</strong>  How dice are selected for rerolling if there are more eligible
dice than <code>max_rerolls</code>. Options:
<ul>
<li><code>'random'</code> (default): Eligible dice will be chosen uniformly
at random.</li>
<li><code>'lowest'</code>: The lowest eligible dice will be rerolled.</li>
<li><code>'highest'</code>: The highest eligible dice will be rerolled.</li>
<li><code>'drop'</code>: All dice that ended up on an outcome selected by 
<code>which</code> will be dropped. This includes both dice that rolled
into <code>which</code> initially and were not rerolled, and dice that
were rerolled but rolled into <code>which</code> again. This can be
considerably more efficient than the other modes.</li>
</ul></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#MultisetGenerator">MultisetGenerator</a></code> representing the mixture of <code><a href="#Pool">Pool</a></code>s. Note<br />
  that this is not technically a <code><a href="#Pool">Pool</a></code>, though it supports most of 
  the same operations.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.abs" class="classattr">
                                        <input id="Die.abs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">abs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.abs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.abs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.abs-1233"><a href="#Die.abs-1233"><span class="linenos">1233</span></a>    <span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.abs-1234"><a href="#Die.abs-1234"><span class="linenos">1234</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.round" class="classattr">
                                        <input id="Die.round-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">round</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.round-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.round"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.round-1238"><a href="#Die.round-1238"><span class="linenos">1238</span></a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.round-1239"><a href="#Die.round-1239"><span class="linenos">1239</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.stochastic_round" class="classattr">
                                        <input id="Die.stochastic_round-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stochastic_round</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">max_denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.stochastic_round-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.stochastic_round"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.stochastic_round-1243"><a href="#Die.stochastic_round-1243"><span class="linenos">1243</span></a>    <span class="k">def</span> <span class="nf">stochastic_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.stochastic_round-1244"><a href="#Die.stochastic_round-1244"><span class="linenos">1244</span></a>                         <span class="o">*</span><span class="p">,</span>
</span><span id="Die.stochastic_round-1245"><a href="#Die.stochastic_round-1245"><span class="linenos">1245</span></a>                         <span class="n">max_denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die.stochastic_round-1246"><a href="#Die.stochastic_round-1246"><span class="linenos">1246</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Randomly rounds outcomes up or down to the nearest integer according to the two distances.</span>
</span><span id="Die.stochastic_round-1247"><a href="#Die.stochastic_round-1247"><span class="linenos">1247</span></a><span class="sd">        </span>
</span><span id="Die.stochastic_round-1248"><a href="#Die.stochastic_round-1248"><span class="linenos">1248</span></a><span class="sd">        Specificially, rounds `x` up with probability `x - floor(x)` and down</span>
</span><span id="Die.stochastic_round-1249"><a href="#Die.stochastic_round-1249"><span class="linenos">1249</span></a><span class="sd">        otherwise.</span>
</span><span id="Die.stochastic_round-1250"><a href="#Die.stochastic_round-1250"><span class="linenos">1250</span></a>
</span><span id="Die.stochastic_round-1251"><a href="#Die.stochastic_round-1251"><span class="linenos">1251</span></a><span class="sd">        Args:</span>
</span><span id="Die.stochastic_round-1252"><a href="#Die.stochastic_round-1252"><span class="linenos">1252</span></a><span class="sd">            max_denominator: If provided, each rounding will be performed</span>
</span><span id="Die.stochastic_round-1253"><a href="#Die.stochastic_round-1253"><span class="linenos">1253</span></a><span class="sd">                using `fractions.Fraction.limit_denominator(max_denominator)`.</span>
</span><span id="Die.stochastic_round-1254"><a href="#Die.stochastic_round-1254"><span class="linenos">1254</span></a><span class="sd">                Otherwise, the rounding will be performed without</span>
</span><span id="Die.stochastic_round-1255"><a href="#Die.stochastic_round-1255"><span class="linenos">1255</span></a><span class="sd">                `limit_denominator`.</span>
</span><span id="Die.stochastic_round-1256"><a href="#Die.stochastic_round-1256"><span class="linenos">1256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.stochastic_round-1257"><a href="#Die.stochastic_round-1257"><span class="linenos">1257</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">stochastic_round</span><span class="p">(</span>
</span><span id="Die.stochastic_round-1258"><a href="#Die.stochastic_round-1258"><span class="linenos">1258</span></a>            <span class="n">x</span><span class="p">,</span> <span class="n">max_denominator</span><span class="o">=</span><span class="n">max_denominator</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Randomly rounds outcomes up or down to the nearest integer according to the two distances.</p>

<p>Specificially, rounds <code>x</code> up with probability <code>x - floor(x)</code> and down
otherwise.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>max_denominator:</strong>  If provided, each rounding will be performed
using <code>fractions.Fraction.limit_denominator(max_denominator)</code>.
Otherwise, the rounding will be performed without
<code>limit_denominator</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Die.trunc" class="classattr">
                                        <input id="Die.trunc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trunc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.trunc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.trunc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.trunc-1260"><a href="#Die.trunc-1260"><span class="linenos">1260</span></a>    <span class="k">def</span> <span class="nf">trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.trunc-1261"><a href="#Die.trunc-1261"><span class="linenos">1261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.floor" class="classattr">
                                        <input id="Die.floor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">floor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.floor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.floor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.floor-1265"><a href="#Die.floor-1265"><span class="linenos">1265</span></a>    <span class="k">def</span> <span class="nf">floor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.floor-1266"><a href="#Die.floor-1266"><span class="linenos">1266</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.ceil" class="classattr">
                                        <input id="Die.ceil-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ceil</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.ceil-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.ceil"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.ceil-1270"><a href="#Die.ceil-1270"><span class="linenos">1270</span></a>    <span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.ceil-1271"><a href="#Die.ceil-1271"><span class="linenos">1271</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.zero" class="classattr">
                                        <input id="Die.zero-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zero</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.zero-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.zero"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.zero-1279"><a href="#Die.zero-1279"><span class="linenos">1279</span></a>    <span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[T_co]&#39;</span><span class="p">:</span>
</span><span id="Die.zero-1280"><a href="#Die.zero-1280"><span class="linenos">1280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Zeros all outcomes of this die.</span>
</span><span id="Die.zero-1281"><a href="#Die.zero-1281"><span class="linenos">1281</span></a>
</span><span id="Die.zero-1282"><a href="#Die.zero-1282"><span class="linenos">1282</span></a><span class="sd">        This is done by multiplying all outcomes by `0`.</span>
</span><span id="Die.zero-1283"><a href="#Die.zero-1283"><span class="linenos">1283</span></a>
</span><span id="Die.zero-1284"><a href="#Die.zero-1284"><span class="linenos">1284</span></a><span class="sd">        The result will have the same denominator as this die.</span>
</span><span id="Die.zero-1285"><a href="#Die.zero-1285"><span class="linenos">1285</span></a>
</span><span id="Die.zero-1286"><a href="#Die.zero-1286"><span class="linenos">1286</span></a><span class="sd">        Raises:</span>
</span><span id="Die.zero-1287"><a href="#Die.zero-1287"><span class="linenos">1287</span></a><span class="sd">            ValueError: If the zeros did not resolve to a single outcome.</span>
</span><span id="Die.zero-1288"><a href="#Die.zero-1288"><span class="linenos">1288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.zero-1289"><a href="#Die.zero-1289"><span class="linenos">1289</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_zero</span><span class="p">)</span>
</span><span id="Die.zero-1290"><a href="#Die.zero-1290"><span class="linenos">1290</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die.zero-1291"><a href="#Die.zero-1291"><span class="linenos">1291</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;zero() did not resolve to a single outcome.&#39;</span><span class="p">)</span>
</span><span id="Die.zero-1292"><a href="#Die.zero-1292"><span class="linenos">1292</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Zeros all outcomes of this die.</p>

<p>This is done by multiplying all outcomes by <code>0</code>.</p>

<p>The result will have the same denominator as this die.</p>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If the zeros did not resolve to a single outcome.</li>
</ul>
</div>


                            </div>
                            <div id="Die.zero_outcome" class="classattr">
                                        <input id="Die.zero_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zero_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Die.zero_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.zero_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.zero_outcome-1294"><a href="#Die.zero_outcome-1294"><span class="linenos">1294</span></a>    <span class="k">def</span> <span class="nf">zero_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Die.zero_outcome-1295"><a href="#Die.zero_outcome-1295"><span class="linenos">1295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A zero-outcome for this die.</span>
</span><span id="Die.zero_outcome-1296"><a href="#Die.zero_outcome-1296"><span class="linenos">1296</span></a>
</span><span id="Die.zero_outcome-1297"><a href="#Die.zero_outcome-1297"><span class="linenos">1297</span></a><span class="sd">        E.g. `0` for a `Die` whose outcomes are `int`s.</span>
</span><span id="Die.zero_outcome-1298"><a href="#Die.zero_outcome-1298"><span class="linenos">1298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.zero_outcome-1299"><a href="#Die.zero_outcome-1299"><span class="linenos">1299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A zero-outcome for this die.</p>

<p>E.g. <code>0</code> for a <code><a href="#Die">Die</a></code> whose outcomes are <code>int</code>s.</p>
</div>


                            </div>
                            <div id="Die.cmp" class="classattr">
                                        <input id="Die.cmp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cmp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.cmp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.cmp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.cmp-1503"><a href="#Die.cmp-1503"><span class="linenos">1503</span></a>    <span class="k">def</span> <span class="nf">cmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die.cmp-1504"><a href="#Die.cmp-1504"><span class="linenos">1504</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `Die` with outcomes 1, -1, and 0.</span>
</span><span id="Die.cmp-1505"><a href="#Die.cmp-1505"><span class="linenos">1505</span></a>
</span><span id="Die.cmp-1506"><a href="#Die.cmp-1506"><span class="linenos">1506</span></a><span class="sd">        The quantities are equal to the positive outcome of `self &gt; other`,</span>
</span><span id="Die.cmp-1507"><a href="#Die.cmp-1507"><span class="linenos">1507</span></a><span class="sd">        `self &lt; other`, and the remainder respectively.</span>
</span><span id="Die.cmp-1508"><a href="#Die.cmp-1508"><span class="linenos">1508</span></a>
</span><span id="Die.cmp-1509"><a href="#Die.cmp-1509"><span class="linenos">1509</span></a><span class="sd">        This will include all three outcomes even if they have zero quantity.</span>
</span><span id="Die.cmp-1510"><a href="#Die.cmp-1510"><span class="linenos">1510</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.cmp-1511"><a href="#Die.cmp-1511"><span class="linenos">1511</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die.cmp-1512"><a href="#Die.cmp-1512"><span class="linenos">1512</span></a>
</span><span id="Die.cmp-1513"><a href="#Die.cmp-1513"><span class="linenos">1513</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die.cmp-1514"><a href="#Die.cmp-1514"><span class="linenos">1514</span></a>
</span><span id="Die.cmp-1515"><a href="#Die.cmp-1515"><span class="linenos">1515</span></a>        <span class="n">lt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span>
</span><span id="Die.cmp-1516"><a href="#Die.cmp-1516"><span class="linenos">1516</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">:</span>
</span><span id="Die.cmp-1517"><a href="#Die.cmp-1517"><span class="linenos">1517</span></a>            <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die.cmp-1518"><a href="#Die.cmp-1518"><span class="linenos">1518</span></a>        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Die.cmp-1519"><a href="#Die.cmp-1519"><span class="linenos">1519</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
</span><span id="Die.cmp-1520"><a href="#Die.cmp-1520"><span class="linenos">1520</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die.cmp-1521"><a href="#Die.cmp-1521"><span class="linenos">1521</span></a>        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span>
</span><span id="Die.cmp-1522"><a href="#Die.cmp-1522"><span class="linenos">1522</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">:</span>
</span><span id="Die.cmp-1523"><a href="#Die.cmp-1523"><span class="linenos">1523</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die.cmp-1524"><a href="#Die.cmp-1524"><span class="linenos">1524</span></a>
</span><span id="Die.cmp-1525"><a href="#Die.cmp-1525"><span class="linenos">1525</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Die">Die</a></code> with outcomes 1, -1, and 0.</p>

<p>The quantities are equal to the positive outcome of <code>self &gt; other</code>,
<code>self &lt; other</code>, and the remainder respectively.</p>

<p>This will include all three outcomes even if they have zero quantity.</p>
</div>


                            </div>
                            <div id="Die.sign" class="classattr">
                                        <input id="Die.sign-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sign</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Die.sign-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.sign"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.sign-1537"><a href="#Die.sign-1537"><span class="linenos">1537</span></a>    <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die[int]&#39;</span><span class="p">:</span>
</span><span id="Die.sign-1538"><a href="#Die.sign-1538"><span class="linenos">1538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Outcomes become 1 if greater than `zero()`, -1 if less than `zero()`, and 0 otherwise.</span>
</span><span id="Die.sign-1539"><a href="#Die.sign-1539"><span class="linenos">1539</span></a>
</span><span id="Die.sign-1540"><a href="#Die.sign-1540"><span class="linenos">1540</span></a><span class="sd">        Note that for `float`s, +0.0, -0.0, and nan all become 0.</span>
</span><span id="Die.sign-1541"><a href="#Die.sign-1541"><span class="linenos">1541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.sign-1542"><a href="#Die.sign-1542"><span class="linenos">1542</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_sign</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Outcomes become 1 if greater than <code><a href="#Die.zero">zero()</a></code>, -1 if less than <code><a href="#Die.zero">zero()</a></code>, and 0 otherwise.</p>

<p>Note that for <code>float</code>s, +0.0, -0.0, and nan all become 0.</p>
</div>


                            </div>
                            <div id="Die.equals" class="classattr">
                                        <input id="Die.equals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">equals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span>, </span><span class="param"><span class="o">*</span>, </span><span class="param"><span class="n">simplify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Die.equals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.equals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.equals-1570"><a href="#Die.equals-1570"><span class="linenos">1570</span></a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">simplify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Die.equals-1571"><a href="#Die.equals-1571"><span class="linenos">1571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`True` iff both dice have the same outcomes and quantities.</span>
</span><span id="Die.equals-1572"><a href="#Die.equals-1572"><span class="linenos">1572</span></a>
</span><span id="Die.equals-1573"><a href="#Die.equals-1573"><span class="linenos">1573</span></a><span class="sd">        This is `False` if `other` is not a `Die`, even if it would convert</span>
</span><span id="Die.equals-1574"><a href="#Die.equals-1574"><span class="linenos">1574</span></a><span class="sd">        to an equal `Die`.</span>
</span><span id="Die.equals-1575"><a href="#Die.equals-1575"><span class="linenos">1575</span></a>
</span><span id="Die.equals-1576"><a href="#Die.equals-1576"><span class="linenos">1576</span></a><span class="sd">        Truth value does NOT matter.</span>
</span><span id="Die.equals-1577"><a href="#Die.equals-1577"><span class="linenos">1577</span></a>
</span><span id="Die.equals-1578"><a href="#Die.equals-1578"><span class="linenos">1578</span></a><span class="sd">        If one `Die` has a zero-quantity outcome and the other `Die` does not</span>
</span><span id="Die.equals-1579"><a href="#Die.equals-1579"><span class="linenos">1579</span></a><span class="sd">        contain that outcome, they are treated as unequal by this function.</span>
</span><span id="Die.equals-1580"><a href="#Die.equals-1580"><span class="linenos">1580</span></a>
</span><span id="Die.equals-1581"><a href="#Die.equals-1581"><span class="linenos">1581</span></a><span class="sd">        The `==` and `!=` operators have a dual purpose; they return a `Die`</span>
</span><span id="Die.equals-1582"><a href="#Die.equals-1582"><span class="linenos">1582</span></a><span class="sd">        with a truth value determined by this method.</span>
</span><span id="Die.equals-1583"><a href="#Die.equals-1583"><span class="linenos">1583</span></a><span class="sd">        Only dice returned by these methods have a truth value. The data of</span>
</span><span id="Die.equals-1584"><a href="#Die.equals-1584"><span class="linenos">1584</span></a><span class="sd">        these dice is lazily evaluated since the caller may only be interested</span>
</span><span id="Die.equals-1585"><a href="#Die.equals-1585"><span class="linenos">1585</span></a><span class="sd">        in the `Die` value or the truth value.</span>
</span><span id="Die.equals-1586"><a href="#Die.equals-1586"><span class="linenos">1586</span></a>
</span><span id="Die.equals-1587"><a href="#Die.equals-1587"><span class="linenos">1587</span></a><span class="sd">        Args:</span>
</span><span id="Die.equals-1588"><a href="#Die.equals-1588"><span class="linenos">1588</span></a><span class="sd">            simplify: If `True`, the dice will be simplified before comparing.</span>
</span><span id="Die.equals-1589"><a href="#Die.equals-1589"><span class="linenos">1589</span></a><span class="sd">                Otherwise, e.g. a 2:2 coin is not `equals()` to a 1:1 coin.</span>
</span><span id="Die.equals-1590"><a href="#Die.equals-1590"><span class="linenos">1590</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.equals-1591"><a href="#Die.equals-1591"><span class="linenos">1591</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die.equals-1592"><a href="#Die.equals-1592"><span class="linenos">1592</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Die.equals-1593"><a href="#Die.equals-1593"><span class="linenos">1593</span></a>
</span><span id="Die.equals-1594"><a href="#Die.equals-1594"><span class="linenos">1594</span></a>        <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
</span><span id="Die.equals-1595"><a href="#Die.equals-1595"><span class="linenos">1595</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">_hash_key</span>
</span><span id="Die.equals-1596"><a href="#Die.equals-1596"><span class="linenos">1596</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.equals-1597"><a href="#Die.equals-1597"><span class="linenos">1597</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash_key</span>
</span></pre></div>


            <div class="docstring"><p><code>True</code> iff both dice have the same outcomes and quantities.</p>

<p>This is <code>False</code> if <code>other</code> is not a <code><a href="#Die">Die</a></code>, even if it would convert
to an equal <code><a href="#Die">Die</a></code>.</p>

<p>Truth value does NOT matter.</p>

<p>If one <code><a href="#Die">Die</a></code> has a zero-quantity outcome and the other <code><a href="#Die">Die</a></code> does not
contain that outcome, they are treated as unequal by this function.</p>

<p>The <code>==</code> and <code>!=</code> operators have a dual purpose; they return a <code><a href="#Die">Die</a></code>
with a truth value determined by this method.
Only dice returned by these methods have a truth value. The data of
these dice is lazily evaluated since the caller may only be interested
in the <code><a href="#Die">Die</a></code> value or the truth value.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>simplify:</strong>  If <code>True</code>, the dice will be simplified before comparing.
Otherwise, e.g. a 2:2 coin is not <code><a href="#Die.equals">equals()</a></code> to a 1:1 coin.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Population">Population</a></dt>
                                <dd id="Die.outcomes" class="function"><a href="#Population.outcomes">outcomes</a></dd>
                <dd id="Die.common_outcome_length" class="function"><a href="#Population.common_outcome_length">common_outcome_length</a></dd>
                <dd id="Die.is_empty" class="function"><a href="#Population.is_empty">is_empty</a></dd>
                <dd id="Die.min_outcome" class="function"><a href="#Population.min_outcome">min_outcome</a></dd>
                <dd id="Die.max_outcome" class="function"><a href="#Population.max_outcome">max_outcome</a></dd>
                <dd id="Die.nearest" class="function"><a href="#Population.nearest">nearest</a></dd>
                <dd id="Die.quantity" class="function"><a href="#Population.quantity">quantity</a></dd>
                <dd id="Die.quantities" class="function"><a href="#Population.quantities">quantities</a></dd>
                <dd id="Die.denominator" class="function"><a href="#Population.denominator">denominator</a></dd>
                <dd id="Die.scale_quantities" class="function"><a href="#Population.scale_quantities">scale_quantities</a></dd>
                <dd id="Die.has_zero_quantities" class="function"><a href="#Population.has_zero_quantities">has_zero_quantities</a></dd>
                <dd id="Die.probability" class="function"><a href="#Population.probability">probability</a></dd>
                <dd id="Die.probabilities" class="function"><a href="#Population.probabilities">probabilities</a></dd>
                <dd id="Die.mode" class="function"><a href="#Population.mode">mode</a></dd>
                <dd id="Die.modal_quantity" class="function"><a href="#Population.modal_quantity">modal_quantity</a></dd>
                <dd id="Die.kolmogorov_smirnov" class="function"><a href="#Population.kolmogorov_smirnov">kolmogorov_smirnov</a></dd>
                <dd id="Die.cramer_von_mises" class="function"><a href="#Population.cramer_von_mises">cramer_von_mises</a></dd>
                <dd id="Die.median" class="function"><a href="#Population.median">median</a></dd>
                <dd id="Die.median_low" class="function"><a href="#Population.median_low">median_low</a></dd>
                <dd id="Die.median_high" class="function"><a href="#Population.median_high">median_high</a></dd>
                <dd id="Die.quantile" class="function"><a href="#Population.quantile">quantile</a></dd>
                <dd id="Die.quantile_low" class="function"><a href="#Population.quantile_low">quantile_low</a></dd>
                <dd id="Die.quantile_high" class="function"><a href="#Population.quantile_high">quantile_high</a></dd>
                <dd id="Die.mean" class="function"><a href="#Population.mean">mean</a></dd>
                <dd id="Die.variance" class="function"><a href="#Population.variance">variance</a></dd>
                <dd id="Die.standard_deviation" class="function"><a href="#Population.standard_deviation">standard_deviation</a></dd>
                <dd id="Die.sd" class="function"><a href="#Population.sd">sd</a></dd>
                <dd id="Die.standardized_moment" class="function"><a href="#Population.standardized_moment">standardized_moment</a></dd>
                <dd id="Die.skewness" class="function"><a href="#Population.skewness">skewness</a></dd>
                <dd id="Die.excess_kurtosis" class="function"><a href="#Population.excess_kurtosis">excess_kurtosis</a></dd>
                <dd id="Die.entropy" class="function"><a href="#Population.entropy">entropy</a></dd>
                <dd id="Die.marginals" class="variable"><a href="#Population.marginals">marginals</a></dd>
                <dd id="Die.covariance" class="function"><a href="#Population.covariance">covariance</a></dd>
                <dd id="Die.correlation" class="function"><a href="#Population.correlation">correlation</a></dd>
                <dd id="Die.to_one_hot" class="function"><a href="#Population.to_one_hot">to_one_hot</a></dd>
                <dd id="Die.sample" class="function"><a href="#Population.sample">sample</a></dd>
                <dd id="Die.format" class="function"><a href="#Population.format">format</a></dd>

            </div>
            <div><dt>collections.abc.Mapping</dt>
                                <dd id="Die.get" class="function">get</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Population">
                            <input id="Population-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Population</span><wbr>(<span class="base">abc.ABC</span>, <span class="base">typing.Generic[+T_co]</span>, <span class="base">typing.Mapping[typing.Any, int]</span>):

                <label class="view-source-button" for="Population-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population-28"><a href="#Population-28"><span class="linenos"> 28</span></a><span class="k">class</span> <span class="nc">Population</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
</span><span id="Population-29"><a href="#Population-29"><span class="linenos"> 29</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A mapping from outcomes to `int` quantities.</span>
</span><span id="Population-30"><a href="#Population-30"><span class="linenos"> 30</span></a>
</span><span id="Population-31"><a href="#Population-31"><span class="linenos"> 31</span></a><span class="sd">    Outcomes with each instance must be hashable and totally orderable.</span>
</span><span id="Population-32"><a href="#Population-32"><span class="linenos"> 32</span></a>
</span><span id="Population-33"><a href="#Population-33"><span class="linenos"> 33</span></a><span class="sd">    Subclasses include `Die` and `Deck`.</span>
</span><span id="Population-34"><a href="#Population-34"><span class="linenos"> 34</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Population-35"><a href="#Population-35"><span class="linenos"> 35</span></a>
</span><span id="Population-36"><a href="#Population-36"><span class="linenos"> 36</span></a>    <span class="c1"># Abstract methods.</span>
</span><span id="Population-37"><a href="#Population-37"><span class="linenos"> 37</span></a>
</span><span id="Population-38"><a href="#Population-38"><span class="linenos"> 38</span></a>    <span class="nd">@property</span>
</span><span id="Population-39"><a href="#Population-39"><span class="linenos"> 39</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-40"><a href="#Population-40"><span class="linenos"> 40</span></a>    <span class="k">def</span> <span class="nf">_new_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="Population-41"><a href="#Population-41"><span class="linenos"> 41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The type to use when constructing a new instance.&quot;&quot;&quot;</span>
</span><span id="Population-42"><a href="#Population-42"><span class="linenos"> 42</span></a>
</span><span id="Population-43"><a href="#Population-43"><span class="linenos"> 43</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-44"><a href="#Population-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Population-45"><a href="#Population-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes within the population in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-46"><a href="#Population-46"><span class="linenos"> 46</span></a>
</span><span id="Population-47"><a href="#Population-47"><span class="linenos"> 47</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-48"><a href="#Population-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Population-49"><a href="#Population-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The quantities within the population in outcome order.&quot;&quot;&quot;</span>
</span><span id="Population-50"><a href="#Population-50"><span class="linenos"> 50</span></a>
</span><span id="Population-51"><a href="#Population-51"><span class="linenos"> 51</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-52"><a href="#Population-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Population-53"><a href="#Population-53"><span class="linenos"> 53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The (outcome, quantity)s of the population in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-54"><a href="#Population-54"><span class="linenos"> 54</span></a>
</span><span id="Population-55"><a href="#Population-55"><span class="linenos"> 55</span></a>    <span class="nd">@property</span>
</span><span id="Population-56"><a href="#Population-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="nf">_items_for_cartesian_product</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="Population-57"><a href="#Population-57"><span class="linenos"> 57</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Population-58"><a href="#Population-58"><span class="linenos"> 58</span></a>
</span><span id="Population-59"><a href="#Population-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="nf">_unary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Population-60"><a href="#Population-60"><span class="linenos"> 60</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Population-61"><a href="#Population-61"><span class="linenos"> 61</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Population-62"><a href="#Population-62"><span class="linenos"> 62</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Population-63"><a href="#Population-63"><span class="linenos"> 63</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Population-64"><a href="#Population-64"><span class="linenos"> 64</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Population-65"><a href="#Population-65"><span class="linenos"> 65</span></a>
</span><span id="Population-66"><a href="#Population-66"><span class="linenos"> 66</span></a>    <span class="c1"># Outcomes.</span>
</span><span id="Population-67"><a href="#Population-67"><span class="linenos"> 67</span></a>
</span><span id="Population-68"><a href="#Population-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Population-69"><a href="#Population-69"><span class="linenos"> 69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes of the mapping in ascending order.</span>
</span><span id="Population-70"><a href="#Population-70"><span class="linenos"> 70</span></a>
</span><span id="Population-71"><a href="#Population-71"><span class="linenos"> 71</span></a><span class="sd">        These are also the `keys` of the mapping.</span>
</span><span id="Population-72"><a href="#Population-72"><span class="linenos"> 72</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Population-73"><a href="#Population-73"><span class="linenos"> 73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-74"><a href="#Population-74"><span class="linenos"> 74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Population-75"><a href="#Population-75"><span class="linenos"> 75</span></a>
</span><span id="Population-76"><a href="#Population-76"><span class="linenos"> 76</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-77"><a href="#Population-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">_common_outcome_length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-78"><a href="#Population-78"><span class="linenos"> 78</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Population-79"><a href="#Population-79"><span class="linenos"> 79</span></a>        <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="Population-80"><a href="#Population-80"><span class="linenos"> 80</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="Population-81"><a href="#Population-81"><span class="linenos"> 81</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-82"><a href="#Population-82"><span class="linenos"> 82</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">Sized</span><span class="p">):</span>
</span><span id="Population-83"><a href="#Population-83"><span class="linenos"> 83</span></a>                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-84"><a href="#Population-84"><span class="linenos"> 84</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-85"><a href="#Population-85"><span class="linenos"> 85</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="o">!=</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Population-86"><a href="#Population-86"><span class="linenos"> 86</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-87"><a href="#Population-87"><span class="linenos"> 87</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Population-88"><a href="#Population-88"><span class="linenos"> 88</span></a>
</span><span id="Population-89"><a href="#Population-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">common_outcome_length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-90"><a href="#Population-90"><span class="linenos"> 90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The common length of all outcomes.</span>
</span><span id="Population-91"><a href="#Population-91"><span class="linenos"> 91</span></a>
</span><span id="Population-92"><a href="#Population-92"><span class="linenos"> 92</span></a><span class="sd">        If outcomes have no lengths or different lengths, the result is `None`.</span>
</span><span id="Population-93"><a href="#Population-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-94"><a href="#Population-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_outcome_length</span>
</span><span id="Population-95"><a href="#Population-95"><span class="linenos"> 95</span></a>
</span><span id="Population-96"><a href="#Population-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population-97"><a href="#Population-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`True` iff this population has no outcomes. &quot;&quot;&quot;</span>
</span><span id="Population-98"><a href="#Population-98"><span class="linenos"> 98</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Population-99"><a href="#Population-99"><span class="linenos"> 99</span></a>
</span><span id="Population-100"><a href="#Population-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population-101"><a href="#Population-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The least outcome.&quot;&quot;&quot;</span>
</span><span id="Population-102"><a href="#Population-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Population-103"><a href="#Population-103"><span class="linenos">103</span></a>
</span><span id="Population-104"><a href="#Population-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population-105"><a href="#Population-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The greatest outcome.&quot;&quot;&quot;</span>
</span><span id="Population-106"><a href="#Population-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Population-107"><a href="#Population-107"><span class="linenos">107</span></a>
</span><span id="Population-108"><a href="#Population-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="nf">nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">outcome</span><span class="p">,</span>
</span><span id="Population-109"><a href="#Population-109"><span class="linenos">109</span></a>                <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-110"><a href="#Population-110"><span class="linenos">110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The nearest outcome in this population fitting the comparison.</span>
</span><span id="Population-111"><a href="#Population-111"><span class="linenos">111</span></a>
</span><span id="Population-112"><a href="#Population-112"><span class="linenos">112</span></a><span class="sd">        Args:</span>
</span><span id="Population-113"><a href="#Population-113"><span class="linenos">113</span></a><span class="sd">            comparison: The comparison which the result must fit. For example,</span>
</span><span id="Population-114"><a href="#Population-114"><span class="linenos">114</span></a><span class="sd">                &#39;&lt;=&#39; would find the greatest outcome that is not greater than</span>
</span><span id="Population-115"><a href="#Population-115"><span class="linenos">115</span></a><span class="sd">                the argument.</span>
</span><span id="Population-116"><a href="#Population-116"><span class="linenos">116</span></a><span class="sd">            outcome: The outcome to compare against.</span>
</span><span id="Population-117"><a href="#Population-117"><span class="linenos">117</span></a><span class="sd">        </span>
</span><span id="Population-118"><a href="#Population-118"><span class="linenos">118</span></a><span class="sd">        Returns:</span>
</span><span id="Population-119"><a href="#Population-119"><span class="linenos">119</span></a><span class="sd">            The nearest outcome fitting the comparison, or `None` if there is</span>
</span><span id="Population-120"><a href="#Population-120"><span class="linenos">120</span></a><span class="sd">            no such outcome.</span>
</span><span id="Population-121"><a href="#Population-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-122"><a href="#Population-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
</span><span id="Population-123"><a href="#Population-123"><span class="linenos">123</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="Population-124"><a href="#Population-124"><span class="linenos">124</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Population-125"><a href="#Population-125"><span class="linenos">125</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population-126"><a href="#Population-126"><span class="linenos">126</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population-127"><a href="#Population-127"><span class="linenos">127</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-128"><a href="#Population-128"><span class="linenos">128</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-129"><a href="#Population-129"><span class="linenos">129</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
</span><span id="Population-130"><a href="#Population-130"><span class="linenos">130</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population-131"><a href="#Population-131"><span class="linenos">131</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population-132"><a href="#Population-132"><span class="linenos">132</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-133"><a href="#Population-133"><span class="linenos">133</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-134"><a href="#Population-134"><span class="linenos">134</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
</span><span id="Population-135"><a href="#Population-135"><span class="linenos">135</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="Population-136"><a href="#Population-136"><span class="linenos">136</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Population-137"><a href="#Population-137"><span class="linenos">137</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-138"><a href="#Population-138"><span class="linenos">138</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-139"><a href="#Population-139"><span class="linenos">139</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-140"><a href="#Population-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-141"><a href="#Population-141"><span class="linenos">141</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
</span><span id="Population-142"><a href="#Population-142"><span class="linenos">142</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-143"><a href="#Population-143"><span class="linenos">143</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-144"><a href="#Population-144"><span class="linenos">144</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-145"><a href="#Population-145"><span class="linenos">145</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-146"><a href="#Population-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-147"><a href="#Population-147"><span class="linenos">147</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid comparison </span><span class="si">{</span><span class="n">comparison</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Population-148"><a href="#Population-148"><span class="linenos">148</span></a>
</span><span id="Population-149"><a href="#Population-149"><span class="linenos">149</span></a>    <span class="c1"># Quantities.</span>
</span><span id="Population-150"><a href="#Population-150"><span class="linenos">150</span></a>
</span><span id="Population-151"><a href="#Population-151"><span class="linenos">151</span></a>    <span class="nd">@overload</span>
</span><span id="Population-152"><a href="#Population-152"><span class="linenos">152</span></a>    <span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-153"><a href="#Population-153"><span class="linenos">153</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The quantity of a single outcome.&quot;&quot;&quot;</span>
</span><span id="Population-154"><a href="#Population-154"><span class="linenos">154</span></a>
</span><span id="Population-155"><a href="#Population-155"><span class="linenos">155</span></a>    <span class="nd">@overload</span>
</span><span id="Population-156"><a href="#Population-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span>
</span><span id="Population-157"><a href="#Population-157"><span class="linenos">157</span></a>                 <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-158"><a href="#Population-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total quantity fitting a comparison to a single outcome.&quot;&quot;&quot;</span>
</span><span id="Population-159"><a href="#Population-159"><span class="linenos">159</span></a>
</span><span id="Population-160"><a href="#Population-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Population-161"><a href="#Population-161"><span class="linenos">161</span></a>                 <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population-162"><a href="#Population-162"><span class="linenos">162</span></a>                 <span class="o">|</span> <span class="n">Hashable</span><span class="p">,</span>
</span><span id="Population-163"><a href="#Population-163"><span class="linenos">163</span></a>                 <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population-164"><a href="#Population-164"><span class="linenos">164</span></a>                 <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-165"><a href="#Population-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The quantity of a single outcome.</span>
</span><span id="Population-166"><a href="#Population-166"><span class="linenos">166</span></a>
</span><span id="Population-167"><a href="#Population-167"><span class="linenos">167</span></a><span class="sd">        A comparison can be provided, in which case this returns the total</span>
</span><span id="Population-168"><a href="#Population-168"><span class="linenos">168</span></a><span class="sd">        quantity fitting the comparison.</span>
</span><span id="Population-169"><a href="#Population-169"><span class="linenos">169</span></a><span class="sd">        </span>
</span><span id="Population-170"><a href="#Population-170"><span class="linenos">170</span></a><span class="sd">        Args:</span>
</span><span id="Population-171"><a href="#Population-171"><span class="linenos">171</span></a><span class="sd">            comparison: The comparison to use. This can be omitted, in which</span>
</span><span id="Population-172"><a href="#Population-172"><span class="linenos">172</span></a><span class="sd">                case it is treated as &#39;==&#39;.</span>
</span><span id="Population-173"><a href="#Population-173"><span class="linenos">173</span></a><span class="sd">            outcome: The outcome to query.</span>
</span><span id="Population-174"><a href="#Population-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-175"><a href="#Population-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-176"><a href="#Population-176"><span class="linenos">176</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="n">comparison</span>
</span><span id="Population-177"><a href="#Population-177"><span class="linenos">177</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population-178"><a href="#Population-178"><span class="linenos">178</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-179"><a href="#Population-179"><span class="linenos">179</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span>
</span><span id="Population-180"><a href="#Population-180"><span class="linenos">180</span></a>                              <span class="n">comparison</span><span class="p">)</span>
</span><span id="Population-181"><a href="#Population-181"><span class="linenos">181</span></a>
</span><span id="Population-182"><a href="#Population-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
</span><span id="Population-183"><a href="#Population-183"><span class="linenos">183</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Population-184"><a href="#Population-184"><span class="linenos">184</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;!=&#39;</span><span class="p">:</span>
</span><span id="Population-185"><a href="#Population-185"><span class="linenos">185</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Population-186"><a href="#Population-186"><span class="linenos">186</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">]:</span>
</span><span id="Population-187"><a href="#Population-187"><span class="linenos">187</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearest</span><span class="p">(</span><span class="n">comparison</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-188"><a href="#Population-188"><span class="linenos">188</span></a>            <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-189"><a href="#Population-189"><span class="linenos">189</span></a>                <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population-190"><a href="#Population-190"><span class="linenos">190</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Population-191"><a href="#Population-191"><span class="linenos">191</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_quantities</span><span class="p">[</span><span class="n">threshold</span><span class="p">]</span>
</span><span id="Population-192"><a href="#Population-192"><span class="linenos">192</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
</span><span id="Population-193"><a href="#Population-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-194"><a href="#Population-194"><span class="linenos">194</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
</span><span id="Population-195"><a href="#Population-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-196"><a href="#Population-196"><span class="linenos">196</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-197"><a href="#Population-197"><span class="linenos">197</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid comparison </span><span class="si">{</span><span class="n">comparison</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Population-198"><a href="#Population-198"><span class="linenos">198</span></a>
</span><span id="Population-199"><a href="#Population-199"><span class="linenos">199</span></a>    <span class="nd">@overload</span>
</span><span id="Population-200"><a href="#Population-200"><span class="linenos">200</span></a>    <span class="k">def</span> <span class="nf">quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Population-201"><a href="#Population-201"><span class="linenos">201</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All quantities in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-202"><a href="#Population-202"><span class="linenos">202</span></a>
</span><span id="Population-203"><a href="#Population-203"><span class="linenos">203</span></a>    <span class="nd">@overload</span>
</span><span id="Population-204"><a href="#Population-204"><span class="linenos">204</span></a>    <span class="k">def</span> <span class="nf">quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span>
</span><span id="Population-205"><a href="#Population-205"><span class="linenos">205</span></a>                   <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population-206"><a href="#Population-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total quantities fitting the comparison for each outcome in sorted order.</span>
</span><span id="Population-207"><a href="#Population-207"><span class="linenos">207</span></a><span class="sd">        </span>
</span><span id="Population-208"><a href="#Population-208"><span class="linenos">208</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population-209"><a href="#Population-209"><span class="linenos">209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-210"><a href="#Population-210"><span class="linenos">210</span></a>
</span><span id="Population-211"><a href="#Population-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="nf">quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Population-212"><a href="#Population-212"><span class="linenos">212</span></a>                   <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population-213"><a href="#Population-213"><span class="linenos">213</span></a>                   <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population-214"><a href="#Population-214"><span class="linenos">214</span></a>                   <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population-215"><a href="#Population-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The quantities of the mapping in sorted order.</span>
</span><span id="Population-216"><a href="#Population-216"><span class="linenos">216</span></a>
</span><span id="Population-217"><a href="#Population-217"><span class="linenos">217</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population-218"><a href="#Population-218"><span class="linenos">218</span></a>
</span><span id="Population-219"><a href="#Population-219"><span class="linenos">219</span></a><span class="sd">        Args:</span>
</span><span id="Population-220"><a href="#Population-220"><span class="linenos">220</span></a><span class="sd">            comparison: Optional. If omitted, this defaults to &#39;==&#39;.</span>
</span><span id="Population-221"><a href="#Population-221"><span class="linenos">221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-222"><a href="#Population-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-223"><a href="#Population-223"><span class="linenos">223</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population-224"><a href="#Population-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
</span><span id="Population-225"><a href="#Population-225"><span class="linenos">225</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Population-226"><a href="#Population-226"><span class="linenos">226</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
</span><span id="Population-227"><a href="#Population-227"><span class="linenos">227</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="Population-228"><a href="#Population-228"><span class="linenos">228</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
</span><span id="Population-229"><a href="#Population-229"><span class="linenos">229</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Population-230"><a href="#Population-230"><span class="linenos">230</span></a>                <span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Population-231"><a href="#Population-231"><span class="linenos">231</span></a>                                     <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
</span><span id="Population-232"><a href="#Population-232"><span class="linenos">232</span></a>                                     <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()))</span>
</span><span id="Population-233"><a href="#Population-233"><span class="linenos">233</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;!=&#39;</span><span class="p">:</span>
</span><span id="Population-234"><a href="#Population-234"><span class="linenos">234</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Population-235"><a href="#Population-235"><span class="linenos">235</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
</span><span id="Population-236"><a href="#Population-236"><span class="linenos">236</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&gt;=&#39;</span><span class="p">))</span>
</span><span id="Population-237"><a href="#Population-237"><span class="linenos">237</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
</span><span id="Population-238"><a href="#Population-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">))</span>
</span><span id="Population-239"><a href="#Population-239"><span class="linenos">239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-240"><a href="#Population-240"><span class="linenos">240</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid comparison </span><span class="si">{</span><span class="n">comparison</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Population-241"><a href="#Population-241"><span class="linenos">241</span></a>
</span><span id="Population-242"><a href="#Population-242"><span class="linenos">242</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-243"><a href="#Population-243"><span class="linenos">243</span></a>    <span class="k">def</span> <span class="nf">_cumulative_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Population-244"><a href="#Population-244"><span class="linenos">244</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Population-245"><a href="#Population-245"><span class="linenos">245</span></a>        <span class="n">cdf</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Population-246"><a href="#Population-246"><span class="linenos">246</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Population-247"><a href="#Population-247"><span class="linenos">247</span></a>            <span class="n">cdf</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Population-248"><a href="#Population-248"><span class="linenos">248</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdf</span>
</span><span id="Population-249"><a href="#Population-249"><span class="linenos">249</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Population-250"><a href="#Population-250"><span class="linenos">250</span></a>
</span><span id="Population-251"><a href="#Population-251"><span class="linenos">251</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-252"><a href="#Population-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-253"><a href="#Population-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Population-254"><a href="#Population-254"><span class="linenos">254</span></a>
</span><span id="Population-255"><a href="#Population-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-256"><a href="#Population-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The sum of all quantities (e.g. weights or duplicates).</span>
</span><span id="Population-257"><a href="#Population-257"><span class="linenos">257</span></a>
</span><span id="Population-258"><a href="#Population-258"><span class="linenos">258</span></a><span class="sd">        For the number of unique outcomes, including those with zero quantity,</span>
</span><span id="Population-259"><a href="#Population-259"><span class="linenos">259</span></a><span class="sd">        use `len()`.</span>
</span><span id="Population-260"><a href="#Population-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-261"><a href="#Population-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span><span id="Population-262"><a href="#Population-262"><span class="linenos">262</span></a>
</span><span id="Population-263"><a href="#Population-263"><span class="linenos">263</span></a>    <span class="k">def</span> <span class="nf">scale_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">:</span>
</span><span id="Population-264"><a href="#Population-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scales all quantities by an integer.&quot;&quot;&quot;</span>
</span><span id="Population-265"><a href="#Population-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Population-266"><a href="#Population-266"><span class="linenos">266</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Population-267"><a href="#Population-267"><span class="linenos">267</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Population-268"><a href="#Population-268"><span class="linenos">268</span></a>            <span class="n">outcome</span><span class="p">:</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="Population-269"><a href="#Population-269"><span class="linenos">269</span></a>            <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Population-270"><a href="#Population-270"><span class="linenos">270</span></a>        <span class="p">}</span>
</span><span id="Population-271"><a href="#Population-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Population-272"><a href="#Population-272"><span class="linenos">272</span></a>
</span><span id="Population-273"><a href="#Population-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="nf">has_zero_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population-274"><a href="#Population-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`True` iff `self` contains at least one outcome with zero quantity. &quot;&quot;&quot;</span>
</span><span id="Population-275"><a href="#Population-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="mi">0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Population-276"><a href="#Population-276"><span class="linenos">276</span></a>
</span><span id="Population-277"><a href="#Population-277"><span class="linenos">277</span></a>    <span class="c1"># Probabilities.</span>
</span><span id="Population-278"><a href="#Population-278"><span class="linenos">278</span></a>
</span><span id="Population-279"><a href="#Population-279"><span class="linenos">279</span></a>    <span class="nd">@overload</span>
</span><span id="Population-280"><a href="#Population-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Population-281"><a href="#Population-281"><span class="linenos">281</span></a>                    <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-282"><a href="#Population-282"><span class="linenos">282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The probability of a single outcome, or 0.0 if not present.&quot;&quot;&quot;</span>
</span><span id="Population-283"><a href="#Population-283"><span class="linenos">283</span></a>
</span><span id="Population-284"><a href="#Population-284"><span class="linenos">284</span></a>    <span class="nd">@overload</span>
</span><span id="Population-285"><a href="#Population-285"><span class="linenos">285</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Population-286"><a href="#Population-286"><span class="linenos">286</span></a>                    <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-287"><a href="#Population-287"><span class="linenos">287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The probability of a single outcome, or 0.0 if not present.&quot;&quot;&quot;</span>
</span><span id="Population-288"><a href="#Population-288"><span class="linenos">288</span></a>
</span><span id="Population-289"><a href="#Population-289"><span class="linenos">289</span></a>    <span class="nd">@overload</span>
</span><span id="Population-290"><a href="#Population-290"><span class="linenos">290</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-291"><a href="#Population-291"><span class="linenos">291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The probability of a single outcome, or 0.0 if not present.&quot;&quot;&quot;</span>
</span><span id="Population-292"><a href="#Population-292"><span class="linenos">292</span></a>
</span><span id="Population-293"><a href="#Population-293"><span class="linenos">293</span></a>    <span class="nd">@overload</span>
</span><span id="Population-294"><a href="#Population-294"><span class="linenos">294</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="Population-295"><a href="#Population-295"><span class="linenos">295</span></a>                                              <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Population-296"><a href="#Population-296"><span class="linenos">296</span></a>                    <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-297"><a href="#Population-297"><span class="linenos">297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probability of outcomes fitting a comparison.&quot;&quot;&quot;</span>
</span><span id="Population-298"><a href="#Population-298"><span class="linenos">298</span></a>
</span><span id="Population-299"><a href="#Population-299"><span class="linenos">299</span></a>    <span class="nd">@overload</span>
</span><span id="Population-300"><a href="#Population-300"><span class="linenos">300</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="Population-301"><a href="#Population-301"><span class="linenos">301</span></a>                                              <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Population-302"><a href="#Population-302"><span class="linenos">302</span></a>                    <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-303"><a href="#Population-303"><span class="linenos">303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probability of outcomes fitting a comparison.&quot;&quot;&quot;</span>
</span><span id="Population-304"><a href="#Population-304"><span class="linenos">304</span></a>
</span><span id="Population-305"><a href="#Population-305"><span class="linenos">305</span></a>    <span class="nd">@overload</span>
</span><span id="Population-306"><a href="#Population-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="Population-307"><a href="#Population-307"><span class="linenos">307</span></a>                                              <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span>
</span><span id="Population-308"><a href="#Population-308"><span class="linenos">308</span></a>                    <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-309"><a href="#Population-309"><span class="linenos">309</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probability of outcomes fitting a comparison.&quot;&quot;&quot;</span>
</span><span id="Population-310"><a href="#Population-310"><span class="linenos">310</span></a>
</span><span id="Population-311"><a href="#Population-311"><span class="linenos">311</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Population-312"><a href="#Population-312"><span class="linenos">312</span></a>                    <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population-313"><a href="#Population-313"><span class="linenos">313</span></a>                    <span class="o">|</span> <span class="n">Hashable</span><span class="p">,</span>
</span><span id="Population-314"><a href="#Population-314"><span class="linenos">314</span></a>                    <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population-315"><a href="#Population-315"><span class="linenos">315</span></a>                    <span class="o">/</span><span class="p">,</span>
</span><span id="Population-316"><a href="#Population-316"><span class="linenos">316</span></a>                    <span class="o">*</span><span class="p">,</span>
</span><span id="Population-317"><a href="#Population-317"><span class="linenos">317</span></a>                    <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-318"><a href="#Population-318"><span class="linenos">318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probability of outcomes fitting a comparison.&quot;&quot;&quot;</span>
</span><span id="Population-319"><a href="#Population-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-320"><a href="#Population-320"><span class="linenos">320</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="n">comparison</span>
</span><span id="Population-321"><a href="#Population-321"><span class="linenos">321</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population-322"><a href="#Population-322"><span class="linenos">322</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-323"><a href="#Population-323"><span class="linenos">323</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span>
</span><span id="Population-324"><a href="#Population-324"><span class="linenos">324</span></a>                              <span class="n">comparison</span><span class="p">)</span>
</span><span id="Population-325"><a href="#Population-325"><span class="linenos">325</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">comparison</span><span class="p">,</span> <span class="n">outcome</span><span class="p">),</span>
</span><span id="Population-326"><a href="#Population-326"><span class="linenos">326</span></a>                          <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population-327"><a href="#Population-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="n">result</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="k">if</span> <span class="n">percent</span> <span class="k">else</span> <span class="n">result</span>
</span><span id="Population-328"><a href="#Population-328"><span class="linenos">328</span></a>
</span><span id="Population-329"><a href="#Population-329"><span class="linenos">329</span></a>    <span class="nd">@overload</span>
</span><span id="Population-330"><a href="#Population-330"><span class="linenos">330</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Population-331"><a href="#Population-331"><span class="linenos">331</span></a>                      <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Fraction</span><span class="p">]:</span>
</span><span id="Population-332"><a href="#Population-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All probabilities in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-333"><a href="#Population-333"><span class="linenos">333</span></a>
</span><span id="Population-334"><a href="#Population-334"><span class="linenos">334</span></a>    <span class="nd">@overload</span>
</span><span id="Population-335"><a href="#Population-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-336"><a href="#Population-336"><span class="linenos">336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All probabilities in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-337"><a href="#Population-337"><span class="linenos">337</span></a>
</span><span id="Population-338"><a href="#Population-338"><span class="linenos">338</span></a>    <span class="nd">@overload</span>
</span><span id="Population-339"><a href="#Population-339"><span class="linenos">339</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Fraction</span><span class="p">]:</span>
</span><span id="Population-340"><a href="#Population-340"><span class="linenos">340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All probabilities in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-341"><a href="#Population-341"><span class="linenos">341</span></a>
</span><span id="Population-342"><a href="#Population-342"><span class="linenos">342</span></a>    <span class="nd">@overload</span>
</span><span id="Population-343"><a href="#Population-343"><span class="linenos">343</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="Population-344"><a href="#Population-344"><span class="linenos">344</span></a>                                                <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Population-345"><a href="#Population-345"><span class="linenos">345</span></a>                      <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Fraction</span><span class="p">]:</span>
</span><span id="Population-346"><a href="#Population-346"><span class="linenos">346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probabilities fitting the comparison for each outcome in sorted order.</span>
</span><span id="Population-347"><a href="#Population-347"><span class="linenos">347</span></a><span class="sd">        </span>
</span><span id="Population-348"><a href="#Population-348"><span class="linenos">348</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population-349"><a href="#Population-349"><span class="linenos">349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-350"><a href="#Population-350"><span class="linenos">350</span></a>
</span><span id="Population-351"><a href="#Population-351"><span class="linenos">351</span></a>    <span class="nd">@overload</span>
</span><span id="Population-352"><a href="#Population-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="Population-353"><a href="#Population-353"><span class="linenos">353</span></a>                                                <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Population-354"><a href="#Population-354"><span class="linenos">354</span></a>                      <span class="n">percent</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">True</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-355"><a href="#Population-355"><span class="linenos">355</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probabilities fitting the comparison for each outcome in sorted order.</span>
</span><span id="Population-356"><a href="#Population-356"><span class="linenos">356</span></a><span class="sd">        </span>
</span><span id="Population-357"><a href="#Population-357"><span class="linenos">357</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population-358"><a href="#Population-358"><span class="linenos">358</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-359"><a href="#Population-359"><span class="linenos">359</span></a>
</span><span id="Population-360"><a href="#Population-360"><span class="linenos">360</span></a>    <span class="nd">@overload</span>
</span><span id="Population-361"><a href="#Population-361"><span class="linenos">361</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="Population-362"><a href="#Population-362"><span class="linenos">362</span></a>                                                <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Fraction</span><span class="p">]:</span>
</span><span id="Population-363"><a href="#Population-363"><span class="linenos">363</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probabilities fitting the comparison for each outcome in sorted order.</span>
</span><span id="Population-364"><a href="#Population-364"><span class="linenos">364</span></a><span class="sd">        </span>
</span><span id="Population-365"><a href="#Population-365"><span class="linenos">365</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population-366"><a href="#Population-366"><span class="linenos">366</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-367"><a href="#Population-367"><span class="linenos">367</span></a>
</span><span id="Population-368"><a href="#Population-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span>
</span><span id="Population-369"><a href="#Population-369"><span class="linenos">369</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Population-370"><a href="#Population-370"><span class="linenos">370</span></a>            <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population-371"><a href="#Population-371"><span class="linenos">371</span></a>        <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population-372"><a href="#Population-372"><span class="linenos">372</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Population-373"><a href="#Population-373"><span class="linenos">373</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="Population-374"><a href="#Population-374"><span class="linenos">374</span></a>            <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Fraction</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-375"><a href="#Population-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probabilities fitting the comparison for each outcome in sorted order.</span>
</span><span id="Population-376"><a href="#Population-376"><span class="linenos">376</span></a><span class="sd">        </span>
</span><span id="Population-377"><a href="#Population-377"><span class="linenos">377</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population-378"><a href="#Population-378"><span class="linenos">378</span></a>
</span><span id="Population-379"><a href="#Population-379"><span class="linenos">379</span></a><span class="sd">        Args:</span>
</span><span id="Population-380"><a href="#Population-380"><span class="linenos">380</span></a><span class="sd">            comparison: Optional. If omitted, this defaults to &#39;==&#39;.</span>
</span><span id="Population-381"><a href="#Population-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-382"><a href="#Population-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-383"><a href="#Population-383"><span class="linenos">383</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population-384"><a href="#Population-384"><span class="linenos">384</span></a>
</span><span id="Population-385"><a href="#Population-385"><span class="linenos">385</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Population-386"><a href="#Population-386"><span class="linenos">386</span></a>            <span class="n">Fraction</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population-387"><a href="#Population-387"><span class="linenos">387</span></a>            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="n">comparison</span><span class="p">))</span>
</span><span id="Population-388"><a href="#Population-388"><span class="linenos">388</span></a>
</span><span id="Population-389"><a href="#Population-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population-390"><a href="#Population-390"><span class="linenos">390</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
</span><span id="Population-391"><a href="#Population-391"><span class="linenos">391</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-392"><a href="#Population-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="Population-393"><a href="#Population-393"><span class="linenos">393</span></a>
</span><span id="Population-394"><a href="#Population-394"><span class="linenos">394</span></a>    <span class="c1"># Scalar statistics.</span>
</span><span id="Population-395"><a href="#Population-395"><span class="linenos">395</span></a>
</span><span id="Population-396"><a href="#Population-396"><span class="linenos">396</span></a>    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Population-397"><a href="#Population-397"><span class="linenos">397</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A tuple containing the most common outcome(s) of the population.</span>
</span><span id="Population-398"><a href="#Population-398"><span class="linenos">398</span></a>
</span><span id="Population-399"><a href="#Population-399"><span class="linenos">399</span></a><span class="sd">        These are sorted from lowest to highest.</span>
</span><span id="Population-400"><a href="#Population-400"><span class="linenos">400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-401"><a href="#Population-401"><span class="linenos">401</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Population-402"><a href="#Population-402"><span class="linenos">402</span></a>                     <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">())</span>
</span><span id="Population-403"><a href="#Population-403"><span class="linenos">403</span></a>
</span><span id="Population-404"><a href="#Population-404"><span class="linenos">404</span></a>    <span class="k">def</span> <span class="nf">modal_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-405"><a href="#Population-405"><span class="linenos">405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The highest quantity of any single outcome. &quot;&quot;&quot;</span>
</span><span id="Population-406"><a href="#Population-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span><span id="Population-407"><a href="#Population-407"><span class="linenos">407</span></a>
</span><span id="Population-408"><a href="#Population-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">kolmogorov_smirnov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-409"><a href="#Population-409"><span class="linenos">409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;KolmogorovSmirnov statistic. The maximum absolute difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population-410"><a href="#Population-410"><span class="linenos">410</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population-411"><a href="#Population-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="Population-412"><a href="#Population-412"><span class="linenos">412</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Population-413"><a href="#Population-413"><span class="linenos">413</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">)))</span>
</span><span id="Population-414"><a href="#Population-414"><span class="linenos">414</span></a>
</span><span id="Population-415"><a href="#Population-415"><span class="linenos">415</span></a>    <span class="k">def</span> <span class="nf">cramer_von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-416"><a href="#Population-416"><span class="linenos">416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cramr-von Mises statistic. The sum-of-squares difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population-417"><a href="#Population-417"><span class="linenos">417</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population-418"><a href="#Population-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Population-419"><a href="#Population-419"><span class="linenos">419</span></a>            <span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Population-420"><a href="#Population-420"><span class="linenos">420</span></a>             <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">))),</span>
</span><span id="Population-421"><a href="#Population-421"><span class="linenos">421</span></a>            <span class="n">start</span><span class="o">=</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Population-422"><a href="#Population-422"><span class="linenos">422</span></a>
</span><span id="Population-423"><a href="#Population-423"><span class="linenos">423</span></a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-424"><a href="#Population-424"><span class="linenos">424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The median, taking the mean in case of a tie.</span>
</span><span id="Population-425"><a href="#Population-425"><span class="linenos">425</span></a>
</span><span id="Population-426"><a href="#Population-426"><span class="linenos">426</span></a><span class="sd">        This will fail if the outcomes do not support division;</span>
</span><span id="Population-427"><a href="#Population-427"><span class="linenos">427</span></a><span class="sd">        in this case, use `median_low` or `median_high` instead.</span>
</span><span id="Population-428"><a href="#Population-428"><span class="linenos">428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-429"><a href="#Population-429"><span class="linenos">429</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Population-430"><a href="#Population-430"><span class="linenos">430</span></a>
</span><span id="Population-431"><a href="#Population-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">median_low</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population-432"><a href="#Population-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The median, taking the lower in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-433"><a href="#Population-433"><span class="linenos">433</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_low</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Population-434"><a href="#Population-434"><span class="linenos">434</span></a>
</span><span id="Population-435"><a href="#Population-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">median_high</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population-436"><a href="#Population-436"><span class="linenos">436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The median, taking the higher in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-437"><a href="#Population-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_high</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Population-438"><a href="#Population-438"><span class="linenos">438</span></a>
</span><span id="Population-439"><a href="#Population-439"><span class="linenos">439</span></a>    <span class="k">def</span> <span class="nf">quantile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population-440"><a href="#Population-440"><span class="linenos">440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the mean in case of a tie.</span>
</span><span id="Population-441"><a href="#Population-441"><span class="linenos">441</span></a>
</span><span id="Population-442"><a href="#Population-442"><span class="linenos">442</span></a><span class="sd">        This will fail if the outcomes do not support addition and division;</span>
</span><span id="Population-443"><a href="#Population-443"><span class="linenos">443</span></a><span class="sd">        in this case, use `quantile_low` or `quantile_high` instead.</span>
</span><span id="Population-444"><a href="#Population-444"><span class="linenos">444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-445"><a href="#Population-445"><span class="linenos">445</span></a>        <span class="c1"># Should support addition and division.</span>
</span><span id="Population-446"><a href="#Population-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantile_low</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span>
</span><span id="Population-447"><a href="#Population-447"><span class="linenos">447</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">quantile_high</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># type: ignore</span>
</span><span id="Population-448"><a href="#Population-448"><span class="linenos">448</span></a>
</span><span id="Population-449"><a href="#Population-449"><span class="linenos">449</span></a>    <span class="k">def</span> <span class="nf">quantile_low</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population-450"><a href="#Population-450"><span class="linenos">450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the lesser in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-451"><a href="#Population-451"><span class="linenos">451</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span>
</span><span id="Population-452"><a href="#Population-452"><span class="linenos">452</span></a>                                   <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population-453"><a href="#Population-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-454"><a href="#Population-454"><span class="linenos">454</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population-455"><a href="#Population-455"><span class="linenos">455</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-456"><a href="#Population-456"><span class="linenos">456</span></a>
</span><span id="Population-457"><a href="#Population-457"><span class="linenos">457</span></a>    <span class="k">def</span> <span class="nf">quantile_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population-458"><a href="#Population-458"><span class="linenos">458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the greater in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-459"><a href="#Population-459"><span class="linenos">459</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span>
</span><span id="Population-460"><a href="#Population-460"><span class="linenos">460</span></a>                                    <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population-461"><a href="#Population-461"><span class="linenos">461</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-462"><a href="#Population-462"><span class="linenos">462</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population-463"><a href="#Population-463"><span class="linenos">463</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-464"><a href="#Population-464"><span class="linenos">464</span></a>
</span><span id="Population-465"><a href="#Population-465"><span class="linenos">465</span></a>    <span class="nd">@overload</span>
</span><span id="Population-466"><a href="#Population-466"><span class="linenos">466</span></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-467"><a href="#Population-467"><span class="linenos">467</span></a>        <span class="o">...</span>
</span><span id="Population-468"><a href="#Population-468"><span class="linenos">468</span></a>
</span><span id="Population-469"><a href="#Population-469"><span class="linenos">469</span></a>    <span class="nd">@overload</span>
</span><span id="Population-470"><a href="#Population-470"><span class="linenos">470</span></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-471"><a href="#Population-471"><span class="linenos">471</span></a>        <span class="o">...</span>
</span><span id="Population-472"><a href="#Population-472"><span class="linenos">472</span></a>
</span><span id="Population-473"><a href="#Population-473"><span class="linenos">473</span></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span>
</span><span id="Population-474"><a href="#Population-474"><span class="linenos">474</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span>
</span><span id="Population-475"><a href="#Population-475"><span class="linenos">475</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-476"><a href="#Population-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="n">try_fraction</span><span class="p">(</span>
</span><span id="Population-477"><a href="#Population-477"><span class="linenos">477</span></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">outcome</span> <span class="o">*</span> <span class="n">quantity</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
</span><span id="Population-478"><a href="#Population-478"><span class="linenos">478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population-479"><a href="#Population-479"><span class="linenos">479</span></a>
</span><span id="Population-480"><a href="#Population-480"><span class="linenos">480</span></a>    <span class="nd">@overload</span>
</span><span id="Population-481"><a href="#Population-481"><span class="linenos">481</span></a>    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-482"><a href="#Population-482"><span class="linenos">482</span></a>        <span class="o">...</span>
</span><span id="Population-483"><a href="#Population-483"><span class="linenos">483</span></a>
</span><span id="Population-484"><a href="#Population-484"><span class="linenos">484</span></a>    <span class="nd">@overload</span>
</span><span id="Population-485"><a href="#Population-485"><span class="linenos">485</span></a>    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-486"><a href="#Population-486"><span class="linenos">486</span></a>        <span class="o">...</span>
</span><span id="Population-487"><a href="#Population-487"><span class="linenos">487</span></a>
</span><span id="Population-488"><a href="#Population-488"><span class="linenos">488</span></a>    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span>
</span><span id="Population-489"><a href="#Population-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span>
</span><span id="Population-490"><a href="#Population-490"><span class="linenos">490</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-491"><a href="#Population-491"><span class="linenos">491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This is the population variance, not the sample variance.&quot;&quot;&quot;</span>
</span><span id="Population-492"><a href="#Population-492"><span class="linenos">492</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-493"><a href="#Population-493"><span class="linenos">493</span></a>        <span class="n">mean_of_squares</span> <span class="o">=</span> <span class="n">try_fraction</span><span class="p">(</span>
</span><span id="Population-494"><a href="#Population-494"><span class="linenos">494</span></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">outcome</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
</span><span id="Population-495"><a href="#Population-495"><span class="linenos">495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population-496"><a href="#Population-496"><span class="linenos">496</span></a>        <span class="k">return</span> <span class="n">mean_of_squares</span> <span class="o">-</span> <span class="n">mean</span> <span class="o">*</span> <span class="n">mean</span>
</span><span id="Population-497"><a href="#Population-497"><span class="linenos">497</span></a>
</span><span id="Population-498"><a href="#Population-498"><span class="linenos">498</span></a>    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span>
</span><span id="Population-499"><a href="#Population-499"><span class="linenos">499</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-500"><a href="#Population-500"><span class="linenos">500</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">())</span>
</span><span id="Population-501"><a href="#Population-501"><span class="linenos">501</span></a>
</span><span id="Population-502"><a href="#Population-502"><span class="linenos">502</span></a>    <span class="n">sd</span> <span class="o">=</span> <span class="n">standard_deviation</span>
</span><span id="Population-503"><a href="#Population-503"><span class="linenos">503</span></a>
</span><span id="Population-504"><a href="#Population-504"><span class="linenos">504</span></a>    <span class="k">def</span> <span class="nf">standardized_moment</span><span class="p">(</span>
</span><span id="Population-505"><a href="#Population-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">,</span>
</span><span id="Population-506"><a href="#Population-506"><span class="linenos">506</span></a>            <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-507"><a href="#Population-507"><span class="linenos">507</span></a>        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population-508"><a href="#Population-508"><span class="linenos">508</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-509"><a href="#Population-509"><span class="linenos">509</span></a>        <span class="n">ev</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="n">k</span>  <span class="c1"># type: ignore </span>
</span><span id="Population-510"><a href="#Population-510"><span class="linenos">510</span></a>                 <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span><span class="p">()))</span>
</span><span id="Population-511"><a href="#Population-511"><span class="linenos">511</span></a>        <span class="k">return</span> <span class="n">ev</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
</span><span id="Population-512"><a href="#Population-512"><span class="linenos">512</span></a>
</span><span id="Population-513"><a href="#Population-513"><span class="linenos">513</span></a>    <span class="k">def</span> <span class="nf">skewness</span><span class="p">(</span>
</span><span id="Population-514"><a href="#Population-514"><span class="linenos">514</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-515"><a href="#Population-515"><span class="linenos">515</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Population-516"><a href="#Population-516"><span class="linenos">516</span></a>
</span><span id="Population-517"><a href="#Population-517"><span class="linenos">517</span></a>    <span class="k">def</span> <span class="nf">excess_kurtosis</span><span class="p">(</span>
</span><span id="Population-518"><a href="#Population-518"><span class="linenos">518</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-519"><a href="#Population-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.0</span>
</span><span id="Population-520"><a href="#Population-520"><span class="linenos">520</span></a>
</span><span id="Population-521"><a href="#Population-521"><span class="linenos">521</span></a>    <span class="k">def</span> <span class="nf">entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-522"><a href="#Population-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The entropy of a random sample from this population.</span>
</span><span id="Population-523"><a href="#Population-523"><span class="linenos">523</span></a><span class="sd">        </span>
</span><span id="Population-524"><a href="#Population-524"><span class="linenos">524</span></a><span class="sd">        Args:</span>
</span><span id="Population-525"><a href="#Population-525"><span class="linenos">525</span></a><span class="sd">            base: The logarithm base to use. Default is 2.0, which gives the </span>
</span><span id="Population-526"><a href="#Population-526"><span class="linenos">526</span></a><span class="sd">                entropy in bits.</span>
</span><span id="Population-527"><a href="#Population-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-528"><a href="#Population-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
</span><span id="Population-529"><a href="#Population-529"><span class="linenos">529</span></a>                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="Population-530"><a href="#Population-530"><span class="linenos">530</span></a>
</span><span id="Population-531"><a href="#Population-531"><span class="linenos">531</span></a>    <span class="c1"># Joint statistics.</span>
</span><span id="Population-532"><a href="#Population-532"><span class="linenos">532</span></a>
</span><span id="Population-533"><a href="#Population-533"><span class="linenos">533</span></a>    <span class="k">class</span> <span class="nc">_Marginals</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">C</span><span class="p">]):</span>
</span><span id="Population-534"><a href="#Population-534"><span class="linenos">534</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper class for implementing `marginals()`.&quot;&quot;&quot;</span>
</span><span id="Population-535"><a href="#Population-535"><span class="linenos">535</span></a>
</span><span id="Population-536"><a href="#Population-536"><span class="linenos">536</span></a>        <span class="n">_population</span><span class="p">:</span> <span class="n">C</span>
</span><span id="Population-537"><a href="#Population-537"><span class="linenos">537</span></a>
</span><span id="Population-538"><a href="#Population-538"><span class="linenos">538</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span id="Population-539"><a href="#Population-539"><span class="linenos">539</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_population</span> <span class="o">=</span> <span class="n">population</span>
</span><span id="Population-540"><a href="#Population-540"><span class="linenos">540</span></a>
</span><span id="Population-541"><a href="#Population-541"><span class="linenos">541</span></a>        <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-542"><a href="#Population-542"><span class="linenos">542</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;The minimum len() of all outcomes.&quot;&quot;&quot;</span>
</span><span id="Population-543"><a href="#Population-543"><span class="linenos">543</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="Population-544"><a href="#Population-544"><span class="linenos">544</span></a>
</span><span id="Population-545"><a href="#Population-545"><span class="linenos">545</span></a>        <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span id="Population-546"><a href="#Population-546"><span class="linenos">546</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Marginalizes the given dimensions.&quot;&quot;&quot;</span>
</span><span id="Population-547"><a href="#Population-547"><span class="linenos">547</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population</span><span class="o">.</span><span class="n">_unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">getitem</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
</span><span id="Population-548"><a href="#Population-548"><span class="linenos">548</span></a>
</span><span id="Population-549"><a href="#Population-549"><span class="linenos">549</span></a>        <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
</span><span id="Population-550"><a href="#Population-550"><span class="linenos">550</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
</span><span id="Population-551"><a href="#Population-551"><span class="linenos">551</span></a>                <span class="k">yield</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="Population-552"><a href="#Population-552"><span class="linenos">552</span></a>
</span><span id="Population-553"><a href="#Population-553"><span class="linenos">553</span></a>        <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Population-554"><a href="#Population-554"><span class="linenos">554</span></a>            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
</span><span id="Population-555"><a href="#Population-555"><span class="linenos">555</span></a>                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Population-556"><a href="#Population-556"><span class="linenos">556</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population</span><span class="o">.</span><span class="n">_unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</span><span id="Population-557"><a href="#Population-557"><span class="linenos">557</span></a>
</span><span id="Population-558"><a href="#Population-558"><span class="linenos">558</span></a>    <span class="nd">@property</span>
</span><span id="Population-559"><a href="#Population-559"><span class="linenos">559</span></a>    <span class="k">def</span> <span class="nf">marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Marginals</span><span class="p">[</span><span class="n">C</span><span class="p">]:</span>
</span><span id="Population-560"><a href="#Population-560"><span class="linenos">560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A property that applies the `[]` operator to outcomes.</span>
</span><span id="Population-561"><a href="#Population-561"><span class="linenos">561</span></a>
</span><span id="Population-562"><a href="#Population-562"><span class="linenos">562</span></a><span class="sd">        For example, `population.marginals[:2]` will marginalize the first two</span>
</span><span id="Population-563"><a href="#Population-563"><span class="linenos">563</span></a><span class="sd">        elements of sequence outcomes.</span>
</span><span id="Population-564"><a href="#Population-564"><span class="linenos">564</span></a>
</span><span id="Population-565"><a href="#Population-565"><span class="linenos">565</span></a><span class="sd">        Attributes that do not start with an underscore will also be forwarded.</span>
</span><span id="Population-566"><a href="#Population-566"><span class="linenos">566</span></a><span class="sd">        For example, `population.marginals.x` will marginalize the `x` attribute</span>
</span><span id="Population-567"><a href="#Population-567"><span class="linenos">567</span></a><span class="sd">        from e.g. `namedtuple` outcomes.</span>
</span><span id="Population-568"><a href="#Population-568"><span class="linenos">568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-569"><a href="#Population-569"><span class="linenos">569</span></a>        <span class="k">return</span> <span class="n">Population</span><span class="o">.</span><span class="n">_Marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Population-570"><a href="#Population-570"><span class="linenos">570</span></a>
</span><span id="Population-571"><a href="#Population-571"><span class="linenos">571</span></a>    <span class="nd">@overload</span>
</span><span id="Population-572"><a href="#Population-572"><span class="linenos">572</span></a>    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[tuple[numbers.Rational, ...]]&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Population-573"><a href="#Population-573"><span class="linenos">573</span></a>                   <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population-574"><a href="#Population-574"><span class="linenos">574</span></a>        <span class="o">...</span>
</span><span id="Population-575"><a href="#Population-575"><span class="linenos">575</span></a>
</span><span id="Population-576"><a href="#Population-576"><span class="linenos">576</span></a>    <span class="nd">@overload</span>
</span><span id="Population-577"><a href="#Population-577"><span class="linenos">577</span></a>    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[tuple[float, ...]]&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Population-578"><a href="#Population-578"><span class="linenos">578</span></a>                   <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-579"><a href="#Population-579"><span class="linenos">579</span></a>        <span class="o">...</span>
</span><span id="Population-580"><a href="#Population-580"><span class="linenos">580</span></a>
</span><span id="Population-581"><a href="#Population-581"><span class="linenos">581</span></a>    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span>
</span><span id="Population-582"><a href="#Population-582"><span class="linenos">582</span></a>            <span class="bp">self</span><span class="p">:</span>
</span><span id="Population-583"><a href="#Population-583"><span class="linenos">583</span></a>        <span class="s1">&#39;Population[tuple[numbers.Rational, ...]] | Population[tuple[float, ...]]&#39;</span><span class="p">,</span>
</span><span id="Population-584"><a href="#Population-584"><span class="linenos">584</span></a>            <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-585"><a href="#Population-585"><span class="linenos">585</span></a>        <span class="n">mean_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-586"><a href="#Population-586"><span class="linenos">586</span></a>        <span class="n">mean_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-587"><a href="#Population-587"><span class="linenos">587</span></a>        <span class="k">return</span> <span class="n">try_fraction</span><span class="p">(</span>
</span><span id="Population-588"><a href="#Population-588"><span class="linenos">588</span></a>            <span class="nb">sum</span><span class="p">((</span><span class="n">outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_j</span><span class="p">)</span> <span class="o">*</span> <span class="n">quantity</span>
</span><span id="Population-589"><a href="#Population-589"><span class="linenos">589</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population-590"><a href="#Population-590"><span class="linenos">590</span></a>
</span><span id="Population-591"><a href="#Population-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span>
</span><span id="Population-592"><a href="#Population-592"><span class="linenos">592</span></a>            <span class="bp">self</span><span class="p">:</span>
</span><span id="Population-593"><a href="#Population-593"><span class="linenos">593</span></a>        <span class="s1">&#39;Population[tuple[numbers.Rational, ...]] | Population[tuple[float, ...]]&#39;</span><span class="p">,</span>
</span><span id="Population-594"><a href="#Population-594"><span class="linenos">594</span></a>            <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-595"><a href="#Population-595"><span class="linenos">595</span></a>        <span class="n">sd_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population-596"><a href="#Population-596"><span class="linenos">596</span></a>        <span class="n">sd_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population-597"><a href="#Population-597"><span class="linenos">597</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd_i</span> <span class="o">*</span> <span class="n">sd_j</span><span class="p">)</span>
</span><span id="Population-598"><a href="#Population-598"><span class="linenos">598</span></a>
</span><span id="Population-599"><a href="#Population-599"><span class="linenos">599</span></a>    <span class="c1"># Transformations.</span>
</span><span id="Population-600"><a href="#Population-600"><span class="linenos">600</span></a>
</span><span id="Population-601"><a href="#Population-601"><span class="linenos">601</span></a>    <span class="k">def</span> <span class="nf">to_one_hot</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">:</span>
</span><span id="Population-602"><a href="#Population-602"><span class="linenos">602</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts the outcomes of this population to a one-hot representation.</span>
</span><span id="Population-603"><a href="#Population-603"><span class="linenos">603</span></a>
</span><span id="Population-604"><a href="#Population-604"><span class="linenos">604</span></a><span class="sd">        Args:</span>
</span><span id="Population-605"><a href="#Population-605"><span class="linenos">605</span></a><span class="sd">            outcomes: If provided, each outcome will be mapped to a `Vector`</span>
</span><span id="Population-606"><a href="#Population-606"><span class="linenos">606</span></a><span class="sd">                where the element at `outcomes.index(outcome)` is set to `True`</span>
</span><span id="Population-607"><a href="#Population-607"><span class="linenos">607</span></a><span class="sd">                and the rest to `False`, or all `False` if the outcome is not</span>
</span><span id="Population-608"><a href="#Population-608"><span class="linenos">608</span></a><span class="sd">                in `outcomes`.</span>
</span><span id="Population-609"><a href="#Population-609"><span class="linenos">609</span></a><span class="sd">                If not provided, `self.outcomes()` is used.</span>
</span><span id="Population-610"><a href="#Population-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-611"><a href="#Population-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">outcomes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-612"><a href="#Population-612"><span class="linenos">612</span></a>            <span class="n">outcomes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Population-613"><a href="#Population-613"><span class="linenos">613</span></a>
</span><span id="Population-614"><a href="#Population-614"><span class="linenos">614</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Vector</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Population-615"><a href="#Population-615"><span class="linenos">615</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()):</span>
</span><span id="Population-616"><a href="#Population-616"><span class="linenos">616</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span>
</span><span id="Population-617"><a href="#Population-617"><span class="linenos">617</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="Population-618"><a href="#Population-618"><span class="linenos">618</span></a>                <span class="n">value</span><span class="p">[</span><span class="n">outcomes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">outcome</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Population-619"><a href="#Population-619"><span class="linenos">619</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">Vector</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Population-620"><a href="#Population-620"><span class="linenos">620</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Population-621"><a href="#Population-621"><span class="linenos">621</span></a>
</span><span id="Population-622"><a href="#Population-622"><span class="linenos">622</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population-623"><a href="#Population-623"><span class="linenos">623</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A single random sample from this population.</span>
</span><span id="Population-624"><a href="#Population-624"><span class="linenos">624</span></a>
</span><span id="Population-625"><a href="#Population-625"><span class="linenos">625</span></a><span class="sd">        Note that this is always &quot;with replacement&quot; even for `Deck` since</span>
</span><span id="Population-626"><a href="#Population-626"><span class="linenos">626</span></a><span class="sd">        instances are immutable.</span>
</span><span id="Population-627"><a href="#Population-627"><span class="linenos">627</span></a>
</span><span id="Population-628"><a href="#Population-628"><span class="linenos">628</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="Population-629"><a href="#Population-629"><span class="linenos">629</span></a><span class="sd">        secure.</span>
</span><span id="Population-630"><a href="#Population-630"><span class="linenos">630</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-631"><a href="#Population-631"><span class="linenos">631</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="Population-632"><a href="#Population-632"><span class="linenos">632</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population-633"><a href="#Population-633"><span class="linenos">633</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>
</span><span id="Population-634"><a href="#Population-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-635"><a href="#Population-635"><span class="linenos">635</span></a>
</span><span id="Population-636"><a href="#Population-636"><span class="linenos">636</span></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population-637"><a href="#Population-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Formats this mapping as a string.</span>
</span><span id="Population-638"><a href="#Population-638"><span class="linenos">638</span></a>
</span><span id="Population-639"><a href="#Population-639"><span class="linenos">639</span></a><span class="sd">        `format_spec` should start with the output format,</span>
</span><span id="Population-640"><a href="#Population-640"><span class="linenos">640</span></a><span class="sd">        which can be:</span>
</span><span id="Population-641"><a href="#Population-641"><span class="linenos">641</span></a><span class="sd">        * `md` for Markdown (default)</span>
</span><span id="Population-642"><a href="#Population-642"><span class="linenos">642</span></a><span class="sd">        * `bbcode` for BBCode</span>
</span><span id="Population-643"><a href="#Population-643"><span class="linenos">643</span></a><span class="sd">        * `csv` for comma-separated values</span>
</span><span id="Population-644"><a href="#Population-644"><span class="linenos">644</span></a><span class="sd">        * `html` for HTML</span>
</span><span id="Population-645"><a href="#Population-645"><span class="linenos">645</span></a>
</span><span id="Population-646"><a href="#Population-646"><span class="linenos">646</span></a><span class="sd">        After this, you may optionally add a `:` followed by a series of</span>
</span><span id="Population-647"><a href="#Population-647"><span class="linenos">647</span></a><span class="sd">        requested columns. Allowed columns are:</span>
</span><span id="Population-648"><a href="#Population-648"><span class="linenos">648</span></a>
</span><span id="Population-649"><a href="#Population-649"><span class="linenos">649</span></a><span class="sd">        * `o`: Outcomes.</span>
</span><span id="Population-650"><a href="#Population-650"><span class="linenos">650</span></a><span class="sd">        * `*o`: Outcomes, unpacked if applicable.</span>
</span><span id="Population-651"><a href="#Population-651"><span class="linenos">651</span></a><span class="sd">        * `q==`, `q&lt;=`, `q&gt;=`: Quantities ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population-652"><a href="#Population-652"><span class="linenos">652</span></a><span class="sd">        * `p==`, `p&lt;=`, `p&gt;=`: Probabilities (0-1) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population-653"><a href="#Population-653"><span class="linenos">653</span></a><span class="sd">        * `%==`, `%&lt;=`, `%&gt;=`: Probabilities (0%-100%) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population-654"><a href="#Population-654"><span class="linenos">654</span></a>
</span><span id="Population-655"><a href="#Population-655"><span class="linenos">655</span></a><span class="sd">        Columns may optionally be separated using `|` characters.</span>
</span><span id="Population-656"><a href="#Population-656"><span class="linenos">656</span></a>
</span><span id="Population-657"><a href="#Population-657"><span class="linenos">657</span></a><span class="sd">        The default columns are `*o|q==|%==`, which are the unpacked outcomes,</span>
</span><span id="Population-658"><a href="#Population-658"><span class="linenos">658</span></a><span class="sd">        the quantities, and the probabilities. The quantities are omitted from</span>
</span><span id="Population-659"><a href="#Population-659"><span class="linenos">659</span></a><span class="sd">        the default columns if any individual quantity is 10**30 or greater.</span>
</span><span id="Population-660"><a href="#Population-660"><span class="linenos">660</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-661"><a href="#Population-661"><span class="linenos">661</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">30</span><span class="p">:</span>
</span><span id="Population-662"><a href="#Population-662"><span class="linenos">662</span></a>            <span class="n">default_column_spec</span> <span class="o">=</span> <span class="s1">&#39;*oq==%==&#39;</span>
</span><span id="Population-663"><a href="#Population-663"><span class="linenos">663</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-664"><a href="#Population-664"><span class="linenos">664</span></a>            <span class="n">default_column_spec</span> <span class="o">=</span> <span class="s1">&#39;*o%==&#39;</span>
</span><span id="Population-665"><a href="#Population-665"><span class="linenos">665</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population-666"><a href="#Population-666"><span class="linenos">666</span></a>            <span class="n">format_spec</span> <span class="o">=</span> <span class="s1">&#39;md:&#39;</span> <span class="o">+</span> <span class="n">default_column_spec</span>
</span><span id="Population-667"><a href="#Population-667"><span class="linenos">667</span></a>
</span><span id="Population-668"><a href="#Population-668"><span class="linenos">668</span></a>        <span class="n">format_spec</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Population-669"><a href="#Population-669"><span class="linenos">669</span></a>
</span><span id="Population-670"><a href="#Population-670"><span class="linenos">670</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="Population-671"><a href="#Population-671"><span class="linenos">671</span></a>
</span><span id="Population-672"><a href="#Population-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Population-673"><a href="#Population-673"><span class="linenos">673</span></a>            <span class="n">output_format</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Population-674"><a href="#Population-674"><span class="linenos">674</span></a>            <span class="n">col_spec</span> <span class="o">=</span> <span class="n">default_column_spec</span>
</span><span id="Population-675"><a href="#Population-675"><span class="linenos">675</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Population-676"><a href="#Population-676"><span class="linenos">676</span></a>            <span class="n">output_format</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Population-677"><a href="#Population-677"><span class="linenos">677</span></a>            <span class="n">col_spec</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Population-678"><a href="#Population-678"><span class="linenos">678</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-679"><a href="#Population-679"><span class="linenos">679</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;format_spec has too many colons.&#39;</span><span class="p">)</span>
</span><span id="Population-680"><a href="#Population-680"><span class="linenos">680</span></a>
</span><span id="Population-681"><a href="#Population-681"><span class="linenos">681</span></a>        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Population-682"><a href="#Population-682"><span class="linenos">682</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">)</span>
</span><span id="Population-683"><a href="#Population-683"><span class="linenos">683</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;bbcode&#39;</span><span class="p">:</span>
</span><span id="Population-684"><a href="#Population-684"><span class="linenos">684</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">bbcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">)</span>
</span><span id="Population-685"><a href="#Population-685"><span class="linenos">685</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="Population-686"><a href="#Population-686"><span class="linenos">686</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Population-687"><a href="#Population-687"><span class="linenos">687</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Population-688"><a href="#Population-688"><span class="linenos">688</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">)</span>
</span><span id="Population-689"><a href="#Population-689"><span class="linenos">689</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-690"><a href="#Population-690"><span class="linenos">690</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported output format &#39;</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="Population-691"><a href="#Population-691"><span class="linenos">691</span></a>
</span><span id="Population-692"><a href="#Population-692"><span class="linenos">692</span></a>    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population-693"><a href="#Population-693"><span class="linenos">693</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format_spec</span><span class="p">)</span>
</span><span id="Population-694"><a href="#Population-694"><span class="linenos">694</span></a>
</span><span id="Population-695"><a href="#Population-695"><span class="linenos">695</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population-696"><a href="#Population-696"><span class="linenos">696</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">&#39;</span>
</span></pre></div>


            <div class="docstring"><p>A mapping from outcomes to <code>int</code> quantities.</p>

<p>Outcomes with each instance must be hashable and totally orderable.</p>

<p>Subclasses include <code><a href="#Die">Die</a></code> and <code><a href="#Deck">Deck</a></code>.</p>
</div>


                            <div id="Population.keys" class="classattr">
                                        <input id="Population.keys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">keys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">CountsKeysView</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.keys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.keys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.keys-43"><a href="#Population.keys-43"><span class="linenos">43</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population.keys-44"><a href="#Population.keys-44"><span class="linenos">44</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Population.keys-45"><a href="#Population.keys-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes within the population in sorted order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes within the population in sorted order.</p>
</div>


                            </div>
                            <div id="Population.values" class="classattr">
                                        <input id="Population.values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsValuesView">CountsValuesView</a></span>:</span></span>

                <label class="view-source-button" for="Population.values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.values-47"><a href="#Population.values-47"><span class="linenos">47</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population.values-48"><a href="#Population.values-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Population.values-49"><a href="#Population.values-49"><span class="linenos">49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The quantities within the population in outcome order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The quantities within the population in outcome order.</p>
</div>


                            </div>
                            <div id="Population.items" class="classattr">
                                        <input id="Population.items-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">items</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsItemsView">CountsItemsView</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.items-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.items"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.items-51"><a href="#Population.items-51"><span class="linenos">51</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population.items-52"><a href="#Population.items-52"><span class="linenos">52</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Population.items-53"><a href="#Population.items-53"><span class="linenos">53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The (outcome, quantity)s of the population in sorted order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The (outcome, quantity)s of the population in sorted order.</p>
</div>


                            </div>
                            <div id="Population.outcomes" class="classattr">
                                        <input id="Population.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">CountsKeysView</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.outcomes-68"><a href="#Population.outcomes-68"><span class="linenos">68</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Population.outcomes-69"><a href="#Population.outcomes-69"><span class="linenos">69</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes of the mapping in ascending order.</span>
</span><span id="Population.outcomes-70"><a href="#Population.outcomes-70"><span class="linenos">70</span></a>
</span><span id="Population.outcomes-71"><a href="#Population.outcomes-71"><span class="linenos">71</span></a><span class="sd">        These are also the `keys` of the mapping.</span>
</span><span id="Population.outcomes-72"><a href="#Population.outcomes-72"><span class="linenos">72</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Population.outcomes-73"><a href="#Population.outcomes-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.outcomes-74"><a href="#Population.outcomes-74"><span class="linenos">74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes of the mapping in ascending order.</p>

<p>These are also the <code><a href="#Population.keys">keys</a></code> of the mapping.
Prefer to use the name <code><a href="#Population.outcomes">outcomes</a></code>.</p>
</div>


                            </div>
                            <div id="Population.common_outcome_length" class="classattr">
                                        <input id="Population.common_outcome_length-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">common_outcome_length</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Population.common_outcome_length-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.common_outcome_length"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.common_outcome_length-89"><a href="#Population.common_outcome_length-89"><span class="linenos">89</span></a>    <span class="k">def</span> <span class="nf">common_outcome_length</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.common_outcome_length-90"><a href="#Population.common_outcome_length-90"><span class="linenos">90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The common length of all outcomes.</span>
</span><span id="Population.common_outcome_length-91"><a href="#Population.common_outcome_length-91"><span class="linenos">91</span></a>
</span><span id="Population.common_outcome_length-92"><a href="#Population.common_outcome_length-92"><span class="linenos">92</span></a><span class="sd">        If outcomes have no lengths or different lengths, the result is `None`.</span>
</span><span id="Population.common_outcome_length-93"><a href="#Population.common_outcome_length-93"><span class="linenos">93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.common_outcome_length-94"><a href="#Population.common_outcome_length-94"><span class="linenos">94</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_common_outcome_length</span>
</span></pre></div>


            <div class="docstring"><p>The common length of all outcomes.</p>

<p>If outcomes have no lengths or different lengths, the result is <code>None</code>.</p>
</div>


                            </div>
                            <div id="Population.is_empty" class="classattr">
                                        <input id="Population.is_empty-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_empty</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Population.is_empty-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.is_empty"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.is_empty-96"><a href="#Population.is_empty-96"><span class="linenos">96</span></a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population.is_empty-97"><a href="#Population.is_empty-97"><span class="linenos">97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`True` iff this population has no outcomes. &quot;&quot;&quot;</span>
</span><span id="Population.is_empty-98"><a href="#Population.is_empty-98"><span class="linenos">98</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p><code>True</code> iff this population has no outcomes.</p>
</div>


                            </div>
                            <div id="Population.min_outcome" class="classattr">
                                        <input id="Population.min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Population.min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.min_outcome-100"><a href="#Population.min_outcome-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population.min_outcome-101"><a href="#Population.min_outcome-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The least outcome.&quot;&quot;&quot;</span>
</span><span id="Population.min_outcome-102"><a href="#Population.min_outcome-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The least outcome.</p>
</div>


                            </div>
                            <div id="Population.max_outcome" class="classattr">
                                        <input id="Population.max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Population.max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.max_outcome-104"><a href="#Population.max_outcome-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population.max_outcome-105"><a href="#Population.max_outcome-105"><span class="linenos">105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The greatest outcome.&quot;&quot;&quot;</span>
</span><span id="Population.max_outcome-106"><a href="#Population.max_outcome-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The greatest outcome.</p>
</div>


                            </div>
                            <div id="Population.nearest" class="classattr">
                                        <input id="Population.nearest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nearest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">outcome</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.nearest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.nearest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.nearest-108"><a href="#Population.nearest-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="nf">nearest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">outcome</span><span class="p">,</span>
</span><span id="Population.nearest-109"><a href="#Population.nearest-109"><span class="linenos">109</span></a>                <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.nearest-110"><a href="#Population.nearest-110"><span class="linenos">110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The nearest outcome in this population fitting the comparison.</span>
</span><span id="Population.nearest-111"><a href="#Population.nearest-111"><span class="linenos">111</span></a>
</span><span id="Population.nearest-112"><a href="#Population.nearest-112"><span class="linenos">112</span></a><span class="sd">        Args:</span>
</span><span id="Population.nearest-113"><a href="#Population.nearest-113"><span class="linenos">113</span></a><span class="sd">            comparison: The comparison which the result must fit. For example,</span>
</span><span id="Population.nearest-114"><a href="#Population.nearest-114"><span class="linenos">114</span></a><span class="sd">                &#39;&lt;=&#39; would find the greatest outcome that is not greater than</span>
</span><span id="Population.nearest-115"><a href="#Population.nearest-115"><span class="linenos">115</span></a><span class="sd">                the argument.</span>
</span><span id="Population.nearest-116"><a href="#Population.nearest-116"><span class="linenos">116</span></a><span class="sd">            outcome: The outcome to compare against.</span>
</span><span id="Population.nearest-117"><a href="#Population.nearest-117"><span class="linenos">117</span></a><span class="sd">        </span>
</span><span id="Population.nearest-118"><a href="#Population.nearest-118"><span class="linenos">118</span></a><span class="sd">        Returns:</span>
</span><span id="Population.nearest-119"><a href="#Population.nearest-119"><span class="linenos">119</span></a><span class="sd">            The nearest outcome fitting the comparison, or `None` if there is</span>
</span><span id="Population.nearest-120"><a href="#Population.nearest-120"><span class="linenos">120</span></a><span class="sd">            no such outcome.</span>
</span><span id="Population.nearest-121"><a href="#Population.nearest-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.nearest-122"><a href="#Population.nearest-122"><span class="linenos">122</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
</span><span id="Population.nearest-123"><a href="#Population.nearest-123"><span class="linenos">123</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="Population.nearest-124"><a href="#Population.nearest-124"><span class="linenos">124</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Population.nearest-125"><a href="#Population.nearest-125"><span class="linenos">125</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population.nearest-126"><a href="#Population.nearest-126"><span class="linenos">126</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population.nearest-127"><a href="#Population.nearest-127"><span class="linenos">127</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population.nearest-128"><a href="#Population.nearest-128"><span class="linenos">128</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population.nearest-129"><a href="#Population.nearest-129"><span class="linenos">129</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
</span><span id="Population.nearest-130"><a href="#Population.nearest-130"><span class="linenos">130</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population.nearest-131"><a href="#Population.nearest-131"><span class="linenos">131</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population.nearest-132"><a href="#Population.nearest-132"><span class="linenos">132</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population.nearest-133"><a href="#Population.nearest-133"><span class="linenos">133</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population.nearest-134"><a href="#Population.nearest-134"><span class="linenos">134</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
</span><span id="Population.nearest-135"><a href="#Population.nearest-135"><span class="linenos">135</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
</span><span id="Population.nearest-136"><a href="#Population.nearest-136"><span class="linenos">136</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Population.nearest-137"><a href="#Population.nearest-137"><span class="linenos">137</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.nearest-138"><a href="#Population.nearest-138"><span class="linenos">138</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.nearest-139"><a href="#Population.nearest-139"><span class="linenos">139</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population.nearest-140"><a href="#Population.nearest-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population.nearest-141"><a href="#Population.nearest-141"><span class="linenos">141</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
</span><span id="Population.nearest-142"><a href="#Population.nearest-142"><span class="linenos">142</span></a>            <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.nearest-143"><a href="#Population.nearest-143"><span class="linenos">143</span></a>            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.nearest-144"><a href="#Population.nearest-144"><span class="linenos">144</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population.nearest-145"><a href="#Population.nearest-145"><span class="linenos">145</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population.nearest-146"><a href="#Population.nearest-146"><span class="linenos">146</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.nearest-147"><a href="#Population.nearest-147"><span class="linenos">147</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid comparison </span><span class="si">{</span><span class="n">comparison</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The nearest outcome in this population fitting the comparison.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>comparison:</strong>  The comparison which the result must fit. For example,
'&lt;=' would find the greatest outcome that is not greater than
the argument.</li>
<li><strong>outcome:</strong>  The outcome to compare against.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The nearest outcome fitting the comparison, or <code>None</code> if there is
  no such outcome.</p>
</blockquote>
</div>


                            </div>
                            <div id="Population.quantity" class="classattr">
                                        <input id="Population.quantity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantity</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">comparison</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]</span>,</span><span class="param">	<span class="n">outcome</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.quantity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantity-160"><a href="#Population.quantity-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Population.quantity-161"><a href="#Population.quantity-161"><span class="linenos">161</span></a>                 <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population.quantity-162"><a href="#Population.quantity-162"><span class="linenos">162</span></a>                 <span class="o">|</span> <span class="n">Hashable</span><span class="p">,</span>
</span><span id="Population.quantity-163"><a href="#Population.quantity-163"><span class="linenos">163</span></a>                 <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population.quantity-164"><a href="#Population.quantity-164"><span class="linenos">164</span></a>                 <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.quantity-165"><a href="#Population.quantity-165"><span class="linenos">165</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The quantity of a single outcome.</span>
</span><span id="Population.quantity-166"><a href="#Population.quantity-166"><span class="linenos">166</span></a>
</span><span id="Population.quantity-167"><a href="#Population.quantity-167"><span class="linenos">167</span></a><span class="sd">        A comparison can be provided, in which case this returns the total</span>
</span><span id="Population.quantity-168"><a href="#Population.quantity-168"><span class="linenos">168</span></a><span class="sd">        quantity fitting the comparison.</span>
</span><span id="Population.quantity-169"><a href="#Population.quantity-169"><span class="linenos">169</span></a><span class="sd">        </span>
</span><span id="Population.quantity-170"><a href="#Population.quantity-170"><span class="linenos">170</span></a><span class="sd">        Args:</span>
</span><span id="Population.quantity-171"><a href="#Population.quantity-171"><span class="linenos">171</span></a><span class="sd">            comparison: The comparison to use. This can be omitted, in which</span>
</span><span id="Population.quantity-172"><a href="#Population.quantity-172"><span class="linenos">172</span></a><span class="sd">                case it is treated as &#39;==&#39;.</span>
</span><span id="Population.quantity-173"><a href="#Population.quantity-173"><span class="linenos">173</span></a><span class="sd">            outcome: The outcome to query.</span>
</span><span id="Population.quantity-174"><a href="#Population.quantity-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.quantity-175"><a href="#Population.quantity-175"><span class="linenos">175</span></a>        <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.quantity-176"><a href="#Population.quantity-176"><span class="linenos">176</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="n">comparison</span>
</span><span id="Population.quantity-177"><a href="#Population.quantity-177"><span class="linenos">177</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population.quantity-178"><a href="#Population.quantity-178"><span class="linenos">178</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.quantity-179"><a href="#Population.quantity-179"><span class="linenos">179</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span>
</span><span id="Population.quantity-180"><a href="#Population.quantity-180"><span class="linenos">180</span></a>                              <span class="n">comparison</span><span class="p">)</span>
</span><span id="Population.quantity-181"><a href="#Population.quantity-181"><span class="linenos">181</span></a>
</span><span id="Population.quantity-182"><a href="#Population.quantity-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
</span><span id="Population.quantity-183"><a href="#Population.quantity-183"><span class="linenos">183</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Population.quantity-184"><a href="#Population.quantity-184"><span class="linenos">184</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;!=&#39;</span><span class="p">:</span>
</span><span id="Population.quantity-185"><a href="#Population.quantity-185"><span class="linenos">185</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Population.quantity-186"><a href="#Population.quantity-186"><span class="linenos">186</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">]:</span>
</span><span id="Population.quantity-187"><a href="#Population.quantity-187"><span class="linenos">187</span></a>            <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nearest</span><span class="p">(</span><span class="n">comparison</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.quantity-188"><a href="#Population.quantity-188"><span class="linenos">188</span></a>            <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.quantity-189"><a href="#Population.quantity-189"><span class="linenos">189</span></a>                <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population.quantity-190"><a href="#Population.quantity-190"><span class="linenos">190</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Population.quantity-191"><a href="#Population.quantity-191"><span class="linenos">191</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cumulative_quantities</span><span class="p">[</span><span class="n">threshold</span><span class="p">]</span>
</span><span id="Population.quantity-192"><a href="#Population.quantity-192"><span class="linenos">192</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
</span><span id="Population.quantity-193"><a href="#Population.quantity-193"><span class="linenos">193</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.quantity-194"><a href="#Population.quantity-194"><span class="linenos">194</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
</span><span id="Population.quantity-195"><a href="#Population.quantity-195"><span class="linenos">195</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.quantity-196"><a href="#Population.quantity-196"><span class="linenos">196</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.quantity-197"><a href="#Population.quantity-197"><span class="linenos">197</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid comparison </span><span class="si">{</span><span class="n">comparison</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The quantity of a single outcome.</p>

<p>A comparison can be provided, in which case this returns the total
quantity fitting the comparison.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>comparison:</strong>  The comparison to use. This can be omitted, in which
case it is treated as '=='.</li>
<li><strong>outcome:</strong>  The outcome to query.</li>
</ul>
</div>


                            </div>
                            <div id="Population.quantities" class="classattr">
                                        <input id="Population.quantities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantities</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">comparison</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#CountsValuesView">CountsValuesView</a></span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Population.quantities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantities-211"><a href="#Population.quantities-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="nf">quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Population.quantities-212"><a href="#Population.quantities-212"><span class="linenos">212</span></a>                   <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population.quantities-213"><a href="#Population.quantities-213"><span class="linenos">213</span></a>                   <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population.quantities-214"><a href="#Population.quantities-214"><span class="linenos">214</span></a>                   <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population.quantities-215"><a href="#Population.quantities-215"><span class="linenos">215</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The quantities of the mapping in sorted order.</span>
</span><span id="Population.quantities-216"><a href="#Population.quantities-216"><span class="linenos">216</span></a>
</span><span id="Population.quantities-217"><a href="#Population.quantities-217"><span class="linenos">217</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population.quantities-218"><a href="#Population.quantities-218"><span class="linenos">218</span></a>
</span><span id="Population.quantities-219"><a href="#Population.quantities-219"><span class="linenos">219</span></a><span class="sd">        Args:</span>
</span><span id="Population.quantities-220"><a href="#Population.quantities-220"><span class="linenos">220</span></a><span class="sd">            comparison: Optional. If omitted, this defaults to &#39;==&#39;.</span>
</span><span id="Population.quantities-221"><a href="#Population.quantities-221"><span class="linenos">221</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.quantities-222"><a href="#Population.quantities-222"><span class="linenos">222</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.quantities-223"><a href="#Population.quantities-223"><span class="linenos">223</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population.quantities-224"><a href="#Population.quantities-224"><span class="linenos">224</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;==&#39;</span><span class="p">:</span>
</span><span id="Population.quantities-225"><a href="#Population.quantities-225"><span class="linenos">225</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Population.quantities-226"><a href="#Population.quantities-226"><span class="linenos">226</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
</span><span id="Population.quantities-227"><a href="#Population.quantities-227"><span class="linenos">227</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="Population.quantities-228"><a href="#Population.quantities-228"><span class="linenos">228</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
</span><span id="Population.quantities-229"><a href="#Population.quantities-229"><span class="linenos">229</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Population.quantities-230"><a href="#Population.quantities-230"><span class="linenos">230</span></a>                <span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Population.quantities-231"><a href="#Population.quantities-231"><span class="linenos">231</span></a>                                     <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
</span><span id="Population.quantities-232"><a href="#Population.quantities-232"><span class="linenos">232</span></a>                                     <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()))</span>
</span><span id="Population.quantities-233"><a href="#Population.quantities-233"><span class="linenos">233</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;!=&#39;</span><span class="p">:</span>
</span><span id="Population.quantities-234"><a href="#Population.quantities-234"><span class="linenos">234</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Population.quantities-235"><a href="#Population.quantities-235"><span class="linenos">235</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span>
</span><span id="Population.quantities-236"><a href="#Population.quantities-236"><span class="linenos">236</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&gt;=&#39;</span><span class="p">))</span>
</span><span id="Population.quantities-237"><a href="#Population.quantities-237"><span class="linenos">237</span></a>        <span class="k">elif</span> <span class="n">comparison</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span>
</span><span id="Population.quantities-238"><a href="#Population.quantities-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">))</span>
</span><span id="Population.quantities-239"><a href="#Population.quantities-239"><span class="linenos">239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.quantities-240"><a href="#Population.quantities-240"><span class="linenos">240</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid comparison </span><span class="si">{</span><span class="n">comparison</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The quantities of the mapping in sorted order.</p>

<p>For example, '&lt;=' gives the CDF.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>comparison:</strong>  Optional. If omitted, this defaults to '=='.</li>
</ul>
</div>


                            </div>
                            <div id="Population.denominator" class="classattr">
                                        <input id="Population.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.denominator-255"><a href="#Population.denominator-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.denominator-256"><a href="#Population.denominator-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The sum of all quantities (e.g. weights or duplicates).</span>
</span><span id="Population.denominator-257"><a href="#Population.denominator-257"><span class="linenos">257</span></a>
</span><span id="Population.denominator-258"><a href="#Population.denominator-258"><span class="linenos">258</span></a><span class="sd">        For the number of unique outcomes, including those with zero quantity,</span>
</span><span id="Population.denominator-259"><a href="#Population.denominator-259"><span class="linenos">259</span></a><span class="sd">        use `len()`.</span>
</span><span id="Population.denominator-260"><a href="#Population.denominator-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.denominator-261"><a href="#Population.denominator-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span></pre></div>


            <div class="docstring"><p>The sum of all quantities (e.g. weights or duplicates).</p>

<p>For the number of unique outcomes, including those with zero quantity,
use <code>len()</code>.</p>
</div>


                            </div>
                            <div id="Population.scale_quantities" class="classattr">
                                        <input id="Population.scale_quantities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">scale_quantities</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span><span class="p">:</span> <span class="o">~</span><span class="n">C</span>, </span><span class="param"><span class="n">scale</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">C</span>:</span></span>

                <label class="view-source-button" for="Population.scale_quantities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.scale_quantities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.scale_quantities-263"><a href="#Population.scale_quantities-263"><span class="linenos">263</span></a>    <span class="k">def</span> <span class="nf">scale_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">scale</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">:</span>
</span><span id="Population.scale_quantities-264"><a href="#Population.scale_quantities-264"><span class="linenos">264</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scales all quantities by an integer.&quot;&quot;&quot;</span>
</span><span id="Population.scale_quantities-265"><a href="#Population.scale_quantities-265"><span class="linenos">265</span></a>        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Population.scale_quantities-266"><a href="#Population.scale_quantities-266"><span class="linenos">266</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Population.scale_quantities-267"><a href="#Population.scale_quantities-267"><span class="linenos">267</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Population.scale_quantities-268"><a href="#Population.scale_quantities-268"><span class="linenos">268</span></a>            <span class="n">outcome</span><span class="p">:</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="Population.scale_quantities-269"><a href="#Population.scale_quantities-269"><span class="linenos">269</span></a>            <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Population.scale_quantities-270"><a href="#Population.scale_quantities-270"><span class="linenos">270</span></a>        <span class="p">}</span>
</span><span id="Population.scale_quantities-271"><a href="#Population.scale_quantities-271"><span class="linenos">271</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Scales all quantities by an integer.</p>
</div>


                            </div>
                            <div id="Population.has_zero_quantities" class="classattr">
                                        <input id="Population.has_zero_quantities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_zero_quantities</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Population.has_zero_quantities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.has_zero_quantities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.has_zero_quantities-273"><a href="#Population.has_zero_quantities-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="nf">has_zero_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population.has_zero_quantities-274"><a href="#Population.has_zero_quantities-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`True` iff `self` contains at least one outcome with zero quantity. &quot;&quot;&quot;</span>
</span><span id="Population.has_zero_quantities-275"><a href="#Population.has_zero_quantities-275"><span class="linenos">275</span></a>        <span class="k">return</span> <span class="mi">0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p><code>True</code> iff <code>self</code> contains at least one outcome with zero quantity.</p>
</div>


                            </div>
                            <div id="Population.probability" class="classattr">
                                        <input id="Population.probability-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probability</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">comparison</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]</span>,</span><span class="param">	<span class="n">outcome</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Hashable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.probability-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probability"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probability-311"><a href="#Population.probability-311"><span class="linenos">311</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Population.probability-312"><a href="#Population.probability-312"><span class="linenos">312</span></a>                    <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population.probability-313"><a href="#Population.probability-313"><span class="linenos">313</span></a>                    <span class="o">|</span> <span class="n">Hashable</span><span class="p">,</span>
</span><span id="Population.probability-314"><a href="#Population.probability-314"><span class="linenos">314</span></a>                    <span class="n">outcome</span><span class="p">:</span> <span class="n">Hashable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population.probability-315"><a href="#Population.probability-315"><span class="linenos">315</span></a>                    <span class="o">/</span><span class="p">,</span>
</span><span id="Population.probability-316"><a href="#Population.probability-316"><span class="linenos">316</span></a>                    <span class="o">*</span><span class="p">,</span>
</span><span id="Population.probability-317"><a href="#Population.probability-317"><span class="linenos">317</span></a>                    <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.probability-318"><a href="#Population.probability-318"><span class="linenos">318</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probability of outcomes fitting a comparison.&quot;&quot;&quot;</span>
</span><span id="Population.probability-319"><a href="#Population.probability-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.probability-320"><a href="#Population.probability-320"><span class="linenos">320</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="n">comparison</span>
</span><span id="Population.probability-321"><a href="#Population.probability-321"><span class="linenos">321</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population.probability-322"><a href="#Population.probability-322"><span class="linenos">322</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.probability-323"><a href="#Population.probability-323"><span class="linenos">323</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span>
</span><span id="Population.probability-324"><a href="#Population.probability-324"><span class="linenos">324</span></a>                              <span class="n">comparison</span><span class="p">)</span>
</span><span id="Population.probability-325"><a href="#Population.probability-325"><span class="linenos">325</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">comparison</span><span class="p">,</span> <span class="n">outcome</span><span class="p">),</span>
</span><span id="Population.probability-326"><a href="#Population.probability-326"><span class="linenos">326</span></a>                          <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population.probability-327"><a href="#Population.probability-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="n">result</span> <span class="o">*</span> <span class="mf">100.0</span> <span class="k">if</span> <span class="n">percent</span> <span class="k">else</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>The total probability of outcomes fitting a comparison.</p>
</div>


                            </div>
                            <div id="Population.probabilities" class="classattr">
                                        <input id="Population.probabilities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probabilities</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">comparison</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Population.probabilities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probabilities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probabilities-368"><a href="#Population.probabilities-368"><span class="linenos">368</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span>
</span><span id="Population.probabilities-369"><a href="#Population.probabilities-369"><span class="linenos">369</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Population.probabilities-370"><a href="#Population.probabilities-370"><span class="linenos">370</span></a>            <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>
</span><span id="Population.probabilities-371"><a href="#Population.probabilities-371"><span class="linenos">371</span></a>        <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Population.probabilities-372"><a href="#Population.probabilities-372"><span class="linenos">372</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Population.probabilities-373"><a href="#Population.probabilities-373"><span class="linenos">373</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="Population.probabilities-374"><a href="#Population.probabilities-374"><span class="linenos">374</span></a>            <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Fraction</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population.probabilities-375"><a href="#Population.probabilities-375"><span class="linenos">375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total probabilities fitting the comparison for each outcome in sorted order.</span>
</span><span id="Population.probabilities-376"><a href="#Population.probabilities-376"><span class="linenos">376</span></a><span class="sd">        </span>
</span><span id="Population.probabilities-377"><a href="#Population.probabilities-377"><span class="linenos">377</span></a><span class="sd">        For example, &#39;&lt;=&#39; gives the CDF.</span>
</span><span id="Population.probabilities-378"><a href="#Population.probabilities-378"><span class="linenos">378</span></a>
</span><span id="Population.probabilities-379"><a href="#Population.probabilities-379"><span class="linenos">379</span></a><span class="sd">        Args:</span>
</span><span id="Population.probabilities-380"><a href="#Population.probabilities-380"><span class="linenos">380</span></a><span class="sd">            comparison: Optional. If omitted, this defaults to &#39;==&#39;.</span>
</span><span id="Population.probabilities-381"><a href="#Population.probabilities-381"><span class="linenos">381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.probabilities-382"><a href="#Population.probabilities-382"><span class="linenos">382</span></a>        <span class="k">if</span> <span class="n">comparison</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.probabilities-383"><a href="#Population.probabilities-383"><span class="linenos">383</span></a>            <span class="n">comparison</span> <span class="o">=</span> <span class="s1">&#39;==&#39;</span>
</span><span id="Population.probabilities-384"><a href="#Population.probabilities-384"><span class="linenos">384</span></a>
</span><span id="Population.probabilities-385"><a href="#Population.probabilities-385"><span class="linenos">385</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Population.probabilities-386"><a href="#Population.probabilities-386"><span class="linenos">386</span></a>            <span class="n">Fraction</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population.probabilities-387"><a href="#Population.probabilities-387"><span class="linenos">387</span></a>            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="n">comparison</span><span class="p">))</span>
</span><span id="Population.probabilities-388"><a href="#Population.probabilities-388"><span class="linenos">388</span></a>
</span><span id="Population.probabilities-389"><a href="#Population.probabilities-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population.probabilities-390"><a href="#Population.probabilities-390"><span class="linenos">390</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
</span><span id="Population.probabilities-391"><a href="#Population.probabilities-391"><span class="linenos">391</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.probabilities-392"><a href="#Population.probabilities-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>The total probabilities fitting the comparison for each outcome in sorted order.</p>

<p>For example, '&lt;=' gives the CDF.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>comparison:</strong>  Optional. If omitted, this defaults to '=='.</li>
</ul>
</div>


                            </div>
                            <div id="Population.mode" class="classattr">
                                        <input id="Population.mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="Population.mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.mode-396"><a href="#Population.mode-396"><span class="linenos">396</span></a>    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Population.mode-397"><a href="#Population.mode-397"><span class="linenos">397</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A tuple containing the most common outcome(s) of the population.</span>
</span><span id="Population.mode-398"><a href="#Population.mode-398"><span class="linenos">398</span></a>
</span><span id="Population.mode-399"><a href="#Population.mode-399"><span class="linenos">399</span></a><span class="sd">        These are sorted from lowest to highest.</span>
</span><span id="Population.mode-400"><a href="#Population.mode-400"><span class="linenos">400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.mode-401"><a href="#Population.mode-401"><span class="linenos">401</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Population.mode-402"><a href="#Population.mode-402"><span class="linenos">402</span></a>                     <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>A tuple containing the most common outcome(s) of the population.</p>

<p>These are sorted from lowest to highest.</p>
</div>


                            </div>
                            <div id="Population.modal_quantity" class="classattr">
                                        <input id="Population.modal_quantity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modal_quantity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.modal_quantity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.modal_quantity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.modal_quantity-404"><a href="#Population.modal_quantity-404"><span class="linenos">404</span></a>    <span class="k">def</span> <span class="nf">modal_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.modal_quantity-405"><a href="#Population.modal_quantity-405"><span class="linenos">405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The highest quantity of any single outcome. &quot;&quot;&quot;</span>
</span><span id="Population.modal_quantity-406"><a href="#Population.modal_quantity-406"><span class="linenos">406</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>The highest quantity of any single outcome.</p>
</div>


                            </div>
                            <div id="Population.kolmogorov_smirnov" class="classattr">
                                        <input id="Population.kolmogorov_smirnov-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">kolmogorov_smirnov</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span>:</span></span>

                <label class="view-source-button" for="Population.kolmogorov_smirnov-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.kolmogorov_smirnov"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.kolmogorov_smirnov-408"><a href="#Population.kolmogorov_smirnov-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">kolmogorov_smirnov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population.kolmogorov_smirnov-409"><a href="#Population.kolmogorov_smirnov-409"><span class="linenos">409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;KolmogorovSmirnov statistic. The maximum absolute difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population.kolmogorov_smirnov-410"><a href="#Population.kolmogorov_smirnov-410"><span class="linenos">410</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population.kolmogorov_smirnov-411"><a href="#Population.kolmogorov_smirnov-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="Population.kolmogorov_smirnov-412"><a href="#Population.kolmogorov_smirnov-412"><span class="linenos">412</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Population.kolmogorov_smirnov-413"><a href="#Population.kolmogorov_smirnov-413"><span class="linenos">413</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>KolmogorovSmirnov statistic. The maximum absolute difference between CDFs.</p>
</div>


                            </div>
                            <div id="Population.cramer_von_mises" class="classattr">
                                        <input id="Population.cramer_von_mises-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cramer_von_mises</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span>:</span></span>

                <label class="view-source-button" for="Population.cramer_von_mises-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.cramer_von_mises"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.cramer_von_mises-415"><a href="#Population.cramer_von_mises-415"><span class="linenos">415</span></a>    <span class="k">def</span> <span class="nf">cramer_von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span><span class="p">:</span>
</span><span id="Population.cramer_von_mises-416"><a href="#Population.cramer_von_mises-416"><span class="linenos">416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Cramr-von Mises statistic. The sum-of-squares difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population.cramer_von_mises-417"><a href="#Population.cramer_von_mises-417"><span class="linenos">417</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population.cramer_von_mises-418"><a href="#Population.cramer_von_mises-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Population.cramer_von_mises-419"><a href="#Population.cramer_von_mises-419"><span class="linenos">419</span></a>            <span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Population.cramer_von_mises-420"><a href="#Population.cramer_von_mises-420"><span class="linenos">420</span></a>             <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">))),</span>
</span><span id="Population.cramer_von_mises-421"><a href="#Population.cramer_von_mises-421"><span class="linenos">421</span></a>            <span class="n">start</span><span class="o">=</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Cramr-von Mises statistic. The sum-of-squares difference between CDFs.</p>
</div>


                            </div>
                            <div id="Population.median" class="classattr">
                                        <input id="Population.median-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.median-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.median"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.median-423"><a href="#Population.median-423"><span class="linenos">423</span></a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.median-424"><a href="#Population.median-424"><span class="linenos">424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The median, taking the mean in case of a tie.</span>
</span><span id="Population.median-425"><a href="#Population.median-425"><span class="linenos">425</span></a>
</span><span id="Population.median-426"><a href="#Population.median-426"><span class="linenos">426</span></a><span class="sd">        This will fail if the outcomes do not support division;</span>
</span><span id="Population.median-427"><a href="#Population.median-427"><span class="linenos">427</span></a><span class="sd">        in this case, use `median_low` or `median_high` instead.</span>
</span><span id="Population.median-428"><a href="#Population.median-428"><span class="linenos">428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.median-429"><a href="#Population.median-429"><span class="linenos">429</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The median, taking the mean in case of a tie.</p>

<p>This will fail if the outcomes do not support division;
in this case, use <code><a href="#Population.median_low">median_low</a></code> or <code><a href="#Population.median_high">median_high</a></code> instead.</p>
</div>


                            </div>
                            <div id="Population.median_low" class="classattr">
                                        <input id="Population.median_low-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median_low</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Population.median_low-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.median_low"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.median_low-431"><a href="#Population.median_low-431"><span class="linenos">431</span></a>    <span class="k">def</span> <span class="nf">median_low</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population.median_low-432"><a href="#Population.median_low-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The median, taking the lower in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.median_low-433"><a href="#Population.median_low-433"><span class="linenos">433</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_low</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The median, taking the lower in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.median_high" class="classattr">
                                        <input id="Population.median_high-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median_high</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Population.median_high-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.median_high"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.median_high-435"><a href="#Population.median_high-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="nf">median_high</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population.median_high-436"><a href="#Population.median_high-436"><span class="linenos">436</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The median, taking the higher in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.median_high-437"><a href="#Population.median_high-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_high</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The median, taking the higher in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.quantile" class="classattr">
                                        <input id="Population.quantile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.quantile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantile-439"><a href="#Population.quantile-439"><span class="linenos">439</span></a>    <span class="k">def</span> <span class="nf">quantile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population.quantile-440"><a href="#Population.quantile-440"><span class="linenos">440</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the mean in case of a tie.</span>
</span><span id="Population.quantile-441"><a href="#Population.quantile-441"><span class="linenos">441</span></a>
</span><span id="Population.quantile-442"><a href="#Population.quantile-442"><span class="linenos">442</span></a><span class="sd">        This will fail if the outcomes do not support addition and division;</span>
</span><span id="Population.quantile-443"><a href="#Population.quantile-443"><span class="linenos">443</span></a><span class="sd">        in this case, use `quantile_low` or `quantile_high` instead.</span>
</span><span id="Population.quantile-444"><a href="#Population.quantile-444"><span class="linenos">444</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.quantile-445"><a href="#Population.quantile-445"><span class="linenos">445</span></a>        <span class="c1"># Should support addition and division.</span>
</span><span id="Population.quantile-446"><a href="#Population.quantile-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantile_low</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span>
</span><span id="Population.quantile-447"><a href="#Population.quantile-447"><span class="linenos">447</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">quantile_high</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>The outcome <code>n / d</code> of the way through the CDF, taking the mean in case of a tie.</p>

<p>This will fail if the outcomes do not support addition and division;
in this case, use <code><a href="#Population.quantile_low">quantile_low</a></code> or <code><a href="#Population.quantile_high">quantile_high</a></code> instead.</p>
</div>


                            </div>
                            <div id="Population.quantile_low" class="classattr">
                                        <input id="Population.quantile_low-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantile_low</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Population.quantile_low-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantile_low"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantile_low-449"><a href="#Population.quantile_low-449"><span class="linenos">449</span></a>    <span class="k">def</span> <span class="nf">quantile_low</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population.quantile_low-450"><a href="#Population.quantile_low-450"><span class="linenos">450</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the lesser in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.quantile_low-451"><a href="#Population.quantile_low-451"><span class="linenos">451</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span>
</span><span id="Population.quantile_low-452"><a href="#Population.quantile_low-452"><span class="linenos">452</span></a>                                   <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population.quantile_low-453"><a href="#Population.quantile_low-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.quantile_low-454"><a href="#Population.quantile_low-454"><span class="linenos">454</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population.quantile_low-455"><a href="#Population.quantile_low-455"><span class="linenos">455</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The outcome <code>n / d</code> of the way through the CDF, taking the lesser in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.quantile_high" class="classattr">
                                        <input id="Population.quantile_high-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantile_high</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Population.quantile_high-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantile_high"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantile_high-457"><a href="#Population.quantile_high-457"><span class="linenos">457</span></a>    <span class="k">def</span> <span class="nf">quantile_high</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population.quantile_high-458"><a href="#Population.quantile_high-458"><span class="linenos">458</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the greater in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.quantile_high-459"><a href="#Population.quantile_high-459"><span class="linenos">459</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span>
</span><span id="Population.quantile_high-460"><a href="#Population.quantile_high-460"><span class="linenos">460</span></a>                                    <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population.quantile_high-461"><a href="#Population.quantile_high-461"><span class="linenos">461</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.quantile_high-462"><a href="#Population.quantile_high-462"><span class="linenos">462</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population.quantile_high-463"><a href="#Population.quantile_high-463"><span class="linenos">463</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The outcome <code>n / d</code> of the way through the CDF, taking the greater in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.mean" class="classattr">
                                        <input id="Population.mean-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mean</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.mean-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.mean"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.mean-473"><a href="#Population.mean-473"><span class="linenos">473</span></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span>
</span><span id="Population.mean-474"><a href="#Population.mean-474"><span class="linenos">474</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span>
</span><span id="Population.mean-475"><a href="#Population.mean-475"><span class="linenos">475</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.mean-476"><a href="#Population.mean-476"><span class="linenos">476</span></a>        <span class="k">return</span> <span class="n">try_fraction</span><span class="p">(</span>
</span><span id="Population.mean-477"><a href="#Population.mean-477"><span class="linenos">477</span></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">outcome</span> <span class="o">*</span> <span class="n">quantity</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
</span><span id="Population.mean-478"><a href="#Population.mean-478"><span class="linenos">478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.variance" class="classattr">
                                        <input id="Population.variance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">variance</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.variance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.variance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.variance-488"><a href="#Population.variance-488"><span class="linenos">488</span></a>    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span>
</span><span id="Population.variance-489"><a href="#Population.variance-489"><span class="linenos">489</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span>
</span><span id="Population.variance-490"><a href="#Population.variance-490"><span class="linenos">490</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.variance-491"><a href="#Population.variance-491"><span class="linenos">491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This is the population variance, not the sample variance.&quot;&quot;&quot;</span>
</span><span id="Population.variance-492"><a href="#Population.variance-492"><span class="linenos">492</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.variance-493"><a href="#Population.variance-493"><span class="linenos">493</span></a>        <span class="n">mean_of_squares</span> <span class="o">=</span> <span class="n">try_fraction</span><span class="p">(</span>
</span><span id="Population.variance-494"><a href="#Population.variance-494"><span class="linenos">494</span></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">quantity</span> <span class="o">*</span> <span class="n">outcome</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>
</span><span id="Population.variance-495"><a href="#Population.variance-495"><span class="linenos">495</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population.variance-496"><a href="#Population.variance-496"><span class="linenos">496</span></a>        <span class="k">return</span> <span class="n">mean_of_squares</span> <span class="o">-</span> <span class="n">mean</span> <span class="o">*</span> <span class="n">mean</span>
</span></pre></div>


            <div class="docstring"><p>This is the population variance, not the sample variance.</p>
</div>


                            </div>
                            <div id="Population.standard_deviation" class="classattr">
                                        <input id="Population.standard_deviation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standard_deviation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.standard_deviation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.standard_deviation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.standard_deviation-498"><a href="#Population.standard_deviation-498"><span class="linenos">498</span></a>    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span>
</span><span id="Population.standard_deviation-499"><a href="#Population.standard_deviation-499"><span class="linenos">499</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.standard_deviation-500"><a href="#Population.standard_deviation-500"><span class="linenos">500</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.sd" class="classattr">
                                        <input id="Population.sd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sd</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.sd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.sd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.sd-498"><a href="#Population.sd-498"><span class="linenos">498</span></a>    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span>
</span><span id="Population.sd-499"><a href="#Population.sd-499"><span class="linenos">499</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.sd-500"><a href="#Population.sd-500"><span class="linenos">500</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.standardized_moment" class="classattr">
                                        <input id="Population.standardized_moment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardized_moment</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>,</span><span class="param">	<span class="n">k</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.standardized_moment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.standardized_moment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.standardized_moment-504"><a href="#Population.standardized_moment-504"><span class="linenos">504</span></a>    <span class="k">def</span> <span class="nf">standardized_moment</span><span class="p">(</span>
</span><span id="Population.standardized_moment-505"><a href="#Population.standardized_moment-505"><span class="linenos">505</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">,</span>
</span><span id="Population.standardized_moment-506"><a href="#Population.standardized_moment-506"><span class="linenos">506</span></a>            <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.standardized_moment-507"><a href="#Population.standardized_moment-507"><span class="linenos">507</span></a>        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population.standardized_moment-508"><a href="#Population.standardized_moment-508"><span class="linenos">508</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.standardized_moment-509"><a href="#Population.standardized_moment-509"><span class="linenos">509</span></a>        <span class="n">ev</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="n">k</span>  <span class="c1"># type: ignore </span>
</span><span id="Population.standardized_moment-510"><a href="#Population.standardized_moment-510"><span class="linenos">510</span></a>                 <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span><span class="p">()))</span>
</span><span id="Population.standardized_moment-511"><a href="#Population.standardized_moment-511"><span class="linenos">511</span></a>        <span class="k">return</span> <span class="n">ev</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.skewness" class="classattr">
                                        <input id="Population.skewness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">skewness</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.skewness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.skewness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.skewness-513"><a href="#Population.skewness-513"><span class="linenos">513</span></a>    <span class="k">def</span> <span class="nf">skewness</span><span class="p">(</span>
</span><span id="Population.skewness-514"><a href="#Population.skewness-514"><span class="linenos">514</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.skewness-515"><a href="#Population.skewness-515"><span class="linenos">515</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.excess_kurtosis" class="classattr">
                                        <input id="Population.excess_kurtosis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">excess_kurtosis</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.excess_kurtosis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.excess_kurtosis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.excess_kurtosis-517"><a href="#Population.excess_kurtosis-517"><span class="linenos">517</span></a>    <span class="k">def</span> <span class="nf">excess_kurtosis</span><span class="p">(</span>
</span><span id="Population.excess_kurtosis-518"><a href="#Population.excess_kurtosis-518"><span class="linenos">518</span></a>            <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;Population[numbers.Rational] | Population[float]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.excess_kurtosis-519"><a href="#Population.excess_kurtosis-519"><span class="linenos">519</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.0</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.entropy" class="classattr">
                                        <input id="Population.entropy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">entropy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.entropy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.entropy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.entropy-521"><a href="#Population.entropy-521"><span class="linenos">521</span></a>    <span class="k">def</span> <span class="nf">entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.entropy-522"><a href="#Population.entropy-522"><span class="linenos">522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The entropy of a random sample from this population.</span>
</span><span id="Population.entropy-523"><a href="#Population.entropy-523"><span class="linenos">523</span></a><span class="sd">        </span>
</span><span id="Population.entropy-524"><a href="#Population.entropy-524"><span class="linenos">524</span></a><span class="sd">        Args:</span>
</span><span id="Population.entropy-525"><a href="#Population.entropy-525"><span class="linenos">525</span></a><span class="sd">            base: The logarithm base to use. Default is 2.0, which gives the </span>
</span><span id="Population.entropy-526"><a href="#Population.entropy-526"><span class="linenos">526</span></a><span class="sd">                entropy in bits.</span>
</span><span id="Population.entropy-527"><a href="#Population.entropy-527"><span class="linenos">527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.entropy-528"><a href="#Population.entropy-528"><span class="linenos">528</span></a>        <span class="k">return</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">base</span><span class="p">)</span>
</span><span id="Population.entropy-529"><a href="#Population.entropy-529"><span class="linenos">529</span></a>                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The entropy of a random sample from this population.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>base:</strong>  The logarithm base to use. Default is 2.0, which gives the 
entropy in bits.</li>
</ul>
</div>


                            </div>
                            <div id="Population.marginals" class="classattr">
                                        <input id="Population.marginals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">marginals</span><span class="annotation">: icepool.population.base.Population._Marginals[~C]</span>

                <label class="view-source-button" for="Population.marginals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.marginals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.marginals-558"><a href="#Population.marginals-558"><span class="linenos">558</span></a>    <span class="nd">@property</span>
</span><span id="Population.marginals-559"><a href="#Population.marginals-559"><span class="linenos">559</span></a>    <span class="k">def</span> <span class="nf">marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">C</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Marginals</span><span class="p">[</span><span class="n">C</span><span class="p">]:</span>
</span><span id="Population.marginals-560"><a href="#Population.marginals-560"><span class="linenos">560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A property that applies the `[]` operator to outcomes.</span>
</span><span id="Population.marginals-561"><a href="#Population.marginals-561"><span class="linenos">561</span></a>
</span><span id="Population.marginals-562"><a href="#Population.marginals-562"><span class="linenos">562</span></a><span class="sd">        For example, `population.marginals[:2]` will marginalize the first two</span>
</span><span id="Population.marginals-563"><a href="#Population.marginals-563"><span class="linenos">563</span></a><span class="sd">        elements of sequence outcomes.</span>
</span><span id="Population.marginals-564"><a href="#Population.marginals-564"><span class="linenos">564</span></a>
</span><span id="Population.marginals-565"><a href="#Population.marginals-565"><span class="linenos">565</span></a><span class="sd">        Attributes that do not start with an underscore will also be forwarded.</span>
</span><span id="Population.marginals-566"><a href="#Population.marginals-566"><span class="linenos">566</span></a><span class="sd">        For example, `population.marginals.x` will marginalize the `x` attribute</span>
</span><span id="Population.marginals-567"><a href="#Population.marginals-567"><span class="linenos">567</span></a><span class="sd">        from e.g. `namedtuple` outcomes.</span>
</span><span id="Population.marginals-568"><a href="#Population.marginals-568"><span class="linenos">568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.marginals-569"><a href="#Population.marginals-569"><span class="linenos">569</span></a>        <span class="k">return</span> <span class="n">Population</span><span class="o">.</span><span class="n">_Marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A property that applies the <code>[]</code> operator to outcomes.</p>

<p>For example, <code>population.marginals[:2]</code> will marginalize the first two
elements of sequence outcomes.</p>

<p>Attributes that do not start with an underscore will also be forwarded.
For example, <code>population.marginals.x</code> will marginalize the <code>x</code> attribute
from e.g. <code>namedtuple</code> outcomes.</p>
</div>


                            </div>
                            <div id="Population.covariance" class="classattr">
                                        <input id="Population.covariance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">covariance</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>,</span><span class="param">	<span class="n">i</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">j</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.covariance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.covariance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.covariance-581"><a href="#Population.covariance-581"><span class="linenos">581</span></a>    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span>
</span><span id="Population.covariance-582"><a href="#Population.covariance-582"><span class="linenos">582</span></a>            <span class="bp">self</span><span class="p">:</span>
</span><span id="Population.covariance-583"><a href="#Population.covariance-583"><span class="linenos">583</span></a>        <span class="s1">&#39;Population[tuple[numbers.Rational, ...]] | Population[tuple[float, ...]]&#39;</span><span class="p">,</span>
</span><span id="Population.covariance-584"><a href="#Population.covariance-584"><span class="linenos">584</span></a>            <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Fraction</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.covariance-585"><a href="#Population.covariance-585"><span class="linenos">585</span></a>        <span class="n">mean_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.covariance-586"><a href="#Population.covariance-586"><span class="linenos">586</span></a>        <span class="n">mean_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.covariance-587"><a href="#Population.covariance-587"><span class="linenos">587</span></a>        <span class="k">return</span> <span class="n">try_fraction</span><span class="p">(</span>
</span><span id="Population.covariance-588"><a href="#Population.covariance-588"><span class="linenos">588</span></a>            <span class="nb">sum</span><span class="p">((</span><span class="n">outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_j</span><span class="p">)</span> <span class="o">*</span> <span class="n">quantity</span>
</span><span id="Population.covariance-589"><a href="#Population.covariance-589"><span class="linenos">589</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.correlation" class="classattr">
                                        <input id="Population.correlation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">correlation</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">numbers</span><span class="o">.</span><span class="n">Rational</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>,</span><span class="param">	<span class="n">i</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">j</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.correlation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.correlation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.correlation-591"><a href="#Population.correlation-591"><span class="linenos">591</span></a>    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span>
</span><span id="Population.correlation-592"><a href="#Population.correlation-592"><span class="linenos">592</span></a>            <span class="bp">self</span><span class="p">:</span>
</span><span id="Population.correlation-593"><a href="#Population.correlation-593"><span class="linenos">593</span></a>        <span class="s1">&#39;Population[tuple[numbers.Rational, ...]] | Population[tuple[float, ...]]&#39;</span><span class="p">,</span>
</span><span id="Population.correlation-594"><a href="#Population.correlation-594"><span class="linenos">594</span></a>            <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.correlation-595"><a href="#Population.correlation-595"><span class="linenos">595</span></a>        <span class="n">sd_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population.correlation-596"><a href="#Population.correlation-596"><span class="linenos">596</span></a>        <span class="n">sd_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population.correlation-597"><a href="#Population.correlation-597"><span class="linenos">597</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd_i</span> <span class="o">*</span> <span class="n">sd_j</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.to_one_hot" class="classattr">
                                        <input id="Population.to_one_hot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_one_hot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span><span class="p">:</span> <span class="o">~</span><span class="n">C</span>, </span><span class="param"><span class="n">outcomes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">C</span>:</span></span>

                <label class="view-source-button" for="Population.to_one_hot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.to_one_hot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.to_one_hot-601"><a href="#Population.to_one_hot-601"><span class="linenos">601</span></a>    <span class="k">def</span> <span class="nf">to_one_hot</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">C</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="p">:</span>
</span><span id="Population.to_one_hot-602"><a href="#Population.to_one_hot-602"><span class="linenos">602</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Converts the outcomes of this population to a one-hot representation.</span>
</span><span id="Population.to_one_hot-603"><a href="#Population.to_one_hot-603"><span class="linenos">603</span></a>
</span><span id="Population.to_one_hot-604"><a href="#Population.to_one_hot-604"><span class="linenos">604</span></a><span class="sd">        Args:</span>
</span><span id="Population.to_one_hot-605"><a href="#Population.to_one_hot-605"><span class="linenos">605</span></a><span class="sd">            outcomes: If provided, each outcome will be mapped to a `Vector`</span>
</span><span id="Population.to_one_hot-606"><a href="#Population.to_one_hot-606"><span class="linenos">606</span></a><span class="sd">                where the element at `outcomes.index(outcome)` is set to `True`</span>
</span><span id="Population.to_one_hot-607"><a href="#Population.to_one_hot-607"><span class="linenos">607</span></a><span class="sd">                and the rest to `False`, or all `False` if the outcome is not</span>
</span><span id="Population.to_one_hot-608"><a href="#Population.to_one_hot-608"><span class="linenos">608</span></a><span class="sd">                in `outcomes`.</span>
</span><span id="Population.to_one_hot-609"><a href="#Population.to_one_hot-609"><span class="linenos">609</span></a><span class="sd">                If not provided, `self.outcomes()` is used.</span>
</span><span id="Population.to_one_hot-610"><a href="#Population.to_one_hot-610"><span class="linenos">610</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.to_one_hot-611"><a href="#Population.to_one_hot-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">outcomes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.to_one_hot-612"><a href="#Population.to_one_hot-612"><span class="linenos">612</span></a>            <span class="n">outcomes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Population.to_one_hot-613"><a href="#Population.to_one_hot-613"><span class="linenos">613</span></a>
</span><span id="Population.to_one_hot-614"><a href="#Population.to_one_hot-614"><span class="linenos">614</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Vector</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Population.to_one_hot-615"><a href="#Population.to_one_hot-615"><span class="linenos">615</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()):</span>
</span><span id="Population.to_one_hot-616"><a href="#Population.to_one_hot-616"><span class="linenos">616</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span>
</span><span id="Population.to_one_hot-617"><a href="#Population.to_one_hot-617"><span class="linenos">617</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="Population.to_one_hot-618"><a href="#Population.to_one_hot-618"><span class="linenos">618</span></a>                <span class="n">value</span><span class="p">[</span><span class="n">outcomes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">outcome</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Population.to_one_hot-619"><a href="#Population.to_one_hot-619"><span class="linenos">619</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">Vector</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Population.to_one_hot-620"><a href="#Population.to_one_hot-620"><span class="linenos">620</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Converts the outcomes of this population to a one-hot representation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>outcomes:</strong>  If provided, each outcome will be mapped to a <code><a href="#Vector">Vector</a></code>
where the element at <code>outcomes.index(outcome)</code> is set to <code>True</code>
and the rest to <code>False</code>, or all <code>False</code> if the outcome is not
in <code><a href="#Population.outcomes">outcomes</a></code>.
If not provided, <code>self.outcomes()</code> is used.</li>
</ul>
</div>


                            </div>
                            <div id="Population.sample" class="classattr">
                                        <input id="Population.sample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">+</span><span class="n">T_co</span>:</span></span>

                <label class="view-source-button" for="Population.sample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.sample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.sample-622"><a href="#Population.sample-622"><span class="linenos">622</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Population.sample-623"><a href="#Population.sample-623"><span class="linenos">623</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A single random sample from this population.</span>
</span><span id="Population.sample-624"><a href="#Population.sample-624"><span class="linenos">624</span></a>
</span><span id="Population.sample-625"><a href="#Population.sample-625"><span class="linenos">625</span></a><span class="sd">        Note that this is always &quot;with replacement&quot; even for `Deck` since</span>
</span><span id="Population.sample-626"><a href="#Population.sample-626"><span class="linenos">626</span></a><span class="sd">        instances are immutable.</span>
</span><span id="Population.sample-627"><a href="#Population.sample-627"><span class="linenos">627</span></a>
</span><span id="Population.sample-628"><a href="#Population.sample-628"><span class="linenos">628</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="Population.sample-629"><a href="#Population.sample-629"><span class="linenos">629</span></a><span class="sd">        secure.</span>
</span><span id="Population.sample-630"><a href="#Population.sample-630"><span class="linenos">630</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.sample-631"><a href="#Population.sample-631"><span class="linenos">631</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="Population.sample-632"><a href="#Population.sample-632"><span class="linenos">632</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population.sample-633"><a href="#Population.sample-633"><span class="linenos">633</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">(</span><span class="s1">&#39;&lt;=&#39;</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>
</span><span id="Population.sample-634"><a href="#Population.sample-634"><span class="linenos">634</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A single random sample from this population.</p>

<p>Note that this is always "with replacement" even for <code><a href="#Deck">Deck</a></code> since
instances are immutable.</p>

<p>This uses the standard <code>random</code> package and is not cryptographically
secure.</p>
</div>


                            </div>
                            <div id="Population.format" class="classattr">
                                        <input id="Population.format-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">format</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="o">/</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Population.format-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.format"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.format-636"><a href="#Population.format-636"><span class="linenos">636</span></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population.format-637"><a href="#Population.format-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Formats this mapping as a string.</span>
</span><span id="Population.format-638"><a href="#Population.format-638"><span class="linenos">638</span></a>
</span><span id="Population.format-639"><a href="#Population.format-639"><span class="linenos">639</span></a><span class="sd">        `format_spec` should start with the output format,</span>
</span><span id="Population.format-640"><a href="#Population.format-640"><span class="linenos">640</span></a><span class="sd">        which can be:</span>
</span><span id="Population.format-641"><a href="#Population.format-641"><span class="linenos">641</span></a><span class="sd">        * `md` for Markdown (default)</span>
</span><span id="Population.format-642"><a href="#Population.format-642"><span class="linenos">642</span></a><span class="sd">        * `bbcode` for BBCode</span>
</span><span id="Population.format-643"><a href="#Population.format-643"><span class="linenos">643</span></a><span class="sd">        * `csv` for comma-separated values</span>
</span><span id="Population.format-644"><a href="#Population.format-644"><span class="linenos">644</span></a><span class="sd">        * `html` for HTML</span>
</span><span id="Population.format-645"><a href="#Population.format-645"><span class="linenos">645</span></a>
</span><span id="Population.format-646"><a href="#Population.format-646"><span class="linenos">646</span></a><span class="sd">        After this, you may optionally add a `:` followed by a series of</span>
</span><span id="Population.format-647"><a href="#Population.format-647"><span class="linenos">647</span></a><span class="sd">        requested columns. Allowed columns are:</span>
</span><span id="Population.format-648"><a href="#Population.format-648"><span class="linenos">648</span></a>
</span><span id="Population.format-649"><a href="#Population.format-649"><span class="linenos">649</span></a><span class="sd">        * `o`: Outcomes.</span>
</span><span id="Population.format-650"><a href="#Population.format-650"><span class="linenos">650</span></a><span class="sd">        * `*o`: Outcomes, unpacked if applicable.</span>
</span><span id="Population.format-651"><a href="#Population.format-651"><span class="linenos">651</span></a><span class="sd">        * `q==`, `q&lt;=`, `q&gt;=`: Quantities ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population.format-652"><a href="#Population.format-652"><span class="linenos">652</span></a><span class="sd">        * `p==`, `p&lt;=`, `p&gt;=`: Probabilities (0-1) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population.format-653"><a href="#Population.format-653"><span class="linenos">653</span></a><span class="sd">        * `%==`, `%&lt;=`, `%&gt;=`: Probabilities (0%-100%) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population.format-654"><a href="#Population.format-654"><span class="linenos">654</span></a>
</span><span id="Population.format-655"><a href="#Population.format-655"><span class="linenos">655</span></a><span class="sd">        Columns may optionally be separated using `|` characters.</span>
</span><span id="Population.format-656"><a href="#Population.format-656"><span class="linenos">656</span></a>
</span><span id="Population.format-657"><a href="#Population.format-657"><span class="linenos">657</span></a><span class="sd">        The default columns are `*o|q==|%==`, which are the unpacked outcomes,</span>
</span><span id="Population.format-658"><a href="#Population.format-658"><span class="linenos">658</span></a><span class="sd">        the quantities, and the probabilities. The quantities are omitted from</span>
</span><span id="Population.format-659"><a href="#Population.format-659"><span class="linenos">659</span></a><span class="sd">        the default columns if any individual quantity is 10**30 or greater.</span>
</span><span id="Population.format-660"><a href="#Population.format-660"><span class="linenos">660</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.format-661"><a href="#Population.format-661"><span class="linenos">661</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">30</span><span class="p">:</span>
</span><span id="Population.format-662"><a href="#Population.format-662"><span class="linenos">662</span></a>            <span class="n">default_column_spec</span> <span class="o">=</span> <span class="s1">&#39;*oq==%==&#39;</span>
</span><span id="Population.format-663"><a href="#Population.format-663"><span class="linenos">663</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.format-664"><a href="#Population.format-664"><span class="linenos">664</span></a>            <span class="n">default_column_spec</span> <span class="o">=</span> <span class="s1">&#39;*o%==&#39;</span>
</span><span id="Population.format-665"><a href="#Population.format-665"><span class="linenos">665</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population.format-666"><a href="#Population.format-666"><span class="linenos">666</span></a>            <span class="n">format_spec</span> <span class="o">=</span> <span class="s1">&#39;md:&#39;</span> <span class="o">+</span> <span class="n">default_column_spec</span>
</span><span id="Population.format-667"><a href="#Population.format-667"><span class="linenos">667</span></a>
</span><span id="Population.format-668"><a href="#Population.format-668"><span class="linenos">668</span></a>        <span class="n">format_spec</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Population.format-669"><a href="#Population.format-669"><span class="linenos">669</span></a>
</span><span id="Population.format-670"><a href="#Population.format-670"><span class="linenos">670</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="Population.format-671"><a href="#Population.format-671"><span class="linenos">671</span></a>
</span><span id="Population.format-672"><a href="#Population.format-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Population.format-673"><a href="#Population.format-673"><span class="linenos">673</span></a>            <span class="n">output_format</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Population.format-674"><a href="#Population.format-674"><span class="linenos">674</span></a>            <span class="n">col_spec</span> <span class="o">=</span> <span class="n">default_column_spec</span>
</span><span id="Population.format-675"><a href="#Population.format-675"><span class="linenos">675</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Population.format-676"><a href="#Population.format-676"><span class="linenos">676</span></a>            <span class="n">output_format</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Population.format-677"><a href="#Population.format-677"><span class="linenos">677</span></a>            <span class="n">col_spec</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Population.format-678"><a href="#Population.format-678"><span class="linenos">678</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.format-679"><a href="#Population.format-679"><span class="linenos">679</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;format_spec has too many colons.&#39;</span><span class="p">)</span>
</span><span id="Population.format-680"><a href="#Population.format-680"><span class="linenos">680</span></a>
</span><span id="Population.format-681"><a href="#Population.format-681"><span class="linenos">681</span></a>        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Population.format-682"><a href="#Population.format-682"><span class="linenos">682</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">)</span>
</span><span id="Population.format-683"><a href="#Population.format-683"><span class="linenos">683</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;bbcode&#39;</span><span class="p">:</span>
</span><span id="Population.format-684"><a href="#Population.format-684"><span class="linenos">684</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">bbcode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">)</span>
</span><span id="Population.format-685"><a href="#Population.format-685"><span class="linenos">685</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="Population.format-686"><a href="#Population.format-686"><span class="linenos">686</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Population.format-687"><a href="#Population.format-687"><span class="linenos">687</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Population.format-688"><a href="#Population.format-688"><span class="linenos">688</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col_spec</span><span class="p">)</span>
</span><span id="Population.format-689"><a href="#Population.format-689"><span class="linenos">689</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.format-690"><a href="#Population.format-690"><span class="linenos">690</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported output format &#39;</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Formats this mapping as a string.</p>

<p><code>format_spec</code> should start with the output format,
which can be:</p>

<ul>
<li><code>md</code> for Markdown (default)</li>
<li><code>bbcode</code> for BBCode</li>
<li><code>csv</code> for comma-separated values</li>
<li><code>html</code> for HTML</li>
</ul>

<p>After this, you may optionally add a <code>:</code> followed by a series of
requested columns. Allowed columns are:</p>

<ul>
<li><code>o</code>: Outcomes.</li>
<li><code>*o</code>: Outcomes, unpacked if applicable.</li>
<li><code>q==</code>, <code>q&lt;=</code>, <code>q&gt;=</code>: Quantities ==, &lt;=, or &gt;= each outcome.</li>
<li><code>p==</code>, <code>p&lt;=</code>, <code>p&gt;=</code>: Probabilities (0-1) ==, &lt;=, or &gt;= each outcome.</li>
<li><code>%==</code>, <code>%&lt;=</code>, <code>%&gt;=</code>: Probabilities (0%-100%) ==, &lt;=, or &gt;= each outcome.</li>
</ul>

<p>Columns may optionally be separated using <code>|</code> characters.</p>

<p>The default columns are <code>*o|q==|%==</code>, which are the unpacked outcomes,
the quantities, and the probabilities. The quantities are omitted from
the default columns if any individual quantity is 10**30 or greater.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Mapping</dt>
                                <dd id="Population.get" class="function">get</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="tupleize">
                            <input id="tupleize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tupleize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="o">...</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="tupleize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tupleize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tupleize-77"><a href="#tupleize-77"><span class="linenos">77</span></a><span class="k">def</span> <span class="nf">tupleize</span><span class="p">(</span>
</span><span id="tupleize-78"><a href="#tupleize-78"><span class="linenos">78</span></a>    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Population[T]&#39;</span>
</span><span id="tupleize-79"><a href="#tupleize-79"><span class="linenos">79</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[T, ...] | icepool.Population[tuple[T, ...]]&#39;</span><span class="p">:</span>
</span><span id="tupleize-80"><a href="#tupleize-80"><span class="linenos">80</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the Cartesian product of the arguments as `tuple`s or a `Population` thereof.</span>
</span><span id="tupleize-81"><a href="#tupleize-81"><span class="linenos">81</span></a>
</span><span id="tupleize-82"><a href="#tupleize-82"><span class="linenos">82</span></a><span class="sd">    For example:</span>
</span><span id="tupleize-83"><a href="#tupleize-83"><span class="linenos">83</span></a><span class="sd">    * `tupleize(1, 2)` would produce `(1, 2)`.</span>
</span><span id="tupleize-84"><a href="#tupleize-84"><span class="linenos">84</span></a><span class="sd">    * `tupleize(d6, 0)` would produce a `Die` with outcomes `(1, 0)`, `(2, 0)`,</span>
</span><span id="tupleize-85"><a href="#tupleize-85"><span class="linenos">85</span></a><span class="sd">        ... `(6, 0)`.</span>
</span><span id="tupleize-86"><a href="#tupleize-86"><span class="linenos">86</span></a><span class="sd">    * `tupleize(d6, d6)` would produce a `Die` with outcomes `(1, 1)`, `(1, 2)`,</span>
</span><span id="tupleize-87"><a href="#tupleize-87"><span class="linenos">87</span></a><span class="sd">        ... `(6, 5)`, `(6, 6)`.</span>
</span><span id="tupleize-88"><a href="#tupleize-88"><span class="linenos">88</span></a>
</span><span id="tupleize-89"><a href="#tupleize-89"><span class="linenos">89</span></a><span class="sd">    If `Population`s are provided, they must all be `Die` or all `Deck` and not</span>
</span><span id="tupleize-90"><a href="#tupleize-90"><span class="linenos">90</span></a><span class="sd">    a mixture of the two.</span>
</span><span id="tupleize-91"><a href="#tupleize-91"><span class="linenos">91</span></a>
</span><span id="tupleize-92"><a href="#tupleize-92"><span class="linenos">92</span></a><span class="sd">    Returns:</span>
</span><span id="tupleize-93"><a href="#tupleize-93"><span class="linenos">93</span></a><span class="sd">        If none of the outcomes is a `Population`, the result is a `tuple`</span>
</span><span id="tupleize-94"><a href="#tupleize-94"><span class="linenos">94</span></a><span class="sd">        with one element per argument. Otherwise, the result is a `Population`</span>
</span><span id="tupleize-95"><a href="#tupleize-95"><span class="linenos">95</span></a><span class="sd">        of the same type as the input `Population`, and the outcomes are</span>
</span><span id="tupleize-96"><a href="#tupleize-96"><span class="linenos">96</span></a><span class="sd">        `tuple`s with one element per argument.</span>
</span><span id="tupleize-97"><a href="#tupleize-97"><span class="linenos">97</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="tupleize-98"><a href="#tupleize-98"><span class="linenos">98</span></a>    <span class="k">return</span> <span class="n">cartesian_product</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">outcome_type</span><span class="o">=</span><span class="nb">tuple</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the Cartesian product of the arguments as <code>tuple</code>s or a <code><a href="#Population">Population</a></code> thereof.</p>

<p>For example:</p>

<ul>
<li><code>tupleize(1, 2)</code> would produce <code>(1, 2)</code>.</li>
<li><code>tupleize(d6, 0)</code> would produce a <code><a href="#Die">Die</a></code> with outcomes <code>(1, 0)</code>, <code>(2, 0)</code>,
... <code>(6, 0)</code>.</li>
<li><code>tupleize(d6, d6)</code> would produce a <code><a href="#Die">Die</a></code> with outcomes <code>(1, 1)</code>, <code>(1, 2)</code>,
... <code>(6, 5)</code>, <code>(6, 6)</code>.</li>
</ul>

<p>If <code><a href="#Population">Population</a></code>s are provided, they must all be <code><a href="#Die">Die</a></code> or all <code><a href="#Deck">Deck</a></code> and not
a mixture of the two.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>If none of the outcomes is a <code><a href="#Population">Population</a></code>, the result is a <code>tuple</code>
  with one element per argument. Otherwise, the result is a <code><a href="#Population">Population</a></code>
  of the same type as the input <code><a href="#Population">Population</a></code>, and the outcomes are
  <code>tuple</code>s with one element per argument.</p>
</blockquote>
</div>


                </section>
                <section id="vectorize">
                            <input id="vectorize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">vectorize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Vector">Vector</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#Population">Population</a></span><span class="p">[</span><span class="n"><a href="#Vector">Vector</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="vectorize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#vectorize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="vectorize-101"><a href="#vectorize-101"><span class="linenos">101</span></a><span class="k">def</span> <span class="nf">vectorize</span><span class="p">(</span>
</span><span id="vectorize-102"><a href="#vectorize-102"><span class="linenos">102</span></a>    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Population[T]&#39;</span>
</span><span id="vectorize-103"><a href="#vectorize-103"><span class="linenos">103</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[T] | icepool.Population[Vector[T]]&#39;</span><span class="p">:</span>
</span><span id="vectorize-104"><a href="#vectorize-104"><span class="linenos">104</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the Cartesian product of the arguments as `Vector`s or a `Population` thereof.</span>
</span><span id="vectorize-105"><a href="#vectorize-105"><span class="linenos">105</span></a>
</span><span id="vectorize-106"><a href="#vectorize-106"><span class="linenos">106</span></a><span class="sd">    For example:</span>
</span><span id="vectorize-107"><a href="#vectorize-107"><span class="linenos">107</span></a><span class="sd">    * `vectorize(1, 2)` would produce `Vector(1, 2)`.</span>
</span><span id="vectorize-108"><a href="#vectorize-108"><span class="linenos">108</span></a><span class="sd">    * `vectorize(d6, 0)` would produce a `Die` with outcomes `Vector(1, 0)`,</span>
</span><span id="vectorize-109"><a href="#vectorize-109"><span class="linenos">109</span></a><span class="sd">        `Vector(2, 0)`, ... `Vector(6, 0)`.</span>
</span><span id="vectorize-110"><a href="#vectorize-110"><span class="linenos">110</span></a><span class="sd">    * `vectorize(d6, d6)` would produce a `Die` with outcomes `Vector(1, 1)`,</span>
</span><span id="vectorize-111"><a href="#vectorize-111"><span class="linenos">111</span></a><span class="sd">        `Vector(1, 2)`, ... `Vector(6, 5)`, `Vector(6, 6)`.</span>
</span><span id="vectorize-112"><a href="#vectorize-112"><span class="linenos">112</span></a>
</span><span id="vectorize-113"><a href="#vectorize-113"><span class="linenos">113</span></a><span class="sd">    If `Population`s are provided, they must all be `Die` or all `Deck` and not</span>
</span><span id="vectorize-114"><a href="#vectorize-114"><span class="linenos">114</span></a><span class="sd">    a mixture of the two.</span>
</span><span id="vectorize-115"><a href="#vectorize-115"><span class="linenos">115</span></a>
</span><span id="vectorize-116"><a href="#vectorize-116"><span class="linenos">116</span></a><span class="sd">    Returns:</span>
</span><span id="vectorize-117"><a href="#vectorize-117"><span class="linenos">117</span></a><span class="sd">        If none of the outcomes is a `Population`, the result is a `Vector`</span>
</span><span id="vectorize-118"><a href="#vectorize-118"><span class="linenos">118</span></a><span class="sd">        with one element per argument. Otherwise, the result is a `Population`</span>
</span><span id="vectorize-119"><a href="#vectorize-119"><span class="linenos">119</span></a><span class="sd">        of the same type as the input `Population`, and the outcomes are</span>
</span><span id="vectorize-120"><a href="#vectorize-120"><span class="linenos">120</span></a><span class="sd">        `Vector`s with one element per argument.</span>
</span><span id="vectorize-121"><a href="#vectorize-121"><span class="linenos">121</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="vectorize-122"><a href="#vectorize-122"><span class="linenos">122</span></a>    <span class="k">return</span> <span class="n">cartesian_product</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">outcome_type</span><span class="o">=</span><span class="n">Vector</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the Cartesian product of the arguments as <code><a href="#Vector">Vector</a></code>s or a <code><a href="#Population">Population</a></code> thereof.</p>

<p>For example:</p>

<ul>
<li><code>vectorize(1, 2)</code> would produce <code>Vector(1, 2)</code>.</li>
<li><code>vectorize(d6, 0)</code> would produce a <code><a href="#Die">Die</a></code> with outcomes <code>Vector(1, 0)</code>,
<code>Vector(2, 0)</code>, ... <code>Vector(6, 0)</code>.</li>
<li><code>vectorize(d6, d6)</code> would produce a <code><a href="#Die">Die</a></code> with outcomes <code>Vector(1, 1)</code>,
<code>Vector(1, 2)</code>, ... <code>Vector(6, 5)</code>, <code>Vector(6, 6)</code>.</li>
</ul>

<p>If <code><a href="#Population">Population</a></code>s are provided, they must all be <code><a href="#Die">Die</a></code> or all <code><a href="#Deck">Deck</a></code> and not
a mixture of the two.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>If none of the outcomes is a <code><a href="#Population">Population</a></code>, the result is a <code><a href="#Vector">Vector</a></code>
  with one element per argument. Otherwise, the result is a <code><a href="#Population">Population</a></code>
  of the same type as the input <code><a href="#Population">Population</a></code>, and the outcomes are
  <code><a href="#Vector">Vector</a></code>s with one element per argument.</p>
</blockquote>
</div>


                </section>
                <section id="Vector">
                            <input id="Vector-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Vector</span><wbr>(<span class="base"><a href="#Outcome">icepool.Outcome</a></span>, <span class="base">typing.Sequence[+T_co]</span>):

                <label class="view-source-button" for="Vector-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector-125"><a href="#Vector-125"><span class="linenos">125</span></a><span class="k">class</span> <span class="nc">Vector</span><span class="p">(</span><span class="n">Outcome</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T_co</span><span class="p">]):</span>
</span><span id="Vector-126"><a href="#Vector-126"><span class="linenos">126</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Immutable tuple-like class that applies most operators elementwise.</span>
</span><span id="Vector-127"><a href="#Vector-127"><span class="linenos">127</span></a>
</span><span id="Vector-128"><a href="#Vector-128"><span class="linenos">128</span></a><span class="sd">    May become a variadic generic type in the future.</span>
</span><span id="Vector-129"><a href="#Vector-129"><span class="linenos">129</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Vector-130"><a href="#Vector-130"><span class="linenos">130</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;_data&#39;</span><span class="p">]</span>
</span><span id="Vector-131"><a href="#Vector-131"><span class="linenos">131</span></a>
</span><span id="Vector-132"><a href="#Vector-132"><span class="linenos">132</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="Vector-133"><a href="#Vector-133"><span class="linenos">133</span></a>
</span><span id="Vector-134"><a href="#Vector-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vector-135"><a href="#Vector-135"><span class="linenos">135</span></a>                 <span class="n">elements</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">],</span>
</span><span id="Vector-136"><a href="#Vector-136"><span class="linenos">136</span></a>                 <span class="o">*</span><span class="p">,</span>
</span><span id="Vector-137"><a href="#Vector-137"><span class="linenos">137</span></a>                 <span class="n">truth_value</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vector-138"><a href="#Vector-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span><span id="Vector-139"><a href="#Vector-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">):</span>
</span><span id="Vector-140"><a href="#Vector-140"><span class="linenos">140</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Again is not a valid element of Vector.&#39;</span><span class="p">)</span>
</span><span id="Vector-141"><a href="#Vector-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_truth_value</span> <span class="o">=</span> <span class="n">truth_value</span>
</span><span id="Vector-142"><a href="#Vector-142"><span class="linenos">142</span></a>
</span><span id="Vector-143"><a href="#Vector-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vector-144"><a href="#Vector-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="n">Vector</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span>
</span><span id="Vector-145"><a href="#Vector-145"><span class="linenos">145</span></a>
</span><span id="Vector-146"><a href="#Vector-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Vector-147"><a href="#Vector-147"><span class="linenos">147</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Vector-148"><a href="#Vector-148"><span class="linenos">148</span></a>
</span><span id="Vector-149"><a href="#Vector-149"><span class="linenos">149</span></a>    <span class="nd">@overload</span>
</span><span id="Vector-150"><a href="#Vector-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_co</span><span class="p">:</span>
</span><span id="Vector-151"><a href="#Vector-151"><span class="linenos">151</span></a>        <span class="o">...</span>
</span><span id="Vector-152"><a href="#Vector-152"><span class="linenos">152</span></a>
</span><span id="Vector-153"><a href="#Vector-153"><span class="linenos">153</span></a>    <span class="nd">@overload</span>
</span><span id="Vector-154"><a href="#Vector-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[T_co]&#39;</span><span class="p">:</span>
</span><span id="Vector-155"><a href="#Vector-155"><span class="linenos">155</span></a>        <span class="o">...</span>
</span><span id="Vector-156"><a href="#Vector-156"><span class="linenos">156</span></a>
</span><span id="Vector-157"><a href="#Vector-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;T_co | Vector[T_co]&#39;</span><span class="p">:</span>
</span><span id="Vector-158"><a href="#Vector-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Vector-159"><a href="#Vector-159"><span class="linenos">159</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Vector-160"><a href="#Vector-160"><span class="linenos">160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vector-161"><a href="#Vector-161"><span class="linenos">161</span></a>            <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
</span><span id="Vector-162"><a href="#Vector-162"><span class="linenos">162</span></a>
</span><span id="Vector-163"><a href="#Vector-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Vector-164"><a href="#Vector-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Vector-165"><a href="#Vector-165"><span class="linenos">165</span></a>
</span><span id="Vector-166"><a href="#Vector-166"><span class="linenos">166</span></a>    <span class="c1"># Unary operators.</span>
</span><span id="Vector-167"><a href="#Vector-167"><span class="linenos">167</span></a>
</span><span id="Vector-168"><a href="#Vector-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">unary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Vector-169"><a href="#Vector-169"><span class="linenos">169</span></a>                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[U]&#39;</span><span class="p">:</span>
</span><span id="Vector-170"><a href="#Vector-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unary operators on `Vector` are applied elementwise.</span>
</span><span id="Vector-171"><a href="#Vector-171"><span class="linenos">171</span></a>
</span><span id="Vector-172"><a href="#Vector-172"><span class="linenos">172</span></a><span class="sd">        This is used for the standard unary operators</span>
</span><span id="Vector-173"><a href="#Vector-173"><span class="linenos">173</span></a><span class="sd">        `-, +, abs, ~, round, trunc, floor, ceil`</span>
</span><span id="Vector-174"><a href="#Vector-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vector-175"><a href="#Vector-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Vector-176"><a href="#Vector-176"><span class="linenos">176</span></a>
</span><span id="Vector-177"><a href="#Vector-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[T_co]&#39;</span><span class="p">:</span>
</span><span id="Vector-178"><a href="#Vector-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">)</span>
</span><span id="Vector-179"><a href="#Vector-179"><span class="linenos">179</span></a>
</span><span id="Vector-180"><a href="#Vector-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[T_co]&#39;</span><span class="p">:</span>
</span><span id="Vector-181"><a href="#Vector-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</span><span id="Vector-182"><a href="#Vector-182"><span class="linenos">182</span></a>
</span><span id="Vector-183"><a href="#Vector-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[T_co]&#39;</span><span class="p">:</span>
</span><span id="Vector-184"><a href="#Vector-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">invert</span><span class="p">)</span>
</span><span id="Vector-185"><a href="#Vector-185"><span class="linenos">185</span></a>
</span><span id="Vector-186"><a href="#Vector-186"><span class="linenos">186</span></a>    <span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[T_co]&#39;</span><span class="p">:</span>
</span><span id="Vector-187"><a href="#Vector-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</span><span id="Vector-188"><a href="#Vector-188"><span class="linenos">188</span></a>
</span><span id="Vector-189"><a href="#Vector-189"><span class="linenos">189</span></a>    <span class="fm">__abs__</span> <span class="o">=</span> <span class="nb">abs</span>
</span><span id="Vector-190"><a href="#Vector-190"><span class="linenos">190</span></a>
</span><span id="Vector-191"><a href="#Vector-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-192"><a href="#Vector-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>
</span><span id="Vector-193"><a href="#Vector-193"><span class="linenos">193</span></a>
</span><span id="Vector-194"><a href="#Vector-194"><span class="linenos">194</span></a>    <span class="fm">__round__</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="Vector-195"><a href="#Vector-195"><span class="linenos">195</span></a>
</span><span id="Vector-196"><a href="#Vector-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-197"><a href="#Vector-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">)</span>
</span><span id="Vector-198"><a href="#Vector-198"><span class="linenos">198</span></a>
</span><span id="Vector-199"><a href="#Vector-199"><span class="linenos">199</span></a>    <span class="n">__trunc__</span> <span class="o">=</span> <span class="n">trunc</span>
</span><span id="Vector-200"><a href="#Vector-200"><span class="linenos">200</span></a>
</span><span id="Vector-201"><a href="#Vector-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">floor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-202"><a href="#Vector-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
</span><span id="Vector-203"><a href="#Vector-203"><span class="linenos">203</span></a>
</span><span id="Vector-204"><a href="#Vector-204"><span class="linenos">204</span></a>    <span class="n">__floor__</span> <span class="o">=</span> <span class="n">floor</span>
</span><span id="Vector-205"><a href="#Vector-205"><span class="linenos">205</span></a>
</span><span id="Vector-206"><a href="#Vector-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-207"><a href="#Vector-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">)</span>
</span><span id="Vector-208"><a href="#Vector-208"><span class="linenos">208</span></a>
</span><span id="Vector-209"><a href="#Vector-209"><span class="linenos">209</span></a>    <span class="n">__ceil__</span> <span class="o">=</span> <span class="n">ceil</span>
</span><span id="Vector-210"><a href="#Vector-210"><span class="linenos">210</span></a>
</span><span id="Vector-211"><a href="#Vector-211"><span class="linenos">211</span></a>    <span class="c1"># Binary operators.</span>
</span><span id="Vector-212"><a href="#Vector-212"><span class="linenos">212</span></a>
</span><span id="Vector-213"><a href="#Vector-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vector-214"><a href="#Vector-214"><span class="linenos">214</span></a>                        <span class="n">other</span><span class="p">,</span>
</span><span id="Vector-215"><a href="#Vector-215"><span class="linenos">215</span></a>                        <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span>
</span><span id="Vector-216"><a href="#Vector-216"><span class="linenos">216</span></a>                        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Vector-217"><a href="#Vector-217"><span class="linenos">217</span></a>                        <span class="n">compare_for_truth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Vector-218"><a href="#Vector-218"><span class="linenos">218</span></a>                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[U]&#39;</span><span class="p">:</span>
</span><span id="Vector-219"><a href="#Vector-219"><span class="linenos">219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Binary operators on `Vector` are applied elementwise.</span>
</span><span id="Vector-220"><a href="#Vector-220"><span class="linenos">220</span></a>
</span><span id="Vector-221"><a href="#Vector-221"><span class="linenos">221</span></a><span class="sd">        If the other operand is also a `Vector`, the operator is applied to each</span>
</span><span id="Vector-222"><a href="#Vector-222"><span class="linenos">222</span></a><span class="sd">        pair of elements from `self` and `other`. Both must have the same</span>
</span><span id="Vector-223"><a href="#Vector-223"><span class="linenos">223</span></a><span class="sd">        length.</span>
</span><span id="Vector-224"><a href="#Vector-224"><span class="linenos">224</span></a>
</span><span id="Vector-225"><a href="#Vector-225"><span class="linenos">225</span></a><span class="sd">        Otherwise the other operand is broadcast to each element of `self`.</span>
</span><span id="Vector-226"><a href="#Vector-226"><span class="linenos">226</span></a>
</span><span id="Vector-227"><a href="#Vector-227"><span class="linenos">227</span></a><span class="sd">        This is used for the standard binary operators</span>
</span><span id="Vector-228"><a href="#Vector-228"><span class="linenos">228</span></a><span class="sd">        `+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^`.</span>
</span><span id="Vector-229"><a href="#Vector-229"><span class="linenos">229</span></a>
</span><span id="Vector-230"><a href="#Vector-230"><span class="linenos">230</span></a><span class="sd">        `@` is not included due to its different meaning in `Die`.</span>
</span><span id="Vector-231"><a href="#Vector-231"><span class="linenos">231</span></a>
</span><span id="Vector-232"><a href="#Vector-232"><span class="linenos">232</span></a><span class="sd">        This is also used for the comparators</span>
</span><span id="Vector-233"><a href="#Vector-233"><span class="linenos">233</span></a><span class="sd">        `&lt;, &lt;=, &gt;, &gt;=, ==, !=`.</span>
</span><span id="Vector-234"><a href="#Vector-234"><span class="linenos">234</span></a>
</span><span id="Vector-235"><a href="#Vector-235"><span class="linenos">235</span></a><span class="sd">        In this case, the result also has a truth value based on lexicographic</span>
</span><span id="Vector-236"><a href="#Vector-236"><span class="linenos">236</span></a><span class="sd">        ordering.</span>
</span><span id="Vector-237"><a href="#Vector-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vector-238"><a href="#Vector-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Vector-239"><a href="#Vector-239"><span class="linenos">239</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Vector-240"><a href="#Vector-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-241"><a href="#Vector-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="Vector-242"><a href="#Vector-242"><span class="linenos">242</span></a>                <span class="k">if</span> <span class="n">compare_for_truth</span><span class="p">:</span>
</span><span id="Vector-243"><a href="#Vector-243"><span class="linenos">243</span></a>                    <span class="n">truth_value</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span>
</span><span id="Vector-244"><a href="#Vector-244"><span class="linenos">244</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Vector-245"><a href="#Vector-245"><span class="linenos">245</span></a>                    <span class="n">truth_value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vector-246"><a href="#Vector-246"><span class="linenos">246</span></a>                <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span>
</span><span id="Vector-247"><a href="#Vector-247"><span class="linenos">247</span></a>                    <span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)),</span>
</span><span id="Vector-248"><a href="#Vector-248"><span class="linenos">248</span></a>                    <span class="n">truth_value</span><span class="o">=</span><span class="n">truth_value</span><span class="p">)</span>
</span><span id="Vector-249"><a href="#Vector-249"><span class="linenos">249</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Vector-250"><a href="#Vector-250"><span class="linenos">250</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Vector-251"><a href="#Vector-251"><span class="linenos">251</span></a>                    <span class="sa">f</span><span class="s1">&#39;Binary operators on Vectors are only valid if both are the same length (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> vs. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s1">).&#39;</span>
</span><span id="Vector-252"><a href="#Vector-252"><span class="linenos">252</span></a>                <span class="p">)</span>
</span><span id="Vector-253"><a href="#Vector-253"><span class="linenos">253</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vector-254"><a href="#Vector-254"><span class="linenos">254</span></a>            <span class="k">return</span> <span class="n">Vector</span><span class="p">((</span><span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
</span><span id="Vector-255"><a href="#Vector-255"><span class="linenos">255</span></a>
</span><span id="Vector-256"><a href="#Vector-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">reverse_binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Vector-257"><a href="#Vector-257"><span class="linenos">257</span></a>                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[U]&#39;</span><span class="p">:</span>
</span><span id="Vector-258"><a href="#Vector-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reverse version of `binary_operator()`.&quot;&quot;&quot;</span>
</span><span id="Vector-259"><a href="#Vector-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Vector-260"><a href="#Vector-260"><span class="linenos">260</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Vector-261"><a href="#Vector-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-262"><a href="#Vector-262"><span class="linenos">262</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="Vector-263"><a href="#Vector-263"><span class="linenos">263</span></a>                <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span>
</span><span id="Vector-264"><a href="#Vector-264"><span class="linenos">264</span></a>                    <span class="n">op</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="Vector-265"><a href="#Vector-265"><span class="linenos">265</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Vector-266"><a href="#Vector-266"><span class="linenos">266</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Vector-267"><a href="#Vector-267"><span class="linenos">267</span></a>                    <span class="sa">f</span><span class="s1">&#39;Binary operators on Vectors are only valid if both are the same length (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s1"> vs. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">).&#39;</span>
</span><span id="Vector-268"><a href="#Vector-268"><span class="linenos">268</span></a>                <span class="p">)</span>
</span><span id="Vector-269"><a href="#Vector-269"><span class="linenos">269</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vector-270"><a href="#Vector-270"><span class="linenos">270</span></a>            <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Vector-271"><a href="#Vector-271"><span class="linenos">271</span></a>
</span><span id="Vector-272"><a href="#Vector-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-273"><a href="#Vector-273"><span class="linenos">273</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="Vector-274"><a href="#Vector-274"><span class="linenos">274</span></a>
</span><span id="Vector-275"><a href="#Vector-275"><span class="linenos">275</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-276"><a href="#Vector-276"><span class="linenos">276</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="Vector-277"><a href="#Vector-277"><span class="linenos">277</span></a>
</span><span id="Vector-278"><a href="#Vector-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-279"><a href="#Vector-279"><span class="linenos">279</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Vector-280"><a href="#Vector-280"><span class="linenos">280</span></a>
</span><span id="Vector-281"><a href="#Vector-281"><span class="linenos">281</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-282"><a href="#Vector-282"><span class="linenos">282</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Vector-283"><a href="#Vector-283"><span class="linenos">283</span></a>
</span><span id="Vector-284"><a href="#Vector-284"><span class="linenos">284</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-285"><a href="#Vector-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>
</span><span id="Vector-286"><a href="#Vector-286"><span class="linenos">286</span></a>
</span><span id="Vector-287"><a href="#Vector-287"><span class="linenos">287</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-288"><a href="#Vector-288"><span class="linenos">288</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>
</span><span id="Vector-289"><a href="#Vector-289"><span class="linenos">289</span></a>
</span><span id="Vector-290"><a href="#Vector-290"><span class="linenos">290</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-291"><a href="#Vector-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>
</span><span id="Vector-292"><a href="#Vector-292"><span class="linenos">292</span></a>
</span><span id="Vector-293"><a href="#Vector-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-294"><a href="#Vector-294"><span class="linenos">294</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>
</span><span id="Vector-295"><a href="#Vector-295"><span class="linenos">295</span></a>
</span><span id="Vector-296"><a href="#Vector-296"><span class="linenos">296</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-297"><a href="#Vector-297"><span class="linenos">297</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">)</span>
</span><span id="Vector-298"><a href="#Vector-298"><span class="linenos">298</span></a>
</span><span id="Vector-299"><a href="#Vector-299"><span class="linenos">299</span></a>    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-300"><a href="#Vector-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">)</span>
</span><span id="Vector-301"><a href="#Vector-301"><span class="linenos">301</span></a>
</span><span id="Vector-302"><a href="#Vector-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-303"><a href="#Vector-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="Vector-304"><a href="#Vector-304"><span class="linenos">304</span></a>
</span><span id="Vector-305"><a href="#Vector-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-306"><a href="#Vector-306"><span class="linenos">306</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="Vector-307"><a href="#Vector-307"><span class="linenos">307</span></a>
</span><span id="Vector-308"><a href="#Vector-308"><span class="linenos">308</span></a>    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-309"><a href="#Vector-309"><span class="linenos">309</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">)</span>
</span><span id="Vector-310"><a href="#Vector-310"><span class="linenos">310</span></a>
</span><span id="Vector-311"><a href="#Vector-311"><span class="linenos">311</span></a>    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-312"><a href="#Vector-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">)</span>
</span><span id="Vector-313"><a href="#Vector-313"><span class="linenos">313</span></a>
</span><span id="Vector-314"><a href="#Vector-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-315"><a href="#Vector-315"><span class="linenos">315</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">)</span>
</span><span id="Vector-316"><a href="#Vector-316"><span class="linenos">316</span></a>
</span><span id="Vector-317"><a href="#Vector-317"><span class="linenos">317</span></a>    <span class="k">def</span> <span class="fm">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-318"><a href="#Vector-318"><span class="linenos">318</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">)</span>
</span><span id="Vector-319"><a href="#Vector-319"><span class="linenos">319</span></a>
</span><span id="Vector-320"><a href="#Vector-320"><span class="linenos">320</span></a>    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-321"><a href="#Vector-321"><span class="linenos">321</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">)</span>
</span><span id="Vector-322"><a href="#Vector-322"><span class="linenos">322</span></a>
</span><span id="Vector-323"><a href="#Vector-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="fm">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-324"><a href="#Vector-324"><span class="linenos">324</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">)</span>
</span><span id="Vector-325"><a href="#Vector-325"><span class="linenos">325</span></a>
</span><span id="Vector-326"><a href="#Vector-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-327"><a href="#Vector-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">)</span>
</span><span id="Vector-328"><a href="#Vector-328"><span class="linenos">328</span></a>
</span><span id="Vector-329"><a href="#Vector-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-330"><a href="#Vector-330"><span class="linenos">330</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">)</span>
</span><span id="Vector-331"><a href="#Vector-331"><span class="linenos">331</span></a>
</span><span id="Vector-332"><a href="#Vector-332"><span class="linenos">332</span></a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-333"><a href="#Vector-333"><span class="linenos">333</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">)</span>
</span><span id="Vector-334"><a href="#Vector-334"><span class="linenos">334</span></a>
</span><span id="Vector-335"><a href="#Vector-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-336"><a href="#Vector-336"><span class="linenos">336</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">)</span>
</span><span id="Vector-337"><a href="#Vector-337"><span class="linenos">337</span></a>
</span><span id="Vector-338"><a href="#Vector-338"><span class="linenos">338</span></a>    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-339"><a href="#Vector-339"><span class="linenos">339</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">)</span>
</span><span id="Vector-340"><a href="#Vector-340"><span class="linenos">340</span></a>
</span><span id="Vector-341"><a href="#Vector-341"><span class="linenos">341</span></a>    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-342"><a href="#Vector-342"><span class="linenos">342</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reverse_binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">)</span>
</span><span id="Vector-343"><a href="#Vector-343"><span class="linenos">343</span></a>
</span><span id="Vector-344"><a href="#Vector-344"><span class="linenos">344</span></a>    <span class="c1"># Comparators.</span>
</span><span id="Vector-345"><a href="#Vector-345"><span class="linenos">345</span></a>    <span class="c1"># These returns a value with a truth value, but not a bool.</span>
</span><span id="Vector-346"><a href="#Vector-346"><span class="linenos">346</span></a>
</span><span id="Vector-347"><a href="#Vector-347"><span class="linenos">347</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Vector-348"><a href="#Vector-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-349"><a href="#Vector-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Vector-350"><a href="#Vector-350"><span class="linenos">350</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span> <span class="n">compare_for_truth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vector-351"><a href="#Vector-351"><span class="linenos">351</span></a>
</span><span id="Vector-352"><a href="#Vector-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Vector-353"><a href="#Vector-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-354"><a href="#Vector-354"><span class="linenos">354</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Vector-355"><a href="#Vector-355"><span class="linenos">355</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span> <span class="n">compare_for_truth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vector-356"><a href="#Vector-356"><span class="linenos">356</span></a>
</span><span id="Vector-357"><a href="#Vector-357"><span class="linenos">357</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Vector-358"><a href="#Vector-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-359"><a href="#Vector-359"><span class="linenos">359</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Vector-360"><a href="#Vector-360"><span class="linenos">360</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">gt</span><span class="p">,</span> <span class="n">compare_for_truth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vector-361"><a href="#Vector-361"><span class="linenos">361</span></a>
</span><span id="Vector-362"><a href="#Vector-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Vector-363"><a href="#Vector-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-364"><a href="#Vector-364"><span class="linenos">364</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Vector-365"><a href="#Vector-365"><span class="linenos">365</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ge</span><span class="p">,</span> <span class="n">compare_for_truth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vector-366"><a href="#Vector-366"><span class="linenos">366</span></a>
</span><span id="Vector-367"><a href="#Vector-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector | bool&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Vector-368"><a href="#Vector-368"><span class="linenos">368</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-369"><a href="#Vector-369"><span class="linenos">369</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Vector-370"><a href="#Vector-370"><span class="linenos">370</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">eq</span><span class="p">,</span> <span class="n">compare_for_truth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vector-371"><a href="#Vector-371"><span class="linenos">371</span></a>
</span><span id="Vector-372"><a href="#Vector-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector | bool&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Vector-373"><a href="#Vector-373"><span class="linenos">373</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector-374"><a href="#Vector-374"><span class="linenos">374</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Vector-375"><a href="#Vector-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_operator</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">ne</span><span class="p">,</span> <span class="n">compare_for_truth</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Vector-376"><a href="#Vector-376"><span class="linenos">376</span></a>
</span><span id="Vector-377"><a href="#Vector-377"><span class="linenos">377</span></a>    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Vector-378"><a href="#Vector-378"><span class="linenos">378</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truth_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Vector-379"><a href="#Vector-379"><span class="linenos">379</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="Vector-380"><a href="#Vector-380"><span class="linenos">380</span></a>                <span class="s1">&#39;Vector only has a truth value if it is the result of a comparison operator.&#39;</span>
</span><span id="Vector-381"><a href="#Vector-381"><span class="linenos">381</span></a>            <span class="p">)</span>
</span><span id="Vector-382"><a href="#Vector-382"><span class="linenos">382</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_truth_value</span>
</span><span id="Vector-383"><a href="#Vector-383"><span class="linenos">383</span></a>
</span><span id="Vector-384"><a href="#Vector-384"><span class="linenos">384</span></a>    <span class="c1"># Sequence manipulation.</span>
</span><span id="Vector-385"><a href="#Vector-385"><span class="linenos">385</span></a>
</span><span id="Vector-386"><a href="#Vector-386"><span class="linenos">386</span></a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-387"><a href="#Vector-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">+</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">))</span>
</span><span id="Vector-388"><a href="#Vector-388"><span class="linenos">388</span></a>
</span><span id="Vector-389"><a href="#Vector-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Iterable&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector-390"><a href="#Vector-390"><span class="linenos">390</span></a>        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="Vector-391"><a href="#Vector-391"><span class="linenos">391</span></a>
</span><span id="Vector-392"><a href="#Vector-392"><span class="linenos">392</span></a>    <span class="c1"># Strings.</span>
</span><span id="Vector-393"><a href="#Vector-393"><span class="linenos">393</span></a>
</span><span id="Vector-394"><a href="#Vector-394"><span class="linenos">394</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vector-395"><a href="#Vector-395"><span class="linenos">395</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span><span id="Vector-396"><a href="#Vector-396"><span class="linenos">396</span></a>
</span><span id="Vector-397"><a href="#Vector-397"><span class="linenos">397</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Vector-398"><a href="#Vector-398"><span class="linenos">398</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Immutable tuple-like class that applies most operators elementwise.</p>

<p>May become a variadic generic type in the future.</p>
</div>


                            <div id="Vector.unary_operator" class="classattr">
                                        <input id="Vector.unary_operator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unary_operator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Vector.unary_operator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.unary_operator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.unary_operator-168"><a href="#Vector.unary_operator-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">unary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Vector.unary_operator-169"><a href="#Vector.unary_operator-169"><span class="linenos">169</span></a>                       <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[U]&#39;</span><span class="p">:</span>
</span><span id="Vector.unary_operator-170"><a href="#Vector.unary_operator-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Unary operators on `Vector` are applied elementwise.</span>
</span><span id="Vector.unary_operator-171"><a href="#Vector.unary_operator-171"><span class="linenos">171</span></a>
</span><span id="Vector.unary_operator-172"><a href="#Vector.unary_operator-172"><span class="linenos">172</span></a><span class="sd">        This is used for the standard unary operators</span>
</span><span id="Vector.unary_operator-173"><a href="#Vector.unary_operator-173"><span class="linenos">173</span></a><span class="sd">        `-, +, abs, ~, round, trunc, floor, ceil`</span>
</span><span id="Vector.unary_operator-174"><a href="#Vector.unary_operator-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vector.unary_operator-175"><a href="#Vector.unary_operator-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Unary operators on <code><a href="#Vector">Vector</a></code> are applied elementwise.</p>

<p>This is used for the standard unary operators
<code>-, +, abs, ~, round, trunc, floor, ceil</code></p>
</div>


                            </div>
                            <div id="Vector.abs" class="classattr">
                                        <input id="Vector.abs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">abs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Vector.abs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.abs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.abs-186"><a href="#Vector.abs-186"><span class="linenos">186</span></a>    <span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[T_co]&#39;</span><span class="p">:</span>
</span><span id="Vector.abs-187"><a href="#Vector.abs-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vector.round" class="classattr">
                                        <input id="Vector.round-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">round</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span>:</span></span>

                <label class="view-source-button" for="Vector.round-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.round"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.round-191"><a href="#Vector.round-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector.round-192"><a href="#Vector.round-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vector.trunc" class="classattr">
                                        <input id="Vector.trunc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trunc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span>:</span></span>

                <label class="view-source-button" for="Vector.trunc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.trunc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.trunc-196"><a href="#Vector.trunc-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector.trunc-197"><a href="#Vector.trunc-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vector.floor" class="classattr">
                                        <input id="Vector.floor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">floor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span>:</span></span>

                <label class="view-source-button" for="Vector.floor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.floor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.floor-201"><a href="#Vector.floor-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">floor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector.floor-202"><a href="#Vector.floor-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vector.ceil" class="classattr">
                                        <input id="Vector.ceil-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ceil</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span>:</span></span>

                <label class="view-source-button" for="Vector.ceil-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.ceil"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.ceil-206"><a href="#Vector.ceil-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector.ceil-207"><a href="#Vector.ceil-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_operator</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Vector.binary_operator" class="classattr">
                                        <input id="Vector.binary_operator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">binary_operator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span>,</span><span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="n">compare_for_truth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Vector.binary_operator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.binary_operator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.binary_operator-213"><a href="#Vector.binary_operator-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Vector.binary_operator-214"><a href="#Vector.binary_operator-214"><span class="linenos">214</span></a>                        <span class="n">other</span><span class="p">,</span>
</span><span id="Vector.binary_operator-215"><a href="#Vector.binary_operator-215"><span class="linenos">215</span></a>                        <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span>
</span><span id="Vector.binary_operator-216"><a href="#Vector.binary_operator-216"><span class="linenos">216</span></a>                        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Vector.binary_operator-217"><a href="#Vector.binary_operator-217"><span class="linenos">217</span></a>                        <span class="n">compare_for_truth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Vector.binary_operator-218"><a href="#Vector.binary_operator-218"><span class="linenos">218</span></a>                        <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[U]&#39;</span><span class="p">:</span>
</span><span id="Vector.binary_operator-219"><a href="#Vector.binary_operator-219"><span class="linenos">219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Binary operators on `Vector` are applied elementwise.</span>
</span><span id="Vector.binary_operator-220"><a href="#Vector.binary_operator-220"><span class="linenos">220</span></a>
</span><span id="Vector.binary_operator-221"><a href="#Vector.binary_operator-221"><span class="linenos">221</span></a><span class="sd">        If the other operand is also a `Vector`, the operator is applied to each</span>
</span><span id="Vector.binary_operator-222"><a href="#Vector.binary_operator-222"><span class="linenos">222</span></a><span class="sd">        pair of elements from `self` and `other`. Both must have the same</span>
</span><span id="Vector.binary_operator-223"><a href="#Vector.binary_operator-223"><span class="linenos">223</span></a><span class="sd">        length.</span>
</span><span id="Vector.binary_operator-224"><a href="#Vector.binary_operator-224"><span class="linenos">224</span></a>
</span><span id="Vector.binary_operator-225"><a href="#Vector.binary_operator-225"><span class="linenos">225</span></a><span class="sd">        Otherwise the other operand is broadcast to each element of `self`.</span>
</span><span id="Vector.binary_operator-226"><a href="#Vector.binary_operator-226"><span class="linenos">226</span></a>
</span><span id="Vector.binary_operator-227"><a href="#Vector.binary_operator-227"><span class="linenos">227</span></a><span class="sd">        This is used for the standard binary operators</span>
</span><span id="Vector.binary_operator-228"><a href="#Vector.binary_operator-228"><span class="linenos">228</span></a><span class="sd">        `+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^`.</span>
</span><span id="Vector.binary_operator-229"><a href="#Vector.binary_operator-229"><span class="linenos">229</span></a>
</span><span id="Vector.binary_operator-230"><a href="#Vector.binary_operator-230"><span class="linenos">230</span></a><span class="sd">        `@` is not included due to its different meaning in `Die`.</span>
</span><span id="Vector.binary_operator-231"><a href="#Vector.binary_operator-231"><span class="linenos">231</span></a>
</span><span id="Vector.binary_operator-232"><a href="#Vector.binary_operator-232"><span class="linenos">232</span></a><span class="sd">        This is also used for the comparators</span>
</span><span id="Vector.binary_operator-233"><a href="#Vector.binary_operator-233"><span class="linenos">233</span></a><span class="sd">        `&lt;, &lt;=, &gt;, &gt;=, ==, !=`.</span>
</span><span id="Vector.binary_operator-234"><a href="#Vector.binary_operator-234"><span class="linenos">234</span></a>
</span><span id="Vector.binary_operator-235"><a href="#Vector.binary_operator-235"><span class="linenos">235</span></a><span class="sd">        In this case, the result also has a truth value based on lexicographic</span>
</span><span id="Vector.binary_operator-236"><a href="#Vector.binary_operator-236"><span class="linenos">236</span></a><span class="sd">        ordering.</span>
</span><span id="Vector.binary_operator-237"><a href="#Vector.binary_operator-237"><span class="linenos">237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Vector.binary_operator-238"><a href="#Vector.binary_operator-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Vector.binary_operator-239"><a href="#Vector.binary_operator-239"><span class="linenos">239</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Vector.binary_operator-240"><a href="#Vector.binary_operator-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector.binary_operator-241"><a href="#Vector.binary_operator-241"><span class="linenos">241</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="Vector.binary_operator-242"><a href="#Vector.binary_operator-242"><span class="linenos">242</span></a>                <span class="k">if</span> <span class="n">compare_for_truth</span><span class="p">:</span>
</span><span id="Vector.binary_operator-243"><a href="#Vector.binary_operator-243"><span class="linenos">243</span></a>                    <span class="n">truth_value</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">op</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span>
</span><span id="Vector.binary_operator-244"><a href="#Vector.binary_operator-244"><span class="linenos">244</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Vector.binary_operator-245"><a href="#Vector.binary_operator-245"><span class="linenos">245</span></a>                    <span class="n">truth_value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Vector.binary_operator-246"><a href="#Vector.binary_operator-246"><span class="linenos">246</span></a>                <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span>
</span><span id="Vector.binary_operator-247"><a href="#Vector.binary_operator-247"><span class="linenos">247</span></a>                    <span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)),</span>
</span><span id="Vector.binary_operator-248"><a href="#Vector.binary_operator-248"><span class="linenos">248</span></a>                    <span class="n">truth_value</span><span class="o">=</span><span class="n">truth_value</span><span class="p">)</span>
</span><span id="Vector.binary_operator-249"><a href="#Vector.binary_operator-249"><span class="linenos">249</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Vector.binary_operator-250"><a href="#Vector.binary_operator-250"><span class="linenos">250</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Vector.binary_operator-251"><a href="#Vector.binary_operator-251"><span class="linenos">251</span></a>                    <span class="sa">f</span><span class="s1">&#39;Binary operators on Vectors are only valid if both are the same length (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1"> vs. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s1">).&#39;</span>
</span><span id="Vector.binary_operator-252"><a href="#Vector.binary_operator-252"><span class="linenos">252</span></a>                <span class="p">)</span>
</span><span id="Vector.binary_operator-253"><a href="#Vector.binary_operator-253"><span class="linenos">253</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vector.binary_operator-254"><a href="#Vector.binary_operator-254"><span class="linenos">254</span></a>            <span class="k">return</span> <span class="n">Vector</span><span class="p">((</span><span class="n">op</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Binary operators on <code><a href="#Vector">Vector</a></code> are applied elementwise.</p>

<p>If the other operand is also a <code><a href="#Vector">Vector</a></code>, the operator is applied to each
pair of elements from <code>self</code> and <code>other</code>. Both must have the same
length.</p>

<p>Otherwise the other operand is broadcast to each element of <code>self</code>.</p>

<p>This is used for the standard binary operators
<code>+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^</code>.</p>

<p><code>@</code> is not included due to its different meaning in <code><a href="#Die">Die</a></code>.</p>

<p>This is also used for the comparators
<code>&lt;, &lt;=, &gt;, &gt;=, ==, !=</code>.</p>

<p>In this case, the result also has a truth value based on lexicographic
ordering.</p>
</div>


                            </div>
                            <div id="Vector.reverse_binary_operator" class="classattr">
                                        <input id="Vector.reverse_binary_operator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reverse_binary_operator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span>,</span><span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Vector.reverse_binary_operator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.reverse_binary_operator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.reverse_binary_operator-256"><a href="#Vector.reverse_binary_operator-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">reverse_binary_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">U</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="Vector.reverse_binary_operator-257"><a href="#Vector.reverse_binary_operator-257"><span class="linenos">257</span></a>                                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector[U]&#39;</span><span class="p">:</span>
</span><span id="Vector.reverse_binary_operator-258"><a href="#Vector.reverse_binary_operator-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Reverse version of `binary_operator()`.&quot;&quot;&quot;</span>
</span><span id="Vector.reverse_binary_operator-259"><a href="#Vector.reverse_binary_operator-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Vector.reverse_binary_operator-260"><a href="#Vector.reverse_binary_operator-260"><span class="linenos">260</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Vector.reverse_binary_operator-261"><a href="#Vector.reverse_binary_operator-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Vector</span><span class="p">):</span>
</span><span id="Vector.reverse_binary_operator-262"><a href="#Vector.reverse_binary_operator-262"><span class="linenos">262</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
</span><span id="Vector.reverse_binary_operator-263"><a href="#Vector.reverse_binary_operator-263"><span class="linenos">263</span></a>                <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span>
</span><span id="Vector.reverse_binary_operator-264"><a href="#Vector.reverse_binary_operator-264"><span class="linenos">264</span></a>                    <span class="n">op</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="Vector.reverse_binary_operator-265"><a href="#Vector.reverse_binary_operator-265"><span class="linenos">265</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Vector.reverse_binary_operator-266"><a href="#Vector.reverse_binary_operator-266"><span class="linenos">266</span></a>                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span>
</span><span id="Vector.reverse_binary_operator-267"><a href="#Vector.reverse_binary_operator-267"><span class="linenos">267</span></a>                    <span class="sa">f</span><span class="s1">&#39;Binary operators on Vectors are only valid if both are the same length (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s1"> vs. </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s1">).&#39;</span>
</span><span id="Vector.reverse_binary_operator-268"><a href="#Vector.reverse_binary_operator-268"><span class="linenos">268</span></a>                <span class="p">)</span>
</span><span id="Vector.reverse_binary_operator-269"><a href="#Vector.reverse_binary_operator-269"><span class="linenos">269</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Vector.reverse_binary_operator-270"><a href="#Vector.reverse_binary_operator-270"><span class="linenos">270</span></a>            <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reverse version of <code><a href="#Vector.binary_operator">binary_operator()</a></code>.</p>
</div>


                            </div>
                            <div id="Vector.append" class="classattr">
                                        <input id="Vector.append-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">append</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span>:</span></span>

                <label class="view-source-button" for="Vector.append-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.append"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.append-386"><a href="#Vector.append-386"><span class="linenos">386</span></a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector.append-387"><a href="#Vector.append-387"><span class="linenos">387</span></a>        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">+</span> <span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Vector.concatenate" class="classattr">
                                        <input id="Vector.concatenate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">concatenate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span></span><span class="return-annotation">) -> <span class="n"><a href="#Vector">Vector</a></span>:</span></span>

                <label class="view-source-button" for="Vector.concatenate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Vector.concatenate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Vector.concatenate-389"><a href="#Vector.concatenate-389"><span class="linenos">389</span></a>    <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Iterable&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Vector&#39;</span><span class="p">:</span>
</span><span id="Vector.concatenate-390"><a href="#Vector.concatenate-390"><span class="linenos">390</span></a>        <span class="k">return</span> <span class="n">Vector</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Outcome">Outcome</a></dt>
                                <dd id="Vector.__init__" class="function"><a href="icepool/typing.html#Outcome.__init__">Outcome</a></dd>

            </div>
            <div><dt>collections.abc.Sequence</dt>
                                <dd id="Vector.index" class="function">index</dd>
                <dd id="Vector.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Symbols">
                            <input id="Symbols-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Symbols</span><wbr>(<span class="base">typing.Mapping[str, int]</span>):

                <label class="view-source-button" for="Symbols-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols-16"><a href="#Symbols-16"><span class="linenos"> 16</span></a><span class="k">class</span> <span class="nc">Symbols</span><span class="p">(</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
</span><span id="Symbols-17"><a href="#Symbols-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Immutable multiset of single characters.</span>
</span><span id="Symbols-18"><a href="#Symbols-18"><span class="linenos"> 18</span></a>
</span><span id="Symbols-19"><a href="#Symbols-19"><span class="linenos"> 19</span></a><span class="sd">    Spaces, dashes, and underscores cannot be used as symbols.</span>
</span><span id="Symbols-20"><a href="#Symbols-20"><span class="linenos"> 20</span></a>
</span><span id="Symbols-21"><a href="#Symbols-21"><span class="linenos"> 21</span></a><span class="sd">    Operations include:</span>
</span><span id="Symbols-22"><a href="#Symbols-22"><span class="linenos"> 22</span></a>
</span><span id="Symbols-23"><a href="#Symbols-23"><span class="linenos"> 23</span></a><span class="sd">    | Operation                   | Count / notes                      |</span>
</span><span id="Symbols-24"><a href="#Symbols-24"><span class="linenos"> 24</span></a><span class="sd">    |:----------------------------|:-----------------------------------|</span>
</span><span id="Symbols-25"><a href="#Symbols-25"><span class="linenos"> 25</span></a><span class="sd">    | `additive_union`, `+`       | `l + r`                            |</span>
</span><span id="Symbols-26"><a href="#Symbols-26"><span class="linenos"> 26</span></a><span class="sd">    | `difference`, `-`           | `l - r`                            |</span>
</span><span id="Symbols-27"><a href="#Symbols-27"><span class="linenos"> 27</span></a><span class="sd">    | `intersection`, `&amp;`         | `min(l, r)`                        |</span>
</span><span id="Symbols-28"><a href="#Symbols-28"><span class="linenos"> 28</span></a><span class="sd">    | `union`, `\\|`               | `max(l, r)`                        |</span>
</span><span id="Symbols-29"><a href="#Symbols-29"><span class="linenos"> 29</span></a><span class="sd">    | `symmetric_difference`, `^` | `abs(l - r)`                       |</span>
</span><span id="Symbols-30"><a href="#Symbols-30"><span class="linenos"> 30</span></a><span class="sd">    | `multiply_counts`, `*`      | `count * n`                        |</span>
</span><span id="Symbols-31"><a href="#Symbols-31"><span class="linenos"> 31</span></a><span class="sd">    | `divide_counts`, `//`       | `count // n`                       |</span>
</span><span id="Symbols-32"><a href="#Symbols-32"><span class="linenos"> 32</span></a><span class="sd">    | `issubset`, `&lt;=`            | all counts l &lt;= r                  |</span>
</span><span id="Symbols-33"><a href="#Symbols-33"><span class="linenos"> 33</span></a><span class="sd">    | `issuperset`, `&gt;=`          | all counts l &gt;= r                  |</span>
</span><span id="Symbols-34"><a href="#Symbols-34"><span class="linenos"> 34</span></a><span class="sd">    | `==`                        | all counts l == r                  |</span>
</span><span id="Symbols-35"><a href="#Symbols-35"><span class="linenos"> 35</span></a><span class="sd">    | `!=`                        | any count l != r                   |</span>
</span><span id="Symbols-36"><a href="#Symbols-36"><span class="linenos"> 36</span></a><span class="sd">    | unary `+`                   | drop all negative counts           |</span>
</span><span id="Symbols-37"><a href="#Symbols-37"><span class="linenos"> 37</span></a><span class="sd">    | unary `-`                   | reverses the sign of all counts    |</span>
</span><span id="Symbols-38"><a href="#Symbols-38"><span class="linenos"> 38</span></a>
</span><span id="Symbols-39"><a href="#Symbols-39"><span class="linenos"> 39</span></a><span class="sd">    `&lt;` and `&gt;` are lexicographic orderings rather than subset relations.</span>
</span><span id="Symbols-40"><a href="#Symbols-40"><span class="linenos"> 40</span></a><span class="sd">    Specifically, they compare the count of each character in alphabetical</span>
</span><span id="Symbols-41"><a href="#Symbols-41"><span class="linenos"> 41</span></a><span class="sd">    order. For example:</span>
</span><span id="Symbols-42"><a href="#Symbols-42"><span class="linenos"> 42</span></a><span class="sd">    * `&#39;a&#39; &gt; &#39;&#39;` since one `&#39;a&#39;` is more than zero `&#39;a&#39;`s.</span>
</span><span id="Symbols-43"><a href="#Symbols-43"><span class="linenos"> 43</span></a><span class="sd">    * `&#39;a&#39; &gt; &#39;bb&#39;` since `&#39;a&#39;` is compared first.</span>
</span><span id="Symbols-44"><a href="#Symbols-44"><span class="linenos"> 44</span></a><span class="sd">    * `&#39;-a&#39; &lt; &#39;bb&#39;` since the left side has -1 `&#39;a&#39;`s.</span>
</span><span id="Symbols-45"><a href="#Symbols-45"><span class="linenos"> 45</span></a><span class="sd">    * `&#39;a&#39; &lt; &#39;ab&#39;` since the `&#39;a&#39;`s are equal but the right side has more `&#39;b&#39;`s.</span>
</span><span id="Symbols-46"><a href="#Symbols-46"><span class="linenos"> 46</span></a><span class="sd">    </span>
</span><span id="Symbols-47"><a href="#Symbols-47"><span class="linenos"> 47</span></a><span class="sd">    Binary operators other than `*` and `//` implicitly convert the other</span>
</span><span id="Symbols-48"><a href="#Symbols-48"><span class="linenos"> 48</span></a><span class="sd">    argument to `Symbols` using the constructor.</span>
</span><span id="Symbols-49"><a href="#Symbols-49"><span class="linenos"> 49</span></a>
</span><span id="Symbols-50"><a href="#Symbols-50"><span class="linenos"> 50</span></a><span class="sd">    Subscripting with a single character returns the count of that character</span>
</span><span id="Symbols-51"><a href="#Symbols-51"><span class="linenos"> 51</span></a><span class="sd">    as an `int`. E.g. `symbols[&#39;a&#39;]` -&gt; number of `a`s as an `int`.</span>
</span><span id="Symbols-52"><a href="#Symbols-52"><span class="linenos"> 52</span></a><span class="sd">    You can also access it as an attribute, e.g.  `symbols.a`.</span>
</span><span id="Symbols-53"><a href="#Symbols-53"><span class="linenos"> 53</span></a>
</span><span id="Symbols-54"><a href="#Symbols-54"><span class="linenos"> 54</span></a><span class="sd">    Subscripting with multiple characters returns a `Symbols` with only those</span>
</span><span id="Symbols-55"><a href="#Symbols-55"><span class="linenos"> 55</span></a><span class="sd">    characters, dropping the rest.</span>
</span><span id="Symbols-56"><a href="#Symbols-56"><span class="linenos"> 56</span></a><span class="sd">    E.g. `symbols[&#39;ab&#39;]` -&gt; number of `a`s and `b`s as a `Symbols`.</span>
</span><span id="Symbols-57"><a href="#Symbols-57"><span class="linenos"> 57</span></a><span class="sd">    Again you can also access it as an attribute, e.g. `symbols.ab`.</span>
</span><span id="Symbols-58"><a href="#Symbols-58"><span class="linenos"> 58</span></a><span class="sd">    This is useful for reducing the outcome space, which reduces computational</span>
</span><span id="Symbols-59"><a href="#Symbols-59"><span class="linenos"> 59</span></a><span class="sd">    cost for further operations. If you want to keep only a single character</span>
</span><span id="Symbols-60"><a href="#Symbols-60"><span class="linenos"> 60</span></a><span class="sd">    while keeping the type as `Symbols`, you can subscript with that character</span>
</span><span id="Symbols-61"><a href="#Symbols-61"><span class="linenos"> 61</span></a><span class="sd">    plus an unused character.</span>
</span><span id="Symbols-62"><a href="#Symbols-62"><span class="linenos"> 62</span></a>
</span><span id="Symbols-63"><a href="#Symbols-63"><span class="linenos"> 63</span></a><span class="sd">    Subscripting with duplicate characters currently has no further effect, but</span>
</span><span id="Symbols-64"><a href="#Symbols-64"><span class="linenos"> 64</span></a><span class="sd">    this may change in the future.</span>
</span><span id="Symbols-65"><a href="#Symbols-65"><span class="linenos"> 65</span></a>
</span><span id="Symbols-66"><a href="#Symbols-66"><span class="linenos"> 66</span></a><span class="sd">    `Population.marginals` forwards attribute access, so you can use e.g.</span>
</span><span id="Symbols-67"><a href="#Symbols-67"><span class="linenos"> 67</span></a><span class="sd">    `die.marginals.a` to get the marginal distribution of `a`s.</span>
</span><span id="Symbols-68"><a href="#Symbols-68"><span class="linenos"> 68</span></a>
</span><span id="Symbols-69"><a href="#Symbols-69"><span class="linenos"> 69</span></a><span class="sd">    Note that attribute access only works with valid identifiers,</span>
</span><span id="Symbols-70"><a href="#Symbols-70"><span class="linenos"> 70</span></a><span class="sd">    so e.g. emojis would need to use the subscript method.</span>
</span><span id="Symbols-71"><a href="#Symbols-71"><span class="linenos"> 71</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Symbols-72"><a href="#Symbols-72"><span class="linenos"> 72</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="Symbols-73"><a href="#Symbols-73"><span class="linenos"> 73</span></a>
</span><span id="Symbols-74"><a href="#Symbols-74"><span class="linenos"> 74</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Symbols-75"><a href="#Symbols-75"><span class="linenos"> 75</span></a>                <span class="n">symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-76"><a href="#Symbols-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="Symbols-77"><a href="#Symbols-77"><span class="linenos"> 77</span></a><span class="sd">        </span>
</span><span id="Symbols-78"><a href="#Symbols-78"><span class="linenos"> 78</span></a><span class="sd">        The argument can be a string, an iterable of characters, or a mapping of</span>
</span><span id="Symbols-79"><a href="#Symbols-79"><span class="linenos"> 79</span></a><span class="sd">        characters to counts.</span>
</span><span id="Symbols-80"><a href="#Symbols-80"><span class="linenos"> 80</span></a><span class="sd">        </span>
</span><span id="Symbols-81"><a href="#Symbols-81"><span class="linenos"> 81</span></a><span class="sd">        If the argument is a string, negative symbols can be specified using a</span>
</span><span id="Symbols-82"><a href="#Symbols-82"><span class="linenos"> 82</span></a><span class="sd">        minus sign optionally surrounded by whitespace. For example,</span>
</span><span id="Symbols-83"><a href="#Symbols-83"><span class="linenos"> 83</span></a><span class="sd">        `a - b` has one positive a and one negative b.</span>
</span><span id="Symbols-84"><a href="#Symbols-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols-85"><a href="#Symbols-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Symbols</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Symbols-86"><a href="#Symbols-86"><span class="linenos"> 86</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Symbols-87"><a href="#Symbols-87"><span class="linenos"> 87</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Symbols-88"><a href="#Symbols-88"><span class="linenos"> 88</span></a>            <span class="n">positive</span><span class="p">,</span> <span class="o">*</span><span class="n">negative</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*-\s*&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>
</span><span id="Symbols-89"><a href="#Symbols-89"><span class="linenos"> 89</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">positive</span><span class="p">:</span>
</span><span id="Symbols-90"><a href="#Symbols-90"><span class="linenos"> 90</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Symbols-91"><a href="#Symbols-91"><span class="linenos"> 91</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negative</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Symbols-92"><a href="#Symbols-92"><span class="linenos"> 92</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Multiple dashes not allowed.&#39;</span><span class="p">)</span>
</span><span id="Symbols-93"><a href="#Symbols-93"><span class="linenos"> 93</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Symbols-94"><a href="#Symbols-94"><span class="linenos"> 94</span></a>                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">negative</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Symbols-95"><a href="#Symbols-95"><span class="linenos"> 95</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Symbols-96"><a href="#Symbols-96"><span class="linenos"> 96</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="Symbols-97"><a href="#Symbols-97"><span class="linenos"> 97</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>
</span><span id="Symbols-98"><a href="#Symbols-98"><span class="linenos"> 98</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-99"><a href="#Symbols-99"><span class="linenos"> 99</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Symbols-100"><a href="#Symbols-100"><span class="linenos">100</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
</span><span id="Symbols-101"><a href="#Symbols-101"><span class="linenos">101</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Symbols-102"><a href="#Symbols-102"><span class="linenos">102</span></a>
</span><span id="Symbols-103"><a href="#Symbols-103"><span class="linenos">103</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="Symbols-104"><a href="#Symbols-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Symbols-105"><a href="#Symbols-105"><span class="linenos">105</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Symbol </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1"> is not a single character.&#39;</span><span class="p">)</span>
</span><span id="Symbols-106"><a href="#Symbols-106"><span class="linenos">106</span></a>            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\s_-]&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="Symbols-107"><a href="#Symbols-107"><span class="linenos">107</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Symbols-108"><a href="#Symbols-108"><span class="linenos">108</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1"> (U+</span><span class="si">{</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">:</span><span class="s1">04X</span><span class="si">}</span><span class="s1">) is not a legal symbol.&#39;</span><span class="p">)</span>
</span><span id="Symbols-109"><a href="#Symbols-109"><span class="linenos">109</span></a>
</span><span id="Symbols-110"><a href="#Symbols-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span>
</span><span id="Symbols-111"><a href="#Symbols-111"><span class="linenos">111</span></a>                                 <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Symbols-112"><a href="#Symbols-112"><span class="linenos">112</span></a>                                  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())})</span>
</span><span id="Symbols-113"><a href="#Symbols-113"><span class="linenos">113</span></a>
</span><span id="Symbols-114"><a href="#Symbols-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Symbols-115"><a href="#Symbols-115"><span class="linenos">115</span></a>
</span><span id="Symbols-116"><a href="#Symbols-116"><span class="linenos">116</span></a>    <span class="nd">@classmethod</span>
</span><span id="Symbols-117"><a href="#Symbols-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">_new_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-118"><a href="#Symbols-118"><span class="linenos">118</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Symbols</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Symbols-119"><a href="#Symbols-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="Symbols-120"><a href="#Symbols-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Symbols-121"><a href="#Symbols-121"><span class="linenos">121</span></a>
</span><span id="Symbols-122"><a href="#Symbols-122"><span class="linenos">122</span></a>    <span class="c1"># Mapping interface.</span>
</span><span id="Symbols-123"><a href="#Symbols-123"><span class="linenos">123</span></a>
</span><span id="Symbols-124"><a href="#Symbols-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;int | Symbols&#39;</span><span class="p">:</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-125"><a href="#Symbols-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Symbols-126"><a href="#Symbols-126"><span class="linenos">126</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Symbols-127"><a href="#Symbols-127"><span class="linenos">127</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-128"><a href="#Symbols-128"><span class="linenos">128</span></a>            <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span>
</span><span id="Symbols-129"><a href="#Symbols-129"><span class="linenos">129</span></a>                <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
</span><span id="Symbols-130"><a href="#Symbols-130"><span class="linenos">130</span></a>                                  <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">key</span><span class="p">}))</span>
</span><span id="Symbols-131"><a href="#Symbols-131"><span class="linenos">131</span></a>
</span><span id="Symbols-132"><a href="#Symbols-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;int | Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-133"><a href="#Symbols-133"><span class="linenos">133</span></a>        <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;_&#39;</span><span class="p">:</span>
</span><span id="Symbols-134"><a href="#Symbols-134"><span class="linenos">134</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Symbols-135"><a href="#Symbols-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="Symbols-136"><a href="#Symbols-136"><span class="linenos">136</span></a>
</span><span id="Symbols-137"><a href="#Symbols-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="Symbols-138"><a href="#Symbols-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Symbols-139"><a href="#Symbols-139"><span class="linenos">139</span></a>
</span><span id="Symbols-140"><a href="#Symbols-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols-141"><a href="#Symbols-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Symbols-142"><a href="#Symbols-142"><span class="linenos">142</span></a>
</span><span id="Symbols-143"><a href="#Symbols-143"><span class="linenos">143</span></a>    <span class="c1"># Binary operators.</span>
</span><span id="Symbols-144"><a href="#Symbols-144"><span class="linenos">144</span></a>
</span><span id="Symbols-145"><a href="#Symbols-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Symbols-146"><a href="#Symbols-146"><span class="linenos">146</span></a>                       <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-147"><a href="#Symbols-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The sum of counts of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols-148"><a href="#Symbols-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Symbols-149"><a href="#Symbols-149"><span class="linenos">149</span></a>
</span><span id="Symbols-150"><a href="#Symbols-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-151"><a href="#Symbols-151"><span class="linenos">151</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-152"><a href="#Symbols-152"><span class="linenos">152</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-153"><a href="#Symbols-153"><span class="linenos">153</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Symbols-154"><a href="#Symbols-154"><span class="linenos">154</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols-155"><a href="#Symbols-155"><span class="linenos">155</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="n">count</span>
</span><span id="Symbols-156"><a href="#Symbols-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-157"><a href="#Symbols-157"><span class="linenos">157</span></a>
</span><span id="Symbols-158"><a href="#Symbols-158"><span class="linenos">158</span></a>    <span class="fm">__radd__</span> <span class="o">=</span> <span class="fm">__add__</span>
</span><span id="Symbols-159"><a href="#Symbols-159"><span class="linenos">159</span></a>
</span><span id="Symbols-160"><a href="#Symbols-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Symbols-161"><a href="#Symbols-161"><span class="linenos">161</span></a>                   <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-162"><a href="#Symbols-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The difference between the counts of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols-163"><a href="#Symbols-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Symbols-164"><a href="#Symbols-164"><span class="linenos">164</span></a>
</span><span id="Symbols-165"><a href="#Symbols-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-166"><a href="#Symbols-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-167"><a href="#Symbols-167"><span class="linenos">167</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-168"><a href="#Symbols-168"><span class="linenos">168</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Symbols-169"><a href="#Symbols-169"><span class="linenos">169</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols-170"><a href="#Symbols-170"><span class="linenos">170</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-=</span> <span class="n">count</span>
</span><span id="Symbols-171"><a href="#Symbols-171"><span class="linenos">171</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-172"><a href="#Symbols-172"><span class="linenos">172</span></a>
</span><span id="Symbols-173"><a href="#Symbols-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-174"><a href="#Symbols-174"><span class="linenos">174</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-175"><a href="#Symbols-175"><span class="linenos">175</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-176"><a href="#Symbols-176"><span class="linenos">176</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Symbols-177"><a href="#Symbols-177"><span class="linenos">177</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols-178"><a href="#Symbols-178"><span class="linenos">178</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-=</span> <span class="n">count</span>
</span><span id="Symbols-179"><a href="#Symbols-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-180"><a href="#Symbols-180"><span class="linenos">180</span></a>
</span><span id="Symbols-181"><a href="#Symbols-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Symbols-182"><a href="#Symbols-182"><span class="linenos">182</span></a>                     <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-183"><a href="#Symbols-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The min count of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols-184"><a href="#Symbols-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Symbols-185"><a href="#Symbols-185"><span class="linenos">185</span></a>
</span><span id="Symbols-186"><a href="#Symbols-186"><span class="linenos">186</span></a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-187"><a href="#Symbols-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-188"><a href="#Symbols-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-189"><a href="#Symbols-189"><span class="linenos">189</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Symbols-190"><a href="#Symbols-190"><span class="linenos">190</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols-191"><a href="#Symbols-191"><span class="linenos">191</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Symbols-192"><a href="#Symbols-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-193"><a href="#Symbols-193"><span class="linenos">193</span></a>
</span><span id="Symbols-194"><a href="#Symbols-194"><span class="linenos">194</span></a>    <span class="fm">__rand__</span> <span class="o">=</span> <span class="fm">__and__</span>
</span><span id="Symbols-195"><a href="#Symbols-195"><span class="linenos">195</span></a>
</span><span id="Symbols-196"><a href="#Symbols-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-197"><a href="#Symbols-197"><span class="linenos">197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The max count of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols-198"><a href="#Symbols-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Symbols-199"><a href="#Symbols-199"><span class="linenos">199</span></a>
</span><span id="Symbols-200"><a href="#Symbols-200"><span class="linenos">200</span></a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-201"><a href="#Symbols-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-202"><a href="#Symbols-202"><span class="linenos">202</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-203"><a href="#Symbols-203"><span class="linenos">203</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Symbols-204"><a href="#Symbols-204"><span class="linenos">204</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols-205"><a href="#Symbols-205"><span class="linenos">205</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Symbols-206"><a href="#Symbols-206"><span class="linenos">206</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-207"><a href="#Symbols-207"><span class="linenos">207</span></a>
</span><span id="Symbols-208"><a href="#Symbols-208"><span class="linenos">208</span></a>    <span class="fm">__ror__</span> <span class="o">=</span> <span class="fm">__or__</span>
</span><span id="Symbols-209"><a href="#Symbols-209"><span class="linenos">209</span></a>
</span><span id="Symbols-210"><a href="#Symbols-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="nf">symmetric_difference</span><span class="p">(</span>
</span><span id="Symbols-211"><a href="#Symbols-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-212"><a href="#Symbols-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The absolute difference in symbol counts between the two sets.&quot;&quot;&quot;</span>
</span><span id="Symbols-213"><a href="#Symbols-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">^</span> <span class="n">other</span>
</span><span id="Symbols-214"><a href="#Symbols-214"><span class="linenos">214</span></a>
</span><span id="Symbols-215"><a href="#Symbols-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-216"><a href="#Symbols-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-217"><a href="#Symbols-217"><span class="linenos">217</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-218"><a href="#Symbols-218"><span class="linenos">218</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Symbols-219"><a href="#Symbols-219"><span class="linenos">219</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols-220"><a href="#Symbols-220"><span class="linenos">220</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Symbols-221"><a href="#Symbols-221"><span class="linenos">221</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-222"><a href="#Symbols-222"><span class="linenos">222</span></a>
</span><span id="Symbols-223"><a href="#Symbols-223"><span class="linenos">223</span></a>    <span class="fm">__rxor__</span> <span class="o">=</span> <span class="fm">__xor__</span>
</span><span id="Symbols-224"><a href="#Symbols-224"><span class="linenos">224</span></a>
</span><span id="Symbols-225"><a href="#Symbols-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">multiply_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-226"><a href="#Symbols-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiplies all counts by an integer.&quot;&quot;&quot;</span>
</span><span id="Symbols-227"><a href="#Symbols-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</span><span id="Symbols-228"><a href="#Symbols-228"><span class="linenos">228</span></a>
</span><span id="Symbols-229"><a href="#Symbols-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-230"><a href="#Symbols-230"><span class="linenos">230</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Symbols-231"><a href="#Symbols-231"><span class="linenos">231</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Symbols-232"><a href="#Symbols-232"><span class="linenos">232</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span>
</span><span id="Symbols-233"><a href="#Symbols-233"><span class="linenos">233</span></a>            <span class="n">s</span><span class="p">:</span> <span class="n">count</span> <span class="o">*</span> <span class="n">other</span>
</span><span id="Symbols-234"><a href="#Symbols-234"><span class="linenos">234</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Symbols-235"><a href="#Symbols-235"><span class="linenos">235</span></a>        <span class="p">})</span>
</span><span id="Symbols-236"><a href="#Symbols-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-237"><a href="#Symbols-237"><span class="linenos">237</span></a>
</span><span id="Symbols-238"><a href="#Symbols-238"><span class="linenos">238</span></a>    <span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>
</span><span id="Symbols-239"><a href="#Symbols-239"><span class="linenos">239</span></a>
</span><span id="Symbols-240"><a href="#Symbols-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">divide_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-241"><a href="#Symbols-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divides all counts by an integer, rounding down.&quot;&quot;&quot;</span>
</span><span id="Symbols-242"><a href="#Symbols-242"><span class="linenos">242</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span>
</span><span id="Symbols-243"><a href="#Symbols-243"><span class="linenos">243</span></a>            <span class="n">s</span><span class="p">:</span> <span class="n">count</span> <span class="o">//</span> <span class="n">other</span>
</span><span id="Symbols-244"><a href="#Symbols-244"><span class="linenos">244</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Symbols-245"><a href="#Symbols-245"><span class="linenos">245</span></a>        <span class="p">})</span>
</span><span id="Symbols-246"><a href="#Symbols-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-247"><a href="#Symbols-247"><span class="linenos">247</span></a>
</span><span id="Symbols-248"><a href="#Symbols-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">count_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Symbols-249"><a href="#Symbols-249"><span class="linenos">249</span></a>                     <span class="n">divisor</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Symbols-250"><a href="#Symbols-250"><span class="linenos">250</span></a>                     <span class="o">*</span><span class="p">,</span>
</span><span id="Symbols-251"><a href="#Symbols-251"><span class="linenos">251</span></a>                     <span class="n">empty_divisor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols-252"><a href="#Symbols-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of times the divisor is contained in this multiset.&quot;&quot;&quot;</span>
</span><span id="Symbols-253"><a href="#Symbols-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">divisor</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="Symbols-254"><a href="#Symbols-254"><span class="linenos">254</span></a>            <span class="n">divisor</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">divisor</span><span class="p">)</span>
</span><span id="Symbols-255"><a href="#Symbols-255"><span class="linenos">255</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Symbols-256"><a href="#Symbols-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">divisor</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols-257"><a href="#Symbols-257"><span class="linenos">257</span></a>            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">//</span> <span class="n">count</span>
</span><span id="Symbols-258"><a href="#Symbols-258"><span class="linenos">258</span></a>            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Symbols-259"><a href="#Symbols-259"><span class="linenos">259</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">current</span>
</span><span id="Symbols-260"><a href="#Symbols-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Symbols-261"><a href="#Symbols-261"><span class="linenos">261</span></a>            <span class="k">if</span> <span class="n">empty_divisor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Symbols-262"><a href="#Symbols-262"><span class="linenos">262</span></a>                <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s1">&#39;Divisor is empty.&#39;</span><span class="p">)</span>
</span><span id="Symbols-263"><a href="#Symbols-263"><span class="linenos">263</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-264"><a href="#Symbols-264"><span class="linenos">264</span></a>                <span class="k">return</span> <span class="n">empty_divisor</span>
</span><span id="Symbols-265"><a href="#Symbols-265"><span class="linenos">265</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-266"><a href="#Symbols-266"><span class="linenos">266</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="Symbols-267"><a href="#Symbols-267"><span class="linenos">267</span></a>
</span><span id="Symbols-268"><a href="#Symbols-268"><span class="linenos">268</span></a>    <span class="nd">@overload</span>
</span><span id="Symbols-269"><a href="#Symbols-269"><span class="linenos">269</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-270"><a href="#Symbols-270"><span class="linenos">270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Same as divide_counts().&quot;&quot;&quot;</span>
</span><span id="Symbols-271"><a href="#Symbols-271"><span class="linenos">271</span></a>
</span><span id="Symbols-272"><a href="#Symbols-272"><span class="linenos">272</span></a>    <span class="nd">@overload</span>
</span><span id="Symbols-273"><a href="#Symbols-273"><span class="linenos">273</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols-274"><a href="#Symbols-274"><span class="linenos">274</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Same as count_subset().&quot;&quot;&quot;</span>
</span><span id="Symbols-275"><a href="#Symbols-275"><span class="linenos">275</span></a>
</span><span id="Symbols-276"><a href="#Symbols-276"><span class="linenos">276</span></a>    <span class="nd">@overload</span>
</span><span id="Symbols-277"><a href="#Symbols-277"><span class="linenos">277</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span>
</span><span id="Symbols-278"><a href="#Symbols-278"><span class="linenos">278</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Symbols-279"><a href="#Symbols-279"><span class="linenos">279</span></a>            <span class="n">other</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols | int&#39;</span><span class="p">:</span>
</span><span id="Symbols-280"><a href="#Symbols-280"><span class="linenos">280</span></a>        <span class="o">...</span>
</span><span id="Symbols-281"><a href="#Symbols-281"><span class="linenos">281</span></a>
</span><span id="Symbols-282"><a href="#Symbols-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span>
</span><span id="Symbols-283"><a href="#Symbols-283"><span class="linenos">283</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Symbols-284"><a href="#Symbols-284"><span class="linenos">284</span></a>            <span class="n">other</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols | int&#39;</span><span class="p">:</span>
</span><span id="Symbols-285"><a href="#Symbols-285"><span class="linenos">285</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Symbols-286"><a href="#Symbols-286"><span class="linenos">286</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">divide_counts</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols-287"><a href="#Symbols-287"><span class="linenos">287</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
</span><span id="Symbols-288"><a href="#Symbols-288"><span class="linenos">288</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_subset</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols-289"><a href="#Symbols-289"><span class="linenos">289</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-290"><a href="#Symbols-290"><span class="linenos">290</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Symbols-291"><a href="#Symbols-291"><span class="linenos">291</span></a>
</span><span id="Symbols-292"><a href="#Symbols-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols-293"><a href="#Symbols-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">count_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Symbols-294"><a href="#Symbols-294"><span class="linenos">294</span></a>
</span><span id="Symbols-295"><a href="#Symbols-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">modulo_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-296"><a href="#Symbols-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">%</span> <span class="n">other</span>
</span><span id="Symbols-297"><a href="#Symbols-297"><span class="linenos">297</span></a>
</span><span id="Symbols-298"><a href="#Symbols-298"><span class="linenos">298</span></a>    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-299"><a href="#Symbols-299"><span class="linenos">299</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Symbols-300"><a href="#Symbols-300"><span class="linenos">300</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Symbols-301"><a href="#Symbols-301"><span class="linenos">301</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span>
</span><span id="Symbols-302"><a href="#Symbols-302"><span class="linenos">302</span></a>            <span class="n">s</span><span class="p">:</span> <span class="n">count</span> <span class="o">%</span> <span class="n">other</span>
</span><span id="Symbols-303"><a href="#Symbols-303"><span class="linenos">303</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Symbols-304"><a href="#Symbols-304"><span class="linenos">304</span></a>        <span class="p">})</span>
</span><span id="Symbols-305"><a href="#Symbols-305"><span class="linenos">305</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-306"><a href="#Symbols-306"><span class="linenos">306</span></a>
</span><span id="Symbols-307"><a href="#Symbols-307"><span class="linenos">307</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-308"><a href="#Symbols-308"><span class="linenos">308</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Symbols</span><span class="p">):</span>
</span><span id="Symbols-309"><a href="#Symbols-309"><span class="linenos">309</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Symbols-310"><a href="#Symbols-310"><span class="linenos">310</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="Symbols-311"><a href="#Symbols-311"><span class="linenos">311</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Symbols-312"><a href="#Symbols-312"><span class="linenos">312</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-313"><a href="#Symbols-313"><span class="linenos">313</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Symbols-314"><a href="#Symbols-314"><span class="linenos">314</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-315"><a href="#Symbols-315"><span class="linenos">315</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Symbols-316"><a href="#Symbols-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Symbols-317"><a href="#Symbols-317"><span class="linenos">317</span></a>
</span><span id="Symbols-318"><a href="#Symbols-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-319"><a href="#Symbols-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Symbols</span><span class="p">):</span>
</span><span id="Symbols-320"><a href="#Symbols-320"><span class="linenos">320</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Symbols-321"><a href="#Symbols-321"><span class="linenos">321</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="Symbols-322"><a href="#Symbols-322"><span class="linenos">322</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Symbols-323"><a href="#Symbols-323"><span class="linenos">323</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-324"><a href="#Symbols-324"><span class="linenos">324</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Symbols-325"><a href="#Symbols-325"><span class="linenos">325</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-326"><a href="#Symbols-326"><span class="linenos">326</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Symbols-327"><a href="#Symbols-327"><span class="linenos">327</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Symbols-328"><a href="#Symbols-328"><span class="linenos">328</span></a>
</span><span id="Symbols-329"><a href="#Symbols-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">issubset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-330"><a href="#Symbols-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether `self` is a subset of the other.</span>
</span><span id="Symbols-331"><a href="#Symbols-331"><span class="linenos">331</span></a>
</span><span id="Symbols-332"><a href="#Symbols-332"><span class="linenos">332</span></a><span class="sd">        Same as `&lt;=`.</span>
</span><span id="Symbols-333"><a href="#Symbols-333"><span class="linenos">333</span></a><span class="sd">        </span>
</span><span id="Symbols-334"><a href="#Symbols-334"><span class="linenos">334</span></a><span class="sd">        Note that the `&lt;` and `&gt;` operators are lexicographic orderings,</span>
</span><span id="Symbols-335"><a href="#Symbols-335"><span class="linenos">335</span></a><span class="sd">        not proper subset relations.</span>
</span><span id="Symbols-336"><a href="#Symbols-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols-337"><a href="#Symbols-337"><span class="linenos">337</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span>
</span><span id="Symbols-338"><a href="#Symbols-338"><span class="linenos">338</span></a>
</span><span id="Symbols-339"><a href="#Symbols-339"><span class="linenos">339</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-340"><a href="#Symbols-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-341"><a href="#Symbols-341"><span class="linenos">341</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-342"><a href="#Symbols-342"><span class="linenos">342</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols-343"><a href="#Symbols-343"><span class="linenos">343</span></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-344"><a href="#Symbols-344"><span class="linenos">344</span></a>                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="Symbols-345"><a href="#Symbols-345"><span class="linenos">345</span></a>
</span><span id="Symbols-346"><a href="#Symbols-346"><span class="linenos">346</span></a>    <span class="k">def</span> <span class="nf">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-347"><a href="#Symbols-347"><span class="linenos">347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether `self` is a superset of the other.</span>
</span><span id="Symbols-348"><a href="#Symbols-348"><span class="linenos">348</span></a>
</span><span id="Symbols-349"><a href="#Symbols-349"><span class="linenos">349</span></a><span class="sd">        Same as `&gt;=`.</span>
</span><span id="Symbols-350"><a href="#Symbols-350"><span class="linenos">350</span></a><span class="sd">        </span>
</span><span id="Symbols-351"><a href="#Symbols-351"><span class="linenos">351</span></a><span class="sd">        Note that the `&lt;` and `&gt;` operators are lexicographic orderings,</span>
</span><span id="Symbols-352"><a href="#Symbols-352"><span class="linenos">352</span></a><span class="sd">        not proper subset relations.</span>
</span><span id="Symbols-353"><a href="#Symbols-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols-354"><a href="#Symbols-354"><span class="linenos">354</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span>
</span><span id="Symbols-355"><a href="#Symbols-355"><span class="linenos">355</span></a>
</span><span id="Symbols-356"><a href="#Symbols-356"><span class="linenos">356</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-357"><a href="#Symbols-357"><span class="linenos">357</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-358"><a href="#Symbols-358"><span class="linenos">358</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-359"><a href="#Symbols-359"><span class="linenos">359</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols-360"><a href="#Symbols-360"><span class="linenos">360</span></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-361"><a href="#Symbols-361"><span class="linenos">361</span></a>                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="Symbols-362"><a href="#Symbols-362"><span class="linenos">362</span></a>
</span><span id="Symbols-363"><a href="#Symbols-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-364"><a href="#Symbols-364"><span class="linenos">364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether `self` has any positive elements in common with the other.</span>
</span><span id="Symbols-365"><a href="#Symbols-365"><span class="linenos">365</span></a><span class="sd">        </span>
</span><span id="Symbols-366"><a href="#Symbols-366"><span class="linenos">366</span></a><span class="sd">        Raises:</span>
</span><span id="Symbols-367"><a href="#Symbols-367"><span class="linenos">367</span></a><span class="sd">            ValueError if either has negative elements.</span>
</span><span id="Symbols-368"><a href="#Symbols-368"><span class="linenos">368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols-369"><a href="#Symbols-369"><span class="linenos">369</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols-370"><a href="#Symbols-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_negative_counts</span><span class="p">()</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">has_negative_counts</span><span class="p">():</span>
</span><span id="Symbols-371"><a href="#Symbols-371"><span class="linenos">371</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Symbols-372"><a href="#Symbols-372"><span class="linenos">372</span></a>                <span class="s2">&quot;isdisjoint() is not defined for negative counts.&quot;</span><span class="p">)</span>
</span><span id="Symbols-373"><a href="#Symbols-373"><span class="linenos">373</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">other</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-374"><a href="#Symbols-374"><span class="linenos">374</span></a>                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Symbols-375"><a href="#Symbols-375"><span class="linenos">375</span></a>
</span><span id="Symbols-376"><a href="#Symbols-376"><span class="linenos">376</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-377"><a href="#Symbols-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-378"><a href="#Symbols-378"><span class="linenos">378</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-379"><a href="#Symbols-379"><span class="linenos">379</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Symbols-380"><a href="#Symbols-380"><span class="linenos">380</span></a>            <span class="n">other</span> <span class="o">=</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols-381"><a href="#Symbols-381"><span class="linenos">381</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Symbols-382"><a href="#Symbols-382"><span class="linenos">382</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Symbols-383"><a href="#Symbols-383"><span class="linenos">383</span></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-384"><a href="#Symbols-384"><span class="linenos">384</span></a>                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="Symbols-385"><a href="#Symbols-385"><span class="linenos">385</span></a>
</span><span id="Symbols-386"><a href="#Symbols-386"><span class="linenos">386</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-387"><a href="#Symbols-387"><span class="linenos">387</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">)):</span>
</span><span id="Symbols-388"><a href="#Symbols-388"><span class="linenos">388</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>  <span class="c1"># delegate to the other</span>
</span><span id="Symbols-389"><a href="#Symbols-389"><span class="linenos">389</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Symbols-390"><a href="#Symbols-390"><span class="linenos">390</span></a>            <span class="n">other</span> <span class="o">=</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols-391"><a href="#Symbols-391"><span class="linenos">391</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="Symbols-392"><a href="#Symbols-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Symbols-393"><a href="#Symbols-393"><span class="linenos">393</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">!=</span> <span class="n">other</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols-394"><a href="#Symbols-394"><span class="linenos">394</span></a>                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="Symbols-395"><a href="#Symbols-395"><span class="linenos">395</span></a>
</span><span id="Symbols-396"><a href="#Symbols-396"><span class="linenos">396</span></a>    <span class="c1"># Unary operators.</span>
</span><span id="Symbols-397"><a href="#Symbols-397"><span class="linenos">397</span></a>
</span><span id="Symbols-398"><a href="#Symbols-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">has_negative_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols-399"><a href="#Symbols-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether any counts are negative.&quot;&quot;&quot;</span>
</span><span id="Symbols-400"><a href="#Symbols-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Symbols-401"><a href="#Symbols-401"><span class="linenos">401</span></a>
</span><span id="Symbols-402"><a href="#Symbols-402"><span class="linenos">402</span></a>    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-403"><a href="#Symbols-403"><span class="linenos">403</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span>
</span><span id="Symbols-404"><a href="#Symbols-404"><span class="linenos">404</span></a>            <span class="n">s</span><span class="p">:</span> <span class="n">count</span>
</span><span id="Symbols-405"><a href="#Symbols-405"><span class="linenos">405</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Symbols-406"><a href="#Symbols-406"><span class="linenos">406</span></a>        <span class="p">})</span>
</span><span id="Symbols-407"><a href="#Symbols-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-408"><a href="#Symbols-408"><span class="linenos">408</span></a>
</span><span id="Symbols-409"><a href="#Symbols-409"><span class="linenos">409</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols-410"><a href="#Symbols-410"><span class="linenos">410</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="o">-</span><span class="n">count</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</span><span id="Symbols-411"><a href="#Symbols-411"><span class="linenos">411</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Symbols-412"><a href="#Symbols-412"><span class="linenos">412</span></a>
</span><span id="Symbols-413"><a href="#Symbols-413"><span class="linenos">413</span></a>    <span class="nd">@cached_property</span>
</span><span id="Symbols-414"><a href="#Symbols-414"><span class="linenos">414</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols-415"><a href="#Symbols-415"><span class="linenos">415</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="n">Symbols</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)))</span>
</span><span id="Symbols-416"><a href="#Symbols-416"><span class="linenos">416</span></a>
</span><span id="Symbols-417"><a href="#Symbols-417"><span class="linenos">417</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols-418"><a href="#Symbols-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="Symbols-419"><a href="#Symbols-419"><span class="linenos">419</span></a>
</span><span id="Symbols-420"><a href="#Symbols-420"><span class="linenos">420</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols-421"><a href="#Symbols-421"><span class="linenos">421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total number of elements.&quot;&quot;&quot;</span>
</span><span id="Symbols-422"><a href="#Symbols-422"><span class="linenos">422</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Symbols-423"><a href="#Symbols-423"><span class="linenos">423</span></a>
</span><span id="Symbols-424"><a href="#Symbols-424"><span class="linenos">424</span></a>    <span class="nd">@cached_property</span>
</span><span id="Symbols-425"><a href="#Symbols-425"><span class="linenos">425</span></a>    <span class="k">def</span> <span class="nf">_str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Symbols-426"><a href="#Symbols-426"><span class="linenos">426</span></a>        <span class="n">sorted_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Symbols-427"><a href="#Symbols-427"><span class="linenos">427</span></a>        <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sorted_keys</span>
</span><span id="Symbols-428"><a href="#Symbols-428"><span class="linenos">428</span></a>                           <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Symbols-429"><a href="#Symbols-429"><span class="linenos">429</span></a>        <span class="n">negative</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sorted_keys</span>
</span><span id="Symbols-430"><a href="#Symbols-430"><span class="linenos">430</span></a>                           <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Symbols-431"><a href="#Symbols-431"><span class="linenos">431</span></a>        <span class="k">if</span> <span class="n">positive</span><span class="p">:</span>
</span><span id="Symbols-432"><a href="#Symbols-432"><span class="linenos">432</span></a>            <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
</span><span id="Symbols-433"><a href="#Symbols-433"><span class="linenos">433</span></a>                <span class="k">return</span> <span class="n">positive</span> <span class="o">+</span> <span class="s1">&#39; - &#39;</span> <span class="o">+</span> <span class="n">negative</span>
</span><span id="Symbols-434"><a href="#Symbols-434"><span class="linenos">434</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-435"><a href="#Symbols-435"><span class="linenos">435</span></a>                <span class="k">return</span> <span class="n">positive</span>
</span><span id="Symbols-436"><a href="#Symbols-436"><span class="linenos">436</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-437"><a href="#Symbols-437"><span class="linenos">437</span></a>            <span class="k">if</span> <span class="n">negative</span><span class="p">:</span>
</span><span id="Symbols-438"><a href="#Symbols-438"><span class="linenos">438</span></a>                <span class="k">return</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">negative</span>
</span><span id="Symbols-439"><a href="#Symbols-439"><span class="linenos">439</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols-440"><a href="#Symbols-440"><span class="linenos">440</span></a>                <span class="k">return</span> <span class="s1">&#39;&#39;</span>
</span><span id="Symbols-441"><a href="#Symbols-441"><span class="linenos">441</span></a>
</span><span id="Symbols-442"><a href="#Symbols-442"><span class="linenos">442</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Symbols-443"><a href="#Symbols-443"><span class="linenos">443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All symbols in unary form (i.e. including duplicates) in ascending order.</span>
</span><span id="Symbols-444"><a href="#Symbols-444"><span class="linenos">444</span></a>
</span><span id="Symbols-445"><a href="#Symbols-445"><span class="linenos">445</span></a><span class="sd">        If there are negative elements, they are listed following a ` - ` sign.</span>
</span><span id="Symbols-446"><a href="#Symbols-446"><span class="linenos">446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols-447"><a href="#Symbols-447"><span class="linenos">447</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_str</span>
</span><span id="Symbols-448"><a href="#Symbols-448"><span class="linenos">448</span></a>
</span><span id="Symbols-449"><a href="#Symbols-449"><span class="linenos">449</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Symbols-450"><a href="#Symbols-450"><span class="linenos">450</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;(&#39;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;)&quot;</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Immutable multiset of single characters.</p>

<p>Spaces, dashes, and underscores cannot be used as symbols.</p>

<p>Operations include:</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Operation</th>
  <th style="text-align:left;">Count / notes</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.additive_union">additive_union</a></code>, <code>+</code></td>
  <td style="text-align:left;"><code>l + r</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.difference">difference</a></code>, <code>-</code></td>
  <td style="text-align:left;"><code>l - r</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.intersection">intersection</a></code>, <code>&amp;</code></td>
  <td style="text-align:left;"><code>min(l, r)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.union">union</a></code>, <code>|</code></td>
  <td style="text-align:left;"><code>max(l, r)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.symmetric_difference">symmetric_difference</a></code>, <code>^</code></td>
  <td style="text-align:left;"><code>abs(l - r)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.multiply_counts">multiply_counts</a></code>, <code>*</code></td>
  <td style="text-align:left;"><code>count * n</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.divide_counts">divide_counts</a></code>, <code>//</code></td>
  <td style="text-align:left;"><code>count // n</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.issubset">issubset</a></code>, <code>&lt;=</code></td>
  <td style="text-align:left;">all counts l &lt;= r</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#Symbols.issuperset">issuperset</a></code>, <code>&gt;=</code></td>
  <td style="text-align:left;">all counts l &gt;= r</td>
</tr>
<tr>
  <td style="text-align:left;"><code>==</code></td>
  <td style="text-align:left;">all counts l == r</td>
</tr>
<tr>
  <td style="text-align:left;"><code>!=</code></td>
  <td style="text-align:left;">any count l != r</td>
</tr>
<tr>
  <td style="text-align:left;">unary <code>+</code></td>
  <td style="text-align:left;">drop all negative counts</td>
</tr>
<tr>
  <td style="text-align:left;">unary <code>-</code></td>
  <td style="text-align:left;">reverses the sign of all counts</td>
</tr>
</tbody>
</table>

<p><code>&lt;</code> and <code>&gt;</code> are lexicographic orderings rather than subset relations.
Specifically, they compare the count of each character in alphabetical
order. For example:</p>

<ul>
<li><code>'a' &gt; ''</code> since one <code>'a'</code> is more than zero <code>'a'</code>s.</li>
<li><code>'a' &gt; 'bb'</code> since <code>'a'</code> is compared first.</li>
<li><code>'-a' &lt; 'bb'</code> since the left side has -1 <code>'a'</code>s.</li>
<li><code>'a' &lt; 'ab'</code> since the <code>'a'</code>s are equal but the right side has more <code>'b'</code>s.</li>
</ul>

<p>Binary operators other than <code>*</code> and <code>//</code> implicitly convert the other
argument to <code><a href="#Symbols">Symbols</a></code> using the constructor.</p>

<p>Subscripting with a single character returns the count of that character
as an <code>int</code>. E.g. <code>symbols['a']</code> -> number of <code>a</code>s as an <code>int</code>.
You can also access it as an attribute, e.g.  <code>symbols.a</code>.</p>

<p>Subscripting with multiple characters returns a <code><a href="#Symbols">Symbols</a></code> with only those
characters, dropping the rest.
E.g. <code>symbols['ab']</code> -> number of <code>a</code>s and <code>b</code>s as a <code><a href="#Symbols">Symbols</a></code>.
Again you can also access it as an attribute, e.g. <code>symbols.ab</code>.
This is useful for reducing the outcome space, which reduces computational
cost for further operations. If you want to keep only a single character
while keeping the type as <code><a href="#Symbols">Symbols</a></code>, you can subscript with that character
plus an unused character.</p>

<p>Subscripting with duplicate characters currently has no further effect, but
this may change in the future.</p>

<p><code><a href="#Population.marginals">Population.marginals</a></code> forwards attribute access, so you can use e.g.
<code>die.marginals.a</code> to get the marginal distribution of <code>a</code>s.</p>

<p>Note that attribute access only works with valid identifiers,
so e.g. emojis would need to use the subscript method.</p>
</div>


                            <div id="Symbols.__init__" class="classattr">
                                        <input id="Symbols.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Symbols</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">symbols</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span>)</span>

                <label class="view-source-button" for="Symbols.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.__init__-74"><a href="#Symbols.__init__-74"><span class="linenos"> 74</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Symbols.__init__-75"><a href="#Symbols.__init__-75"><span class="linenos"> 75</span></a>                <span class="n">symbols</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.__init__-76"><a href="#Symbols.__init__-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="Symbols.__init__-77"><a href="#Symbols.__init__-77"><span class="linenos"> 77</span></a><span class="sd">        </span>
</span><span id="Symbols.__init__-78"><a href="#Symbols.__init__-78"><span class="linenos"> 78</span></a><span class="sd">        The argument can be a string, an iterable of characters, or a mapping of</span>
</span><span id="Symbols.__init__-79"><a href="#Symbols.__init__-79"><span class="linenos"> 79</span></a><span class="sd">        characters to counts.</span>
</span><span id="Symbols.__init__-80"><a href="#Symbols.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        </span>
</span><span id="Symbols.__init__-81"><a href="#Symbols.__init__-81"><span class="linenos"> 81</span></a><span class="sd">        If the argument is a string, negative symbols can be specified using a</span>
</span><span id="Symbols.__init__-82"><a href="#Symbols.__init__-82"><span class="linenos"> 82</span></a><span class="sd">        minus sign optionally surrounded by whitespace. For example,</span>
</span><span id="Symbols.__init__-83"><a href="#Symbols.__init__-83"><span class="linenos"> 83</span></a><span class="sd">        `a - b` has one positive a and one negative b.</span>
</span><span id="Symbols.__init__-84"><a href="#Symbols.__init__-84"><span class="linenos"> 84</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols.__init__-85"><a href="#Symbols.__init__-85"><span class="linenos"> 85</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Symbols</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Symbols.__init__-86"><a href="#Symbols.__init__-86"><span class="linenos"> 86</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Symbols.__init__-87"><a href="#Symbols.__init__-87"><span class="linenos"> 87</span></a>            <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Symbols.__init__-88"><a href="#Symbols.__init__-88"><span class="linenos"> 88</span></a>            <span class="n">positive</span><span class="p">,</span> <span class="o">*</span><span class="n">negative</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\s*-\s*&#39;</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>
</span><span id="Symbols.__init__-89"><a href="#Symbols.__init__-89"><span class="linenos"> 89</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">positive</span><span class="p">:</span>
</span><span id="Symbols.__init__-90"><a href="#Symbols.__init__-90"><span class="linenos"> 90</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Symbols.__init__-91"><a href="#Symbols.__init__-91"><span class="linenos"> 91</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negative</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Symbols.__init__-92"><a href="#Symbols.__init__-92"><span class="linenos"> 92</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Multiple dashes not allowed.&#39;</span><span class="p">)</span>
</span><span id="Symbols.__init__-93"><a href="#Symbols.__init__-93"><span class="linenos"> 93</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">negative</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Symbols.__init__-94"><a href="#Symbols.__init__-94"><span class="linenos"> 94</span></a>                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">negative</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Symbols.__init__-95"><a href="#Symbols.__init__-95"><span class="linenos"> 95</span></a>                    <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Symbols.__init__-96"><a href="#Symbols.__init__-96"><span class="linenos"> 96</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="Symbols.__init__-97"><a href="#Symbols.__init__-97"><span class="linenos"> 97</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">symbols</span><span class="p">)</span>
</span><span id="Symbols.__init__-98"><a href="#Symbols.__init__-98"><span class="linenos"> 98</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols.__init__-99"><a href="#Symbols.__init__-99"><span class="linenos"> 99</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Symbols.__init__-100"><a href="#Symbols.__init__-100"><span class="linenos">100</span></a>            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">:</span>
</span><span id="Symbols.__init__-101"><a href="#Symbols.__init__-101"><span class="linenos">101</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Symbols.__init__-102"><a href="#Symbols.__init__-102"><span class="linenos">102</span></a>
</span><span id="Symbols.__init__-103"><a href="#Symbols.__init__-103"><span class="linenos">103</span></a>        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="Symbols.__init__-104"><a href="#Symbols.__init__-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Symbols.__init__-105"><a href="#Symbols.__init__-105"><span class="linenos">105</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Symbol </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1"> is not a single character.&#39;</span><span class="p">)</span>
</span><span id="Symbols.__init__-106"><a href="#Symbols.__init__-106"><span class="linenos">106</span></a>            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[\s_-]&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
</span><span id="Symbols.__init__-107"><a href="#Symbols.__init__-107"><span class="linenos">107</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Symbols.__init__-108"><a href="#Symbols.__init__-108"><span class="linenos">108</span></a>                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1"> (U+</span><span class="si">{</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">:</span><span class="s1">04X</span><span class="si">}</span><span class="s1">) is not a legal symbol.&#39;</span><span class="p">)</span>
</span><span id="Symbols.__init__-109"><a href="#Symbols.__init__-109"><span class="linenos">109</span></a>
</span><span id="Symbols.__init__-110"><a href="#Symbols.__init__-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span>
</span><span id="Symbols.__init__-111"><a href="#Symbols.__init__-111"><span class="linenos">111</span></a>                                 <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="Symbols.__init__-112"><a href="#Symbols.__init__-112"><span class="linenos">112</span></a>                                  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())})</span>
</span><span id="Symbols.__init__-113"><a href="#Symbols.__init__-113"><span class="linenos">113</span></a>
</span><span id="Symbols.__init__-114"><a href="#Symbols.__init__-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Constructor.</p>

<p>The argument can be a string, an iterable of characters, or a mapping of
characters to counts.</p>

<p>If the argument is a string, negative symbols can be specified using a
minus sign optionally surrounded by whitespace. For example,
<code>a - b</code> has one positive a and one negative b.</p>
</div>


                            </div>
                            <div id="Symbols.additive_union" class="classattr">
                                        <input id="Symbols.additive_union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">additive_union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.additive_union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.additive_union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.additive_union-145"><a href="#Symbols.additive_union-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Symbols.additive_union-146"><a href="#Symbols.additive_union-146"><span class="linenos">146</span></a>                       <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.additive_union-147"><a href="#Symbols.additive_union-147"><span class="linenos">147</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The sum of counts of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols.additive_union-148"><a href="#Symbols.additive_union-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The sum of counts of each symbol.</p>
</div>


                            </div>
                            <div id="Symbols.difference" class="classattr">
                                        <input id="Symbols.difference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">difference</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.difference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.difference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.difference-160"><a href="#Symbols.difference-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Symbols.difference-161"><a href="#Symbols.difference-161"><span class="linenos">161</span></a>                   <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.difference-162"><a href="#Symbols.difference-162"><span class="linenos">162</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The difference between the counts of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols.difference-163"><a href="#Symbols.difference-163"><span class="linenos">163</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The difference between the counts of each symbol.</p>
</div>


                            </div>
                            <div id="Symbols.intersection" class="classattr">
                                        <input id="Symbols.intersection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">intersection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.intersection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.intersection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.intersection-181"><a href="#Symbols.intersection-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Symbols.intersection-182"><a href="#Symbols.intersection-182"><span class="linenos">182</span></a>                     <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.intersection-183"><a href="#Symbols.intersection-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The min count of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols.intersection-184"><a href="#Symbols.intersection-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The min count of each symbol.</p>
</div>


                            </div>
                            <div id="Symbols.union" class="classattr">
                                        <input id="Symbols.union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.union-196"><a href="#Symbols.union-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.union-197"><a href="#Symbols.union-197"><span class="linenos">197</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The max count of each symbol.&quot;&quot;&quot;</span>
</span><span id="Symbols.union-198"><a href="#Symbols.union-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The max count of each symbol.</p>
</div>


                            </div>
                            <div id="Symbols.symmetric_difference" class="classattr">
                                        <input id="Symbols.symmetric_difference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">symmetric_difference</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.symmetric_difference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.symmetric_difference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.symmetric_difference-210"><a href="#Symbols.symmetric_difference-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="nf">symmetric_difference</span><span class="p">(</span>
</span><span id="Symbols.symmetric_difference-211"><a href="#Symbols.symmetric_difference-211"><span class="linenos">211</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.symmetric_difference-212"><a href="#Symbols.symmetric_difference-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The absolute difference in symbol counts between the two sets.&quot;&quot;&quot;</span>
</span><span id="Symbols.symmetric_difference-213"><a href="#Symbols.symmetric_difference-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">^</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>The absolute difference in symbol counts between the two sets.</p>
</div>


                            </div>
                            <div id="Symbols.multiply_counts" class="classattr">
                                        <input id="Symbols.multiply_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">multiply_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.multiply_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.multiply_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.multiply_counts-225"><a href="#Symbols.multiply_counts-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">multiply_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.multiply_counts-226"><a href="#Symbols.multiply_counts-226"><span class="linenos">226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiplies all counts by an integer.&quot;&quot;&quot;</span>
</span><span id="Symbols.multiply_counts-227"><a href="#Symbols.multiply_counts-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>Multiplies all counts by an integer.</p>
</div>


                            </div>
                            <div id="Symbols.divide_counts" class="classattr">
                                        <input id="Symbols.divide_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">divide_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.divide_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.divide_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.divide_counts-240"><a href="#Symbols.divide_counts-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="nf">divide_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.divide_counts-241"><a href="#Symbols.divide_counts-241"><span class="linenos">241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divides all counts by an integer, rounding down.&quot;&quot;&quot;</span>
</span><span id="Symbols.divide_counts-242"><a href="#Symbols.divide_counts-242"><span class="linenos">242</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">{</span>
</span><span id="Symbols.divide_counts-243"><a href="#Symbols.divide_counts-243"><span class="linenos">243</span></a>            <span class="n">s</span><span class="p">:</span> <span class="n">count</span> <span class="o">//</span> <span class="n">other</span>
</span><span id="Symbols.divide_counts-244"><a href="#Symbols.divide_counts-244"><span class="linenos">244</span></a>            <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Symbols.divide_counts-245"><a href="#Symbols.divide_counts-245"><span class="linenos">245</span></a>        <span class="p">})</span>
</span><span id="Symbols.divide_counts-246"><a href="#Symbols.divide_counts-246"><span class="linenos">246</span></a>        <span class="k">return</span> <span class="n">Symbols</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Divides all counts by an integer, rounding down.</p>
</div>


                            </div>
                            <div id="Symbols.count_subset" class="classattr">
                                        <input id="Symbols.count_subset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_subset</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">divisor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">empty_divisor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Symbols.count_subset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.count_subset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.count_subset-248"><a href="#Symbols.count_subset-248"><span class="linenos">248</span></a>    <span class="k">def</span> <span class="nf">count_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Symbols.count_subset-249"><a href="#Symbols.count_subset-249"><span class="linenos">249</span></a>                     <span class="n">divisor</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Symbols.count_subset-250"><a href="#Symbols.count_subset-250"><span class="linenos">250</span></a>                     <span class="o">*</span><span class="p">,</span>
</span><span id="Symbols.count_subset-251"><a href="#Symbols.count_subset-251"><span class="linenos">251</span></a>                     <span class="n">empty_divisor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols.count_subset-252"><a href="#Symbols.count_subset-252"><span class="linenos">252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of times the divisor is contained in this multiset.&quot;&quot;&quot;</span>
</span><span id="Symbols.count_subset-253"><a href="#Symbols.count_subset-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">divisor</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="Symbols.count_subset-254"><a href="#Symbols.count_subset-254"><span class="linenos">254</span></a>            <span class="n">divisor</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">divisor</span><span class="p">)</span>
</span><span id="Symbols.count_subset-255"><a href="#Symbols.count_subset-255"><span class="linenos">255</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Symbols.count_subset-256"><a href="#Symbols.count_subset-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">divisor</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Symbols.count_subset-257"><a href="#Symbols.count_subset-257"><span class="linenos">257</span></a>            <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">//</span> <span class="n">count</span>
</span><span id="Symbols.count_subset-258"><a href="#Symbols.count_subset-258"><span class="linenos">258</span></a>            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Symbols.count_subset-259"><a href="#Symbols.count_subset-259"><span class="linenos">259</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">current</span>
</span><span id="Symbols.count_subset-260"><a href="#Symbols.count_subset-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Symbols.count_subset-261"><a href="#Symbols.count_subset-261"><span class="linenos">261</span></a>            <span class="k">if</span> <span class="n">empty_divisor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Symbols.count_subset-262"><a href="#Symbols.count_subset-262"><span class="linenos">262</span></a>                <span class="k">raise</span> <span class="ne">ZeroDivisionError</span><span class="p">(</span><span class="s1">&#39;Divisor is empty.&#39;</span><span class="p">)</span>
</span><span id="Symbols.count_subset-263"><a href="#Symbols.count_subset-263"><span class="linenos">263</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols.count_subset-264"><a href="#Symbols.count_subset-264"><span class="linenos">264</span></a>                <span class="k">return</span> <span class="n">empty_divisor</span>
</span><span id="Symbols.count_subset-265"><a href="#Symbols.count_subset-265"><span class="linenos">265</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Symbols.count_subset-266"><a href="#Symbols.count_subset-266"><span class="linenos">266</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>The number of times the divisor is contained in this multiset.</p>
</div>


                            </div>
                            <div id="Symbols.modulo_counts" class="classattr">
                                        <input id="Symbols.modulo_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modulo_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Symbols">Symbols</a></span>:</span></span>

                <label class="view-source-button" for="Symbols.modulo_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.modulo_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.modulo_counts-295"><a href="#Symbols.modulo_counts-295"><span class="linenos">295</span></a>    <span class="k">def</span> <span class="nf">modulo_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Symbols&#39;</span><span class="p">:</span>
</span><span id="Symbols.modulo_counts-296"><a href="#Symbols.modulo_counts-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">%</span> <span class="n">other</span>
</span></pre></div>


    

                            </div>
                            <div id="Symbols.issubset" class="classattr">
                                        <input id="Symbols.issubset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">issubset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Symbols.issubset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.issubset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.issubset-329"><a href="#Symbols.issubset-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">issubset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols.issubset-330"><a href="#Symbols.issubset-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether `self` is a subset of the other.</span>
</span><span id="Symbols.issubset-331"><a href="#Symbols.issubset-331"><span class="linenos">331</span></a>
</span><span id="Symbols.issubset-332"><a href="#Symbols.issubset-332"><span class="linenos">332</span></a><span class="sd">        Same as `&lt;=`.</span>
</span><span id="Symbols.issubset-333"><a href="#Symbols.issubset-333"><span class="linenos">333</span></a><span class="sd">        </span>
</span><span id="Symbols.issubset-334"><a href="#Symbols.issubset-334"><span class="linenos">334</span></a><span class="sd">        Note that the `&lt;` and `&gt;` operators are lexicographic orderings,</span>
</span><span id="Symbols.issubset-335"><a href="#Symbols.issubset-335"><span class="linenos">335</span></a><span class="sd">        not proper subset relations.</span>
</span><span id="Symbols.issubset-336"><a href="#Symbols.issubset-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols.issubset-337"><a href="#Symbols.issubset-337"><span class="linenos">337</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">&lt;=</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>Whether <code>self</code> is a subset of the other.</p>

<p>Same as <code>&lt;=</code>.</p>

<p>Note that the <code>&lt;</code> and <code>&gt;</code> operators are lexicographic orderings,
not proper subset relations.</p>
</div>


                            </div>
                            <div id="Symbols.issuperset" class="classattr">
                                        <input id="Symbols.issuperset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">issuperset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Symbols.issuperset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.issuperset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.issuperset-346"><a href="#Symbols.issuperset-346"><span class="linenos">346</span></a>    <span class="k">def</span> <span class="nf">issuperset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols.issuperset-347"><a href="#Symbols.issuperset-347"><span class="linenos">347</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether `self` is a superset of the other.</span>
</span><span id="Symbols.issuperset-348"><a href="#Symbols.issuperset-348"><span class="linenos">348</span></a>
</span><span id="Symbols.issuperset-349"><a href="#Symbols.issuperset-349"><span class="linenos">349</span></a><span class="sd">        Same as `&gt;=`.</span>
</span><span id="Symbols.issuperset-350"><a href="#Symbols.issuperset-350"><span class="linenos">350</span></a><span class="sd">        </span>
</span><span id="Symbols.issuperset-351"><a href="#Symbols.issuperset-351"><span class="linenos">351</span></a><span class="sd">        Note that the `&lt;` and `&gt;` operators are lexicographic orderings,</span>
</span><span id="Symbols.issuperset-352"><a href="#Symbols.issuperset-352"><span class="linenos">352</span></a><span class="sd">        not proper subset relations.</span>
</span><span id="Symbols.issuperset-353"><a href="#Symbols.issuperset-353"><span class="linenos">353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols.issuperset-354"><a href="#Symbols.issuperset-354"><span class="linenos">354</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">&gt;=</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>Whether <code>self</code> is a superset of the other.</p>

<p>Same as <code>&gt;=</code>.</p>

<p>Note that the <code>&lt;</code> and <code>&gt;</code> operators are lexicographic orderings,
not proper subset relations.</p>
</div>


                            </div>
                            <div id="Symbols.isdisjoint" class="classattr">
                                        <input id="Symbols.isdisjoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">isdisjoint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Symbols.isdisjoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.isdisjoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.isdisjoint-363"><a href="#Symbols.isdisjoint-363"><span class="linenos">363</span></a>    <span class="k">def</span> <span class="nf">isdisjoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols.isdisjoint-364"><a href="#Symbols.isdisjoint-364"><span class="linenos">364</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether `self` has any positive elements in common with the other.</span>
</span><span id="Symbols.isdisjoint-365"><a href="#Symbols.isdisjoint-365"><span class="linenos">365</span></a><span class="sd">        </span>
</span><span id="Symbols.isdisjoint-366"><a href="#Symbols.isdisjoint-366"><span class="linenos">366</span></a><span class="sd">        Raises:</span>
</span><span id="Symbols.isdisjoint-367"><a href="#Symbols.isdisjoint-367"><span class="linenos">367</span></a><span class="sd">            ValueError if either has negative elements.</span>
</span><span id="Symbols.isdisjoint-368"><a href="#Symbols.isdisjoint-368"><span class="linenos">368</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Symbols.isdisjoint-369"><a href="#Symbols.isdisjoint-369"><span class="linenos">369</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">Symbols</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Symbols.isdisjoint-370"><a href="#Symbols.isdisjoint-370"><span class="linenos">370</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_negative_counts</span><span class="p">()</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">has_negative_counts</span><span class="p">():</span>
</span><span id="Symbols.isdisjoint-371"><a href="#Symbols.isdisjoint-371"><span class="linenos">371</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Symbols.isdisjoint-372"><a href="#Symbols.isdisjoint-372"><span class="linenos">372</span></a>                <span class="s2">&quot;isdisjoint() is not defined for negative counts.&quot;</span><span class="p">)</span>
</span><span id="Symbols.isdisjoint-373"><a href="#Symbols.isdisjoint-373"><span class="linenos">373</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">other</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="c1"># type: ignore</span>
</span><span id="Symbols.isdisjoint-374"><a href="#Symbols.isdisjoint-374"><span class="linenos">374</span></a>                   <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Whether <code>self</code> has any positive elements in common with the other.</p>

<h6 id="raises">Raises:</h6>

<ul>
<li>ValueError if either has negative elements.</li>
</ul>
</div>


                            </div>
                            <div id="Symbols.has_negative_counts" class="classattr">
                                        <input id="Symbols.has_negative_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_negative_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Symbols.has_negative_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.has_negative_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.has_negative_counts-398"><a href="#Symbols.has_negative_counts-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">has_negative_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Symbols.has_negative_counts-399"><a href="#Symbols.has_negative_counts-399"><span class="linenos">399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether any counts are negative.&quot;&quot;&quot;</span>
</span><span id="Symbols.has_negative_counts-400"><a href="#Symbols.has_negative_counts-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Whether any counts are negative.</p>
</div>


                            </div>
                            <div id="Symbols.count" class="classattr">
                                        <input id="Symbols.count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Symbols.count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Symbols.count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Symbols.count-420"><a href="#Symbols.count-420"><span class="linenos">420</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Symbols.count-421"><a href="#Symbols.count-421"><span class="linenos">421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total number of elements.&quot;&quot;&quot;</span>
</span><span id="Symbols.count-422"><a href="#Symbols.count-422"><span class="linenos">422</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>The total number of elements.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Mapping</dt>
                                <dd id="Symbols.get" class="function">get</dd>
                <dd id="Symbols.keys" class="function">keys</dd>
                <dd id="Symbols.items" class="function">items</dd>
                <dd id="Symbols.values" class="function">values</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Again">
                    <div class="attr variable">
            <span class="name">Again</span><span class="annotation">: Final</span>        =
<span class="default_value">&lt;icepool.population.again.AgainExpression object&gt;</span>

        
    </div>
    <a class="headerlink" href="#Again"></a>
    
            <div class="docstring"><p>A symbol indicating that the die should be rolled again, usually with some operation applied.</p>

<p>This is designed to be used with the <code><a href="#Die">Die()</a></code> constructor.
<code>AgainExpression</code>s should not be fed to functions or methods other than
<code><a href="#Die">Die()</a></code>, but it can be used with operators. Examples:</p>

<ul>
<li><code>Again + 6</code>: Roll again and add 6.</li>
<li><code>Again + Again</code>: Roll again twice and sum.</li>
</ul>

<p>The <code>again_count</code>, <code>again_depth</code>, and <code>again_end</code> arguments to <code><a href="#Die">Die()</a></code>
affect how these arguments are processed. At most one of <code>again_count</code> or
<code>again_depth</code> may be provided; if neither are provided, the behavior is as
`again_depth=1.</p>

<p>For finer control over rolling processes, use e.g. <code><a href="#Die.map">Die.map()</a></code> instead.</p>

<h4 id="count-mode">Count mode</h4>

<p>When <code>again_count</code> is provided, we start with one roll queued and execute one 
roll at a time. For every <code><a href="#Again">Again</a></code> we roll, we queue another roll.
If we run out of rolls, we sum the rolls to find the result. If the total number
of rolls (not including the initial roll) would exceed <code>again_count</code>, we reroll
the entire process, effectively conditioning the process on not rolling more
than <code>again_count</code> extra dice.</p>

<p>This mode only allows "additive" expressions to be used with <code><a href="#Again">Again</a></code>, which
means that only the following operators are allowed:</p>

<ul>
<li>Binary <code>+</code></li>
<li><code>n @ AgainExpression</code>, where <code>n</code> is a non-negative <code>int</code> or <code><a href="#Population">Population</a></code>.</li>
</ul>

<p>Furthermore, the <code>+</code> operator is assumed to be associative and commutative.
For example, <code>str</code> or <code>tuple</code> outcomes will not produce elements with a definite
order.</p>

<h4 id="depth-mode">Depth mode</h4>

<p>When <code>again_depth=0</code>, <code>again_end</code> is directly substituted
for each occurence of <code><a href="#Again">Again</a></code>. For other values of <code>again_depth</code>, the result for
<code>again_depth-1</code> is substituted for each occurence of <code><a href="#Again">Again</a></code>.</p>

<p>If <code>again_end=icepool<a href="#Reroll">Reroll</a></code>, then any <code>AgainExpression</code>s in the final depth
are rerolled.</p>

<h4 id="rerolls">Rerolls</h4>

<p><code><a href="#Reroll">Reroll</a></code> only rerolls that particular die, not the entire process. Any such
rerolls do not count against the <code>again_count</code> or <code>again_depth</code> limit.</p>

<p>If <code>again_end=icepool<a href="#Reroll">Reroll</a></code>:</p>

<ul>
<li>Count mode: Any result that would cause the number of rolls to exceed
<code>again_count</code> is rerolled.</li>
<li>Depth mode: Any <code>AgainExpression</code>s in the final depth level are rerolled.</li>
</ul>
</div>


                </section>
                <section id="CountsKeysView">
                            <input id="CountsKeysView-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CountsKeysView</span><wbr>(<span class="base">typing.KeysView[~T]</span>, <span class="base">typing.Sequence[~T]</span>):

                <label class="view-source-button" for="CountsKeysView-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsKeysView"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsKeysView-144"><a href="#CountsKeysView-144"><span class="linenos">144</span></a><span class="k">class</span> <span class="nc">CountsKeysView</span><span class="p">(</span><span class="n">KeysView</span><span class="p">[</span><span class="n">T</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="CountsKeysView-145"><a href="#CountsKeysView-145"><span class="linenos">145</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This functions as both a `KeysView` and a `Sequence`.&quot;&quot;&quot;</span>
</span><span id="CountsKeysView-146"><a href="#CountsKeysView-146"><span class="linenos">146</span></a>
</span><span id="CountsKeysView-147"><a href="#CountsKeysView-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="CountsKeysView-148"><a href="#CountsKeysView-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span><span id="CountsKeysView-149"><a href="#CountsKeysView-149"><span class="linenos">149</span></a>
</span><span id="CountsKeysView-150"><a href="#CountsKeysView-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="CountsKeysView-151"><a href="#CountsKeysView-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_keys</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="CountsKeysView-152"><a href="#CountsKeysView-152"><span class="linenos">152</span></a>
</span><span id="CountsKeysView-153"><a href="#CountsKeysView-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CountsKeysView-154"><a href="#CountsKeysView-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">)</span>
</span><span id="CountsKeysView-155"><a href="#CountsKeysView-155"><span class="linenos">155</span></a>
</span><span id="CountsKeysView-156"><a href="#CountsKeysView-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CountsKeysView-157"><a href="#CountsKeysView-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_keys</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>This functions as both a <code>KeysView</code> and a <code>Sequence</code>.</p>
</div>


                            <div id="CountsKeysView.__init__" class="classattr">
                                        <input id="CountsKeysView.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CountsKeysView</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">counts</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">Counts</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="CountsKeysView.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsKeysView.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsKeysView.__init__-147"><a href="#CountsKeysView.__init__-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="CountsKeysView.__init__-148"><a href="#CountsKeysView.__init__-148"><span class="linenos">148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Set</dt>
                                <dd id="CountsKeysView.isdisjoint" class="function">isdisjoint</dd>

            </div>
            <div><dt>collections.abc.Sequence</dt>
                                <dd id="CountsKeysView.index" class="function">index</dd>
                <dd id="CountsKeysView.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CountsValuesView">
                            <input id="CountsValuesView-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CountsValuesView</span><wbr>(<span class="base">typing.ValuesView[int]</span>, <span class="base">typing.Sequence[int]</span>):

                <label class="view-source-button" for="CountsValuesView-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsValuesView"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsValuesView-160"><a href="#CountsValuesView-160"><span class="linenos">160</span></a><span class="k">class</span> <span class="nc">CountsValuesView</span><span class="p">(</span><span class="n">ValuesView</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="CountsValuesView-161"><a href="#CountsValuesView-161"><span class="linenos">161</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This functions as both a `ValuesView` and a `Sequence`.&quot;&quot;&quot;</span>
</span><span id="CountsValuesView-162"><a href="#CountsValuesView-162"><span class="linenos">162</span></a>
</span><span id="CountsValuesView-163"><a href="#CountsValuesView-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsValuesView-164"><a href="#CountsValuesView-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span><span id="CountsValuesView-165"><a href="#CountsValuesView-165"><span class="linenos">165</span></a>
</span><span id="CountsValuesView-166"><a href="#CountsValuesView-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="CountsValuesView-167"><a href="#CountsValuesView-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="CountsValuesView-168"><a href="#CountsValuesView-168"><span class="linenos">168</span></a>
</span><span id="CountsValuesView-169"><a href="#CountsValuesView-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CountsValuesView-170"><a href="#CountsValuesView-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">)</span>
</span><span id="CountsValuesView-171"><a href="#CountsValuesView-171"><span class="linenos">171</span></a>
</span><span id="CountsValuesView-172"><a href="#CountsValuesView-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CountsValuesView-173"><a href="#CountsValuesView-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_values</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>This functions as both a <code>ValuesView</code> and a <code>Sequence</code>.</p>
</div>


                            <div id="CountsValuesView.__init__" class="classattr">
                                        <input id="CountsValuesView.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CountsValuesView</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">counts</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">Counts</span></span>)</span>

                <label class="view-source-button" for="CountsValuesView.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsValuesView.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsValuesView.__init__-163"><a href="#CountsValuesView.__init__-163"><span class="linenos">163</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsValuesView.__init__-164"><a href="#CountsValuesView.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Sequence</dt>
                                <dd id="CountsValuesView.index" class="function">index</dd>
                <dd id="CountsValuesView.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CountsItemsView">
                            <input id="CountsItemsView-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CountsItemsView</span><wbr>(<span class="base">typing.ItemsView[~T, int]</span>, <span class="base">typing.Sequence[tuple[~T, int]]</span>):

                <label class="view-source-button" for="CountsItemsView-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsItemsView"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsItemsView-176"><a href="#CountsItemsView-176"><span class="linenos">176</span></a><span class="k">class</span> <span class="nc">CountsItemsView</span><span class="p">(</span><span class="n">ItemsView</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="CountsItemsView-177"><a href="#CountsItemsView-177"><span class="linenos">177</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;This functions as both an `ItemsView` and a `Sequence`.&quot;&quot;&quot;</span>
</span><span id="CountsItemsView-178"><a href="#CountsItemsView-178"><span class="linenos">178</span></a>
</span><span id="CountsItemsView-179"><a href="#CountsItemsView-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsItemsView-180"><a href="#CountsItemsView-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span><span id="CountsItemsView-181"><a href="#CountsItemsView-181"><span class="linenos">181</span></a>
</span><span id="CountsItemsView-182"><a href="#CountsItemsView-182"><span class="linenos">182</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="CountsItemsView-183"><a href="#CountsItemsView-183"><span class="linenos">183</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="CountsItemsView-184"><a href="#CountsItemsView-184"><span class="linenos">184</span></a>
</span><span id="CountsItemsView-185"><a href="#CountsItemsView-185"><span class="linenos">185</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CountsItemsView-186"><a href="#CountsItemsView-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_items</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>This functions as both an <code>ItemsView</code> and a <code>Sequence</code>.</p>
</div>


                            <div id="CountsItemsView.__init__" class="classattr">
                                        <input id="CountsItemsView.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CountsItemsView</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">counts</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">Counts</span></span>)</span>

                <label class="view-source-button" for="CountsItemsView.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsItemsView.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsItemsView.__init__-179"><a href="#CountsItemsView.__init__-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsItemsView.__init__-180"><a href="#CountsItemsView.__init__-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Set</dt>
                                <dd id="CountsItemsView.isdisjoint" class="function">isdisjoint</dd>

            </div>
            <div><dt>collections.abc.Sequence</dt>
                                <dd id="CountsItemsView.index" class="function">index</dd>
                <dd id="CountsItemsView.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="from_cumulative">
                            <input id="from_cumulative-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_cumulative</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>,</span><span class="param">	<span class="n">cumulative</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">bool</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="from_cumulative-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_cumulative"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_cumulative-144"><a href="#from_cumulative-144"><span class="linenos">144</span></a><span class="k">def</span> <span class="nf">from_cumulative</span><span class="p">(</span><span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">],</span>
</span><span id="from_cumulative-145"><a href="#from_cumulative-145"><span class="linenos">145</span></a>                    <span class="n">cumulative</span><span class="p">:</span> <span class="s1">&#39;Sequence[int] | Sequence[icepool.Die[bool]]&#39;</span><span class="p">,</span>
</span><span id="from_cumulative-146"><a href="#from_cumulative-146"><span class="linenos">146</span></a>                    <span class="o">*</span><span class="p">,</span>
</span><span id="from_cumulative-147"><a href="#from_cumulative-147"><span class="linenos">147</span></a>                    <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">:</span>
</span><span id="from_cumulative-148"><a href="#from_cumulative-148"><span class="linenos">148</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructs a `Die` from a sequence of cumulative values.</span>
</span><span id="from_cumulative-149"><a href="#from_cumulative-149"><span class="linenos">149</span></a>
</span><span id="from_cumulative-150"><a href="#from_cumulative-150"><span class="linenos">150</span></a><span class="sd">    Args:</span>
</span><span id="from_cumulative-151"><a href="#from_cumulative-151"><span class="linenos">151</span></a><span class="sd">        outcomes: The outcomes of the resulting die. Sorted order is recommended</span>
</span><span id="from_cumulative-152"><a href="#from_cumulative-152"><span class="linenos">152</span></a><span class="sd">            but not necessary.</span>
</span><span id="from_cumulative-153"><a href="#from_cumulative-153"><span class="linenos">153</span></a><span class="sd">        cumulative: The cumulative values (inclusive) of the outcomes in the</span>
</span><span id="from_cumulative-154"><a href="#from_cumulative-154"><span class="linenos">154</span></a><span class="sd">            order they are given to this function. These may be:</span>
</span><span id="from_cumulative-155"><a href="#from_cumulative-155"><span class="linenos">155</span></a><span class="sd">            * `int` cumulative quantities.</span>
</span><span id="from_cumulative-156"><a href="#from_cumulative-156"><span class="linenos">156</span></a><span class="sd">            * Dice representing the cumulative distribution at that point.</span>
</span><span id="from_cumulative-157"><a href="#from_cumulative-157"><span class="linenos">157</span></a><span class="sd">        reverse: Iff true, both of the arguments will be reversed. This allows</span>
</span><span id="from_cumulative-158"><a href="#from_cumulative-158"><span class="linenos">158</span></a><span class="sd">            e.g. constructing using a survival distribution.</span>
</span><span id="from_cumulative-159"><a href="#from_cumulative-159"><span class="linenos">159</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="from_cumulative-160"><a href="#from_cumulative-160"><span class="linenos">160</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="from_cumulative-161"><a href="#from_cumulative-161"><span class="linenos">161</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">({})</span>
</span><span id="from_cumulative-162"><a href="#from_cumulative-162"><span class="linenos">162</span></a>
</span><span id="from_cumulative-163"><a href="#from_cumulative-163"><span class="linenos">163</span></a>    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
</span><span id="from_cumulative-164"><a href="#from_cumulative-164"><span class="linenos">164</span></a>        <span class="n">outcomes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">outcomes</span><span class="p">))</span>
</span><span id="from_cumulative-165"><a href="#from_cumulative-165"><span class="linenos">165</span></a>        <span class="n">cumulative</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">cumulative</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="from_cumulative-166"><a href="#from_cumulative-166"><span class="linenos">166</span></a>
</span><span id="from_cumulative-167"><a href="#from_cumulative-167"><span class="linenos">167</span></a>    <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="from_cumulative-168"><a href="#from_cumulative-168"><span class="linenos">168</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="from_cumulative-169"><a href="#from_cumulative-169"><span class="linenos">169</span></a>
</span><span id="from_cumulative-170"><a href="#from_cumulative-170"><span class="linenos">170</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cumulative</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">):</span>
</span><span id="from_cumulative-171"><a href="#from_cumulative-171"><span class="linenos">171</span></a>        <span class="n">cumulative</span> <span class="o">=</span> <span class="n">commonize_denominator</span><span class="p">(</span><span class="o">*</span><span class="n">cumulative</span><span class="p">)</span>
</span><span id="from_cumulative-172"><a href="#from_cumulative-172"><span class="linenos">172</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">die</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">cumulative</span><span class="p">):</span>
</span><span id="from_cumulative-173"><a href="#from_cumulative-173"><span class="linenos">173</span></a>            <span class="n">d</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">die</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-</span> <span class="n">prev</span>
</span><span id="from_cumulative-174"><a href="#from_cumulative-174"><span class="linenos">174</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="n">die</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="from_cumulative-175"><a href="#from_cumulative-175"><span class="linenos">175</span></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cumulative</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="from_cumulative-176"><a href="#from_cumulative-176"><span class="linenos">176</span></a>        <span class="n">cumulative</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">cumulative</span><span class="p">)</span>
</span><span id="from_cumulative-177"><a href="#from_cumulative-177"><span class="linenos">177</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">cumulative</span><span class="p">):</span>
</span><span id="from_cumulative-178"><a href="#from_cumulative-178"><span class="linenos">178</span></a>            <span class="n">d</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">quantity</span> <span class="o">-</span> <span class="n">prev</span>
</span><span id="from_cumulative-179"><a href="#from_cumulative-179"><span class="linenos">179</span></a>            <span class="n">prev</span> <span class="o">=</span> <span class="n">quantity</span>
</span><span id="from_cumulative-180"><a href="#from_cumulative-180"><span class="linenos">180</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="from_cumulative-181"><a href="#from_cumulative-181"><span class="linenos">181</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="from_cumulative-182"><a href="#from_cumulative-182"><span class="linenos">182</span></a>            <span class="sa">f</span><span class="s1">&#39;Unsupported type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">cumulative</span><span class="p">)</span><span class="si">}</span><span class="s1"> for cumulative values.&#39;</span><span class="p">)</span>
</span><span id="from_cumulative-183"><a href="#from_cumulative-183"><span class="linenos">183</span></a>
</span><span id="from_cumulative-184"><a href="#from_cumulative-184"><span class="linenos">184</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructs a <code><a href="#Die">Die</a></code> from a sequence of cumulative values.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>outcomes:</strong>  The outcomes of the resulting die. Sorted order is recommended
but not necessary.</li>
<li><strong>cumulative:</strong>  The cumulative values (inclusive) of the outcomes in the
order they are given to this function. These may be:
<ul>
<li><code>int</code> cumulative quantities.</li>
<li>Dice representing the cumulative distribution at that point.</li>
</ul></li>
<li><strong>reverse:</strong>  Iff true, both of the arguments will be reversed. This allows
e.g. constructing using a survival distribution.</li>
</ul>
</div>


                </section>
                <section id="from_rv">
                            <input id="from_rv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_rv</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">rv</span>,</span><span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>,</span><span class="param">	<span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="from_rv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_rv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_rv-199"><a href="#from_rv-199"><span class="linenos">199</span></a><span class="k">def</span> <span class="nf">from_rv</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="from_rv-200"><a href="#from_rv-200"><span class="linenos">200</span></a>            <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.Die[float]&#39;</span><span class="p">:</span>
</span><span id="from_rv-201"><a href="#from_rv-201"><span class="linenos">201</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Constructs a `Die` from a rv object (as `scipy.stats`).</span>
</span><span id="from_rv-202"><a href="#from_rv-202"><span class="linenos">202</span></a><span class="sd">    Args:</span>
</span><span id="from_rv-203"><a href="#from_rv-203"><span class="linenos">203</span></a><span class="sd">        rv: A rv object (as `scipy.stats`).</span>
</span><span id="from_rv-204"><a href="#from_rv-204"><span class="linenos">204</span></a><span class="sd">        outcomes: An iterable of `int`s or `float`s that will be the outcomes</span>
</span><span id="from_rv-205"><a href="#from_rv-205"><span class="linenos">205</span></a><span class="sd">            of the resulting `Die`.</span>
</span><span id="from_rv-206"><a href="#from_rv-206"><span class="linenos">206</span></a><span class="sd">            If the distribution is discrete, outcomes must be `int`s.</span>
</span><span id="from_rv-207"><a href="#from_rv-207"><span class="linenos">207</span></a><span class="sd">        denominator: The denominator of the resulting `Die` will be set to this.</span>
</span><span id="from_rv-208"><a href="#from_rv-208"><span class="linenos">208</span></a><span class="sd">        **kwargs: These will be forwarded to `rv.cdf()`.</span>
</span><span id="from_rv-209"><a href="#from_rv-209"><span class="linenos">209</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="from_rv-210"><a href="#from_rv-210"><span class="linenos">210</span></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="from_rv-211"><a href="#from_rv-211"><span class="linenos">211</span></a>        <span class="c1"># Continuous distributions use midpoints.</span>
</span><span id="from_rv-212"><a href="#from_rv-212"><span class="linenos">212</span></a>        <span class="n">midpoints</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outcomes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="from_rv-213"><a href="#from_rv-213"><span class="linenos">213</span></a>        <span class="n">cdf</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">midpoints</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="from_rv-214"><a href="#from_rv-214"><span class="linenos">214</span></a>        <span class="n">quantities_le</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">))</span>
</span><span id="from_rv-215"><a href="#from_rv-215"><span class="linenos">215</span></a>                              <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cdf</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">denominator</span><span class="p">,</span> <span class="p">)</span>
</span><span id="from_rv-216"><a href="#from_rv-216"><span class="linenos">216</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="from_rv-217"><a href="#from_rv-217"><span class="linenos">217</span></a>        <span class="n">cdf</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="from_rv-218"><a href="#from_rv-218"><span class="linenos">218</span></a>        <span class="n">quantities_le</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cdf</span><span class="p">)</span>
</span><span id="from_rv-219"><a href="#from_rv-219"><span class="linenos">219</span></a>    <span class="k">return</span> <span class="n">from_cumulative</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">quantities_le</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructs a <code><a href="#Die">Die</a></code> from a rv object (as <code>scipy.stats</code>).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rv:</strong>  A rv object (as <code>scipy.stats</code>).</li>
<li><strong>outcomes:</strong>  An iterable of <code>int</code>s or <code>float</code>s that will be the outcomes
of the resulting <code><a href="#Die">Die</a></code>.
If the distribution is discrete, outcomes must be <code>int</code>s.</li>
<li><strong>denominator:</strong>  The denominator of the resulting <code><a href="#Die">Die</a></code> will be set to this.</li>
<li><strong>**kwargs:</strong>  These will be forwarded to <code>rv.cdf()</code>.</li>
</ul>
</div>


                </section>
                <section id="lowest">
                            <input id="lowest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lowest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arg0</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">more_args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="lowest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lowest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lowest-99"><a href="#lowest-99"><span class="linenos"> 99</span></a><span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span>
</span><span id="lowest-100"><a href="#lowest-100"><span class="linenos">100</span></a>           <span class="o">/</span><span class="p">,</span>
</span><span id="lowest-101"><a href="#lowest-101"><span class="linenos">101</span></a>           <span class="o">*</span><span class="n">more_args</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T]&#39;</span><span class="p">,</span>
</span><span id="lowest-102"><a href="#lowest-102"><span class="linenos">102</span></a>           <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="lowest-103"><a href="#lowest-103"><span class="linenos">103</span></a>           <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="lowest-104"><a href="#lowest-104"><span class="linenos">104</span></a>           <span class="n">default</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">:</span>
</span><span id="lowest-105"><a href="#lowest-105"><span class="linenos">105</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The lowest outcome among the rolls, or the sum of some of the lowest.</span>
</span><span id="lowest-106"><a href="#lowest-106"><span class="linenos">106</span></a>
</span><span id="lowest-107"><a href="#lowest-107"><span class="linenos">107</span></a><span class="sd">    The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="lowest-108"><a href="#lowest-108"><span class="linenos">108</span></a>
</span><span id="lowest-109"><a href="#lowest-109"><span class="linenos">109</span></a><span class="sd">    Args:</span>
</span><span id="lowest-110"><a href="#lowest-110"><span class="linenos">110</span></a><span class="sd">        args: Dice or individual outcomes in a single iterable, or as two or</span>
</span><span id="lowest-111"><a href="#lowest-111"><span class="linenos">111</span></a><span class="sd">            more separate arguments. Similar to the built-in `min()`.</span>
</span><span id="lowest-112"><a href="#lowest-112"><span class="linenos">112</span></a><span class="sd">        keep, drop: These arguments work together:</span>
</span><span id="lowest-113"><a href="#lowest-113"><span class="linenos">113</span></a><span class="sd">            * If neither are provided, the single lowest die will be taken.</span>
</span><span id="lowest-114"><a href="#lowest-114"><span class="linenos">114</span></a><span class="sd">            * If only `keep` is provided, the `keep` lowest dice will be summed.</span>
</span><span id="lowest-115"><a href="#lowest-115"><span class="linenos">115</span></a><span class="sd">            * If only `drop` is provided, the `drop` lowest dice will be dropped</span>
</span><span id="lowest-116"><a href="#lowest-116"><span class="linenos">116</span></a><span class="sd">                and the rest will be summed.</span>
</span><span id="lowest-117"><a href="#lowest-117"><span class="linenos">117</span></a><span class="sd">            * If both are provided, `drop` lowest dice will be dropped, then</span>
</span><span id="lowest-118"><a href="#lowest-118"><span class="linenos">118</span></a><span class="sd">                the next `keep` lowest dice will be summed.</span>
</span><span id="lowest-119"><a href="#lowest-119"><span class="linenos">119</span></a><span class="sd">        default: If an empty iterable is provided, the result will be a die that</span>
</span><span id="lowest-120"><a href="#lowest-120"><span class="linenos">120</span></a><span class="sd">            always rolls this value.</span>
</span><span id="lowest-121"><a href="#lowest-121"><span class="linenos">121</span></a>
</span><span id="lowest-122"><a href="#lowest-122"><span class="linenos">122</span></a><span class="sd">    Raises:</span>
</span><span id="lowest-123"><a href="#lowest-123"><span class="linenos">123</span></a><span class="sd">        ValueError if an empty iterable is provided with no `default`.</span>
</span><span id="lowest-124"><a href="#lowest-124"><span class="linenos">124</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="lowest-125"><a href="#lowest-125"><span class="linenos">125</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">more_args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="lowest-126"><a href="#lowest-126"><span class="linenos">126</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">arg0</span>
</span><span id="lowest-127"><a href="#lowest-127"><span class="linenos">127</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="lowest-128"><a href="#lowest-128"><span class="linenos">128</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">more_args</span>
</span><span id="lowest-129"><a href="#lowest-129"><span class="linenos">129</span></a>
</span><span id="lowest-130"><a href="#lowest-130"><span class="linenos">130</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="lowest-131"><a href="#lowest-131"><span class="linenos">131</span></a>        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="lowest-132"><a href="#lowest-132"><span class="linenos">132</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="lowest-133"><a href="#lowest-133"><span class="linenos">133</span></a>                <span class="s2">&quot;lowest() arg is an empty sequence and no default was provided.&quot;</span>
</span><span id="lowest-134"><a href="#lowest-134"><span class="linenos">134</span></a>            <span class="p">)</span>
</span><span id="lowest-135"><a href="#lowest-135"><span class="linenos">135</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="lowest-136"><a href="#lowest-136"><span class="linenos">136</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">default</span><span class="p">])</span>
</span><span id="lowest-137"><a href="#lowest-137"><span class="linenos">137</span></a>
</span><span id="lowest-138"><a href="#lowest-138"><span class="linenos">138</span></a>    <span class="n">index_slice</span> <span class="o">=</span> <span class="n">lowest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="lowest-139"><a href="#lowest-139"><span class="linenos">139</span></a>    <span class="k">return</span> <span class="n">_sum_slice</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">index_slice</span><span class="o">=</span><span class="n">index_slice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The lowest outcome among the rolls, or the sum of some of the lowest.</p>

<p>The outcomes should support addition and multiplication if <code>keep != 1</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>args:</strong>  Dice or individual outcomes in a single iterable, or as two or
more separate arguments. Similar to the built-in <code>min()</code>.</li>
<li><strong>keep, drop:</strong>  These arguments work together:
<ul>
<li>If neither are provided, the single lowest die will be taken.</li>
<li>If only <code>keep</code> is provided, the <code>keep</code> lowest dice will be summed.</li>
<li>If only <code>drop</code> is provided, the <code>drop</code> lowest dice will be dropped
and the rest will be summed.</li>
<li>If both are provided, <code>drop</code> lowest dice will be dropped, then
the next <code>keep</code> lowest dice will be summed.</li>
</ul></li>
<li><strong>default:</strong>  If an empty iterable is provided, the result will be a die that
always rolls this value.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li>ValueError if an empty iterable is provided with no <code>default</code>.</li>
</ul>
</div>


                </section>
                <section id="highest">
                            <input id="highest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">highest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arg0</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">more_args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="highest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#highest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="highest-153"><a href="#highest-153"><span class="linenos">153</span></a><span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span>
</span><span id="highest-154"><a href="#highest-154"><span class="linenos">154</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="highest-155"><a href="#highest-155"><span class="linenos">155</span></a>            <span class="o">*</span><span class="n">more_args</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T]&#39;</span><span class="p">,</span>
</span><span id="highest-156"><a href="#highest-156"><span class="linenos">156</span></a>            <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="highest-157"><a href="#highest-157"><span class="linenos">157</span></a>            <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="highest-158"><a href="#highest-158"><span class="linenos">158</span></a>            <span class="n">default</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">:</span>
</span><span id="highest-159"><a href="#highest-159"><span class="linenos">159</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The highest outcome among the rolls, or the sum of some of the highest.</span>
</span><span id="highest-160"><a href="#highest-160"><span class="linenos">160</span></a>
</span><span id="highest-161"><a href="#highest-161"><span class="linenos">161</span></a><span class="sd">    The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="highest-162"><a href="#highest-162"><span class="linenos">162</span></a>
</span><span id="highest-163"><a href="#highest-163"><span class="linenos">163</span></a><span class="sd">    Args:</span>
</span><span id="highest-164"><a href="#highest-164"><span class="linenos">164</span></a><span class="sd">        args: Dice or individual outcomes in a single iterable, or as two or</span>
</span><span id="highest-165"><a href="#highest-165"><span class="linenos">165</span></a><span class="sd">            more separate arguments. Similar to the built-in `max()`.</span>
</span><span id="highest-166"><a href="#highest-166"><span class="linenos">166</span></a><span class="sd">        keep, drop: These arguments work together:</span>
</span><span id="highest-167"><a href="#highest-167"><span class="linenos">167</span></a><span class="sd">            * If neither are provided, the single highest die will be taken.</span>
</span><span id="highest-168"><a href="#highest-168"><span class="linenos">168</span></a><span class="sd">            * If only `keep` is provided, the `keep` highest dice will be summed.</span>
</span><span id="highest-169"><a href="#highest-169"><span class="linenos">169</span></a><span class="sd">            * If only `drop` is provided, the `drop` highest dice will be dropped</span>
</span><span id="highest-170"><a href="#highest-170"><span class="linenos">170</span></a><span class="sd">                and the rest will be summed.</span>
</span><span id="highest-171"><a href="#highest-171"><span class="linenos">171</span></a><span class="sd">            * If both are provided, `drop` highest dice will be dropped, then</span>
</span><span id="highest-172"><a href="#highest-172"><span class="linenos">172</span></a><span class="sd">                the next `keep` highest dice will be summed.</span>
</span><span id="highest-173"><a href="#highest-173"><span class="linenos">173</span></a><span class="sd">        drop: This number of highest dice will be dropped before keeping dice</span>
</span><span id="highest-174"><a href="#highest-174"><span class="linenos">174</span></a><span class="sd">            to be summed.</span>
</span><span id="highest-175"><a href="#highest-175"><span class="linenos">175</span></a><span class="sd">        default: If an empty iterable is provided, the result will be a die that</span>
</span><span id="highest-176"><a href="#highest-176"><span class="linenos">176</span></a><span class="sd">            always rolls this value.</span>
</span><span id="highest-177"><a href="#highest-177"><span class="linenos">177</span></a>
</span><span id="highest-178"><a href="#highest-178"><span class="linenos">178</span></a><span class="sd">    Raises:</span>
</span><span id="highest-179"><a href="#highest-179"><span class="linenos">179</span></a><span class="sd">        ValueError if an empty iterable is provided with no `default`.</span>
</span><span id="highest-180"><a href="#highest-180"><span class="linenos">180</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="highest-181"><a href="#highest-181"><span class="linenos">181</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">more_args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="highest-182"><a href="#highest-182"><span class="linenos">182</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">arg0</span>
</span><span id="highest-183"><a href="#highest-183"><span class="linenos">183</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="highest-184"><a href="#highest-184"><span class="linenos">184</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">more_args</span>
</span><span id="highest-185"><a href="#highest-185"><span class="linenos">185</span></a>
</span><span id="highest-186"><a href="#highest-186"><span class="linenos">186</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="highest-187"><a href="#highest-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="highest-188"><a href="#highest-188"><span class="linenos">188</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="highest-189"><a href="#highest-189"><span class="linenos">189</span></a>                <span class="s2">&quot;highest() arg is an empty sequence and no default was provided.&quot;</span>
</span><span id="highest-190"><a href="#highest-190"><span class="linenos">190</span></a>            <span class="p">)</span>
</span><span id="highest-191"><a href="#highest-191"><span class="linenos">191</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="highest-192"><a href="#highest-192"><span class="linenos">192</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">default</span><span class="p">])</span>
</span><span id="highest-193"><a href="#highest-193"><span class="linenos">193</span></a>
</span><span id="highest-194"><a href="#highest-194"><span class="linenos">194</span></a>    <span class="n">index_slice</span> <span class="o">=</span> <span class="n">highest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="highest-195"><a href="#highest-195"><span class="linenos">195</span></a>    <span class="k">return</span> <span class="n">_sum_slice</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">index_slice</span><span class="o">=</span><span class="n">index_slice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The highest outcome among the rolls, or the sum of some of the highest.</p>

<p>The outcomes should support addition and multiplication if <code>keep != 1</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>args:</strong>  Dice or individual outcomes in a single iterable, or as two or
more separate arguments. Similar to the built-in <code>max()</code>.</li>
<li><strong>keep, drop:</strong>  These arguments work together:
<ul>
<li>If neither are provided, the single highest die will be taken.</li>
<li>If only <code>keep</code> is provided, the <code>keep</code> highest dice will be summed.</li>
<li>If only <code>drop</code> is provided, the <code>drop</code> highest dice will be dropped
and the rest will be summed.</li>
<li>If both are provided, <code>drop</code> highest dice will be dropped, then
the next <code>keep</code> highest dice will be summed.</li>
</ul></li>
<li><strong>drop:</strong>  This number of highest dice will be dropped before keeping dice
to be summed.</li>
<li><strong>default:</strong>  If an empty iterable is provided, the result will be a die that
always rolls this value.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li>ValueError if an empty iterable is provided with no <code>default</code>.</li>
</ul>
</div>


                </section>
                <section id="middle">
                            <input id="middle-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">middle</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arg0</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">more_args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">tie</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span>,</span><span class="param">	<span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="middle-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#middle"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="middle-209"><a href="#middle-209"><span class="linenos">209</span></a><span class="k">def</span> <span class="nf">middle</span><span class="p">(</span><span class="n">arg0</span><span class="p">,</span>
</span><span id="middle-210"><a href="#middle-210"><span class="linenos">210</span></a>           <span class="o">/</span><span class="p">,</span>
</span><span id="middle-211"><a href="#middle-211"><span class="linenos">211</span></a>           <span class="o">*</span><span class="n">more_args</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T]&#39;</span><span class="p">,</span>
</span><span id="middle-212"><a href="#middle-212"><span class="linenos">212</span></a>           <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="middle-213"><a href="#middle-213"><span class="linenos">213</span></a>           <span class="n">tie</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="s1">&#39;low&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span><span id="middle-214"><a href="#middle-214"><span class="linenos">214</span></a>           <span class="n">default</span><span class="p">:</span> <span class="n">T</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">:</span>
</span><span id="middle-215"><a href="#middle-215"><span class="linenos">215</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The middle of the outcomes among the rolls, or the sum of some of the middle.</span>
</span><span id="middle-216"><a href="#middle-216"><span class="linenos">216</span></a>
</span><span id="middle-217"><a href="#middle-217"><span class="linenos">217</span></a><span class="sd">    The outcomes should support addition and multiplication if `keep != 1`.</span>
</span><span id="middle-218"><a href="#middle-218"><span class="linenos">218</span></a>
</span><span id="middle-219"><a href="#middle-219"><span class="linenos">219</span></a><span class="sd">    Args:</span>
</span><span id="middle-220"><a href="#middle-220"><span class="linenos">220</span></a><span class="sd">        args: Dice or individual outcomes in a single iterable, or as two or</span>
</span><span id="middle-221"><a href="#middle-221"><span class="linenos">221</span></a><span class="sd">            more separate arguments.</span>
</span><span id="middle-222"><a href="#middle-222"><span class="linenos">222</span></a><span class="sd">        keep: The number of outcomes to sum.</span>
</span><span id="middle-223"><a href="#middle-223"><span class="linenos">223</span></a><span class="sd">        tie: What to do if `keep` is odd but the the number of args is even, or</span>
</span><span id="middle-224"><a href="#middle-224"><span class="linenos">224</span></a><span class="sd">            vice versa.</span>
</span><span id="middle-225"><a href="#middle-225"><span class="linenos">225</span></a><span class="sd">            * &#39;error&#39; (default): Raises `IndexError`.</span>
</span><span id="middle-226"><a href="#middle-226"><span class="linenos">226</span></a><span class="sd">            * &#39;high&#39;: The higher outcome is taken.</span>
</span><span id="middle-227"><a href="#middle-227"><span class="linenos">227</span></a><span class="sd">            * &#39;low&#39;: The lower outcome is taken.</span>
</span><span id="middle-228"><a href="#middle-228"><span class="linenos">228</span></a><span class="sd">        default: If an empty iterable is provided, the result will be a die that</span>
</span><span id="middle-229"><a href="#middle-229"><span class="linenos">229</span></a><span class="sd">            always rolls this value.</span>
</span><span id="middle-230"><a href="#middle-230"><span class="linenos">230</span></a>
</span><span id="middle-231"><a href="#middle-231"><span class="linenos">231</span></a><span class="sd">    Raises:</span>
</span><span id="middle-232"><a href="#middle-232"><span class="linenos">232</span></a><span class="sd">        ValueError if an empty iterable is provided with no `default`.</span>
</span><span id="middle-233"><a href="#middle-233"><span class="linenos">233</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="middle-234"><a href="#middle-234"><span class="linenos">234</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">more_args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="middle-235"><a href="#middle-235"><span class="linenos">235</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="n">arg0</span>
</span><span id="middle-236"><a href="#middle-236"><span class="linenos">236</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="middle-237"><a href="#middle-237"><span class="linenos">237</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">arg0</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">more_args</span>
</span><span id="middle-238"><a href="#middle-238"><span class="linenos">238</span></a>
</span><span id="middle-239"><a href="#middle-239"><span class="linenos">239</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="middle-240"><a href="#middle-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="middle-241"><a href="#middle-241"><span class="linenos">241</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="middle-242"><a href="#middle-242"><span class="linenos">242</span></a>                <span class="s2">&quot;middle() arg is an empty sequence and no default was provided.&quot;</span>
</span><span id="middle-243"><a href="#middle-243"><span class="linenos">243</span></a>            <span class="p">)</span>
</span><span id="middle-244"><a href="#middle-244"><span class="linenos">244</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="middle-245"><a href="#middle-245"><span class="linenos">245</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">default</span><span class="p">])</span>
</span><span id="middle-246"><a href="#middle-246"><span class="linenos">246</span></a>
</span><span id="middle-247"><a href="#middle-247"><span class="linenos">247</span></a>    <span class="c1"># Expression evaluators are difficult to type.</span>
</span><span id="middle-248"><a href="#middle-248"><span class="linenos">248</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">middle</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">tie</span><span class="o">=</span><span class="n">tie</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>The middle of the outcomes among the rolls, or the sum of some of the middle.</p>

<p>The outcomes should support addition and multiplication if <code>keep != 1</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>args:</strong>  Dice or individual outcomes in a single iterable, or as two or
more separate arguments.</li>
<li><strong>keep:</strong>  The number of outcomes to sum.</li>
<li><strong>tie:</strong>  What to do if <code>keep</code> is odd but the the number of args is even, or
vice versa.
<ul>
<li>'error' (default): Raises <code>IndexError</code>.</li>
<li>'high': The higher outcome is taken.</li>
<li>'low': The lower outcome is taken.</li>
</ul></li>
<li><strong>default:</strong>  If an empty iterable is provided, the result will be a die that
always rolls this value.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li>ValueError if an empty iterable is provided with no <code>default</code>.</li>
</ul>
</div>


                </section>
                <section id="min_outcome">
                            <input id="min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">T</span>:</span></span>

                <label class="view-source-button" for="min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="min_outcome-222"><a href="#min_outcome-222"><span class="linenos">222</span></a><span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="min_outcome-223"><a href="#min_outcome-223"><span class="linenos">223</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The minimum outcome among the dice. &quot;&quot;&quot;</span>
</span><span id="min_outcome-224"><a href="#min_outcome-224"><span class="linenos">224</span></a>    <span class="n">converted_dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="min_outcome-225"><a href="#min_outcome-225"><span class="linenos">225</span></a>    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">converted_dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The minimum outcome among the dice.</p>
</div>


                </section>
                <section id="max_outcome">
                            <input id="max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">T</span>:</span></span>

                <label class="view-source-button" for="max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="max_outcome-228"><a href="#max_outcome-228"><span class="linenos">228</span></a><span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="max_outcome-229"><a href="#max_outcome-229"><span class="linenos">229</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The maximum outcome among the dice. &quot;&quot;&quot;</span>
</span><span id="max_outcome-230"><a href="#max_outcome-230"><span class="linenos">230</span></a>    <span class="n">converted_dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="max_outcome-231"><a href="#max_outcome-231"><span class="linenos">231</span></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">converted_dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The maximum outcome among the dice.</p>
</div>


                </section>
                <section id="align">
                            <input id="align-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">align</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="align-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#align"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="align-234"><a href="#align-234"><span class="linenos">234</span></a><span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="align-235"><a href="#align-235"><span class="linenos">235</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pads dice with zero quantities so that all have the same set of outcomes.</span>
</span><span id="align-236"><a href="#align-236"><span class="linenos">236</span></a>
</span><span id="align-237"><a href="#align-237"><span class="linenos">237</span></a><span class="sd">    Args:</span>
</span><span id="align-238"><a href="#align-238"><span class="linenos">238</span></a><span class="sd">        *dice: Any number of dice or single outcomes convertible to dice.</span>
</span><span id="align-239"><a href="#align-239"><span class="linenos">239</span></a>
</span><span id="align-240"><a href="#align-240"><span class="linenos">240</span></a><span class="sd">    Returns:</span>
</span><span id="align-241"><a href="#align-241"><span class="linenos">241</span></a><span class="sd">        A tuple of aligned dice.</span>
</span><span id="align-242"><a href="#align-242"><span class="linenos">242</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="align-243"><a href="#align-243"><span class="linenos">243</span></a>    <span class="n">converted_dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="align-244"><a href="#align-244"><span class="linenos">244</span></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="align-245"><a href="#align-245"><span class="linenos">245</span></a>        <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="align-246"><a href="#align-246"><span class="linenos">246</span></a>                                      <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">converted_dice</span><span class="p">))</span>
</span><span id="align-247"><a href="#align-247"><span class="linenos">247</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">converted_dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pads dice with zero quantities so that all have the same set of outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*dice:</strong>  Any number of dice or single outcomes convertible to dice.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A tuple of aligned dice.</p>
</blockquote>
</div>


                </section>
                <section id="align_range">
                            <input id="align_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">align_range</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="align_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#align_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="align_range-250"><a href="#align_range-250"><span class="linenos">250</span></a><span class="k">def</span> <span class="nf">align_range</span><span class="p">(</span>
</span><span id="align_range-251"><a href="#align_range-251"><span class="linenos">251</span></a>        <span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;int | icepool.Die[int]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die[int]&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="align_range-252"><a href="#align_range-252"><span class="linenos">252</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pads dice with zero quantities so that all have the same set of consecutive `int` outcomes.</span>
</span><span id="align_range-253"><a href="#align_range-253"><span class="linenos">253</span></a>
</span><span id="align_range-254"><a href="#align_range-254"><span class="linenos">254</span></a><span class="sd">    Args:</span>
</span><span id="align_range-255"><a href="#align_range-255"><span class="linenos">255</span></a><span class="sd">        *dice: Any number of dice or single outcomes convertible to dice.</span>
</span><span id="align_range-256"><a href="#align_range-256"><span class="linenos">256</span></a>
</span><span id="align_range-257"><a href="#align_range-257"><span class="linenos">257</span></a><span class="sd">    Returns:</span>
</span><span id="align_range-258"><a href="#align_range-258"><span class="linenos">258</span></a><span class="sd">        A tuple of aligned dice.</span>
</span><span id="align_range-259"><a href="#align_range-259"><span class="linenos">259</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="align_range-260"><a href="#align_range-260"><span class="linenos">260</span></a>    <span class="n">converted_dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="align_range-261"><a href="#align_range-261"><span class="linenos">261</span></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">converted_dice</span><span class="p">),</span>
</span><span id="align_range-262"><a href="#align_range-262"><span class="linenos">262</span></a>                     <span class="n">icepool</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">converted_dice</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="align_range-263"><a href="#align_range-263"><span class="linenos">263</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">converted_dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pads dice with zero quantities so that all have the same set of consecutive <code>int</code> outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*dice:</strong>  Any number of dice or single outcomes convertible to dice.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A tuple of aligned dice.</p>
</blockquote>
</div>


                </section>
                <section id="commonize_denominator">
                            <input id="commonize_denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">commonize_denominator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="commonize_denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#commonize_denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="commonize_denominator-266"><a href="#commonize_denominator-266"><span class="linenos">266</span></a><span class="k">def</span> <span class="nf">commonize_denominator</span><span class="p">(</span>
</span><span id="commonize_denominator-267"><a href="#commonize_denominator-267"><span class="linenos">267</span></a>        <span class="o">*</span><span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T]&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="commonize_denominator-268"><a href="#commonize_denominator-268"><span class="linenos">268</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale the weights of the dice so that all of them have the same denominator.</span>
</span><span id="commonize_denominator-269"><a href="#commonize_denominator-269"><span class="linenos">269</span></a>
</span><span id="commonize_denominator-270"><a href="#commonize_denominator-270"><span class="linenos">270</span></a><span class="sd">    Args:</span>
</span><span id="commonize_denominator-271"><a href="#commonize_denominator-271"><span class="linenos">271</span></a><span class="sd">        *dice: Any number of dice or single outcomes convertible to dice.</span>
</span><span id="commonize_denominator-272"><a href="#commonize_denominator-272"><span class="linenos">272</span></a>
</span><span id="commonize_denominator-273"><a href="#commonize_denominator-273"><span class="linenos">273</span></a><span class="sd">    Returns:</span>
</span><span id="commonize_denominator-274"><a href="#commonize_denominator-274"><span class="linenos">274</span></a><span class="sd">        A tuple of dice with the same denominator.</span>
</span><span id="commonize_denominator-275"><a href="#commonize_denominator-275"><span class="linenos">275</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="commonize_denominator-276"><a href="#commonize_denominator-276"><span class="linenos">276</span></a>    <span class="n">converted_dice</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="commonize_denominator-277"><a href="#commonize_denominator-277"><span class="linenos">277</span></a>        <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span>
</span><span id="commonize_denominator-278"><a href="#commonize_denominator-278"><span class="linenos">278</span></a>    <span class="p">]</span>
</span><span id="commonize_denominator-279"><a href="#commonize_denominator-279"><span class="linenos">279</span></a>    <span class="n">denominator_lcm</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">lcm</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">converted_dice</span>
</span><span id="commonize_denominator-280"><a href="#commonize_denominator-280"><span class="linenos">280</span></a>                                 <span class="k">if</span> <span class="n">die</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="commonize_denominator-281"><a href="#commonize_denominator-281"><span class="linenos">281</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="commonize_denominator-282"><a href="#commonize_denominator-282"><span class="linenos">282</span></a>        <span class="n">die</span><span class="o">.</span><span class="n">scale_quantities</span><span class="p">(</span><span class="n">denominator_lcm</span> <span class="o">//</span>
</span><span id="commonize_denominator-283"><a href="#commonize_denominator-283"><span class="linenos">283</span></a>                             <span class="n">die</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="k">if</span> <span class="n">die</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="commonize_denominator-284"><a href="#commonize_denominator-284"><span class="linenos">284</span></a>        <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">converted_dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Scale the weights of the dice so that all of them have the same denominator.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*dice:</strong>  Any number of dice or single outcomes convertible to dice.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A tuple of dice with the same denominator.</p>
</blockquote>
</div>


                </section>
                <section id="reduce">
                            <input id="reduce-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">]]</span>,</span><span class="param">	<span class="n">dice</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">initial</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="reduce-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce-287"><a href="#reduce-287"><span class="linenos">287</span></a><span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span>
</span><span id="reduce-288"><a href="#reduce-288"><span class="linenos">288</span></a>        <span class="n">function</span><span class="p">:</span> <span class="s1">&#39;Callable[[T, T], T | icepool.Die[T] | icepool.RerollType]&#39;</span><span class="p">,</span>
</span><span id="reduce-289"><a href="#reduce-289"><span class="linenos">289</span></a>        <span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;Iterable[T | icepool.Die[T]]&#39;</span><span class="p">,</span>
</span><span id="reduce-290"><a href="#reduce-290"><span class="linenos">290</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="reduce-291"><a href="#reduce-291"><span class="linenos">291</span></a>        <span class="n">initial</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T] | None&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">:</span>
</span><span id="reduce-292"><a href="#reduce-292"><span class="linenos">292</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies a function of two arguments cumulatively to a sequence of dice.</span>
</span><span id="reduce-293"><a href="#reduce-293"><span class="linenos">293</span></a>
</span><span id="reduce-294"><a href="#reduce-294"><span class="linenos">294</span></a><span class="sd">    Analogous to the</span>
</span><span id="reduce-295"><a href="#reduce-295"><span class="linenos">295</span></a><span class="sd">    [`functools` function of the same name.](https://docs.python.org/3/library/functools.html#functools.reduce)</span>
</span><span id="reduce-296"><a href="#reduce-296"><span class="linenos">296</span></a>
</span><span id="reduce-297"><a href="#reduce-297"><span class="linenos">297</span></a><span class="sd">    Args:</span>
</span><span id="reduce-298"><a href="#reduce-298"><span class="linenos">298</span></a><span class="sd">        function: The function to map. The function should take two arguments,</span>
</span><span id="reduce-299"><a href="#reduce-299"><span class="linenos">299</span></a><span class="sd">            which are an outcome from each of two dice, and produce an outcome</span>
</span><span id="reduce-300"><a href="#reduce-300"><span class="linenos">300</span></a><span class="sd">            of the same type. It may also return `Reroll`, in which case the</span>
</span><span id="reduce-301"><a href="#reduce-301"><span class="linenos">301</span></a><span class="sd">            entire sequence is effectively rerolled.</span>
</span><span id="reduce-302"><a href="#reduce-302"><span class="linenos">302</span></a><span class="sd">        dice: A sequence of dice to map the function to, from left to right.</span>
</span><span id="reduce-303"><a href="#reduce-303"><span class="linenos">303</span></a><span class="sd">        initial: If provided, this will be placed at the front of the sequence</span>
</span><span id="reduce-304"><a href="#reduce-304"><span class="linenos">304</span></a><span class="sd">            of dice.</span>
</span><span id="reduce-305"><a href="#reduce-305"><span class="linenos">305</span></a><span class="sd">        again_count, again_depth, again_end: Forwarded to the final die constructor.</span>
</span><span id="reduce-306"><a href="#reduce-306"><span class="linenos">306</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce-307"><a href="#reduce-307"><span class="linenos">307</span></a>    <span class="c1"># Conversion to dice is not necessary since map() takes care of that.</span>
</span><span id="reduce-308"><a href="#reduce-308"><span class="linenos">308</span></a>    <span class="n">iter_dice</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span id="reduce-309"><a href="#reduce-309"><span class="linenos">309</span></a>    <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="reduce-310"><a href="#reduce-310"><span class="linenos">310</span></a>        <span class="n">result</span><span class="p">:</span> <span class="s1">&#39;icepool.Die[T]&#39;</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
</span><span id="reduce-311"><a href="#reduce-311"><span class="linenos">311</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="reduce-312"><a href="#reduce-312"><span class="linenos">312</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">iter_dice</span><span class="p">))</span>
</span><span id="reduce-313"><a href="#reduce-313"><span class="linenos">313</span></a>    <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">iter_dice</span><span class="p">:</span>
</span><span id="reduce-314"><a href="#reduce-314"><span class="linenos">314</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">die</span><span class="p">)</span>
</span><span id="reduce-315"><a href="#reduce-315"><span class="linenos">315</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Applies a function of two arguments cumulatively to a sequence of dice.</p>

<p>Analogous to the
<a href="https://docs.python.org/3/library/functools.html#functools<a href="#reduce">reduce</a>"><code>functools</code> function of the same name.</a></p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>function:</strong>  The function to map. The function should take two arguments,
which are an outcome from each of two dice, and produce an outcome
of the same type. It may also return <code><a href="#Reroll">Reroll</a></code>, in which case the
entire sequence is effectively rerolled.</li>
<li><strong>dice:</strong>  A sequence of dice to map the function to, from left to right.</li>
<li><strong>initial:</strong>  If provided, this will be placed at the front of the sequence
of dice.</li>
<li><strong>again_count, again_depth, again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>
</div>


                </section>
                <section id="accumulate">
                            <input id="accumulate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">accumulate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]]</span>,</span><span class="param">	<span class="n">dice</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">initial</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="accumulate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#accumulate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="accumulate-318"><a href="#accumulate-318"><span class="linenos">318</span></a><span class="k">def</span> <span class="nf">accumulate</span><span class="p">(</span>
</span><span id="accumulate-319"><a href="#accumulate-319"><span class="linenos">319</span></a>        <span class="n">function</span><span class="p">:</span> <span class="s1">&#39;Callable[[T, T], T | icepool.Die[T]]&#39;</span><span class="p">,</span>
</span><span id="accumulate-320"><a href="#accumulate-320"><span class="linenos">320</span></a>        <span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;Iterable[T | icepool.Die[T]]&#39;</span><span class="p">,</span>
</span><span id="accumulate-321"><a href="#accumulate-321"><span class="linenos">321</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="accumulate-322"><a href="#accumulate-322"><span class="linenos">322</span></a>        <span class="n">initial</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T] | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="accumulate-323"><a href="#accumulate-323"><span class="linenos">323</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">]:</span>
</span><span id="accumulate-324"><a href="#accumulate-324"><span class="linenos">324</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies a function of two arguments cumulatively to a sequence of dice, yielding each result in turn.</span>
</span><span id="accumulate-325"><a href="#accumulate-325"><span class="linenos">325</span></a>
</span><span id="accumulate-326"><a href="#accumulate-326"><span class="linenos">326</span></a><span class="sd">    Analogous to the</span>
</span><span id="accumulate-327"><a href="#accumulate-327"><span class="linenos">327</span></a><span class="sd">    [`itertools function of the same name`](https://docs.python.org/3/library/itertools.html#itertools.accumulate)</span>
</span><span id="accumulate-328"><a href="#accumulate-328"><span class="linenos">328</span></a><span class="sd">    , though with no default function and</span>
</span><span id="accumulate-329"><a href="#accumulate-329"><span class="linenos">329</span></a><span class="sd">    the same parameter order as `reduce()`.</span>
</span><span id="accumulate-330"><a href="#accumulate-330"><span class="linenos">330</span></a>
</span><span id="accumulate-331"><a href="#accumulate-331"><span class="linenos">331</span></a><span class="sd">    The number of results is equal to the number of elements of `dice`, with</span>
</span><span id="accumulate-332"><a href="#accumulate-332"><span class="linenos">332</span></a><span class="sd">    one additional element if `initial` is provided.</span>
</span><span id="accumulate-333"><a href="#accumulate-333"><span class="linenos">333</span></a>
</span><span id="accumulate-334"><a href="#accumulate-334"><span class="linenos">334</span></a><span class="sd">    Args:</span>
</span><span id="accumulate-335"><a href="#accumulate-335"><span class="linenos">335</span></a><span class="sd">        function: The function to map. The function should take two arguments,</span>
</span><span id="accumulate-336"><a href="#accumulate-336"><span class="linenos">336</span></a><span class="sd">            which are an outcome from each of two dice.</span>
</span><span id="accumulate-337"><a href="#accumulate-337"><span class="linenos">337</span></a><span class="sd">        dice: A sequence of dice to map the function to, from left to right.</span>
</span><span id="accumulate-338"><a href="#accumulate-338"><span class="linenos">338</span></a><span class="sd">        initial: If provided, this will be placed at the front of the sequence</span>
</span><span id="accumulate-339"><a href="#accumulate-339"><span class="linenos">339</span></a><span class="sd">            of dice.</span>
</span><span id="accumulate-340"><a href="#accumulate-340"><span class="linenos">340</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="accumulate-341"><a href="#accumulate-341"><span class="linenos">341</span></a>    <span class="c1"># Conversion to dice is not necessary since map() takes care of that.</span>
</span><span id="accumulate-342"><a href="#accumulate-342"><span class="linenos">342</span></a>    <span class="n">iter_dice</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span id="accumulate-343"><a href="#accumulate-343"><span class="linenos">343</span></a>    <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="accumulate-344"><a href="#accumulate-344"><span class="linenos">344</span></a>        <span class="n">result</span><span class="p">:</span> <span class="s1">&#39;icepool.Die[T]&#39;</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
</span><span id="accumulate-345"><a href="#accumulate-345"><span class="linenos">345</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="accumulate-346"><a href="#accumulate-346"><span class="linenos">346</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="accumulate-347"><a href="#accumulate-347"><span class="linenos">347</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">iter_dice</span><span class="p">))</span>
</span><span id="accumulate-348"><a href="#accumulate-348"><span class="linenos">348</span></a>        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span><span id="accumulate-349"><a href="#accumulate-349"><span class="linenos">349</span></a>            <span class="k">return</span>
</span><span id="accumulate-350"><a href="#accumulate-350"><span class="linenos">350</span></a>    <span class="k">yield</span> <span class="n">result</span>
</span><span id="accumulate-351"><a href="#accumulate-351"><span class="linenos">351</span></a>    <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">iter_dice</span><span class="p">:</span>
</span><span id="accumulate-352"><a href="#accumulate-352"><span class="linenos">352</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">die</span><span class="p">)</span>
</span><span id="accumulate-353"><a href="#accumulate-353"><span class="linenos">353</span></a>        <span class="k">yield</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Applies a function of two arguments cumulatively to a sequence of dice, yielding each result in turn.</p>

<p>Analogous to the
<a href="https://docs.python.org/3/library/itertools.html#itertools<a href="#accumulate">accumulate</a>"><code>itertools function of the same name</code></a>
, though with no default function and
the same parameter order as <code><a href="#reduce">reduce()</a></code>.</p>

<p>The number of results is equal to the number of elements of <code>dice</code>, with
one additional element if <code>initial</code> is provided.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>function:</strong>  The function to map. The function should take two arguments,
which are an outcome from each of two dice.</li>
<li><strong>dice:</strong>  A sequence of dice to map the function to, from left to right.</li>
<li><strong>initial:</strong>  If provided, this will be placed at the front of the sequence
of dice.</li>
</ul>
</div>


                </section>
                <section id="map">
                            <input id="map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n"><a href="#Outcome">Outcome</a></span> <span class="o">|</span> <span class="n"><a href="#Die">Die</a></span> <span class="o">|</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="map-378"><a href="#map-378"><span class="linenos">378</span></a><span class="k">def</span> <span class="nf">map</span><span class="p">(</span>
</span><span id="map-379"><a href="#map-379"><span class="linenos">379</span></a>    <span class="n">repl</span><span class="p">:</span>
</span><span id="map-380"><a href="#map-380"><span class="linenos">380</span></a>    <span class="s1">&#39;Callable[..., T | icepool.Die[T] | icepool.RerollType | icepool.AgainExpression] | Mapping[Any, T | icepool.Die[T] | icepool.RerollType | icepool.AgainExpression]&#39;</span><span class="p">,</span>
</span><span id="map-381"><a href="#map-381"><span class="linenos">381</span></a>    <span class="o">/</span><span class="p">,</span>
</span><span id="map-382"><a href="#map-382"><span class="linenos">382</span></a>    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;Outcome | icepool.Die | icepool.MultisetExpression&#39;</span><span class="p">,</span>
</span><span id="map-383"><a href="#map-383"><span class="linenos">383</span></a>    <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map-384"><a href="#map-384"><span class="linenos">384</span></a>    <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="map-385"><a href="#map-385"><span class="linenos">385</span></a>    <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map-386"><a href="#map-386"><span class="linenos">386</span></a>    <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map-387"><a href="#map-387"><span class="linenos">387</span></a>    <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T] | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="map-388"><a href="#map-388"><span class="linenos">388</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">:</span>
</span><span id="map-389"><a href="#map-389"><span class="linenos">389</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies `func(outcome_of_die_0, outcome_of_die_1, ...)` for all joint outcomes, returning a Die.</span>
</span><span id="map-390"><a href="#map-390"><span class="linenos">390</span></a>
</span><span id="map-391"><a href="#map-391"><span class="linenos">391</span></a><span class="sd">    See `map_function` for a decorator version of this.</span>
</span><span id="map-392"><a href="#map-392"><span class="linenos">392</span></a>
</span><span id="map-393"><a href="#map-393"><span class="linenos">393</span></a><span class="sd">    Example: `map(lambda a, b: a + b, d6, d6)` is the same as d6 + d6.</span>
</span><span id="map-394"><a href="#map-394"><span class="linenos">394</span></a>
</span><span id="map-395"><a href="#map-395"><span class="linenos">395</span></a><span class="sd">    `map()` is flexible but not very efficient for more than a few dice.</span>
</span><span id="map-396"><a href="#map-396"><span class="linenos">396</span></a><span class="sd">    If at all possible, use `reduce()`, `MultisetExpression` methods, and/or</span>
</span><span id="map-397"><a href="#map-397"><span class="linenos">397</span></a><span class="sd">    `MultisetEvaluator`s. Even `Pool.expand()` (which sorts rolls) is more</span>
</span><span id="map-398"><a href="#map-398"><span class="linenos">398</span></a><span class="sd">    efficient than using `map` on the dice in order.</span>
</span><span id="map-399"><a href="#map-399"><span class="linenos">399</span></a>
</span><span id="map-400"><a href="#map-400"><span class="linenos">400</span></a><span class="sd">    `Again` can be used but is not recommended with `repeat` other than 1.</span>
</span><span id="map-401"><a href="#map-401"><span class="linenos">401</span></a>
</span><span id="map-402"><a href="#map-402"><span class="linenos">402</span></a><span class="sd">    Args:</span>
</span><span id="map-403"><a href="#map-403"><span class="linenos">403</span></a><span class="sd">        repl: One of the following:</span>
</span><span id="map-404"><a href="#map-404"><span class="linenos">404</span></a><span class="sd">            * A callable that takes in one outcome per element of args and</span>
</span><span id="map-405"><a href="#map-405"><span class="linenos">405</span></a><span class="sd">                produces a new outcome.</span>
</span><span id="map-406"><a href="#map-406"><span class="linenos">406</span></a><span class="sd">            * A mapping from old outcomes to new outcomes.</span>
</span><span id="map-407"><a href="#map-407"><span class="linenos">407</span></a><span class="sd">                Unmapped old outcomes stay the same.</span>
</span><span id="map-408"><a href="#map-408"><span class="linenos">408</span></a><span class="sd">                In this case args must have exactly one element.</span>
</span><span id="map-409"><a href="#map-409"><span class="linenos">409</span></a><span class="sd">            As with the `Die` constructor, the new outcomes:</span>
</span><span id="map-410"><a href="#map-410"><span class="linenos">410</span></a><span class="sd">            * May be dice rather than just single outcomes.</span>
</span><span id="map-411"><a href="#map-411"><span class="linenos">411</span></a><span class="sd">            * The special value `icepool.Reroll` will reroll that old outcome.</span>
</span><span id="map-412"><a href="#map-412"><span class="linenos">412</span></a><span class="sd">            * `tuples` containing `Population`s will be `tupleize`d into</span>
</span><span id="map-413"><a href="#map-413"><span class="linenos">413</span></a><span class="sd">                `Population`s of `tuple`s.</span>
</span><span id="map-414"><a href="#map-414"><span class="linenos">414</span></a><span class="sd">                This does not apply to subclasses of `tuple`s such as `namedtuple`</span>
</span><span id="map-415"><a href="#map-415"><span class="linenos">415</span></a><span class="sd">                or other classes such as `Vector`.</span>
</span><span id="map-416"><a href="#map-416"><span class="linenos">416</span></a><span class="sd">        *args: `func` will be called with all joint outcomes of these.</span>
</span><span id="map-417"><a href="#map-417"><span class="linenos">417</span></a><span class="sd">            Allowed arg types are:</span>
</span><span id="map-418"><a href="#map-418"><span class="linenos">418</span></a><span class="sd">            * Single outcome.</span>
</span><span id="map-419"><a href="#map-419"><span class="linenos">419</span></a><span class="sd">            * `Die`. All outcomes will be sent to `func`.</span>
</span><span id="map-420"><a href="#map-420"><span class="linenos">420</span></a><span class="sd">            * `MultisetExpression`. All sorted tuples of outcomes will be sent</span>
</span><span id="map-421"><a href="#map-421"><span class="linenos">421</span></a><span class="sd">                to `func`, as `MultisetExpression.expand()`. The expression must</span>
</span><span id="map-422"><a href="#map-422"><span class="linenos">422</span></a><span class="sd">                be fully bound.</span>
</span><span id="map-423"><a href="#map-423"><span class="linenos">423</span></a><span class="sd">        star: If `True`, the first of the args will be unpacked before giving</span>
</span><span id="map-424"><a href="#map-424"><span class="linenos">424</span></a><span class="sd">            them to `func`.</span>
</span><span id="map-425"><a href="#map-425"><span class="linenos">425</span></a><span class="sd">            If not provided, it will be guessed based on the signature of `func`</span>
</span><span id="map-426"><a href="#map-426"><span class="linenos">426</span></a><span class="sd">            and the number of arguments.</span>
</span><span id="map-427"><a href="#map-427"><span class="linenos">427</span></a><span class="sd">        repeat: This will be repeated with the same arguments on the</span>
</span><span id="map-428"><a href="#map-428"><span class="linenos">428</span></a><span class="sd">            result this many times, except the first of `args` will be replaced</span>
</span><span id="map-429"><a href="#map-429"><span class="linenos">429</span></a><span class="sd">            by the result of the previous iteration.</span>
</span><span id="map-430"><a href="#map-430"><span class="linenos">430</span></a>
</span><span id="map-431"><a href="#map-431"><span class="linenos">431</span></a><span class="sd">            Note that returning `Reroll` from `repl` will effectively reroll all</span>
</span><span id="map-432"><a href="#map-432"><span class="linenos">432</span></a><span class="sd">            arguments, including the first argument which represents the result</span>
</span><span id="map-433"><a href="#map-433"><span class="linenos">433</span></a><span class="sd">            of the process up to this point. If you only want to reroll the</span>
</span><span id="map-434"><a href="#map-434"><span class="linenos">434</span></a><span class="sd">            current stage, you can nest another `map` inside `repl`.</span>
</span><span id="map-435"><a href="#map-435"><span class="linenos">435</span></a>
</span><span id="map-436"><a href="#map-436"><span class="linenos">436</span></a><span class="sd">            EXPERIMENTAL: If set to `None`, the result will be as if this</span>
</span><span id="map-437"><a href="#map-437"><span class="linenos">437</span></a><span class="sd">            were repeated an infinite number of times. In this case, the</span>
</span><span id="map-438"><a href="#map-438"><span class="linenos">438</span></a><span class="sd">            result will be in simplest form.</span>
</span><span id="map-439"><a href="#map-439"><span class="linenos">439</span></a><span class="sd">        again_count, again_depth, again_end: Forwarded to the final die constructor.</span>
</span><span id="map-440"><a href="#map-440"><span class="linenos">440</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="map-441"><a href="#map-441"><span class="linenos">441</span></a>    <span class="n">transition_function</span> <span class="o">=</span> <span class="n">_canonicalize_transition_function</span><span class="p">(</span>
</span><span id="map-442"><a href="#map-442"><span class="linenos">442</span></a>        <span class="n">repl</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">star</span><span class="p">)</span>
</span><span id="map-443"><a href="#map-443"><span class="linenos">443</span></a>
</span><span id="map-444"><a href="#map-444"><span class="linenos">444</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="map-445"><a href="#map-445"><span class="linenos">445</span></a>        <span class="k">if</span> <span class="n">repeat</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="map-446"><a href="#map-446"><span class="linenos">446</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;If no arguments are given, repeat must be 1.&#39;</span><span class="p">)</span>
</span><span id="map-447"><a href="#map-447"><span class="linenos">447</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">transition_function</span><span class="p">()],</span>
</span><span id="map-448"><a href="#map-448"><span class="linenos">448</span></a>                           <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="map-449"><a href="#map-449"><span class="linenos">449</span></a>                           <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="map-450"><a href="#map-450"><span class="linenos">450</span></a>                           <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="map-451"><a href="#map-451"><span class="linenos">451</span></a>
</span><span id="map-452"><a href="#map-452"><span class="linenos">452</span></a>    <span class="c1"># Here len(args) is at least 1.</span>
</span><span id="map-453"><a href="#map-453"><span class="linenos">453</span></a>
</span><span id="map-454"><a href="#map-454"><span class="linenos">454</span></a>    <span class="n">first_arg</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="map-455"><a href="#map-455"><span class="linenos">455</span></a>    <span class="n">extra_args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="map-456"><a href="#map-456"><span class="linenos">456</span></a>
</span><span id="map-457"><a href="#map-457"><span class="linenos">457</span></a>    <span class="k">if</span> <span class="n">repeat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="map-458"><a href="#map-458"><span class="linenos">458</span></a>        <span class="k">if</span> <span class="n">repeat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="map-459"><a href="#map-459"><span class="linenos">459</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;repeat cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="map-460"><a href="#map-460"><span class="linenos">460</span></a>        <span class="k">elif</span> <span class="n">repeat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="map-461"><a href="#map-461"><span class="linenos">461</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">first_arg</span><span class="p">])</span>
</span><span id="map-462"><a href="#map-462"><span class="linenos">462</span></a>        <span class="k">elif</span> <span class="n">repeat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="map-463"><a href="#map-463"><span class="linenos">463</span></a>            <span class="n">final_outcomes</span><span class="p">:</span> <span class="s1">&#39;list[T | icepool.Die[T] | icepool.RerollType | icepool.AgainExpression]&#39;</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="map-464"><a href="#map-464"><span class="linenos">464</span></a>            <span class="n">final_quantities</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="map-465"><a href="#map-465"><span class="linenos">465</span></a>            <span class="k">for</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">final_quantity</span> <span class="ow">in</span> <span class="n">iter_cartesian_product</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="map-466"><a href="#map-466"><span class="linenos">466</span></a>                <span class="n">final_outcome</span> <span class="o">=</span> <span class="n">transition_function</span><span class="p">(</span><span class="o">*</span><span class="n">outcomes</span><span class="p">)</span>
</span><span id="map-467"><a href="#map-467"><span class="linenos">467</span></a>                <span class="k">if</span> <span class="n">final_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="map-468"><a href="#map-468"><span class="linenos">468</span></a>                    <span class="n">final_outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_outcome</span><span class="p">)</span>
</span><span id="map-469"><a href="#map-469"><span class="linenos">469</span></a>                    <span class="n">final_quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_quantity</span><span class="p">)</span>
</span><span id="map-470"><a href="#map-470"><span class="linenos">470</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">final_outcomes</span><span class="p">,</span>
</span><span id="map-471"><a href="#map-471"><span class="linenos">471</span></a>                               <span class="n">final_quantities</span><span class="p">,</span>
</span><span id="map-472"><a href="#map-472"><span class="linenos">472</span></a>                               <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="map-473"><a href="#map-473"><span class="linenos">473</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="map-474"><a href="#map-474"><span class="linenos">474</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="map-475"><a href="#map-475"><span class="linenos">475</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="map-476"><a href="#map-476"><span class="linenos">476</span></a>            <span class="n">result</span><span class="p">:</span> <span class="s1">&#39;icepool.Die[T]&#39;</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">first_arg</span><span class="p">])</span>
</span><span id="map-477"><a href="#map-477"><span class="linenos">477</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat</span><span class="p">):</span>
</span><span id="map-478"><a href="#map-478"><span class="linenos">478</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">transition_function</span><span class="p">,</span>
</span><span id="map-479"><a href="#map-479"><span class="linenos">479</span></a>                                     <span class="n">result</span><span class="p">,</span>
</span><span id="map-480"><a href="#map-480"><span class="linenos">480</span></a>                                     <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="map-481"><a href="#map-481"><span class="linenos">481</span></a>                                     <span class="n">star</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="map-482"><a href="#map-482"><span class="linenos">482</span></a>                                     <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="map-483"><a href="#map-483"><span class="linenos">483</span></a>                                     <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="map-484"><a href="#map-484"><span class="linenos">484</span></a>                                     <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="map-485"><a href="#map-485"><span class="linenos">485</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="map-486"><a href="#map-486"><span class="linenos">486</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="map-487"><a href="#map-487"><span class="linenos">487</span></a>        <span class="c1"># Infinite repeat.</span>
</span><span id="map-488"><a href="#map-488"><span class="linenos">488</span></a>        <span class="c1"># T_co and U should be the same in this case.</span>
</span><span id="map-489"><a href="#map-489"><span class="linenos">489</span></a>        <span class="k">def</span> <span class="nf">unary_transition_function</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
</span><span id="map-490"><a href="#map-490"><span class="linenos">490</span></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">transition_function</span><span class="p">,</span>
</span><span id="map-491"><a href="#map-491"><span class="linenos">491</span></a>                       <span class="n">state</span><span class="p">,</span>
</span><span id="map-492"><a href="#map-492"><span class="linenos">492</span></a>                       <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="map-493"><a href="#map-493"><span class="linenos">493</span></a>                       <span class="n">star</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="map-494"><a href="#map-494"><span class="linenos">494</span></a>                       <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="map-495"><a href="#map-495"><span class="linenos">495</span></a>                       <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="map-496"><a href="#map-496"><span class="linenos">496</span></a>                       <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="map-497"><a href="#map-497"><span class="linenos">497</span></a>
</span><span id="map-498"><a href="#map-498"><span class="linenos">498</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">markov_chain</span><span class="o">.</span><span class="n">absorbing_markov_chain</span><span class="p">(</span>
</span><span id="map-499"><a href="#map-499"><span class="linenos">499</span></a>            <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">unary_transition_function</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Applies <code>func(outcome_of_die_0, outcome_of_die_1, ...)</code> for all joint outcomes, returning a Die.</p>

<p>See <code><a href="#map_function">map_function</a></code> for a decorator version of this.</p>

<p>Example: <code>map(lambda a, b: a + b, d6, d6)</code> is the same as d6 + d6.</p>

<p><code><a href="#map">map()</a></code> is flexible but not very efficient for more than a few dice.
If at all possible, use <code><a href="#reduce">reduce()</a></code>, <code><a href="#MultisetExpression">MultisetExpression</a></code> methods, and/or
<code><a href="#MultisetEvaluator">MultisetEvaluator</a></code>s. Even <code><a href="#Pool.expand">Pool.expand()</a></code> (which sorts rolls) is more
efficient than using <code><a href="#map">map</a></code> on the dice in order.</p>

<p><code><a href="#Again">Again</a></code> can be used but is not recommended with <code>repeat</code> other than 1.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>repl:</strong>  One of the following:
<ul>
<li>A callable that takes in one outcome per element of args and
produces a new outcome.</li>
<li>A mapping from old outcomes to new outcomes.
Unmapped old outcomes stay the same.
In this case args must have exactly one element.
As with the <code><a href="#Die">Die</a></code> constructor, the new outcomes:</li>
<li>May be dice rather than just single outcomes.</li>
<li>The special value <code><a href="#Reroll">Reroll</a></code> will reroll that old outcome.</li>
<li><code>tuples</code> containing <code><a href="#Population">Population</a></code>s will be <code><a href="#tupleize">tupleize</a></code>d into
<code><a href="#Population">Population</a></code>s of <code>tuple</code>s.
This does not apply to subclasses of <code>tuple</code>s such as <code>namedtuple</code>
or other classes such as <code><a href="#Vector">Vector</a></code>.</li>
</ul></li>
<li><strong>*args:</strong>  <code>func</code> will be called with all joint outcomes of these.
Allowed arg types are:
<ul>
<li>Single outcome.</li>
<li><code><a href="#Die">Die</a></code>. All outcomes will be sent to <code>func</code>.</li>
<li><code><a href="#MultisetExpression">MultisetExpression</a></code>. All sorted tuples of outcomes will be sent
to <code>func</code>, as <code><a href="#MultisetExpression.expand">MultisetExpression.expand()</a></code>. The expression must
be fully bound.</li>
</ul></li>
<li><strong>star:</strong>  If <code>True</code>, the first of the args will be unpacked before giving
them to <code>func</code>.
If not provided, it will be guessed based on the signature of <code>func</code>
and the number of arguments.</li>
<li><p><strong>repeat:</strong>  This will be repeated with the same arguments on the
result this many times, except the first of <code>args</code> will be replaced
by the result of the previous iteration.</p>

<p>Note that returning <code><a href="#Reroll">Reroll</a></code> from <code>repl</code> will effectively reroll all
arguments, including the first argument which represents the result
of the process up to this point. If you only want to reroll the
current stage, you can nest another <code><a href="#map">map</a></code> inside <code>repl</code>.</p>

<p>EXPERIMENTAL: If set to <code>None</code>, the result will be as if this
were repeated an infinite number of times. In this case, the
result will be in simplest form.</p></li>
<li><strong>again_count, again_depth, again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>
</div>


                </section>
                <section id="map_function">
                            <input id="map_function-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_function</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">again_end</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]],</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]]]</span>:</span></span>

                <label class="view-source-button" for="map_function-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#map_function"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="map_function-539"><a href="#map_function-539"><span class="linenos">539</span></a><span class="k">def</span> <span class="nf">map_function</span><span class="p">(</span>
</span><span id="map_function-540"><a href="#map_function-540"><span class="linenos">540</span></a>    <span class="n">function</span><span class="p">:</span>
</span><span id="map_function-541"><a href="#map_function-541"><span class="linenos">541</span></a>    <span class="s1">&#39;Callable[..., T | icepool.Die[T] | icepool.RerollType | icepool.AgainExpression] | None&#39;</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map_function-542"><a href="#map_function-542"><span class="linenos">542</span></a>    <span class="o">/</span><span class="p">,</span>
</span><span id="map_function-543"><a href="#map_function-543"><span class="linenos">543</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="map_function-544"><a href="#map_function-544"><span class="linenos">544</span></a>    <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map_function-545"><a href="#map_function-545"><span class="linenos">545</span></a>    <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="map_function-546"><a href="#map_function-546"><span class="linenos">546</span></a>    <span class="n">again_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map_function-547"><a href="#map_function-547"><span class="linenos">547</span></a>    <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map_function-548"><a href="#map_function-548"><span class="linenos">548</span></a>    <span class="n">again_end</span><span class="p">:</span> <span class="s1">&#39;T | icepool.Die[T] | icepool.RerollType | None&#39;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="map_function-549"><a href="#map_function-549"><span class="linenos">549</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Callable[..., icepool.Die[T]] | Callable[..., Callable[..., icepool.Die[T]]]&#39;</span><span class="p">:</span>
</span><span id="map_function-550"><a href="#map_function-550"><span class="linenos">550</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator that turns a function that takes outcomes into a function that takes dice.</span>
</span><span id="map_function-551"><a href="#map_function-551"><span class="linenos">551</span></a>
</span><span id="map_function-552"><a href="#map_function-552"><span class="linenos">552</span></a><span class="sd">    The result must be a `Die`.</span>
</span><span id="map_function-553"><a href="#map_function-553"><span class="linenos">553</span></a>
</span><span id="map_function-554"><a href="#map_function-554"><span class="linenos">554</span></a><span class="sd">    This is basically a decorator version of `map()` and produces behavior</span>
</span><span id="map_function-555"><a href="#map_function-555"><span class="linenos">555</span></a><span class="sd">    similar to AnyDice functions, though Icepool has different typing rules</span>
</span><span id="map_function-556"><a href="#map_function-556"><span class="linenos">556</span></a><span class="sd">    among other differences.</span>
</span><span id="map_function-557"><a href="#map_function-557"><span class="linenos">557</span></a>
</span><span id="map_function-558"><a href="#map_function-558"><span class="linenos">558</span></a><span class="sd">    `map_function` can either be used with no arguments:</span>
</span><span id="map_function-559"><a href="#map_function-559"><span class="linenos">559</span></a>
</span><span id="map_function-560"><a href="#map_function-560"><span class="linenos">560</span></a><span class="sd">    ```python</span>
</span><span id="map_function-561"><a href="#map_function-561"><span class="linenos">561</span></a><span class="sd">    @map_function</span>
</span><span id="map_function-562"><a href="#map_function-562"><span class="linenos">562</span></a><span class="sd">    def explode_six(x):</span>
</span><span id="map_function-563"><a href="#map_function-563"><span class="linenos">563</span></a><span class="sd">        if x == 6:</span>
</span><span id="map_function-564"><a href="#map_function-564"><span class="linenos">564</span></a><span class="sd">            return 6 + Again</span>
</span><span id="map_function-565"><a href="#map_function-565"><span class="linenos">565</span></a><span class="sd">        else:</span>
</span><span id="map_function-566"><a href="#map_function-566"><span class="linenos">566</span></a><span class="sd">            return x</span>
</span><span id="map_function-567"><a href="#map_function-567"><span class="linenos">567</span></a>
</span><span id="map_function-568"><a href="#map_function-568"><span class="linenos">568</span></a><span class="sd">    explode_six(d6, again_depth=2)</span>
</span><span id="map_function-569"><a href="#map_function-569"><span class="linenos">569</span></a><span class="sd">    ```</span>
</span><span id="map_function-570"><a href="#map_function-570"><span class="linenos">570</span></a>
</span><span id="map_function-571"><a href="#map_function-571"><span class="linenos">571</span></a><span class="sd">    Or with keyword arguments, in which case the extra arguments are bound:</span>
</span><span id="map_function-572"><a href="#map_function-572"><span class="linenos">572</span></a>
</span><span id="map_function-573"><a href="#map_function-573"><span class="linenos">573</span></a><span class="sd">    ```python</span>
</span><span id="map_function-574"><a href="#map_function-574"><span class="linenos">574</span></a><span class="sd">    @map_function(again_depth=2)</span>
</span><span id="map_function-575"><a href="#map_function-575"><span class="linenos">575</span></a><span class="sd">    def explode_six(x):</span>
</span><span id="map_function-576"><a href="#map_function-576"><span class="linenos">576</span></a><span class="sd">        if x == 6:</span>
</span><span id="map_function-577"><a href="#map_function-577"><span class="linenos">577</span></a><span class="sd">            return 6 + Again</span>
</span><span id="map_function-578"><a href="#map_function-578"><span class="linenos">578</span></a><span class="sd">        else:</span>
</span><span id="map_function-579"><a href="#map_function-579"><span class="linenos">579</span></a><span class="sd">            return x</span>
</span><span id="map_function-580"><a href="#map_function-580"><span class="linenos">580</span></a>
</span><span id="map_function-581"><a href="#map_function-581"><span class="linenos">581</span></a><span class="sd">    explode_six(d6)</span>
</span><span id="map_function-582"><a href="#map_function-582"><span class="linenos">582</span></a><span class="sd">    ```</span>
</span><span id="map_function-583"><a href="#map_function-583"><span class="linenos">583</span></a>
</span><span id="map_function-584"><a href="#map_function-584"><span class="linenos">584</span></a><span class="sd">    Args:</span>
</span><span id="map_function-585"><a href="#map_function-585"><span class="linenos">585</span></a><span class="sd">        again_count, again_depth, again_end: Forwarded to the final die constructor.</span>
</span><span id="map_function-586"><a href="#map_function-586"><span class="linenos">586</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="map_function-587"><a href="#map_function-587"><span class="linenos">587</span></a>
</span><span id="map_function-588"><a href="#map_function-588"><span class="linenos">588</span></a>    <span class="k">if</span> <span class="n">function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="map_function-589"><a href="#map_function-589"><span class="linenos">589</span></a>        <span class="k">return</span> <span class="n">update_wrapper</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span> <span class="n">function</span><span class="p">),</span> <span class="n">function</span><span class="p">)</span>
</span><span id="map_function-590"><a href="#map_function-590"><span class="linenos">590</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="map_function-591"><a href="#map_function-591"><span class="linenos">591</span></a>
</span><span id="map_function-592"><a href="#map_function-592"><span class="linenos">592</span></a>        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span>
</span><span id="map_function-593"><a href="#map_function-593"><span class="linenos">593</span></a>            <span class="n">function</span><span class="p">:</span>
</span><span id="map_function-594"><a href="#map_function-594"><span class="linenos">594</span></a>            <span class="s1">&#39;Callable[..., T | icepool.Die[T] | icepool.RerollType | icepool.AgainExpression]&#39;</span>
</span><span id="map_function-595"><a href="#map_function-595"><span class="linenos">595</span></a>        <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Callable[..., icepool.Die[T]]&#39;</span><span class="p">:</span>
</span><span id="map_function-596"><a href="#map_function-596"><span class="linenos">596</span></a>
</span><span id="map_function-597"><a href="#map_function-597"><span class="linenos">597</span></a>            <span class="k">return</span> <span class="n">update_wrapper</span><span class="p">(</span>
</span><span id="map_function-598"><a href="#map_function-598"><span class="linenos">598</span></a>                <span class="n">partial</span><span class="p">(</span><span class="nb">map</span><span class="p">,</span>
</span><span id="map_function-599"><a href="#map_function-599"><span class="linenos">599</span></a>                        <span class="n">function</span><span class="p">,</span>
</span><span id="map_function-600"><a href="#map_function-600"><span class="linenos">600</span></a>                        <span class="n">star</span><span class="o">=</span><span class="n">star</span><span class="p">,</span>
</span><span id="map_function-601"><a href="#map_function-601"><span class="linenos">601</span></a>                        <span class="n">repeat</span><span class="o">=</span><span class="n">repeat</span><span class="p">,</span>
</span><span id="map_function-602"><a href="#map_function-602"><span class="linenos">602</span></a>                        <span class="n">again_count</span><span class="o">=</span><span class="n">again_count</span><span class="p">,</span>
</span><span id="map_function-603"><a href="#map_function-603"><span class="linenos">603</span></a>                        <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="map_function-604"><a href="#map_function-604"><span class="linenos">604</span></a>                        <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">),</span> <span class="n">function</span><span class="p">)</span>
</span><span id="map_function-605"><a href="#map_function-605"><span class="linenos">605</span></a>
</span><span id="map_function-606"><a href="#map_function-606"><span class="linenos">606</span></a>        <span class="k">return</span> <span class="n">decorator</span>
</span></pre></div>


            <div class="docstring"><p>Decorator that turns a function that takes outcomes into a function that takes dice.</p>

<p>The result must be a <code><a href="#Die">Die</a></code>.</p>

<p>This is basically a decorator version of <code><a href="#map">map()</a></code> and produces behavior
similar to AnyDice functions, though Icepool has different typing rules
among other differences.</p>

<p><code><a href="#map_function">map_function</a></code> can either be used with no arguments:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nd">@map_function</span>
<span class="k">def</span> <span class="nf">explode_six</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">Again</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">explode_six</span><span class="p">(</span><span class="n">d6</span><span class="p">,</span> <span class="n">again_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>

<p>Or with keyword arguments, in which case the extra arguments are bound:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nd">@map_function</span><span class="p">(</span><span class="n">again_depth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">explode_six</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">Again</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">x</span>

<span class="n">explode_six</span><span class="p">(</span><span class="n">d6</span><span class="p">)</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>again_count, again_depth, again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>
</div>


                </section>
                <section id="map_and_time">
                            <input id="map_and_time-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_and_time</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">AgainExpression</span><span class="p">]]]</span>,</span><span class="param">	<span class="n">state</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">extra_args</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="map_and_time-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#map_and_time"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="map_and_time-609"><a href="#map_and_time-609"><span class="linenos">609</span></a><span class="k">def</span> <span class="nf">map_and_time</span><span class="p">(</span>
</span><span id="map_and_time-610"><a href="#map_and_time-610"><span class="linenos">610</span></a>        <span class="n">repl</span><span class="p">:</span>
</span><span id="map_and_time-611"><a href="#map_and_time-611"><span class="linenos">611</span></a>    <span class="s1">&#39;Callable[..., T | icepool.Die[T] | icepool.RerollType | icepool.AgainExpression] | Mapping[Any, T | icepool.Die[T] | icepool.RerollType | icepool.AgainExpression]&#39;</span><span class="p">,</span>
</span><span id="map_and_time-612"><a href="#map_and_time-612"><span class="linenos">612</span></a>        <span class="n">state</span><span class="p">,</span>
</span><span id="map_and_time-613"><a href="#map_and_time-613"><span class="linenos">613</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="map_and_time-614"><a href="#map_and_time-614"><span class="linenos">614</span></a>        <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="map_and_time-615"><a href="#map_and_time-615"><span class="linenos">615</span></a>        <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map_and_time-616"><a href="#map_and_time-616"><span class="linenos">616</span></a>        <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[T, int]]&#39;</span><span class="p">:</span>
</span><span id="map_and_time-617"><a href="#map_and_time-617"><span class="linenos">617</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Repeatedly map outcomes of the state to other outcomes, while also</span>
</span><span id="map_and_time-618"><a href="#map_and_time-618"><span class="linenos">618</span></a><span class="sd">    counting timesteps.</span>
</span><span id="map_and_time-619"><a href="#map_and_time-619"><span class="linenos">619</span></a>
</span><span id="map_and_time-620"><a href="#map_and_time-620"><span class="linenos">620</span></a><span class="sd">    This is useful for representing processes.</span>
</span><span id="map_and_time-621"><a href="#map_and_time-621"><span class="linenos">621</span></a>
</span><span id="map_and_time-622"><a href="#map_and_time-622"><span class="linenos">622</span></a><span class="sd">    The outcomes of the result are  `(outcome, time)`, where `time` is the</span>
</span><span id="map_and_time-623"><a href="#map_and_time-623"><span class="linenos">623</span></a><span class="sd">    number of repeats needed to reach an absorbing outcome (an outcome that</span>
</span><span id="map_and_time-624"><a href="#map_and_time-624"><span class="linenos">624</span></a><span class="sd">    only leads to itself), or `repeat`, whichever is lesser.</span>
</span><span id="map_and_time-625"><a href="#map_and_time-625"><span class="linenos">625</span></a>
</span><span id="map_and_time-626"><a href="#map_and_time-626"><span class="linenos">626</span></a><span class="sd">    This will return early if it reaches a fixed point.</span>
</span><span id="map_and_time-627"><a href="#map_and_time-627"><span class="linenos">627</span></a><span class="sd">    Therefore, you can set `repeat` equal to the maximum number of</span>
</span><span id="map_and_time-628"><a href="#map_and_time-628"><span class="linenos">628</span></a><span class="sd">    time you could possibly be interested in without worrying about</span>
</span><span id="map_and_time-629"><a href="#map_and_time-629"><span class="linenos">629</span></a><span class="sd">    it causing extra computations after the fixed point.</span>
</span><span id="map_and_time-630"><a href="#map_and_time-630"><span class="linenos">630</span></a>
</span><span id="map_and_time-631"><a href="#map_and_time-631"><span class="linenos">631</span></a><span class="sd">    Args:</span>
</span><span id="map_and_time-632"><a href="#map_and_time-632"><span class="linenos">632</span></a><span class="sd">        repl: One of the following:</span>
</span><span id="map_and_time-633"><a href="#map_and_time-633"><span class="linenos">633</span></a><span class="sd">            * A callable returning a new outcome for each old outcome.</span>
</span><span id="map_and_time-634"><a href="#map_and_time-634"><span class="linenos">634</span></a><span class="sd">            * A mapping from old outcomes to new outcomes.</span>
</span><span id="map_and_time-635"><a href="#map_and_time-635"><span class="linenos">635</span></a><span class="sd">                Unmapped old outcomes stay the same.</span>
</span><span id="map_and_time-636"><a href="#map_and_time-636"><span class="linenos">636</span></a><span class="sd">            The new outcomes may be dice rather than just single outcomes.</span>
</span><span id="map_and_time-637"><a href="#map_and_time-637"><span class="linenos">637</span></a><span class="sd">            The special value `icepool.Reroll` will reroll that old outcome.</span>
</span><span id="map_and_time-638"><a href="#map_and_time-638"><span class="linenos">638</span></a><span class="sd">        star: If `True`, the first of the args will be unpacked before giving</span>
</span><span id="map_and_time-639"><a href="#map_and_time-639"><span class="linenos">639</span></a><span class="sd">            them to `func`.</span>
</span><span id="map_and_time-640"><a href="#map_and_time-640"><span class="linenos">640</span></a><span class="sd">            If not provided, it will be guessed based on the signature of `func`</span>
</span><span id="map_and_time-641"><a href="#map_and_time-641"><span class="linenos">641</span></a><span class="sd">            and the number of arguments.</span>
</span><span id="map_and_time-642"><a href="#map_and_time-642"><span class="linenos">642</span></a><span class="sd">        repeat: This will be repeated with the same arguments on the result</span>
</span><span id="map_and_time-643"><a href="#map_and_time-643"><span class="linenos">643</span></a><span class="sd">            this many times.</span>
</span><span id="map_and_time-644"><a href="#map_and_time-644"><span class="linenos">644</span></a>
</span><span id="map_and_time-645"><a href="#map_and_time-645"><span class="linenos">645</span></a><span class="sd">    Returns:</span>
</span><span id="map_and_time-646"><a href="#map_and_time-646"><span class="linenos">646</span></a><span class="sd">        The `Die` after the modification.</span>
</span><span id="map_and_time-647"><a href="#map_and_time-647"><span class="linenos">647</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="map_and_time-648"><a href="#map_and_time-648"><span class="linenos">648</span></a>    <span class="n">transition_function</span> <span class="o">=</span> <span class="n">_canonicalize_transition_function</span><span class="p">(</span>
</span><span id="map_and_time-649"><a href="#map_and_time-649"><span class="linenos">649</span></a>        <span class="n">repl</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">extra_args</span><span class="p">),</span> <span class="n">star</span><span class="p">)</span>
</span><span id="map_and_time-650"><a href="#map_and_time-650"><span class="linenos">650</span></a>
</span><span id="map_and_time-651"><a href="#map_and_time-651"><span class="linenos">651</span></a>    <span class="n">result</span><span class="p">:</span> <span class="s1">&#39;icepool.Die[tuple[T, int]]&#39;</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="map_and_time-652"><a href="#map_and_time-652"><span class="linenos">652</span></a>
</span><span id="map_and_time-653"><a href="#map_and_time-653"><span class="linenos">653</span></a>    <span class="k">def</span> <span class="nf">transition_with_steps</span><span class="p">(</span><span class="n">outcome_and_steps</span><span class="p">):</span>
</span><span id="map_and_time-654"><a href="#map_and_time-654"><span class="linenos">654</span></a>        <span class="n">outcome</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="n">outcome_and_steps</span>
</span><span id="map_and_time-655"><a href="#map_and_time-655"><span class="linenos">655</span></a>        <span class="n">next_outcome</span> <span class="o">=</span> <span class="n">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="map_and_time-656"><a href="#map_and_time-656"><span class="linenos">656</span></a>        <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">markov_chain</span><span class="o">.</span><span class="n">is_absorbing</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">next_outcome</span><span class="p">):</span>
</span><span id="map_and_time-657"><a href="#map_and_time-657"><span class="linenos">657</span></a>            <span class="k">return</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">steps</span>
</span><span id="map_and_time-658"><a href="#map_and_time-658"><span class="linenos">658</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="map_and_time-659"><a href="#map_and_time-659"><span class="linenos">659</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">tupleize</span><span class="p">(</span><span class="n">next_outcome</span><span class="p">,</span> <span class="n">steps</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="map_and_time-660"><a href="#map_and_time-660"><span class="linenos">660</span></a>
</span><span id="map_and_time-661"><a href="#map_and_time-661"><span class="linenos">661</span></a>    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat</span><span class="p">):</span>
</span><span id="map_and_time-662"><a href="#map_and_time-662"><span class="linenos">662</span></a>        <span class="n">next_result</span><span class="p">:</span> <span class="s1">&#39;icepool.Die[tuple[T, int]]&#39;</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span>
</span><span id="map_and_time-663"><a href="#map_and_time-663"><span class="linenos">663</span></a>            <span class="n">transition_with_steps</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
</span><span id="map_and_time-664"><a href="#map_and_time-664"><span class="linenos">664</span></a>        <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">next_result</span><span class="p">:</span>
</span><span id="map_and_time-665"><a href="#map_and_time-665"><span class="linenos">665</span></a>            <span class="k">return</span> <span class="n">next_result</span>
</span><span id="map_and_time-666"><a href="#map_and_time-666"><span class="linenos">666</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">next_result</span>
</span><span id="map_and_time-667"><a href="#map_and_time-667"><span class="linenos">667</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Repeatedly map outcomes of the state to other outcomes, while also
counting timesteps.</p>

<p>This is useful for representing processes.</p>

<p>The outcomes of the result are  <code>(outcome, time)</code>, where <code>time</code> is the
number of repeats needed to reach an absorbing outcome (an outcome that
only leads to itself), or <code>repeat</code>, whichever is lesser.</p>

<p>This will return early if it reaches a fixed point.
Therefore, you can set <code>repeat</code> equal to the maximum number of
time you could possibly be interested in without worrying about
it causing extra computations after the fixed point.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>repl:</strong>  One of the following:
<ul>
<li>A callable returning a new outcome for each old outcome.</li>
<li>A mapping from old outcomes to new outcomes.
Unmapped old outcomes stay the same.
The new outcomes may be dice rather than just single outcomes.
The special value <code><a href="#Reroll">Reroll</a></code> will reroll that old outcome.</li>
</ul></li>
<li><strong>star:</strong>  If <code>True</code>, the first of the args will be unpacked before giving
them to <code>func</code>.
If not provided, it will be guessed based on the signature of <code>func</code>
and the number of arguments.</li>
<li><strong>repeat:</strong>  This will be repeated with the same arguments on the result
this many times.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The <code><a href="#Die">Die</a></code> after the modification.</p>
</blockquote>
</div>


                </section>
                <section id="map_to_pool">
                            <input id="map_to_pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_to_pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="o">~</span><span class="n">T</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="o">&lt;</span><span class="n"><a href="#RerollType.Reroll">RerollType.Reroll</a></span><span class="p">:</span> <span class="s1">&#39;Reroll&#39;</span><span class="o">&gt;</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="o">~</span><span class="n">T</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="o">&lt;</span><span class="n"><a href="#RerollType.Reroll">RerollType.Reroll</a></span><span class="p">:</span> <span class="s1">&#39;Reroll&#39;</span><span class="o">&gt;</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n"><a href="#Outcome">Outcome</a></span> <span class="o">|</span> <span class="n"><a href="#Die">Die</a></span> <span class="o">|</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="map_to_pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#map_to_pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="map_to_pool-670"><a href="#map_to_pool-670"><span class="linenos">670</span></a><span class="k">def</span> <span class="nf">map_to_pool</span><span class="p">(</span>
</span><span id="map_to_pool-671"><a href="#map_to_pool-671"><span class="linenos">671</span></a>    <span class="n">repl</span><span class="p">:</span>
</span><span id="map_to_pool-672"><a href="#map_to_pool-672"><span class="linenos">672</span></a>    <span class="s1">&#39;Callable[..., icepool.MultisetGenerator | Sequence[icepool.Die[T] | T] | Mapping[icepool.Die[T], int] | Mapping[T, int] | icepool.Reroll] | Mapping[Any, icepool.MultisetGenerator | Sequence[icepool.Die[T] | T] | Mapping[icepool.Die[T], int] | Mapping[T, int] | icepool.Reroll]&#39;</span><span class="p">,</span>
</span><span id="map_to_pool-673"><a href="#map_to_pool-673"><span class="linenos">673</span></a>    <span class="o">/</span><span class="p">,</span>
</span><span id="map_to_pool-674"><a href="#map_to_pool-674"><span class="linenos">674</span></a>    <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;Outcome | icepool.Die | icepool.MultisetExpression&#39;</span><span class="p">,</span>
</span><span id="map_to_pool-675"><a href="#map_to_pool-675"><span class="linenos">675</span></a>    <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="map_to_pool-676"><a href="#map_to_pool-676"><span class="linenos">676</span></a>    <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="map_to_pool-677"><a href="#map_to_pool-677"><span class="linenos">677</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultisetGenerator[T, tuple[int]]&#39;</span><span class="p">:</span>
</span><span id="map_to_pool-678"><a href="#map_to_pool-678"><span class="linenos">678</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Applies `repl(outcome_of_die_0, outcome_of_die_1, ...)` for all joint outcomes, producing a MultisetGenerator.</span>
</span><span id="map_to_pool-679"><a href="#map_to_pool-679"><span class="linenos">679</span></a><span class="sd">    </span>
</span><span id="map_to_pool-680"><a href="#map_to_pool-680"><span class="linenos">680</span></a><span class="sd">    Args:</span>
</span><span id="map_to_pool-681"><a href="#map_to_pool-681"><span class="linenos">681</span></a><span class="sd">        repl: One of the following:</span>
</span><span id="map_to_pool-682"><a href="#map_to_pool-682"><span class="linenos">682</span></a><span class="sd">            * A callable that takes in one outcome per element of args and</span>
</span><span id="map_to_pool-683"><a href="#map_to_pool-683"><span class="linenos">683</span></a><span class="sd">                produces a `MultisetGenerator` or something convertible to a `Pool`.</span>
</span><span id="map_to_pool-684"><a href="#map_to_pool-684"><span class="linenos">684</span></a><span class="sd">            * A mapping from old outcomes to `MultisetGenerator` </span>
</span><span id="map_to_pool-685"><a href="#map_to_pool-685"><span class="linenos">685</span></a><span class="sd">                or something convertible to a `Pool`.</span>
</span><span id="map_to_pool-686"><a href="#map_to_pool-686"><span class="linenos">686</span></a><span class="sd">                In this case args must have exactly one element.</span>
</span><span id="map_to_pool-687"><a href="#map_to_pool-687"><span class="linenos">687</span></a><span class="sd">            The new outcomes may be dice rather than just single outcomes.</span>
</span><span id="map_to_pool-688"><a href="#map_to_pool-688"><span class="linenos">688</span></a><span class="sd">            The special value `icepool.Reroll` will reroll that old outcome.</span>
</span><span id="map_to_pool-689"><a href="#map_to_pool-689"><span class="linenos">689</span></a><span class="sd">        star: If `True`, the first of the args will be unpacked before giving</span>
</span><span id="map_to_pool-690"><a href="#map_to_pool-690"><span class="linenos">690</span></a><span class="sd">            them to `repl`.</span>
</span><span id="map_to_pool-691"><a href="#map_to_pool-691"><span class="linenos">691</span></a><span class="sd">            If not provided, it will be guessed based on the signature of `repl`</span>
</span><span id="map_to_pool-692"><a href="#map_to_pool-692"><span class="linenos">692</span></a><span class="sd">            and the number of arguments.</span>
</span><span id="map_to_pool-693"><a href="#map_to_pool-693"><span class="linenos">693</span></a><span class="sd">        denominator: If provided, the denominator of the result will be this</span>
</span><span id="map_to_pool-694"><a href="#map_to_pool-694"><span class="linenos">694</span></a><span class="sd">            value. Otherwise it will be the minimum to correctly weight the</span>
</span><span id="map_to_pool-695"><a href="#map_to_pool-695"><span class="linenos">695</span></a><span class="sd">            pools.</span>
</span><span id="map_to_pool-696"><a href="#map_to_pool-696"><span class="linenos">696</span></a>
</span><span id="map_to_pool-697"><a href="#map_to_pool-697"><span class="linenos">697</span></a><span class="sd">    Returns:</span>
</span><span id="map_to_pool-698"><a href="#map_to_pool-698"><span class="linenos">698</span></a><span class="sd">        A `MultisetGenerator` representing the mixture of `Pool`s. Note  </span>
</span><span id="map_to_pool-699"><a href="#map_to_pool-699"><span class="linenos">699</span></a><span class="sd">        that this is not technically a `Pool`, though it supports most of </span>
</span><span id="map_to_pool-700"><a href="#map_to_pool-700"><span class="linenos">700</span></a><span class="sd">        the same operations.</span>
</span><span id="map_to_pool-701"><a href="#map_to_pool-701"><span class="linenos">701</span></a>
</span><span id="map_to_pool-702"><a href="#map_to_pool-702"><span class="linenos">702</span></a><span class="sd">    Raises:</span>
</span><span id="map_to_pool-703"><a href="#map_to_pool-703"><span class="linenos">703</span></a><span class="sd">        ValueError: If `denominator` cannot be made consistent with the </span>
</span><span id="map_to_pool-704"><a href="#map_to_pool-704"><span class="linenos">704</span></a><span class="sd">            resulting mixture of pools.</span>
</span><span id="map_to_pool-705"><a href="#map_to_pool-705"><span class="linenos">705</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="map_to_pool-706"><a href="#map_to_pool-706"><span class="linenos">706</span></a>    <span class="n">transition_function</span> <span class="o">=</span> <span class="n">_canonicalize_transition_function</span><span class="p">(</span>
</span><span id="map_to_pool-707"><a href="#map_to_pool-707"><span class="linenos">707</span></a>        <span class="n">repl</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">),</span> <span class="n">star</span><span class="p">)</span>
</span><span id="map_to_pool-708"><a href="#map_to_pool-708"><span class="linenos">708</span></a>
</span><span id="map_to_pool-709"><a href="#map_to_pool-709"><span class="linenos">709</span></a>    <span class="n">data</span><span class="p">:</span> <span class="s1">&#39;MutableMapping[icepool.MultisetGenerator[T, tuple[int]], int]&#39;</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span>
</span><span id="map_to_pool-710"><a href="#map_to_pool-710"><span class="linenos">710</span></a>        <span class="nb">int</span><span class="p">)</span>
</span><span id="map_to_pool-711"><a href="#map_to_pool-711"><span class="linenos">711</span></a>    <span class="k">for</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="n">iter_cartesian_product</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="map_to_pool-712"><a href="#map_to_pool-712"><span class="linenos">712</span></a>        <span class="n">pool</span> <span class="o">=</span> <span class="n">transition_function</span><span class="p">(</span><span class="o">*</span><span class="n">outcomes</span><span class="p">)</span>
</span><span id="map_to_pool-713"><a href="#map_to_pool-713"><span class="linenos">713</span></a>        <span class="k">if</span> <span class="n">pool</span> <span class="ow">is</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="map_to_pool-714"><a href="#map_to_pool-714"><span class="linenos">714</span></a>            <span class="k">continue</span>
</span><span id="map_to_pool-715"><a href="#map_to_pool-715"><span class="linenos">715</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pool</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">):</span>
</span><span id="map_to_pool-716"><a href="#map_to_pool-716"><span class="linenos">716</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">pool</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="map_to_pool-717"><a href="#map_to_pool-717"><span class="linenos">717</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="map_to_pool-718"><a href="#map_to_pool-718"><span class="linenos">718</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">pool</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="map_to_pool-719"><a href="#map_to_pool-719"><span class="linenos">719</span></a>    <span class="c1"># I couldn&#39;t get the covariance / contravariance to work.</span>
</span><span id="map_to_pool-720"><a href="#map_to_pool-720"><span class="linenos">720</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MixtureGenerator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span>
</span><span id="map_to_pool-721"><a href="#map_to_pool-721"><span class="linenos">721</span></a>                                    <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Applies <code>repl(outcome_of_die_0, outcome_of_die_1, ...)</code> for all joint outcomes, producing a MultisetGenerator.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>repl:</strong>  One of the following:
<ul>
<li>A callable that takes in one outcome per element of args and
produces a <code><a href="#MultisetGenerator">MultisetGenerator</a></code> or something convertible to a <code><a href="#Pool">Pool</a></code>.</li>
<li>A mapping from old outcomes to <code><a href="#MultisetGenerator">MultisetGenerator</a></code> 
or something convertible to a <code><a href="#Pool">Pool</a></code>.
In this case args must have exactly one element.
The new outcomes may be dice rather than just single outcomes.
The special value <code><a href="#Reroll">Reroll</a></code> will reroll that old outcome.</li>
</ul></li>
<li><strong>star:</strong>  If <code>True</code>, the first of the args will be unpacked before giving
them to <code>repl</code>.
If not provided, it will be guessed based on the signature of <code>repl</code>
and the number of arguments.</li>
<li><strong>denominator:</strong>  If provided, the denominator of the result will be this
value. Otherwise it will be the minimum to correctly weight the
pools.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#MultisetGenerator">MultisetGenerator</a></code> representing the mixture of <code><a href="#Pool">Pool</a></code>s. Note<br />
  that this is not technically a <code><a href="#Pool">Pool</a></code>, though it supports most of 
  the same operations.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If <code>denominator</code> cannot be made consistent with the 
resulting mixture of pools.</li>
</ul>
</div>


                </section>
                <section id="Reroll">
                    <div class="attr variable">
            <span class="name">Reroll</span><span class="annotation">: Final</span>        =
<span class="default_value">&lt;<a href="#RerollType.Reroll">RerollType.Reroll</a>: &#39;Reroll&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Reroll"></a>
    
            <div class="docstring"><p>Indicates that an outcome should be rerolled (with unlimited depth).</p>

<p>This can be used in place of outcomes in many places. See individual function
and method descriptions for details.</p>

<p>This effectively removes the outcome from the probability space, along with its
contribution to the denominator.</p>

<p>This can be used for conditional probability by removing all outcomes not
consistent with the given observations.</p>

<p>Operation in specific cases:</p>

<ul>
<li>When used with <code><a href="#Again">Again</a></code>, only that stage is rerolled, not the entire <code><a href="#Again">Again</a></code>
tree.</li>
<li>To reroll with limited depth, use <code><a href="#Die.reroll">Die.reroll()</a></code>, or <code><a href="#Again">Again</a></code> with no
modification.</li>
<li>When used with <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code>, the entire evaluation is rerolled.</li>
</ul>
</div>


                </section>
                <section id="RerollType">
                            <input id="RerollType-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RerollType</span><wbr>(<span class="base">enum.Enum</span>):

                <label class="view-source-button" for="RerollType-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RerollType"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RerollType-64"><a href="#RerollType-64"><span class="linenos">64</span></a><span class="k">class</span> <span class="nc">RerollType</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="RerollType-65"><a href="#RerollType-65"><span class="linenos">65</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The type of the Reroll singleton.&quot;&quot;&quot;</span>
</span><span id="RerollType-66"><a href="#RerollType-66"><span class="linenos">66</span></a>    <span class="n">Reroll</span> <span class="o">=</span> <span class="s1">&#39;Reroll&#39;</span>
</span><span id="RerollType-67"><a href="#RerollType-67"><span class="linenos">67</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Indicates an outcome should be rerolled (with unlimited depth).&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The type of the Reroll singleton.</p>
</div>


                            <div id="RerollType.Reroll" class="classattr">
                                <div class="attr variable">
            <span class="name">Reroll</span>        =
<span class="default_value">&lt;<a href="#RerollType.Reroll">RerollType.Reroll</a>: &#39;Reroll&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#RerollType.Reroll"></a>
    
            <div class="docstring"><p>Indicates an outcome should be rerolled (with unlimited depth).</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="RerollType.name" class="variable">name</dd>
                <dd id="RerollType.value" class="variable">value</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Pool">
                            <input id="Pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Pool</span><wbr>(<span class="base">icepool.generator.keep.KeepGenerator[~T]</span>):

                <label class="view-source-button" for="Pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool-25"><a href="#Pool-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">Pool</span><span class="p">(</span><span class="n">KeepGenerator</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="Pool-26"><a href="#Pool-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a multiset of outcomes resulting from the roll of several dice.</span>
</span><span id="Pool-27"><a href="#Pool-27"><span class="linenos"> 27</span></a>
</span><span id="Pool-28"><a href="#Pool-28"><span class="linenos"> 28</span></a><span class="sd">    This should be used in conjunction with `MultisetEvaluator` to generate a</span>
</span><span id="Pool-29"><a href="#Pool-29"><span class="linenos"> 29</span></a><span class="sd">    result.</span>
</span><span id="Pool-30"><a href="#Pool-30"><span class="linenos"> 30</span></a>
</span><span id="Pool-31"><a href="#Pool-31"><span class="linenos"> 31</span></a><span class="sd">    Note that operators are performed on the multiset of rolls, not the multiset</span>
</span><span id="Pool-32"><a href="#Pool-32"><span class="linenos"> 32</span></a><span class="sd">    of dice. For example, `d6.pool(3) - d6.pool(3)` is not an empty pool, but</span>
</span><span id="Pool-33"><a href="#Pool-33"><span class="linenos"> 33</span></a><span class="sd">    an expression meaning &quot;roll two pools of 3d6 and get the rolls from the</span>
</span><span id="Pool-34"><a href="#Pool-34"><span class="linenos"> 34</span></a><span class="sd">    first pool, with rolls in the second pool cancelling matching rolls in the</span>
</span><span id="Pool-35"><a href="#Pool-35"><span class="linenos"> 35</span></a><span class="sd">    first pool one-for-one&quot;.</span>
</span><span id="Pool-36"><a href="#Pool-36"><span class="linenos"> 36</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Pool-37"><a href="#Pool-37"><span class="linenos"> 37</span></a>
</span><span id="Pool-38"><a href="#Pool-38"><span class="linenos"> 38</span></a>    <span class="n">_dice</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</span><span id="Pool-39"><a href="#Pool-39"><span class="linenos"> 39</span></a>
</span><span id="Pool-40"><a href="#Pool-40"><span class="linenos"> 40</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Pool-41"><a href="#Pool-41"><span class="linenos"> 41</span></a>            <span class="bp">cls</span><span class="p">,</span>
</span><span id="Pool-42"><a href="#Pool-42"><span class="linenos"> 42</span></a>            <span class="n">dice</span><span class="p">:</span>
</span><span id="Pool-43"><a href="#Pool-43"><span class="linenos"> 43</span></a>        <span class="s1">&#39;Sequence[icepool.Die[T] | T] | Mapping[icepool.Die[T], int] | Mapping[T, int] | Mapping[icepool.Die[T] | T, int]&#39;</span><span class="p">,</span>
</span><span id="Pool-44"><a href="#Pool-44"><span class="linenos"> 44</span></a>            <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="Pool-45"><a href="#Pool-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Public constructor for a pool.</span>
</span><span id="Pool-46"><a href="#Pool-46"><span class="linenos"> 46</span></a>
</span><span id="Pool-47"><a href="#Pool-47"><span class="linenos"> 47</span></a><span class="sd">        Evaulation is most efficient when the dice are the same or same-side</span>
</span><span id="Pool-48"><a href="#Pool-48"><span class="linenos"> 48</span></a><span class="sd">        truncations of each other. For example, d4, d6, d8, d10, d12 are all</span>
</span><span id="Pool-49"><a href="#Pool-49"><span class="linenos"> 49</span></a><span class="sd">        same-side truncations of d12.</span>
</span><span id="Pool-50"><a href="#Pool-50"><span class="linenos"> 50</span></a>
</span><span id="Pool-51"><a href="#Pool-51"><span class="linenos"> 51</span></a><span class="sd">        It is permissible to create a `Pool` without providing dice, but not all</span>
</span><span id="Pool-52"><a href="#Pool-52"><span class="linenos"> 52</span></a><span class="sd">        evaluators will handle this case, especially if they depend on the</span>
</span><span id="Pool-53"><a href="#Pool-53"><span class="linenos"> 53</span></a><span class="sd">        outcome type. In this case you may want to provide a die with zero</span>
</span><span id="Pool-54"><a href="#Pool-54"><span class="linenos"> 54</span></a><span class="sd">        quantity.</span>
</span><span id="Pool-55"><a href="#Pool-55"><span class="linenos"> 55</span></a>
</span><span id="Pool-56"><a href="#Pool-56"><span class="linenos"> 56</span></a><span class="sd">        Args:</span>
</span><span id="Pool-57"><a href="#Pool-57"><span class="linenos"> 57</span></a><span class="sd">            dice: The dice to put in the `Pool`. This can be one of the following:</span>
</span><span id="Pool-58"><a href="#Pool-58"><span class="linenos"> 58</span></a>
</span><span id="Pool-59"><a href="#Pool-59"><span class="linenos"> 59</span></a><span class="sd">                * A `Sequence` of `Die` or outcomes.</span>
</span><span id="Pool-60"><a href="#Pool-60"><span class="linenos"> 60</span></a><span class="sd">                * A `Mapping` of `Die` or outcomes to how many of that `Die` or</span>
</span><span id="Pool-61"><a href="#Pool-61"><span class="linenos"> 61</span></a><span class="sd">                    outcome to put in the `Pool`.</span>
</span><span id="Pool-62"><a href="#Pool-62"><span class="linenos"> 62</span></a>
</span><span id="Pool-63"><a href="#Pool-63"><span class="linenos"> 63</span></a><span class="sd">                All outcomes within a `Pool` must be totally orderable.</span>
</span><span id="Pool-64"><a href="#Pool-64"><span class="linenos"> 64</span></a><span class="sd">            times: Multiplies the number of times each element of `dice` will</span>
</span><span id="Pool-65"><a href="#Pool-65"><span class="linenos"> 65</span></a><span class="sd">                be put into the pool.</span>
</span><span id="Pool-66"><a href="#Pool-66"><span class="linenos"> 66</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Pool-67"><a href="#Pool-67"><span class="linenos"> 67</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Pool-68"><a href="#Pool-68"><span class="linenos"> 68</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Pool-69"><a href="#Pool-69"><span class="linenos"> 69</span></a>
</span><span id="Pool-70"><a href="#Pool-70"><span class="linenos"> 70</span></a><span class="sd">        Raises:</span>
</span><span id="Pool-71"><a href="#Pool-71"><span class="linenos"> 71</span></a><span class="sd">            ValueError: If a bare `Deck` or `Die` argument is provided.</span>
</span><span id="Pool-72"><a href="#Pool-72"><span class="linenos"> 72</span></a><span class="sd">                A `Pool` of a single `Die` should constructed as `Pool([die])`.</span>
</span><span id="Pool-73"><a href="#Pool-73"><span class="linenos"> 73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-74"><a href="#Pool-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">Pool</span><span class="p">):</span>
</span><span id="Pool-75"><a href="#Pool-75"><span class="linenos"> 75</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Pool-76"><a href="#Pool-76"><span class="linenos"> 76</span></a>                <span class="k">return</span> <span class="n">dice</span>
</span><span id="Pool-77"><a href="#Pool-77"><span class="linenos"> 77</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Pool-78"><a href="#Pool-78"><span class="linenos"> 78</span></a>                <span class="n">dice</span> <span class="o">=</span> <span class="p">{</span><span class="n">die</span><span class="p">:</span> <span class="n">quantity</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="n">dice</span><span class="o">.</span><span class="n">_dice</span><span class="p">}</span>
</span><span id="Pool-79"><a href="#Pool-79"><span class="linenos"> 79</span></a>
</span><span id="Pool-80"><a href="#Pool-80"><span class="linenos"> 80</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deck</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultiDeal</span><span class="p">)):</span>
</span><span id="Pool-81"><a href="#Pool-81"><span class="linenos"> 81</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool-82"><a href="#Pool-82"><span class="linenos"> 82</span></a>                <span class="sa">f</span><span class="s1">&#39;A Pool cannot be constructed with a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> argument.&#39;</span>
</span><span id="Pool-83"><a href="#Pool-83"><span class="linenos"> 83</span></a>            <span class="p">)</span>
</span><span id="Pool-84"><a href="#Pool-84"><span class="linenos"> 84</span></a>
</span><span id="Pool-85"><a href="#Pool-85"><span class="linenos"> 85</span></a>        <span class="n">dice</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Pool-86"><a href="#Pool-86"><span class="linenos"> 86</span></a>        <span class="n">converted_dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="Pool-87"><a href="#Pool-87"><span class="linenos"> 87</span></a>
</span><span id="Pool-88"><a href="#Pool-88"><span class="linenos"> 88</span></a>        <span class="n">dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-89"><a href="#Pool-89"><span class="linenos"> 89</span></a>        <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">qty</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">converted_dice</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
</span><span id="Pool-90"><a href="#Pool-90"><span class="linenos"> 90</span></a>            <span class="k">if</span> <span class="n">die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="n">qty</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-91"><a href="#Pool-91"><span class="linenos"> 91</span></a>                <span class="c1"># zero empty dice is considered to have no effect</span>
</span><span id="Pool-92"><a href="#Pool-92"><span class="linenos"> 92</span></a>                <span class="k">continue</span>
</span><span id="Pool-93"><a href="#Pool-93"><span class="linenos"> 93</span></a>            <span class="n">dice_counts</span><span class="p">[</span><span class="n">die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">qty</span>
</span><span id="Pool-94"><a href="#Pool-94"><span class="linenos"> 94</span></a>        <span class="n">keep_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="Pool-95"><a href="#Pool-95"><span class="linenos"> 95</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_new_from_mapping</span><span class="p">(</span><span class="n">dice_counts</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">)</span>
</span><span id="Pool-96"><a href="#Pool-96"><span class="linenos"> 96</span></a>
</span><span id="Pool-97"><a href="#Pool-97"><span class="linenos"> 97</span></a>    <span class="nd">@classmethod</span>
</span><span id="Pool-98"><a href="#Pool-98"><span class="linenos"> 98</span></a>    <span class="nd">@cache</span>
</span><span id="Pool-99"><a href="#Pool-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="nf">_new_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dice</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="Pool-100"><a href="#Pool-100"><span class="linenos">100</span></a>                 <span class="n">keep_tuple</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool[T]&#39;</span><span class="p">:</span>
</span><span id="Pool-101"><a href="#Pool-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;All pool creation ends up here. This method is cached.</span>
</span><span id="Pool-102"><a href="#Pool-102"><span class="linenos">102</span></a>
</span><span id="Pool-103"><a href="#Pool-103"><span class="linenos">103</span></a><span class="sd">        Args:</span>
</span><span id="Pool-104"><a href="#Pool-104"><span class="linenos">104</span></a><span class="sd">            dice: A tuple of (die, count) pairs.</span>
</span><span id="Pool-105"><a href="#Pool-105"><span class="linenos">105</span></a><span class="sd">            keep_tuple: A tuple of how many times to count each die.</span>
</span><span id="Pool-106"><a href="#Pool-106"><span class="linenos">106</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-107"><a href="#Pool-107"><span class="linenos">107</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Pool</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Pool-108"><a href="#Pool-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span> <span class="o">=</span> <span class="n">dice</span>
</span><span id="Pool-109"><a href="#Pool-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_tuple</span> <span class="o">=</span> <span class="n">keep_tuple</span>
</span><span id="Pool-110"><a href="#Pool-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Pool-111"><a href="#Pool-111"><span class="linenos">111</span></a>
</span><span id="Pool-112"><a href="#Pool-112"><span class="linenos">112</span></a>    <span class="nd">@classmethod</span>
</span><span id="Pool-113"><a href="#Pool-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">_new_empty</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="Pool-114"><a href="#Pool-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">((),</span> <span class="p">())</span>
</span><span id="Pool-115"><a href="#Pool-115"><span class="linenos">115</span></a>
</span><span id="Pool-116"><a href="#Pool-116"><span class="linenos">116</span></a>    <span class="nd">@classmethod</span>
</span><span id="Pool-117"><a href="#Pool-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">clear_cache</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="Pool-118"><a href="#Pool-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears the global pool cache.&quot;&quot;&quot;</span>
</span><span id="Pool-119"><a href="#Pool-119"><span class="linenos">119</span></a>        <span class="n">Pool</span><span class="o">.</span><span class="n">_new_raw</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</span><span id="Pool-120"><a href="#Pool-120"><span class="linenos">120</span></a>
</span><span id="Pool-121"><a href="#Pool-121"><span class="linenos">121</span></a>    <span class="nd">@classmethod</span>
</span><span id="Pool-122"><a href="#Pool-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">_new_from_mapping</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dice_counts</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Pool-123"><a href="#Pool-123"><span class="linenos">123</span></a>                          <span class="n">keep_tuple</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool[T]&#39;</span><span class="p">:</span>
</span><span id="Pool-124"><a href="#Pool-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new pool.</span>
</span><span id="Pool-125"><a href="#Pool-125"><span class="linenos">125</span></a>
</span><span id="Pool-126"><a href="#Pool-126"><span class="linenos">126</span></a><span class="sd">        Args:</span>
</span><span id="Pool-127"><a href="#Pool-127"><span class="linenos">127</span></a><span class="sd">            dice_counts: A map from dice to rolls.</span>
</span><span id="Pool-128"><a href="#Pool-128"><span class="linenos">128</span></a><span class="sd">            keep_tuple: A tuple with length equal to the number of dice.</span>
</span><span id="Pool-129"><a href="#Pool-129"><span class="linenos">129</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-130"><a href="#Pool-130"><span class="linenos">130</span></a>        <span class="n">dice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Pool-131"><a href="#Pool-131"><span class="linenos">131</span></a>            <span class="nb">sorted</span><span class="p">(</span><span class="n">dice_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_hash_key</span><span class="p">))</span>
</span><span id="Pool-132"><a href="#Pool-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">)</span>
</span><span id="Pool-133"><a href="#Pool-133"><span class="linenos">133</span></a>
</span><span id="Pool-134"><a href="#Pool-134"><span class="linenos">134</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-135"><a href="#Pool-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">_raw_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-136"><a href="#Pool-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">count</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-137"><a href="#Pool-137"><span class="linenos">137</span></a>
</span><span id="Pool-138"><a href="#Pool-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">raw_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-139"><a href="#Pool-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of dice in this pool before the keep_tuple is applied.&quot;&quot;&quot;</span>
</span><span id="Pool-140"><a href="#Pool-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_size</span>
</span><span id="Pool-141"><a href="#Pool-141"><span class="linenos">141</span></a>
</span><span id="Pool-142"><a href="#Pool-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Pool-143"><a href="#Pool-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-144"><a href="#Pool-144"><span class="linenos">144</span></a>
</span><span id="Pool-145"><a href="#Pool-145"><span class="linenos">145</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-146"><a href="#Pool-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-147"><a href="#Pool-147"><span class="linenos">147</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="n">count</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-148"><a href="#Pool-148"><span class="linenos">148</span></a>
</span><span id="Pool-149"><a href="#Pool-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-150"><a href="#Pool-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span><span id="Pool-151"><a href="#Pool-151"><span class="linenos">151</span></a>
</span><span id="Pool-152"><a href="#Pool-152"><span class="linenos">152</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-153"><a href="#Pool-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">_dice_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Pool-154"><a href="#Pool-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(((</span><span class="n">die</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">count</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="p">())</span>
</span><span id="Pool-155"><a href="#Pool-155"><span class="linenos">155</span></a>
</span><span id="Pool-156"><a href="#Pool-156"><span class="linenos">156</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-157"><a href="#Pool-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">_unique_dice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">]:</span>
</span><span id="Pool-158"><a href="#Pool-158"><span class="linenos">158</span></a>        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">die</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-159"><a href="#Pool-159"><span class="linenos">159</span></a>
</span><span id="Pool-160"><a href="#Pool-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">unique_dice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">]:</span>
</span><span id="Pool-161"><a href="#Pool-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The collection of unique dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool-162"><a href="#Pool-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_dice</span>
</span><span id="Pool-163"><a href="#Pool-163"><span class="linenos">163</span></a>
</span><span id="Pool-164"><a href="#Pool-164"><span class="linenos">164</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-165"><a href="#Pool-165"><span class="linenos">165</span></a>    <span class="k">def</span> <span class="nf">_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="Pool-166"><a href="#Pool-166"><span class="linenos">166</span></a>        <span class="n">outcome_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="Pool-167"><a href="#Pool-167"><span class="linenos">167</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Pool-168"><a href="#Pool-168"><span class="linenos">168</span></a>                                          <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_dice</span><span class="p">()))</span>
</span><span id="Pool-169"><a href="#Pool-169"><span class="linenos">169</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">outcome_set</span><span class="p">))</span>
</span><span id="Pool-170"><a href="#Pool-170"><span class="linenos">170</span></a>
</span><span id="Pool-171"><a href="#Pool-171"><span class="linenos">171</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="Pool-172"><a href="#Pool-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The union of possible outcomes among all dice in this pool in ascending order.&quot;&quot;&quot;</span>
</span><span id="Pool-173"><a href="#Pool-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span><span id="Pool-174"><a href="#Pool-174"><span class="linenos">174</span></a>
</span><span id="Pool-175"><a href="#Pool-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-176"><a href="#Pool-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span><span id="Pool-177"><a href="#Pool-177"><span class="linenos">177</span></a>
</span><span id="Pool-178"><a href="#Pool-178"><span class="linenos">178</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Pool-179"><a href="#Pool-179"><span class="linenos">179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimates the cost of popping from the min and max sides.</span>
</span><span id="Pool-180"><a href="#Pool-180"><span class="linenos">180</span></a>
</span><span id="Pool-181"><a href="#Pool-181"><span class="linenos">181</span></a><span class="sd">        Returns:</span>
</span><span id="Pool-182"><a href="#Pool-182"><span class="linenos">182</span></a><span class="sd">            pop_min_cost</span>
</span><span id="Pool-183"><a href="#Pool-183"><span class="linenos">183</span></a><span class="sd">            pop_max_cost</span>
</span><span id="Pool-184"><a href="#Pool-184"><span class="linenos">184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-185"><a href="#Pool-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">pool_cost</span><span class="o">.</span><span class="n">estimate_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Pool-186"><a href="#Pool-186"><span class="linenos">186</span></a>
</span><span id="Pool-187"><a href="#Pool-187"><span class="linenos">187</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-188"><a href="#Pool-188"><span class="linenos">188</span></a>    <span class="k">def</span> <span class="nf">_min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Pool-189"><a href="#Pool-189"><span class="linenos">189</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_dice</span><span class="p">())</span>
</span><span id="Pool-190"><a href="#Pool-190"><span class="linenos">190</span></a>
</span><span id="Pool-191"><a href="#Pool-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Pool-192"><a href="#Pool-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The min outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool-193"><a href="#Pool-193"><span class="linenos">193</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_outcome</span>
</span><span id="Pool-194"><a href="#Pool-194"><span class="linenos">194</span></a>
</span><span id="Pool-195"><a href="#Pool-195"><span class="linenos">195</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-196"><a href="#Pool-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="nf">_max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Pool-197"><a href="#Pool-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_dice</span><span class="p">())</span>
</span><span id="Pool-198"><a href="#Pool-198"><span class="linenos">198</span></a>
</span><span id="Pool-199"><a href="#Pool-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Pool-200"><a href="#Pool-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The max outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool-201"><a href="#Pool-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_outcome</span>
</span><span id="Pool-202"><a href="#Pool-202"><span class="linenos">202</span></a>
</span><span id="Pool-203"><a href="#Pool-203"><span class="linenos">203</span></a>    <span class="k">def</span> <span class="nf">_generate_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InitialMultisetGenerator</span><span class="p">:</span>
</span><span id="Pool-204"><a href="#Pool-204"><span class="linenos">204</span></a>        <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span>
</span><span id="Pool-205"><a href="#Pool-205"><span class="linenos">205</span></a>
</span><span id="Pool-206"><a href="#Pool-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="Pool-207"><a href="#Pool-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pops the given outcome from this pool, if it is the min outcome.</span>
</span><span id="Pool-208"><a href="#Pool-208"><span class="linenos">208</span></a>
</span><span id="Pool-209"><a href="#Pool-209"><span class="linenos">209</span></a><span class="sd">        Yields:</span>
</span><span id="Pool-210"><a href="#Pool-210"><span class="linenos">210</span></a><span class="sd">            popped_pool: The pool after the min outcome is popped.</span>
</span><span id="Pool-211"><a href="#Pool-211"><span class="linenos">211</span></a><span class="sd">            count: The number of dice that rolled the min outcome, after</span>
</span><span id="Pool-212"><a href="#Pool-212"><span class="linenos">212</span></a><span class="sd">                accounting for keep_tuple.</span>
</span><span id="Pool-213"><a href="#Pool-213"><span class="linenos">213</span></a><span class="sd">            weight: The weight of this incremental result.</span>
</span><span id="Pool-214"><a href="#Pool-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-215"><a href="#Pool-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="Pool-216"><a href="#Pool-216"><span class="linenos">216</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="Pool-217"><a href="#Pool-217"><span class="linenos">217</span></a>            <span class="k">return</span>
</span><span id="Pool-218"><a href="#Pool-218"><span class="linenos">218</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Pool-219"><a href="#Pool-219"><span class="linenos">219</span></a>            <span class="n">iter_die_pop_min</span><span class="p">(</span><span class="n">die</span><span class="p">,</span> <span class="n">die_count</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span>
</span><span id="Pool-220"><a href="#Pool-220"><span class="linenos">220</span></a>            <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">die_count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span>
</span><span id="Pool-221"><a href="#Pool-221"><span class="linenos">221</span></a>        <span class="p">]</span>
</span><span id="Pool-222"><a href="#Pool-222"><span class="linenos">222</span></a>        <span class="n">skip_weight</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Pool-223"><a href="#Pool-223"><span class="linenos">223</span></a>        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="Pool-224"><a href="#Pool-224"><span class="linenos">224</span></a>            <span class="n">total_hits</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Pool-225"><a href="#Pool-225"><span class="linenos">225</span></a>            <span class="n">result_weight</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Pool-226"><a href="#Pool-226"><span class="linenos">226</span></a>            <span class="n">next_dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-227"><a href="#Pool-227"><span class="linenos">227</span></a>            <span class="k">for</span> <span class="n">popped_die</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
</span><span id="Pool-228"><a href="#Pool-228"><span class="linenos">228</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">popped_die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="Pool-229"><a href="#Pool-229"><span class="linenos">229</span></a>                    <span class="n">next_dice_counts</span><span class="p">[</span><span class="n">popped_die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">misses</span>
</span><span id="Pool-230"><a href="#Pool-230"><span class="linenos">230</span></a>                <span class="n">total_hits</span> <span class="o">+=</span> <span class="n">hits</span>
</span><span id="Pool-231"><a href="#Pool-231"><span class="linenos">231</span></a>                <span class="n">result_weight</span> <span class="o">*=</span> <span class="n">weight</span>
</span><span id="Pool-232"><a href="#Pool-232"><span class="linenos">232</span></a>            <span class="n">popped_keep_tuple</span><span class="p">,</span> <span class="n">result_count</span> <span class="o">=</span> <span class="n">pop_min_from_keep_tuple</span><span class="p">(</span>
</span><span id="Pool-233"><a href="#Pool-233"><span class="linenos">233</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">(),</span> <span class="n">total_hits</span><span class="p">)</span>
</span><span id="Pool-234"><a href="#Pool-234"><span class="linenos">234</span></a>            <span class="n">popped_pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_from_mapping</span><span class="p">(</span><span class="n">next_dice_counts</span><span class="p">,</span>
</span><span id="Pool-235"><a href="#Pool-235"><span class="linenos">235</span></a>                                                 <span class="n">popped_keep_tuple</span><span class="p">)</span>
</span><span id="Pool-236"><a href="#Pool-236"><span class="linenos">236</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">popped_keep_tuple</span><span class="p">):</span>
</span><span id="Pool-237"><a href="#Pool-237"><span class="linenos">237</span></a>                <span class="c1"># Dump all dice in exchange for the denominator.</span>
</span><span id="Pool-238"><a href="#Pool-238"><span class="linenos">238</span></a>                <span class="n">skip_weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip_weight</span> <span class="ow">or</span>
</span><span id="Pool-239"><a href="#Pool-239"><span class="linenos">239</span></a>                               <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">result_weight</span> <span class="o">*</span> <span class="n">popped_pool</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Pool-240"><a href="#Pool-240"><span class="linenos">240</span></a>                <span class="k">continue</span>
</span><span id="Pool-241"><a href="#Pool-241"><span class="linenos">241</span></a>
</span><span id="Pool-242"><a href="#Pool-242"><span class="linenos">242</span></a>            <span class="k">yield</span> <span class="n">popped_pool</span><span class="p">,</span> <span class="p">(</span><span class="n">result_count</span><span class="p">,</span> <span class="p">),</span> <span class="n">result_weight</span>
</span><span id="Pool-243"><a href="#Pool-243"><span class="linenos">243</span></a>
</span><span id="Pool-244"><a href="#Pool-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="n">skip_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Pool-245"><a href="#Pool-245"><span class="linenos">245</span></a>            <span class="k">yield</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_empty</span><span class="p">(),</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">()),</span> <span class="p">),</span> <span class="n">skip_weight</span>
</span><span id="Pool-246"><a href="#Pool-246"><span class="linenos">246</span></a>
</span><span id="Pool-247"><a href="#Pool-247"><span class="linenos">247</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="Pool-248"><a href="#Pool-248"><span class="linenos">248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pops the given outcome from this pool, if it is the max outcome.</span>
</span><span id="Pool-249"><a href="#Pool-249"><span class="linenos">249</span></a>
</span><span id="Pool-250"><a href="#Pool-250"><span class="linenos">250</span></a><span class="sd">        Yields:</span>
</span><span id="Pool-251"><a href="#Pool-251"><span class="linenos">251</span></a><span class="sd">            popped_pool: The pool after the max outcome is popped.</span>
</span><span id="Pool-252"><a href="#Pool-252"><span class="linenos">252</span></a><span class="sd">            count: The number of dice that rolled the max outcome, after</span>
</span><span id="Pool-253"><a href="#Pool-253"><span class="linenos">253</span></a><span class="sd">                accounting for keep_tuple.</span>
</span><span id="Pool-254"><a href="#Pool-254"><span class="linenos">254</span></a><span class="sd">            weight: The weight of this incremental result.</span>
</span><span id="Pool-255"><a href="#Pool-255"><span class="linenos">255</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-256"><a href="#Pool-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="Pool-257"><a href="#Pool-257"><span class="linenos">257</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="Pool-258"><a href="#Pool-258"><span class="linenos">258</span></a>            <span class="k">return</span>
</span><span id="Pool-259"><a href="#Pool-259"><span class="linenos">259</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Pool-260"><a href="#Pool-260"><span class="linenos">260</span></a>            <span class="n">iter_die_pop_max</span><span class="p">(</span><span class="n">die</span><span class="p">,</span> <span class="n">die_count</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span>
</span><span id="Pool-261"><a href="#Pool-261"><span class="linenos">261</span></a>            <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">die_count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span>
</span><span id="Pool-262"><a href="#Pool-262"><span class="linenos">262</span></a>        <span class="p">]</span>
</span><span id="Pool-263"><a href="#Pool-263"><span class="linenos">263</span></a>        <span class="n">skip_weight</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Pool-264"><a href="#Pool-264"><span class="linenos">264</span></a>        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="Pool-265"><a href="#Pool-265"><span class="linenos">265</span></a>            <span class="n">total_hits</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Pool-266"><a href="#Pool-266"><span class="linenos">266</span></a>            <span class="n">result_weight</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Pool-267"><a href="#Pool-267"><span class="linenos">267</span></a>            <span class="n">next_dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-268"><a href="#Pool-268"><span class="linenos">268</span></a>            <span class="k">for</span> <span class="n">popped_die</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
</span><span id="Pool-269"><a href="#Pool-269"><span class="linenos">269</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">popped_die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="Pool-270"><a href="#Pool-270"><span class="linenos">270</span></a>                    <span class="n">next_dice_counts</span><span class="p">[</span><span class="n">popped_die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">misses</span>
</span><span id="Pool-271"><a href="#Pool-271"><span class="linenos">271</span></a>                <span class="n">total_hits</span> <span class="o">+=</span> <span class="n">hits</span>
</span><span id="Pool-272"><a href="#Pool-272"><span class="linenos">272</span></a>                <span class="n">result_weight</span> <span class="o">*=</span> <span class="n">weight</span>
</span><span id="Pool-273"><a href="#Pool-273"><span class="linenos">273</span></a>            <span class="n">popped_keep_tuple</span><span class="p">,</span> <span class="n">result_count</span> <span class="o">=</span> <span class="n">pop_max_from_keep_tuple</span><span class="p">(</span>
</span><span id="Pool-274"><a href="#Pool-274"><span class="linenos">274</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">(),</span> <span class="n">total_hits</span><span class="p">)</span>
</span><span id="Pool-275"><a href="#Pool-275"><span class="linenos">275</span></a>            <span class="n">popped_pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_from_mapping</span><span class="p">(</span><span class="n">next_dice_counts</span><span class="p">,</span>
</span><span id="Pool-276"><a href="#Pool-276"><span class="linenos">276</span></a>                                                 <span class="n">popped_keep_tuple</span><span class="p">)</span>
</span><span id="Pool-277"><a href="#Pool-277"><span class="linenos">277</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">popped_keep_tuple</span><span class="p">):</span>
</span><span id="Pool-278"><a href="#Pool-278"><span class="linenos">278</span></a>                <span class="c1"># Dump all dice in exchange for the denominator.</span>
</span><span id="Pool-279"><a href="#Pool-279"><span class="linenos">279</span></a>                <span class="n">skip_weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip_weight</span> <span class="ow">or</span>
</span><span id="Pool-280"><a href="#Pool-280"><span class="linenos">280</span></a>                               <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">result_weight</span> <span class="o">*</span> <span class="n">popped_pool</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Pool-281"><a href="#Pool-281"><span class="linenos">281</span></a>                <span class="k">continue</span>
</span><span id="Pool-282"><a href="#Pool-282"><span class="linenos">282</span></a>
</span><span id="Pool-283"><a href="#Pool-283"><span class="linenos">283</span></a>            <span class="k">yield</span> <span class="n">popped_pool</span><span class="p">,</span> <span class="p">(</span><span class="n">result_count</span><span class="p">,</span> <span class="p">),</span> <span class="n">result_weight</span>
</span><span id="Pool-284"><a href="#Pool-284"><span class="linenos">284</span></a>
</span><span id="Pool-285"><a href="#Pool-285"><span class="linenos">285</span></a>        <span class="k">if</span> <span class="n">skip_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Pool-286"><a href="#Pool-286"><span class="linenos">286</span></a>            <span class="k">yield</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_empty</span><span class="p">(),</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">()),</span> <span class="p">),</span> <span class="n">skip_weight</span>
</span><span id="Pool-287"><a href="#Pool-287"><span class="linenos">287</span></a>
</span><span id="Pool-288"><a href="#Pool-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">_set_keep_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span>
</span><span id="Pool-289"><a href="#Pool-289"><span class="linenos">289</span></a>                                                <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;KeepGenerator[T]&#39;</span><span class="p">:</span>
</span><span id="Pool-290"><a href="#Pool-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">)</span>
</span><span id="Pool-291"><a href="#Pool-291"><span class="linenos">291</span></a>
</span><span id="Pool-292"><a href="#Pool-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span>
</span><span id="Pool-293"><a href="#Pool-293"><span class="linenos">293</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[T] | Mapping[T, int] | Sequence[T]&#39;</span>
</span><span id="Pool-294"><a href="#Pool-294"><span class="linenos">294</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T]&#39;</span><span class="p">:</span>
</span><span id="Pool-295"><a href="#Pool-295"><span class="linenos">295</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Pool-296"><a href="#Pool-296"><span class="linenos">296</span></a>            <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="Pool-297"><a href="#Pool-297"><span class="linenos">297</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="Pool-298"><a href="#Pool-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Pool</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">):</span>
</span><span id="Pool-299"><a href="#Pool-299"><span class="linenos">299</span></a>            <span class="n">pools</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Pool</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">args</span><span class="p">)</span>
</span><span id="Pool-300"><a href="#Pool-300"><span class="linenos">300</span></a>            <span class="n">keep_tuple</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Pool-301"><a href="#Pool-301"><span class="linenos">301</span></a>                <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">()</span> <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">pools</span><span class="p">),</span>
</span><span id="Pool-302"><a href="#Pool-302"><span class="linenos">302</span></a>                       <span class="p">()))</span>
</span><span id="Pool-303"><a href="#Pool-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-304"><a href="#Pool-304"><span class="linenos">304</span></a>                <span class="c1"># All empty.</span>
</span><span id="Pool-305"><a href="#Pool-305"><span class="linenos">305</span></a>                <span class="k">return</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_empty</span><span class="p">()</span>
</span><span id="Pool-306"><a href="#Pool-306"><span class="linenos">306</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">keep_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keep_tuple</span><span class="p">):</span>
</span><span id="Pool-307"><a href="#Pool-307"><span class="linenos">307</span></a>                <span class="c1"># All sorted positions count the same, so we can merge the</span>
</span><span id="Pool-308"><a href="#Pool-308"><span class="linenos">308</span></a>                <span class="c1"># pools.</span>
</span><span id="Pool-309"><a href="#Pool-309"><span class="linenos">309</span></a>                <span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;MutableMapping[icepool.Die, int]&#39;</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-310"><a href="#Pool-310"><span class="linenos">310</span></a>                <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">pools</span><span class="p">:</span>
</span><span id="Pool-311"><a href="#Pool-311"><span class="linenos">311</span></a>                    <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">die_count</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">_dice</span><span class="p">:</span>
</span><span id="Pool-312"><a href="#Pool-312"><span class="linenos">312</span></a>                        <span class="n">dice</span><span class="p">[</span><span class="n">die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">die_count</span>
</span><span id="Pool-313"><a href="#Pool-313"><span class="linenos">313</span></a>                <span class="k">return</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_from_mapping</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">)</span>
</span><span id="Pool-314"><a href="#Pool-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">KeepGenerator</span><span class="o">.</span><span class="n">additive_union</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span id="Pool-315"><a href="#Pool-315"><span class="linenos">315</span></a>
</span><span id="Pool-316"><a href="#Pool-316"><span class="linenos">316</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Pool-317"><a href="#Pool-317"><span class="linenos">317</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Pool-318"><a href="#Pool-318"><span class="linenos">318</span></a>            <span class="sa">f</span><span class="s1">&#39;Pool of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">raw_size</span><span class="p">()</span><span class="si">}</span><span class="s1"> dice with keep_tuple=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Pool-319"><a href="#Pool-319"><span class="linenos">319</span></a>            <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">die</span><span class="p">)</span><span class="si">}</span><span class="s1"> : </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s1">,</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Pool-320"><a href="#Pool-320"><span class="linenos">320</span></a>                      <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">))</span>
</span><span id="Pool-321"><a href="#Pool-321"><span class="linenos">321</span></a>
</span><span id="Pool-322"><a href="#Pool-322"><span class="linenos">322</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-323"><a href="#Pool-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">_hash_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Pool-324"><a href="#Pool-324"><span class="linenos">324</span></a>        <span class="k">return</span> <span class="n">Pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_tuple</span>
</span></pre></div>


            <div class="docstring"><p>Represents a multiset of outcomes resulting from the roll of several dice.</p>

<p>This should be used in conjunction with <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code> to generate a
result.</p>

<p>Note that operators are performed on the multiset of rolls, not the multiset
of dice. For example, <code>d6.pool(3) - d6.pool(3)</code> is not an empty pool, but
an expression meaning "roll two pools of 3d6 and get the rolls from the
first pool, with rolls in the second pool cancelling matching rolls in the
first pool one-for-one".</p>
</div>


                            <div id="Pool.__init__" class="classattr">
                                        <input id="Pool.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="o">~</span><span class="n">T</span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">times</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></span>)</span>

                <label class="view-source-button" for="Pool.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.__init__-40"><a href="#Pool.__init__-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Pool.__init__-41"><a href="#Pool.__init__-41"><span class="linenos">41</span></a>            <span class="bp">cls</span><span class="p">,</span>
</span><span id="Pool.__init__-42"><a href="#Pool.__init__-42"><span class="linenos">42</span></a>            <span class="n">dice</span><span class="p">:</span>
</span><span id="Pool.__init__-43"><a href="#Pool.__init__-43"><span class="linenos">43</span></a>        <span class="s1">&#39;Sequence[icepool.Die[T] | T] | Mapping[icepool.Die[T], int] | Mapping[T, int] | Mapping[icepool.Die[T] | T, int]&#39;</span><span class="p">,</span>
</span><span id="Pool.__init__-44"><a href="#Pool.__init__-44"><span class="linenos">44</span></a>            <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="Pool.__init__-45"><a href="#Pool.__init__-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Public constructor for a pool.</span>
</span><span id="Pool.__init__-46"><a href="#Pool.__init__-46"><span class="linenos">46</span></a>
</span><span id="Pool.__init__-47"><a href="#Pool.__init__-47"><span class="linenos">47</span></a><span class="sd">        Evaulation is most efficient when the dice are the same or same-side</span>
</span><span id="Pool.__init__-48"><a href="#Pool.__init__-48"><span class="linenos">48</span></a><span class="sd">        truncations of each other. For example, d4, d6, d8, d10, d12 are all</span>
</span><span id="Pool.__init__-49"><a href="#Pool.__init__-49"><span class="linenos">49</span></a><span class="sd">        same-side truncations of d12.</span>
</span><span id="Pool.__init__-50"><a href="#Pool.__init__-50"><span class="linenos">50</span></a>
</span><span id="Pool.__init__-51"><a href="#Pool.__init__-51"><span class="linenos">51</span></a><span class="sd">        It is permissible to create a `Pool` without providing dice, but not all</span>
</span><span id="Pool.__init__-52"><a href="#Pool.__init__-52"><span class="linenos">52</span></a><span class="sd">        evaluators will handle this case, especially if they depend on the</span>
</span><span id="Pool.__init__-53"><a href="#Pool.__init__-53"><span class="linenos">53</span></a><span class="sd">        outcome type. In this case you may want to provide a die with zero</span>
</span><span id="Pool.__init__-54"><a href="#Pool.__init__-54"><span class="linenos">54</span></a><span class="sd">        quantity.</span>
</span><span id="Pool.__init__-55"><a href="#Pool.__init__-55"><span class="linenos">55</span></a>
</span><span id="Pool.__init__-56"><a href="#Pool.__init__-56"><span class="linenos">56</span></a><span class="sd">        Args:</span>
</span><span id="Pool.__init__-57"><a href="#Pool.__init__-57"><span class="linenos">57</span></a><span class="sd">            dice: The dice to put in the `Pool`. This can be one of the following:</span>
</span><span id="Pool.__init__-58"><a href="#Pool.__init__-58"><span class="linenos">58</span></a>
</span><span id="Pool.__init__-59"><a href="#Pool.__init__-59"><span class="linenos">59</span></a><span class="sd">                * A `Sequence` of `Die` or outcomes.</span>
</span><span id="Pool.__init__-60"><a href="#Pool.__init__-60"><span class="linenos">60</span></a><span class="sd">                * A `Mapping` of `Die` or outcomes to how many of that `Die` or</span>
</span><span id="Pool.__init__-61"><a href="#Pool.__init__-61"><span class="linenos">61</span></a><span class="sd">                    outcome to put in the `Pool`.</span>
</span><span id="Pool.__init__-62"><a href="#Pool.__init__-62"><span class="linenos">62</span></a>
</span><span id="Pool.__init__-63"><a href="#Pool.__init__-63"><span class="linenos">63</span></a><span class="sd">                All outcomes within a `Pool` must be totally orderable.</span>
</span><span id="Pool.__init__-64"><a href="#Pool.__init__-64"><span class="linenos">64</span></a><span class="sd">            times: Multiplies the number of times each element of `dice` will</span>
</span><span id="Pool.__init__-65"><a href="#Pool.__init__-65"><span class="linenos">65</span></a><span class="sd">                be put into the pool.</span>
</span><span id="Pool.__init__-66"><a href="#Pool.__init__-66"><span class="linenos">66</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Pool.__init__-67"><a href="#Pool.__init__-67"><span class="linenos">67</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Pool.__init__-68"><a href="#Pool.__init__-68"><span class="linenos">68</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Pool.__init__-69"><a href="#Pool.__init__-69"><span class="linenos">69</span></a>
</span><span id="Pool.__init__-70"><a href="#Pool.__init__-70"><span class="linenos">70</span></a><span class="sd">        Raises:</span>
</span><span id="Pool.__init__-71"><a href="#Pool.__init__-71"><span class="linenos">71</span></a><span class="sd">            ValueError: If a bare `Deck` or `Die` argument is provided.</span>
</span><span id="Pool.__init__-72"><a href="#Pool.__init__-72"><span class="linenos">72</span></a><span class="sd">                A `Pool` of a single `Die` should constructed as `Pool([die])`.</span>
</span><span id="Pool.__init__-73"><a href="#Pool.__init__-73"><span class="linenos">73</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool.__init__-74"><a href="#Pool.__init__-74"><span class="linenos">74</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">Pool</span><span class="p">):</span>
</span><span id="Pool.__init__-75"><a href="#Pool.__init__-75"><span class="linenos">75</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Pool.__init__-76"><a href="#Pool.__init__-76"><span class="linenos">76</span></a>                <span class="k">return</span> <span class="n">dice</span>
</span><span id="Pool.__init__-77"><a href="#Pool.__init__-77"><span class="linenos">77</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Pool.__init__-78"><a href="#Pool.__init__-78"><span class="linenos">78</span></a>                <span class="n">dice</span> <span class="o">=</span> <span class="p">{</span><span class="n">die</span><span class="p">:</span> <span class="n">quantity</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="n">dice</span><span class="o">.</span><span class="n">_dice</span><span class="p">}</span>
</span><span id="Pool.__init__-79"><a href="#Pool.__init__-79"><span class="linenos">79</span></a>
</span><span id="Pool.__init__-80"><a href="#Pool.__init__-80"><span class="linenos">80</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deck</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultiDeal</span><span class="p">)):</span>
</span><span id="Pool.__init__-81"><a href="#Pool.__init__-81"><span class="linenos">81</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool.__init__-82"><a href="#Pool.__init__-82"><span class="linenos">82</span></a>                <span class="sa">f</span><span class="s1">&#39;A Pool cannot be constructed with a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> argument.&#39;</span>
</span><span id="Pool.__init__-83"><a href="#Pool.__init__-83"><span class="linenos">83</span></a>            <span class="p">)</span>
</span><span id="Pool.__init__-84"><a href="#Pool.__init__-84"><span class="linenos">84</span></a>
</span><span id="Pool.__init__-85"><a href="#Pool.__init__-85"><span class="linenos">85</span></a>        <span class="n">dice</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Pool.__init__-86"><a href="#Pool.__init__-86"><span class="linenos">86</span></a>        <span class="n">converted_dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="Pool.__init__-87"><a href="#Pool.__init__-87"><span class="linenos">87</span></a>
</span><span id="Pool.__init__-88"><a href="#Pool.__init__-88"><span class="linenos">88</span></a>        <span class="n">dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool.__init__-89"><a href="#Pool.__init__-89"><span class="linenos">89</span></a>        <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">qty</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">converted_dice</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
</span><span id="Pool.__init__-90"><a href="#Pool.__init__-90"><span class="linenos">90</span></a>            <span class="k">if</span> <span class="n">die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="n">qty</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool.__init__-91"><a href="#Pool.__init__-91"><span class="linenos">91</span></a>                <span class="c1"># zero empty dice is considered to have no effect</span>
</span><span id="Pool.__init__-92"><a href="#Pool.__init__-92"><span class="linenos">92</span></a>                <span class="k">continue</span>
</span><span id="Pool.__init__-93"><a href="#Pool.__init__-93"><span class="linenos">93</span></a>            <span class="n">dice_counts</span><span class="p">[</span><span class="n">die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">qty</span>
</span><span id="Pool.__init__-94"><a href="#Pool.__init__-94"><span class="linenos">94</span></a>        <span class="n">keep_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="Pool.__init__-95"><a href="#Pool.__init__-95"><span class="linenos">95</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_new_from_mapping</span><span class="p">(</span><span class="n">dice_counts</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Public constructor for a pool.</p>

<p>Evaulation is most efficient when the dice are the same or same-side
truncations of each other. For example, d4, d6, d8, d10, d12 are all
same-side truncations of d12.</p>

<p>It is permissible to create a <code><a href="#Pool">Pool</a></code> without providing dice, but not all
evaluators will handle this case, especially if they depend on the
outcome type. In this case you may want to provide a die with zero
quantity.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>dice:</strong>  The dice to put in the <code><a href="#Pool">Pool</a></code>. This can be one of the following:</p>

<ul>
<li>A <code>Sequence</code> of <code><a href="#Die">Die</a></code> or outcomes.</li>
<li>A <code>Mapping</code> of <code><a href="#Die">Die</a></code> or outcomes to how many of that <code><a href="#Die">Die</a></code> or
outcome to put in the <code><a href="#Pool">Pool</a></code>.</li>
</ul>

<p>All outcomes within a <code><a href="#Pool">Pool</a></code> must be totally orderable.</p></li>
<li><strong>times:</strong>  Multiplies the number of times each element of <code>dice</code> will
be put into the pool.
<code>times</code> can either be a sequence of the same length as
<code><a href="#Pool.outcomes">outcomes</a></code> or a single <code>int</code> to apply to all elements of
<code><a href="#Pool.outcomes">outcomes</a></code>.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If a bare <code><a href="#Deck">Deck</a></code> or <code><a href="#Die">Die</a></code> argument is provided.
A <code><a href="#Pool">Pool</a></code> of a single <code><a href="#Die">Die</a></code> should constructed as <code>Pool([die])</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Pool.clear_cache" class="classattr">
                                        <input id="Pool.clear_cache-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">clear_cache</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Pool.clear_cache-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.clear_cache"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.clear_cache-116"><a href="#Pool.clear_cache-116"><span class="linenos">116</span></a>    <span class="nd">@classmethod</span>
</span><span id="Pool.clear_cache-117"><a href="#Pool.clear_cache-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">clear_cache</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
</span><span id="Pool.clear_cache-118"><a href="#Pool.clear_cache-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Clears the global pool cache.&quot;&quot;&quot;</span>
</span><span id="Pool.clear_cache-119"><a href="#Pool.clear_cache-119"><span class="linenos">119</span></a>        <span class="n">Pool</span><span class="o">.</span><span class="n">_new_raw</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Clears the global pool cache.</p>
</div>


                            </div>
                            <div id="Pool.raw_size" class="classattr">
                                        <input id="Pool.raw_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">raw_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Pool.raw_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.raw_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.raw_size-138"><a href="#Pool.raw_size-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">raw_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool.raw_size-139"><a href="#Pool.raw_size-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of dice in this pool before the keep_tuple is applied.&quot;&quot;&quot;</span>
</span><span id="Pool.raw_size-140"><a href="#Pool.raw_size-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_raw_size</span>
</span></pre></div>


            <div class="docstring"><p>The number of dice in this pool before the keep_tuple is applied.</p>
</div>


                            </div>
                            <div id="Pool.denominator" class="classattr">
                                        <input id="Pool.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Pool.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.denominator-149"><a href="#Pool.denominator-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool.denominator-150"><a href="#Pool.denominator-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div id="Pool.unique_dice" class="classattr">
                                        <input id="Pool.unique_dice-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unique_dice</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Collection</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="Pool.unique_dice-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.unique_dice"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.unique_dice-160"><a href="#Pool.unique_dice-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">unique_dice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="s1">&#39;icepool.Die[T]&#39;</span><span class="p">]:</span>
</span><span id="Pool.unique_dice-161"><a href="#Pool.unique_dice-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The collection of unique dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool.unique_dice-162"><a href="#Pool.unique_dice-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_dice</span>
</span></pre></div>


            <div class="docstring"><p>The collection of unique dice in this pool.</p>
</div>


                            </div>
                            <div id="Pool.outcomes" class="classattr">
                                        <input id="Pool.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Pool.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.outcomes-171"><a href="#Pool.outcomes-171"><span class="linenos">171</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="Pool.outcomes-172"><a href="#Pool.outcomes-172"><span class="linenos">172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The union of possible outcomes among all dice in this pool in ascending order.&quot;&quot;&quot;</span>
</span><span id="Pool.outcomes-173"><a href="#Pool.outcomes-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span></pre></div>


            <div class="docstring"><p>The union of possible outcomes among all dice in this pool in ascending order.</p>
</div>


                            </div>
                            <div id="Pool.output_arity" class="classattr">
                                        <input id="Pool.output_arity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">output_arity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Pool.output_arity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.output_arity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.output_arity-175"><a href="#Pool.output_arity-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool.output_arity-176"><a href="#Pool.output_arity-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>The number of multisets/counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="Pool.min_outcome" class="classattr">
                                        <input id="Pool.min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">T</span>:</span></span>

                <label class="view-source-button" for="Pool.min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.min_outcome-191"><a href="#Pool.min_outcome-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Pool.min_outcome-192"><a href="#Pool.min_outcome-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The min outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool.min_outcome-193"><a href="#Pool.min_outcome-193"><span class="linenos">193</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_outcome</span>
</span></pre></div>


            <div class="docstring"><p>The min outcome among all dice in this pool.</p>
</div>


                            </div>
                            <div id="Pool.max_outcome" class="classattr">
                                        <input id="Pool.max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">T</span>:</span></span>

                <label class="view-source-button" for="Pool.max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.max_outcome-199"><a href="#Pool.max_outcome-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="Pool.max_outcome-200"><a href="#Pool.max_outcome-200"><span class="linenos">200</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The max outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool.max_outcome-201"><a href="#Pool.max_outcome-201"><span class="linenos">201</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_outcome</span>
</span></pre></div>


            <div class="docstring"><p>The max outcome among all dice in this pool.</p>
</div>


                            </div>
                            <div id="Pool.additive_union" class="classattr">
                                        <input id="Pool.additive_union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">additive_union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Pool.additive_union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.additive_union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.additive_union-292"><a href="#Pool.additive_union-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span>
</span><span id="Pool.additive_union-293"><a href="#Pool.additive_union-293"><span class="linenos">293</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[T] | Mapping[T, int] | Sequence[T]&#39;</span>
</span><span id="Pool.additive_union-294"><a href="#Pool.additive_union-294"><span class="linenos">294</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T]&#39;</span><span class="p">:</span>
</span><span id="Pool.additive_union-295"><a href="#Pool.additive_union-295"><span class="linenos">295</span></a>        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Pool.additive_union-296"><a href="#Pool.additive_union-296"><span class="linenos">296</span></a>            <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</span><span id="Pool.additive_union-297"><a href="#Pool.additive_union-297"><span class="linenos">297</span></a>            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="Pool.additive_union-298"><a href="#Pool.additive_union-298"><span class="linenos">298</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Pool</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">):</span>
</span><span id="Pool.additive_union-299"><a href="#Pool.additive_union-299"><span class="linenos">299</span></a>            <span class="n">pools</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Pool</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">args</span><span class="p">)</span>
</span><span id="Pool.additive_union-300"><a href="#Pool.additive_union-300"><span class="linenos">300</span></a>            <span class="n">keep_tuple</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Pool.additive_union-301"><a href="#Pool.additive_union-301"><span class="linenos">301</span></a>                <span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">()</span> <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">pools</span><span class="p">),</span>
</span><span id="Pool.additive_union-302"><a href="#Pool.additive_union-302"><span class="linenos">302</span></a>                       <span class="p">()))</span>
</span><span id="Pool.additive_union-303"><a href="#Pool.additive_union-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keep_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool.additive_union-304"><a href="#Pool.additive_union-304"><span class="linenos">304</span></a>                <span class="c1"># All empty.</span>
</span><span id="Pool.additive_union-305"><a href="#Pool.additive_union-305"><span class="linenos">305</span></a>                <span class="k">return</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_empty</span><span class="p">()</span>
</span><span id="Pool.additive_union-306"><a href="#Pool.additive_union-306"><span class="linenos">306</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">keep_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">keep_tuple</span><span class="p">):</span>
</span><span id="Pool.additive_union-307"><a href="#Pool.additive_union-307"><span class="linenos">307</span></a>                <span class="c1"># All sorted positions count the same, so we can merge the</span>
</span><span id="Pool.additive_union-308"><a href="#Pool.additive_union-308"><span class="linenos">308</span></a>                <span class="c1"># pools.</span>
</span><span id="Pool.additive_union-309"><a href="#Pool.additive_union-309"><span class="linenos">309</span></a>                <span class="n">dice</span><span class="p">:</span> <span class="s1">&#39;MutableMapping[icepool.Die, int]&#39;</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool.additive_union-310"><a href="#Pool.additive_union-310"><span class="linenos">310</span></a>                <span class="k">for</span> <span class="n">pool</span> <span class="ow">in</span> <span class="n">pools</span><span class="p">:</span>
</span><span id="Pool.additive_union-311"><a href="#Pool.additive_union-311"><span class="linenos">311</span></a>                    <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">die_count</span> <span class="ow">in</span> <span class="n">pool</span><span class="o">.</span><span class="n">_dice</span><span class="p">:</span>
</span><span id="Pool.additive_union-312"><a href="#Pool.additive_union-312"><span class="linenos">312</span></a>                        <span class="n">dice</span><span class="p">[</span><span class="n">die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">die_count</span>
</span><span id="Pool.additive_union-313"><a href="#Pool.additive_union-313"><span class="linenos">313</span></a>                <span class="k">return</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_from_mapping</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">)</span>
</span><span id="Pool.additive_union-314"><a href="#Pool.additive_union-314"><span class="linenos">314</span></a>        <span class="k">return</span> <span class="n">KeepGenerator</span><span class="o">.</span><span class="n">additive_union</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The combined elements from all of the multisets.</p>

<p>Same as <code>a + b + c + ...</code>.</p>

<p>Any resulting counts that would be negative are set to zero.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>icepool.generator.keep.KeepGenerator</dt>
                                <dd id="Pool.keep_size" class="function">keep_size</dd>
                <dd id="Pool.keep_tuple" class="function">keep_tuple</dd>
                <dd id="Pool.has_negative_keeps" class="function">has_negative_keeps</dd>
                <dd id="Pool.keep" class="function">keep</dd>
                <dd id="Pool.middle" class="function">middle</dd>
                <dd id="Pool.multiply_counts" class="function">multiply_counts</dd>

            </div>
            <div><dt><a href="#MultisetGenerator">MultisetGenerator</a></dt>
                                <dd id="Pool.equals" class="function"><a href="#MultisetGenerator.equals">equals</a></dd>
                <dd id="Pool.order" class="function"><a href="#MultisetGenerator.order">order</a></dd>
                <dd id="Pool.sample" class="function"><a href="#MultisetGenerator.sample">sample</a></dd>

            </div>
            <div><dt><a href="#MultisetExpression">MultisetExpression</a></dt>
                                <dd id="Pool.difference" class="function"><a href="#MultisetExpression.difference">difference</a></dd>
                <dd id="Pool.intersection" class="function"><a href="#MultisetExpression.intersection">intersection</a></dd>
                <dd id="Pool.union" class="function"><a href="#MultisetExpression.union">union</a></dd>
                <dd id="Pool.symmetric_difference" class="function"><a href="#MultisetExpression.symmetric_difference">symmetric_difference</a></dd>
                <dd id="Pool.keep_outcomes" class="function"><a href="#MultisetExpression.keep_outcomes">keep_outcomes</a></dd>
                <dd id="Pool.drop_outcomes" class="function"><a href="#MultisetExpression.drop_outcomes">drop_outcomes</a></dd>
                <dd id="Pool.map_counts" class="function"><a href="#MultisetExpression.map_counts">map_counts</a></dd>
                <dd id="Pool.divide_counts" class="function"><a href="#MultisetExpression.divide_counts">divide_counts</a></dd>
                <dd id="Pool.modulo_counts" class="function"><a href="#MultisetExpression.modulo_counts">modulo_counts</a></dd>
                <dd id="Pool.keep_counts" class="function"><a href="#MultisetExpression.keep_counts">keep_counts</a></dd>
                <dd id="Pool.unique" class="function"><a href="#MultisetExpression.unique">unique</a></dd>
                <dd id="Pool.lowest" class="function"><a href="#MultisetExpression.lowest">lowest</a></dd>
                <dd id="Pool.highest" class="function"><a href="#MultisetExpression.highest">highest</a></dd>
                <dd id="Pool.pair_le" class="function"><a href="#MultisetExpression.pair_le">pair_le</a></dd>
                <dd id="Pool.evaluate" class="function"><a href="#MultisetExpression.evaluate">evaluate</a></dd>
                <dd id="Pool.expand" class="function"><a href="#MultisetExpression.expand">expand</a></dd>
                <dd id="Pool.sum" class="function"><a href="#MultisetExpression.sum">sum</a></dd>
                <dd id="Pool.count" class="function"><a href="#MultisetExpression.count">count</a></dd>
                <dd id="Pool.any" class="function"><a href="#MultisetExpression.any">any</a></dd>
                <dd id="Pool.highest_outcome_and_count" class="function"><a href="#MultisetExpression.highest_outcome_and_count">highest_outcome_and_count</a></dd>
                <dd id="Pool.all_counts" class="function"><a href="#MultisetExpression.all_counts">all_counts</a></dd>
                <dd id="Pool.largest_count" class="function"><a href="#MultisetExpression.largest_count">largest_count</a></dd>
                <dd id="Pool.largest_count_and_outcome" class="function"><a href="#MultisetExpression.largest_count_and_outcome">largest_count_and_outcome</a></dd>
                <dd id="Pool.count_subset" class="function"><a href="#MultisetExpression.count_subset">count_subset</a></dd>
                <dd id="Pool.largest_straight" class="function"><a href="#MultisetExpression.largest_straight">largest_straight</a></dd>
                <dd id="Pool.largest_straight_and_outcome" class="function"><a href="#MultisetExpression.largest_straight_and_outcome">largest_straight_and_outcome</a></dd>
                <dd id="Pool.all_straights" class="function"><a href="#MultisetExpression.all_straights">all_straights</a></dd>
                <dd id="Pool.all_straights_reduce_counts" class="function"><a href="#MultisetExpression.all_straights_reduce_counts">all_straights_reduce_counts</a></dd>
                <dd id="Pool.argsort" class="function"><a href="#MultisetExpression.argsort">argsort</a></dd>
                <dd id="Pool.issubset" class="function"><a href="#MultisetExpression.issubset">issubset</a></dd>
                <dd id="Pool.issuperset" class="function"><a href="#MultisetExpression.issuperset">issuperset</a></dd>
                <dd id="Pool.isdisjoint" class="function"><a href="#MultisetExpression.isdisjoint">isdisjoint</a></dd>
                <dd id="Pool.compair_lt" class="function"><a href="#MultisetExpression.compair_lt">compair_lt</a></dd>
                <dd id="Pool.compair_le" class="function"><a href="#MultisetExpression.compair_le">compair_le</a></dd>
                <dd id="Pool.compair_gt" class="function"><a href="#MultisetExpression.compair_gt">compair_gt</a></dd>
                <dd id="Pool.compair_ge" class="function"><a href="#MultisetExpression.compair_ge">compair_ge</a></dd>
                <dd id="Pool.compair_eq" class="function"><a href="#MultisetExpression.compair_eq">compair_eq</a></dd>
                <dd id="Pool.compair_ne" class="function"><a href="#MultisetExpression.compair_ne">compair_ne</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="standard_pool">
                            <input id="standard_pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standard_pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">die_sizes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Pool">Pool</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="standard_pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standard_pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standard_pool-327"><a href="#standard_pool-327"><span class="linenos">327</span></a><span class="k">def</span> <span class="nf">standard_pool</span><span class="p">(</span>
</span><span id="standard_pool-328"><a href="#standard_pool-328"><span class="linenos">328</span></a>        <span class="n">die_sizes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool[int]&#39;</span><span class="p">:</span>
</span><span id="standard_pool-329"><a href="#standard_pool-329"><span class="linenos">329</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A `Pool` of standard dice (e.g. d6, d8...).</span>
</span><span id="standard_pool-330"><a href="#standard_pool-330"><span class="linenos">330</span></a>
</span><span id="standard_pool-331"><a href="#standard_pool-331"><span class="linenos">331</span></a><span class="sd">    Args:</span>
</span><span id="standard_pool-332"><a href="#standard_pool-332"><span class="linenos">332</span></a><span class="sd">        die_sizes: A collection of die sizes, which will put one die of that</span>
</span><span id="standard_pool-333"><a href="#standard_pool-333"><span class="linenos">333</span></a><span class="sd">            sizes in the pool for each element.</span>
</span><span id="standard_pool-334"><a href="#standard_pool-334"><span class="linenos">334</span></a><span class="sd">            Or, a mapping of die sizes to how many dice of that size to put</span>
</span><span id="standard_pool-335"><a href="#standard_pool-335"><span class="linenos">335</span></a><span class="sd">            into the pool.</span>
</span><span id="standard_pool-336"><a href="#standard_pool-336"><span class="linenos">336</span></a><span class="sd">            If empty, the pool will be considered to consist of zero zeros.</span>
</span><span id="standard_pool-337"><a href="#standard_pool-337"><span class="linenos">337</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standard_pool-338"><a href="#standard_pool-338"><span class="linenos">338</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">die_sizes</span><span class="p">:</span>
</span><span id="standard_pool-339"><a href="#standard_pool-339"><span class="linenos">339</span></a>        <span class="k">return</span> <span class="n">Pool</span><span class="p">({</span><span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="mi">0</span><span class="p">]):</span> <span class="mi">0</span><span class="p">})</span>
</span><span id="standard_pool-340"><a href="#standard_pool-340"><span class="linenos">340</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">die_sizes</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="standard_pool-341"><a href="#standard_pool-341"><span class="linenos">341</span></a>        <span class="n">die_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="standard_pool-342"><a href="#standard_pool-342"><span class="linenos">342</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">([</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span>
</span><span id="standard_pool-343"><a href="#standard_pool-343"><span class="linenos">343</span></a>                                          <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">die_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="standard_pool-344"><a href="#standard_pool-344"><span class="linenos">344</span></a>    <span class="k">return</span> <span class="n">Pool</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">die_sizes</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Pool">Pool</a></code> of standard dice (e.g. d6, d8...).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>die_sizes:</strong>  A collection of die sizes, which will put one die of that
sizes in the pool for each element.
Or, a mapping of die sizes to how many dice of that size to put
into the pool.
If empty, the pool will be considered to consist of zero zeros.</li>
</ul>
</div>


                </section>
                <section id="MultisetGenerator">
                            <input id="MultisetGenerator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MultisetGenerator</span><wbr>(<span class="base">typing.Generic[~T, ~Qs]</span>, <span class="base"><a href="#MultisetExpression">icepool.MultisetExpression[~T]</a></span>):

                <label class="view-source-button" for="MultisetGenerator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator-32"><a href="#MultisetGenerator-32"><span class="linenos"> 32</span></a><span class="k">class</span> <span class="nc">MultisetGenerator</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Qs</span><span class="p">],</span> <span class="n">MultisetExpression</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="MultisetGenerator-33"><a href="#MultisetGenerator-33"><span class="linenos"> 33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for generating one or more multisets.</span>
</span><span id="MultisetGenerator-34"><a href="#MultisetGenerator-34"><span class="linenos"> 34</span></a>
</span><span id="MultisetGenerator-35"><a href="#MultisetGenerator-35"><span class="linenos"> 35</span></a><span class="sd">    These include dice pools (`Pool`) and card deals (`Deal`). Most likely you</span>
</span><span id="MultisetGenerator-36"><a href="#MultisetGenerator-36"><span class="linenos"> 36</span></a><span class="sd">    will be using one of these two rather than writing your own subclass of</span>
</span><span id="MultisetGenerator-37"><a href="#MultisetGenerator-37"><span class="linenos"> 37</span></a><span class="sd">    `MultisetGenerator`.</span>
</span><span id="MultisetGenerator-38"><a href="#MultisetGenerator-38"><span class="linenos"> 38</span></a>
</span><span id="MultisetGenerator-39"><a href="#MultisetGenerator-39"><span class="linenos"> 39</span></a><span class="sd">    The multisets are incrementally generated one outcome at a time.</span>
</span><span id="MultisetGenerator-40"><a href="#MultisetGenerator-40"><span class="linenos"> 40</span></a><span class="sd">    For each outcome, a `count` and `weight` are generated, along with a</span>
</span><span id="MultisetGenerator-41"><a href="#MultisetGenerator-41"><span class="linenos"> 41</span></a><span class="sd">    smaller generator to produce the rest of the multiset.</span>
</span><span id="MultisetGenerator-42"><a href="#MultisetGenerator-42"><span class="linenos"> 42</span></a>
</span><span id="MultisetGenerator-43"><a href="#MultisetGenerator-43"><span class="linenos"> 43</span></a><span class="sd">    You can perform simple evaluations using built-in operators and methods in</span>
</span><span id="MultisetGenerator-44"><a href="#MultisetGenerator-44"><span class="linenos"> 44</span></a><span class="sd">    this class.</span>
</span><span id="MultisetGenerator-45"><a href="#MultisetGenerator-45"><span class="linenos"> 45</span></a><span class="sd">    For more complex evaluations and better performance, particularly when</span>
</span><span id="MultisetGenerator-46"><a href="#MultisetGenerator-46"><span class="linenos"> 46</span></a><span class="sd">    multiple generators are involved, you will want to write your own subclass</span>
</span><span id="MultisetGenerator-47"><a href="#MultisetGenerator-47"><span class="linenos"> 47</span></a><span class="sd">    of `MultisetEvaluator`.</span>
</span><span id="MultisetGenerator-48"><a href="#MultisetGenerator-48"><span class="linenos"> 48</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-49"><a href="#MultisetGenerator-49"><span class="linenos"> 49</span></a>
</span><span id="MultisetGenerator-50"><a href="#MultisetGenerator-50"><span class="linenos"> 50</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-51"><a href="#MultisetGenerator-51"><span class="linenos"> 51</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="MultisetGenerator-52"><a href="#MultisetGenerator-52"><span class="linenos"> 52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The possible outcomes that could be generated, in ascending order.&quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-53"><a href="#MultisetGenerator-53"><span class="linenos"> 53</span></a>
</span><span id="MultisetGenerator-54"><a href="#MultisetGenerator-54"><span class="linenos"> 54</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-55"><a href="#MultisetGenerator-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetGenerator-56"><a href="#MultisetGenerator-56"><span class="linenos"> 56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of multisets/counts generated. Must be constant.&quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-57"><a href="#MultisetGenerator-57"><span class="linenos"> 57</span></a>
</span><span id="MultisetGenerator-58"><a href="#MultisetGenerator-58"><span class="linenos"> 58</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-59"><a href="#MultisetGenerator-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultisetGenerator-60"><a href="#MultisetGenerator-60"><span class="linenos"> 60</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`True` iff the generator is capable of producing an overall outcome.</span>
</span><span id="MultisetGenerator-61"><a href="#MultisetGenerator-61"><span class="linenos"> 61</span></a>
</span><span id="MultisetGenerator-62"><a href="#MultisetGenerator-62"><span class="linenos"> 62</span></a><span class="sd">        For example, a dice `Pool` will return `False` if it contains any dice</span>
</span><span id="MultisetGenerator-63"><a href="#MultisetGenerator-63"><span class="linenos"> 63</span></a><span class="sd">        with no outcomes.</span>
</span><span id="MultisetGenerator-64"><a href="#MultisetGenerator-64"><span class="linenos"> 64</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-65"><a href="#MultisetGenerator-65"><span class="linenos"> 65</span></a>
</span><span id="MultisetGenerator-66"><a href="#MultisetGenerator-66"><span class="linenos"> 66</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-67"><a href="#MultisetGenerator-67"><span class="linenos"> 67</span></a>    <span class="k">def</span> <span class="nf">_generate_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InitialMultisetGenerator</span><span class="p">:</span>
</span><span id="MultisetGenerator-68"><a href="#MultisetGenerator-68"><span class="linenos"> 68</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the generator before any outcomes are emitted.</span>
</span><span id="MultisetGenerator-69"><a href="#MultisetGenerator-69"><span class="linenos"> 69</span></a>
</span><span id="MultisetGenerator-70"><a href="#MultisetGenerator-70"><span class="linenos"> 70</span></a><span class="sd">        Yields:</span>
</span><span id="MultisetGenerator-71"><a href="#MultisetGenerator-71"><span class="linenos"> 71</span></a><span class="sd">            * A sub-generator.</span>
</span><span id="MultisetGenerator-72"><a href="#MultisetGenerator-72"><span class="linenos"> 72</span></a><span class="sd">            * The weight for selecting that sub-generator.</span>
</span><span id="MultisetGenerator-73"><a href="#MultisetGenerator-73"><span class="linenos"> 73</span></a><span class="sd">        </span>
</span><span id="MultisetGenerator-74"><a href="#MultisetGenerator-74"><span class="linenos"> 74</span></a><span class="sd">        Unitary generators can just yield `(self, 1)` and return.</span>
</span><span id="MultisetGenerator-75"><a href="#MultisetGenerator-75"><span class="linenos"> 75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-76"><a href="#MultisetGenerator-76"><span class="linenos"> 76</span></a>
</span><span id="MultisetGenerator-77"><a href="#MultisetGenerator-77"><span class="linenos"> 77</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-78"><a href="#MultisetGenerator-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="MultisetGenerator-79"><a href="#MultisetGenerator-79"><span class="linenos"> 79</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pops the min outcome from this generator if it matches the argument.</span>
</span><span id="MultisetGenerator-80"><a href="#MultisetGenerator-80"><span class="linenos"> 80</span></a>
</span><span id="MultisetGenerator-81"><a href="#MultisetGenerator-81"><span class="linenos"> 81</span></a><span class="sd">        Yields:</span>
</span><span id="MultisetGenerator-82"><a href="#MultisetGenerator-82"><span class="linenos"> 82</span></a><span class="sd">            * A generator with the min outcome popped.</span>
</span><span id="MultisetGenerator-83"><a href="#MultisetGenerator-83"><span class="linenos"> 83</span></a><span class="sd">            * A tuple of counts for the min outcome.</span>
</span><span id="MultisetGenerator-84"><a href="#MultisetGenerator-84"><span class="linenos"> 84</span></a><span class="sd">            * The weight for this many of the min outcome appearing.</span>
</span><span id="MultisetGenerator-85"><a href="#MultisetGenerator-85"><span class="linenos"> 85</span></a>
</span><span id="MultisetGenerator-86"><a href="#MultisetGenerator-86"><span class="linenos"> 86</span></a><span class="sd">            If the argument does not match the min outcome, or this generator</span>
</span><span id="MultisetGenerator-87"><a href="#MultisetGenerator-87"><span class="linenos"> 87</span></a><span class="sd">            has no outcomes, only a single tuple is yielded:</span>
</span><span id="MultisetGenerator-88"><a href="#MultisetGenerator-88"><span class="linenos"> 88</span></a>
</span><span id="MultisetGenerator-89"><a href="#MultisetGenerator-89"><span class="linenos"> 89</span></a><span class="sd">            * `self`</span>
</span><span id="MultisetGenerator-90"><a href="#MultisetGenerator-90"><span class="linenos"> 90</span></a><span class="sd">            * A tuple of zeros.</span>
</span><span id="MultisetGenerator-91"><a href="#MultisetGenerator-91"><span class="linenos"> 91</span></a><span class="sd">            * weight = 1.</span>
</span><span id="MultisetGenerator-92"><a href="#MultisetGenerator-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-93"><a href="#MultisetGenerator-93"><span class="linenos"> 93</span></a>
</span><span id="MultisetGenerator-94"><a href="#MultisetGenerator-94"><span class="linenos"> 94</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-95"><a href="#MultisetGenerator-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="MultisetGenerator-96"><a href="#MultisetGenerator-96"><span class="linenos"> 96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pops the max outcome from this generator if it matches the argument.</span>
</span><span id="MultisetGenerator-97"><a href="#MultisetGenerator-97"><span class="linenos"> 97</span></a>
</span><span id="MultisetGenerator-98"><a href="#MultisetGenerator-98"><span class="linenos"> 98</span></a><span class="sd">        Yields:</span>
</span><span id="MultisetGenerator-99"><a href="#MultisetGenerator-99"><span class="linenos"> 99</span></a><span class="sd">            * A generator with the min outcome popped.</span>
</span><span id="MultisetGenerator-100"><a href="#MultisetGenerator-100"><span class="linenos">100</span></a><span class="sd">            * A tuple of counts for the min outcome.</span>
</span><span id="MultisetGenerator-101"><a href="#MultisetGenerator-101"><span class="linenos">101</span></a><span class="sd">            * The weight for this many of the min outcome appearing.</span>
</span><span id="MultisetGenerator-102"><a href="#MultisetGenerator-102"><span class="linenos">102</span></a>
</span><span id="MultisetGenerator-103"><a href="#MultisetGenerator-103"><span class="linenos">103</span></a><span class="sd">            If the argument does not match the min outcome, or this generator</span>
</span><span id="MultisetGenerator-104"><a href="#MultisetGenerator-104"><span class="linenos">104</span></a><span class="sd">            has no outcomes, only a single tuple is yielded:</span>
</span><span id="MultisetGenerator-105"><a href="#MultisetGenerator-105"><span class="linenos">105</span></a>
</span><span id="MultisetGenerator-106"><a href="#MultisetGenerator-106"><span class="linenos">106</span></a><span class="sd">            * `self`</span>
</span><span id="MultisetGenerator-107"><a href="#MultisetGenerator-107"><span class="linenos">107</span></a><span class="sd">            * A tuple of zeros.</span>
</span><span id="MultisetGenerator-108"><a href="#MultisetGenerator-108"><span class="linenos">108</span></a><span class="sd">            * weight = 1.</span>
</span><span id="MultisetGenerator-109"><a href="#MultisetGenerator-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-110"><a href="#MultisetGenerator-110"><span class="linenos">110</span></a>
</span><span id="MultisetGenerator-111"><a href="#MultisetGenerator-111"><span class="linenos">111</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-112"><a href="#MultisetGenerator-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="MultisetGenerator-113"><a href="#MultisetGenerator-113"><span class="linenos">113</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimates the cost of popping from the min and max sides during an evaluation.</span>
</span><span id="MultisetGenerator-114"><a href="#MultisetGenerator-114"><span class="linenos">114</span></a>
</span><span id="MultisetGenerator-115"><a href="#MultisetGenerator-115"><span class="linenos">115</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetGenerator-116"><a href="#MultisetGenerator-116"><span class="linenos">116</span></a><span class="sd">            pop_min_cost: A positive `int`.</span>
</span><span id="MultisetGenerator-117"><a href="#MultisetGenerator-117"><span class="linenos">117</span></a><span class="sd">            pop_max_cost: A positive `int`.</span>
</span><span id="MultisetGenerator-118"><a href="#MultisetGenerator-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-119"><a href="#MultisetGenerator-119"><span class="linenos">119</span></a>
</span><span id="MultisetGenerator-120"><a href="#MultisetGenerator-120"><span class="linenos">120</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-121"><a href="#MultisetGenerator-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetGenerator-122"><a href="#MultisetGenerator-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total weight of all paths through this generator.&quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-123"><a href="#MultisetGenerator-123"><span class="linenos">123</span></a>
</span><span id="MultisetGenerator-124"><a href="#MultisetGenerator-124"><span class="linenos">124</span></a>    <span class="nd">@property</span>
</span><span id="MultisetGenerator-125"><a href="#MultisetGenerator-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">_can_keep</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultisetGenerator-126"><a href="#MultisetGenerator-126"><span class="linenos">126</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the generator supports enhanced keep operations.&quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-127"><a href="#MultisetGenerator-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="MultisetGenerator-128"><a href="#MultisetGenerator-128"><span class="linenos">128</span></a>
</span><span id="MultisetGenerator-129"><a href="#MultisetGenerator-129"><span class="linenos">129</span></a>    <span class="nd">@property</span>
</span><span id="MultisetGenerator-130"><a href="#MultisetGenerator-130"><span class="linenos">130</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator-131"><a href="#MultisetGenerator-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">_hash_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="MultisetGenerator-132"><a href="#MultisetGenerator-132"><span class="linenos">132</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A hash key that logically identifies this object among MultisetGenerators.</span>
</span><span id="MultisetGenerator-133"><a href="#MultisetGenerator-133"><span class="linenos">133</span></a>
</span><span id="MultisetGenerator-134"><a href="#MultisetGenerator-134"><span class="linenos">134</span></a><span class="sd">        Used to implement `equals()` and `__hash__()`</span>
</span><span id="MultisetGenerator-135"><a href="#MultisetGenerator-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-136"><a href="#MultisetGenerator-136"><span class="linenos">136</span></a>
</span><span id="MultisetGenerator-137"><a href="#MultisetGenerator-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultisetGenerator-138"><a href="#MultisetGenerator-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this generator is logically equal to another object.&quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-139"><a href="#MultisetGenerator-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MultisetGenerator</span><span class="p">):</span>
</span><span id="MultisetGenerator-140"><a href="#MultisetGenerator-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="MultisetGenerator-141"><a href="#MultisetGenerator-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash_key</span>
</span><span id="MultisetGenerator-142"><a href="#MultisetGenerator-142"><span class="linenos">142</span></a>
</span><span id="MultisetGenerator-143"><a href="#MultisetGenerator-143"><span class="linenos">143</span></a>    <span class="nd">@cached_property</span>
</span><span id="MultisetGenerator-144"><a href="#MultisetGenerator-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetGenerator-145"><a href="#MultisetGenerator-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span><span class="p">)</span>
</span><span id="MultisetGenerator-146"><a href="#MultisetGenerator-146"><span class="linenos">146</span></a>
</span><span id="MultisetGenerator-147"><a href="#MultisetGenerator-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetGenerator-148"><a href="#MultisetGenerator-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="MultisetGenerator-149"><a href="#MultisetGenerator-149"><span class="linenos">149</span></a>
</span><span id="MultisetGenerator-150"><a href="#MultisetGenerator-150"><span class="linenos">150</span></a>    <span class="c1"># Equality with truth value, needed for hashing.</span>
</span><span id="MultisetGenerator-151"><a href="#MultisetGenerator-151"><span class="linenos">151</span></a>
</span><span id="MultisetGenerator-152"><a href="#MultisetGenerator-152"><span class="linenos">152</span></a>    <span class="c1"># The result has a truth value, but is not a bool.</span>
</span><span id="MultisetGenerator-153"><a href="#MultisetGenerator-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="MultisetGenerator-154"><a href="#MultisetGenerator-154"><span class="linenos">154</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.DieWithTruth[bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetGenerator-155"><a href="#MultisetGenerator-155"><span class="linenos">155</span></a>
</span><span id="MultisetGenerator-156"><a href="#MultisetGenerator-156"><span class="linenos">156</span></a>        <span class="k">def</span> <span class="nf">data_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Counts</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="MultisetGenerator-157"><a href="#MultisetGenerator-157"><span class="linenos">157</span></a>            <span class="n">die</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;icepool.Die[bool]&#39;</span><span class="p">,</span>
</span><span id="MultisetGenerator-158"><a href="#MultisetGenerator-158"><span class="linenos">158</span></a>                       <span class="n">MultisetExpression</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="MultisetGenerator-159"><a href="#MultisetGenerator-159"><span class="linenos">159</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">die</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">):</span>
</span><span id="MultisetGenerator-160"><a href="#MultisetGenerator-160"><span class="linenos">160</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Did not resolve to a die.&#39;</span><span class="p">)</span>
</span><span id="MultisetGenerator-161"><a href="#MultisetGenerator-161"><span class="linenos">161</span></a>            <span class="k">return</span> <span class="n">die</span><span class="o">.</span><span class="n">_data</span>
</span><span id="MultisetGenerator-162"><a href="#MultisetGenerator-162"><span class="linenos">162</span></a>
</span><span id="MultisetGenerator-163"><a href="#MultisetGenerator-163"><span class="linenos">163</span></a>        <span class="k">def</span> <span class="nf">truth_value_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultisetGenerator-164"><a href="#MultisetGenerator-164"><span class="linenos">164</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MultisetGenerator</span><span class="p">):</span>
</span><span id="MultisetGenerator-165"><a href="#MultisetGenerator-165"><span class="linenos">165</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="MultisetGenerator-166"><a href="#MultisetGenerator-166"><span class="linenos">166</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash_key</span>
</span><span id="MultisetGenerator-167"><a href="#MultisetGenerator-167"><span class="linenos">167</span></a>
</span><span id="MultisetGenerator-168"><a href="#MultisetGenerator-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">DieWithTruth</span><span class="p">(</span><span class="n">data_callback</span><span class="p">,</span> <span class="n">truth_value_callback</span><span class="p">)</span>
</span><span id="MultisetGenerator-169"><a href="#MultisetGenerator-169"><span class="linenos">169</span></a>
</span><span id="MultisetGenerator-170"><a href="#MultisetGenerator-170"><span class="linenos">170</span></a>    <span class="c1"># The result has a truth value, but is not a bool.</span>
</span><span id="MultisetGenerator-171"><a href="#MultisetGenerator-171"><span class="linenos">171</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="MultisetGenerator-172"><a href="#MultisetGenerator-172"><span class="linenos">172</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.DieWithTruth[bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetGenerator-173"><a href="#MultisetGenerator-173"><span class="linenos">173</span></a>
</span><span id="MultisetGenerator-174"><a href="#MultisetGenerator-174"><span class="linenos">174</span></a>        <span class="k">def</span> <span class="nf">data_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Counts</span><span class="p">[</span><span class="nb">bool</span><span class="p">]:</span>
</span><span id="MultisetGenerator-175"><a href="#MultisetGenerator-175"><span class="linenos">175</span></a>            <span class="n">die</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s1">&#39;icepool.Die[bool]&#39;</span><span class="p">,</span>
</span><span id="MultisetGenerator-176"><a href="#MultisetGenerator-176"><span class="linenos">176</span></a>                       <span class="n">MultisetExpression</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">))</span>
</span><span id="MultisetGenerator-177"><a href="#MultisetGenerator-177"><span class="linenos">177</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">die</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">):</span>
</span><span id="MultisetGenerator-178"><a href="#MultisetGenerator-178"><span class="linenos">178</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Did not resolve to a die.&#39;</span><span class="p">)</span>
</span><span id="MultisetGenerator-179"><a href="#MultisetGenerator-179"><span class="linenos">179</span></a>            <span class="k">return</span> <span class="n">die</span><span class="o">.</span><span class="n">_data</span>
</span><span id="MultisetGenerator-180"><a href="#MultisetGenerator-180"><span class="linenos">180</span></a>
</span><span id="MultisetGenerator-181"><a href="#MultisetGenerator-181"><span class="linenos">181</span></a>        <span class="k">def</span> <span class="nf">truth_value_callback</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultisetGenerator-182"><a href="#MultisetGenerator-182"><span class="linenos">182</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MultisetGenerator</span><span class="p">):</span>
</span><span id="MultisetGenerator-183"><a href="#MultisetGenerator-183"><span class="linenos">183</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="MultisetGenerator-184"><a href="#MultisetGenerator-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash_key</span>
</span><span id="MultisetGenerator-185"><a href="#MultisetGenerator-185"><span class="linenos">185</span></a>
</span><span id="MultisetGenerator-186"><a href="#MultisetGenerator-186"><span class="linenos">186</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">DieWithTruth</span><span class="p">(</span><span class="n">data_callback</span><span class="p">,</span> <span class="n">truth_value_callback</span><span class="p">)</span>
</span><span id="MultisetGenerator-187"><a href="#MultisetGenerator-187"><span class="linenos">187</span></a>
</span><span id="MultisetGenerator-188"><a href="#MultisetGenerator-188"><span class="linenos">188</span></a>    <span class="c1"># Expression API.</span>
</span><span id="MultisetGenerator-189"><a href="#MultisetGenerator-189"><span class="linenos">189</span></a>
</span><span id="MultisetGenerator-190"><a href="#MultisetGenerator-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">_next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">Outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">:</span>
</span><span id="MultisetGenerator-191"><a href="#MultisetGenerator-191"><span class="linenos">191</span></a>                    <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="MultisetGenerator-192"><a href="#MultisetGenerator-192"><span class="linenos">192</span></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="MultisetGenerator-193"><a href="#MultisetGenerator-193"><span class="linenos">193</span></a>            <span class="s1">&#39;Internal error: Expressions should be unbound before evaluation.&#39;</span><span class="p">)</span>
</span><span id="MultisetGenerator-194"><a href="#MultisetGenerator-194"><span class="linenos">194</span></a>
</span><span id="MultisetGenerator-195"><a href="#MultisetGenerator-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="MultisetGenerator-196"><a href="#MultisetGenerator-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span><span id="MultisetGenerator-197"><a href="#MultisetGenerator-197"><span class="linenos">197</span></a>
</span><span id="MultisetGenerator-198"><a href="#MultisetGenerator-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">_bound_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator, ...]&#39;</span><span class="p">:</span>
</span><span id="MultisetGenerator-199"><a href="#MultisetGenerator-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">)</span>
</span><span id="MultisetGenerator-200"><a href="#MultisetGenerator-200"><span class="linenos">200</span></a>
</span><span id="MultisetGenerator-201"><a href="#MultisetGenerator-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">_unbind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MultisetGenerator-202"><a href="#MultisetGenerator-202"><span class="linenos">202</span></a>                <span class="n">free_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[MultisetExpression, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetGenerator-203"><a href="#MultisetGenerator-203"><span class="linenos">203</span></a>        <span class="n">unbound_expression</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">MultisetVariable</span><span class="p">(</span><span class="n">prefix_start</span><span class="p">)</span>
</span><span id="MultisetGenerator-204"><a href="#MultisetGenerator-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">unbound_expression</span><span class="p">,</span> <span class="n">prefix_start</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="MultisetGenerator-205"><a href="#MultisetGenerator-205"><span class="linenos">205</span></a>
</span><span id="MultisetGenerator-206"><a href="#MultisetGenerator-206"><span class="linenos">206</span></a>    <span class="k">def</span> <span class="nf">_free_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetGenerator-207"><a href="#MultisetGenerator-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="MultisetGenerator-208"><a href="#MultisetGenerator-208"><span class="linenos">208</span></a>
</span><span id="MultisetGenerator-209"><a href="#MultisetGenerator-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="MultisetGenerator-210"><a href="#MultisetGenerator-210"><span class="linenos">210</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MultisetGenerator-211"><a href="#MultisetGenerator-211"><span class="linenos">211</span></a>
</span><span id="MultisetGenerator-212"><a href="#MultisetGenerator-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="MultisetGenerator-213"><a href="#MultisetGenerator-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MultisetGenerator-214"><a href="#MultisetGenerator-214"><span class="linenos">214</span></a>
</span><span id="MultisetGenerator-215"><a href="#MultisetGenerator-215"><span class="linenos">215</span></a>    <span class="c1"># Sampling.</span>
</span><span id="MultisetGenerator-216"><a href="#MultisetGenerator-216"><span class="linenos">216</span></a>
</span><span id="MultisetGenerator-217"><a href="#MultisetGenerator-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="MultisetGenerator-218"><a href="#MultisetGenerator-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: A single random sample from this generator.</span>
</span><span id="MultisetGenerator-219"><a href="#MultisetGenerator-219"><span class="linenos">219</span></a>
</span><span id="MultisetGenerator-220"><a href="#MultisetGenerator-220"><span class="linenos">220</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="MultisetGenerator-221"><a href="#MultisetGenerator-221"><span class="linenos">221</span></a><span class="sd">        secure.</span>
</span><span id="MultisetGenerator-222"><a href="#MultisetGenerator-222"><span class="linenos">222</span></a>
</span><span id="MultisetGenerator-223"><a href="#MultisetGenerator-223"><span class="linenos">223</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetGenerator-224"><a href="#MultisetGenerator-224"><span class="linenos">224</span></a><span class="sd">            A sorted tuple of outcomes for each output of this generator.</span>
</span><span id="MultisetGenerator-225"><a href="#MultisetGenerator-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator-226"><a href="#MultisetGenerator-226"><span class="linenos">226</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="MultisetGenerator-227"><a href="#MultisetGenerator-227"><span class="linenos">227</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot sample from an empty set of outcomes.&#39;</span><span class="p">)</span>
</span><span id="MultisetGenerator-228"><a href="#MultisetGenerator-228"><span class="linenos">228</span></a>
</span><span id="MultisetGenerator-229"><a href="#MultisetGenerator-229"><span class="linenos">229</span></a>        <span class="n">min_cost</span><span class="p">,</span> <span class="n">max_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_order_costs</span><span class="p">()</span>
</span><span id="MultisetGenerator-230"><a href="#MultisetGenerator-230"><span class="linenos">230</span></a>
</span><span id="MultisetGenerator-231"><a href="#MultisetGenerator-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="n">min_cost</span> <span class="o">&lt;</span> <span class="n">max_cost</span><span class="p">:</span>
</span><span id="MultisetGenerator-232"><a href="#MultisetGenerator-232"><span class="linenos">232</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="MultisetGenerator-233"><a href="#MultisetGenerator-233"><span class="linenos">233</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="MultisetGenerator-234"><a href="#MultisetGenerator-234"><span class="linenos">234</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetGenerator-235"><a href="#MultisetGenerator-235"><span class="linenos">235</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="MultisetGenerator-236"><a href="#MultisetGenerator-236"><span class="linenos">236</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="MultisetGenerator-237"><a href="#MultisetGenerator-237"><span class="linenos">237</span></a>
</span><span id="MultisetGenerator-238"><a href="#MultisetGenerator-238"><span class="linenos">238</span></a>        <span class="n">cumulative_weights</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetGenerator-239"><a href="#MultisetGenerator-239"><span class="linenos">239</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">generated</span><span class="p">))</span>
</span><span id="MultisetGenerator-240"><a href="#MultisetGenerator-240"><span class="linenos">240</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MultisetGenerator-241"><a href="#MultisetGenerator-241"><span class="linenos">241</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="MultisetGenerator-242"><a href="#MultisetGenerator-242"><span class="linenos">242</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
</span><span id="MultisetGenerator-243"><a href="#MultisetGenerator-243"><span class="linenos">243</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">cumulative_weights</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="MultisetGenerator-244"><a href="#MultisetGenerator-244"><span class="linenos">244</span></a>        <span class="n">popped_generator</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generated</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="MultisetGenerator-245"><a href="#MultisetGenerator-245"><span class="linenos">245</span></a>        <span class="n">head</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">outcome</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">count</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">)</span>
</span><span id="MultisetGenerator-246"><a href="#MultisetGenerator-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="MultisetGenerator-247"><a href="#MultisetGenerator-247"><span class="linenos">247</span></a>            <span class="n">tail</span> <span class="o">=</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</span><span id="MultisetGenerator-248"><a href="#MultisetGenerator-248"><span class="linenos">248</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">))</span>
</span><span id="MultisetGenerator-249"><a href="#MultisetGenerator-249"><span class="linenos">249</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetGenerator-250"><a href="#MultisetGenerator-250"><span class="linenos">250</span></a>            <span class="k">return</span> <span class="n">head</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base class for generating one or more multisets.</p>

<p>These include dice pools (<code><a href="#Pool">Pool</a></code>) and card deals (<code><a href="#Deal">Deal</a></code>). Most likely you
will be using one of these two rather than writing your own subclass of
<code><a href="#MultisetGenerator">MultisetGenerator</a></code>.</p>

<p>The multisets are incrementally generated one outcome at a time.
For each outcome, a <code><a href="#MultisetGenerator.count">count</a></code> and <code>weight</code> are generated, along with a
smaller generator to produce the rest of the multiset.</p>

<p>You can perform simple evaluations using built-in operators and methods in
this class.
For more complex evaluations and better performance, particularly when
multiple generators are involved, you will want to write your own subclass
of <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code>.</p>
</div>


                            <div id="MultisetGenerator.outcomes" class="classattr">
                                        <input id="MultisetGenerator.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.outcomes-50"><a href="#MultisetGenerator.outcomes-50"><span class="linenos">50</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator.outcomes-51"><a href="#MultisetGenerator.outcomes-51"><span class="linenos">51</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="MultisetGenerator.outcomes-52"><a href="#MultisetGenerator.outcomes-52"><span class="linenos">52</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The possible outcomes that could be generated, in ascending order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The possible outcomes that could be generated, in ascending order.</p>
</div>


                            </div>
                            <div id="MultisetGenerator.output_arity" class="classattr">
                                        <input id="MultisetGenerator.output_arity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">output_arity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.output_arity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.output_arity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.output_arity-54"><a href="#MultisetGenerator.output_arity-54"><span class="linenos">54</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator.output_arity-55"><a href="#MultisetGenerator.output_arity-55"><span class="linenos">55</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetGenerator.output_arity-56"><a href="#MultisetGenerator.output_arity-56"><span class="linenos">56</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of multisets/counts generated. Must be constant.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The number of multisets/counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="MultisetGenerator.denominator" class="classattr">
                                        <input id="MultisetGenerator.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.denominator-120"><a href="#MultisetGenerator.denominator-120"><span class="linenos">120</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetGenerator.denominator-121"><a href="#MultisetGenerator.denominator-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetGenerator.denominator-122"><a href="#MultisetGenerator.denominator-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total weight of all paths through this generator.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div id="MultisetGenerator.equals" class="classattr">
                                        <input id="MultisetGenerator.equals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">equals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.equals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.equals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.equals-137"><a href="#MultisetGenerator.equals-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultisetGenerator.equals-138"><a href="#MultisetGenerator.equals-138"><span class="linenos">138</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether this generator is logically equal to another object.&quot;&quot;&quot;</span>
</span><span id="MultisetGenerator.equals-139"><a href="#MultisetGenerator.equals-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MultisetGenerator</span><span class="p">):</span>
</span><span id="MultisetGenerator.equals-140"><a href="#MultisetGenerator.equals-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="MultisetGenerator.equals-141"><a href="#MultisetGenerator.equals-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash_key</span>
</span></pre></div>


            <div class="docstring"><p>Whether this generator is logically equal to another object.</p>
</div>


                            </div>
                            <div id="MultisetGenerator.order" class="classattr">
                                        <input id="MultisetGenerator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Order">Order</a></span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.order-195"><a href="#MultisetGenerator.order-195"><span class="linenos">195</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="MultisetGenerator.order-196"><a href="#MultisetGenerator.order-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span></pre></div>


            <div class="docstring"><p>Any ordering that is required by this expression.</p>

<p>This should check any previous expressions for their order, and
raise a ValueError for any incompatibilities.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The required order.</p>
</blockquote>
</div>


                            </div>
                            <div id="MultisetGenerator.min_outcome" class="classattr">
                                        <input id="MultisetGenerator.min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">T</span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.min_outcome-209"><a href="#MultisetGenerator.min_outcome-209"><span class="linenos">209</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="MultisetGenerator.min_outcome-210"><a href="#MultisetGenerator.min_outcome-210"><span class="linenos">210</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="MultisetGenerator.max_outcome" class="classattr">
                                        <input id="MultisetGenerator.max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">T</span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.max_outcome-212"><a href="#MultisetGenerator.max_outcome-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T</span><span class="p">:</span>
</span><span id="MultisetGenerator.max_outcome-213"><a href="#MultisetGenerator.max_outcome-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="MultisetGenerator.sample" class="classattr">
                                        <input id="MultisetGenerator.sample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetGenerator.sample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetGenerator.sample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetGenerator.sample-217"><a href="#MultisetGenerator.sample-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="MultisetGenerator.sample-218"><a href="#MultisetGenerator.sample-218"><span class="linenos">218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: A single random sample from this generator.</span>
</span><span id="MultisetGenerator.sample-219"><a href="#MultisetGenerator.sample-219"><span class="linenos">219</span></a>
</span><span id="MultisetGenerator.sample-220"><a href="#MultisetGenerator.sample-220"><span class="linenos">220</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="MultisetGenerator.sample-221"><a href="#MultisetGenerator.sample-221"><span class="linenos">221</span></a><span class="sd">        secure.</span>
</span><span id="MultisetGenerator.sample-222"><a href="#MultisetGenerator.sample-222"><span class="linenos">222</span></a>
</span><span id="MultisetGenerator.sample-223"><a href="#MultisetGenerator.sample-223"><span class="linenos">223</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetGenerator.sample-224"><a href="#MultisetGenerator.sample-224"><span class="linenos">224</span></a><span class="sd">            A sorted tuple of outcomes for each output of this generator.</span>
</span><span id="MultisetGenerator.sample-225"><a href="#MultisetGenerator.sample-225"><span class="linenos">225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetGenerator.sample-226"><a href="#MultisetGenerator.sample-226"><span class="linenos">226</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="MultisetGenerator.sample-227"><a href="#MultisetGenerator.sample-227"><span class="linenos">227</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot sample from an empty set of outcomes.&#39;</span><span class="p">)</span>
</span><span id="MultisetGenerator.sample-228"><a href="#MultisetGenerator.sample-228"><span class="linenos">228</span></a>
</span><span id="MultisetGenerator.sample-229"><a href="#MultisetGenerator.sample-229"><span class="linenos">229</span></a>        <span class="n">min_cost</span><span class="p">,</span> <span class="n">max_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_order_costs</span><span class="p">()</span>
</span><span id="MultisetGenerator.sample-230"><a href="#MultisetGenerator.sample-230"><span class="linenos">230</span></a>
</span><span id="MultisetGenerator.sample-231"><a href="#MultisetGenerator.sample-231"><span class="linenos">231</span></a>        <span class="k">if</span> <span class="n">min_cost</span> <span class="o">&lt;</span> <span class="n">max_cost</span><span class="p">:</span>
</span><span id="MultisetGenerator.sample-232"><a href="#MultisetGenerator.sample-232"><span class="linenos">232</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="MultisetGenerator.sample-233"><a href="#MultisetGenerator.sample-233"><span class="linenos">233</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="MultisetGenerator.sample-234"><a href="#MultisetGenerator.sample-234"><span class="linenos">234</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetGenerator.sample-235"><a href="#MultisetGenerator.sample-235"><span class="linenos">235</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="MultisetGenerator.sample-236"><a href="#MultisetGenerator.sample-236"><span class="linenos">236</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="MultisetGenerator.sample-237"><a href="#MultisetGenerator.sample-237"><span class="linenos">237</span></a>
</span><span id="MultisetGenerator.sample-238"><a href="#MultisetGenerator.sample-238"><span class="linenos">238</span></a>        <span class="n">cumulative_weights</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetGenerator.sample-239"><a href="#MultisetGenerator.sample-239"><span class="linenos">239</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">generated</span><span class="p">))</span>
</span><span id="MultisetGenerator.sample-240"><a href="#MultisetGenerator.sample-240"><span class="linenos">240</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="MultisetGenerator.sample-241"><a href="#MultisetGenerator.sample-241"><span class="linenos">241</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="MultisetGenerator.sample-242"><a href="#MultisetGenerator.sample-242"><span class="linenos">242</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
</span><span id="MultisetGenerator.sample-243"><a href="#MultisetGenerator.sample-243"><span class="linenos">243</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">cumulative_weights</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="MultisetGenerator.sample-244"><a href="#MultisetGenerator.sample-244"><span class="linenos">244</span></a>        <span class="n">popped_generator</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generated</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="MultisetGenerator.sample-245"><a href="#MultisetGenerator.sample-245"><span class="linenos">245</span></a>        <span class="n">head</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">outcome</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">count</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">)</span>
</span><span id="MultisetGenerator.sample-246"><a href="#MultisetGenerator.sample-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="MultisetGenerator.sample-247"><a href="#MultisetGenerator.sample-247"><span class="linenos">247</span></a>            <span class="n">tail</span> <span class="o">=</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</span><span id="MultisetGenerator.sample-248"><a href="#MultisetGenerator.sample-248"><span class="linenos">248</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">))</span>
</span><span id="MultisetGenerator.sample-249"><a href="#MultisetGenerator.sample-249"><span class="linenos">249</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetGenerator.sample-250"><a href="#MultisetGenerator.sample-250"><span class="linenos">250</span></a>            <span class="k">return</span> <span class="n">head</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: A single random sample from this generator.</p>

<p>This uses the standard <code>random</code> package and is not cryptographically
secure.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A sorted tuple of outcomes for each output of this generator.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#MultisetExpression">MultisetExpression</a></dt>
                                <dd id="MultisetGenerator.additive_union" class="function"><a href="#MultisetExpression.additive_union">additive_union</a></dd>
                <dd id="MultisetGenerator.difference" class="function"><a href="#MultisetExpression.difference">difference</a></dd>
                <dd id="MultisetGenerator.intersection" class="function"><a href="#MultisetExpression.intersection">intersection</a></dd>
                <dd id="MultisetGenerator.union" class="function"><a href="#MultisetExpression.union">union</a></dd>
                <dd id="MultisetGenerator.symmetric_difference" class="function"><a href="#MultisetExpression.symmetric_difference">symmetric_difference</a></dd>
                <dd id="MultisetGenerator.keep_outcomes" class="function"><a href="#MultisetExpression.keep_outcomes">keep_outcomes</a></dd>
                <dd id="MultisetGenerator.drop_outcomes" class="function"><a href="#MultisetExpression.drop_outcomes">drop_outcomes</a></dd>
                <dd id="MultisetGenerator.map_counts" class="function"><a href="#MultisetExpression.map_counts">map_counts</a></dd>
                <dd id="MultisetGenerator.multiply_counts" class="function"><a href="#MultisetExpression.multiply_counts">multiply_counts</a></dd>
                <dd id="MultisetGenerator.divide_counts" class="function"><a href="#MultisetExpression.divide_counts">divide_counts</a></dd>
                <dd id="MultisetGenerator.modulo_counts" class="function"><a href="#MultisetExpression.modulo_counts">modulo_counts</a></dd>
                <dd id="MultisetGenerator.keep_counts" class="function"><a href="#MultisetExpression.keep_counts">keep_counts</a></dd>
                <dd id="MultisetGenerator.unique" class="function"><a href="#MultisetExpression.unique">unique</a></dd>
                <dd id="MultisetGenerator.keep" class="function"><a href="#MultisetExpression.keep">keep</a></dd>
                <dd id="MultisetGenerator.lowest" class="function"><a href="#MultisetExpression.lowest">lowest</a></dd>
                <dd id="MultisetGenerator.highest" class="function"><a href="#MultisetExpression.highest">highest</a></dd>
                <dd id="MultisetGenerator.pair_le" class="function"><a href="#MultisetExpression.pair_le">pair_le</a></dd>
                <dd id="MultisetGenerator.evaluate" class="function"><a href="#MultisetExpression.evaluate">evaluate</a></dd>
                <dd id="MultisetGenerator.expand" class="function"><a href="#MultisetExpression.expand">expand</a></dd>
                <dd id="MultisetGenerator.sum" class="function"><a href="#MultisetExpression.sum">sum</a></dd>
                <dd id="MultisetGenerator.count" class="function"><a href="#MultisetExpression.count">count</a></dd>
                <dd id="MultisetGenerator.any" class="function"><a href="#MultisetExpression.any">any</a></dd>
                <dd id="MultisetGenerator.highest_outcome_and_count" class="function"><a href="#MultisetExpression.highest_outcome_and_count">highest_outcome_and_count</a></dd>
                <dd id="MultisetGenerator.all_counts" class="function"><a href="#MultisetExpression.all_counts">all_counts</a></dd>
                <dd id="MultisetGenerator.largest_count" class="function"><a href="#MultisetExpression.largest_count">largest_count</a></dd>
                <dd id="MultisetGenerator.largest_count_and_outcome" class="function"><a href="#MultisetExpression.largest_count_and_outcome">largest_count_and_outcome</a></dd>
                <dd id="MultisetGenerator.count_subset" class="function"><a href="#MultisetExpression.count_subset">count_subset</a></dd>
                <dd id="MultisetGenerator.largest_straight" class="function"><a href="#MultisetExpression.largest_straight">largest_straight</a></dd>
                <dd id="MultisetGenerator.largest_straight_and_outcome" class="function"><a href="#MultisetExpression.largest_straight_and_outcome">largest_straight_and_outcome</a></dd>
                <dd id="MultisetGenerator.all_straights" class="function"><a href="#MultisetExpression.all_straights">all_straights</a></dd>
                <dd id="MultisetGenerator.all_straights_reduce_counts" class="function"><a href="#MultisetExpression.all_straights_reduce_counts">all_straights_reduce_counts</a></dd>
                <dd id="MultisetGenerator.argsort" class="function"><a href="#MultisetExpression.argsort">argsort</a></dd>
                <dd id="MultisetGenerator.issubset" class="function"><a href="#MultisetExpression.issubset">issubset</a></dd>
                <dd id="MultisetGenerator.issuperset" class="function"><a href="#MultisetExpression.issuperset">issuperset</a></dd>
                <dd id="MultisetGenerator.isdisjoint" class="function"><a href="#MultisetExpression.isdisjoint">isdisjoint</a></dd>
                <dd id="MultisetGenerator.compair_lt" class="function"><a href="#MultisetExpression.compair_lt">compair_lt</a></dd>
                <dd id="MultisetGenerator.compair_le" class="function"><a href="#MultisetExpression.compair_le">compair_le</a></dd>
                <dd id="MultisetGenerator.compair_gt" class="function"><a href="#MultisetExpression.compair_gt">compair_gt</a></dd>
                <dd id="MultisetGenerator.compair_ge" class="function"><a href="#MultisetExpression.compair_ge">compair_ge</a></dd>
                <dd id="MultisetGenerator.compair_eq" class="function"><a href="#MultisetExpression.compair_eq">compair_eq</a></dd>
                <dd id="MultisetGenerator.compair_ne" class="function"><a href="#MultisetExpression.compair_ne">compair_ne</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Alignment">
                            <input id="Alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Alignment</span><wbr>(<span class="base"><a href="#MultisetGenerator">icepool.MultisetGenerator[~T, tuple[()]]</a></span>):

                <label class="view-source-button" for="Alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Alignment-17"><a href="#Alignment-17"><span class="linenos">17</span></a><span class="k">class</span> <span class="nc">Alignment</span><span class="p">(</span><span class="n">MultisetGenerator</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[()]]):</span>
</span><span id="Alignment-18"><a href="#Alignment-18"><span class="linenos">18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A generator that does not output any counts.</span>
</span><span id="Alignment-19"><a href="#Alignment-19"><span class="linenos">19</span></a>
</span><span id="Alignment-20"><a href="#Alignment-20"><span class="linenos">20</span></a><span class="sd">    This can be used to enforce that certain outcomes are seen without otherwise</span>
</span><span id="Alignment-21"><a href="#Alignment-21"><span class="linenos">21</span></a><span class="sd">    affecting a multiset evaluation.</span>
</span><span id="Alignment-22"><a href="#Alignment-22"><span class="linenos">22</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Alignment-23"><a href="#Alignment-23"><span class="linenos">23</span></a>
</span><span id="Alignment-24"><a href="#Alignment-24"><span class="linenos">24</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="Alignment-25"><a href="#Alignment-25"><span class="linenos">25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">outcomes</span><span class="p">))</span>
</span><span id="Alignment-26"><a href="#Alignment-26"><span class="linenos">26</span></a>
</span><span id="Alignment-27"><a href="#Alignment-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="Alignment-28"><a href="#Alignment-28"><span class="linenos">28</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span><span id="Alignment-29"><a href="#Alignment-29"><span class="linenos">29</span></a>
</span><span id="Alignment-30"><a href="#Alignment-30"><span class="linenos">30</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Alignment-31"><a href="#Alignment-31"><span class="linenos">31</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="Alignment-32"><a href="#Alignment-32"><span class="linenos">32</span></a>
</span><span id="Alignment-33"><a href="#Alignment-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Alignment-34"><a href="#Alignment-34"><span class="linenos">34</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="Alignment-35"><a href="#Alignment-35"><span class="linenos">35</span></a>
</span><span id="Alignment-36"><a href="#Alignment-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">_generate_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InitialAlignmentGenerator</span><span class="p">:</span>
</span><span id="Alignment-37"><a href="#Alignment-37"><span class="linenos">37</span></a>        <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span>
</span><span id="Alignment-38"><a href="#Alignment-38"><span class="linenos">38</span></a>
</span><span id="Alignment-39"><a href="#Alignment-39"><span class="linenos">39</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AlignmentGenerator</span><span class="p">:</span>
</span><span id="Alignment-40"><a href="#Alignment-40"><span class="linenos">40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`Alignment` only outputs 0 counts with weight 1.&quot;&quot;&quot;</span>
</span><span id="Alignment-41"><a href="#Alignment-41"><span class="linenos">41</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">min_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">():</span>
</span><span id="Alignment-42"><a href="#Alignment-42"><span class="linenos">42</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="Alignment-43"><a href="#Alignment-43"><span class="linenos">43</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Alignment-44"><a href="#Alignment-44"><span class="linenos">44</span></a>            <span class="k">yield</span> <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]),</span> <span class="p">(),</span> <span class="mi">1</span>
</span><span id="Alignment-45"><a href="#Alignment-45"><span class="linenos">45</span></a>
</span><span id="Alignment-46"><a href="#Alignment-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AlignmentGenerator</span><span class="p">:</span>
</span><span id="Alignment-47"><a href="#Alignment-47"><span class="linenos">47</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;`Alignment` only outputs 0 counts with weight 1.&quot;&quot;&quot;</span>
</span><span id="Alignment-48"><a href="#Alignment-48"><span class="linenos">48</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">max_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">():</span>
</span><span id="Alignment-49"><a href="#Alignment-49"><span class="linenos">49</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="Alignment-50"><a href="#Alignment-50"><span class="linenos">50</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Alignment-51"><a href="#Alignment-51"><span class="linenos">51</span></a>            <span class="k">yield</span> <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(),</span> <span class="mi">1</span>
</span><span id="Alignment-52"><a href="#Alignment-52"><span class="linenos">52</span></a>
</span><span id="Alignment-53"><a href="#Alignment-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Alignment-54"><a href="#Alignment-54"><span class="linenos">54</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="Alignment-55"><a href="#Alignment-55"><span class="linenos">55</span></a>        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">result</span>
</span><span id="Alignment-56"><a href="#Alignment-56"><span class="linenos">56</span></a>
</span><span id="Alignment-57"><a href="#Alignment-57"><span class="linenos">57</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Alignment-58"><a href="#Alignment-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span><span id="Alignment-59"><a href="#Alignment-59"><span class="linenos">59</span></a>
</span><span id="Alignment-60"><a href="#Alignment-60"><span class="linenos">60</span></a>    <span class="nd">@cached_property</span>
</span><span id="Alignment-61"><a href="#Alignment-61"><span class="linenos">61</span></a>    <span class="k">def</span> <span class="nf">_hash_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="Alignment-62"><a href="#Alignment-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="n">Alignment</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span></pre></div>


            <div class="docstring"><p>A generator that does not output any counts.</p>

<p>This can be used to enforce that certain outcomes are seen without otherwise
affecting a multiset evaluation.</p>
</div>


                            <div id="Alignment.__init__" class="classattr">
                                        <input id="Alignment.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Alignment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">outcomes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="Alignment.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Alignment.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Alignment.__init__-24"><a href="#Alignment.__init__-24"><span class="linenos">24</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="Alignment.__init__-25"><a href="#Alignment.__init__-25"><span class="linenos">25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">outcomes</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Alignment.outcomes" class="classattr">
                                        <input id="Alignment.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Alignment.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Alignment.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Alignment.outcomes-27"><a href="#Alignment.outcomes-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="Alignment.outcomes-28"><a href="#Alignment.outcomes-28"><span class="linenos">28</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span></pre></div>


            <div class="docstring"><p>The possible outcomes that could be generated, in ascending order.</p>
</div>


                            </div>
                            <div id="Alignment.output_arity" class="classattr">
                                        <input id="Alignment.output_arity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">output_arity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Alignment.output_arity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Alignment.output_arity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Alignment.output_arity-30"><a href="#Alignment.output_arity-30"><span class="linenos">30</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Alignment.output_arity-31"><a href="#Alignment.output_arity-31"><span class="linenos">31</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>The number of multisets/counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="Alignment.denominator" class="classattr">
                                        <input id="Alignment.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Alignment.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Alignment.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Alignment.denominator-57"><a href="#Alignment.denominator-57"><span class="linenos">57</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Alignment.denominator-58"><a href="#Alignment.denominator-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#MultisetGenerator">MultisetGenerator</a></dt>
                                <dd id="Alignment.equals" class="function"><a href="#MultisetGenerator.equals">equals</a></dd>
                <dd id="Alignment.order" class="function"><a href="#MultisetGenerator.order">order</a></dd>
                <dd id="Alignment.min_outcome" class="function"><a href="#MultisetGenerator.min_outcome">min_outcome</a></dd>
                <dd id="Alignment.max_outcome" class="function"><a href="#MultisetGenerator.max_outcome">max_outcome</a></dd>
                <dd id="Alignment.sample" class="function"><a href="#MultisetGenerator.sample">sample</a></dd>

            </div>
            <div><dt><a href="#MultisetExpression">MultisetExpression</a></dt>
                                <dd id="Alignment.additive_union" class="function"><a href="#MultisetExpression.additive_union">additive_union</a></dd>
                <dd id="Alignment.difference" class="function"><a href="#MultisetExpression.difference">difference</a></dd>
                <dd id="Alignment.intersection" class="function"><a href="#MultisetExpression.intersection">intersection</a></dd>
                <dd id="Alignment.union" class="function"><a href="#MultisetExpression.union">union</a></dd>
                <dd id="Alignment.symmetric_difference" class="function"><a href="#MultisetExpression.symmetric_difference">symmetric_difference</a></dd>
                <dd id="Alignment.keep_outcomes" class="function"><a href="#MultisetExpression.keep_outcomes">keep_outcomes</a></dd>
                <dd id="Alignment.drop_outcomes" class="function"><a href="#MultisetExpression.drop_outcomes">drop_outcomes</a></dd>
                <dd id="Alignment.map_counts" class="function"><a href="#MultisetExpression.map_counts">map_counts</a></dd>
                <dd id="Alignment.multiply_counts" class="function"><a href="#MultisetExpression.multiply_counts">multiply_counts</a></dd>
                <dd id="Alignment.divide_counts" class="function"><a href="#MultisetExpression.divide_counts">divide_counts</a></dd>
                <dd id="Alignment.modulo_counts" class="function"><a href="#MultisetExpression.modulo_counts">modulo_counts</a></dd>
                <dd id="Alignment.keep_counts" class="function"><a href="#MultisetExpression.keep_counts">keep_counts</a></dd>
                <dd id="Alignment.unique" class="function"><a href="#MultisetExpression.unique">unique</a></dd>
                <dd id="Alignment.keep" class="function"><a href="#MultisetExpression.keep">keep</a></dd>
                <dd id="Alignment.lowest" class="function"><a href="#MultisetExpression.lowest">lowest</a></dd>
                <dd id="Alignment.highest" class="function"><a href="#MultisetExpression.highest">highest</a></dd>
                <dd id="Alignment.pair_le" class="function"><a href="#MultisetExpression.pair_le">pair_le</a></dd>
                <dd id="Alignment.evaluate" class="function"><a href="#MultisetExpression.evaluate">evaluate</a></dd>
                <dd id="Alignment.expand" class="function"><a href="#MultisetExpression.expand">expand</a></dd>
                <dd id="Alignment.sum" class="function"><a href="#MultisetExpression.sum">sum</a></dd>
                <dd id="Alignment.count" class="function"><a href="#MultisetExpression.count">count</a></dd>
                <dd id="Alignment.any" class="function"><a href="#MultisetExpression.any">any</a></dd>
                <dd id="Alignment.highest_outcome_and_count" class="function"><a href="#MultisetExpression.highest_outcome_and_count">highest_outcome_and_count</a></dd>
                <dd id="Alignment.all_counts" class="function"><a href="#MultisetExpression.all_counts">all_counts</a></dd>
                <dd id="Alignment.largest_count" class="function"><a href="#MultisetExpression.largest_count">largest_count</a></dd>
                <dd id="Alignment.largest_count_and_outcome" class="function"><a href="#MultisetExpression.largest_count_and_outcome">largest_count_and_outcome</a></dd>
                <dd id="Alignment.count_subset" class="function"><a href="#MultisetExpression.count_subset">count_subset</a></dd>
                <dd id="Alignment.largest_straight" class="function"><a href="#MultisetExpression.largest_straight">largest_straight</a></dd>
                <dd id="Alignment.largest_straight_and_outcome" class="function"><a href="#MultisetExpression.largest_straight_and_outcome">largest_straight_and_outcome</a></dd>
                <dd id="Alignment.all_straights" class="function"><a href="#MultisetExpression.all_straights">all_straights</a></dd>
                <dd id="Alignment.all_straights_reduce_counts" class="function"><a href="#MultisetExpression.all_straights_reduce_counts">all_straights_reduce_counts</a></dd>
                <dd id="Alignment.argsort" class="function"><a href="#MultisetExpression.argsort">argsort</a></dd>
                <dd id="Alignment.issubset" class="function"><a href="#MultisetExpression.issubset">issubset</a></dd>
                <dd id="Alignment.issuperset" class="function"><a href="#MultisetExpression.issuperset">issuperset</a></dd>
                <dd id="Alignment.isdisjoint" class="function"><a href="#MultisetExpression.isdisjoint">isdisjoint</a></dd>
                <dd id="Alignment.compair_lt" class="function"><a href="#MultisetExpression.compair_lt">compair_lt</a></dd>
                <dd id="Alignment.compair_le" class="function"><a href="#MultisetExpression.compair_le">compair_le</a></dd>
                <dd id="Alignment.compair_gt" class="function"><a href="#MultisetExpression.compair_gt">compair_gt</a></dd>
                <dd id="Alignment.compair_ge" class="function"><a href="#MultisetExpression.compair_ge">compair_ge</a></dd>
                <dd id="Alignment.compair_eq" class="function"><a href="#MultisetExpression.compair_eq">compair_eq</a></dd>
                <dd id="Alignment.compair_ne" class="function"><a href="#MultisetExpression.compair_ne">compair_ne</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MultisetExpression">
                            <input id="MultisetExpression-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MultisetExpression</span><wbr>(<span class="base">abc.ABC</span>, <span class="base">typing.Generic[-T_contra]</span>):

                <label class="view-source-button" for="MultisetExpression-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression-38"><a href="#MultisetExpression-38"><span class="linenos">  38</span></a><span class="k">class</span> <span class="nc">MultisetExpression</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T_contra</span><span class="p">]):</span>
</span><span id="MultisetExpression-39"><a href="#MultisetExpression-39"><span class="linenos">  39</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class representing an expression that operates on multisets.</span>
</span><span id="MultisetExpression-40"><a href="#MultisetExpression-40"><span class="linenos">  40</span></a>
</span><span id="MultisetExpression-41"><a href="#MultisetExpression-41"><span class="linenos">  41</span></a><span class="sd">    Expression methods can be applied to `MultisetGenerator`s to do simple</span>
</span><span id="MultisetExpression-42"><a href="#MultisetExpression-42"><span class="linenos">  42</span></a><span class="sd">    evaluations. For joint evaluations, try `multiset_function`.</span>
</span><span id="MultisetExpression-43"><a href="#MultisetExpression-43"><span class="linenos">  43</span></a>
</span><span id="MultisetExpression-44"><a href="#MultisetExpression-44"><span class="linenos">  44</span></a><span class="sd">    Use the provided operations to build up more complicated</span>
</span><span id="MultisetExpression-45"><a href="#MultisetExpression-45"><span class="linenos">  45</span></a><span class="sd">    expressions, or to attach a final evaluator.</span>
</span><span id="MultisetExpression-46"><a href="#MultisetExpression-46"><span class="linenos">  46</span></a>
</span><span id="MultisetExpression-47"><a href="#MultisetExpression-47"><span class="linenos">  47</span></a><span class="sd">    Operations include:</span>
</span><span id="MultisetExpression-48"><a href="#MultisetExpression-48"><span class="linenos">  48</span></a>
</span><span id="MultisetExpression-49"><a href="#MultisetExpression-49"><span class="linenos">  49</span></a><span class="sd">    | Operation                   | Count / notes                               |</span>
</span><span id="MultisetExpression-50"><a href="#MultisetExpression-50"><span class="linenos">  50</span></a><span class="sd">    |:----------------------------|:--------------------------------------------|</span>
</span><span id="MultisetExpression-51"><a href="#MultisetExpression-51"><span class="linenos">  51</span></a><span class="sd">    | `additive_union`, `+`       | `l + r`                                     |</span>
</span><span id="MultisetExpression-52"><a href="#MultisetExpression-52"><span class="linenos">  52</span></a><span class="sd">    | `difference`, `-`           | `l - r`                                     |</span>
</span><span id="MultisetExpression-53"><a href="#MultisetExpression-53"><span class="linenos">  53</span></a><span class="sd">    | `intersection`, `&amp;`         | `min(l, r)`                                 |</span>
</span><span id="MultisetExpression-54"><a href="#MultisetExpression-54"><span class="linenos">  54</span></a><span class="sd">    | `union`, `\\|`               | `max(l, r)`                                 |</span>
</span><span id="MultisetExpression-55"><a href="#MultisetExpression-55"><span class="linenos">  55</span></a><span class="sd">    | `symmetric_difference`, `^` | `abs(l - r)`                                |</span>
</span><span id="MultisetExpression-56"><a href="#MultisetExpression-56"><span class="linenos">  56</span></a><span class="sd">    | `multiply_counts`, `*`      | `count * n`                                 |</span>
</span><span id="MultisetExpression-57"><a href="#MultisetExpression-57"><span class="linenos">  57</span></a><span class="sd">    | `divide_counts`, `//`       | `count // n`                                |</span>
</span><span id="MultisetExpression-58"><a href="#MultisetExpression-58"><span class="linenos">  58</span></a><span class="sd">    | `modulo_counts`, `%`        | `count % n`                                 |</span>
</span><span id="MultisetExpression-59"><a href="#MultisetExpression-59"><span class="linenos">  59</span></a><span class="sd">    | `keep_counts`               | `count if count &gt;= n else 0` etc.           |</span>
</span><span id="MultisetExpression-60"><a href="#MultisetExpression-60"><span class="linenos">  60</span></a><span class="sd">    | unary `+`                   | same as `keep_counts_ge(0)`                 |</span>
</span><span id="MultisetExpression-61"><a href="#MultisetExpression-61"><span class="linenos">  61</span></a><span class="sd">    | unary `-`                   | reverses the sign of all counts             |</span>
</span><span id="MultisetExpression-62"><a href="#MultisetExpression-62"><span class="linenos">  62</span></a><span class="sd">    | `unique`                    | `min(count, n)`                             |</span>
</span><span id="MultisetExpression-63"><a href="#MultisetExpression-63"><span class="linenos">  63</span></a><span class="sd">    | `keep_outcomes`             | `count if outcome in t else 0`              |</span>
</span><span id="MultisetExpression-64"><a href="#MultisetExpression-64"><span class="linenos">  64</span></a><span class="sd">    | `drop_outcomes`             | `count if outcome not in t else 0`          |</span>
</span><span id="MultisetExpression-65"><a href="#MultisetExpression-65"><span class="linenos">  65</span></a><span class="sd">    | `map_counts`                | `f(outcome, *counts)`                       |</span>
</span><span id="MultisetExpression-66"><a href="#MultisetExpression-66"><span class="linenos">  66</span></a><span class="sd">    | `keep`, `[]`                | less capable than `KeepGenerator` version   |</span>
</span><span id="MultisetExpression-67"><a href="#MultisetExpression-67"><span class="linenos">  67</span></a><span class="sd">    | `highest`                   | less capable than `KeepGenerator` version   |</span>
</span><span id="MultisetExpression-68"><a href="#MultisetExpression-68"><span class="linenos">  68</span></a><span class="sd">    | `lowest`                    | less capable than `KeepGenerator` version   |</span>
</span><span id="MultisetExpression-69"><a href="#MultisetExpression-69"><span class="linenos">  69</span></a>
</span><span id="MultisetExpression-70"><a href="#MultisetExpression-70"><span class="linenos">  70</span></a><span class="sd">    | Evaluator                      | Summary                                                                    |</span>
</span><span id="MultisetExpression-71"><a href="#MultisetExpression-71"><span class="linenos">  71</span></a><span class="sd">    |:-------------------------------|:---------------------------------------------------------------------------|</span>
</span><span id="MultisetExpression-72"><a href="#MultisetExpression-72"><span class="linenos">  72</span></a><span class="sd">    | `issubset`, `&lt;=`               | Whether the left side&#39;s counts are all &lt;= their counterparts on the right  |</span>
</span><span id="MultisetExpression-73"><a href="#MultisetExpression-73"><span class="linenos">  73</span></a><span class="sd">    | `issuperset`, `&gt;=`             | Whether the left side&#39;s counts are all &gt;= their counterparts on the right  |</span>
</span><span id="MultisetExpression-74"><a href="#MultisetExpression-74"><span class="linenos">  74</span></a><span class="sd">    | `isdisjoint`                   | Whether the left side has no positive counts in common with the right side |</span>
</span><span id="MultisetExpression-75"><a href="#MultisetExpression-75"><span class="linenos">  75</span></a><span class="sd">    | `&lt;`                            | As `&lt;=`, but `False` if the two multisets are equal                        |</span>
</span><span id="MultisetExpression-76"><a href="#MultisetExpression-76"><span class="linenos">  76</span></a><span class="sd">    | `&gt;`                            | As `&gt;=`, but `False` if the two multisets are equal                        |</span>
</span><span id="MultisetExpression-77"><a href="#MultisetExpression-77"><span class="linenos">  77</span></a><span class="sd">    | `==`                           | Whether the left side has all the same counts as the right side            |</span>
</span><span id="MultisetExpression-78"><a href="#MultisetExpression-78"><span class="linenos">  78</span></a><span class="sd">    | `!=`                           | Whether the left side has any different counts to the right side           |</span>
</span><span id="MultisetExpression-79"><a href="#MultisetExpression-79"><span class="linenos">  79</span></a><span class="sd">    | `expand`                       | All elements in ascending order                                            |</span>
</span><span id="MultisetExpression-80"><a href="#MultisetExpression-80"><span class="linenos">  80</span></a><span class="sd">    | `sum`                          | Sum of all elements                                                        |</span>
</span><span id="MultisetExpression-81"><a href="#MultisetExpression-81"><span class="linenos">  81</span></a><span class="sd">    | `count`                        | The number of elements                                                     |</span>
</span><span id="MultisetExpression-82"><a href="#MultisetExpression-82"><span class="linenos">  82</span></a><span class="sd">    | `any`                          | Whether there is at least 1 element                                        |</span>
</span><span id="MultisetExpression-83"><a href="#MultisetExpression-83"><span class="linenos">  83</span></a><span class="sd">    | `highest_outcome_and_count`    | The highest outcome and how many of that outcome                           |</span>
</span><span id="MultisetExpression-84"><a href="#MultisetExpression-84"><span class="linenos">  84</span></a><span class="sd">    | `all_counts`                   | All counts in descending order                                             |</span>
</span><span id="MultisetExpression-85"><a href="#MultisetExpression-85"><span class="linenos">  85</span></a><span class="sd">    | `largest_count`                | The single largest count, aka x-of-a-kind                                  |</span>
</span><span id="MultisetExpression-86"><a href="#MultisetExpression-86"><span class="linenos">  86</span></a><span class="sd">    | `largest_count_and_outcome`    | Same but also with the corresponding outcome                               |</span>
</span><span id="MultisetExpression-87"><a href="#MultisetExpression-87"><span class="linenos">  87</span></a><span class="sd">    | `count_subset`, `//`           | The number of times the right side is contained in the left side           |</span>
</span><span id="MultisetExpression-88"><a href="#MultisetExpression-88"><span class="linenos">  88</span></a><span class="sd">    | `largest_straight`             | Length of longest consecutive sequence                                     |</span>
</span><span id="MultisetExpression-89"><a href="#MultisetExpression-89"><span class="linenos">  89</span></a><span class="sd">    | `largest_straight_and_outcome` | Same but also with the corresponding outcome                               |</span>
</span><span id="MultisetExpression-90"><a href="#MultisetExpression-90"><span class="linenos">  90</span></a><span class="sd">    | `all_straights`                | Lengths of all consecutive sequences in descending order                   |</span>
</span><span id="MultisetExpression-91"><a href="#MultisetExpression-91"><span class="linenos">  91</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-92"><a href="#MultisetExpression-92"><span class="linenos">  92</span></a>
</span><span id="MultisetExpression-93"><a href="#MultisetExpression-93"><span class="linenos">  93</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetExpression-94"><a href="#MultisetExpression-94"><span class="linenos">  94</span></a>    <span class="k">def</span> <span class="nf">_next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">:</span>
</span><span id="MultisetExpression-95"><a href="#MultisetExpression-95"><span class="linenos">  95</span></a>                    <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="MultisetExpression-96"><a href="#MultisetExpression-96"><span class="linenos">  96</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the state for this expression and does any necessary count modification.</span>
</span><span id="MultisetExpression-97"><a href="#MultisetExpression-97"><span class="linenos">  97</span></a>
</span><span id="MultisetExpression-98"><a href="#MultisetExpression-98"><span class="linenos">  98</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-99"><a href="#MultisetExpression-99"><span class="linenos">  99</span></a><span class="sd">            state: The overall state. This will contain all information needed</span>
</span><span id="MultisetExpression-100"><a href="#MultisetExpression-100"><span class="linenos"> 100</span></a><span class="sd">                by this expression and any previous expressions.</span>
</span><span id="MultisetExpression-101"><a href="#MultisetExpression-101"><span class="linenos"> 101</span></a><span class="sd">            outcome: The current outcome.</span>
</span><span id="MultisetExpression-102"><a href="#MultisetExpression-102"><span class="linenos"> 102</span></a><span class="sd">            counts: The raw counts: first, the counts resulting from bound</span>
</span><span id="MultisetExpression-103"><a href="#MultisetExpression-103"><span class="linenos"> 103</span></a><span class="sd">                generators, then the counts from free variables.</span>
</span><span id="MultisetExpression-104"><a href="#MultisetExpression-104"><span class="linenos"> 104</span></a><span class="sd">                This must be passed to any previous expressions.</span>
</span><span id="MultisetExpression-105"><a href="#MultisetExpression-105"><span class="linenos"> 105</span></a>
</span><span id="MultisetExpression-106"><a href="#MultisetExpression-106"><span class="linenos"> 106</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetExpression-107"><a href="#MultisetExpression-107"><span class="linenos"> 107</span></a><span class="sd">            * state: The updated state, which will be seen again by this</span>
</span><span id="MultisetExpression-108"><a href="#MultisetExpression-108"><span class="linenos"> 108</span></a><span class="sd">            `next_state` later.</span>
</span><span id="MultisetExpression-109"><a href="#MultisetExpression-109"><span class="linenos"> 109</span></a><span class="sd">            * count: The resulting count, which will be sent forward.</span>
</span><span id="MultisetExpression-110"><a href="#MultisetExpression-110"><span class="linenos"> 110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-111"><a href="#MultisetExpression-111"><span class="linenos"> 111</span></a>
</span><span id="MultisetExpression-112"><a href="#MultisetExpression-112"><span class="linenos"> 112</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetExpression-113"><a href="#MultisetExpression-113"><span class="linenos"> 113</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="MultisetExpression-114"><a href="#MultisetExpression-114"><span class="linenos"> 114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Any ordering that is required by this expression.</span>
</span><span id="MultisetExpression-115"><a href="#MultisetExpression-115"><span class="linenos"> 115</span></a>
</span><span id="MultisetExpression-116"><a href="#MultisetExpression-116"><span class="linenos"> 116</span></a><span class="sd">        This should check any previous expressions for their order, and</span>
</span><span id="MultisetExpression-117"><a href="#MultisetExpression-117"><span class="linenos"> 117</span></a><span class="sd">        raise a ValueError for any incompatibilities.</span>
</span><span id="MultisetExpression-118"><a href="#MultisetExpression-118"><span class="linenos"> 118</span></a>
</span><span id="MultisetExpression-119"><a href="#MultisetExpression-119"><span class="linenos"> 119</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetExpression-120"><a href="#MultisetExpression-120"><span class="linenos"> 120</span></a><span class="sd">            The required order.</span>
</span><span id="MultisetExpression-121"><a href="#MultisetExpression-121"><span class="linenos"> 121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-122"><a href="#MultisetExpression-122"><span class="linenos"> 122</span></a>
</span><span id="MultisetExpression-123"><a href="#MultisetExpression-123"><span class="linenos"> 123</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetExpression-124"><a href="#MultisetExpression-124"><span class="linenos"> 124</span></a>    <span class="k">def</span> <span class="nf">_free_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultisetExpression-125"><a href="#MultisetExpression-125"><span class="linenos"> 125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The minimum number of multisets/counts that must be provided to this expression.</span>
</span><span id="MultisetExpression-126"><a href="#MultisetExpression-126"><span class="linenos"> 126</span></a>
</span><span id="MultisetExpression-127"><a href="#MultisetExpression-127"><span class="linenos"> 127</span></a><span class="sd">        Any excess multisets/counts that are provided will be ignored.</span>
</span><span id="MultisetExpression-128"><a href="#MultisetExpression-128"><span class="linenos"> 128</span></a>
</span><span id="MultisetExpression-129"><a href="#MultisetExpression-129"><span class="linenos"> 129</span></a><span class="sd">        This does not include bound generators.</span>
</span><span id="MultisetExpression-130"><a href="#MultisetExpression-130"><span class="linenos"> 130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-131"><a href="#MultisetExpression-131"><span class="linenos"> 131</span></a>
</span><span id="MultisetExpression-132"><a href="#MultisetExpression-132"><span class="linenos"> 132</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetExpression-133"><a href="#MultisetExpression-133"><span class="linenos"> 133</span></a>    <span class="k">def</span> <span class="nf">_bound_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator, ...]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-134"><a href="#MultisetExpression-134"><span class="linenos"> 134</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a sequence of bound generators.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-135"><a href="#MultisetExpression-135"><span class="linenos"> 135</span></a>
</span><span id="MultisetExpression-136"><a href="#MultisetExpression-136"><span class="linenos"> 136</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetExpression-137"><a href="#MultisetExpression-137"><span class="linenos"> 137</span></a>    <span class="k">def</span> <span class="nf">_unbind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prefix_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MultisetExpression-138"><a href="#MultisetExpression-138"><span class="linenos"> 138</span></a>                <span class="n">free_start</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[MultisetExpression, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-139"><a href="#MultisetExpression-139"><span class="linenos"> 139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Replaces bound generators within this expression with free variables.</span>
</span><span id="MultisetExpression-140"><a href="#MultisetExpression-140"><span class="linenos"> 140</span></a>
</span><span id="MultisetExpression-141"><a href="#MultisetExpression-141"><span class="linenos"> 141</span></a><span class="sd">        Bound generators are replaced with free variables with index equal to</span>
</span><span id="MultisetExpression-142"><a href="#MultisetExpression-142"><span class="linenos"> 142</span></a><span class="sd">        their position in _bound_generators().</span>
</span><span id="MultisetExpression-143"><a href="#MultisetExpression-143"><span class="linenos"> 143</span></a>
</span><span id="MultisetExpression-144"><a href="#MultisetExpression-144"><span class="linenos"> 144</span></a><span class="sd">        Variables that are already free have their indexes shifted by the</span>
</span><span id="MultisetExpression-145"><a href="#MultisetExpression-145"><span class="linenos"> 145</span></a><span class="sd">        number of bound genrators.</span>
</span><span id="MultisetExpression-146"><a href="#MultisetExpression-146"><span class="linenos"> 146</span></a>
</span><span id="MultisetExpression-147"><a href="#MultisetExpression-147"><span class="linenos"> 147</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-148"><a href="#MultisetExpression-148"><span class="linenos"> 148</span></a><span class="sd">            prefix_start: The index of the next bound generator.</span>
</span><span id="MultisetExpression-149"><a href="#MultisetExpression-149"><span class="linenos"> 149</span></a><span class="sd">            free_start: The total number of bound generators.</span>
</span><span id="MultisetExpression-150"><a href="#MultisetExpression-150"><span class="linenos"> 150</span></a>
</span><span id="MultisetExpression-151"><a href="#MultisetExpression-151"><span class="linenos"> 151</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetExpression-152"><a href="#MultisetExpression-152"><span class="linenos"> 152</span></a><span class="sd">            The transformed expression and the new prefix_start.</span>
</span><span id="MultisetExpression-153"><a href="#MultisetExpression-153"><span class="linenos"> 153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-154"><a href="#MultisetExpression-154"><span class="linenos"> 154</span></a>
</span><span id="MultisetExpression-155"><a href="#MultisetExpression-155"><span class="linenos"> 155</span></a>    <span class="nd">@staticmethod</span>
</span><span id="MultisetExpression-156"><a href="#MultisetExpression-156"><span class="linenos"> 156</span></a>    <span class="k">def</span> <span class="nf">_validate_output_arity</span><span class="p">(</span><span class="n">inner</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultisetExpression-157"><a href="#MultisetExpression-157"><span class="linenos"> 157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validates that if the given expression is a generator, its output arity is 1.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-158"><a href="#MultisetExpression-158"><span class="linenos"> 158</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inner</span><span class="p">,</span>
</span><span id="MultisetExpression-159"><a href="#MultisetExpression-159"><span class="linenos"> 159</span></a>                      <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">)</span> <span class="ow">and</span> <span class="n">inner</span><span class="o">.</span><span class="n">output_arity</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="MultisetExpression-160"><a href="#MultisetExpression-160"><span class="linenos"> 160</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MultisetExpression-161"><a href="#MultisetExpression-161"><span class="linenos"> 161</span></a>                <span class="s1">&#39;Only generators with output arity of 1 may be bound to expressions.</span><span class="se">\n</span><span class="s1">Use a multiset_function to select individual outputs.&#39;</span>
</span><span id="MultisetExpression-162"><a href="#MultisetExpression-162"><span class="linenos"> 162</span></a>            <span class="p">)</span>
</span><span id="MultisetExpression-163"><a href="#MultisetExpression-163"><span class="linenos"> 163</span></a>
</span><span id="MultisetExpression-164"><a href="#MultisetExpression-164"><span class="linenos"> 164</span></a>    <span class="nd">@cached_property</span>
</span><span id="MultisetExpression-165"><a href="#MultisetExpression-165"><span class="linenos"> 165</span></a>    <span class="k">def</span> <span class="nf">_items_for_cartesian_product</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="MultisetExpression-166"><a href="#MultisetExpression-166"><span class="linenos"> 166</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_free_arity</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MultisetExpression-167"><a href="#MultisetExpression-167"><span class="linenos"> 167</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Expression must be fully bound.&#39;</span><span class="p">)</span>
</span><span id="MultisetExpression-168"><a href="#MultisetExpression-168"><span class="linenos"> 168</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="MultisetExpression-169"><a href="#MultisetExpression-169"><span class="linenos"> 169</span></a>
</span><span id="MultisetExpression-170"><a href="#MultisetExpression-170"><span class="linenos"> 170</span></a>    <span class="c1"># Binary operators.</span>
</span><span id="MultisetExpression-171"><a href="#MultisetExpression-171"><span class="linenos"> 171</span></a>
</span><span id="MultisetExpression-172"><a href="#MultisetExpression-172"><span class="linenos"> 172</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span>
</span><span id="MultisetExpression-173"><a href="#MultisetExpression-173"><span class="linenos"> 173</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-174"><a href="#MultisetExpression-174"><span class="linenos"> 174</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-175"><a href="#MultisetExpression-175"><span class="linenos"> 175</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-176"><a href="#MultisetExpression-176"><span class="linenos"> 176</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-177"><a href="#MultisetExpression-177"><span class="linenos"> 177</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">additive_union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-178"><a href="#MultisetExpression-178"><span class="linenos"> 178</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-179"><a href="#MultisetExpression-179"><span class="linenos"> 179</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-180"><a href="#MultisetExpression-180"><span class="linenos"> 180</span></a>
</span><span id="MultisetExpression-181"><a href="#MultisetExpression-181"><span class="linenos"> 181</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span>
</span><span id="MultisetExpression-182"><a href="#MultisetExpression-182"><span class="linenos"> 182</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-183"><a href="#MultisetExpression-183"><span class="linenos"> 183</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-184"><a href="#MultisetExpression-184"><span class="linenos"> 184</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-185"><a href="#MultisetExpression-185"><span class="linenos"> 185</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-186"><a href="#MultisetExpression-186"><span class="linenos"> 186</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">additive_union</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetExpression-187"><a href="#MultisetExpression-187"><span class="linenos"> 187</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-188"><a href="#MultisetExpression-188"><span class="linenos"> 188</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-189"><a href="#MultisetExpression-189"><span class="linenos"> 189</span></a>
</span><span id="MultisetExpression-190"><a href="#MultisetExpression-190"><span class="linenos"> 190</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span>
</span><span id="MultisetExpression-191"><a href="#MultisetExpression-191"><span class="linenos"> 191</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression-192"><a href="#MultisetExpression-192"><span class="linenos"> 192</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-193"><a href="#MultisetExpression-193"><span class="linenos"> 193</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-194"><a href="#MultisetExpression-194"><span class="linenos"> 194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The combined elements from all of the multisets.</span>
</span><span id="MultisetExpression-195"><a href="#MultisetExpression-195"><span class="linenos"> 195</span></a>
</span><span id="MultisetExpression-196"><a href="#MultisetExpression-196"><span class="linenos"> 196</span></a><span class="sd">        Same as `a + b + c + ...`.</span>
</span><span id="MultisetExpression-197"><a href="#MultisetExpression-197"><span class="linenos"> 197</span></a>
</span><span id="MultisetExpression-198"><a href="#MultisetExpression-198"><span class="linenos"> 198</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression-199"><a href="#MultisetExpression-199"><span class="linenos"> 199</span></a>
</span><span id="MultisetExpression-200"><a href="#MultisetExpression-200"><span class="linenos"> 200</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-201"><a href="#MultisetExpression-201"><span class="linenos"> 201</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-202"><a href="#MultisetExpression-202"><span class="linenos"> 202</span></a><span class="sd">        [1, 2, 2, 3] + [1, 2, 4] -&gt; [1, 1, 2, 2, 2, 3, 4]</span>
</span><span id="MultisetExpression-203"><a href="#MultisetExpression-203"><span class="linenos"> 203</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-204"><a href="#MultisetExpression-204"><span class="linenos"> 204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-205"><a href="#MultisetExpression-205"><span class="linenos"> 205</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression-206"><a href="#MultisetExpression-206"><span class="linenos"> 206</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression-207"><a href="#MultisetExpression-207"><span class="linenos"> 207</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">AdditiveUnionExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetExpression-208"><a href="#MultisetExpression-208"><span class="linenos"> 208</span></a>
</span><span id="MultisetExpression-209"><a href="#MultisetExpression-209"><span class="linenos"> 209</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span>
</span><span id="MultisetExpression-210"><a href="#MultisetExpression-210"><span class="linenos"> 210</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-211"><a href="#MultisetExpression-211"><span class="linenos"> 211</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-212"><a href="#MultisetExpression-212"><span class="linenos"> 212</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-213"><a href="#MultisetExpression-213"><span class="linenos"> 213</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-214"><a href="#MultisetExpression-214"><span class="linenos"> 214</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-215"><a href="#MultisetExpression-215"><span class="linenos"> 215</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-216"><a href="#MultisetExpression-216"><span class="linenos"> 216</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-217"><a href="#MultisetExpression-217"><span class="linenos"> 217</span></a>
</span><span id="MultisetExpression-218"><a href="#MultisetExpression-218"><span class="linenos"> 218</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span>
</span><span id="MultisetExpression-219"><a href="#MultisetExpression-219"><span class="linenos"> 219</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-220"><a href="#MultisetExpression-220"><span class="linenos"> 220</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-221"><a href="#MultisetExpression-221"><span class="linenos"> 221</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-222"><a href="#MultisetExpression-222"><span class="linenos"> 222</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-223"><a href="#MultisetExpression-223"><span class="linenos"> 223</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetExpression-224"><a href="#MultisetExpression-224"><span class="linenos"> 224</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-225"><a href="#MultisetExpression-225"><span class="linenos"> 225</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-226"><a href="#MultisetExpression-226"><span class="linenos"> 226</span></a>
</span><span id="MultisetExpression-227"><a href="#MultisetExpression-227"><span class="linenos"> 227</span></a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span>
</span><span id="MultisetExpression-228"><a href="#MultisetExpression-228"><span class="linenos"> 228</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression-229"><a href="#MultisetExpression-229"><span class="linenos"> 229</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-230"><a href="#MultisetExpression-230"><span class="linenos"> 230</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-231"><a href="#MultisetExpression-231"><span class="linenos"> 231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The elements from the left multiset that are not in any of the others.</span>
</span><span id="MultisetExpression-232"><a href="#MultisetExpression-232"><span class="linenos"> 232</span></a>
</span><span id="MultisetExpression-233"><a href="#MultisetExpression-233"><span class="linenos"> 233</span></a><span class="sd">        Same as `a - b - c - ...`.</span>
</span><span id="MultisetExpression-234"><a href="#MultisetExpression-234"><span class="linenos"> 234</span></a>
</span><span id="MultisetExpression-235"><a href="#MultisetExpression-235"><span class="linenos"> 235</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression-236"><a href="#MultisetExpression-236"><span class="linenos"> 236</span></a>
</span><span id="MultisetExpression-237"><a href="#MultisetExpression-237"><span class="linenos"> 237</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-238"><a href="#MultisetExpression-238"><span class="linenos"> 238</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-239"><a href="#MultisetExpression-239"><span class="linenos"> 239</span></a><span class="sd">        [1, 2, 2, 3] - [1, 2, 4] -&gt; [2, 3]</span>
</span><span id="MultisetExpression-240"><a href="#MultisetExpression-240"><span class="linenos"> 240</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-241"><a href="#MultisetExpression-241"><span class="linenos"> 241</span></a>
</span><span id="MultisetExpression-242"><a href="#MultisetExpression-242"><span class="linenos"> 242</span></a><span class="sd">        If no arguments are given, the result will be an empty multiset, i.e.</span>
</span><span id="MultisetExpression-243"><a href="#MultisetExpression-243"><span class="linenos"> 243</span></a><span class="sd">        all zero counts.</span>
</span><span id="MultisetExpression-244"><a href="#MultisetExpression-244"><span class="linenos"> 244</span></a>
</span><span id="MultisetExpression-245"><a href="#MultisetExpression-245"><span class="linenos"> 245</span></a><span class="sd">        Note that, as a multiset operation, this will only cancel elements 1:1.</span>
</span><span id="MultisetExpression-246"><a href="#MultisetExpression-246"><span class="linenos"> 246</span></a><span class="sd">        If you want to drop all elements in a set of outcomes regardless of</span>
</span><span id="MultisetExpression-247"><a href="#MultisetExpression-247"><span class="linenos"> 247</span></a><span class="sd">        count, either use `drop_outcomes()` instead, or use a large number of</span>
</span><span id="MultisetExpression-248"><a href="#MultisetExpression-248"><span class="linenos"> 248</span></a><span class="sd">        counts on the right side.</span>
</span><span id="MultisetExpression-249"><a href="#MultisetExpression-249"><span class="linenos"> 249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-250"><a href="#MultisetExpression-250"><span class="linenos"> 250</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression-251"><a href="#MultisetExpression-251"><span class="linenos"> 251</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression-252"><a href="#MultisetExpression-252"><span class="linenos"> 252</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">DifferenceExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetExpression-253"><a href="#MultisetExpression-253"><span class="linenos"> 253</span></a>
</span><span id="MultisetExpression-254"><a href="#MultisetExpression-254"><span class="linenos"> 254</span></a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span>
</span><span id="MultisetExpression-255"><a href="#MultisetExpression-255"><span class="linenos"> 255</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-256"><a href="#MultisetExpression-256"><span class="linenos"> 256</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-257"><a href="#MultisetExpression-257"><span class="linenos"> 257</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-258"><a href="#MultisetExpression-258"><span class="linenos"> 258</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-259"><a href="#MultisetExpression-259"><span class="linenos"> 259</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-260"><a href="#MultisetExpression-260"><span class="linenos"> 260</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-261"><a href="#MultisetExpression-261"><span class="linenos"> 261</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-262"><a href="#MultisetExpression-262"><span class="linenos"> 262</span></a>
</span><span id="MultisetExpression-263"><a href="#MultisetExpression-263"><span class="linenos"> 263</span></a>    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span>
</span><span id="MultisetExpression-264"><a href="#MultisetExpression-264"><span class="linenos"> 264</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-265"><a href="#MultisetExpression-265"><span class="linenos"> 265</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-266"><a href="#MultisetExpression-266"><span class="linenos"> 266</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-267"><a href="#MultisetExpression-267"><span class="linenos"> 267</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-268"><a href="#MultisetExpression-268"><span class="linenos"> 268</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetExpression-269"><a href="#MultisetExpression-269"><span class="linenos"> 269</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-270"><a href="#MultisetExpression-270"><span class="linenos"> 270</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-271"><a href="#MultisetExpression-271"><span class="linenos"> 271</span></a>
</span><span id="MultisetExpression-272"><a href="#MultisetExpression-272"><span class="linenos"> 272</span></a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span>
</span><span id="MultisetExpression-273"><a href="#MultisetExpression-273"><span class="linenos"> 273</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression-274"><a href="#MultisetExpression-274"><span class="linenos"> 274</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-275"><a href="#MultisetExpression-275"><span class="linenos"> 275</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-276"><a href="#MultisetExpression-276"><span class="linenos"> 276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The elements that all the multisets have in common.</span>
</span><span id="MultisetExpression-277"><a href="#MultisetExpression-277"><span class="linenos"> 277</span></a>
</span><span id="MultisetExpression-278"><a href="#MultisetExpression-278"><span class="linenos"> 278</span></a><span class="sd">        Same as `a &amp; b &amp; c &amp; ...`.</span>
</span><span id="MultisetExpression-279"><a href="#MultisetExpression-279"><span class="linenos"> 279</span></a>
</span><span id="MultisetExpression-280"><a href="#MultisetExpression-280"><span class="linenos"> 280</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression-281"><a href="#MultisetExpression-281"><span class="linenos"> 281</span></a>
</span><span id="MultisetExpression-282"><a href="#MultisetExpression-282"><span class="linenos"> 282</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-283"><a href="#MultisetExpression-283"><span class="linenos"> 283</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-284"><a href="#MultisetExpression-284"><span class="linenos"> 284</span></a><span class="sd">        [1, 2, 2, 3] &amp; [1, 2, 4] -&gt; [1, 2]</span>
</span><span id="MultisetExpression-285"><a href="#MultisetExpression-285"><span class="linenos"> 285</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-286"><a href="#MultisetExpression-286"><span class="linenos"> 286</span></a>
</span><span id="MultisetExpression-287"><a href="#MultisetExpression-287"><span class="linenos"> 287</span></a><span class="sd">        Note that, as a multiset operation, this will only intersect elements</span>
</span><span id="MultisetExpression-288"><a href="#MultisetExpression-288"><span class="linenos"> 288</span></a><span class="sd">        1:1.</span>
</span><span id="MultisetExpression-289"><a href="#MultisetExpression-289"><span class="linenos"> 289</span></a><span class="sd">        If you want to keep all elements in a set of outcomes regardless of</span>
</span><span id="MultisetExpression-290"><a href="#MultisetExpression-290"><span class="linenos"> 290</span></a><span class="sd">        count, either use `keep_outcomes()` instead, or use a large number of</span>
</span><span id="MultisetExpression-291"><a href="#MultisetExpression-291"><span class="linenos"> 291</span></a><span class="sd">        counts on the right side.</span>
</span><span id="MultisetExpression-292"><a href="#MultisetExpression-292"><span class="linenos"> 292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-293"><a href="#MultisetExpression-293"><span class="linenos"> 293</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression-294"><a href="#MultisetExpression-294"><span class="linenos"> 294</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression-295"><a href="#MultisetExpression-295"><span class="linenos"> 295</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">IntersectionExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetExpression-296"><a href="#MultisetExpression-296"><span class="linenos"> 296</span></a>
</span><span id="MultisetExpression-297"><a href="#MultisetExpression-297"><span class="linenos"> 297</span></a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span>
</span><span id="MultisetExpression-298"><a href="#MultisetExpression-298"><span class="linenos"> 298</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-299"><a href="#MultisetExpression-299"><span class="linenos"> 299</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-300"><a href="#MultisetExpression-300"><span class="linenos"> 300</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-301"><a href="#MultisetExpression-301"><span class="linenos"> 301</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-302"><a href="#MultisetExpression-302"><span class="linenos"> 302</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-303"><a href="#MultisetExpression-303"><span class="linenos"> 303</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-304"><a href="#MultisetExpression-304"><span class="linenos"> 304</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-305"><a href="#MultisetExpression-305"><span class="linenos"> 305</span></a>
</span><span id="MultisetExpression-306"><a href="#MultisetExpression-306"><span class="linenos"> 306</span></a>    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span>
</span><span id="MultisetExpression-307"><a href="#MultisetExpression-307"><span class="linenos"> 307</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-308"><a href="#MultisetExpression-308"><span class="linenos"> 308</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-309"><a href="#MultisetExpression-309"><span class="linenos"> 309</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-310"><a href="#MultisetExpression-310"><span class="linenos"> 310</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-311"><a href="#MultisetExpression-311"><span class="linenos"> 311</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetExpression-312"><a href="#MultisetExpression-312"><span class="linenos"> 312</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-313"><a href="#MultisetExpression-313"><span class="linenos"> 313</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-314"><a href="#MultisetExpression-314"><span class="linenos"> 314</span></a>
</span><span id="MultisetExpression-315"><a href="#MultisetExpression-315"><span class="linenos"> 315</span></a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span>
</span><span id="MultisetExpression-316"><a href="#MultisetExpression-316"><span class="linenos"> 316</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression-317"><a href="#MultisetExpression-317"><span class="linenos"> 317</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-318"><a href="#MultisetExpression-318"><span class="linenos"> 318</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-319"><a href="#MultisetExpression-319"><span class="linenos"> 319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The most of each outcome that appear in any of the multisets.</span>
</span><span id="MultisetExpression-320"><a href="#MultisetExpression-320"><span class="linenos"> 320</span></a>
</span><span id="MultisetExpression-321"><a href="#MultisetExpression-321"><span class="linenos"> 321</span></a><span class="sd">        Same as `a | b | c | ...`.</span>
</span><span id="MultisetExpression-322"><a href="#MultisetExpression-322"><span class="linenos"> 322</span></a>
</span><span id="MultisetExpression-323"><a href="#MultisetExpression-323"><span class="linenos"> 323</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression-324"><a href="#MultisetExpression-324"><span class="linenos"> 324</span></a>
</span><span id="MultisetExpression-325"><a href="#MultisetExpression-325"><span class="linenos"> 325</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-326"><a href="#MultisetExpression-326"><span class="linenos"> 326</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-327"><a href="#MultisetExpression-327"><span class="linenos"> 327</span></a><span class="sd">        [1, 2, 2, 3] | [1, 2, 4] -&gt; [1, 2, 2, 3, 4]</span>
</span><span id="MultisetExpression-328"><a href="#MultisetExpression-328"><span class="linenos"> 328</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-329"><a href="#MultisetExpression-329"><span class="linenos"> 329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-330"><a href="#MultisetExpression-330"><span class="linenos"> 330</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression-331"><a href="#MultisetExpression-331"><span class="linenos"> 331</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression-332"><a href="#MultisetExpression-332"><span class="linenos"> 332</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">UnionExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetExpression-333"><a href="#MultisetExpression-333"><span class="linenos"> 333</span></a>
</span><span id="MultisetExpression-334"><a href="#MultisetExpression-334"><span class="linenos"> 334</span></a>    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span>
</span><span id="MultisetExpression-335"><a href="#MultisetExpression-335"><span class="linenos"> 335</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-336"><a href="#MultisetExpression-336"><span class="linenos"> 336</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-337"><a href="#MultisetExpression-337"><span class="linenos"> 337</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-338"><a href="#MultisetExpression-338"><span class="linenos"> 338</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-339"><a href="#MultisetExpression-339"><span class="linenos"> 339</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-340"><a href="#MultisetExpression-340"><span class="linenos"> 340</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-341"><a href="#MultisetExpression-341"><span class="linenos"> 341</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-342"><a href="#MultisetExpression-342"><span class="linenos"> 342</span></a>
</span><span id="MultisetExpression-343"><a href="#MultisetExpression-343"><span class="linenos"> 343</span></a>    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span>
</span><span id="MultisetExpression-344"><a href="#MultisetExpression-344"><span class="linenos"> 344</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-345"><a href="#MultisetExpression-345"><span class="linenos"> 345</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-346"><a href="#MultisetExpression-346"><span class="linenos"> 346</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-347"><a href="#MultisetExpression-347"><span class="linenos"> 347</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-348"><a href="#MultisetExpression-348"><span class="linenos"> 348</span></a>            <span class="c1"># Symmetric.</span>
</span><span id="MultisetExpression-349"><a href="#MultisetExpression-349"><span class="linenos"> 349</span></a>            <span class="k">return</span> <span class="n">MultisetExpression</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-350"><a href="#MultisetExpression-350"><span class="linenos"> 350</span></a>        <span class="k">except</span> <span class="n">ImplicitConversionError</span><span class="p">:</span>
</span><span id="MultisetExpression-351"><a href="#MultisetExpression-351"><span class="linenos"> 351</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-352"><a href="#MultisetExpression-352"><span class="linenos"> 352</span></a>
</span><span id="MultisetExpression-353"><a href="#MultisetExpression-353"><span class="linenos"> 353</span></a>    <span class="k">def</span> <span class="nf">symmetric_difference</span><span class="p">(</span>
</span><span id="MultisetExpression-354"><a href="#MultisetExpression-354"><span class="linenos"> 354</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-355"><a href="#MultisetExpression-355"><span class="linenos"> 355</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-356"><a href="#MultisetExpression-356"><span class="linenos"> 356</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-357"><a href="#MultisetExpression-357"><span class="linenos"> 357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The elements that appear in the left or right multiset but not both.</span>
</span><span id="MultisetExpression-358"><a href="#MultisetExpression-358"><span class="linenos"> 358</span></a>
</span><span id="MultisetExpression-359"><a href="#MultisetExpression-359"><span class="linenos"> 359</span></a><span class="sd">        Same as `a ^ b`.</span>
</span><span id="MultisetExpression-360"><a href="#MultisetExpression-360"><span class="linenos"> 360</span></a>
</span><span id="MultisetExpression-361"><a href="#MultisetExpression-361"><span class="linenos"> 361</span></a><span class="sd">        Specifically, this produces the absolute difference between counts.</span>
</span><span id="MultisetExpression-362"><a href="#MultisetExpression-362"><span class="linenos"> 362</span></a><span class="sd">        If you don&#39;t want negative counts to be used from the inputs, you can</span>
</span><span id="MultisetExpression-363"><a href="#MultisetExpression-363"><span class="linenos"> 363</span></a><span class="sd">        do `left.keep_counts(&#39;&gt;=&#39;, 0) ^ right.keep_counts(&#39;&gt;=&#39;, 0)`.</span>
</span><span id="MultisetExpression-364"><a href="#MultisetExpression-364"><span class="linenos"> 364</span></a>
</span><span id="MultisetExpression-365"><a href="#MultisetExpression-365"><span class="linenos"> 365</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-366"><a href="#MultisetExpression-366"><span class="linenos"> 366</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-367"><a href="#MultisetExpression-367"><span class="linenos"> 367</span></a><span class="sd">        [1, 2, 2, 3] ^ [1, 2, 4] -&gt; [2, 3, 4]</span>
</span><span id="MultisetExpression-368"><a href="#MultisetExpression-368"><span class="linenos"> 368</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-369"><a href="#MultisetExpression-369"><span class="linenos"> 369</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-370"><a href="#MultisetExpression-370"><span class="linenos"> 370</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-371"><a href="#MultisetExpression-371"><span class="linenos"> 371</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">SymmetricDifferenceExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-372"><a href="#MultisetExpression-372"><span class="linenos"> 372</span></a>
</span><span id="MultisetExpression-373"><a href="#MultisetExpression-373"><span class="linenos"> 373</span></a>    <span class="k">def</span> <span class="nf">keep_outcomes</span><span class="p">(</span>
</span><span id="MultisetExpression-374"><a href="#MultisetExpression-374"><span class="linenos"> 374</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span>
</span><span id="MultisetExpression-375"><a href="#MultisetExpression-375"><span class="linenos"> 375</span></a>        <span class="s1">&#39;Callable[[T_contra], bool] | Collection[T_contra] | MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-376"><a href="#MultisetExpression-376"><span class="linenos"> 376</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-377"><a href="#MultisetExpression-377"><span class="linenos"> 377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keeps the elements in the target set of outcomes, and drops the rest by setting their counts to zero.</span>
</span><span id="MultisetExpression-378"><a href="#MultisetExpression-378"><span class="linenos"> 378</span></a>
</span><span id="MultisetExpression-379"><a href="#MultisetExpression-379"><span class="linenos"> 379</span></a><span class="sd">        This is similar to `intersection()`, except the right side is considered</span>
</span><span id="MultisetExpression-380"><a href="#MultisetExpression-380"><span class="linenos"> 380</span></a><span class="sd">        to have unlimited multiplicity.</span>
</span><span id="MultisetExpression-381"><a href="#MultisetExpression-381"><span class="linenos"> 381</span></a>
</span><span id="MultisetExpression-382"><a href="#MultisetExpression-382"><span class="linenos"> 382</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-383"><a href="#MultisetExpression-383"><span class="linenos"> 383</span></a><span class="sd">            target: A callable returning `True` iff the outcome should be kept,</span>
</span><span id="MultisetExpression-384"><a href="#MultisetExpression-384"><span class="linenos"> 384</span></a><span class="sd">                or an expression or collection of outcomes to keep.</span>
</span><span id="MultisetExpression-385"><a href="#MultisetExpression-385"><span class="linenos"> 385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-386"><a href="#MultisetExpression-386"><span class="linenos"> 386</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">MultisetExpression</span><span class="p">):</span>
</span><span id="MultisetExpression-387"><a href="#MultisetExpression-387"><span class="linenos"> 387</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesBinaryExpression</span><span class="p">(</span>
</span><span id="MultisetExpression-388"><a href="#MultisetExpression-388"><span class="linenos"> 388</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="MultisetExpression-389"><a href="#MultisetExpression-389"><span class="linenos"> 389</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-390"><a href="#MultisetExpression-390"><span class="linenos"> 390</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="MultisetExpression-391"><a href="#MultisetExpression-391"><span class="linenos"> 391</span></a>
</span><span id="MultisetExpression-392"><a href="#MultisetExpression-392"><span class="linenos"> 392</span></a>    <span class="k">def</span> <span class="nf">drop_outcomes</span><span class="p">(</span>
</span><span id="MultisetExpression-393"><a href="#MultisetExpression-393"><span class="linenos"> 393</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span>
</span><span id="MultisetExpression-394"><a href="#MultisetExpression-394"><span class="linenos"> 394</span></a>        <span class="s1">&#39;Callable[[T_contra], bool] | Collection[T_contra] | MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-395"><a href="#MultisetExpression-395"><span class="linenos"> 395</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-396"><a href="#MultisetExpression-396"><span class="linenos"> 396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Drops the elements in the target set of outcomes by setting their counts to zero, and keeps the rest.</span>
</span><span id="MultisetExpression-397"><a href="#MultisetExpression-397"><span class="linenos"> 397</span></a>
</span><span id="MultisetExpression-398"><a href="#MultisetExpression-398"><span class="linenos"> 398</span></a><span class="sd">        This is similar to `difference()`, except the right side is considered</span>
</span><span id="MultisetExpression-399"><a href="#MultisetExpression-399"><span class="linenos"> 399</span></a><span class="sd">        to have unlimited multiplicity.</span>
</span><span id="MultisetExpression-400"><a href="#MultisetExpression-400"><span class="linenos"> 400</span></a>
</span><span id="MultisetExpression-401"><a href="#MultisetExpression-401"><span class="linenos"> 401</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-402"><a href="#MultisetExpression-402"><span class="linenos"> 402</span></a><span class="sd">            target: A callable returning `True` iff the outcome should be</span>
</span><span id="MultisetExpression-403"><a href="#MultisetExpression-403"><span class="linenos"> 403</span></a><span class="sd">                dropped, or an expression or collection of outcomes to drop.</span>
</span><span id="MultisetExpression-404"><a href="#MultisetExpression-404"><span class="linenos"> 404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-405"><a href="#MultisetExpression-405"><span class="linenos"> 405</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">MultisetExpression</span><span class="p">):</span>
</span><span id="MultisetExpression-406"><a href="#MultisetExpression-406"><span class="linenos"> 406</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesBinaryExpression</span><span class="p">(</span>
</span><span id="MultisetExpression-407"><a href="#MultisetExpression-407"><span class="linenos"> 407</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MultisetExpression-408"><a href="#MultisetExpression-408"><span class="linenos"> 408</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-409"><a href="#MultisetExpression-409"><span class="linenos"> 409</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-410"><a href="#MultisetExpression-410"><span class="linenos"> 410</span></a>                                                               <span class="n">target</span><span class="p">,</span>
</span><span id="MultisetExpression-411"><a href="#MultisetExpression-411"><span class="linenos"> 411</span></a>                                                               <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MultisetExpression-412"><a href="#MultisetExpression-412"><span class="linenos"> 412</span></a>
</span><span id="MultisetExpression-413"><a href="#MultisetExpression-413"><span class="linenos"> 413</span></a>    <span class="c1"># Adjust counts.</span>
</span><span id="MultisetExpression-414"><a href="#MultisetExpression-414"><span class="linenos"> 414</span></a>
</span><span id="MultisetExpression-415"><a href="#MultisetExpression-415"><span class="linenos"> 415</span></a>    <span class="k">def</span> <span class="nf">map_counts</span><span class="p">(</span>
</span><span id="MultisetExpression-416"><a href="#MultisetExpression-416"><span class="linenos"> 416</span></a>            <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression-417"><a href="#MultisetExpression-417"><span class="linenos"> 417</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-418"><a href="#MultisetExpression-418"><span class="linenos"> 418</span></a>            <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-419"><a href="#MultisetExpression-419"><span class="linenos"> 419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps the counts to new counts.</span>
</span><span id="MultisetExpression-420"><a href="#MultisetExpression-420"><span class="linenos"> 420</span></a>
</span><span id="MultisetExpression-421"><a href="#MultisetExpression-421"><span class="linenos"> 421</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-422"><a href="#MultisetExpression-422"><span class="linenos"> 422</span></a><span class="sd">            function: A function that takes `outcome, *counts` and produces a</span>
</span><span id="MultisetExpression-423"><a href="#MultisetExpression-423"><span class="linenos"> 423</span></a><span class="sd">                combined count.</span>
</span><span id="MultisetExpression-424"><a href="#MultisetExpression-424"><span class="linenos"> 424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-425"><a href="#MultisetExpression-425"><span class="linenos"> 425</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression-426"><a href="#MultisetExpression-426"><span class="linenos"> 426</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression-427"><a href="#MultisetExpression-427"><span class="linenos"> 427</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">MapCountsExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span>
</span><span id="MultisetExpression-428"><a href="#MultisetExpression-428"><span class="linenos"> 428</span></a>                                                      <span class="n">function</span><span class="o">=</span><span class="n">function</span><span class="p">)</span>
</span><span id="MultisetExpression-429"><a href="#MultisetExpression-429"><span class="linenos"> 429</span></a>
</span><span id="MultisetExpression-430"><a href="#MultisetExpression-430"><span class="linenos"> 430</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-431"><a href="#MultisetExpression-431"><span class="linenos"> 431</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MultisetExpression-432"><a href="#MultisetExpression-432"><span class="linenos"> 432</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-433"><a href="#MultisetExpression-433"><span class="linenos"> 433</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply_counts</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="MultisetExpression-434"><a href="#MultisetExpression-434"><span class="linenos"> 434</span></a>
</span><span id="MultisetExpression-435"><a href="#MultisetExpression-435"><span class="linenos"> 435</span></a>    <span class="c1"># Commutable in this case.</span>
</span><span id="MultisetExpression-436"><a href="#MultisetExpression-436"><span class="linenos"> 436</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-437"><a href="#MultisetExpression-437"><span class="linenos"> 437</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MultisetExpression-438"><a href="#MultisetExpression-438"><span class="linenos"> 438</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-439"><a href="#MultisetExpression-439"><span class="linenos"> 439</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiply_counts</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="MultisetExpression-440"><a href="#MultisetExpression-440"><span class="linenos"> 440</span></a>
</span><span id="MultisetExpression-441"><a href="#MultisetExpression-441"><span class="linenos"> 441</span></a>    <span class="k">def</span> <span class="nf">multiply_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-442"><a href="#MultisetExpression-442"><span class="linenos"> 442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiplies all counts by n.</span>
</span><span id="MultisetExpression-443"><a href="#MultisetExpression-443"><span class="linenos"> 443</span></a>
</span><span id="MultisetExpression-444"><a href="#MultisetExpression-444"><span class="linenos"> 444</span></a><span class="sd">        Same as `self * n`.</span>
</span><span id="MultisetExpression-445"><a href="#MultisetExpression-445"><span class="linenos"> 445</span></a>
</span><span id="MultisetExpression-446"><a href="#MultisetExpression-446"><span class="linenos"> 446</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-447"><a href="#MultisetExpression-447"><span class="linenos"> 447</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-448"><a href="#MultisetExpression-448"><span class="linenos"> 448</span></a><span class="sd">        Pool([1, 2, 2, 3]) * 2 -&gt; [1, 1, 2, 2, 2, 2, 3, 3]</span>
</span><span id="MultisetExpression-449"><a href="#MultisetExpression-449"><span class="linenos"> 449</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-450"><a href="#MultisetExpression-450"><span class="linenos"> 450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-451"><a href="#MultisetExpression-451"><span class="linenos"> 451</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">MultiplyCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="MultisetExpression-452"><a href="#MultisetExpression-452"><span class="linenos"> 452</span></a>
</span><span id="MultisetExpression-453"><a href="#MultisetExpression-453"><span class="linenos"> 453</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetExpression-454"><a href="#MultisetExpression-454"><span class="linenos"> 454</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-455"><a href="#MultisetExpression-455"><span class="linenos"> 455</span></a>        <span class="o">...</span>
</span><span id="MultisetExpression-456"><a href="#MultisetExpression-456"><span class="linenos"> 456</span></a>
</span><span id="MultisetExpression-457"><a href="#MultisetExpression-457"><span class="linenos"> 457</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetExpression-458"><a href="#MultisetExpression-458"><span class="linenos"> 458</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span>
</span><span id="MultisetExpression-459"><a href="#MultisetExpression-459"><span class="linenos"> 459</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-460"><a href="#MultisetExpression-460"><span class="linenos"> 460</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-461"><a href="#MultisetExpression-461"><span class="linenos"> 461</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-462"><a href="#MultisetExpression-462"><span class="linenos"> 462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Same as divide_counts().&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-463"><a href="#MultisetExpression-463"><span class="linenos"> 463</span></a>
</span><span id="MultisetExpression-464"><a href="#MultisetExpression-464"><span class="linenos"> 464</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetExpression-465"><a href="#MultisetExpression-465"><span class="linenos"> 465</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span>
</span><span id="MultisetExpression-466"><a href="#MultisetExpression-466"><span class="linenos"> 466</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-467"><a href="#MultisetExpression-467"><span class="linenos"> 467</span></a>        <span class="s1">&#39;int | MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-468"><a href="#MultisetExpression-468"><span class="linenos"> 468</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra] | icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-469"><a href="#MultisetExpression-469"><span class="linenos"> 469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Same as count_subset().&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-470"><a href="#MultisetExpression-470"><span class="linenos"> 470</span></a>
</span><span id="MultisetExpression-471"><a href="#MultisetExpression-471"><span class="linenos"> 471</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span>
</span><span id="MultisetExpression-472"><a href="#MultisetExpression-472"><span class="linenos"> 472</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-473"><a href="#MultisetExpression-473"><span class="linenos"> 473</span></a>        <span class="s1">&#39;int | MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-474"><a href="#MultisetExpression-474"><span class="linenos"> 474</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra] | icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-475"><a href="#MultisetExpression-475"><span class="linenos"> 475</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MultisetExpression-476"><a href="#MultisetExpression-476"><span class="linenos"> 476</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">divide_counts</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-477"><a href="#MultisetExpression-477"><span class="linenos"> 477</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-478"><a href="#MultisetExpression-478"><span class="linenos"> 478</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">count_subset</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-479"><a href="#MultisetExpression-479"><span class="linenos"> 479</span></a>
</span><span id="MultisetExpression-480"><a href="#MultisetExpression-480"><span class="linenos"> 480</span></a>    <span class="k">def</span> <span class="nf">divide_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-481"><a href="#MultisetExpression-481"><span class="linenos"> 481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divides all counts by n (rounding down).</span>
</span><span id="MultisetExpression-482"><a href="#MultisetExpression-482"><span class="linenos"> 482</span></a>
</span><span id="MultisetExpression-483"><a href="#MultisetExpression-483"><span class="linenos"> 483</span></a><span class="sd">        Same as `self // n`.</span>
</span><span id="MultisetExpression-484"><a href="#MultisetExpression-484"><span class="linenos"> 484</span></a>
</span><span id="MultisetExpression-485"><a href="#MultisetExpression-485"><span class="linenos"> 485</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-486"><a href="#MultisetExpression-486"><span class="linenos"> 486</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-487"><a href="#MultisetExpression-487"><span class="linenos"> 487</span></a><span class="sd">        Pool([1, 2, 2, 3]) // 2 -&gt; [2]</span>
</span><span id="MultisetExpression-488"><a href="#MultisetExpression-488"><span class="linenos"> 488</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-489"><a href="#MultisetExpression-489"><span class="linenos"> 489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-490"><a href="#MultisetExpression-490"><span class="linenos"> 490</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FloorDivCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="MultisetExpression-491"><a href="#MultisetExpression-491"><span class="linenos"> 491</span></a>
</span><span id="MultisetExpression-492"><a href="#MultisetExpression-492"><span class="linenos"> 492</span></a>    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-493"><a href="#MultisetExpression-493"><span class="linenos"> 493</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MultisetExpression-494"><a href="#MultisetExpression-494"><span class="linenos"> 494</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-495"><a href="#MultisetExpression-495"><span class="linenos"> 495</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">ModuloCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="MultisetExpression-496"><a href="#MultisetExpression-496"><span class="linenos"> 496</span></a>
</span><span id="MultisetExpression-497"><a href="#MultisetExpression-497"><span class="linenos"> 497</span></a>    <span class="k">def</span> <span class="nf">modulo_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-498"><a href="#MultisetExpression-498"><span class="linenos"> 498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Moduos all counts by n.</span>
</span><span id="MultisetExpression-499"><a href="#MultisetExpression-499"><span class="linenos"> 499</span></a>
</span><span id="MultisetExpression-500"><a href="#MultisetExpression-500"><span class="linenos"> 500</span></a><span class="sd">        Same as `self % n`.</span>
</span><span id="MultisetExpression-501"><a href="#MultisetExpression-501"><span class="linenos"> 501</span></a>
</span><span id="MultisetExpression-502"><a href="#MultisetExpression-502"><span class="linenos"> 502</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-503"><a href="#MultisetExpression-503"><span class="linenos"> 503</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-504"><a href="#MultisetExpression-504"><span class="linenos"> 504</span></a><span class="sd">        Pool([1, 2, 2, 3]) % 2 -&gt; [1, 3]</span>
</span><span id="MultisetExpression-505"><a href="#MultisetExpression-505"><span class="linenos"> 505</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-506"><a href="#MultisetExpression-506"><span class="linenos"> 506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-507"><a href="#MultisetExpression-507"><span class="linenos"> 507</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">%</span> <span class="n">n</span>
</span><span id="MultisetExpression-508"><a href="#MultisetExpression-508"><span class="linenos"> 508</span></a>
</span><span id="MultisetExpression-509"><a href="#MultisetExpression-509"><span class="linenos"> 509</span></a>    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-510"><a href="#MultisetExpression-510"><span class="linenos"> 510</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets all negative counts to zero.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-511"><a href="#MultisetExpression-511"><span class="linenos"> 511</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">KeepCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="MultisetExpression-512"><a href="#MultisetExpression-512"><span class="linenos"> 512</span></a>
</span><span id="MultisetExpression-513"><a href="#MultisetExpression-513"><span class="linenos"> 513</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-514"><a href="#MultisetExpression-514"><span class="linenos"> 514</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;As -1 * self.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-515"><a href="#MultisetExpression-515"><span class="linenos"> 515</span></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span>
</span><span id="MultisetExpression-516"><a href="#MultisetExpression-516"><span class="linenos"> 516</span></a>
</span><span id="MultisetExpression-517"><a href="#MultisetExpression-517"><span class="linenos"> 517</span></a>    <span class="k">def</span> <span class="nf">keep_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-518"><a href="#MultisetExpression-518"><span class="linenos"> 518</span></a>                                              <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MultisetExpression-519"><a href="#MultisetExpression-519"><span class="linenos"> 519</span></a>                    <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-520"><a href="#MultisetExpression-520"><span class="linenos"> 520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keeps counts fitting the comparison, treating the rest as zero.</span>
</span><span id="MultisetExpression-521"><a href="#MultisetExpression-521"><span class="linenos"> 521</span></a>
</span><span id="MultisetExpression-522"><a href="#MultisetExpression-522"><span class="linenos"> 522</span></a><span class="sd">        For example, `expression.keep_counts(&#39;&gt;=&#39;, 2)` would keep pairs,</span>
</span><span id="MultisetExpression-523"><a href="#MultisetExpression-523"><span class="linenos"> 523</span></a><span class="sd">        triplets, etc. and drop singles.</span>
</span><span id="MultisetExpression-524"><a href="#MultisetExpression-524"><span class="linenos"> 524</span></a>
</span><span id="MultisetExpression-525"><a href="#MultisetExpression-525"><span class="linenos"> 525</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-526"><a href="#MultisetExpression-526"><span class="linenos"> 526</span></a><span class="sd">        Pool([1, 2, 2, 3, 3, 3]).keep_counts(&#39;&gt;=&#39;, 2) -&gt; [2, 2, 3, 3, 3]</span>
</span><span id="MultisetExpression-527"><a href="#MultisetExpression-527"><span class="linenos"> 527</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-528"><a href="#MultisetExpression-528"><span class="linenos"> 528</span></a><span class="sd">        </span>
</span><span id="MultisetExpression-529"><a href="#MultisetExpression-529"><span class="linenos"> 529</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-530"><a href="#MultisetExpression-530"><span class="linenos"> 530</span></a><span class="sd">            comparison: The comparison to use.</span>
</span><span id="MultisetExpression-531"><a href="#MultisetExpression-531"><span class="linenos"> 531</span></a><span class="sd">            n: The number to compare counts against.</span>
</span><span id="MultisetExpression-532"><a href="#MultisetExpression-532"><span class="linenos"> 532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-533"><a href="#MultisetExpression-533"><span class="linenos"> 533</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">KeepCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="MultisetExpression-534"><a href="#MultisetExpression-534"><span class="linenos"> 534</span></a>
</span><span id="MultisetExpression-535"><a href="#MultisetExpression-535"><span class="linenos"> 535</span></a>    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-536"><a href="#MultisetExpression-536"><span class="linenos"> 536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts each outcome at most `n` times.</span>
</span><span id="MultisetExpression-537"><a href="#MultisetExpression-537"><span class="linenos"> 537</span></a>
</span><span id="MultisetExpression-538"><a href="#MultisetExpression-538"><span class="linenos"> 538</span></a><span class="sd">        For example, `generator.unique(2)` would count each outcome at most</span>
</span><span id="MultisetExpression-539"><a href="#MultisetExpression-539"><span class="linenos"> 539</span></a><span class="sd">        twice.</span>
</span><span id="MultisetExpression-540"><a href="#MultisetExpression-540"><span class="linenos"> 540</span></a>
</span><span id="MultisetExpression-541"><a href="#MultisetExpression-541"><span class="linenos"> 541</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-542"><a href="#MultisetExpression-542"><span class="linenos"> 542</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-543"><a href="#MultisetExpression-543"><span class="linenos"> 543</span></a><span class="sd">        Pool([1, 2, 2, 3]).unique() -&gt; [1, 2, 3]</span>
</span><span id="MultisetExpression-544"><a href="#MultisetExpression-544"><span class="linenos"> 544</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-545"><a href="#MultisetExpression-545"><span class="linenos"> 545</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-546"><a href="#MultisetExpression-546"><span class="linenos"> 546</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">UniqueExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span id="MultisetExpression-547"><a href="#MultisetExpression-547"><span class="linenos"> 547</span></a>
</span><span id="MultisetExpression-548"><a href="#MultisetExpression-548"><span class="linenos"> 548</span></a>    <span class="c1"># Keep highest / lowest.</span>
</span><span id="MultisetExpression-549"><a href="#MultisetExpression-549"><span class="linenos"> 549</span></a>
</span><span id="MultisetExpression-550"><a href="#MultisetExpression-550"><span class="linenos"> 550</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetExpression-551"><a href="#MultisetExpression-551"><span class="linenos"> 551</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span>
</span><span id="MultisetExpression-552"><a href="#MultisetExpression-552"><span class="linenos"> 552</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span>
</span><span id="MultisetExpression-553"><a href="#MultisetExpression-553"><span class="linenos"> 553</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-554"><a href="#MultisetExpression-554"><span class="linenos"> 554</span></a>        <span class="o">...</span>
</span><span id="MultisetExpression-555"><a href="#MultisetExpression-555"><span class="linenos"> 555</span></a>
</span><span id="MultisetExpression-556"><a href="#MultisetExpression-556"><span class="linenos"> 556</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetExpression-557"><a href="#MultisetExpression-557"><span class="linenos"> 557</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span>
</span><span id="MultisetExpression-558"><a href="#MultisetExpression-558"><span class="linenos"> 558</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="MultisetExpression-559"><a href="#MultisetExpression-559"><span class="linenos"> 559</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T_contra] | icepool.MultisetEvaluator[T_contra, T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-560"><a href="#MultisetExpression-560"><span class="linenos"> 560</span></a>        <span class="o">...</span>
</span><span id="MultisetExpression-561"><a href="#MultisetExpression-561"><span class="linenos"> 561</span></a>
</span><span id="MultisetExpression-562"><a href="#MultisetExpression-562"><span class="linenos"> 562</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span>
</span><span id="MultisetExpression-563"><a href="#MultisetExpression-563"><span class="linenos"> 563</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span>
</span><span id="MultisetExpression-564"><a href="#MultisetExpression-564"><span class="linenos"> 564</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra] | icepool.Die[T_contra] | icepool.MultisetEvaluator[T_contra, T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-565"><a href="#MultisetExpression-565"><span class="linenos"> 565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects elements after drawing and sorting.</span>
</span><span id="MultisetExpression-566"><a href="#MultisetExpression-566"><span class="linenos"> 566</span></a>
</span><span id="MultisetExpression-567"><a href="#MultisetExpression-567"><span class="linenos"> 567</span></a><span class="sd">        This is less capable than the `KeepGenerator` version.</span>
</span><span id="MultisetExpression-568"><a href="#MultisetExpression-568"><span class="linenos"> 568</span></a><span class="sd">        In particular, it does not know how many elements it is selecting from,</span>
</span><span id="MultisetExpression-569"><a href="#MultisetExpression-569"><span class="linenos"> 569</span></a><span class="sd">        so it must be anchored at the starting end. The advantage is that it</span>
</span><span id="MultisetExpression-570"><a href="#MultisetExpression-570"><span class="linenos"> 570</span></a><span class="sd">        can be applied to any expression.</span>
</span><span id="MultisetExpression-571"><a href="#MultisetExpression-571"><span class="linenos"> 571</span></a>
</span><span id="MultisetExpression-572"><a href="#MultisetExpression-572"><span class="linenos"> 572</span></a><span class="sd">        The valid types of argument are:</span>
</span><span id="MultisetExpression-573"><a href="#MultisetExpression-573"><span class="linenos"> 573</span></a>
</span><span id="MultisetExpression-574"><a href="#MultisetExpression-574"><span class="linenos"> 574</span></a><span class="sd">        * A `slice`. If both start and stop are provided, they must both be</span>
</span><span id="MultisetExpression-575"><a href="#MultisetExpression-575"><span class="linenos"> 575</span></a><span class="sd">            non-negative or both be negative. step is not supported.</span>
</span><span id="MultisetExpression-576"><a href="#MultisetExpression-576"><span class="linenos"> 576</span></a><span class="sd">        * A sequence of `int` with `...` (`Ellipsis`) at exactly one end.</span>
</span><span id="MultisetExpression-577"><a href="#MultisetExpression-577"><span class="linenos"> 577</span></a><span class="sd">            Each sorted element will be counted that many times, with the</span>
</span><span id="MultisetExpression-578"><a href="#MultisetExpression-578"><span class="linenos"> 578</span></a><span class="sd">            `Ellipsis` treated as enough zeros (possibly &quot;negative&quot;) to</span>
</span><span id="MultisetExpression-579"><a href="#MultisetExpression-579"><span class="linenos"> 579</span></a><span class="sd">            fill the rest of the elements.</span>
</span><span id="MultisetExpression-580"><a href="#MultisetExpression-580"><span class="linenos"> 580</span></a><span class="sd">        * An `int`, which evaluates by taking the element at the specified</span>
</span><span id="MultisetExpression-581"><a href="#MultisetExpression-581"><span class="linenos"> 581</span></a><span class="sd">            index. In this case the result is a `Die` (if fully bound) or a</span>
</span><span id="MultisetExpression-582"><a href="#MultisetExpression-582"><span class="linenos"> 582</span></a><span class="sd">            `MultisetEvaluator` (if there are free variables).</span>
</span><span id="MultisetExpression-583"><a href="#MultisetExpression-583"><span class="linenos"> 583</span></a>
</span><span id="MultisetExpression-584"><a href="#MultisetExpression-584"><span class="linenos"> 584</span></a><span class="sd">        Use the `[]` operator for the same effect as this method.</span>
</span><span id="MultisetExpression-585"><a href="#MultisetExpression-585"><span class="linenos"> 585</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-586"><a href="#MultisetExpression-586"><span class="linenos"> 586</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MultisetExpression-587"><a href="#MultisetExpression-587"><span class="linenos"> 587</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-588"><a href="#MultisetExpression-588"><span class="linenos"> 588</span></a>                <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">KeepEvaluator</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="MultisetExpression-589"><a href="#MultisetExpression-589"><span class="linenos"> 589</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-590"><a href="#MultisetExpression-590"><span class="linenos"> 590</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">KeepExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span><span id="MultisetExpression-591"><a href="#MultisetExpression-591"><span class="linenos"> 591</span></a>
</span><span id="MultisetExpression-592"><a href="#MultisetExpression-592"><span class="linenos"> 592</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetExpression-593"><a href="#MultisetExpression-593"><span class="linenos"> 593</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
</span><span id="MultisetExpression-594"><a href="#MultisetExpression-594"><span class="linenos"> 594</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span>
</span><span id="MultisetExpression-595"><a href="#MultisetExpression-595"><span class="linenos"> 595</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-596"><a href="#MultisetExpression-596"><span class="linenos"> 596</span></a>        <span class="o">...</span>
</span><span id="MultisetExpression-597"><a href="#MultisetExpression-597"><span class="linenos"> 597</span></a>
</span><span id="MultisetExpression-598"><a href="#MultisetExpression-598"><span class="linenos"> 598</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetExpression-599"><a href="#MultisetExpression-599"><span class="linenos"> 599</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
</span><span id="MultisetExpression-600"><a href="#MultisetExpression-600"><span class="linenos"> 600</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="MultisetExpression-601"><a href="#MultisetExpression-601"><span class="linenos"> 601</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[T_contra] | icepool.MultisetEvaluator[T_contra, T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-602"><a href="#MultisetExpression-602"><span class="linenos"> 602</span></a>        <span class="o">...</span>
</span><span id="MultisetExpression-603"><a href="#MultisetExpression-603"><span class="linenos"> 603</span></a>
</span><span id="MultisetExpression-604"><a href="#MultisetExpression-604"><span class="linenos"> 604</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span>
</span><span id="MultisetExpression-605"><a href="#MultisetExpression-605"><span class="linenos"> 605</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span>
</span><span id="MultisetExpression-606"><a href="#MultisetExpression-606"><span class="linenos"> 606</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra] | icepool.Die[T_contra] | icepool.MultisetEvaluator[T_contra, T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-607"><a href="#MultisetExpression-607"><span class="linenos"> 607</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="MultisetExpression-608"><a href="#MultisetExpression-608"><span class="linenos"> 608</span></a>
</span><span id="MultisetExpression-609"><a href="#MultisetExpression-609"><span class="linenos"> 609</span></a>    <span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-610"><a href="#MultisetExpression-610"><span class="linenos"> 610</span></a>               <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MultisetExpression-611"><a href="#MultisetExpression-611"><span class="linenos"> 611</span></a>               <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-612"><a href="#MultisetExpression-612"><span class="linenos"> 612</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep some of the lowest elements from this multiset and drop the rest.</span>
</span><span id="MultisetExpression-613"><a href="#MultisetExpression-613"><span class="linenos"> 613</span></a>
</span><span id="MultisetExpression-614"><a href="#MultisetExpression-614"><span class="linenos"> 614</span></a><span class="sd">        In contrast to the die and free function versions, this does not</span>
</span><span id="MultisetExpression-615"><a href="#MultisetExpression-615"><span class="linenos"> 615</span></a><span class="sd">        automatically sum the dice. Use `.sum()` afterwards if you want to sum.</span>
</span><span id="MultisetExpression-616"><a href="#MultisetExpression-616"><span class="linenos"> 616</span></a><span class="sd">        Alternatively, you can perform some other evaluation.</span>
</span><span id="MultisetExpression-617"><a href="#MultisetExpression-617"><span class="linenos"> 617</span></a>
</span><span id="MultisetExpression-618"><a href="#MultisetExpression-618"><span class="linenos"> 618</span></a><span class="sd">        This requires the outcomes to be evaluated in ascending order.</span>
</span><span id="MultisetExpression-619"><a href="#MultisetExpression-619"><span class="linenos"> 619</span></a>
</span><span id="MultisetExpression-620"><a href="#MultisetExpression-620"><span class="linenos"> 620</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-621"><a href="#MultisetExpression-621"><span class="linenos"> 621</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="MultisetExpression-622"><a href="#MultisetExpression-622"><span class="linenos"> 622</span></a><span class="sd">                * If neither are provided, the single lowest element</span>
</span><span id="MultisetExpression-623"><a href="#MultisetExpression-623"><span class="linenos"> 623</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression-624"><a href="#MultisetExpression-624"><span class="linenos"> 624</span></a><span class="sd">                * If only `keep` is provided, the `keep` lowest elements</span>
</span><span id="MultisetExpression-625"><a href="#MultisetExpression-625"><span class="linenos"> 625</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression-626"><a href="#MultisetExpression-626"><span class="linenos"> 626</span></a><span class="sd">                * If only `drop` is provided, the `drop` lowest elements</span>
</span><span id="MultisetExpression-627"><a href="#MultisetExpression-627"><span class="linenos"> 627</span></a><span class="sd">                    will be dropped and the rest will be kept.</span>
</span><span id="MultisetExpression-628"><a href="#MultisetExpression-628"><span class="linenos"> 628</span></a><span class="sd">                * If both are provided, `drop` lowest elements will be dropped,</span>
</span><span id="MultisetExpression-629"><a href="#MultisetExpression-629"><span class="linenos"> 629</span></a><span class="sd">                    then the next `keep` lowest elements will be kept.</span>
</span><span id="MultisetExpression-630"><a href="#MultisetExpression-630"><span class="linenos"> 630</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-631"><a href="#MultisetExpression-631"><span class="linenos"> 631</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">lowest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="MultisetExpression-632"><a href="#MultisetExpression-632"><span class="linenos"> 632</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="MultisetExpression-633"><a href="#MultisetExpression-633"><span class="linenos"> 633</span></a>
</span><span id="MultisetExpression-634"><a href="#MultisetExpression-634"><span class="linenos"> 634</span></a>    <span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-635"><a href="#MultisetExpression-635"><span class="linenos"> 635</span></a>                <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MultisetExpression-636"><a href="#MultisetExpression-636"><span class="linenos"> 636</span></a>                <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-637"><a href="#MultisetExpression-637"><span class="linenos"> 637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep some of the highest elements from this multiset and drop the rest.</span>
</span><span id="MultisetExpression-638"><a href="#MultisetExpression-638"><span class="linenos"> 638</span></a>
</span><span id="MultisetExpression-639"><a href="#MultisetExpression-639"><span class="linenos"> 639</span></a><span class="sd">        In contrast to the die and free function versions, this does not</span>
</span><span id="MultisetExpression-640"><a href="#MultisetExpression-640"><span class="linenos"> 640</span></a><span class="sd">        automatically sum the dice. Use `.sum()` afterwards if you want to sum.</span>
</span><span id="MultisetExpression-641"><a href="#MultisetExpression-641"><span class="linenos"> 641</span></a><span class="sd">        Alternatively, you can perform some other evaluation.</span>
</span><span id="MultisetExpression-642"><a href="#MultisetExpression-642"><span class="linenos"> 642</span></a>
</span><span id="MultisetExpression-643"><a href="#MultisetExpression-643"><span class="linenos"> 643</span></a><span class="sd">        This requires the outcomes to be evaluated in descending order.</span>
</span><span id="MultisetExpression-644"><a href="#MultisetExpression-644"><span class="linenos"> 644</span></a>
</span><span id="MultisetExpression-645"><a href="#MultisetExpression-645"><span class="linenos"> 645</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-646"><a href="#MultisetExpression-646"><span class="linenos"> 646</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="MultisetExpression-647"><a href="#MultisetExpression-647"><span class="linenos"> 647</span></a><span class="sd">                * If neither are provided, the single highest element</span>
</span><span id="MultisetExpression-648"><a href="#MultisetExpression-648"><span class="linenos"> 648</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression-649"><a href="#MultisetExpression-649"><span class="linenos"> 649</span></a><span class="sd">                * If only `keep` is provided, the `keep` highest elements</span>
</span><span id="MultisetExpression-650"><a href="#MultisetExpression-650"><span class="linenos"> 650</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression-651"><a href="#MultisetExpression-651"><span class="linenos"> 651</span></a><span class="sd">                * If only `drop` is provided, the `drop` highest elements</span>
</span><span id="MultisetExpression-652"><a href="#MultisetExpression-652"><span class="linenos"> 652</span></a><span class="sd">                    will be dropped and the rest will be kept.</span>
</span><span id="MultisetExpression-653"><a href="#MultisetExpression-653"><span class="linenos"> 653</span></a><span class="sd">                * If both are provided, `drop` highest elements will be dropped, </span>
</span><span id="MultisetExpression-654"><a href="#MultisetExpression-654"><span class="linenos"> 654</span></a><span class="sd">                    then the next `keep` highest elements will be kept.</span>
</span><span id="MultisetExpression-655"><a href="#MultisetExpression-655"><span class="linenos"> 655</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-656"><a href="#MultisetExpression-656"><span class="linenos"> 656</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">highest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="MultisetExpression-657"><a href="#MultisetExpression-657"><span class="linenos"> 657</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span><span id="MultisetExpression-658"><a href="#MultisetExpression-658"><span class="linenos"> 658</span></a>
</span><span id="MultisetExpression-659"><a href="#MultisetExpression-659"><span class="linenos"> 659</span></a>    <span class="c1"># Pairing.</span>
</span><span id="MultisetExpression-660"><a href="#MultisetExpression-660"><span class="linenos"> 660</span></a>
</span><span id="MultisetExpression-661"><a href="#MultisetExpression-661"><span class="linenos"> 661</span></a>    <span class="k">def</span> <span class="nf">pair_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-662"><a href="#MultisetExpression-662"><span class="linenos"> 662</span></a>                <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-663"><a href="#MultisetExpression-663"><span class="linenos"> 663</span></a>                <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-664"><a href="#MultisetExpression-664"><span class="linenos"> 664</span></a>                <span class="n">keep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="MultisetExpression-665"><a href="#MultisetExpression-665"><span class="linenos"> 665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Make pairs of elements such that `self &lt;= other`, then keep or drop the paired elements from `self`.</span>
</span><span id="MultisetExpression-666"><a href="#MultisetExpression-666"><span class="linenos"> 666</span></a><span class="sd">        </span>
</span><span id="MultisetExpression-667"><a href="#MultisetExpression-667"><span class="linenos"> 667</span></a><span class="sd">        First, make as many pairs of one element of `self` and one element of</span>
</span><span id="MultisetExpression-668"><a href="#MultisetExpression-668"><span class="linenos"> 668</span></a><span class="sd">        `other` such that:</span>
</span><span id="MultisetExpression-669"><a href="#MultisetExpression-669"><span class="linenos"> 669</span></a><span class="sd">        * In each pair, the element from `self` &lt;= the element from `other`.</span>
</span><span id="MultisetExpression-670"><a href="#MultisetExpression-670"><span class="linenos"> 670</span></a><span class="sd">        * The element from `self` is as great as possible otherwise.</span>
</span><span id="MultisetExpression-671"><a href="#MultisetExpression-671"><span class="linenos"> 671</span></a><span class="sd">        Keep the elements from `self` that were paired and drop the rest.</span>
</span><span id="MultisetExpression-672"><a href="#MultisetExpression-672"><span class="linenos"> 672</span></a>
</span><span id="MultisetExpression-673"><a href="#MultisetExpression-673"><span class="linenos"> 673</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-674"><a href="#MultisetExpression-674"><span class="linenos"> 674</span></a><span class="sd">            other: The other multiset to pair elements with.</span>
</span><span id="MultisetExpression-675"><a href="#MultisetExpression-675"><span class="linenos"> 675</span></a><span class="sd">            keep: If `True` (default), the paired elements from `self` will be</span>
</span><span id="MultisetExpression-676"><a href="#MultisetExpression-676"><span class="linenos"> 676</span></a><span class="sd">                kept. Otherwise, the unpaired elements will be kept.</span>
</span><span id="MultisetExpression-677"><a href="#MultisetExpression-677"><span class="linenos"> 677</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-678"><a href="#MultisetExpression-678"><span class="linenos"> 678</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-679"><a href="#MultisetExpression-679"><span class="linenos"> 679</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">PairKeepExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-680"><a href="#MultisetExpression-680"><span class="linenos"> 680</span></a>                                                     <span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-681"><a href="#MultisetExpression-681"><span class="linenos"> 681</span></a>                                                     <span class="n">order</span><span class="o">=</span><span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">,</span>
</span><span id="MultisetExpression-682"><a href="#MultisetExpression-682"><span class="linenos"> 682</span></a>                                                     <span class="n">allow_equal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MultisetExpression-683"><a href="#MultisetExpression-683"><span class="linenos"> 683</span></a>                                                     <span class="n">keep</span><span class="o">=</span><span class="n">keep</span><span class="p">)</span>
</span><span id="MultisetExpression-684"><a href="#MultisetExpression-684"><span class="linenos"> 684</span></a>
</span><span id="MultisetExpression-685"><a href="#MultisetExpression-685"><span class="linenos"> 685</span></a>    <span class="c1"># Evaluations.</span>
</span><span id="MultisetExpression-686"><a href="#MultisetExpression-686"><span class="linenos"> 686</span></a>
</span><span id="MultisetExpression-687"><a href="#MultisetExpression-687"><span class="linenos"> 687</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-688"><a href="#MultisetExpression-688"><span class="linenos"> 688</span></a>        <span class="o">*</span><span class="n">expressions</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-689"><a href="#MultisetExpression-689"><span class="linenos"> 689</span></a>        <span class="n">evaluator</span><span class="p">:</span> <span class="s1">&#39;icepool.MultisetEvaluator[T_contra, U]&#39;</span>
</span><span id="MultisetExpression-690"><a href="#MultisetExpression-690"><span class="linenos"> 690</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U] | icepool.MultisetEvaluator[T_contra, U]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-691"><a href="#MultisetExpression-691"><span class="linenos"> 691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Attaches a final `MultisetEvaluator` to expressions.</span>
</span><span id="MultisetExpression-692"><a href="#MultisetExpression-692"><span class="linenos"> 692</span></a>
</span><span id="MultisetExpression-693"><a href="#MultisetExpression-693"><span class="linenos"> 693</span></a><span class="sd">        All of the `MultisetExpression` methods below are evaluations,</span>
</span><span id="MultisetExpression-694"><a href="#MultisetExpression-694"><span class="linenos"> 694</span></a><span class="sd">        as are the operators `&lt;, &lt;=, &gt;, &gt;=, !=, ==`. This means if the</span>
</span><span id="MultisetExpression-695"><a href="#MultisetExpression-695"><span class="linenos"> 695</span></a><span class="sd">        expression is fully bound, it will be evaluated to a `Die`.</span>
</span><span id="MultisetExpression-696"><a href="#MultisetExpression-696"><span class="linenos"> 696</span></a>
</span><span id="MultisetExpression-697"><a href="#MultisetExpression-697"><span class="linenos"> 697</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetExpression-698"><a href="#MultisetExpression-698"><span class="linenos"> 698</span></a><span class="sd">            A `Die` if the expression is are fully bound.</span>
</span><span id="MultisetExpression-699"><a href="#MultisetExpression-699"><span class="linenos"> 699</span></a><span class="sd">            A `MultisetEvaluator` otherwise.</span>
</span><span id="MultisetExpression-700"><a href="#MultisetExpression-700"><span class="linenos"> 700</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-701"><a href="#MultisetExpression-701"><span class="linenos"> 701</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="MultisetExpression-702"><a href="#MultisetExpression-702"><span class="linenos"> 702</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">)</span>
</span><span id="MultisetExpression-703"><a href="#MultisetExpression-703"><span class="linenos"> 703</span></a>                <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">):</span>
</span><span id="MultisetExpression-704"><a href="#MultisetExpression-704"><span class="linenos"> 704</span></a>            <span class="k">return</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetExpression-705"><a href="#MultisetExpression-705"><span class="linenos"> 705</span></a>        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ExpressionEvaluator</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span>
</span><span id="MultisetExpression-706"><a href="#MultisetExpression-706"><span class="linenos"> 706</span></a>                                                          <span class="n">evaluator</span><span class="o">=</span><span class="n">evaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-707"><a href="#MultisetExpression-707"><span class="linenos"> 707</span></a>        <span class="k">if</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">_free_arity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MultisetExpression-708"><a href="#MultisetExpression-708"><span class="linenos"> 708</span></a>            <span class="k">return</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="MultisetExpression-709"><a href="#MultisetExpression-709"><span class="linenos"> 709</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-710"><a href="#MultisetExpression-710"><span class="linenos"> 710</span></a>            <span class="k">return</span> <span class="n">evaluator</span>
</span><span id="MultisetExpression-711"><a href="#MultisetExpression-711"><span class="linenos"> 711</span></a>
</span><span id="MultisetExpression-712"><a href="#MultisetExpression-712"><span class="linenos"> 712</span></a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span>
</span><span id="MultisetExpression-713"><a href="#MultisetExpression-713"><span class="linenos"> 713</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-714"><a href="#MultisetExpression-714"><span class="linenos"> 714</span></a>        <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="MultisetExpression-715"><a href="#MultisetExpression-715"><span class="linenos"> 715</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[T_contra, ...]] | icepool.MultisetEvaluator[T_contra, tuple[T_contra, ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-716"><a href="#MultisetExpression-716"><span class="linenos"> 716</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: All elements of the multiset in ascending order.</span>
</span><span id="MultisetExpression-717"><a href="#MultisetExpression-717"><span class="linenos"> 717</span></a>
</span><span id="MultisetExpression-718"><a href="#MultisetExpression-718"><span class="linenos"> 718</span></a><span class="sd">        This is expensive and not recommended unless there are few possibilities.</span>
</span><span id="MultisetExpression-719"><a href="#MultisetExpression-719"><span class="linenos"> 719</span></a>
</span><span id="MultisetExpression-720"><a href="#MultisetExpression-720"><span class="linenos"> 720</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-721"><a href="#MultisetExpression-721"><span class="linenos"> 721</span></a><span class="sd">            order: Whether the elements are in ascending (default) or descending</span>
</span><span id="MultisetExpression-722"><a href="#MultisetExpression-722"><span class="linenos"> 722</span></a><span class="sd">                order.</span>
</span><span id="MultisetExpression-723"><a href="#MultisetExpression-723"><span class="linenos"> 723</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-724"><a href="#MultisetExpression-724"><span class="linenos"> 724</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ExpandEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression-725"><a href="#MultisetExpression-725"><span class="linenos"> 725</span></a>            <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">))</span>
</span><span id="MultisetExpression-726"><a href="#MultisetExpression-726"><span class="linenos"> 726</span></a>
</span><span id="MultisetExpression-727"><a href="#MultisetExpression-727"><span class="linenos"> 727</span></a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span>
</span><span id="MultisetExpression-728"><a href="#MultisetExpression-728"><span class="linenos"> 728</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-729"><a href="#MultisetExpression-729"><span class="linenos"> 729</span></a>        <span class="nb">map</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">U</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MultisetExpression-730"><a href="#MultisetExpression-730"><span class="linenos"> 730</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U] | icepool.MultisetEvaluator[T_contra, U]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-731"><a href="#MultisetExpression-731"><span class="linenos"> 731</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The sum of all elements.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-732"><a href="#MultisetExpression-732"><span class="linenos"> 732</span></a>        <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultisetExpression-733"><a href="#MultisetExpression-733"><span class="linenos"> 733</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">sum_evaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-734"><a href="#MultisetExpression-734"><span class="linenos"> 734</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-735"><a href="#MultisetExpression-735"><span class="linenos"> 735</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">SumEvaluator</span><span class="p">(</span><span class="nb">map</span><span class="p">))</span>
</span><span id="MultisetExpression-736"><a href="#MultisetExpression-736"><span class="linenos"> 736</span></a>
</span><span id="MultisetExpression-737"><a href="#MultisetExpression-737"><span class="linenos"> 737</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span>
</span><span id="MultisetExpression-738"><a href="#MultisetExpression-738"><span class="linenos"> 738</span></a>            <span class="bp">self</span>
</span><span id="MultisetExpression-739"><a href="#MultisetExpression-739"><span class="linenos"> 739</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-740"><a href="#MultisetExpression-740"><span class="linenos"> 740</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The total number of elements in the multiset.</span>
</span><span id="MultisetExpression-741"><a href="#MultisetExpression-741"><span class="linenos"> 741</span></a>
</span><span id="MultisetExpression-742"><a href="#MultisetExpression-742"><span class="linenos"> 742</span></a><span class="sd">        This is usually not very interesting unless some other operation is</span>
</span><span id="MultisetExpression-743"><a href="#MultisetExpression-743"><span class="linenos"> 743</span></a><span class="sd">        performed first. Examples:</span>
</span><span id="MultisetExpression-744"><a href="#MultisetExpression-744"><span class="linenos"> 744</span></a>
</span><span id="MultisetExpression-745"><a href="#MultisetExpression-745"><span class="linenos"> 745</span></a><span class="sd">        `generator.unique().count()` will count the number of unique outcomes.</span>
</span><span id="MultisetExpression-746"><a href="#MultisetExpression-746"><span class="linenos"> 746</span></a>
</span><span id="MultisetExpression-747"><a href="#MultisetExpression-747"><span class="linenos"> 747</span></a><span class="sd">        `(generator &amp; [4, 5, 6]).count()` will count up to one each of</span>
</span><span id="MultisetExpression-748"><a href="#MultisetExpression-748"><span class="linenos"> 748</span></a><span class="sd">        4, 5, and 6.</span>
</span><span id="MultisetExpression-749"><a href="#MultisetExpression-749"><span class="linenos"> 749</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-750"><a href="#MultisetExpression-750"><span class="linenos"> 750</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">count_evaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-751"><a href="#MultisetExpression-751"><span class="linenos"> 751</span></a>
</span><span id="MultisetExpression-752"><a href="#MultisetExpression-752"><span class="linenos"> 752</span></a>    <span class="k">def</span> <span class="nf">any</span><span class="p">(</span>
</span><span id="MultisetExpression-753"><a href="#MultisetExpression-753"><span class="linenos"> 753</span></a>        <span class="bp">self</span>
</span><span id="MultisetExpression-754"><a href="#MultisetExpression-754"><span class="linenos"> 754</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-755"><a href="#MultisetExpression-755"><span class="linenos"> 755</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether the multiset has at least one positive count. &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-756"><a href="#MultisetExpression-756"><span class="linenos"> 756</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">any_evaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-757"><a href="#MultisetExpression-757"><span class="linenos"> 757</span></a>
</span><span id="MultisetExpression-758"><a href="#MultisetExpression-758"><span class="linenos"> 758</span></a>    <span class="k">def</span> <span class="nf">highest_outcome_and_count</span><span class="p">(</span>
</span><span id="MultisetExpression-759"><a href="#MultisetExpression-759"><span class="linenos"> 759</span></a>        <span class="bp">self</span>
</span><span id="MultisetExpression-760"><a href="#MultisetExpression-760"><span class="linenos"> 760</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[T_contra, int]] | icepool.MultisetEvaluator[T_contra, tuple[T_contra, int]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-761"><a href="#MultisetExpression-761"><span class="linenos"> 761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The highest outcome with positive count, along with that count.</span>
</span><span id="MultisetExpression-762"><a href="#MultisetExpression-762"><span class="linenos"> 762</span></a>
</span><span id="MultisetExpression-763"><a href="#MultisetExpression-763"><span class="linenos"> 763</span></a><span class="sd">        If no outcomes have positive count, the min outcome will be returned with 0 count.</span>
</span><span id="MultisetExpression-764"><a href="#MultisetExpression-764"><span class="linenos"> 764</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-765"><a href="#MultisetExpression-765"><span class="linenos"> 765</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-766"><a href="#MultisetExpression-766"><span class="linenos"> 766</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">HighestOutcomeAndCountEvaluator</span><span class="p">())</span>
</span><span id="MultisetExpression-767"><a href="#MultisetExpression-767"><span class="linenos"> 767</span></a>
</span><span id="MultisetExpression-768"><a href="#MultisetExpression-768"><span class="linenos"> 768</span></a>    <span class="k">def</span> <span class="nf">all_counts</span><span class="p">(</span>
</span><span id="MultisetExpression-769"><a href="#MultisetExpression-769"><span class="linenos"> 769</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-770"><a href="#MultisetExpression-770"><span class="linenos"> 770</span></a>        <span class="nb">filter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MultisetExpression-771"><a href="#MultisetExpression-771"><span class="linenos"> 771</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, ...]] | icepool.MultisetEvaluator[T_contra, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-772"><a href="#MultisetExpression-772"><span class="linenos"> 772</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Sorted tuple of all counts, i.e. the sizes of all matching sets.</span>
</span><span id="MultisetExpression-773"><a href="#MultisetExpression-773"><span class="linenos"> 773</span></a>
</span><span id="MultisetExpression-774"><a href="#MultisetExpression-774"><span class="linenos"> 774</span></a><span class="sd">        The sizes are in **descending** order.</span>
</span><span id="MultisetExpression-775"><a href="#MultisetExpression-775"><span class="linenos"> 775</span></a>
</span><span id="MultisetExpression-776"><a href="#MultisetExpression-776"><span class="linenos"> 776</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-777"><a href="#MultisetExpression-777"><span class="linenos"> 777</span></a><span class="sd">            filter: Any counts below this value will not be in the output.</span>
</span><span id="MultisetExpression-778"><a href="#MultisetExpression-778"><span class="linenos"> 778</span></a><span class="sd">                For example, `filter=2` will only produce pairs and better.</span>
</span><span id="MultisetExpression-779"><a href="#MultisetExpression-779"><span class="linenos"> 779</span></a><span class="sd">                If `None`, no filtering will be done.</span>
</span><span id="MultisetExpression-780"><a href="#MultisetExpression-780"><span class="linenos"> 780</span></a>
</span><span id="MultisetExpression-781"><a href="#MultisetExpression-781"><span class="linenos"> 781</span></a><span class="sd">                Why not just place `keep_countss_ge()` before this?</span>
</span><span id="MultisetExpression-782"><a href="#MultisetExpression-782"><span class="linenos"> 782</span></a><span class="sd">                `keep_countss_ge()` operates by setting counts to zero, so you</span>
</span><span id="MultisetExpression-783"><a href="#MultisetExpression-783"><span class="linenos"> 783</span></a><span class="sd">                would still need an argument to specify whether you want to</span>
</span><span id="MultisetExpression-784"><a href="#MultisetExpression-784"><span class="linenos"> 784</span></a><span class="sd">                output zero counts. So we might as well use the argument to do</span>
</span><span id="MultisetExpression-785"><a href="#MultisetExpression-785"><span class="linenos"> 785</span></a><span class="sd">                both.</span>
</span><span id="MultisetExpression-786"><a href="#MultisetExpression-786"><span class="linenos"> 786</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-787"><a href="#MultisetExpression-787"><span class="linenos"> 787</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">AllCountsEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression-788"><a href="#MultisetExpression-788"><span class="linenos"> 788</span></a>            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">))</span>
</span><span id="MultisetExpression-789"><a href="#MultisetExpression-789"><span class="linenos"> 789</span></a>
</span><span id="MultisetExpression-790"><a href="#MultisetExpression-790"><span class="linenos"> 790</span></a>    <span class="k">def</span> <span class="nf">largest_count</span><span class="p">(</span>
</span><span id="MultisetExpression-791"><a href="#MultisetExpression-791"><span class="linenos"> 791</span></a>            <span class="bp">self</span>
</span><span id="MultisetExpression-792"><a href="#MultisetExpression-792"><span class="linenos"> 792</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-793"><a href="#MultisetExpression-793"><span class="linenos"> 793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The size of the largest matching set among the elements.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-794"><a href="#MultisetExpression-794"><span class="linenos"> 794</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-795"><a href="#MultisetExpression-795"><span class="linenos"> 795</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestCountEvaluator</span><span class="p">())</span>
</span><span id="MultisetExpression-796"><a href="#MultisetExpression-796"><span class="linenos"> 796</span></a>
</span><span id="MultisetExpression-797"><a href="#MultisetExpression-797"><span class="linenos"> 797</span></a>    <span class="k">def</span> <span class="nf">largest_count_and_outcome</span><span class="p">(</span>
</span><span id="MultisetExpression-798"><a href="#MultisetExpression-798"><span class="linenos"> 798</span></a>        <span class="bp">self</span>
</span><span id="MultisetExpression-799"><a href="#MultisetExpression-799"><span class="linenos"> 799</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, T_contra]] | icepool.MultisetEvaluator[T_contra, tuple[int, T_contra]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-800"><a href="#MultisetExpression-800"><span class="linenos"> 800</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The largest matching set among the elements and the corresponding outcome.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression-801"><a href="#MultisetExpression-801"><span class="linenos"> 801</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-802"><a href="#MultisetExpression-802"><span class="linenos"> 802</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestCountAndOutcomeEvaluator</span><span class="p">())</span>
</span><span id="MultisetExpression-803"><a href="#MultisetExpression-803"><span class="linenos"> 803</span></a>
</span><span id="MultisetExpression-804"><a href="#MultisetExpression-804"><span class="linenos"> 804</span></a>    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span>
</span><span id="MultisetExpression-805"><a href="#MultisetExpression-805"><span class="linenos"> 805</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-806"><a href="#MultisetExpression-806"><span class="linenos"> 806</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression-807"><a href="#MultisetExpression-807"><span class="linenos"> 807</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-808"><a href="#MultisetExpression-808"><span class="linenos"> 808</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-809"><a href="#MultisetExpression-809"><span class="linenos"> 809</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">count_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetExpression-810"><a href="#MultisetExpression-810"><span class="linenos"> 810</span></a>
</span><span id="MultisetExpression-811"><a href="#MultisetExpression-811"><span class="linenos"> 811</span></a>    <span class="k">def</span> <span class="nf">count_subset</span><span class="p">(</span>
</span><span id="MultisetExpression-812"><a href="#MultisetExpression-812"><span class="linenos"> 812</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-813"><a href="#MultisetExpression-813"><span class="linenos"> 813</span></a>        <span class="n">divisor</span><span class="p">:</span>
</span><span id="MultisetExpression-814"><a href="#MultisetExpression-814"><span class="linenos"> 814</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-815"><a href="#MultisetExpression-815"><span class="linenos"> 815</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="MultisetExpression-816"><a href="#MultisetExpression-816"><span class="linenos"> 816</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-817"><a href="#MultisetExpression-817"><span class="linenos"> 817</span></a>        <span class="n">empty_divisor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MultisetExpression-818"><a href="#MultisetExpression-818"><span class="linenos"> 818</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-819"><a href="#MultisetExpression-819"><span class="linenos"> 819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The number of times the divisor is contained in this multiset.</span>
</span><span id="MultisetExpression-820"><a href="#MultisetExpression-820"><span class="linenos"> 820</span></a><span class="sd">        </span>
</span><span id="MultisetExpression-821"><a href="#MultisetExpression-821"><span class="linenos"> 821</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-822"><a href="#MultisetExpression-822"><span class="linenos"> 822</span></a><span class="sd">            divisor: The multiset to divide by.</span>
</span><span id="MultisetExpression-823"><a href="#MultisetExpression-823"><span class="linenos"> 823</span></a><span class="sd">            empty_divisor: If the divisor is empty, the outcome will be this.</span>
</span><span id="MultisetExpression-824"><a href="#MultisetExpression-824"><span class="linenos"> 824</span></a><span class="sd">                If not set, `ZeroDivisionError` will be raised for an empty</span>
</span><span id="MultisetExpression-825"><a href="#MultisetExpression-825"><span class="linenos"> 825</span></a><span class="sd">                right side.</span>
</span><span id="MultisetExpression-826"><a href="#MultisetExpression-826"><span class="linenos"> 826</span></a>
</span><span id="MultisetExpression-827"><a href="#MultisetExpression-827"><span class="linenos"> 827</span></a><span class="sd">        Raises:</span>
</span><span id="MultisetExpression-828"><a href="#MultisetExpression-828"><span class="linenos"> 828</span></a><span class="sd">            ZeroDivisionError: If the divisor may be empty and </span>
</span><span id="MultisetExpression-829"><a href="#MultisetExpression-829"><span class="linenos"> 829</span></a><span class="sd">                empty_divisor_outcome is not set.</span>
</span><span id="MultisetExpression-830"><a href="#MultisetExpression-830"><span class="linenos"> 830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-831"><a href="#MultisetExpression-831"><span class="linenos"> 831</span></a>        <span class="n">divisor</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">divisor</span><span class="p">)</span>
</span><span id="MultisetExpression-832"><a href="#MultisetExpression-832"><span class="linenos"> 832</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">divisor</span><span class="p">,</span>
</span><span id="MultisetExpression-833"><a href="#MultisetExpression-833"><span class="linenos"> 833</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CountSubsetEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression-834"><a href="#MultisetExpression-834"><span class="linenos"> 834</span></a>                                 <span class="n">empty_divisor</span><span class="o">=</span><span class="n">empty_divisor</span><span class="p">))</span>
</span><span id="MultisetExpression-835"><a href="#MultisetExpression-835"><span class="linenos"> 835</span></a>
</span><span id="MultisetExpression-836"><a href="#MultisetExpression-836"><span class="linenos"> 836</span></a>    <span class="k">def</span> <span class="nf">largest_straight</span><span class="p">(</span>
</span><span id="MultisetExpression-837"><a href="#MultisetExpression-837"><span class="linenos"> 837</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span>
</span><span id="MultisetExpression-838"><a href="#MultisetExpression-838"><span class="linenos"> 838</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[int, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-839"><a href="#MultisetExpression-839"><span class="linenos"> 839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The size of the largest straight among the elements.</span>
</span><span id="MultisetExpression-840"><a href="#MultisetExpression-840"><span class="linenos"> 840</span></a>
</span><span id="MultisetExpression-841"><a href="#MultisetExpression-841"><span class="linenos"> 841</span></a><span class="sd">        Outcomes must be `int`s.</span>
</span><span id="MultisetExpression-842"><a href="#MultisetExpression-842"><span class="linenos"> 842</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-843"><a href="#MultisetExpression-843"><span class="linenos"> 843</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-844"><a href="#MultisetExpression-844"><span class="linenos"> 844</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestStraightEvaluator</span><span class="p">())</span>
</span><span id="MultisetExpression-845"><a href="#MultisetExpression-845"><span class="linenos"> 845</span></a>
</span><span id="MultisetExpression-846"><a href="#MultisetExpression-846"><span class="linenos"> 846</span></a>    <span class="k">def</span> <span class="nf">largest_straight_and_outcome</span><span class="p">(</span>
</span><span id="MultisetExpression-847"><a href="#MultisetExpression-847"><span class="linenos"> 847</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span>
</span><span id="MultisetExpression-848"><a href="#MultisetExpression-848"><span class="linenos"> 848</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, int]] | icepool.MultisetEvaluator[int, tuple[int, int]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-849"><a href="#MultisetExpression-849"><span class="linenos"> 849</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The size of the largest straight among the elements and the highest outcome in that straight.</span>
</span><span id="MultisetExpression-850"><a href="#MultisetExpression-850"><span class="linenos"> 850</span></a>
</span><span id="MultisetExpression-851"><a href="#MultisetExpression-851"><span class="linenos"> 851</span></a><span class="sd">        Outcomes must be `int`s.</span>
</span><span id="MultisetExpression-852"><a href="#MultisetExpression-852"><span class="linenos"> 852</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-853"><a href="#MultisetExpression-853"><span class="linenos"> 853</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-854"><a href="#MultisetExpression-854"><span class="linenos"> 854</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestStraightAndOutcomeEvaluator</span><span class="p">())</span>
</span><span id="MultisetExpression-855"><a href="#MultisetExpression-855"><span class="linenos"> 855</span></a>
</span><span id="MultisetExpression-856"><a href="#MultisetExpression-856"><span class="linenos"> 856</span></a>    <span class="k">def</span> <span class="nf">all_straights</span><span class="p">(</span>
</span><span id="MultisetExpression-857"><a href="#MultisetExpression-857"><span class="linenos"> 857</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span>
</span><span id="MultisetExpression-858"><a href="#MultisetExpression-858"><span class="linenos"> 858</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, ...]] | icepool.MultisetEvaluator[int, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-859"><a href="#MultisetExpression-859"><span class="linenos"> 859</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The sizes of all straights.</span>
</span><span id="MultisetExpression-860"><a href="#MultisetExpression-860"><span class="linenos"> 860</span></a>
</span><span id="MultisetExpression-861"><a href="#MultisetExpression-861"><span class="linenos"> 861</span></a><span class="sd">        The sizes are in **descending** order.</span>
</span><span id="MultisetExpression-862"><a href="#MultisetExpression-862"><span class="linenos"> 862</span></a>
</span><span id="MultisetExpression-863"><a href="#MultisetExpression-863"><span class="linenos"> 863</span></a><span class="sd">        Each element can only contribute to one straight, though duplicate</span>
</span><span id="MultisetExpression-864"><a href="#MultisetExpression-864"><span class="linenos"> 864</span></a><span class="sd">        elements can produces straights that overlap in outcomes. In this case,</span>
</span><span id="MultisetExpression-865"><a href="#MultisetExpression-865"><span class="linenos"> 865</span></a><span class="sd">        elements are preferentially assigned to the longer straight.</span>
</span><span id="MultisetExpression-866"><a href="#MultisetExpression-866"><span class="linenos"> 866</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-867"><a href="#MultisetExpression-867"><span class="linenos"> 867</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-868"><a href="#MultisetExpression-868"><span class="linenos"> 868</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">AllStraightsEvaluator</span><span class="p">())</span>
</span><span id="MultisetExpression-869"><a href="#MultisetExpression-869"><span class="linenos"> 869</span></a>
</span><span id="MultisetExpression-870"><a href="#MultisetExpression-870"><span class="linenos"> 870</span></a>    <span class="k">def</span> <span class="nf">all_straights_reduce_counts</span><span class="p">(</span>
</span><span id="MultisetExpression-871"><a href="#MultisetExpression-871"><span class="linenos"> 871</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-872"><a href="#MultisetExpression-872"><span class="linenos"> 872</span></a>        <span class="n">reducer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span>
</span><span id="MultisetExpression-873"><a href="#MultisetExpression-873"><span class="linenos"> 873</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[tuple[int, int], ...]] | icepool.MultisetEvaluator[int, tuple[tuple[int, int], ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-874"><a href="#MultisetExpression-874"><span class="linenos"> 874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Experimental: All straights with a reduce operation on the counts.</span>
</span><span id="MultisetExpression-875"><a href="#MultisetExpression-875"><span class="linenos"> 875</span></a>
</span><span id="MultisetExpression-876"><a href="#MultisetExpression-876"><span class="linenos"> 876</span></a><span class="sd">        This can be used to evaluate e.g. cribbage-style straight counting.</span>
</span><span id="MultisetExpression-877"><a href="#MultisetExpression-877"><span class="linenos"> 877</span></a>
</span><span id="MultisetExpression-878"><a href="#MultisetExpression-878"><span class="linenos"> 878</span></a><span class="sd">        The result is a tuple of `(run_length, run_score)`s.</span>
</span><span id="MultisetExpression-879"><a href="#MultisetExpression-879"><span class="linenos"> 879</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-880"><a href="#MultisetExpression-880"><span class="linenos"> 880</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression-881"><a href="#MultisetExpression-881"><span class="linenos"> 881</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">AllStraightsReduceCountsEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression-882"><a href="#MultisetExpression-882"><span class="linenos"> 882</span></a>                <span class="n">reducer</span><span class="o">=</span><span class="n">reducer</span><span class="p">))</span>
</span><span id="MultisetExpression-883"><a href="#MultisetExpression-883"><span class="linenos"> 883</span></a>
</span><span id="MultisetExpression-884"><a href="#MultisetExpression-884"><span class="linenos"> 884</span></a>    <span class="k">def</span> <span class="nf">argsort</span><span class="p">(</span>
</span><span id="MultisetExpression-885"><a href="#MultisetExpression-885"><span class="linenos"> 885</span></a>            <span class="bp">self</span><span class="p">:</span>
</span><span id="MultisetExpression-886"><a href="#MultisetExpression-886"><span class="linenos"> 886</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-887"><a href="#MultisetExpression-887"><span class="linenos"> 887</span></a>            <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression-888"><a href="#MultisetExpression-888"><span class="linenos"> 888</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-889"><a href="#MultisetExpression-889"><span class="linenos"> 889</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">,</span>
</span><span id="MultisetExpression-890"><a href="#MultisetExpression-890"><span class="linenos"> 890</span></a>            <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MultisetExpression-891"><a href="#MultisetExpression-891"><span class="linenos"> 891</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Experimental: Returns the indexes of the originating multisets for each rank in their additive union.</span>
</span><span id="MultisetExpression-892"><a href="#MultisetExpression-892"><span class="linenos"> 892</span></a>
</span><span id="MultisetExpression-893"><a href="#MultisetExpression-893"><span class="linenos"> 893</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression-894"><a href="#MultisetExpression-894"><span class="linenos"> 894</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-895"><a href="#MultisetExpression-895"><span class="linenos"> 895</span></a><span class="sd">        MultisetExpression.argsort([10, 9, 5], [9, 9])</span>
</span><span id="MultisetExpression-896"><a href="#MultisetExpression-896"><span class="linenos"> 896</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-897"><a href="#MultisetExpression-897"><span class="linenos"> 897</span></a><span class="sd">        produces</span>
</span><span id="MultisetExpression-898"><a href="#MultisetExpression-898"><span class="linenos"> 898</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-899"><a href="#MultisetExpression-899"><span class="linenos"> 899</span></a><span class="sd">        ((0,), (0, 1, 1), (0,))</span>
</span><span id="MultisetExpression-900"><a href="#MultisetExpression-900"><span class="linenos"> 900</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-901"><a href="#MultisetExpression-901"><span class="linenos"> 901</span></a><span class="sd">        </span>
</span><span id="MultisetExpression-902"><a href="#MultisetExpression-902"><span class="linenos"> 902</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-903"><a href="#MultisetExpression-903"><span class="linenos"> 903</span></a><span class="sd">            self, *args: The multiset expressions to be evaluated.</span>
</span><span id="MultisetExpression-904"><a href="#MultisetExpression-904"><span class="linenos"> 904</span></a><span class="sd">            order: Which order the ranks are to be emitted. Default is descending.</span>
</span><span id="MultisetExpression-905"><a href="#MultisetExpression-905"><span class="linenos"> 905</span></a><span class="sd">            limit: How many ranks to emit. Default will emit all ranks, which</span>
</span><span id="MultisetExpression-906"><a href="#MultisetExpression-906"><span class="linenos"> 906</span></a><span class="sd">                makes the length of each outcome equal to</span>
</span><span id="MultisetExpression-907"><a href="#MultisetExpression-907"><span class="linenos"> 907</span></a><span class="sd">                `additive_union(+self, +arg1, +arg2, ...).unique().count()`</span>
</span><span id="MultisetExpression-908"><a href="#MultisetExpression-908"><span class="linenos"> 908</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-909"><a href="#MultisetExpression-909"><span class="linenos"> 909</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetExpression-910"><a href="#MultisetExpression-910"><span class="linenos"> 910</span></a>        <span class="n">converted_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
</span><span id="MultisetExpression-911"><a href="#MultisetExpression-911"><span class="linenos"> 911</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">converted_args</span><span class="p">,</span>
</span><span id="MultisetExpression-912"><a href="#MultisetExpression-912"><span class="linenos"> 912</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ArgsortEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression-913"><a href="#MultisetExpression-913"><span class="linenos"> 913</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">))</span>
</span><span id="MultisetExpression-914"><a href="#MultisetExpression-914"><span class="linenos"> 914</span></a>
</span><span id="MultisetExpression-915"><a href="#MultisetExpression-915"><span class="linenos"> 915</span></a>    <span class="c1"># Comparators.</span>
</span><span id="MultisetExpression-916"><a href="#MultisetExpression-916"><span class="linenos"> 916</span></a>
</span><span id="MultisetExpression-917"><a href="#MultisetExpression-917"><span class="linenos"> 917</span></a>    <span class="k">def</span> <span class="nf">_compare</span><span class="p">(</span>
</span><span id="MultisetExpression-918"><a href="#MultisetExpression-918"><span class="linenos"> 918</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span>
</span><span id="MultisetExpression-919"><a href="#MultisetExpression-919"><span class="linenos"> 919</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-920"><a href="#MultisetExpression-920"><span class="linenos"> 920</span></a>        <span class="n">operation_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s1">&#39;icepool.evaluator.ComparisonEvaluator&#39;</span><span class="p">]</span>
</span><span id="MultisetExpression-921"><a href="#MultisetExpression-921"><span class="linenos"> 921</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-922"><a href="#MultisetExpression-922"><span class="linenos"> 922</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">MultisetExpression</span><span class="p">):</span>
</span><span id="MultisetExpression-923"><a href="#MultisetExpression-923"><span class="linenos"> 923</span></a>            <span class="n">evaluator</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ExpressionEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression-924"><a href="#MultisetExpression-924"><span class="linenos"> 924</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="n">operation_class</span><span class="p">())</span>
</span><span id="MultisetExpression-925"><a href="#MultisetExpression-925"><span class="linenos"> 925</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="p">(</span><span class="n">Mapping</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)):</span>
</span><span id="MultisetExpression-926"><a href="#MultisetExpression-926"><span class="linenos"> 926</span></a>            <span class="n">right_expression</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
</span><span id="MultisetExpression-927"><a href="#MultisetExpression-927"><span class="linenos"> 927</span></a>            <span class="n">evaluator</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ExpressionEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression-928"><a href="#MultisetExpression-928"><span class="linenos"> 928</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">right_expression</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="n">operation_class</span><span class="p">())</span>
</span><span id="MultisetExpression-929"><a href="#MultisetExpression-929"><span class="linenos"> 929</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-930"><a href="#MultisetExpression-930"><span class="linenos"> 930</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Operand not comparable with expression.&#39;</span><span class="p">)</span>
</span><span id="MultisetExpression-931"><a href="#MultisetExpression-931"><span class="linenos"> 931</span></a>
</span><span id="MultisetExpression-932"><a href="#MultisetExpression-932"><span class="linenos"> 932</span></a>        <span class="k">if</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">_free_arity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MultisetExpression-933"><a href="#MultisetExpression-933"><span class="linenos"> 933</span></a>            <span class="k">return</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="MultisetExpression-934"><a href="#MultisetExpression-934"><span class="linenos"> 934</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression-935"><a href="#MultisetExpression-935"><span class="linenos"> 935</span></a>            <span class="k">return</span> <span class="n">evaluator</span>
</span><span id="MultisetExpression-936"><a href="#MultisetExpression-936"><span class="linenos"> 936</span></a>
</span><span id="MultisetExpression-937"><a href="#MultisetExpression-937"><span class="linenos"> 937</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span>
</span><span id="MultisetExpression-938"><a href="#MultisetExpression-938"><span class="linenos"> 938</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-939"><a href="#MultisetExpression-939"><span class="linenos"> 939</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-940"><a href="#MultisetExpression-940"><span class="linenos"> 940</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-941"><a href="#MultisetExpression-941"><span class="linenos"> 941</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-942"><a href="#MultisetExpression-942"><span class="linenos"> 942</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-943"><a href="#MultisetExpression-943"><span class="linenos"> 943</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-944"><a href="#MultisetExpression-944"><span class="linenos"> 944</span></a>                                 <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsProperSubsetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-945"><a href="#MultisetExpression-945"><span class="linenos"> 945</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MultisetExpression-946"><a href="#MultisetExpression-946"><span class="linenos"> 946</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-947"><a href="#MultisetExpression-947"><span class="linenos"> 947</span></a>
</span><span id="MultisetExpression-948"><a href="#MultisetExpression-948"><span class="linenos"> 948</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span>
</span><span id="MultisetExpression-949"><a href="#MultisetExpression-949"><span class="linenos"> 949</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-950"><a href="#MultisetExpression-950"><span class="linenos"> 950</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-951"><a href="#MultisetExpression-951"><span class="linenos"> 951</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-952"><a href="#MultisetExpression-952"><span class="linenos"> 952</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-953"><a href="#MultisetExpression-953"><span class="linenos"> 953</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-954"><a href="#MultisetExpression-954"><span class="linenos"> 954</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsSubsetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-955"><a href="#MultisetExpression-955"><span class="linenos"> 955</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MultisetExpression-956"><a href="#MultisetExpression-956"><span class="linenos"> 956</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-957"><a href="#MultisetExpression-957"><span class="linenos"> 957</span></a>
</span><span id="MultisetExpression-958"><a href="#MultisetExpression-958"><span class="linenos"> 958</span></a>    <span class="k">def</span> <span class="nf">issubset</span><span class="p">(</span>
</span><span id="MultisetExpression-959"><a href="#MultisetExpression-959"><span class="linenos"> 959</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-960"><a href="#MultisetExpression-960"><span class="linenos"> 960</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-961"><a href="#MultisetExpression-961"><span class="linenos"> 961</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-962"><a href="#MultisetExpression-962"><span class="linenos"> 962</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-963"><a href="#MultisetExpression-963"><span class="linenos"> 963</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether this multiset is a subset of the other multiset.</span>
</span><span id="MultisetExpression-964"><a href="#MultisetExpression-964"><span class="linenos"> 964</span></a>
</span><span id="MultisetExpression-965"><a href="#MultisetExpression-965"><span class="linenos"> 965</span></a><span class="sd">        Specifically, if this multiset has a lesser or equal count for each</span>
</span><span id="MultisetExpression-966"><a href="#MultisetExpression-966"><span class="linenos"> 966</span></a><span class="sd">        outcome than the other multiset, this evaluates to `True`; </span>
</span><span id="MultisetExpression-967"><a href="#MultisetExpression-967"><span class="linenos"> 967</span></a><span class="sd">        if there is some outcome for which this multiset has a greater count </span>
</span><span id="MultisetExpression-968"><a href="#MultisetExpression-968"><span class="linenos"> 968</span></a><span class="sd">        than the other multiset, this evaluates to `False`.</span>
</span><span id="MultisetExpression-969"><a href="#MultisetExpression-969"><span class="linenos"> 969</span></a>
</span><span id="MultisetExpression-970"><a href="#MultisetExpression-970"><span class="linenos"> 970</span></a><span class="sd">        `issubset` is the same as `self &lt;= other`.</span>
</span><span id="MultisetExpression-971"><a href="#MultisetExpression-971"><span class="linenos"> 971</span></a><span class="sd">        </span>
</span><span id="MultisetExpression-972"><a href="#MultisetExpression-972"><span class="linenos"> 972</span></a><span class="sd">        `self &lt; other` evaluates a proper subset relation, which is the same</span>
</span><span id="MultisetExpression-973"><a href="#MultisetExpression-973"><span class="linenos"> 973</span></a><span class="sd">        except the result is `False` if the two multisets are exactly equal.</span>
</span><span id="MultisetExpression-974"><a href="#MultisetExpression-974"><span class="linenos"> 974</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-975"><a href="#MultisetExpression-975"><span class="linenos"> 975</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsSubsetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-976"><a href="#MultisetExpression-976"><span class="linenos"> 976</span></a>
</span><span id="MultisetExpression-977"><a href="#MultisetExpression-977"><span class="linenos"> 977</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span>
</span><span id="MultisetExpression-978"><a href="#MultisetExpression-978"><span class="linenos"> 978</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-979"><a href="#MultisetExpression-979"><span class="linenos"> 979</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-980"><a href="#MultisetExpression-980"><span class="linenos"> 980</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-981"><a href="#MultisetExpression-981"><span class="linenos"> 981</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-982"><a href="#MultisetExpression-982"><span class="linenos"> 982</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-983"><a href="#MultisetExpression-983"><span class="linenos"> 983</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-984"><a href="#MultisetExpression-984"><span class="linenos"> 984</span></a>                                 <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsProperSupersetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-985"><a href="#MultisetExpression-985"><span class="linenos"> 985</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MultisetExpression-986"><a href="#MultisetExpression-986"><span class="linenos"> 986</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-987"><a href="#MultisetExpression-987"><span class="linenos"> 987</span></a>
</span><span id="MultisetExpression-988"><a href="#MultisetExpression-988"><span class="linenos"> 988</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span>
</span><span id="MultisetExpression-989"><a href="#MultisetExpression-989"><span class="linenos"> 989</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-990"><a href="#MultisetExpression-990"><span class="linenos"> 990</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-991"><a href="#MultisetExpression-991"><span class="linenos"> 991</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-992"><a href="#MultisetExpression-992"><span class="linenos"> 992</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-993"><a href="#MultisetExpression-993"><span class="linenos"> 993</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-994"><a href="#MultisetExpression-994"><span class="linenos"> 994</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsSupersetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-995"><a href="#MultisetExpression-995"><span class="linenos"> 995</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MultisetExpression-996"><a href="#MultisetExpression-996"><span class="linenos"> 996</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-997"><a href="#MultisetExpression-997"><span class="linenos"> 997</span></a>
</span><span id="MultisetExpression-998"><a href="#MultisetExpression-998"><span class="linenos"> 998</span></a>    <span class="k">def</span> <span class="nf">issuperset</span><span class="p">(</span>
</span><span id="MultisetExpression-999"><a href="#MultisetExpression-999"><span class="linenos"> 999</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1000"><a href="#MultisetExpression-1000"><span class="linenos">1000</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1001"><a href="#MultisetExpression-1001"><span class="linenos">1001</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-1002"><a href="#MultisetExpression-1002"><span class="linenos">1002</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-1003"><a href="#MultisetExpression-1003"><span class="linenos">1003</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether this multiset is a superset of the other multiset.</span>
</span><span id="MultisetExpression-1004"><a href="#MultisetExpression-1004"><span class="linenos">1004</span></a>
</span><span id="MultisetExpression-1005"><a href="#MultisetExpression-1005"><span class="linenos">1005</span></a><span class="sd">        Specifically, if this multiset has a greater or equal count for each</span>
</span><span id="MultisetExpression-1006"><a href="#MultisetExpression-1006"><span class="linenos">1006</span></a><span class="sd">        outcome than the other multiset, this evaluates to `True`; </span>
</span><span id="MultisetExpression-1007"><a href="#MultisetExpression-1007"><span class="linenos">1007</span></a><span class="sd">        if there is some  outcome for which this multiset has a lesser count </span>
</span><span id="MultisetExpression-1008"><a href="#MultisetExpression-1008"><span class="linenos">1008</span></a><span class="sd">        than the other multiset, this evaluates to `False`.</span>
</span><span id="MultisetExpression-1009"><a href="#MultisetExpression-1009"><span class="linenos">1009</span></a><span class="sd">        </span>
</span><span id="MultisetExpression-1010"><a href="#MultisetExpression-1010"><span class="linenos">1010</span></a><span class="sd">        A typical use of this evaluation is testing for the presence of a</span>
</span><span id="MultisetExpression-1011"><a href="#MultisetExpression-1011"><span class="linenos">1011</span></a><span class="sd">        combo of cards in a hand, e.g.</span>
</span><span id="MultisetExpression-1012"><a href="#MultisetExpression-1012"><span class="linenos">1012</span></a>
</span><span id="MultisetExpression-1013"><a href="#MultisetExpression-1013"><span class="linenos">1013</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-1014"><a href="#MultisetExpression-1014"><span class="linenos">1014</span></a><span class="sd">        deck.deal(5) &gt;= [&#39;a&#39;, &#39;a&#39;, &#39;b&#39;]</span>
</span><span id="MultisetExpression-1015"><a href="#MultisetExpression-1015"><span class="linenos">1015</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-1016"><a href="#MultisetExpression-1016"><span class="linenos">1016</span></a>
</span><span id="MultisetExpression-1017"><a href="#MultisetExpression-1017"><span class="linenos">1017</span></a><span class="sd">        represents the chance that a deal of 5 cards contains at least two &#39;a&#39;s</span>
</span><span id="MultisetExpression-1018"><a href="#MultisetExpression-1018"><span class="linenos">1018</span></a><span class="sd">        and one &#39;b&#39;.</span>
</span><span id="MultisetExpression-1019"><a href="#MultisetExpression-1019"><span class="linenos">1019</span></a>
</span><span id="MultisetExpression-1020"><a href="#MultisetExpression-1020"><span class="linenos">1020</span></a><span class="sd">        `issuperset` is the same as `self &gt;= other`.</span>
</span><span id="MultisetExpression-1021"><a href="#MultisetExpression-1021"><span class="linenos">1021</span></a>
</span><span id="MultisetExpression-1022"><a href="#MultisetExpression-1022"><span class="linenos">1022</span></a><span class="sd">        `self &gt; other` evaluates a proper superset relation, which is the same</span>
</span><span id="MultisetExpression-1023"><a href="#MultisetExpression-1023"><span class="linenos">1023</span></a><span class="sd">        except the result is `False` if the two multisets are exactly equal.</span>
</span><span id="MultisetExpression-1024"><a href="#MultisetExpression-1024"><span class="linenos">1024</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1025"><a href="#MultisetExpression-1025"><span class="linenos">1025</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsSupersetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-1026"><a href="#MultisetExpression-1026"><span class="linenos">1026</span></a>
</span><span id="MultisetExpression-1027"><a href="#MultisetExpression-1027"><span class="linenos">1027</span></a>    <span class="c1"># The result has no truth value.</span>
</span><span id="MultisetExpression-1028"><a href="#MultisetExpression-1028"><span class="linenos">1028</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="MultisetExpression-1029"><a href="#MultisetExpression-1029"><span class="linenos">1029</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1030"><a href="#MultisetExpression-1030"><span class="linenos">1030</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1031"><a href="#MultisetExpression-1031"><span class="linenos">1031</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-1032"><a href="#MultisetExpression-1032"><span class="linenos">1032</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-1033"><a href="#MultisetExpression-1033"><span class="linenos">1033</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-1034"><a href="#MultisetExpression-1034"><span class="linenos">1034</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsEqualSetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-1035"><a href="#MultisetExpression-1035"><span class="linenos">1035</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MultisetExpression-1036"><a href="#MultisetExpression-1036"><span class="linenos">1036</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-1037"><a href="#MultisetExpression-1037"><span class="linenos">1037</span></a>
</span><span id="MultisetExpression-1038"><a href="#MultisetExpression-1038"><span class="linenos">1038</span></a>    <span class="c1"># The result has no truth value.</span>
</span><span id="MultisetExpression-1039"><a href="#MultisetExpression-1039"><span class="linenos">1039</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="MultisetExpression-1040"><a href="#MultisetExpression-1040"><span class="linenos">1040</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1041"><a href="#MultisetExpression-1041"><span class="linenos">1041</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1042"><a href="#MultisetExpression-1042"><span class="linenos">1042</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-1043"><a href="#MultisetExpression-1043"><span class="linenos">1043</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-1044"><a href="#MultisetExpression-1044"><span class="linenos">1044</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="MultisetExpression-1045"><a href="#MultisetExpression-1045"><span class="linenos">1045</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-1046"><a href="#MultisetExpression-1046"><span class="linenos">1046</span></a>                                 <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsNotEqualSetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-1047"><a href="#MultisetExpression-1047"><span class="linenos">1047</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="MultisetExpression-1048"><a href="#MultisetExpression-1048"><span class="linenos">1048</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="MultisetExpression-1049"><a href="#MultisetExpression-1049"><span class="linenos">1049</span></a>
</span><span id="MultisetExpression-1050"><a href="#MultisetExpression-1050"><span class="linenos">1050</span></a>    <span class="k">def</span> <span class="nf">isdisjoint</span><span class="p">(</span>
</span><span id="MultisetExpression-1051"><a href="#MultisetExpression-1051"><span class="linenos">1051</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1052"><a href="#MultisetExpression-1052"><span class="linenos">1052</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1053"><a href="#MultisetExpression-1053"><span class="linenos">1053</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression-1054"><a href="#MultisetExpression-1054"><span class="linenos">1054</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression-1055"><a href="#MultisetExpression-1055"><span class="linenos">1055</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether this multiset is disjoint from the other multiset.</span>
</span><span id="MultisetExpression-1056"><a href="#MultisetExpression-1056"><span class="linenos">1056</span></a><span class="sd">        </span>
</span><span id="MultisetExpression-1057"><a href="#MultisetExpression-1057"><span class="linenos">1057</span></a><span class="sd">        Specifically, this evaluates to `False` if there is any outcome for</span>
</span><span id="MultisetExpression-1058"><a href="#MultisetExpression-1058"><span class="linenos">1058</span></a><span class="sd">        which both multisets have positive count, and `True` if there is not.</span>
</span><span id="MultisetExpression-1059"><a href="#MultisetExpression-1059"><span class="linenos">1059</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1060"><a href="#MultisetExpression-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsDisjointSetEvaluator</span><span class="p">)</span>
</span><span id="MultisetExpression-1061"><a href="#MultisetExpression-1061"><span class="linenos">1061</span></a>
</span><span id="MultisetExpression-1062"><a href="#MultisetExpression-1062"><span class="linenos">1062</span></a>    <span class="k">def</span> <span class="nf">compair_lt</span><span class="p">(</span>
</span><span id="MultisetExpression-1063"><a href="#MultisetExpression-1063"><span class="linenos">1063</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-1064"><a href="#MultisetExpression-1064"><span class="linenos">1064</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1065"><a href="#MultisetExpression-1065"><span class="linenos">1065</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1066"><a href="#MultisetExpression-1066"><span class="linenos">1066</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-1067"><a href="#MultisetExpression-1067"><span class="linenos">1067</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression-1068"><a href="#MultisetExpression-1068"><span class="linenos">1068</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &lt; `other`.</span>
</span><span id="MultisetExpression-1069"><a href="#MultisetExpression-1069"><span class="linenos">1069</span></a>
</span><span id="MultisetExpression-1070"><a href="#MultisetExpression-1070"><span class="linenos">1070</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression-1071"><a href="#MultisetExpression-1071"><span class="linenos">1071</span></a>
</span><span id="MultisetExpression-1072"><a href="#MultisetExpression-1072"><span class="linenos">1072</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-1073"><a href="#MultisetExpression-1073"><span class="linenos">1073</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression-1074"><a href="#MultisetExpression-1074"><span class="linenos">1074</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression-1075"><a href="#MultisetExpression-1075"><span class="linenos">1075</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression-1076"><a href="#MultisetExpression-1076"><span class="linenos">1076</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1077"><a href="#MultisetExpression-1077"><span class="linenos">1077</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-1078"><a href="#MultisetExpression-1078"><span class="linenos">1078</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-1079"><a href="#MultisetExpression-1079"><span class="linenos">1079</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression-1080"><a href="#MultisetExpression-1080"><span class="linenos">1080</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression-1081"><a href="#MultisetExpression-1081"><span class="linenos">1081</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression-1082"><a href="#MultisetExpression-1082"><span class="linenos">1082</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression-1083"><a href="#MultisetExpression-1083"><span class="linenos">1083</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="MultisetExpression-1084"><a href="#MultisetExpression-1084"><span class="linenos">1084</span></a>
</span><span id="MultisetExpression-1085"><a href="#MultisetExpression-1085"><span class="linenos">1085</span></a>    <span class="k">def</span> <span class="nf">compair_le</span><span class="p">(</span>
</span><span id="MultisetExpression-1086"><a href="#MultisetExpression-1086"><span class="linenos">1086</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-1087"><a href="#MultisetExpression-1087"><span class="linenos">1087</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1088"><a href="#MultisetExpression-1088"><span class="linenos">1088</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1089"><a href="#MultisetExpression-1089"><span class="linenos">1089</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-1090"><a href="#MultisetExpression-1090"><span class="linenos">1090</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression-1091"><a href="#MultisetExpression-1091"><span class="linenos">1091</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &lt;= `other`.</span>
</span><span id="MultisetExpression-1092"><a href="#MultisetExpression-1092"><span class="linenos">1092</span></a>
</span><span id="MultisetExpression-1093"><a href="#MultisetExpression-1093"><span class="linenos">1093</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression-1094"><a href="#MultisetExpression-1094"><span class="linenos">1094</span></a>
</span><span id="MultisetExpression-1095"><a href="#MultisetExpression-1095"><span class="linenos">1095</span></a><span class="sd">        Example: number of armies destroyed by the defender in a </span>
</span><span id="MultisetExpression-1096"><a href="#MultisetExpression-1096"><span class="linenos">1096</span></a><span class="sd">        3v2 attack in *RISK*:</span>
</span><span id="MultisetExpression-1097"><a href="#MultisetExpression-1097"><span class="linenos">1097</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-1098"><a href="#MultisetExpression-1098"><span class="linenos">1098</span></a><span class="sd">        d6.pool(3).compair_le(d6.pool(2))</span>
</span><span id="MultisetExpression-1099"><a href="#MultisetExpression-1099"><span class="linenos">1099</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-1100"><a href="#MultisetExpression-1100"><span class="linenos">1100</span></a>
</span><span id="MultisetExpression-1101"><a href="#MultisetExpression-1101"><span class="linenos">1101</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-1102"><a href="#MultisetExpression-1102"><span class="linenos">1102</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression-1103"><a href="#MultisetExpression-1103"><span class="linenos">1103</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression-1104"><a href="#MultisetExpression-1104"><span class="linenos">1104</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression-1105"><a href="#MultisetExpression-1105"><span class="linenos">1105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1106"><a href="#MultisetExpression-1106"><span class="linenos">1106</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-1107"><a href="#MultisetExpression-1107"><span class="linenos">1107</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-1108"><a href="#MultisetExpression-1108"><span class="linenos">1108</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression-1109"><a href="#MultisetExpression-1109"><span class="linenos">1109</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression-1110"><a href="#MultisetExpression-1110"><span class="linenos">1110</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression-1111"><a href="#MultisetExpression-1111"><span class="linenos">1111</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression-1112"><a href="#MultisetExpression-1112"><span class="linenos">1112</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="MultisetExpression-1113"><a href="#MultisetExpression-1113"><span class="linenos">1113</span></a>
</span><span id="MultisetExpression-1114"><a href="#MultisetExpression-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="nf">compair_gt</span><span class="p">(</span>
</span><span id="MultisetExpression-1115"><a href="#MultisetExpression-1115"><span class="linenos">1115</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-1116"><a href="#MultisetExpression-1116"><span class="linenos">1116</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1117"><a href="#MultisetExpression-1117"><span class="linenos">1117</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1118"><a href="#MultisetExpression-1118"><span class="linenos">1118</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-1119"><a href="#MultisetExpression-1119"><span class="linenos">1119</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression-1120"><a href="#MultisetExpression-1120"><span class="linenos">1120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt; `other`.</span>
</span><span id="MultisetExpression-1121"><a href="#MultisetExpression-1121"><span class="linenos">1121</span></a>
</span><span id="MultisetExpression-1122"><a href="#MultisetExpression-1122"><span class="linenos">1122</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression-1123"><a href="#MultisetExpression-1123"><span class="linenos">1123</span></a>
</span><span id="MultisetExpression-1124"><a href="#MultisetExpression-1124"><span class="linenos">1124</span></a><span class="sd">        Example: number of armies destroyed by the attacker in a </span>
</span><span id="MultisetExpression-1125"><a href="#MultisetExpression-1125"><span class="linenos">1125</span></a><span class="sd">        3v2 attack in *RISK*:</span>
</span><span id="MultisetExpression-1126"><a href="#MultisetExpression-1126"><span class="linenos">1126</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression-1127"><a href="#MultisetExpression-1127"><span class="linenos">1127</span></a><span class="sd">        d6.pool(3).compair_gt(d6.pool(2))</span>
</span><span id="MultisetExpression-1128"><a href="#MultisetExpression-1128"><span class="linenos">1128</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression-1129"><a href="#MultisetExpression-1129"><span class="linenos">1129</span></a>
</span><span id="MultisetExpression-1130"><a href="#MultisetExpression-1130"><span class="linenos">1130</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-1131"><a href="#MultisetExpression-1131"><span class="linenos">1131</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression-1132"><a href="#MultisetExpression-1132"><span class="linenos">1132</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression-1133"><a href="#MultisetExpression-1133"><span class="linenos">1133</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression-1134"><a href="#MultisetExpression-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1135"><a href="#MultisetExpression-1135"><span class="linenos">1135</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-1136"><a href="#MultisetExpression-1136"><span class="linenos">1136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-1137"><a href="#MultisetExpression-1137"><span class="linenos">1137</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression-1138"><a href="#MultisetExpression-1138"><span class="linenos">1138</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression-1139"><a href="#MultisetExpression-1139"><span class="linenos">1139</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression-1140"><a href="#MultisetExpression-1140"><span class="linenos">1140</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression-1141"><a href="#MultisetExpression-1141"><span class="linenos">1141</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="MultisetExpression-1142"><a href="#MultisetExpression-1142"><span class="linenos">1142</span></a>
</span><span id="MultisetExpression-1143"><a href="#MultisetExpression-1143"><span class="linenos">1143</span></a>    <span class="k">def</span> <span class="nf">compair_ge</span><span class="p">(</span>
</span><span id="MultisetExpression-1144"><a href="#MultisetExpression-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-1145"><a href="#MultisetExpression-1145"><span class="linenos">1145</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1146"><a href="#MultisetExpression-1146"><span class="linenos">1146</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1147"><a href="#MultisetExpression-1147"><span class="linenos">1147</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-1148"><a href="#MultisetExpression-1148"><span class="linenos">1148</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression-1149"><a href="#MultisetExpression-1149"><span class="linenos">1149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt;= `other`.</span>
</span><span id="MultisetExpression-1150"><a href="#MultisetExpression-1150"><span class="linenos">1150</span></a>
</span><span id="MultisetExpression-1151"><a href="#MultisetExpression-1151"><span class="linenos">1151</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression-1152"><a href="#MultisetExpression-1152"><span class="linenos">1152</span></a>
</span><span id="MultisetExpression-1153"><a href="#MultisetExpression-1153"><span class="linenos">1153</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-1154"><a href="#MultisetExpression-1154"><span class="linenos">1154</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression-1155"><a href="#MultisetExpression-1155"><span class="linenos">1155</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression-1156"><a href="#MultisetExpression-1156"><span class="linenos">1156</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression-1157"><a href="#MultisetExpression-1157"><span class="linenos">1157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1158"><a href="#MultisetExpression-1158"><span class="linenos">1158</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-1159"><a href="#MultisetExpression-1159"><span class="linenos">1159</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-1160"><a href="#MultisetExpression-1160"><span class="linenos">1160</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression-1161"><a href="#MultisetExpression-1161"><span class="linenos">1161</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression-1162"><a href="#MultisetExpression-1162"><span class="linenos">1162</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression-1163"><a href="#MultisetExpression-1163"><span class="linenos">1163</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression-1164"><a href="#MultisetExpression-1164"><span class="linenos">1164</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="MultisetExpression-1165"><a href="#MultisetExpression-1165"><span class="linenos">1165</span></a>
</span><span id="MultisetExpression-1166"><a href="#MultisetExpression-1166"><span class="linenos">1166</span></a>    <span class="k">def</span> <span class="nf">compair_eq</span><span class="p">(</span>
</span><span id="MultisetExpression-1167"><a href="#MultisetExpression-1167"><span class="linenos">1167</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-1168"><a href="#MultisetExpression-1168"><span class="linenos">1168</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1169"><a href="#MultisetExpression-1169"><span class="linenos">1169</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1170"><a href="#MultisetExpression-1170"><span class="linenos">1170</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-1171"><a href="#MultisetExpression-1171"><span class="linenos">1171</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression-1172"><a href="#MultisetExpression-1172"><span class="linenos">1172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt;= `other`.</span>
</span><span id="MultisetExpression-1173"><a href="#MultisetExpression-1173"><span class="linenos">1173</span></a>
</span><span id="MultisetExpression-1174"><a href="#MultisetExpression-1174"><span class="linenos">1174</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression-1175"><a href="#MultisetExpression-1175"><span class="linenos">1175</span></a>
</span><span id="MultisetExpression-1176"><a href="#MultisetExpression-1176"><span class="linenos">1176</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-1177"><a href="#MultisetExpression-1177"><span class="linenos">1177</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression-1178"><a href="#MultisetExpression-1178"><span class="linenos">1178</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression-1179"><a href="#MultisetExpression-1179"><span class="linenos">1179</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression-1180"><a href="#MultisetExpression-1180"><span class="linenos">1180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1181"><a href="#MultisetExpression-1181"><span class="linenos">1181</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-1182"><a href="#MultisetExpression-1182"><span class="linenos">1182</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-1183"><a href="#MultisetExpression-1183"><span class="linenos">1183</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression-1184"><a href="#MultisetExpression-1184"><span class="linenos">1184</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression-1185"><a href="#MultisetExpression-1185"><span class="linenos">1185</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression-1186"><a href="#MultisetExpression-1186"><span class="linenos">1186</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression-1187"><a href="#MultisetExpression-1187"><span class="linenos">1187</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span><span id="MultisetExpression-1188"><a href="#MultisetExpression-1188"><span class="linenos">1188</span></a>
</span><span id="MultisetExpression-1189"><a href="#MultisetExpression-1189"><span class="linenos">1189</span></a>    <span class="k">def</span> <span class="nf">compair_ne</span><span class="p">(</span>
</span><span id="MultisetExpression-1190"><a href="#MultisetExpression-1190"><span class="linenos">1190</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression-1191"><a href="#MultisetExpression-1191"><span class="linenos">1191</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression-1192"><a href="#MultisetExpression-1192"><span class="linenos">1192</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression-1193"><a href="#MultisetExpression-1193"><span class="linenos">1193</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression-1194"><a href="#MultisetExpression-1194"><span class="linenos">1194</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression-1195"><a href="#MultisetExpression-1195"><span class="linenos">1195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt;= `other`.</span>
</span><span id="MultisetExpression-1196"><a href="#MultisetExpression-1196"><span class="linenos">1196</span></a>
</span><span id="MultisetExpression-1197"><a href="#MultisetExpression-1197"><span class="linenos">1197</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression-1198"><a href="#MultisetExpression-1198"><span class="linenos">1198</span></a>
</span><span id="MultisetExpression-1199"><a href="#MultisetExpression-1199"><span class="linenos">1199</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression-1200"><a href="#MultisetExpression-1200"><span class="linenos">1200</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression-1201"><a href="#MultisetExpression-1201"><span class="linenos">1201</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression-1202"><a href="#MultisetExpression-1202"><span class="linenos">1202</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression-1203"><a href="#MultisetExpression-1203"><span class="linenos">1203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression-1204"><a href="#MultisetExpression-1204"><span class="linenos">1204</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression-1205"><a href="#MultisetExpression-1205"><span class="linenos">1205</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression-1206"><a href="#MultisetExpression-1206"><span class="linenos">1206</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression-1207"><a href="#MultisetExpression-1207"><span class="linenos">1207</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression-1208"><a href="#MultisetExpression-1208"><span class="linenos">1208</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression-1209"><a href="#MultisetExpression-1209"><span class="linenos">1209</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression-1210"><a href="#MultisetExpression-1210"><span class="linenos">1210</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base class representing an expression that operates on multisets.</p>

<p>Expression methods can be applied to <code><a href="#MultisetGenerator">MultisetGenerator</a></code>s to do simple
evaluations. For joint evaluations, try <code><a href="#multiset_function">multiset_function</a></code>.</p>

<p>Use the provided operations to build up more complicated
expressions, or to attach a final evaluator.</p>

<p>Operations include:</p>

<table>
<thead>
<tr>
  <th style="text-align:left;">Operation</th>
  <th style="text-align:left;">Count / notes</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.additive_union">additive_union</a></code>, <code>+</code></td>
  <td style="text-align:left;"><code>l + r</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.difference">difference</a></code>, <code>-</code></td>
  <td style="text-align:left;"><code>l - r</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.intersection">intersection</a></code>, <code>&amp;</code></td>
  <td style="text-align:left;"><code>min(l, r)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.union">union</a></code>, <code>|</code></td>
  <td style="text-align:left;"><code>max(l, r)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.symmetric_difference">symmetric_difference</a></code>, <code>^</code></td>
  <td style="text-align:left;"><code>abs(l - r)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.multiply_counts">multiply_counts</a></code>, <code>*</code></td>
  <td style="text-align:left;"><code>count * n</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.divide_counts">divide_counts</a></code>, <code>//</code></td>
  <td style="text-align:left;"><code>count // n</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.modulo_counts">modulo_counts</a></code>, <code>%</code></td>
  <td style="text-align:left;"><code>count % n</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.keep_counts">keep_counts</a></code></td>
  <td style="text-align:left;"><code>count if count &gt;= n else 0</code> etc.</td>
</tr>
<tr>
  <td style="text-align:left;">unary <code>+</code></td>
  <td style="text-align:left;">same as <code>keep_counts_ge(0)</code></td>
</tr>
<tr>
  <td style="text-align:left;">unary <code>-</code></td>
  <td style="text-align:left;">reverses the sign of all counts</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.unique">unique</a></code></td>
  <td style="text-align:left;"><code>min(count, n)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.keep_outcomes">keep_outcomes</a></code></td>
  <td style="text-align:left;"><code>count if outcome in t else 0</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.drop_outcomes">drop_outcomes</a></code></td>
  <td style="text-align:left;"><code>count if outcome not in t else 0</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.map_counts">map_counts</a></code></td>
  <td style="text-align:left;"><code>f(outcome, *counts)</code></td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.keep">keep</a></code>, <code>[]</code></td>
  <td style="text-align:left;">less capable than <code>KeepGenerator</code> version</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.highest">highest</a></code></td>
  <td style="text-align:left;">less capable than <code>KeepGenerator</code> version</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.lowest">lowest</a></code></td>
  <td style="text-align:left;">less capable than <code>KeepGenerator</code> version</td>
</tr>
</tbody>
</table>

<table>
<thead>
<tr>
  <th style="text-align:left;">Evaluator</th>
  <th style="text-align:left;">Summary</th>
</tr>
</thead>
<tbody>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.issubset">issubset</a></code>, <code>&lt;=</code></td>
  <td style="text-align:left;">Whether the left side's counts are all &lt;= their counterparts on the right</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.issuperset">issuperset</a></code>, <code>&gt;=</code></td>
  <td style="text-align:left;">Whether the left side's counts are all &gt;= their counterparts on the right</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.isdisjoint">isdisjoint</a></code></td>
  <td style="text-align:left;">Whether the left side has no positive counts in common with the right side</td>
</tr>
<tr>
  <td style="text-align:left;"><code>&lt;</code></td>
  <td style="text-align:left;">As <code>&lt;=</code>, but <code>False</code> if the two multisets are equal</td>
</tr>
<tr>
  <td style="text-align:left;"><code>&gt;</code></td>
  <td style="text-align:left;">As <code>&gt;=</code>, but <code>False</code> if the two multisets are equal</td>
</tr>
<tr>
  <td style="text-align:left;"><code>==</code></td>
  <td style="text-align:left;">Whether the left side has all the same counts as the right side</td>
</tr>
<tr>
  <td style="text-align:left;"><code>!=</code></td>
  <td style="text-align:left;">Whether the left side has any different counts to the right side</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.expand">expand</a></code></td>
  <td style="text-align:left;">All elements in ascending order</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.sum">sum</a></code></td>
  <td style="text-align:left;">Sum of all elements</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.count">count</a></code></td>
  <td style="text-align:left;">The number of elements</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.any">any</a></code></td>
  <td style="text-align:left;">Whether there is at least 1 element</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.highest_outcome_and_count">highest_outcome_and_count</a></code></td>
  <td style="text-align:left;">The highest outcome and how many of that outcome</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.all_counts">all_counts</a></code></td>
  <td style="text-align:left;">All counts in descending order</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.largest_count">largest_count</a></code></td>
  <td style="text-align:left;">The single largest count, aka x-of-a-kind</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.largest_count_and_outcome">largest_count_and_outcome</a></code></td>
  <td style="text-align:left;">Same but also with the corresponding outcome</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.count_subset">count_subset</a></code>, <code>//</code></td>
  <td style="text-align:left;">The number of times the right side is contained in the left side</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.largest_straight">largest_straight</a></code></td>
  <td style="text-align:left;">Length of longest consecutive sequence</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.largest_straight_and_outcome">largest_straight_and_outcome</a></code></td>
  <td style="text-align:left;">Same but also with the corresponding outcome</td>
</tr>
<tr>
  <td style="text-align:left;"><code><a href="#MultisetExpression.all_straights">all_straights</a></code></td>
  <td style="text-align:left;">Lengths of all consecutive sequences in descending order</td>
</tr>
</tbody>
</table>
</div>


                            <div id="MultisetExpression.order" class="classattr">
                                        <input id="MultisetExpression.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Order">Order</a></span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.order-112"><a href="#MultisetExpression.order-112"><span class="linenos">112</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetExpression.order-113"><a href="#MultisetExpression.order-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="MultisetExpression.order-114"><a href="#MultisetExpression.order-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Any ordering that is required by this expression.</span>
</span><span id="MultisetExpression.order-115"><a href="#MultisetExpression.order-115"><span class="linenos">115</span></a>
</span><span id="MultisetExpression.order-116"><a href="#MultisetExpression.order-116"><span class="linenos">116</span></a><span class="sd">        This should check any previous expressions for their order, and</span>
</span><span id="MultisetExpression.order-117"><a href="#MultisetExpression.order-117"><span class="linenos">117</span></a><span class="sd">        raise a ValueError for any incompatibilities.</span>
</span><span id="MultisetExpression.order-118"><a href="#MultisetExpression.order-118"><span class="linenos">118</span></a>
</span><span id="MultisetExpression.order-119"><a href="#MultisetExpression.order-119"><span class="linenos">119</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetExpression.order-120"><a href="#MultisetExpression.order-120"><span class="linenos">120</span></a><span class="sd">            The required order.</span>
</span><span id="MultisetExpression.order-121"><a href="#MultisetExpression.order-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Any ordering that is required by this expression.</p>

<p>This should check any previous expressions for their order, and
raise a ValueError for any incompatibilities.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The required order.</p>
</blockquote>
</div>


                            </div>
                            <div id="MultisetExpression.additive_union" class="classattr">
                                        <input id="MultisetExpression.additive_union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">additive_union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.additive_union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.additive_union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.additive_union-190"><a href="#MultisetExpression.additive_union-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span>
</span><span id="MultisetExpression.additive_union-191"><a href="#MultisetExpression.additive_union-191"><span class="linenos">191</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression.additive_union-192"><a href="#MultisetExpression.additive_union-192"><span class="linenos">192</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression.additive_union-193"><a href="#MultisetExpression.additive_union-193"><span class="linenos">193</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.additive_union-194"><a href="#MultisetExpression.additive_union-194"><span class="linenos">194</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The combined elements from all of the multisets.</span>
</span><span id="MultisetExpression.additive_union-195"><a href="#MultisetExpression.additive_union-195"><span class="linenos">195</span></a>
</span><span id="MultisetExpression.additive_union-196"><a href="#MultisetExpression.additive_union-196"><span class="linenos">196</span></a><span class="sd">        Same as `a + b + c + ...`.</span>
</span><span id="MultisetExpression.additive_union-197"><a href="#MultisetExpression.additive_union-197"><span class="linenos">197</span></a>
</span><span id="MultisetExpression.additive_union-198"><a href="#MultisetExpression.additive_union-198"><span class="linenos">198</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression.additive_union-199"><a href="#MultisetExpression.additive_union-199"><span class="linenos">199</span></a>
</span><span id="MultisetExpression.additive_union-200"><a href="#MultisetExpression.additive_union-200"><span class="linenos">200</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.additive_union-201"><a href="#MultisetExpression.additive_union-201"><span class="linenos">201</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.additive_union-202"><a href="#MultisetExpression.additive_union-202"><span class="linenos">202</span></a><span class="sd">        [1, 2, 2, 3] + [1, 2, 4] -&gt; [1, 1, 2, 2, 2, 3, 4]</span>
</span><span id="MultisetExpression.additive_union-203"><a href="#MultisetExpression.additive_union-203"><span class="linenos">203</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.additive_union-204"><a href="#MultisetExpression.additive_union-204"><span class="linenos">204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.additive_union-205"><a href="#MultisetExpression.additive_union-205"><span class="linenos">205</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression.additive_union-206"><a href="#MultisetExpression.additive_union-206"><span class="linenos">206</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression.additive_union-207"><a href="#MultisetExpression.additive_union-207"><span class="linenos">207</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">AdditiveUnionExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The combined elements from all of the multisets.</p>

<p>Same as <code>a + b + c + ...</code>.</p>

<p>Any resulting counts that would be negative are set to zero.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="MultisetExpression.difference" class="classattr">
                                        <input id="MultisetExpression.difference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">difference</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.difference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.difference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.difference-227"><a href="#MultisetExpression.difference-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span>
</span><span id="MultisetExpression.difference-228"><a href="#MultisetExpression.difference-228"><span class="linenos">228</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression.difference-229"><a href="#MultisetExpression.difference-229"><span class="linenos">229</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression.difference-230"><a href="#MultisetExpression.difference-230"><span class="linenos">230</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.difference-231"><a href="#MultisetExpression.difference-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The elements from the left multiset that are not in any of the others.</span>
</span><span id="MultisetExpression.difference-232"><a href="#MultisetExpression.difference-232"><span class="linenos">232</span></a>
</span><span id="MultisetExpression.difference-233"><a href="#MultisetExpression.difference-233"><span class="linenos">233</span></a><span class="sd">        Same as `a - b - c - ...`.</span>
</span><span id="MultisetExpression.difference-234"><a href="#MultisetExpression.difference-234"><span class="linenos">234</span></a>
</span><span id="MultisetExpression.difference-235"><a href="#MultisetExpression.difference-235"><span class="linenos">235</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression.difference-236"><a href="#MultisetExpression.difference-236"><span class="linenos">236</span></a>
</span><span id="MultisetExpression.difference-237"><a href="#MultisetExpression.difference-237"><span class="linenos">237</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.difference-238"><a href="#MultisetExpression.difference-238"><span class="linenos">238</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.difference-239"><a href="#MultisetExpression.difference-239"><span class="linenos">239</span></a><span class="sd">        [1, 2, 2, 3] - [1, 2, 4] -&gt; [2, 3]</span>
</span><span id="MultisetExpression.difference-240"><a href="#MultisetExpression.difference-240"><span class="linenos">240</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.difference-241"><a href="#MultisetExpression.difference-241"><span class="linenos">241</span></a>
</span><span id="MultisetExpression.difference-242"><a href="#MultisetExpression.difference-242"><span class="linenos">242</span></a><span class="sd">        If no arguments are given, the result will be an empty multiset, i.e.</span>
</span><span id="MultisetExpression.difference-243"><a href="#MultisetExpression.difference-243"><span class="linenos">243</span></a><span class="sd">        all zero counts.</span>
</span><span id="MultisetExpression.difference-244"><a href="#MultisetExpression.difference-244"><span class="linenos">244</span></a>
</span><span id="MultisetExpression.difference-245"><a href="#MultisetExpression.difference-245"><span class="linenos">245</span></a><span class="sd">        Note that, as a multiset operation, this will only cancel elements 1:1.</span>
</span><span id="MultisetExpression.difference-246"><a href="#MultisetExpression.difference-246"><span class="linenos">246</span></a><span class="sd">        If you want to drop all elements in a set of outcomes regardless of</span>
</span><span id="MultisetExpression.difference-247"><a href="#MultisetExpression.difference-247"><span class="linenos">247</span></a><span class="sd">        count, either use `drop_outcomes()` instead, or use a large number of</span>
</span><span id="MultisetExpression.difference-248"><a href="#MultisetExpression.difference-248"><span class="linenos">248</span></a><span class="sd">        counts on the right side.</span>
</span><span id="MultisetExpression.difference-249"><a href="#MultisetExpression.difference-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.difference-250"><a href="#MultisetExpression.difference-250"><span class="linenos">250</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression.difference-251"><a href="#MultisetExpression.difference-251"><span class="linenos">251</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression.difference-252"><a href="#MultisetExpression.difference-252"><span class="linenos">252</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">DifferenceExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The elements from the left multiset that are not in any of the others.</p>

<p>Same as <code>a - b - c - ...</code>.</p>

<p>Any resulting counts that would be negative are set to zero.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>
</div>

<p>If no arguments are given, the result will be an empty multiset, i.e.
all zero counts.</p>

<p>Note that, as a multiset operation, this will only cancel elements 1:1.
If you want to drop all elements in a set of outcomes regardless of
count, either use <code><a href="#MultisetExpression.drop_outcomes">drop_outcomes()</a></code> instead, or use a large number of
counts on the right side.</p>
</div>


                            </div>
                            <div id="MultisetExpression.intersection" class="classattr">
                                        <input id="MultisetExpression.intersection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">intersection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.intersection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.intersection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.intersection-272"><a href="#MultisetExpression.intersection-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span>
</span><span id="MultisetExpression.intersection-273"><a href="#MultisetExpression.intersection-273"><span class="linenos">273</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression.intersection-274"><a href="#MultisetExpression.intersection-274"><span class="linenos">274</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression.intersection-275"><a href="#MultisetExpression.intersection-275"><span class="linenos">275</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.intersection-276"><a href="#MultisetExpression.intersection-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The elements that all the multisets have in common.</span>
</span><span id="MultisetExpression.intersection-277"><a href="#MultisetExpression.intersection-277"><span class="linenos">277</span></a>
</span><span id="MultisetExpression.intersection-278"><a href="#MultisetExpression.intersection-278"><span class="linenos">278</span></a><span class="sd">        Same as `a &amp; b &amp; c &amp; ...`.</span>
</span><span id="MultisetExpression.intersection-279"><a href="#MultisetExpression.intersection-279"><span class="linenos">279</span></a>
</span><span id="MultisetExpression.intersection-280"><a href="#MultisetExpression.intersection-280"><span class="linenos">280</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression.intersection-281"><a href="#MultisetExpression.intersection-281"><span class="linenos">281</span></a>
</span><span id="MultisetExpression.intersection-282"><a href="#MultisetExpression.intersection-282"><span class="linenos">282</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.intersection-283"><a href="#MultisetExpression.intersection-283"><span class="linenos">283</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.intersection-284"><a href="#MultisetExpression.intersection-284"><span class="linenos">284</span></a><span class="sd">        [1, 2, 2, 3] &amp; [1, 2, 4] -&gt; [1, 2]</span>
</span><span id="MultisetExpression.intersection-285"><a href="#MultisetExpression.intersection-285"><span class="linenos">285</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.intersection-286"><a href="#MultisetExpression.intersection-286"><span class="linenos">286</span></a>
</span><span id="MultisetExpression.intersection-287"><a href="#MultisetExpression.intersection-287"><span class="linenos">287</span></a><span class="sd">        Note that, as a multiset operation, this will only intersect elements</span>
</span><span id="MultisetExpression.intersection-288"><a href="#MultisetExpression.intersection-288"><span class="linenos">288</span></a><span class="sd">        1:1.</span>
</span><span id="MultisetExpression.intersection-289"><a href="#MultisetExpression.intersection-289"><span class="linenos">289</span></a><span class="sd">        If you want to keep all elements in a set of outcomes regardless of</span>
</span><span id="MultisetExpression.intersection-290"><a href="#MultisetExpression.intersection-290"><span class="linenos">290</span></a><span class="sd">        count, either use `keep_outcomes()` instead, or use a large number of</span>
</span><span id="MultisetExpression.intersection-291"><a href="#MultisetExpression.intersection-291"><span class="linenos">291</span></a><span class="sd">        counts on the right side.</span>
</span><span id="MultisetExpression.intersection-292"><a href="#MultisetExpression.intersection-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.intersection-293"><a href="#MultisetExpression.intersection-293"><span class="linenos">293</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression.intersection-294"><a href="#MultisetExpression.intersection-294"><span class="linenos">294</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression.intersection-295"><a href="#MultisetExpression.intersection-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">IntersectionExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The elements that all the multisets have in common.</p>

<p>Same as <code>a &amp; b &amp; c &amp; ...</code>.</p>

<p>Any resulting counts that would be negative are set to zero.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</code></pre>
</div>

<p>Note that, as a multiset operation, this will only intersect elements
1:1.
If you want to keep all elements in a set of outcomes regardless of
count, either use <code><a href="#MultisetExpression.keep_outcomes">keep_outcomes()</a></code> instead, or use a large number of
counts on the right side.</p>
</div>


                            </div>
                            <div id="MultisetExpression.union" class="classattr">
                                        <input id="MultisetExpression.union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.union-315"><a href="#MultisetExpression.union-315"><span class="linenos">315</span></a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span>
</span><span id="MultisetExpression.union-316"><a href="#MultisetExpression.union-316"><span class="linenos">316</span></a>        <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression.union-317"><a href="#MultisetExpression.union-317"><span class="linenos">317</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetExpression.union-318"><a href="#MultisetExpression.union-318"><span class="linenos">318</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.union-319"><a href="#MultisetExpression.union-319"><span class="linenos">319</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The most of each outcome that appear in any of the multisets.</span>
</span><span id="MultisetExpression.union-320"><a href="#MultisetExpression.union-320"><span class="linenos">320</span></a>
</span><span id="MultisetExpression.union-321"><a href="#MultisetExpression.union-321"><span class="linenos">321</span></a><span class="sd">        Same as `a | b | c | ...`.</span>
</span><span id="MultisetExpression.union-322"><a href="#MultisetExpression.union-322"><span class="linenos">322</span></a>
</span><span id="MultisetExpression.union-323"><a href="#MultisetExpression.union-323"><span class="linenos">323</span></a><span class="sd">        Any resulting counts that would be negative are set to zero.</span>
</span><span id="MultisetExpression.union-324"><a href="#MultisetExpression.union-324"><span class="linenos">324</span></a>
</span><span id="MultisetExpression.union-325"><a href="#MultisetExpression.union-325"><span class="linenos">325</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.union-326"><a href="#MultisetExpression.union-326"><span class="linenos">326</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.union-327"><a href="#MultisetExpression.union-327"><span class="linenos">327</span></a><span class="sd">        [1, 2, 2, 3] | [1, 2, 4] -&gt; [1, 2, 2, 3, 4]</span>
</span><span id="MultisetExpression.union-328"><a href="#MultisetExpression.union-328"><span class="linenos">328</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.union-329"><a href="#MultisetExpression.union-329"><span class="linenos">329</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.union-330"><a href="#MultisetExpression.union-330"><span class="linenos">330</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression.union-331"><a href="#MultisetExpression.union-331"><span class="linenos">331</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression.union-332"><a href="#MultisetExpression.union-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">UnionExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The most of each outcome that appear in any of the multisets.</p>

<p>Same as <code>a | b | c | ...</code>.</p>

<p>Any resulting counts that would be negative are set to zero.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">|</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="MultisetExpression.symmetric_difference" class="classattr">
                                        <input id="MultisetExpression.symmetric_difference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">symmetric_difference</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.symmetric_difference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.symmetric_difference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.symmetric_difference-353"><a href="#MultisetExpression.symmetric_difference-353"><span class="linenos">353</span></a>    <span class="k">def</span> <span class="nf">symmetric_difference</span><span class="p">(</span>
</span><span id="MultisetExpression.symmetric_difference-354"><a href="#MultisetExpression.symmetric_difference-354"><span class="linenos">354</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.symmetric_difference-355"><a href="#MultisetExpression.symmetric_difference-355"><span class="linenos">355</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.symmetric_difference-356"><a href="#MultisetExpression.symmetric_difference-356"><span class="linenos">356</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.symmetric_difference-357"><a href="#MultisetExpression.symmetric_difference-357"><span class="linenos">357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The elements that appear in the left or right multiset but not both.</span>
</span><span id="MultisetExpression.symmetric_difference-358"><a href="#MultisetExpression.symmetric_difference-358"><span class="linenos">358</span></a>
</span><span id="MultisetExpression.symmetric_difference-359"><a href="#MultisetExpression.symmetric_difference-359"><span class="linenos">359</span></a><span class="sd">        Same as `a ^ b`.</span>
</span><span id="MultisetExpression.symmetric_difference-360"><a href="#MultisetExpression.symmetric_difference-360"><span class="linenos">360</span></a>
</span><span id="MultisetExpression.symmetric_difference-361"><a href="#MultisetExpression.symmetric_difference-361"><span class="linenos">361</span></a><span class="sd">        Specifically, this produces the absolute difference between counts.</span>
</span><span id="MultisetExpression.symmetric_difference-362"><a href="#MultisetExpression.symmetric_difference-362"><span class="linenos">362</span></a><span class="sd">        If you don&#39;t want negative counts to be used from the inputs, you can</span>
</span><span id="MultisetExpression.symmetric_difference-363"><a href="#MultisetExpression.symmetric_difference-363"><span class="linenos">363</span></a><span class="sd">        do `left.keep_counts(&#39;&gt;=&#39;, 0) ^ right.keep_counts(&#39;&gt;=&#39;, 0)`.</span>
</span><span id="MultisetExpression.symmetric_difference-364"><a href="#MultisetExpression.symmetric_difference-364"><span class="linenos">364</span></a>
</span><span id="MultisetExpression.symmetric_difference-365"><a href="#MultisetExpression.symmetric_difference-365"><span class="linenos">365</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.symmetric_difference-366"><a href="#MultisetExpression.symmetric_difference-366"><span class="linenos">366</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.symmetric_difference-367"><a href="#MultisetExpression.symmetric_difference-367"><span class="linenos">367</span></a><span class="sd">        [1, 2, 2, 3] ^ [1, 2, 4] -&gt; [2, 3, 4]</span>
</span><span id="MultisetExpression.symmetric_difference-368"><a href="#MultisetExpression.symmetric_difference-368"><span class="linenos">368</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.symmetric_difference-369"><a href="#MultisetExpression.symmetric_difference-369"><span class="linenos">369</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.symmetric_difference-370"><a href="#MultisetExpression.symmetric_difference-370"><span class="linenos">370</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.symmetric_difference-371"><a href="#MultisetExpression.symmetric_difference-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">SymmetricDifferenceExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The elements that appear in the left or right multiset but not both.</p>

<p>Same as <code>a ^ b</code>.</p>

<p>Specifically, this produces the absolute difference between counts.
If you don't want negative counts to be used from the inputs, you can
do <code>left.keep_counts('&gt;=', 0) ^ right.keep_counts('&gt;=', 0)</code>.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">^</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="MultisetExpression.keep_outcomes" class="classattr">
                                        <input id="MultisetExpression.keep_outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keep_outcomes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.keep_outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.keep_outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.keep_outcomes-373"><a href="#MultisetExpression.keep_outcomes-373"><span class="linenos">373</span></a>    <span class="k">def</span> <span class="nf">keep_outcomes</span><span class="p">(</span>
</span><span id="MultisetExpression.keep_outcomes-374"><a href="#MultisetExpression.keep_outcomes-374"><span class="linenos">374</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span>
</span><span id="MultisetExpression.keep_outcomes-375"><a href="#MultisetExpression.keep_outcomes-375"><span class="linenos">375</span></a>        <span class="s1">&#39;Callable[[T_contra], bool] | Collection[T_contra] | MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.keep_outcomes-376"><a href="#MultisetExpression.keep_outcomes-376"><span class="linenos">376</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.keep_outcomes-377"><a href="#MultisetExpression.keep_outcomes-377"><span class="linenos">377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keeps the elements in the target set of outcomes, and drops the rest by setting their counts to zero.</span>
</span><span id="MultisetExpression.keep_outcomes-378"><a href="#MultisetExpression.keep_outcomes-378"><span class="linenos">378</span></a>
</span><span id="MultisetExpression.keep_outcomes-379"><a href="#MultisetExpression.keep_outcomes-379"><span class="linenos">379</span></a><span class="sd">        This is similar to `intersection()`, except the right side is considered</span>
</span><span id="MultisetExpression.keep_outcomes-380"><a href="#MultisetExpression.keep_outcomes-380"><span class="linenos">380</span></a><span class="sd">        to have unlimited multiplicity.</span>
</span><span id="MultisetExpression.keep_outcomes-381"><a href="#MultisetExpression.keep_outcomes-381"><span class="linenos">381</span></a>
</span><span id="MultisetExpression.keep_outcomes-382"><a href="#MultisetExpression.keep_outcomes-382"><span class="linenos">382</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.keep_outcomes-383"><a href="#MultisetExpression.keep_outcomes-383"><span class="linenos">383</span></a><span class="sd">            target: A callable returning `True` iff the outcome should be kept,</span>
</span><span id="MultisetExpression.keep_outcomes-384"><a href="#MultisetExpression.keep_outcomes-384"><span class="linenos">384</span></a><span class="sd">                or an expression or collection of outcomes to keep.</span>
</span><span id="MultisetExpression.keep_outcomes-385"><a href="#MultisetExpression.keep_outcomes-385"><span class="linenos">385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.keep_outcomes-386"><a href="#MultisetExpression.keep_outcomes-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">MultisetExpression</span><span class="p">):</span>
</span><span id="MultisetExpression.keep_outcomes-387"><a href="#MultisetExpression.keep_outcomes-387"><span class="linenos">387</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesBinaryExpression</span><span class="p">(</span>
</span><span id="MultisetExpression.keep_outcomes-388"><a href="#MultisetExpression.keep_outcomes-388"><span class="linenos">388</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="MultisetExpression.keep_outcomes-389"><a href="#MultisetExpression.keep_outcomes-389"><span class="linenos">389</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression.keep_outcomes-390"><a href="#MultisetExpression.keep_outcomes-390"><span class="linenos">390</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Keeps the elements in the target set of outcomes, and drops the rest by setting their counts to zero.</p>

<p>This is similar to <code><a href="#MultisetExpression.intersection">intersection()</a></code>, except the right side is considered
to have unlimited multiplicity.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>target:</strong>  A callable returning <code>True</code> iff the outcome should be kept,
or an expression or collection of outcomes to keep.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.drop_outcomes" class="classattr">
                                        <input id="MultisetExpression.drop_outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">drop_outcomes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.drop_outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.drop_outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.drop_outcomes-392"><a href="#MultisetExpression.drop_outcomes-392"><span class="linenos">392</span></a>    <span class="k">def</span> <span class="nf">drop_outcomes</span><span class="p">(</span>
</span><span id="MultisetExpression.drop_outcomes-393"><a href="#MultisetExpression.drop_outcomes-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span>
</span><span id="MultisetExpression.drop_outcomes-394"><a href="#MultisetExpression.drop_outcomes-394"><span class="linenos">394</span></a>        <span class="s1">&#39;Callable[[T_contra], bool] | Collection[T_contra] | MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.drop_outcomes-395"><a href="#MultisetExpression.drop_outcomes-395"><span class="linenos">395</span></a>            <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.drop_outcomes-396"><a href="#MultisetExpression.drop_outcomes-396"><span class="linenos">396</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Drops the elements in the target set of outcomes by setting their counts to zero, and keeps the rest.</span>
</span><span id="MultisetExpression.drop_outcomes-397"><a href="#MultisetExpression.drop_outcomes-397"><span class="linenos">397</span></a>
</span><span id="MultisetExpression.drop_outcomes-398"><a href="#MultisetExpression.drop_outcomes-398"><span class="linenos">398</span></a><span class="sd">        This is similar to `difference()`, except the right side is considered</span>
</span><span id="MultisetExpression.drop_outcomes-399"><a href="#MultisetExpression.drop_outcomes-399"><span class="linenos">399</span></a><span class="sd">        to have unlimited multiplicity.</span>
</span><span id="MultisetExpression.drop_outcomes-400"><a href="#MultisetExpression.drop_outcomes-400"><span class="linenos">400</span></a>
</span><span id="MultisetExpression.drop_outcomes-401"><a href="#MultisetExpression.drop_outcomes-401"><span class="linenos">401</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.drop_outcomes-402"><a href="#MultisetExpression.drop_outcomes-402"><span class="linenos">402</span></a><span class="sd">            target: A callable returning `True` iff the outcome should be</span>
</span><span id="MultisetExpression.drop_outcomes-403"><a href="#MultisetExpression.drop_outcomes-403"><span class="linenos">403</span></a><span class="sd">                dropped, or an expression or collection of outcomes to drop.</span>
</span><span id="MultisetExpression.drop_outcomes-404"><a href="#MultisetExpression.drop_outcomes-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.drop_outcomes-405"><a href="#MultisetExpression.drop_outcomes-405"><span class="linenos">405</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">MultisetExpression</span><span class="p">):</span>
</span><span id="MultisetExpression.drop_outcomes-406"><a href="#MultisetExpression.drop_outcomes-406"><span class="linenos">406</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesBinaryExpression</span><span class="p">(</span>
</span><span id="MultisetExpression.drop_outcomes-407"><a href="#MultisetExpression.drop_outcomes-407"><span class="linenos">407</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MultisetExpression.drop_outcomes-408"><a href="#MultisetExpression.drop_outcomes-408"><span class="linenos">408</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression.drop_outcomes-409"><a href="#MultisetExpression.drop_outcomes-409"><span class="linenos">409</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FilterOutcomesExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.drop_outcomes-410"><a href="#MultisetExpression.drop_outcomes-410"><span class="linenos">410</span></a>                                                               <span class="n">target</span><span class="p">,</span>
</span><span id="MultisetExpression.drop_outcomes-411"><a href="#MultisetExpression.drop_outcomes-411"><span class="linenos">411</span></a>                                                               <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Drops the elements in the target set of outcomes by setting their counts to zero, and keeps the rest.</p>

<p>This is similar to <code><a href="#MultisetExpression.difference">difference()</a></code>, except the right side is considered
to have unlimited multiplicity.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>target:</strong>  A callable returning <code>True</code> iff the outcome should be
dropped, or an expression or collection of outcomes to drop.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.map_counts" class="classattr">
                                        <input id="MultisetExpression.map_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map_counts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.map_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.map_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.map_counts-415"><a href="#MultisetExpression.map_counts-415"><span class="linenos">415</span></a>    <span class="k">def</span> <span class="nf">map_counts</span><span class="p">(</span>
</span><span id="MultisetExpression.map_counts-416"><a href="#MultisetExpression.map_counts-416"><span class="linenos">416</span></a>            <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression.map_counts-417"><a href="#MultisetExpression.map_counts-417"><span class="linenos">417</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.map_counts-418"><a href="#MultisetExpression.map_counts-418"><span class="linenos">418</span></a>            <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.map_counts-419"><a href="#MultisetExpression.map_counts-419"><span class="linenos">419</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps the counts to new counts.</span>
</span><span id="MultisetExpression.map_counts-420"><a href="#MultisetExpression.map_counts-420"><span class="linenos">420</span></a>
</span><span id="MultisetExpression.map_counts-421"><a href="#MultisetExpression.map_counts-421"><span class="linenos">421</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.map_counts-422"><a href="#MultisetExpression.map_counts-422"><span class="linenos">422</span></a><span class="sd">            function: A function that takes `outcome, *counts` and produces a</span>
</span><span id="MultisetExpression.map_counts-423"><a href="#MultisetExpression.map_counts-423"><span class="linenos">423</span></a><span class="sd">                combined count.</span>
</span><span id="MultisetExpression.map_counts-424"><a href="#MultisetExpression.map_counts-424"><span class="linenos">424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.map_counts-425"><a href="#MultisetExpression.map_counts-425"><span class="linenos">425</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetExpression.map_counts-426"><a href="#MultisetExpression.map_counts-426"><span class="linenos">426</span></a>            <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetExpression.map_counts-427"><a href="#MultisetExpression.map_counts-427"><span class="linenos">427</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">MapCountsExpression</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span>
</span><span id="MultisetExpression.map_counts-428"><a href="#MultisetExpression.map_counts-428"><span class="linenos">428</span></a>                                                      <span class="n">function</span><span class="o">=</span><span class="n">function</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Maps the counts to new counts.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>function:</strong>  A function that takes <code>outcome, *counts</code> and produces a
combined count.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.multiply_counts" class="classattr">
                                        <input id="MultisetExpression.multiply_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">multiply_counts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.multiply_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.multiply_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.multiply_counts-441"><a href="#MultisetExpression.multiply_counts-441"><span class="linenos">441</span></a>    <span class="k">def</span> <span class="nf">multiply_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.multiply_counts-442"><a href="#MultisetExpression.multiply_counts-442"><span class="linenos">442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Multiplies all counts by n.</span>
</span><span id="MultisetExpression.multiply_counts-443"><a href="#MultisetExpression.multiply_counts-443"><span class="linenos">443</span></a>
</span><span id="MultisetExpression.multiply_counts-444"><a href="#MultisetExpression.multiply_counts-444"><span class="linenos">444</span></a><span class="sd">        Same as `self * n`.</span>
</span><span id="MultisetExpression.multiply_counts-445"><a href="#MultisetExpression.multiply_counts-445"><span class="linenos">445</span></a>
</span><span id="MultisetExpression.multiply_counts-446"><a href="#MultisetExpression.multiply_counts-446"><span class="linenos">446</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.multiply_counts-447"><a href="#MultisetExpression.multiply_counts-447"><span class="linenos">447</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.multiply_counts-448"><a href="#MultisetExpression.multiply_counts-448"><span class="linenos">448</span></a><span class="sd">        Pool([1, 2, 2, 3]) * 2 -&gt; [1, 1, 2, 2, 2, 2, 3, 3]</span>
</span><span id="MultisetExpression.multiply_counts-449"><a href="#MultisetExpression.multiply_counts-449"><span class="linenos">449</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.multiply_counts-450"><a href="#MultisetExpression.multiply_counts-450"><span class="linenos">450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.multiply_counts-451"><a href="#MultisetExpression.multiply_counts-451"><span class="linenos">451</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">MultiplyCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Multiplies all counts by n.</p>

<p>Same as <code>self * n</code>.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Pool</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="MultisetExpression.divide_counts" class="classattr">
                                        <input id="MultisetExpression.divide_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">divide_counts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.divide_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.divide_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.divide_counts-480"><a href="#MultisetExpression.divide_counts-480"><span class="linenos">480</span></a>    <span class="k">def</span> <span class="nf">divide_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.divide_counts-481"><a href="#MultisetExpression.divide_counts-481"><span class="linenos">481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divides all counts by n (rounding down).</span>
</span><span id="MultisetExpression.divide_counts-482"><a href="#MultisetExpression.divide_counts-482"><span class="linenos">482</span></a>
</span><span id="MultisetExpression.divide_counts-483"><a href="#MultisetExpression.divide_counts-483"><span class="linenos">483</span></a><span class="sd">        Same as `self // n`.</span>
</span><span id="MultisetExpression.divide_counts-484"><a href="#MultisetExpression.divide_counts-484"><span class="linenos">484</span></a>
</span><span id="MultisetExpression.divide_counts-485"><a href="#MultisetExpression.divide_counts-485"><span class="linenos">485</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.divide_counts-486"><a href="#MultisetExpression.divide_counts-486"><span class="linenos">486</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.divide_counts-487"><a href="#MultisetExpression.divide_counts-487"><span class="linenos">487</span></a><span class="sd">        Pool([1, 2, 2, 3]) // 2 -&gt; [2]</span>
</span><span id="MultisetExpression.divide_counts-488"><a href="#MultisetExpression.divide_counts-488"><span class="linenos">488</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.divide_counts-489"><a href="#MultisetExpression.divide_counts-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.divide_counts-490"><a href="#MultisetExpression.divide_counts-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">FloorDivCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Divides all counts by n (rounding down).</p>

<p>Same as <code>self // n</code>.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Pool</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="MultisetExpression.modulo_counts" class="classattr">
                                        <input id="MultisetExpression.modulo_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modulo_counts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.modulo_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.modulo_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.modulo_counts-497"><a href="#MultisetExpression.modulo_counts-497"><span class="linenos">497</span></a>    <span class="k">def</span> <span class="nf">modulo_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.modulo_counts-498"><a href="#MultisetExpression.modulo_counts-498"><span class="linenos">498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Moduos all counts by n.</span>
</span><span id="MultisetExpression.modulo_counts-499"><a href="#MultisetExpression.modulo_counts-499"><span class="linenos">499</span></a>
</span><span id="MultisetExpression.modulo_counts-500"><a href="#MultisetExpression.modulo_counts-500"><span class="linenos">500</span></a><span class="sd">        Same as `self % n`.</span>
</span><span id="MultisetExpression.modulo_counts-501"><a href="#MultisetExpression.modulo_counts-501"><span class="linenos">501</span></a>
</span><span id="MultisetExpression.modulo_counts-502"><a href="#MultisetExpression.modulo_counts-502"><span class="linenos">502</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.modulo_counts-503"><a href="#MultisetExpression.modulo_counts-503"><span class="linenos">503</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.modulo_counts-504"><a href="#MultisetExpression.modulo_counts-504"><span class="linenos">504</span></a><span class="sd">        Pool([1, 2, 2, 3]) % 2 -&gt; [1, 3]</span>
</span><span id="MultisetExpression.modulo_counts-505"><a href="#MultisetExpression.modulo_counts-505"><span class="linenos">505</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.modulo_counts-506"><a href="#MultisetExpression.modulo_counts-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.modulo_counts-507"><a href="#MultisetExpression.modulo_counts-507"><span class="linenos">507</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">%</span> <span class="n">n</span>
</span></pre></div>


            <div class="docstring"><p>Moduos all counts by n.</p>

<p>Same as <code>self % n</code>.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Pool</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="MultisetExpression.keep_counts" class="classattr">
                                        <input id="MultisetExpression.keep_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keep_counts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">]</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.keep_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.keep_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.keep_counts-517"><a href="#MultisetExpression.keep_counts-517"><span class="linenos">517</span></a>    <span class="k">def</span> <span class="nf">keep_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;==&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.keep_counts-518"><a href="#MultisetExpression.keep_counts-518"><span class="linenos">518</span></a>                                              <span class="s1">&#39;&gt;&#39;</span><span class="p">],</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MultisetExpression.keep_counts-519"><a href="#MultisetExpression.keep_counts-519"><span class="linenos">519</span></a>                    <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.keep_counts-520"><a href="#MultisetExpression.keep_counts-520"><span class="linenos">520</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keeps counts fitting the comparison, treating the rest as zero.</span>
</span><span id="MultisetExpression.keep_counts-521"><a href="#MultisetExpression.keep_counts-521"><span class="linenos">521</span></a>
</span><span id="MultisetExpression.keep_counts-522"><a href="#MultisetExpression.keep_counts-522"><span class="linenos">522</span></a><span class="sd">        For example, `expression.keep_counts(&#39;&gt;=&#39;, 2)` would keep pairs,</span>
</span><span id="MultisetExpression.keep_counts-523"><a href="#MultisetExpression.keep_counts-523"><span class="linenos">523</span></a><span class="sd">        triplets, etc. and drop singles.</span>
</span><span id="MultisetExpression.keep_counts-524"><a href="#MultisetExpression.keep_counts-524"><span class="linenos">524</span></a>
</span><span id="MultisetExpression.keep_counts-525"><a href="#MultisetExpression.keep_counts-525"><span class="linenos">525</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.keep_counts-526"><a href="#MultisetExpression.keep_counts-526"><span class="linenos">526</span></a><span class="sd">        Pool([1, 2, 2, 3, 3, 3]).keep_counts(&#39;&gt;=&#39;, 2) -&gt; [2, 2, 3, 3, 3]</span>
</span><span id="MultisetExpression.keep_counts-527"><a href="#MultisetExpression.keep_counts-527"><span class="linenos">527</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.keep_counts-528"><a href="#MultisetExpression.keep_counts-528"><span class="linenos">528</span></a><span class="sd">        </span>
</span><span id="MultisetExpression.keep_counts-529"><a href="#MultisetExpression.keep_counts-529"><span class="linenos">529</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.keep_counts-530"><a href="#MultisetExpression.keep_counts-530"><span class="linenos">530</span></a><span class="sd">            comparison: The comparison to use.</span>
</span><span id="MultisetExpression.keep_counts-531"><a href="#MultisetExpression.keep_counts-531"><span class="linenos">531</span></a><span class="sd">            n: The number to compare counts against.</span>
</span><span id="MultisetExpression.keep_counts-532"><a href="#MultisetExpression.keep_counts-532"><span class="linenos">532</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.keep_counts-533"><a href="#MultisetExpression.keep_counts-533"><span class="linenos">533</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">KeepCountsExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comparison</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Keeps counts fitting the comparison, treating the rest as zero.</p>

<p>For example, <code>expression.keep_counts('&gt;=', 2)</code> would keep pairs,
triplets, etc. and drop singles.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Pool</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">keep_counts</span><span class="p">(</span><span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>comparison:</strong>  The comparison to use.</li>
<li><strong>n:</strong>  The number to compare counts against.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.unique" class="classattr">
                                        <input id="MultisetExpression.unique-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unique</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.unique-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.unique"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.unique-535"><a href="#MultisetExpression.unique-535"><span class="linenos">535</span></a>    <span class="k">def</span> <span class="nf">unique</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.unique-536"><a href="#MultisetExpression.unique-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts each outcome at most `n` times.</span>
</span><span id="MultisetExpression.unique-537"><a href="#MultisetExpression.unique-537"><span class="linenos">537</span></a>
</span><span id="MultisetExpression.unique-538"><a href="#MultisetExpression.unique-538"><span class="linenos">538</span></a><span class="sd">        For example, `generator.unique(2)` would count each outcome at most</span>
</span><span id="MultisetExpression.unique-539"><a href="#MultisetExpression.unique-539"><span class="linenos">539</span></a><span class="sd">        twice.</span>
</span><span id="MultisetExpression.unique-540"><a href="#MultisetExpression.unique-540"><span class="linenos">540</span></a>
</span><span id="MultisetExpression.unique-541"><a href="#MultisetExpression.unique-541"><span class="linenos">541</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.unique-542"><a href="#MultisetExpression.unique-542"><span class="linenos">542</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.unique-543"><a href="#MultisetExpression.unique-543"><span class="linenos">543</span></a><span class="sd">        Pool([1, 2, 2, 3]).unique() -&gt; [1, 2, 3]</span>
</span><span id="MultisetExpression.unique-544"><a href="#MultisetExpression.unique-544"><span class="linenos">544</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.unique-545"><a href="#MultisetExpression.unique-545"><span class="linenos">545</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.unique-546"><a href="#MultisetExpression.unique-546"><span class="linenos">546</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">UniqueExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Counts each outcome at most <code>n</code> times.</p>

<p>For example, <code>generator.unique(2)</code> would count each outcome at most
twice.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Pool</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="MultisetExpression.keep" class="classattr">
                                        <input id="MultisetExpression.keep-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keep</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">index</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">slice</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">ellipsis</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.keep-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.keep"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.keep-562"><a href="#MultisetExpression.keep-562"><span class="linenos">562</span></a>    <span class="k">def</span> <span class="nf">keep</span><span class="p">(</span>
</span><span id="MultisetExpression.keep-563"><a href="#MultisetExpression.keep-563"><span class="linenos">563</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="n">EllipsisType</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span>
</span><span id="MultisetExpression.keep-564"><a href="#MultisetExpression.keep-564"><span class="linenos">564</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra] | icepool.Die[T_contra] | icepool.MultisetEvaluator[T_contra, T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.keep-565"><a href="#MultisetExpression.keep-565"><span class="linenos">565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects elements after drawing and sorting.</span>
</span><span id="MultisetExpression.keep-566"><a href="#MultisetExpression.keep-566"><span class="linenos">566</span></a>
</span><span id="MultisetExpression.keep-567"><a href="#MultisetExpression.keep-567"><span class="linenos">567</span></a><span class="sd">        This is less capable than the `KeepGenerator` version.</span>
</span><span id="MultisetExpression.keep-568"><a href="#MultisetExpression.keep-568"><span class="linenos">568</span></a><span class="sd">        In particular, it does not know how many elements it is selecting from,</span>
</span><span id="MultisetExpression.keep-569"><a href="#MultisetExpression.keep-569"><span class="linenos">569</span></a><span class="sd">        so it must be anchored at the starting end. The advantage is that it</span>
</span><span id="MultisetExpression.keep-570"><a href="#MultisetExpression.keep-570"><span class="linenos">570</span></a><span class="sd">        can be applied to any expression.</span>
</span><span id="MultisetExpression.keep-571"><a href="#MultisetExpression.keep-571"><span class="linenos">571</span></a>
</span><span id="MultisetExpression.keep-572"><a href="#MultisetExpression.keep-572"><span class="linenos">572</span></a><span class="sd">        The valid types of argument are:</span>
</span><span id="MultisetExpression.keep-573"><a href="#MultisetExpression.keep-573"><span class="linenos">573</span></a>
</span><span id="MultisetExpression.keep-574"><a href="#MultisetExpression.keep-574"><span class="linenos">574</span></a><span class="sd">        * A `slice`. If both start and stop are provided, they must both be</span>
</span><span id="MultisetExpression.keep-575"><a href="#MultisetExpression.keep-575"><span class="linenos">575</span></a><span class="sd">            non-negative or both be negative. step is not supported.</span>
</span><span id="MultisetExpression.keep-576"><a href="#MultisetExpression.keep-576"><span class="linenos">576</span></a><span class="sd">        * A sequence of `int` with `...` (`Ellipsis`) at exactly one end.</span>
</span><span id="MultisetExpression.keep-577"><a href="#MultisetExpression.keep-577"><span class="linenos">577</span></a><span class="sd">            Each sorted element will be counted that many times, with the</span>
</span><span id="MultisetExpression.keep-578"><a href="#MultisetExpression.keep-578"><span class="linenos">578</span></a><span class="sd">            `Ellipsis` treated as enough zeros (possibly &quot;negative&quot;) to</span>
</span><span id="MultisetExpression.keep-579"><a href="#MultisetExpression.keep-579"><span class="linenos">579</span></a><span class="sd">            fill the rest of the elements.</span>
</span><span id="MultisetExpression.keep-580"><a href="#MultisetExpression.keep-580"><span class="linenos">580</span></a><span class="sd">        * An `int`, which evaluates by taking the element at the specified</span>
</span><span id="MultisetExpression.keep-581"><a href="#MultisetExpression.keep-581"><span class="linenos">581</span></a><span class="sd">            index. In this case the result is a `Die` (if fully bound) or a</span>
</span><span id="MultisetExpression.keep-582"><a href="#MultisetExpression.keep-582"><span class="linenos">582</span></a><span class="sd">            `MultisetEvaluator` (if there are free variables).</span>
</span><span id="MultisetExpression.keep-583"><a href="#MultisetExpression.keep-583"><span class="linenos">583</span></a>
</span><span id="MultisetExpression.keep-584"><a href="#MultisetExpression.keep-584"><span class="linenos">584</span></a><span class="sd">        Use the `[]` operator for the same effect as this method.</span>
</span><span id="MultisetExpression.keep-585"><a href="#MultisetExpression.keep-585"><span class="linenos">585</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.keep-586"><a href="#MultisetExpression.keep-586"><span class="linenos">586</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MultisetExpression.keep-587"><a href="#MultisetExpression.keep-587"><span class="linenos">587</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.keep-588"><a href="#MultisetExpression.keep-588"><span class="linenos">588</span></a>                <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">KeepEvaluator</span><span class="p">(</span><span class="n">index</span><span class="p">))</span>
</span><span id="MultisetExpression.keep-589"><a href="#MultisetExpression.keep-589"><span class="linenos">589</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression.keep-590"><a href="#MultisetExpression.keep-590"><span class="linenos">590</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">KeepExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Selects elements after drawing and sorting.</p>

<p>This is less capable than the <code>KeepGenerator</code> version.
In particular, it does not know how many elements it is selecting from,
so it must be anchored at the starting end. The advantage is that it
can be applied to any expression.</p>

<p>The valid types of argument are:</p>

<ul>
<li>A <code>slice</code>. If both start and stop are provided, they must both be
non-negative or both be negative. step is not supported.</li>
<li>A sequence of <code>int</code> with <code>...</code> (<code>Ellipsis</code>) at exactly one end.
Each sorted element will be counted that many times, with the
<code>Ellipsis</code> treated as enough zeros (possibly "negative") to
fill the rest of the elements.</li>
<li>An <code>int</code>, which evaluates by taking the element at the specified
index. In this case the result is a <code><a href="#Die">Die</a></code> (if fully bound) or a
<code><a href="#MultisetEvaluator">MultisetEvaluator</a></code> (if there are free variables).</li>
</ul>

<p>Use the <code>[]</code> operator for the same effect as this method.</p>
</div>


                            </div>
                            <div id="MultisetExpression.lowest" class="classattr">
                                        <input id="MultisetExpression.lowest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lowest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.lowest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.lowest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.lowest-609"><a href="#MultisetExpression.lowest-609"><span class="linenos">609</span></a>    <span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.lowest-610"><a href="#MultisetExpression.lowest-610"><span class="linenos">610</span></a>               <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MultisetExpression.lowest-611"><a href="#MultisetExpression.lowest-611"><span class="linenos">611</span></a>               <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.lowest-612"><a href="#MultisetExpression.lowest-612"><span class="linenos">612</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep some of the lowest elements from this multiset and drop the rest.</span>
</span><span id="MultisetExpression.lowest-613"><a href="#MultisetExpression.lowest-613"><span class="linenos">613</span></a>
</span><span id="MultisetExpression.lowest-614"><a href="#MultisetExpression.lowest-614"><span class="linenos">614</span></a><span class="sd">        In contrast to the die and free function versions, this does not</span>
</span><span id="MultisetExpression.lowest-615"><a href="#MultisetExpression.lowest-615"><span class="linenos">615</span></a><span class="sd">        automatically sum the dice. Use `.sum()` afterwards if you want to sum.</span>
</span><span id="MultisetExpression.lowest-616"><a href="#MultisetExpression.lowest-616"><span class="linenos">616</span></a><span class="sd">        Alternatively, you can perform some other evaluation.</span>
</span><span id="MultisetExpression.lowest-617"><a href="#MultisetExpression.lowest-617"><span class="linenos">617</span></a>
</span><span id="MultisetExpression.lowest-618"><a href="#MultisetExpression.lowest-618"><span class="linenos">618</span></a><span class="sd">        This requires the outcomes to be evaluated in ascending order.</span>
</span><span id="MultisetExpression.lowest-619"><a href="#MultisetExpression.lowest-619"><span class="linenos">619</span></a>
</span><span id="MultisetExpression.lowest-620"><a href="#MultisetExpression.lowest-620"><span class="linenos">620</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.lowest-621"><a href="#MultisetExpression.lowest-621"><span class="linenos">621</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="MultisetExpression.lowest-622"><a href="#MultisetExpression.lowest-622"><span class="linenos">622</span></a><span class="sd">                * If neither are provided, the single lowest element</span>
</span><span id="MultisetExpression.lowest-623"><a href="#MultisetExpression.lowest-623"><span class="linenos">623</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression.lowest-624"><a href="#MultisetExpression.lowest-624"><span class="linenos">624</span></a><span class="sd">                * If only `keep` is provided, the `keep` lowest elements</span>
</span><span id="MultisetExpression.lowest-625"><a href="#MultisetExpression.lowest-625"><span class="linenos">625</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression.lowest-626"><a href="#MultisetExpression.lowest-626"><span class="linenos">626</span></a><span class="sd">                * If only `drop` is provided, the `drop` lowest elements</span>
</span><span id="MultisetExpression.lowest-627"><a href="#MultisetExpression.lowest-627"><span class="linenos">627</span></a><span class="sd">                    will be dropped and the rest will be kept.</span>
</span><span id="MultisetExpression.lowest-628"><a href="#MultisetExpression.lowest-628"><span class="linenos">628</span></a><span class="sd">                * If both are provided, `drop` lowest elements will be dropped,</span>
</span><span id="MultisetExpression.lowest-629"><a href="#MultisetExpression.lowest-629"><span class="linenos">629</span></a><span class="sd">                    then the next `keep` lowest elements will be kept.</span>
</span><span id="MultisetExpression.lowest-630"><a href="#MultisetExpression.lowest-630"><span class="linenos">630</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.lowest-631"><a href="#MultisetExpression.lowest-631"><span class="linenos">631</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">lowest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="MultisetExpression.lowest-632"><a href="#MultisetExpression.lowest-632"><span class="linenos">632</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Keep some of the lowest elements from this multiset and drop the rest.</p>

<p>In contrast to the die and free function versions, this does not
automatically sum the dice. Use <code>.sum()</code> afterwards if you want to sum.
Alternatively, you can perform some other evaluation.</p>

<p>This requires the outcomes to be evaluated in ascending order.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>keep, drop:</strong>  These arguments work together:
<ul>
<li>If neither are provided, the single lowest element
will be kept.</li>
<li>If only <code><a href="#MultisetExpression.keep">keep</a></code> is provided, the <code><a href="#MultisetExpression.keep">keep</a></code> lowest elements
will be kept.</li>
<li>If only <code>drop</code> is provided, the <code>drop</code> lowest elements
will be dropped and the rest will be kept.</li>
<li>If both are provided, <code>drop</code> lowest elements will be dropped,
then the next <code><a href="#MultisetExpression.keep">keep</a></code> lowest elements will be kept.</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.highest" class="classattr">
                                        <input id="MultisetExpression.highest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">highest</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.highest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.highest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.highest-634"><a href="#MultisetExpression.highest-634"><span class="linenos">634</span></a>    <span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.highest-635"><a href="#MultisetExpression.highest-635"><span class="linenos">635</span></a>                <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MultisetExpression.highest-636"><a href="#MultisetExpression.highest-636"><span class="linenos">636</span></a>                <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.highest-637"><a href="#MultisetExpression.highest-637"><span class="linenos">637</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Keep some of the highest elements from this multiset and drop the rest.</span>
</span><span id="MultisetExpression.highest-638"><a href="#MultisetExpression.highest-638"><span class="linenos">638</span></a>
</span><span id="MultisetExpression.highest-639"><a href="#MultisetExpression.highest-639"><span class="linenos">639</span></a><span class="sd">        In contrast to the die and free function versions, this does not</span>
</span><span id="MultisetExpression.highest-640"><a href="#MultisetExpression.highest-640"><span class="linenos">640</span></a><span class="sd">        automatically sum the dice. Use `.sum()` afterwards if you want to sum.</span>
</span><span id="MultisetExpression.highest-641"><a href="#MultisetExpression.highest-641"><span class="linenos">641</span></a><span class="sd">        Alternatively, you can perform some other evaluation.</span>
</span><span id="MultisetExpression.highest-642"><a href="#MultisetExpression.highest-642"><span class="linenos">642</span></a>
</span><span id="MultisetExpression.highest-643"><a href="#MultisetExpression.highest-643"><span class="linenos">643</span></a><span class="sd">        This requires the outcomes to be evaluated in descending order.</span>
</span><span id="MultisetExpression.highest-644"><a href="#MultisetExpression.highest-644"><span class="linenos">644</span></a>
</span><span id="MultisetExpression.highest-645"><a href="#MultisetExpression.highest-645"><span class="linenos">645</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.highest-646"><a href="#MultisetExpression.highest-646"><span class="linenos">646</span></a><span class="sd">            keep, drop: These arguments work together:</span>
</span><span id="MultisetExpression.highest-647"><a href="#MultisetExpression.highest-647"><span class="linenos">647</span></a><span class="sd">                * If neither are provided, the single highest element</span>
</span><span id="MultisetExpression.highest-648"><a href="#MultisetExpression.highest-648"><span class="linenos">648</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression.highest-649"><a href="#MultisetExpression.highest-649"><span class="linenos">649</span></a><span class="sd">                * If only `keep` is provided, the `keep` highest elements</span>
</span><span id="MultisetExpression.highest-650"><a href="#MultisetExpression.highest-650"><span class="linenos">650</span></a><span class="sd">                    will be kept.</span>
</span><span id="MultisetExpression.highest-651"><a href="#MultisetExpression.highest-651"><span class="linenos">651</span></a><span class="sd">                * If only `drop` is provided, the `drop` highest elements</span>
</span><span id="MultisetExpression.highest-652"><a href="#MultisetExpression.highest-652"><span class="linenos">652</span></a><span class="sd">                    will be dropped and the rest will be kept.</span>
</span><span id="MultisetExpression.highest-653"><a href="#MultisetExpression.highest-653"><span class="linenos">653</span></a><span class="sd">                * If both are provided, `drop` highest elements will be dropped, </span>
</span><span id="MultisetExpression.highest-654"><a href="#MultisetExpression.highest-654"><span class="linenos">654</span></a><span class="sd">                    then the next `keep` highest elements will be kept.</span>
</span><span id="MultisetExpression.highest-655"><a href="#MultisetExpression.highest-655"><span class="linenos">655</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.highest-656"><a href="#MultisetExpression.highest-656"><span class="linenos">656</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">highest_slice</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">drop</span><span class="p">)</span>
</span><span id="MultisetExpression.highest-657"><a href="#MultisetExpression.highest-657"><span class="linenos">657</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Keep some of the highest elements from this multiset and drop the rest.</p>

<p>In contrast to the die and free function versions, this does not
automatically sum the dice. Use <code>.sum()</code> afterwards if you want to sum.
Alternatively, you can perform some other evaluation.</p>

<p>This requires the outcomes to be evaluated in descending order.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>keep, drop:</strong>  These arguments work together:
<ul>
<li>If neither are provided, the single highest element
will be kept.</li>
<li>If only <code><a href="#MultisetExpression.keep">keep</a></code> is provided, the <code><a href="#MultisetExpression.keep">keep</a></code> highest elements
will be kept.</li>
<li>If only <code>drop</code> is provided, the <code>drop</code> highest elements
will be dropped and the rest will be kept.</li>
<li>If both are provided, <code>drop</code> highest elements will be dropped, 
then the next <code><a href="#MultisetExpression.keep">keep</a></code> highest elements will be kept.</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.pair_le" class="classattr">
                                        <input id="MultisetExpression.pair_le-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pair_le</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">keep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.pair_le-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.pair_le"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.pair_le-661"><a href="#MultisetExpression.pair_le-661"><span class="linenos">661</span></a>    <span class="k">def</span> <span class="nf">pair_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.pair_le-662"><a href="#MultisetExpression.pair_le-662"><span class="linenos">662</span></a>                <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.pair_le-663"><a href="#MultisetExpression.pair_le-663"><span class="linenos">663</span></a>                <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.pair_le-664"><a href="#MultisetExpression.pair_le-664"><span class="linenos">664</span></a>                <span class="n">keep</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="MultisetExpression.pair_le-665"><a href="#MultisetExpression.pair_le-665"><span class="linenos">665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Make pairs of elements such that `self &lt;= other`, then keep or drop the paired elements from `self`.</span>
</span><span id="MultisetExpression.pair_le-666"><a href="#MultisetExpression.pair_le-666"><span class="linenos">666</span></a><span class="sd">        </span>
</span><span id="MultisetExpression.pair_le-667"><a href="#MultisetExpression.pair_le-667"><span class="linenos">667</span></a><span class="sd">        First, make as many pairs of one element of `self` and one element of</span>
</span><span id="MultisetExpression.pair_le-668"><a href="#MultisetExpression.pair_le-668"><span class="linenos">668</span></a><span class="sd">        `other` such that:</span>
</span><span id="MultisetExpression.pair_le-669"><a href="#MultisetExpression.pair_le-669"><span class="linenos">669</span></a><span class="sd">        * In each pair, the element from `self` &lt;= the element from `other`.</span>
</span><span id="MultisetExpression.pair_le-670"><a href="#MultisetExpression.pair_le-670"><span class="linenos">670</span></a><span class="sd">        * The element from `self` is as great as possible otherwise.</span>
</span><span id="MultisetExpression.pair_le-671"><a href="#MultisetExpression.pair_le-671"><span class="linenos">671</span></a><span class="sd">        Keep the elements from `self` that were paired and drop the rest.</span>
</span><span id="MultisetExpression.pair_le-672"><a href="#MultisetExpression.pair_le-672"><span class="linenos">672</span></a>
</span><span id="MultisetExpression.pair_le-673"><a href="#MultisetExpression.pair_le-673"><span class="linenos">673</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.pair_le-674"><a href="#MultisetExpression.pair_le-674"><span class="linenos">674</span></a><span class="sd">            other: The other multiset to pair elements with.</span>
</span><span id="MultisetExpression.pair_le-675"><a href="#MultisetExpression.pair_le-675"><span class="linenos">675</span></a><span class="sd">            keep: If `True` (default), the paired elements from `self` will be</span>
</span><span id="MultisetExpression.pair_le-676"><a href="#MultisetExpression.pair_le-676"><span class="linenos">676</span></a><span class="sd">                kept. Otherwise, the unpaired elements will be kept.</span>
</span><span id="MultisetExpression.pair_le-677"><a href="#MultisetExpression.pair_le-677"><span class="linenos">677</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.pair_le-678"><a href="#MultisetExpression.pair_le-678"><span class="linenos">678</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.pair_le-679"><a href="#MultisetExpression.pair_le-679"><span class="linenos">679</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expression</span><span class="o">.</span><span class="n">PairKeepExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.pair_le-680"><a href="#MultisetExpression.pair_le-680"><span class="linenos">680</span></a>                                                     <span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression.pair_le-681"><a href="#MultisetExpression.pair_le-681"><span class="linenos">681</span></a>                                                     <span class="n">order</span><span class="o">=</span><span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">,</span>
</span><span id="MultisetExpression.pair_le-682"><a href="#MultisetExpression.pair_le-682"><span class="linenos">682</span></a>                                                     <span class="n">allow_equal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="MultisetExpression.pair_le-683"><a href="#MultisetExpression.pair_le-683"><span class="linenos">683</span></a>                                                     <span class="n">keep</span><span class="o">=</span><span class="n">keep</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Make pairs of elements such that <code>self &lt;= other</code>, then keep or drop the paired elements from <code>self</code>.</p>

<p>First, make as many pairs of one element of <code>self</code> and one element of
<code>other</code> such that:</p>

<ul>
<li>In each pair, the element from <code>self</code> &lt;= the element from <code>other</code>.</li>
<li>The element from <code>self</code> is as great as possible otherwise.
Keep the elements from <code>self</code> that were paired and drop the rest.</li>
</ul>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>other:</strong>  The other multiset to pair elements with.</li>
<li><strong>keep:</strong>  If <code>True</code> (default), the paired elements from <code>self</code> will be
kept. Otherwise, the unpaired elements will be kept.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.evaluate" class="classattr">
                                        <input id="MultisetExpression.evaluate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evaluate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">expressions</span><span class="p">:</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>,</span><span class="param">	<span class="n">evaluator</span><span class="p">:</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.evaluate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.evaluate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.evaluate-687"><a href="#MultisetExpression.evaluate-687"><span class="linenos">687</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.evaluate-688"><a href="#MultisetExpression.evaluate-688"><span class="linenos">688</span></a>        <span class="o">*</span><span class="n">expressions</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.evaluate-689"><a href="#MultisetExpression.evaluate-689"><span class="linenos">689</span></a>        <span class="n">evaluator</span><span class="p">:</span> <span class="s1">&#39;icepool.MultisetEvaluator[T_contra, U]&#39;</span>
</span><span id="MultisetExpression.evaluate-690"><a href="#MultisetExpression.evaluate-690"><span class="linenos">690</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U] | icepool.MultisetEvaluator[T_contra, U]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.evaluate-691"><a href="#MultisetExpression.evaluate-691"><span class="linenos">691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Attaches a final `MultisetEvaluator` to expressions.</span>
</span><span id="MultisetExpression.evaluate-692"><a href="#MultisetExpression.evaluate-692"><span class="linenos">692</span></a>
</span><span id="MultisetExpression.evaluate-693"><a href="#MultisetExpression.evaluate-693"><span class="linenos">693</span></a><span class="sd">        All of the `MultisetExpression` methods below are evaluations,</span>
</span><span id="MultisetExpression.evaluate-694"><a href="#MultisetExpression.evaluate-694"><span class="linenos">694</span></a><span class="sd">        as are the operators `&lt;, &lt;=, &gt;, &gt;=, !=, ==`. This means if the</span>
</span><span id="MultisetExpression.evaluate-695"><a href="#MultisetExpression.evaluate-695"><span class="linenos">695</span></a><span class="sd">        expression is fully bound, it will be evaluated to a `Die`.</span>
</span><span id="MultisetExpression.evaluate-696"><a href="#MultisetExpression.evaluate-696"><span class="linenos">696</span></a>
</span><span id="MultisetExpression.evaluate-697"><a href="#MultisetExpression.evaluate-697"><span class="linenos">697</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetExpression.evaluate-698"><a href="#MultisetExpression.evaluate-698"><span class="linenos">698</span></a><span class="sd">            A `Die` if the expression is are fully bound.</span>
</span><span id="MultisetExpression.evaluate-699"><a href="#MultisetExpression.evaluate-699"><span class="linenos">699</span></a><span class="sd">            A `MultisetEvaluator` otherwise.</span>
</span><span id="MultisetExpression.evaluate-700"><a href="#MultisetExpression.evaluate-700"><span class="linenos">700</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.evaluate-701"><a href="#MultisetExpression.evaluate-701"><span class="linenos">701</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="MultisetExpression.evaluate-702"><a href="#MultisetExpression.evaluate-702"><span class="linenos">702</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">)</span>
</span><span id="MultisetExpression.evaluate-703"><a href="#MultisetExpression.evaluate-703"><span class="linenos">703</span></a>                <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">):</span>
</span><span id="MultisetExpression.evaluate-704"><a href="#MultisetExpression.evaluate-704"><span class="linenos">704</span></a>            <span class="k">return</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetExpression.evaluate-705"><a href="#MultisetExpression.evaluate-705"><span class="linenos">705</span></a>        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ExpressionEvaluator</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span>
</span><span id="MultisetExpression.evaluate-706"><a href="#MultisetExpression.evaluate-706"><span class="linenos">706</span></a>                                                          <span class="n">evaluator</span><span class="o">=</span><span class="n">evaluator</span><span class="p">)</span>
</span><span id="MultisetExpression.evaluate-707"><a href="#MultisetExpression.evaluate-707"><span class="linenos">707</span></a>        <span class="k">if</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">_free_arity</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MultisetExpression.evaluate-708"><a href="#MultisetExpression.evaluate-708"><span class="linenos">708</span></a>            <span class="k">return</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="MultisetExpression.evaluate-709"><a href="#MultisetExpression.evaluate-709"><span class="linenos">709</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression.evaluate-710"><a href="#MultisetExpression.evaluate-710"><span class="linenos">710</span></a>            <span class="k">return</span> <span class="n">evaluator</span>
</span></pre></div>


            <div class="docstring"><p>Attaches a final <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code> to expressions.</p>

<p>All of the <code><a href="#MultisetExpression">MultisetExpression</a></code> methods below are evaluations,
as are the operators <code>&lt;, &lt;=, &gt;, &gt;=, !=, ==</code>. This means if the
expression is fully bound, it will be evaluated to a <code><a href="#Die">Die</a></code>.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> if the expression is are fully bound.
  A <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code> otherwise.</p>
</blockquote>
</div>


                            </div>
                            <div id="MultisetExpression.expand" class="classattr">
                                        <input id="MultisetExpression.expand-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">expand</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Ascending">Order.Ascending</a></span><span class="p">:</span> <span class="mi">1</span><span class="o">&gt;</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.expand-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.expand"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.expand-712"><a href="#MultisetExpression.expand-712"><span class="linenos">712</span></a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span>
</span><span id="MultisetExpression.expand-713"><a href="#MultisetExpression.expand-713"><span class="linenos">713</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.expand-714"><a href="#MultisetExpression.expand-714"><span class="linenos">714</span></a>        <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="MultisetExpression.expand-715"><a href="#MultisetExpression.expand-715"><span class="linenos">715</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[T_contra, ...]] | icepool.MultisetEvaluator[T_contra, tuple[T_contra, ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.expand-716"><a href="#MultisetExpression.expand-716"><span class="linenos">716</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: All elements of the multiset in ascending order.</span>
</span><span id="MultisetExpression.expand-717"><a href="#MultisetExpression.expand-717"><span class="linenos">717</span></a>
</span><span id="MultisetExpression.expand-718"><a href="#MultisetExpression.expand-718"><span class="linenos">718</span></a><span class="sd">        This is expensive and not recommended unless there are few possibilities.</span>
</span><span id="MultisetExpression.expand-719"><a href="#MultisetExpression.expand-719"><span class="linenos">719</span></a>
</span><span id="MultisetExpression.expand-720"><a href="#MultisetExpression.expand-720"><span class="linenos">720</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.expand-721"><a href="#MultisetExpression.expand-721"><span class="linenos">721</span></a><span class="sd">            order: Whether the elements are in ascending (default) or descending</span>
</span><span id="MultisetExpression.expand-722"><a href="#MultisetExpression.expand-722"><span class="linenos">722</span></a><span class="sd">                order.</span>
</span><span id="MultisetExpression.expand-723"><a href="#MultisetExpression.expand-723"><span class="linenos">723</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.expand-724"><a href="#MultisetExpression.expand-724"><span class="linenos">724</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ExpandEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression.expand-725"><a href="#MultisetExpression.expand-725"><span class="linenos">725</span></a>            <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: All elements of the multiset in ascending order.</p>

<p>This is expensive and not recommended unless there are few possibilities.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>order:</strong>  Whether the elements are in ascending (default) or descending
order.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.sum" class="classattr">
                                        <input id="MultisetExpression.sum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sum</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="nb">map</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">~</span><span class="n">U</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.sum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.sum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.sum-727"><a href="#MultisetExpression.sum-727"><span class="linenos">727</span></a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span>
</span><span id="MultisetExpression.sum-728"><a href="#MultisetExpression.sum-728"><span class="linenos">728</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.sum-729"><a href="#MultisetExpression.sum-729"><span class="linenos">729</span></a>        <span class="nb">map</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">U</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MultisetExpression.sum-730"><a href="#MultisetExpression.sum-730"><span class="linenos">730</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U] | icepool.MultisetEvaluator[T_contra, U]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.sum-731"><a href="#MultisetExpression.sum-731"><span class="linenos">731</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The sum of all elements.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression.sum-732"><a href="#MultisetExpression.sum-732"><span class="linenos">732</span></a>        <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultisetExpression.sum-733"><a href="#MultisetExpression.sum-733"><span class="linenos">733</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">sum_evaluator</span><span class="p">)</span>
</span><span id="MultisetExpression.sum-734"><a href="#MultisetExpression.sum-734"><span class="linenos">734</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetExpression.sum-735"><a href="#MultisetExpression.sum-735"><span class="linenos">735</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">SumEvaluator</span><span class="p">(</span><span class="nb">map</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The sum of all elements.</p>
</div>


                            </div>
                            <div id="MultisetExpression.count" class="classattr">
                                        <input id="MultisetExpression.count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.count-737"><a href="#MultisetExpression.count-737"><span class="linenos">737</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span>
</span><span id="MultisetExpression.count-738"><a href="#MultisetExpression.count-738"><span class="linenos">738</span></a>            <span class="bp">self</span>
</span><span id="MultisetExpression.count-739"><a href="#MultisetExpression.count-739"><span class="linenos">739</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.count-740"><a href="#MultisetExpression.count-740"><span class="linenos">740</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The total number of elements in the multiset.</span>
</span><span id="MultisetExpression.count-741"><a href="#MultisetExpression.count-741"><span class="linenos">741</span></a>
</span><span id="MultisetExpression.count-742"><a href="#MultisetExpression.count-742"><span class="linenos">742</span></a><span class="sd">        This is usually not very interesting unless some other operation is</span>
</span><span id="MultisetExpression.count-743"><a href="#MultisetExpression.count-743"><span class="linenos">743</span></a><span class="sd">        performed first. Examples:</span>
</span><span id="MultisetExpression.count-744"><a href="#MultisetExpression.count-744"><span class="linenos">744</span></a>
</span><span id="MultisetExpression.count-745"><a href="#MultisetExpression.count-745"><span class="linenos">745</span></a><span class="sd">        `generator.unique().count()` will count the number of unique outcomes.</span>
</span><span id="MultisetExpression.count-746"><a href="#MultisetExpression.count-746"><span class="linenos">746</span></a>
</span><span id="MultisetExpression.count-747"><a href="#MultisetExpression.count-747"><span class="linenos">747</span></a><span class="sd">        `(generator &amp; [4, 5, 6]).count()` will count up to one each of</span>
</span><span id="MultisetExpression.count-748"><a href="#MultisetExpression.count-748"><span class="linenos">748</span></a><span class="sd">        4, 5, and 6.</span>
</span><span id="MultisetExpression.count-749"><a href="#MultisetExpression.count-749"><span class="linenos">749</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.count-750"><a href="#MultisetExpression.count-750"><span class="linenos">750</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">count_evaluator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The total number of elements in the multiset.</p>

<p>This is usually not very interesting unless some other operation is
performed first. Examples:</p>

<p><code>generator.unique().count()</code> will count the number of unique outcomes.</p>

<p><code>(generator &amp; [4, 5, 6]).count()</code> will count up to one each of
4, 5, and 6.</p>
</div>


                            </div>
                            <div id="MultisetExpression.any" class="classattr">
                                        <input id="MultisetExpression.any-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">any</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.any-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.any"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.any-752"><a href="#MultisetExpression.any-752"><span class="linenos">752</span></a>    <span class="k">def</span> <span class="nf">any</span><span class="p">(</span>
</span><span id="MultisetExpression.any-753"><a href="#MultisetExpression.any-753"><span class="linenos">753</span></a>        <span class="bp">self</span>
</span><span id="MultisetExpression.any-754"><a href="#MultisetExpression.any-754"><span class="linenos">754</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.any-755"><a href="#MultisetExpression.any-755"><span class="linenos">755</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether the multiset has at least one positive count. &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.any-756"><a href="#MultisetExpression.any-756"><span class="linenos">756</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">any_evaluator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: Whether the multiset has at least one positive count.</p>
</div>


                            </div>
                            <div id="MultisetExpression.highest_outcome_and_count" class="classattr">
                                        <input id="MultisetExpression.highest_outcome_and_count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">highest_outcome_and_count</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.highest_outcome_and_count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.highest_outcome_and_count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.highest_outcome_and_count-758"><a href="#MultisetExpression.highest_outcome_and_count-758"><span class="linenos">758</span></a>    <span class="k">def</span> <span class="nf">highest_outcome_and_count</span><span class="p">(</span>
</span><span id="MultisetExpression.highest_outcome_and_count-759"><a href="#MultisetExpression.highest_outcome_and_count-759"><span class="linenos">759</span></a>        <span class="bp">self</span>
</span><span id="MultisetExpression.highest_outcome_and_count-760"><a href="#MultisetExpression.highest_outcome_and_count-760"><span class="linenos">760</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[T_contra, int]] | icepool.MultisetEvaluator[T_contra, tuple[T_contra, int]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.highest_outcome_and_count-761"><a href="#MultisetExpression.highest_outcome_and_count-761"><span class="linenos">761</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The highest outcome with positive count, along with that count.</span>
</span><span id="MultisetExpression.highest_outcome_and_count-762"><a href="#MultisetExpression.highest_outcome_and_count-762"><span class="linenos">762</span></a>
</span><span id="MultisetExpression.highest_outcome_and_count-763"><a href="#MultisetExpression.highest_outcome_and_count-763"><span class="linenos">763</span></a><span class="sd">        If no outcomes have positive count, the min outcome will be returned with 0 count.</span>
</span><span id="MultisetExpression.highest_outcome_and_count-764"><a href="#MultisetExpression.highest_outcome_and_count-764"><span class="linenos">764</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.highest_outcome_and_count-765"><a href="#MultisetExpression.highest_outcome_and_count-765"><span class="linenos">765</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.highest_outcome_and_count-766"><a href="#MultisetExpression.highest_outcome_and_count-766"><span class="linenos">766</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">HighestOutcomeAndCountEvaluator</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The highest outcome with positive count, along with that count.</p>

<p>If no outcomes have positive count, the min outcome will be returned with 0 count.</p>
</div>


                            </div>
                            <div id="MultisetExpression.all_counts" class="classattr">
                                        <input id="MultisetExpression.all_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">all_counts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.all_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.all_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.all_counts-768"><a href="#MultisetExpression.all_counts-768"><span class="linenos">768</span></a>    <span class="k">def</span> <span class="nf">all_counts</span><span class="p">(</span>
</span><span id="MultisetExpression.all_counts-769"><a href="#MultisetExpression.all_counts-769"><span class="linenos">769</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.all_counts-770"><a href="#MultisetExpression.all_counts-770"><span class="linenos">770</span></a>        <span class="nb">filter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MultisetExpression.all_counts-771"><a href="#MultisetExpression.all_counts-771"><span class="linenos">771</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, ...]] | icepool.MultisetEvaluator[T_contra, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.all_counts-772"><a href="#MultisetExpression.all_counts-772"><span class="linenos">772</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Sorted tuple of all counts, i.e. the sizes of all matching sets.</span>
</span><span id="MultisetExpression.all_counts-773"><a href="#MultisetExpression.all_counts-773"><span class="linenos">773</span></a>
</span><span id="MultisetExpression.all_counts-774"><a href="#MultisetExpression.all_counts-774"><span class="linenos">774</span></a><span class="sd">        The sizes are in **descending** order.</span>
</span><span id="MultisetExpression.all_counts-775"><a href="#MultisetExpression.all_counts-775"><span class="linenos">775</span></a>
</span><span id="MultisetExpression.all_counts-776"><a href="#MultisetExpression.all_counts-776"><span class="linenos">776</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.all_counts-777"><a href="#MultisetExpression.all_counts-777"><span class="linenos">777</span></a><span class="sd">            filter: Any counts below this value will not be in the output.</span>
</span><span id="MultisetExpression.all_counts-778"><a href="#MultisetExpression.all_counts-778"><span class="linenos">778</span></a><span class="sd">                For example, `filter=2` will only produce pairs and better.</span>
</span><span id="MultisetExpression.all_counts-779"><a href="#MultisetExpression.all_counts-779"><span class="linenos">779</span></a><span class="sd">                If `None`, no filtering will be done.</span>
</span><span id="MultisetExpression.all_counts-780"><a href="#MultisetExpression.all_counts-780"><span class="linenos">780</span></a>
</span><span id="MultisetExpression.all_counts-781"><a href="#MultisetExpression.all_counts-781"><span class="linenos">781</span></a><span class="sd">                Why not just place `keep_countss_ge()` before this?</span>
</span><span id="MultisetExpression.all_counts-782"><a href="#MultisetExpression.all_counts-782"><span class="linenos">782</span></a><span class="sd">                `keep_countss_ge()` operates by setting counts to zero, so you</span>
</span><span id="MultisetExpression.all_counts-783"><a href="#MultisetExpression.all_counts-783"><span class="linenos">783</span></a><span class="sd">                would still need an argument to specify whether you want to</span>
</span><span id="MultisetExpression.all_counts-784"><a href="#MultisetExpression.all_counts-784"><span class="linenos">784</span></a><span class="sd">                output zero counts. So we might as well use the argument to do</span>
</span><span id="MultisetExpression.all_counts-785"><a href="#MultisetExpression.all_counts-785"><span class="linenos">785</span></a><span class="sd">                both.</span>
</span><span id="MultisetExpression.all_counts-786"><a href="#MultisetExpression.all_counts-786"><span class="linenos">786</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.all_counts-787"><a href="#MultisetExpression.all_counts-787"><span class="linenos">787</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">AllCountsEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression.all_counts-788"><a href="#MultisetExpression.all_counts-788"><span class="linenos">788</span></a>            <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: Sorted tuple of all counts, i.e. the sizes of all matching sets.</p>

<p>The sizes are in <strong>descending</strong> order.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>filter:</strong>  Any counts below this value will not be in the output.
For example, <code>filter=2</code> will only produce pairs and better.
If <code>None</code>, no filtering will be done.</p>

<p>Why not just place <code>keep_countss_ge()</code> before this?
<code>keep_countss_ge()</code> operates by setting counts to zero, so you
would still need an argument to specify whether you want to
output zero counts. So we might as well use the argument to do
both.</p></li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.largest_count" class="classattr">
                                        <input id="MultisetExpression.largest_count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">largest_count</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.largest_count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.largest_count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.largest_count-790"><a href="#MultisetExpression.largest_count-790"><span class="linenos">790</span></a>    <span class="k">def</span> <span class="nf">largest_count</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_count-791"><a href="#MultisetExpression.largest_count-791"><span class="linenos">791</span></a>            <span class="bp">self</span>
</span><span id="MultisetExpression.largest_count-792"><a href="#MultisetExpression.largest_count-792"><span class="linenos">792</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.largest_count-793"><a href="#MultisetExpression.largest_count-793"><span class="linenos">793</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The size of the largest matching set among the elements.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression.largest_count-794"><a href="#MultisetExpression.largest_count-794"><span class="linenos">794</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_count-795"><a href="#MultisetExpression.largest_count-795"><span class="linenos">795</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestCountEvaluator</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The size of the largest matching set among the elements.</p>
</div>


                            </div>
                            <div id="MultisetExpression.largest_count_and_outcome" class="classattr">
                                        <input id="MultisetExpression.largest_count_and_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">largest_count_and_outcome</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">-</span><span class="n">T_contra</span><span class="p">]],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">-</span><span class="n">T_contra</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.largest_count_and_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.largest_count_and_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.largest_count_and_outcome-797"><a href="#MultisetExpression.largest_count_and_outcome-797"><span class="linenos">797</span></a>    <span class="k">def</span> <span class="nf">largest_count_and_outcome</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_count_and_outcome-798"><a href="#MultisetExpression.largest_count_and_outcome-798"><span class="linenos">798</span></a>        <span class="bp">self</span>
</span><span id="MultisetExpression.largest_count_and_outcome-799"><a href="#MultisetExpression.largest_count_and_outcome-799"><span class="linenos">799</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, T_contra]] | icepool.MultisetEvaluator[T_contra, tuple[int, T_contra]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.largest_count_and_outcome-800"><a href="#MultisetExpression.largest_count_and_outcome-800"><span class="linenos">800</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The largest matching set among the elements and the corresponding outcome.&quot;&quot;&quot;</span>
</span><span id="MultisetExpression.largest_count_and_outcome-801"><a href="#MultisetExpression.largest_count_and_outcome-801"><span class="linenos">801</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_count_and_outcome-802"><a href="#MultisetExpression.largest_count_and_outcome-802"><span class="linenos">802</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestCountAndOutcomeEvaluator</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The largest matching set among the elements and the corresponding outcome.</p>
</div>


                            </div>
                            <div id="MultisetExpression.count_subset" class="classattr">
                                        <input id="MultisetExpression.count_subset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_subset</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">divisor</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">empty_divisor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.count_subset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.count_subset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.count_subset-811"><a href="#MultisetExpression.count_subset-811"><span class="linenos">811</span></a>    <span class="k">def</span> <span class="nf">count_subset</span><span class="p">(</span>
</span><span id="MultisetExpression.count_subset-812"><a href="#MultisetExpression.count_subset-812"><span class="linenos">812</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.count_subset-813"><a href="#MultisetExpression.count_subset-813"><span class="linenos">813</span></a>        <span class="n">divisor</span><span class="p">:</span>
</span><span id="MultisetExpression.count_subset-814"><a href="#MultisetExpression.count_subset-814"><span class="linenos">814</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.count_subset-815"><a href="#MultisetExpression.count_subset-815"><span class="linenos">815</span></a>        <span class="o">/</span><span class="p">,</span>
</span><span id="MultisetExpression.count_subset-816"><a href="#MultisetExpression.count_subset-816"><span class="linenos">816</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.count_subset-817"><a href="#MultisetExpression.count_subset-817"><span class="linenos">817</span></a>        <span class="n">empty_divisor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="MultisetExpression.count_subset-818"><a href="#MultisetExpression.count_subset-818"><span class="linenos">818</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[T_contra, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.count_subset-819"><a href="#MultisetExpression.count_subset-819"><span class="linenos">819</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The number of times the divisor is contained in this multiset.</span>
</span><span id="MultisetExpression.count_subset-820"><a href="#MultisetExpression.count_subset-820"><span class="linenos">820</span></a><span class="sd">        </span>
</span><span id="MultisetExpression.count_subset-821"><a href="#MultisetExpression.count_subset-821"><span class="linenos">821</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.count_subset-822"><a href="#MultisetExpression.count_subset-822"><span class="linenos">822</span></a><span class="sd">            divisor: The multiset to divide by.</span>
</span><span id="MultisetExpression.count_subset-823"><a href="#MultisetExpression.count_subset-823"><span class="linenos">823</span></a><span class="sd">            empty_divisor: If the divisor is empty, the outcome will be this.</span>
</span><span id="MultisetExpression.count_subset-824"><a href="#MultisetExpression.count_subset-824"><span class="linenos">824</span></a><span class="sd">                If not set, `ZeroDivisionError` will be raised for an empty</span>
</span><span id="MultisetExpression.count_subset-825"><a href="#MultisetExpression.count_subset-825"><span class="linenos">825</span></a><span class="sd">                right side.</span>
</span><span id="MultisetExpression.count_subset-826"><a href="#MultisetExpression.count_subset-826"><span class="linenos">826</span></a>
</span><span id="MultisetExpression.count_subset-827"><a href="#MultisetExpression.count_subset-827"><span class="linenos">827</span></a><span class="sd">        Raises:</span>
</span><span id="MultisetExpression.count_subset-828"><a href="#MultisetExpression.count_subset-828"><span class="linenos">828</span></a><span class="sd">            ZeroDivisionError: If the divisor may be empty and </span>
</span><span id="MultisetExpression.count_subset-829"><a href="#MultisetExpression.count_subset-829"><span class="linenos">829</span></a><span class="sd">                empty_divisor_outcome is not set.</span>
</span><span id="MultisetExpression.count_subset-830"><a href="#MultisetExpression.count_subset-830"><span class="linenos">830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.count_subset-831"><a href="#MultisetExpression.count_subset-831"><span class="linenos">831</span></a>        <span class="n">divisor</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">divisor</span><span class="p">)</span>
</span><span id="MultisetExpression.count_subset-832"><a href="#MultisetExpression.count_subset-832"><span class="linenos">832</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">divisor</span><span class="p">,</span>
</span><span id="MultisetExpression.count_subset-833"><a href="#MultisetExpression.count_subset-833"><span class="linenos">833</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CountSubsetEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression.count_subset-834"><a href="#MultisetExpression.count_subset-834"><span class="linenos">834</span></a>                                 <span class="n">empty_divisor</span><span class="o">=</span><span class="n">empty_divisor</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The number of times the divisor is contained in this multiset.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>divisor:</strong>  The multiset to divide by.</li>
<li><strong>empty_divisor:</strong>  If the divisor is empty, the outcome will be this.
If not set, <code>ZeroDivisionError</code> will be raised for an empty
right side.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ZeroDivisionError:</strong>  If the divisor may be empty and 
empty_divisor_outcome is not set.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.largest_straight" class="classattr">
                                        <input id="MultisetExpression.largest_straight-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">largest_straight</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.largest_straight-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.largest_straight"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.largest_straight-836"><a href="#MultisetExpression.largest_straight-836"><span class="linenos">836</span></a>    <span class="k">def</span> <span class="nf">largest_straight</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_straight-837"><a href="#MultisetExpression.largest_straight-837"><span class="linenos">837</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span>
</span><span id="MultisetExpression.largest_straight-838"><a href="#MultisetExpression.largest_straight-838"><span class="linenos">838</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[int] | icepool.MultisetEvaluator[int, int]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.largest_straight-839"><a href="#MultisetExpression.largest_straight-839"><span class="linenos">839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The size of the largest straight among the elements.</span>
</span><span id="MultisetExpression.largest_straight-840"><a href="#MultisetExpression.largest_straight-840"><span class="linenos">840</span></a>
</span><span id="MultisetExpression.largest_straight-841"><a href="#MultisetExpression.largest_straight-841"><span class="linenos">841</span></a><span class="sd">        Outcomes must be `int`s.</span>
</span><span id="MultisetExpression.largest_straight-842"><a href="#MultisetExpression.largest_straight-842"><span class="linenos">842</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.largest_straight-843"><a href="#MultisetExpression.largest_straight-843"><span class="linenos">843</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_straight-844"><a href="#MultisetExpression.largest_straight-844"><span class="linenos">844</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestStraightEvaluator</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The size of the largest straight among the elements.</p>

<p>Outcomes must be <code>int</code>s.</p>
</div>


                            </div>
                            <div id="MultisetExpression.largest_straight_and_outcome" class="classattr">
                                        <input id="MultisetExpression.largest_straight_and_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">largest_straight_and_outcome</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.largest_straight_and_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.largest_straight_and_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.largest_straight_and_outcome-846"><a href="#MultisetExpression.largest_straight_and_outcome-846"><span class="linenos">846</span></a>    <span class="k">def</span> <span class="nf">largest_straight_and_outcome</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_straight_and_outcome-847"><a href="#MultisetExpression.largest_straight_and_outcome-847"><span class="linenos">847</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span>
</span><span id="MultisetExpression.largest_straight_and_outcome-848"><a href="#MultisetExpression.largest_straight_and_outcome-848"><span class="linenos">848</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, int]] | icepool.MultisetEvaluator[int, tuple[int, int]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.largest_straight_and_outcome-849"><a href="#MultisetExpression.largest_straight_and_outcome-849"><span class="linenos">849</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The size of the largest straight among the elements and the highest outcome in that straight.</span>
</span><span id="MultisetExpression.largest_straight_and_outcome-850"><a href="#MultisetExpression.largest_straight_and_outcome-850"><span class="linenos">850</span></a>
</span><span id="MultisetExpression.largest_straight_and_outcome-851"><a href="#MultisetExpression.largest_straight_and_outcome-851"><span class="linenos">851</span></a><span class="sd">        Outcomes must be `int`s.</span>
</span><span id="MultisetExpression.largest_straight_and_outcome-852"><a href="#MultisetExpression.largest_straight_and_outcome-852"><span class="linenos">852</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.largest_straight_and_outcome-853"><a href="#MultisetExpression.largest_straight_and_outcome-853"><span class="linenos">853</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.largest_straight_and_outcome-854"><a href="#MultisetExpression.largest_straight_and_outcome-854"><span class="linenos">854</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">LargestStraightAndOutcomeEvaluator</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The size of the largest straight among the elements and the highest outcome in that straight.</p>

<p>Outcomes must be <code>int</code>s.</p>
</div>


                            </div>
                            <div id="MultisetExpression.all_straights" class="classattr">
                                        <input id="MultisetExpression.all_straights-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">all_straights</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.all_straights-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.all_straights"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.all_straights-856"><a href="#MultisetExpression.all_straights-856"><span class="linenos">856</span></a>    <span class="k">def</span> <span class="nf">all_straights</span><span class="p">(</span>
</span><span id="MultisetExpression.all_straights-857"><a href="#MultisetExpression.all_straights-857"><span class="linenos">857</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span>
</span><span id="MultisetExpression.all_straights-858"><a href="#MultisetExpression.all_straights-858"><span class="linenos">858</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[int, ...]] | icepool.MultisetEvaluator[int, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.all_straights-859"><a href="#MultisetExpression.all_straights-859"><span class="linenos">859</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: The sizes of all straights.</span>
</span><span id="MultisetExpression.all_straights-860"><a href="#MultisetExpression.all_straights-860"><span class="linenos">860</span></a>
</span><span id="MultisetExpression.all_straights-861"><a href="#MultisetExpression.all_straights-861"><span class="linenos">861</span></a><span class="sd">        The sizes are in **descending** order.</span>
</span><span id="MultisetExpression.all_straights-862"><a href="#MultisetExpression.all_straights-862"><span class="linenos">862</span></a>
</span><span id="MultisetExpression.all_straights-863"><a href="#MultisetExpression.all_straights-863"><span class="linenos">863</span></a><span class="sd">        Each element can only contribute to one straight, though duplicate</span>
</span><span id="MultisetExpression.all_straights-864"><a href="#MultisetExpression.all_straights-864"><span class="linenos">864</span></a><span class="sd">        elements can produces straights that overlap in outcomes. In this case,</span>
</span><span id="MultisetExpression.all_straights-865"><a href="#MultisetExpression.all_straights-865"><span class="linenos">865</span></a><span class="sd">        elements are preferentially assigned to the longer straight.</span>
</span><span id="MultisetExpression.all_straights-866"><a href="#MultisetExpression.all_straights-866"><span class="linenos">866</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.all_straights-867"><a href="#MultisetExpression.all_straights-867"><span class="linenos">867</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.all_straights-868"><a href="#MultisetExpression.all_straights-868"><span class="linenos">868</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">AllStraightsEvaluator</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: The sizes of all straights.</p>

<p>The sizes are in <strong>descending</strong> order.</p>

<p>Each element can only contribute to one straight, though duplicate
elements can produces straights that overlap in outcomes. In this case,
elements are preferentially assigned to the longer straight.</p>
</div>


                            </div>
                            <div id="MultisetExpression.all_straights_reduce_counts" class="classattr">
                                        <input id="MultisetExpression.all_straights_reduce_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">all_straights_reduce_counts</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">reducer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">mul</span><span class="o">&gt;</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="o">...</span><span class="p">]],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="o">...</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.all_straights_reduce_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.all_straights_reduce_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.all_straights_reduce_counts-870"><a href="#MultisetExpression.all_straights_reduce_counts-870"><span class="linenos">870</span></a>    <span class="k">def</span> <span class="nf">all_straights_reduce_counts</span><span class="p">(</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-871"><a href="#MultisetExpression.all_straights_reduce_counts-871"><span class="linenos">871</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[int]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-872"><a href="#MultisetExpression.all_straights_reduce_counts-872"><span class="linenos">872</span></a>        <span class="n">reducer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-873"><a href="#MultisetExpression.all_straights_reduce_counts-873"><span class="linenos">873</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[tuple[tuple[int, int], ...]] | icepool.MultisetEvaluator[int, tuple[tuple[int, int], ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-874"><a href="#MultisetExpression.all_straights_reduce_counts-874"><span class="linenos">874</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Experimental: All straights with a reduce operation on the counts.</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-875"><a href="#MultisetExpression.all_straights_reduce_counts-875"><span class="linenos">875</span></a>
</span><span id="MultisetExpression.all_straights_reduce_counts-876"><a href="#MultisetExpression.all_straights_reduce_counts-876"><span class="linenos">876</span></a><span class="sd">        This can be used to evaluate e.g. cribbage-style straight counting.</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-877"><a href="#MultisetExpression.all_straights_reduce_counts-877"><span class="linenos">877</span></a>
</span><span id="MultisetExpression.all_straights_reduce_counts-878"><a href="#MultisetExpression.all_straights_reduce_counts-878"><span class="linenos">878</span></a><span class="sd">        The result is a tuple of `(run_length, run_score)`s.</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-879"><a href="#MultisetExpression.all_straights_reduce_counts-879"><span class="linenos">879</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-880"><a href="#MultisetExpression.all_straights_reduce_counts-880"><span class="linenos">880</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-881"><a href="#MultisetExpression.all_straights_reduce_counts-881"><span class="linenos">881</span></a>            <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">AllStraightsReduceCountsEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression.all_straights_reduce_counts-882"><a href="#MultisetExpression.all_straights_reduce_counts-882"><span class="linenos">882</span></a>                <span class="n">reducer</span><span class="o">=</span><span class="n">reducer</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Experimental: All straights with a reduce operation on the counts.</p>

<p>This can be used to evaluate e.g. cribbage-style straight counting.</p>

<p>The result is a tuple of <code>(run_length, run_score)</code>s.</p>
</div>


                            </div>
                            <div id="MultisetExpression.argsort" class="classattr">
                                        <input id="MultisetExpression.argsort-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">argsort</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Descending">Order.Descending</a></span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.argsort-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.argsort"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.argsort-884"><a href="#MultisetExpression.argsort-884"><span class="linenos">884</span></a>    <span class="k">def</span> <span class="nf">argsort</span><span class="p">(</span>
</span><span id="MultisetExpression.argsort-885"><a href="#MultisetExpression.argsort-885"><span class="linenos">885</span></a>            <span class="bp">self</span><span class="p">:</span>
</span><span id="MultisetExpression.argsort-886"><a href="#MultisetExpression.argsort-886"><span class="linenos">886</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.argsort-887"><a href="#MultisetExpression.argsort-887"><span class="linenos">887</span></a>            <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetExpression.argsort-888"><a href="#MultisetExpression.argsort-888"><span class="linenos">888</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.argsort-889"><a href="#MultisetExpression.argsort-889"><span class="linenos">889</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">,</span>
</span><span id="MultisetExpression.argsort-890"><a href="#MultisetExpression.argsort-890"><span class="linenos">890</span></a>            <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MultisetExpression.argsort-891"><a href="#MultisetExpression.argsort-891"><span class="linenos">891</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Experimental: Returns the indexes of the originating multisets for each rank in their additive union.</span>
</span><span id="MultisetExpression.argsort-892"><a href="#MultisetExpression.argsort-892"><span class="linenos">892</span></a>
</span><span id="MultisetExpression.argsort-893"><a href="#MultisetExpression.argsort-893"><span class="linenos">893</span></a><span class="sd">        Example:</span>
</span><span id="MultisetExpression.argsort-894"><a href="#MultisetExpression.argsort-894"><span class="linenos">894</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.argsort-895"><a href="#MultisetExpression.argsort-895"><span class="linenos">895</span></a><span class="sd">        MultisetExpression.argsort([10, 9, 5], [9, 9])</span>
</span><span id="MultisetExpression.argsort-896"><a href="#MultisetExpression.argsort-896"><span class="linenos">896</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.argsort-897"><a href="#MultisetExpression.argsort-897"><span class="linenos">897</span></a><span class="sd">        produces</span>
</span><span id="MultisetExpression.argsort-898"><a href="#MultisetExpression.argsort-898"><span class="linenos">898</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.argsort-899"><a href="#MultisetExpression.argsort-899"><span class="linenos">899</span></a><span class="sd">        ((0,), (0, 1, 1), (0,))</span>
</span><span id="MultisetExpression.argsort-900"><a href="#MultisetExpression.argsort-900"><span class="linenos">900</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.argsort-901"><a href="#MultisetExpression.argsort-901"><span class="linenos">901</span></a><span class="sd">        </span>
</span><span id="MultisetExpression.argsort-902"><a href="#MultisetExpression.argsort-902"><span class="linenos">902</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.argsort-903"><a href="#MultisetExpression.argsort-903"><span class="linenos">903</span></a><span class="sd">            self, *args: The multiset expressions to be evaluated.</span>
</span><span id="MultisetExpression.argsort-904"><a href="#MultisetExpression.argsort-904"><span class="linenos">904</span></a><span class="sd">            order: Which order the ranks are to be emitted. Default is descending.</span>
</span><span id="MultisetExpression.argsort-905"><a href="#MultisetExpression.argsort-905"><span class="linenos">905</span></a><span class="sd">            limit: How many ranks to emit. Default will emit all ranks, which</span>
</span><span id="MultisetExpression.argsort-906"><a href="#MultisetExpression.argsort-906"><span class="linenos">906</span></a><span class="sd">                makes the length of each outcome equal to</span>
</span><span id="MultisetExpression.argsort-907"><a href="#MultisetExpression.argsort-907"><span class="linenos">907</span></a><span class="sd">                `additive_union(+self, +arg1, +arg2, ...).unique().count()`</span>
</span><span id="MultisetExpression.argsort-908"><a href="#MultisetExpression.argsort-908"><span class="linenos">908</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.argsort-909"><a href="#MultisetExpression.argsort-909"><span class="linenos">909</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetExpression.argsort-910"><a href="#MultisetExpression.argsort-910"><span class="linenos">910</span></a>        <span class="n">converted_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
</span><span id="MultisetExpression.argsort-911"><a href="#MultisetExpression.argsort-911"><span class="linenos">911</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">converted_args</span><span class="p">,</span>
</span><span id="MultisetExpression.argsort-912"><a href="#MultisetExpression.argsort-912"><span class="linenos">912</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">ArgsortEvaluator</span><span class="p">(</span>
</span><span id="MultisetExpression.argsort-913"><a href="#MultisetExpression.argsort-913"><span class="linenos">913</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Experimental: Returns the indexes of the originating multisets for each rank in their additive union.</p>

<p>Example:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n"><a href="#MultisetExpression.argsort">MultisetExpression.argsort</a></span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
</code></pre>
</div>

<p>produces</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="p">((</span><span class="mi">0</span><span class="p">,),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>self, *args:</strong>  The multiset expressions to be evaluated.</li>
<li><strong>order:</strong>  Which order the ranks are to be emitted. Default is descending.</li>
<li><strong>limit:</strong>  How many ranks to emit. Default will emit all ranks, which
makes the length of each outcome equal to
<code>additive_union(+self, +arg1, +arg2, ...).unique().count()</code></li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.issubset" class="classattr">
                                        <input id="MultisetExpression.issubset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">issubset</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.issubset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.issubset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.issubset-958"><a href="#MultisetExpression.issubset-958"><span class="linenos">958</span></a>    <span class="k">def</span> <span class="nf">issubset</span><span class="p">(</span>
</span><span id="MultisetExpression.issubset-959"><a href="#MultisetExpression.issubset-959"><span class="linenos">959</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.issubset-960"><a href="#MultisetExpression.issubset-960"><span class="linenos">960</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.issubset-961"><a href="#MultisetExpression.issubset-961"><span class="linenos">961</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression.issubset-962"><a href="#MultisetExpression.issubset-962"><span class="linenos">962</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.issubset-963"><a href="#MultisetExpression.issubset-963"><span class="linenos">963</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether this multiset is a subset of the other multiset.</span>
</span><span id="MultisetExpression.issubset-964"><a href="#MultisetExpression.issubset-964"><span class="linenos">964</span></a>
</span><span id="MultisetExpression.issubset-965"><a href="#MultisetExpression.issubset-965"><span class="linenos">965</span></a><span class="sd">        Specifically, if this multiset has a lesser or equal count for each</span>
</span><span id="MultisetExpression.issubset-966"><a href="#MultisetExpression.issubset-966"><span class="linenos">966</span></a><span class="sd">        outcome than the other multiset, this evaluates to `True`; </span>
</span><span id="MultisetExpression.issubset-967"><a href="#MultisetExpression.issubset-967"><span class="linenos">967</span></a><span class="sd">        if there is some outcome for which this multiset has a greater count </span>
</span><span id="MultisetExpression.issubset-968"><a href="#MultisetExpression.issubset-968"><span class="linenos">968</span></a><span class="sd">        than the other multiset, this evaluates to `False`.</span>
</span><span id="MultisetExpression.issubset-969"><a href="#MultisetExpression.issubset-969"><span class="linenos">969</span></a>
</span><span id="MultisetExpression.issubset-970"><a href="#MultisetExpression.issubset-970"><span class="linenos">970</span></a><span class="sd">        `issubset` is the same as `self &lt;= other`.</span>
</span><span id="MultisetExpression.issubset-971"><a href="#MultisetExpression.issubset-971"><span class="linenos">971</span></a><span class="sd">        </span>
</span><span id="MultisetExpression.issubset-972"><a href="#MultisetExpression.issubset-972"><span class="linenos">972</span></a><span class="sd">        `self &lt; other` evaluates a proper subset relation, which is the same</span>
</span><span id="MultisetExpression.issubset-973"><a href="#MultisetExpression.issubset-973"><span class="linenos">973</span></a><span class="sd">        except the result is `False` if the two multisets are exactly equal.</span>
</span><span id="MultisetExpression.issubset-974"><a href="#MultisetExpression.issubset-974"><span class="linenos">974</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.issubset-975"><a href="#MultisetExpression.issubset-975"><span class="linenos">975</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsSubsetEvaluator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: Whether this multiset is a subset of the other multiset.</p>

<p>Specifically, if this multiset has a lesser or equal count for each
outcome than the other multiset, this evaluates to <code>True</code>; 
if there is some outcome for which this multiset has a greater count 
than the other multiset, this evaluates to <code>False</code>.</p>

<p><code><a href="#MultisetExpression.issubset">issubset</a></code> is the same as <code>self &lt;= other</code>.</p>

<p><code>self &lt; other</code> evaluates a proper subset relation, which is the same
except the result is <code>False</code> if the two multisets are exactly equal.</p>
</div>


                            </div>
                            <div id="MultisetExpression.issuperset" class="classattr">
                                        <input id="MultisetExpression.issuperset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">issuperset</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.issuperset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.issuperset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.issuperset-998"><a href="#MultisetExpression.issuperset-998"><span class="linenos"> 998</span></a>    <span class="k">def</span> <span class="nf">issuperset</span><span class="p">(</span>
</span><span id="MultisetExpression.issuperset-999"><a href="#MultisetExpression.issuperset-999"><span class="linenos"> 999</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.issuperset-1000"><a href="#MultisetExpression.issuperset-1000"><span class="linenos">1000</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.issuperset-1001"><a href="#MultisetExpression.issuperset-1001"><span class="linenos">1001</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression.issuperset-1002"><a href="#MultisetExpression.issuperset-1002"><span class="linenos">1002</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.issuperset-1003"><a href="#MultisetExpression.issuperset-1003"><span class="linenos">1003</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether this multiset is a superset of the other multiset.</span>
</span><span id="MultisetExpression.issuperset-1004"><a href="#MultisetExpression.issuperset-1004"><span class="linenos">1004</span></a>
</span><span id="MultisetExpression.issuperset-1005"><a href="#MultisetExpression.issuperset-1005"><span class="linenos">1005</span></a><span class="sd">        Specifically, if this multiset has a greater or equal count for each</span>
</span><span id="MultisetExpression.issuperset-1006"><a href="#MultisetExpression.issuperset-1006"><span class="linenos">1006</span></a><span class="sd">        outcome than the other multiset, this evaluates to `True`; </span>
</span><span id="MultisetExpression.issuperset-1007"><a href="#MultisetExpression.issuperset-1007"><span class="linenos">1007</span></a><span class="sd">        if there is some  outcome for which this multiset has a lesser count </span>
</span><span id="MultisetExpression.issuperset-1008"><a href="#MultisetExpression.issuperset-1008"><span class="linenos">1008</span></a><span class="sd">        than the other multiset, this evaluates to `False`.</span>
</span><span id="MultisetExpression.issuperset-1009"><a href="#MultisetExpression.issuperset-1009"><span class="linenos">1009</span></a><span class="sd">        </span>
</span><span id="MultisetExpression.issuperset-1010"><a href="#MultisetExpression.issuperset-1010"><span class="linenos">1010</span></a><span class="sd">        A typical use of this evaluation is testing for the presence of a</span>
</span><span id="MultisetExpression.issuperset-1011"><a href="#MultisetExpression.issuperset-1011"><span class="linenos">1011</span></a><span class="sd">        combo of cards in a hand, e.g.</span>
</span><span id="MultisetExpression.issuperset-1012"><a href="#MultisetExpression.issuperset-1012"><span class="linenos">1012</span></a>
</span><span id="MultisetExpression.issuperset-1013"><a href="#MultisetExpression.issuperset-1013"><span class="linenos">1013</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.issuperset-1014"><a href="#MultisetExpression.issuperset-1014"><span class="linenos">1014</span></a><span class="sd">        deck.deal(5) &gt;= [&#39;a&#39;, &#39;a&#39;, &#39;b&#39;]</span>
</span><span id="MultisetExpression.issuperset-1015"><a href="#MultisetExpression.issuperset-1015"><span class="linenos">1015</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.issuperset-1016"><a href="#MultisetExpression.issuperset-1016"><span class="linenos">1016</span></a>
</span><span id="MultisetExpression.issuperset-1017"><a href="#MultisetExpression.issuperset-1017"><span class="linenos">1017</span></a><span class="sd">        represents the chance that a deal of 5 cards contains at least two &#39;a&#39;s</span>
</span><span id="MultisetExpression.issuperset-1018"><a href="#MultisetExpression.issuperset-1018"><span class="linenos">1018</span></a><span class="sd">        and one &#39;b&#39;.</span>
</span><span id="MultisetExpression.issuperset-1019"><a href="#MultisetExpression.issuperset-1019"><span class="linenos">1019</span></a>
</span><span id="MultisetExpression.issuperset-1020"><a href="#MultisetExpression.issuperset-1020"><span class="linenos">1020</span></a><span class="sd">        `issuperset` is the same as `self &gt;= other`.</span>
</span><span id="MultisetExpression.issuperset-1021"><a href="#MultisetExpression.issuperset-1021"><span class="linenos">1021</span></a>
</span><span id="MultisetExpression.issuperset-1022"><a href="#MultisetExpression.issuperset-1022"><span class="linenos">1022</span></a><span class="sd">        `self &gt; other` evaluates a proper superset relation, which is the same</span>
</span><span id="MultisetExpression.issuperset-1023"><a href="#MultisetExpression.issuperset-1023"><span class="linenos">1023</span></a><span class="sd">        except the result is `False` if the two multisets are exactly equal.</span>
</span><span id="MultisetExpression.issuperset-1024"><a href="#MultisetExpression.issuperset-1024"><span class="linenos">1024</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.issuperset-1025"><a href="#MultisetExpression.issuperset-1025"><span class="linenos">1025</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsSupersetEvaluator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: Whether this multiset is a superset of the other multiset.</p>

<p>Specifically, if this multiset has a greater or equal count for each
outcome than the other multiset, this evaluates to <code>True</code>; 
if there is some  outcome for which this multiset has a lesser count 
than the other multiset, this evaluates to <code>False</code>.</p>

<p>A typical use of this evaluation is testing for the presence of a
combo of cards in a hand, e.g.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">deck</span><span class="o">.</span><span class="n">deal</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">]</span>
</code></pre>
</div>

<p>represents the chance that a deal of 5 cards contains at least two 'a's
and one 'b'.</p>

<p><code><a href="#MultisetExpression.issuperset">issuperset</a></code> is the same as <code>self &gt;= other</code>.</p>

<p><code>self &gt; other</code> evaluates a proper superset relation, which is the same
except the result is <code>False</code> if the two multisets are exactly equal.</p>
</div>


                            </div>
                            <div id="MultisetExpression.isdisjoint" class="classattr">
                                        <input id="MultisetExpression.isdisjoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">isdisjoint</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetExpression.isdisjoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.isdisjoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.isdisjoint-1050"><a href="#MultisetExpression.isdisjoint-1050"><span class="linenos">1050</span></a>    <span class="k">def</span> <span class="nf">isdisjoint</span><span class="p">(</span>
</span><span id="MultisetExpression.isdisjoint-1051"><a href="#MultisetExpression.isdisjoint-1051"><span class="linenos">1051</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.isdisjoint-1052"><a href="#MultisetExpression.isdisjoint-1052"><span class="linenos">1052</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.isdisjoint-1053"><a href="#MultisetExpression.isdisjoint-1053"><span class="linenos">1053</span></a>            <span class="o">/</span>
</span><span id="MultisetExpression.isdisjoint-1054"><a href="#MultisetExpression.isdisjoint-1054"><span class="linenos">1054</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[bool] | icepool.MultisetEvaluator[T_contra, bool]&#39;</span><span class="p">:</span>
</span><span id="MultisetExpression.isdisjoint-1055"><a href="#MultisetExpression.isdisjoint-1055"><span class="linenos">1055</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: Whether this multiset is disjoint from the other multiset.</span>
</span><span id="MultisetExpression.isdisjoint-1056"><a href="#MultisetExpression.isdisjoint-1056"><span class="linenos">1056</span></a><span class="sd">        </span>
</span><span id="MultisetExpression.isdisjoint-1057"><a href="#MultisetExpression.isdisjoint-1057"><span class="linenos">1057</span></a><span class="sd">        Specifically, this evaluates to `False` if there is any outcome for</span>
</span><span id="MultisetExpression.isdisjoint-1058"><a href="#MultisetExpression.isdisjoint-1058"><span class="linenos">1058</span></a><span class="sd">        which both multisets have positive count, and `True` if there is not.</span>
</span><span id="MultisetExpression.isdisjoint-1059"><a href="#MultisetExpression.isdisjoint-1059"><span class="linenos">1059</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.isdisjoint-1060"><a href="#MultisetExpression.isdisjoint-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">IsDisjointSetEvaluator</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: Whether this multiset is disjoint from the other multiset.</p>

<p>Specifically, this evaluates to <code>False</code> if there is any outcome for
which both multisets have positive count, and <code>True</code> if there is not.</p>
</div>


                            </div>
                            <div id="MultisetExpression.compair_lt" class="classattr">
                                        <input id="MultisetExpression.compair_lt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compair_lt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Descending">Order.Descending</a></span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.compair_lt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.compair_lt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.compair_lt-1062"><a href="#MultisetExpression.compair_lt-1062"><span class="linenos">1062</span></a>    <span class="k">def</span> <span class="nf">compair_lt</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_lt-1063"><a href="#MultisetExpression.compair_lt-1063"><span class="linenos">1063</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_lt-1064"><a href="#MultisetExpression.compair_lt-1064"><span class="linenos">1064</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.compair_lt-1065"><a href="#MultisetExpression.compair_lt-1065"><span class="linenos">1065</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_lt-1066"><a href="#MultisetExpression.compair_lt-1066"><span class="linenos">1066</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_lt-1067"><a href="#MultisetExpression.compair_lt-1067"><span class="linenos">1067</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression.compair_lt-1068"><a href="#MultisetExpression.compair_lt-1068"><span class="linenos">1068</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &lt; `other`.</span>
</span><span id="MultisetExpression.compair_lt-1069"><a href="#MultisetExpression.compair_lt-1069"><span class="linenos">1069</span></a>
</span><span id="MultisetExpression.compair_lt-1070"><a href="#MultisetExpression.compair_lt-1070"><span class="linenos">1070</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression.compair_lt-1071"><a href="#MultisetExpression.compair_lt-1071"><span class="linenos">1071</span></a>
</span><span id="MultisetExpression.compair_lt-1072"><a href="#MultisetExpression.compair_lt-1072"><span class="linenos">1072</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.compair_lt-1073"><a href="#MultisetExpression.compair_lt-1073"><span class="linenos">1073</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression.compair_lt-1074"><a href="#MultisetExpression.compair_lt-1074"><span class="linenos">1074</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression.compair_lt-1075"><a href="#MultisetExpression.compair_lt-1075"><span class="linenos">1075</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression.compair_lt-1076"><a href="#MultisetExpression.compair_lt-1076"><span class="linenos">1076</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.compair_lt-1077"><a href="#MultisetExpression.compair_lt-1077"><span class="linenos">1077</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.compair_lt-1078"><a href="#MultisetExpression.compair_lt-1078"><span class="linenos">1078</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_lt-1079"><a href="#MultisetExpression.compair_lt-1079"><span class="linenos">1079</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_lt-1080"><a href="#MultisetExpression.compair_lt-1080"><span class="linenos">1080</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_lt-1081"><a href="#MultisetExpression.compair_lt-1081"><span class="linenos">1081</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_lt-1082"><a href="#MultisetExpression.compair_lt-1082"><span class="linenos">1082</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_lt-1083"><a href="#MultisetExpression.compair_lt-1083"><span class="linenos">1083</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs <code>self</code> is &lt; <code>other</code>.</p>

<p>Any extra unpaired elements do not affect the result.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>other:</strong>  The other multiset to compare.</li>
<li><strong>order:</strong>  Which order elements will be matched in.
Default is descending.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.compair_le" class="classattr">
                                        <input id="MultisetExpression.compair_le-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compair_le</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Descending">Order.Descending</a></span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.compair_le-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.compair_le"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.compair_le-1085"><a href="#MultisetExpression.compair_le-1085"><span class="linenos">1085</span></a>    <span class="k">def</span> <span class="nf">compair_le</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_le-1086"><a href="#MultisetExpression.compair_le-1086"><span class="linenos">1086</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_le-1087"><a href="#MultisetExpression.compair_le-1087"><span class="linenos">1087</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.compair_le-1088"><a href="#MultisetExpression.compair_le-1088"><span class="linenos">1088</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_le-1089"><a href="#MultisetExpression.compair_le-1089"><span class="linenos">1089</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_le-1090"><a href="#MultisetExpression.compair_le-1090"><span class="linenos">1090</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression.compair_le-1091"><a href="#MultisetExpression.compair_le-1091"><span class="linenos">1091</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &lt;= `other`.</span>
</span><span id="MultisetExpression.compair_le-1092"><a href="#MultisetExpression.compair_le-1092"><span class="linenos">1092</span></a>
</span><span id="MultisetExpression.compair_le-1093"><a href="#MultisetExpression.compair_le-1093"><span class="linenos">1093</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression.compair_le-1094"><a href="#MultisetExpression.compair_le-1094"><span class="linenos">1094</span></a>
</span><span id="MultisetExpression.compair_le-1095"><a href="#MultisetExpression.compair_le-1095"><span class="linenos">1095</span></a><span class="sd">        Example: number of armies destroyed by the defender in a </span>
</span><span id="MultisetExpression.compair_le-1096"><a href="#MultisetExpression.compair_le-1096"><span class="linenos">1096</span></a><span class="sd">        3v2 attack in *RISK*:</span>
</span><span id="MultisetExpression.compair_le-1097"><a href="#MultisetExpression.compair_le-1097"><span class="linenos">1097</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.compair_le-1098"><a href="#MultisetExpression.compair_le-1098"><span class="linenos">1098</span></a><span class="sd">        d6.pool(3).compair_le(d6.pool(2))</span>
</span><span id="MultisetExpression.compair_le-1099"><a href="#MultisetExpression.compair_le-1099"><span class="linenos">1099</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.compair_le-1100"><a href="#MultisetExpression.compair_le-1100"><span class="linenos">1100</span></a>
</span><span id="MultisetExpression.compair_le-1101"><a href="#MultisetExpression.compair_le-1101"><span class="linenos">1101</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.compair_le-1102"><a href="#MultisetExpression.compair_le-1102"><span class="linenos">1102</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression.compair_le-1103"><a href="#MultisetExpression.compair_le-1103"><span class="linenos">1103</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression.compair_le-1104"><a href="#MultisetExpression.compair_le-1104"><span class="linenos">1104</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression.compair_le-1105"><a href="#MultisetExpression.compair_le-1105"><span class="linenos">1105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.compair_le-1106"><a href="#MultisetExpression.compair_le-1106"><span class="linenos">1106</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.compair_le-1107"><a href="#MultisetExpression.compair_le-1107"><span class="linenos">1107</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_le-1108"><a href="#MultisetExpression.compair_le-1108"><span class="linenos">1108</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_le-1109"><a href="#MultisetExpression.compair_le-1109"><span class="linenos">1109</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_le-1110"><a href="#MultisetExpression.compair_le-1110"><span class="linenos">1110</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_le-1111"><a href="#MultisetExpression.compair_le-1111"><span class="linenos">1111</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_le-1112"><a href="#MultisetExpression.compair_le-1112"><span class="linenos">1112</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs <code>self</code> is &lt;= <code>other</code>.</p>

<p>Any extra unpaired elements do not affect the result.</p>

<p>Example: number of armies destroyed by the defender in a 
3v2 attack in <em>RISK</em>:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">d6</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">compair_le</span><span class="p">(</span><span class="n">d6</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>other:</strong>  The other multiset to compare.</li>
<li><strong>order:</strong>  Which order elements will be matched in.
Default is descending.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.compair_gt" class="classattr">
                                        <input id="MultisetExpression.compair_gt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compair_gt</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Descending">Order.Descending</a></span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.compair_gt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.compair_gt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.compair_gt-1114"><a href="#MultisetExpression.compair_gt-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="nf">compair_gt</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_gt-1115"><a href="#MultisetExpression.compair_gt-1115"><span class="linenos">1115</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_gt-1116"><a href="#MultisetExpression.compair_gt-1116"><span class="linenos">1116</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.compair_gt-1117"><a href="#MultisetExpression.compair_gt-1117"><span class="linenos">1117</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_gt-1118"><a href="#MultisetExpression.compair_gt-1118"><span class="linenos">1118</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_gt-1119"><a href="#MultisetExpression.compair_gt-1119"><span class="linenos">1119</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression.compair_gt-1120"><a href="#MultisetExpression.compair_gt-1120"><span class="linenos">1120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt; `other`.</span>
</span><span id="MultisetExpression.compair_gt-1121"><a href="#MultisetExpression.compair_gt-1121"><span class="linenos">1121</span></a>
</span><span id="MultisetExpression.compair_gt-1122"><a href="#MultisetExpression.compair_gt-1122"><span class="linenos">1122</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression.compair_gt-1123"><a href="#MultisetExpression.compair_gt-1123"><span class="linenos">1123</span></a>
</span><span id="MultisetExpression.compair_gt-1124"><a href="#MultisetExpression.compair_gt-1124"><span class="linenos">1124</span></a><span class="sd">        Example: number of armies destroyed by the attacker in a </span>
</span><span id="MultisetExpression.compair_gt-1125"><a href="#MultisetExpression.compair_gt-1125"><span class="linenos">1125</span></a><span class="sd">        3v2 attack in *RISK*:</span>
</span><span id="MultisetExpression.compair_gt-1126"><a href="#MultisetExpression.compair_gt-1126"><span class="linenos">1126</span></a><span class="sd">        ```python</span>
</span><span id="MultisetExpression.compair_gt-1127"><a href="#MultisetExpression.compair_gt-1127"><span class="linenos">1127</span></a><span class="sd">        d6.pool(3).compair_gt(d6.pool(2))</span>
</span><span id="MultisetExpression.compair_gt-1128"><a href="#MultisetExpression.compair_gt-1128"><span class="linenos">1128</span></a><span class="sd">        ```</span>
</span><span id="MultisetExpression.compair_gt-1129"><a href="#MultisetExpression.compair_gt-1129"><span class="linenos">1129</span></a>
</span><span id="MultisetExpression.compair_gt-1130"><a href="#MultisetExpression.compair_gt-1130"><span class="linenos">1130</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.compair_gt-1131"><a href="#MultisetExpression.compair_gt-1131"><span class="linenos">1131</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression.compair_gt-1132"><a href="#MultisetExpression.compair_gt-1132"><span class="linenos">1132</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression.compair_gt-1133"><a href="#MultisetExpression.compair_gt-1133"><span class="linenos">1133</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression.compair_gt-1134"><a href="#MultisetExpression.compair_gt-1134"><span class="linenos">1134</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.compair_gt-1135"><a href="#MultisetExpression.compair_gt-1135"><span class="linenos">1135</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.compair_gt-1136"><a href="#MultisetExpression.compair_gt-1136"><span class="linenos">1136</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_gt-1137"><a href="#MultisetExpression.compair_gt-1137"><span class="linenos">1137</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_gt-1138"><a href="#MultisetExpression.compair_gt-1138"><span class="linenos">1138</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_gt-1139"><a href="#MultisetExpression.compair_gt-1139"><span class="linenos">1139</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_gt-1140"><a href="#MultisetExpression.compair_gt-1140"><span class="linenos">1140</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_gt-1141"><a href="#MultisetExpression.compair_gt-1141"><span class="linenos">1141</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs <code>self</code> is &gt; <code>other</code>.</p>

<p>Any extra unpaired elements do not affect the result.</p>

<p>Example: number of armies destroyed by the attacker in a 
3v2 attack in <em>RISK</em>:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">d6</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">compair_gt</span><span class="p">(</span><span class="n">d6</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre>
</div>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>other:</strong>  The other multiset to compare.</li>
<li><strong>order:</strong>  Which order elements will be matched in.
Default is descending.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.compair_ge" class="classattr">
                                        <input id="MultisetExpression.compair_ge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compair_ge</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Descending">Order.Descending</a></span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.compair_ge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.compair_ge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.compair_ge-1143"><a href="#MultisetExpression.compair_ge-1143"><span class="linenos">1143</span></a>    <span class="k">def</span> <span class="nf">compair_ge</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_ge-1144"><a href="#MultisetExpression.compair_ge-1144"><span class="linenos">1144</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ge-1145"><a href="#MultisetExpression.compair_ge-1145"><span class="linenos">1145</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.compair_ge-1146"><a href="#MultisetExpression.compair_ge-1146"><span class="linenos">1146</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ge-1147"><a href="#MultisetExpression.compair_ge-1147"><span class="linenos">1147</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ge-1148"><a href="#MultisetExpression.compair_ge-1148"><span class="linenos">1148</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression.compair_ge-1149"><a href="#MultisetExpression.compair_ge-1149"><span class="linenos">1149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt;= `other`.</span>
</span><span id="MultisetExpression.compair_ge-1150"><a href="#MultisetExpression.compair_ge-1150"><span class="linenos">1150</span></a>
</span><span id="MultisetExpression.compair_ge-1151"><a href="#MultisetExpression.compair_ge-1151"><span class="linenos">1151</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression.compair_ge-1152"><a href="#MultisetExpression.compair_ge-1152"><span class="linenos">1152</span></a>
</span><span id="MultisetExpression.compair_ge-1153"><a href="#MultisetExpression.compair_ge-1153"><span class="linenos">1153</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.compair_ge-1154"><a href="#MultisetExpression.compair_ge-1154"><span class="linenos">1154</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression.compair_ge-1155"><a href="#MultisetExpression.compair_ge-1155"><span class="linenos">1155</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression.compair_ge-1156"><a href="#MultisetExpression.compair_ge-1156"><span class="linenos">1156</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression.compair_ge-1157"><a href="#MultisetExpression.compair_ge-1157"><span class="linenos">1157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.compair_ge-1158"><a href="#MultisetExpression.compair_ge-1158"><span class="linenos">1158</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.compair_ge-1159"><a href="#MultisetExpression.compair_ge-1159"><span class="linenos">1159</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ge-1160"><a href="#MultisetExpression.compair_ge-1160"><span class="linenos">1160</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_ge-1161"><a href="#MultisetExpression.compair_ge-1161"><span class="linenos">1161</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ge-1162"><a href="#MultisetExpression.compair_ge-1162"><span class="linenos">1162</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ge-1163"><a href="#MultisetExpression.compair_ge-1163"><span class="linenos">1163</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ge-1164"><a href="#MultisetExpression.compair_ge-1164"><span class="linenos">1164</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs <code>self</code> is &gt;= <code>other</code>.</p>

<p>Any extra unpaired elements do not affect the result.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>other:</strong>  The other multiset to compare.</li>
<li><strong>order:</strong>  Which order elements will be matched in.
Default is descending.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.compair_eq" class="classattr">
                                        <input id="MultisetExpression.compair_eq-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compair_eq</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Descending">Order.Descending</a></span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.compair_eq-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.compair_eq"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.compair_eq-1166"><a href="#MultisetExpression.compair_eq-1166"><span class="linenos">1166</span></a>    <span class="k">def</span> <span class="nf">compair_eq</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_eq-1167"><a href="#MultisetExpression.compair_eq-1167"><span class="linenos">1167</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_eq-1168"><a href="#MultisetExpression.compair_eq-1168"><span class="linenos">1168</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.compair_eq-1169"><a href="#MultisetExpression.compair_eq-1169"><span class="linenos">1169</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_eq-1170"><a href="#MultisetExpression.compair_eq-1170"><span class="linenos">1170</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_eq-1171"><a href="#MultisetExpression.compair_eq-1171"><span class="linenos">1171</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression.compair_eq-1172"><a href="#MultisetExpression.compair_eq-1172"><span class="linenos">1172</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt;= `other`.</span>
</span><span id="MultisetExpression.compair_eq-1173"><a href="#MultisetExpression.compair_eq-1173"><span class="linenos">1173</span></a>
</span><span id="MultisetExpression.compair_eq-1174"><a href="#MultisetExpression.compair_eq-1174"><span class="linenos">1174</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression.compair_eq-1175"><a href="#MultisetExpression.compair_eq-1175"><span class="linenos">1175</span></a>
</span><span id="MultisetExpression.compair_eq-1176"><a href="#MultisetExpression.compair_eq-1176"><span class="linenos">1176</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.compair_eq-1177"><a href="#MultisetExpression.compair_eq-1177"><span class="linenos">1177</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression.compair_eq-1178"><a href="#MultisetExpression.compair_eq-1178"><span class="linenos">1178</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression.compair_eq-1179"><a href="#MultisetExpression.compair_eq-1179"><span class="linenos">1179</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression.compair_eq-1180"><a href="#MultisetExpression.compair_eq-1180"><span class="linenos">1180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.compair_eq-1181"><a href="#MultisetExpression.compair_eq-1181"><span class="linenos">1181</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.compair_eq-1182"><a href="#MultisetExpression.compair_eq-1182"><span class="linenos">1182</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_eq-1183"><a href="#MultisetExpression.compair_eq-1183"><span class="linenos">1183</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_eq-1184"><a href="#MultisetExpression.compair_eq-1184"><span class="linenos">1184</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_eq-1185"><a href="#MultisetExpression.compair_eq-1185"><span class="linenos">1185</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_eq-1186"><a href="#MultisetExpression.compair_eq-1186"><span class="linenos">1186</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_eq-1187"><a href="#MultisetExpression.compair_eq-1187"><span class="linenos">1187</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs <code>self</code> is &gt;= <code>other</code>.</p>

<p>Any extra unpaired elements do not affect the result.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>other:</strong>  The other multiset to compare.</li>
<li><strong>order:</strong>  Which order elements will be matched in.
Default is descending.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetExpression.compair_ne" class="classattr">
                                        <input id="MultisetExpression.compair_ne-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compair_ne</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span> <span class="o">=</span> <span class="o">&lt;</span><span class="n"><a href="#Order.Descending">Order.Descending</a></span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetExpression.compair_ne-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetExpression.compair_ne"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetExpression.compair_ne-1189"><a href="#MultisetExpression.compair_ne-1189"><span class="linenos">1189</span></a>    <span class="k">def</span> <span class="nf">compair_ne</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_ne-1190"><a href="#MultisetExpression.compair_ne-1190"><span class="linenos">1190</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ne-1191"><a href="#MultisetExpression.compair_ne-1191"><span class="linenos">1191</span></a>            <span class="n">other</span><span class="p">:</span>
</span><span id="MultisetExpression.compair_ne-1192"><a href="#MultisetExpression.compair_ne-1192"><span class="linenos">1192</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ne-1193"><a href="#MultisetExpression.compair_ne-1193"><span class="linenos">1193</span></a>            <span class="o">*</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ne-1194"><a href="#MultisetExpression.compair_ne-1194"><span class="linenos">1194</span></a>            <span class="n">order</span><span class="p">:</span> <span class="n">Order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span><span class="p">):</span>
</span><span id="MultisetExpression.compair_ne-1195"><a href="#MultisetExpression.compair_ne-1195"><span class="linenos">1195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs `self` is &gt;= `other`.</span>
</span><span id="MultisetExpression.compair_ne-1196"><a href="#MultisetExpression.compair_ne-1196"><span class="linenos">1196</span></a>
</span><span id="MultisetExpression.compair_ne-1197"><a href="#MultisetExpression.compair_ne-1197"><span class="linenos">1197</span></a><span class="sd">        Any extra unpaired elements do not affect the result.</span>
</span><span id="MultisetExpression.compair_ne-1198"><a href="#MultisetExpression.compair_ne-1198"><span class="linenos">1198</span></a>
</span><span id="MultisetExpression.compair_ne-1199"><a href="#MultisetExpression.compair_ne-1199"><span class="linenos">1199</span></a><span class="sd">        Args:</span>
</span><span id="MultisetExpression.compair_ne-1200"><a href="#MultisetExpression.compair_ne-1200"><span class="linenos">1200</span></a><span class="sd">            other: The other multiset to compare.</span>
</span><span id="MultisetExpression.compair_ne-1201"><a href="#MultisetExpression.compair_ne-1201"><span class="linenos">1201</span></a><span class="sd">            order: Which order elements will be matched in.</span>
</span><span id="MultisetExpression.compair_ne-1202"><a href="#MultisetExpression.compair_ne-1202"><span class="linenos">1202</span></a><span class="sd">                Default is descending.</span>
</span><span id="MultisetExpression.compair_ne-1203"><a href="#MultisetExpression.compair_ne-1203"><span class="linenos">1203</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetExpression.compair_ne-1204"><a href="#MultisetExpression.compair_ne-1204"><span class="linenos">1204</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="MultisetExpression.compair_ne-1205"><a href="#MultisetExpression.compair_ne-1205"><span class="linenos">1205</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ne-1206"><a href="#MultisetExpression.compair_ne-1206"><span class="linenos">1206</span></a>                             <span class="n">evaluator</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">evaluator</span><span class="o">.</span><span class="n">CompairEvalautor</span><span class="p">(</span>
</span><span id="MultisetExpression.compair_ne-1207"><a href="#MultisetExpression.compair_ne-1207"><span class="linenos">1207</span></a>                                 <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ne-1208"><a href="#MultisetExpression.compair_ne-1208"><span class="linenos">1208</span></a>                                 <span class="n">tie</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ne-1209"><a href="#MultisetExpression.compair_ne-1209"><span class="linenos">1209</span></a>                                 <span class="n">left_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MultisetExpression.compair_ne-1210"><a href="#MultisetExpression.compair_ne-1210"><span class="linenos">1210</span></a>                                 <span class="n">right_greater</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluation: EXPERIMENTAL: Compare pairs of elements in sorted order, counting how many pairs <code>self</code> is &gt;= <code>other</code>.</p>

<p>Any extra unpaired elements do not affect the result.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>other:</strong>  The other multiset to compare.</li>
<li><strong>order:</strong>  Which order elements will be matched in.
Default is descending.</li>
</ul>
</div>


                            </div>
                </section>
                <section id="MultisetEvaluator">
                            <input id="MultisetEvaluator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MultisetEvaluator</span><wbr>(<span class="base">abc.ABC</span>, <span class="base">typing.Generic[-T_contra, +U_co]</span>):

                <label class="view-source-button" for="MultisetEvaluator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator-26"><a href="#MultisetEvaluator-26"><span class="linenos"> 26</span></a><span class="k">class</span> <span class="nc">MultisetEvaluator</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">]):</span>
</span><span id="MultisetEvaluator-27"><a href="#MultisetEvaluator-27"><span class="linenos"> 27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An abstract, immutable, callable class for evaulating one or more `MultisetGenerator`s.</span>
</span><span id="MultisetEvaluator-28"><a href="#MultisetEvaluator-28"><span class="linenos"> 28</span></a>
</span><span id="MultisetEvaluator-29"><a href="#MultisetEvaluator-29"><span class="linenos"> 29</span></a><span class="sd">    There is one abstract method to implement: `next_state()`.</span>
</span><span id="MultisetEvaluator-30"><a href="#MultisetEvaluator-30"><span class="linenos"> 30</span></a><span class="sd">    This should incrementally calculate the result given one outcome at a time</span>
</span><span id="MultisetEvaluator-31"><a href="#MultisetEvaluator-31"><span class="linenos"> 31</span></a><span class="sd">    along with how many of that outcome were produced.</span>
</span><span id="MultisetEvaluator-32"><a href="#MultisetEvaluator-32"><span class="linenos"> 32</span></a>
</span><span id="MultisetEvaluator-33"><a href="#MultisetEvaluator-33"><span class="linenos"> 33</span></a><span class="sd">    An example sequence of calls, as far as `next_state()` is concerned, is:</span>
</span><span id="MultisetEvaluator-34"><a href="#MultisetEvaluator-34"><span class="linenos"> 34</span></a>
</span><span id="MultisetEvaluator-35"><a href="#MultisetEvaluator-35"><span class="linenos"> 35</span></a><span class="sd">    1. `state = next_state(state=None, outcome=1, count_of_1s)`</span>
</span><span id="MultisetEvaluator-36"><a href="#MultisetEvaluator-36"><span class="linenos"> 36</span></a><span class="sd">    2. `state = next_state(state, 2, count_of_2s)`</span>
</span><span id="MultisetEvaluator-37"><a href="#MultisetEvaluator-37"><span class="linenos"> 37</span></a><span class="sd">    3. `state = next_state(state, 3, count_of_3s)`</span>
</span><span id="MultisetEvaluator-38"><a href="#MultisetEvaluator-38"><span class="linenos"> 38</span></a><span class="sd">    4. `state = next_state(state, 4, count_of_4s)`</span>
</span><span id="MultisetEvaluator-39"><a href="#MultisetEvaluator-39"><span class="linenos"> 39</span></a><span class="sd">    5. `state = next_state(state, 5, count_of_5s)`</span>
</span><span id="MultisetEvaluator-40"><a href="#MultisetEvaluator-40"><span class="linenos"> 40</span></a><span class="sd">    6. `state = next_state(state, 6, count_of_6s)`</span>
</span><span id="MultisetEvaluator-41"><a href="#MultisetEvaluator-41"><span class="linenos"> 41</span></a><span class="sd">    7. `outcome = final_outcome(state)`</span>
</span><span id="MultisetEvaluator-42"><a href="#MultisetEvaluator-42"><span class="linenos"> 42</span></a>
</span><span id="MultisetEvaluator-43"><a href="#MultisetEvaluator-43"><span class="linenos"> 43</span></a><span class="sd">    A few other methods can optionally be overridden to further customize behavior.</span>
</span><span id="MultisetEvaluator-44"><a href="#MultisetEvaluator-44"><span class="linenos"> 44</span></a>
</span><span id="MultisetEvaluator-45"><a href="#MultisetEvaluator-45"><span class="linenos"> 45</span></a><span class="sd">    It is not expected that subclasses of `MultisetEvaluator`</span>
</span><span id="MultisetEvaluator-46"><a href="#MultisetEvaluator-46"><span class="linenos"> 46</span></a><span class="sd">    be able to handle arbitrary types or numbers of generators.</span>
</span><span id="MultisetEvaluator-47"><a href="#MultisetEvaluator-47"><span class="linenos"> 47</span></a><span class="sd">    Indeed, most are expected to handle only a fixed number of generators,</span>
</span><span id="MultisetEvaluator-48"><a href="#MultisetEvaluator-48"><span class="linenos"> 48</span></a><span class="sd">    and often even only generators with a particular type of `Die`.</span>
</span><span id="MultisetEvaluator-49"><a href="#MultisetEvaluator-49"><span class="linenos"> 49</span></a>
</span><span id="MultisetEvaluator-50"><a href="#MultisetEvaluator-50"><span class="linenos"> 50</span></a><span class="sd">    Instances cache all intermediate state distributions.</span>
</span><span id="MultisetEvaluator-51"><a href="#MultisetEvaluator-51"><span class="linenos"> 51</span></a><span class="sd">    You should therefore reuse instances when possible.</span>
</span><span id="MultisetEvaluator-52"><a href="#MultisetEvaluator-52"><span class="linenos"> 52</span></a>
</span><span id="MultisetEvaluator-53"><a href="#MultisetEvaluator-53"><span class="linenos"> 53</span></a><span class="sd">    Instances should not be modified after construction</span>
</span><span id="MultisetEvaluator-54"><a href="#MultisetEvaluator-54"><span class="linenos"> 54</span></a><span class="sd">    in any way that affects the return values of these methods.</span>
</span><span id="MultisetEvaluator-55"><a href="#MultisetEvaluator-55"><span class="linenos"> 55</span></a><span class="sd">    Otherwise, values in the cache may be incorrect.</span>
</span><span id="MultisetEvaluator-56"><a href="#MultisetEvaluator-56"><span class="linenos"> 56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-57"><a href="#MultisetEvaluator-57"><span class="linenos"> 57</span></a>
</span><span id="MultisetEvaluator-58"><a href="#MultisetEvaluator-58"><span class="linenos"> 58</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetEvaluator-59"><a href="#MultisetEvaluator-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">:</span>
</span><span id="MultisetEvaluator-60"><a href="#MultisetEvaluator-60"><span class="linenos"> 60</span></a>                   <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="MultisetEvaluator-61"><a href="#MultisetEvaluator-61"><span class="linenos"> 61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;State transition function.</span>
</span><span id="MultisetEvaluator-62"><a href="#MultisetEvaluator-62"><span class="linenos"> 62</span></a>
</span><span id="MultisetEvaluator-63"><a href="#MultisetEvaluator-63"><span class="linenos"> 63</span></a><span class="sd">        This should produce a state given the previous state, an outcome,</span>
</span><span id="MultisetEvaluator-64"><a href="#MultisetEvaluator-64"><span class="linenos"> 64</span></a><span class="sd">        and the number that outcome produced by each generator.</span>
</span><span id="MultisetEvaluator-65"><a href="#MultisetEvaluator-65"><span class="linenos"> 65</span></a>
</span><span id="MultisetEvaluator-66"><a href="#MultisetEvaluator-66"><span class="linenos"> 66</span></a><span class="sd">        `evaluate()` will always call this using only positional arguments.</span>
</span><span id="MultisetEvaluator-67"><a href="#MultisetEvaluator-67"><span class="linenos"> 67</span></a><span class="sd">        Furthermore, there is no expectation that a subclass be able to handle</span>
</span><span id="MultisetEvaluator-68"><a href="#MultisetEvaluator-68"><span class="linenos"> 68</span></a><span class="sd">        an arbitrary number of counts. Thus, you are free to rename any of</span>
</span><span id="MultisetEvaluator-69"><a href="#MultisetEvaluator-69"><span class="linenos"> 69</span></a><span class="sd">        the parameters in a subclass, or to replace `*counts` with a fixed set</span>
</span><span id="MultisetEvaluator-70"><a href="#MultisetEvaluator-70"><span class="linenos"> 70</span></a><span class="sd">        of parameters.</span>
</span><span id="MultisetEvaluator-71"><a href="#MultisetEvaluator-71"><span class="linenos"> 71</span></a>
</span><span id="MultisetEvaluator-72"><a href="#MultisetEvaluator-72"><span class="linenos"> 72</span></a><span class="sd">        Make sure to handle the base case where `state is None`.</span>
</span><span id="MultisetEvaluator-73"><a href="#MultisetEvaluator-73"><span class="linenos"> 73</span></a>
</span><span id="MultisetEvaluator-74"><a href="#MultisetEvaluator-74"><span class="linenos"> 74</span></a><span class="sd">        States must be hashable. At current, they do not have to be orderable.</span>
</span><span id="MultisetEvaluator-75"><a href="#MultisetEvaluator-75"><span class="linenos"> 75</span></a><span class="sd">        However, this may change in the future, and if they are not totally</span>
</span><span id="MultisetEvaluator-76"><a href="#MultisetEvaluator-76"><span class="linenos"> 76</span></a><span class="sd">        orderable, you must override `final_outcome` to create totally orderable</span>
</span><span id="MultisetEvaluator-77"><a href="#MultisetEvaluator-77"><span class="linenos"> 77</span></a><span class="sd">        final outcomes.</span>
</span><span id="MultisetEvaluator-78"><a href="#MultisetEvaluator-78"><span class="linenos"> 78</span></a>
</span><span id="MultisetEvaluator-79"><a href="#MultisetEvaluator-79"><span class="linenos"> 79</span></a><span class="sd">        The behavior of returning a `Die` from `next_state` is currently</span>
</span><span id="MultisetEvaluator-80"><a href="#MultisetEvaluator-80"><span class="linenos"> 80</span></a><span class="sd">        undefined.</span>
</span><span id="MultisetEvaluator-81"><a href="#MultisetEvaluator-81"><span class="linenos"> 81</span></a>
</span><span id="MultisetEvaluator-82"><a href="#MultisetEvaluator-82"><span class="linenos"> 82</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator-83"><a href="#MultisetEvaluator-83"><span class="linenos"> 83</span></a><span class="sd">            state: A hashable object indicating the state before rolling the</span>
</span><span id="MultisetEvaluator-84"><a href="#MultisetEvaluator-84"><span class="linenos"> 84</span></a><span class="sd">                current outcome. If this is the first outcome being considered,</span>
</span><span id="MultisetEvaluator-85"><a href="#MultisetEvaluator-85"><span class="linenos"> 85</span></a><span class="sd">                `state` will be `None`.</span>
</span><span id="MultisetEvaluator-86"><a href="#MultisetEvaluator-86"><span class="linenos"> 86</span></a><span class="sd">            outcome: The current outcome.</span>
</span><span id="MultisetEvaluator-87"><a href="#MultisetEvaluator-87"><span class="linenos"> 87</span></a><span class="sd">                `next_state` will see all rolled outcomes in monotonic order;</span>
</span><span id="MultisetEvaluator-88"><a href="#MultisetEvaluator-88"><span class="linenos"> 88</span></a><span class="sd">                either ascending or descending depending on `order()`.</span>
</span><span id="MultisetEvaluator-89"><a href="#MultisetEvaluator-89"><span class="linenos"> 89</span></a><span class="sd">                If there are multiple generators, the set of outcomes is the</span>
</span><span id="MultisetEvaluator-90"><a href="#MultisetEvaluator-90"><span class="linenos"> 90</span></a><span class="sd">                union of the outcomes of the invididual generators. All outcomes</span>
</span><span id="MultisetEvaluator-91"><a href="#MultisetEvaluator-91"><span class="linenos"> 91</span></a><span class="sd">                with nonzero count will be seen. Outcomes with zero count</span>
</span><span id="MultisetEvaluator-92"><a href="#MultisetEvaluator-92"><span class="linenos"> 92</span></a><span class="sd">                may or may not be seen. If you need to enforce that certain</span>
</span><span id="MultisetEvaluator-93"><a href="#MultisetEvaluator-93"><span class="linenos"> 93</span></a><span class="sd">                outcomes are seen even if they have zero count, see</span>
</span><span id="MultisetEvaluator-94"><a href="#MultisetEvaluator-94"><span class="linenos"> 94</span></a><span class="sd">                `alignment()`.</span>
</span><span id="MultisetEvaluator-95"><a href="#MultisetEvaluator-95"><span class="linenos"> 95</span></a><span class="sd">            *counts: One value (usually an `int`) for each generator output</span>
</span><span id="MultisetEvaluator-96"><a href="#MultisetEvaluator-96"><span class="linenos"> 96</span></a><span class="sd">                indicating how many of the current outcome were produced.</span>
</span><span id="MultisetEvaluator-97"><a href="#MultisetEvaluator-97"><span class="linenos"> 97</span></a><span class="sd">                All outcomes with nonzero count are guaranteed to be seen.</span>
</span><span id="MultisetEvaluator-98"><a href="#MultisetEvaluator-98"><span class="linenos"> 98</span></a><span class="sd">                To guarantee that outcomes are seen even if they have zero</span>
</span><span id="MultisetEvaluator-99"><a href="#MultisetEvaluator-99"><span class="linenos"> 99</span></a><span class="sd">                count, override `alignment()`.</span>
</span><span id="MultisetEvaluator-100"><a href="#MultisetEvaluator-100"><span class="linenos">100</span></a>
</span><span id="MultisetEvaluator-101"><a href="#MultisetEvaluator-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-102"><a href="#MultisetEvaluator-102"><span class="linenos">102</span></a><span class="sd">            A hashable object indicating the next state.</span>
</span><span id="MultisetEvaluator-103"><a href="#MultisetEvaluator-103"><span class="linenos">103</span></a><span class="sd">            The special value `icepool.Reroll` can be used to immediately remove</span>
</span><span id="MultisetEvaluator-104"><a href="#MultisetEvaluator-104"><span class="linenos">104</span></a><span class="sd">            the state from consideration, effectively performing a full reroll.</span>
</span><span id="MultisetEvaluator-105"><a href="#MultisetEvaluator-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-106"><a href="#MultisetEvaluator-106"><span class="linenos">106</span></a>
</span><span id="MultisetEvaluator-107"><a href="#MultisetEvaluator-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span>
</span><span id="MultisetEvaluator-108"><a href="#MultisetEvaluator-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">:</span> <span class="n">Hashable</span>
</span><span id="MultisetEvaluator-109"><a href="#MultisetEvaluator-109"><span class="linenos">109</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;U_co | icepool.Die[U_co] | icepool.RerollType&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-110"><a href="#MultisetEvaluator-110"><span class="linenos">110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional function to generate a final outcome from a final state.</span>
</span><span id="MultisetEvaluator-111"><a href="#MultisetEvaluator-111"><span class="linenos">111</span></a>
</span><span id="MultisetEvaluator-112"><a href="#MultisetEvaluator-112"><span class="linenos">112</span></a><span class="sd">        By default, the final outcome is equal to the final state.</span>
</span><span id="MultisetEvaluator-113"><a href="#MultisetEvaluator-113"><span class="linenos">113</span></a><span class="sd">        Note that `None` is not a valid outcome for a `Die`,</span>
</span><span id="MultisetEvaluator-114"><a href="#MultisetEvaluator-114"><span class="linenos">114</span></a><span class="sd">        and if there are no outcomes, `final_outcome` will be immediately</span>
</span><span id="MultisetEvaluator-115"><a href="#MultisetEvaluator-115"><span class="linenos">115</span></a><span class="sd">        be callled with `final_state=None`.</span>
</span><span id="MultisetEvaluator-116"><a href="#MultisetEvaluator-116"><span class="linenos">116</span></a><span class="sd">        Subclasses that want to handle this case should explicitly define what</span>
</span><span id="MultisetEvaluator-117"><a href="#MultisetEvaluator-117"><span class="linenos">117</span></a><span class="sd">        happens.</span>
</span><span id="MultisetEvaluator-118"><a href="#MultisetEvaluator-118"><span class="linenos">118</span></a>
</span><span id="MultisetEvaluator-119"><a href="#MultisetEvaluator-119"><span class="linenos">119</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator-120"><a href="#MultisetEvaluator-120"><span class="linenos">120</span></a><span class="sd">            final_state: A state after all outcomes have been processed.</span>
</span><span id="MultisetEvaluator-121"><a href="#MultisetEvaluator-121"><span class="linenos">121</span></a>
</span><span id="MultisetEvaluator-122"><a href="#MultisetEvaluator-122"><span class="linenos">122</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-123"><a href="#MultisetEvaluator-123"><span class="linenos">123</span></a><span class="sd">            A final outcome that will be used as part of constructing the result `Die`.</span>
</span><span id="MultisetEvaluator-124"><a href="#MultisetEvaluator-124"><span class="linenos">124</span></a><span class="sd">            As usual for `Die()`, this could itself be a `Die` or `icepool.Reroll`.</span>
</span><span id="MultisetEvaluator-125"><a href="#MultisetEvaluator-125"><span class="linenos">125</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-126"><a href="#MultisetEvaluator-126"><span class="linenos">126</span></a>        <span class="c1"># If not overriden, the final_state should have type U_co.</span>
</span><span id="MultisetEvaluator-127"><a href="#MultisetEvaluator-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">U_co</span><span class="p">,</span> <span class="n">final_state</span><span class="p">)</span>
</span><span id="MultisetEvaluator-128"><a href="#MultisetEvaluator-128"><span class="linenos">128</span></a>
</span><span id="MultisetEvaluator-129"><a href="#MultisetEvaluator-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="MultisetEvaluator-130"><a href="#MultisetEvaluator-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional function to determine the order in which `next_state()` will see outcomes.</span>
</span><span id="MultisetEvaluator-131"><a href="#MultisetEvaluator-131"><span class="linenos">131</span></a>
</span><span id="MultisetEvaluator-132"><a href="#MultisetEvaluator-132"><span class="linenos">132</span></a><span class="sd">        The default is ascending order. This has better caching behavior with </span>
</span><span id="MultisetEvaluator-133"><a href="#MultisetEvaluator-133"><span class="linenos">133</span></a><span class="sd">        mixed standard dice.</span>
</span><span id="MultisetEvaluator-134"><a href="#MultisetEvaluator-134"><span class="linenos">134</span></a>
</span><span id="MultisetEvaluator-135"><a href="#MultisetEvaluator-135"><span class="linenos">135</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-136"><a href="#MultisetEvaluator-136"><span class="linenos">136</span></a><span class="sd">            * Order.Ascending (= 1)</span>
</span><span id="MultisetEvaluator-137"><a href="#MultisetEvaluator-137"><span class="linenos">137</span></a><span class="sd">                if `next_state()` should always see the outcomes in ascending order.</span>
</span><span id="MultisetEvaluator-138"><a href="#MultisetEvaluator-138"><span class="linenos">138</span></a><span class="sd">            * Order.Descending (= -1)</span>
</span><span id="MultisetEvaluator-139"><a href="#MultisetEvaluator-139"><span class="linenos">139</span></a><span class="sd">                if `next_state()` should always see the outcomes in descending order.</span>
</span><span id="MultisetEvaluator-140"><a href="#MultisetEvaluator-140"><span class="linenos">140</span></a><span class="sd">            * Order.Any (= 0)</span>
</span><span id="MultisetEvaluator-141"><a href="#MultisetEvaluator-141"><span class="linenos">141</span></a><span class="sd">                if the result of the evaluation is order-independent.</span>
</span><span id="MultisetEvaluator-142"><a href="#MultisetEvaluator-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-143"><a href="#MultisetEvaluator-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="MultisetEvaluator-144"><a href="#MultisetEvaluator-144"><span class="linenos">144</span></a>
</span><span id="MultisetEvaluator-145"><a href="#MultisetEvaluator-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T_contra</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_contra</span><span class="p">]:</span>
</span><span id="MultisetEvaluator-146"><a href="#MultisetEvaluator-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional method to specify additional outcomes that should be seen by `next_state()`.</span>
</span><span id="MultisetEvaluator-147"><a href="#MultisetEvaluator-147"><span class="linenos">147</span></a>
</span><span id="MultisetEvaluator-148"><a href="#MultisetEvaluator-148"><span class="linenos">148</span></a><span class="sd">        These will be seen by `next_state` even if they have zero count or do</span>
</span><span id="MultisetEvaluator-149"><a href="#MultisetEvaluator-149"><span class="linenos">149</span></a><span class="sd">        not appear in the generator(s) at all.</span>
</span><span id="MultisetEvaluator-150"><a href="#MultisetEvaluator-150"><span class="linenos">150</span></a>
</span><span id="MultisetEvaluator-151"><a href="#MultisetEvaluator-151"><span class="linenos">151</span></a><span class="sd">        The default implementation returns `()`; this means outcomes with zero</span>
</span><span id="MultisetEvaluator-152"><a href="#MultisetEvaluator-152"><span class="linenos">152</span></a><span class="sd">        count may or may not be seen by `next_state`.</span>
</span><span id="MultisetEvaluator-153"><a href="#MultisetEvaluator-153"><span class="linenos">153</span></a>
</span><span id="MultisetEvaluator-154"><a href="#MultisetEvaluator-154"><span class="linenos">154</span></a><span class="sd">        If you want `next_state` to see consecutive `int` outcomes, you can set</span>
</span><span id="MultisetEvaluator-155"><a href="#MultisetEvaluator-155"><span class="linenos">155</span></a><span class="sd">        `alignment = icepool.MultisetEvaluator.range_alignment`.</span>
</span><span id="MultisetEvaluator-156"><a href="#MultisetEvaluator-156"><span class="linenos">156</span></a><span class="sd">        See `range_alignment()` below.</span>
</span><span id="MultisetEvaluator-157"><a href="#MultisetEvaluator-157"><span class="linenos">157</span></a>
</span><span id="MultisetEvaluator-158"><a href="#MultisetEvaluator-158"><span class="linenos">158</span></a><span class="sd">        If you want `next_state` to see all generator outcomes, you can return</span>
</span><span id="MultisetEvaluator-159"><a href="#MultisetEvaluator-159"><span class="linenos">159</span></a><span class="sd">        `outcomes` as-is.</span>
</span><span id="MultisetEvaluator-160"><a href="#MultisetEvaluator-160"><span class="linenos">160</span></a>
</span><span id="MultisetEvaluator-161"><a href="#MultisetEvaluator-161"><span class="linenos">161</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator-162"><a href="#MultisetEvaluator-162"><span class="linenos">162</span></a><span class="sd">            outcomes: The outcomes that could be produced by the generators, in</span>
</span><span id="MultisetEvaluator-163"><a href="#MultisetEvaluator-163"><span class="linenos">163</span></a><span class="sd">            ascending order.</span>
</span><span id="MultisetEvaluator-164"><a href="#MultisetEvaluator-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-165"><a href="#MultisetEvaluator-165"><span class="linenos">165</span></a>        <span class="k">return</span> <span class="p">()</span>
</span><span id="MultisetEvaluator-166"><a href="#MultisetEvaluator-166"><span class="linenos">166</span></a>
</span><span id="MultisetEvaluator-167"><a href="#MultisetEvaluator-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="nf">range_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="MultisetEvaluator-168"><a href="#MultisetEvaluator-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Example implementation of `alignment()` that produces consecutive `int` outcomes.</span>
</span><span id="MultisetEvaluator-169"><a href="#MultisetEvaluator-169"><span class="linenos">169</span></a>
</span><span id="MultisetEvaluator-170"><a href="#MultisetEvaluator-170"><span class="linenos">170</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="MultisetEvaluator-171"><a href="#MultisetEvaluator-171"><span class="linenos">171</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="MultisetEvaluator-172"><a href="#MultisetEvaluator-172"><span class="linenos">172</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="MultisetEvaluator-173"><a href="#MultisetEvaluator-173"><span class="linenos">173</span></a><span class="sd">        set of parameters.</span>
</span><span id="MultisetEvaluator-174"><a href="#MultisetEvaluator-174"><span class="linenos">174</span></a>
</span><span id="MultisetEvaluator-175"><a href="#MultisetEvaluator-175"><span class="linenos">175</span></a><span class="sd">        Set `alignment = icepool.MultisetEvaluator.range_alignment` to use this.</span>
</span><span id="MultisetEvaluator-176"><a href="#MultisetEvaluator-176"><span class="linenos">176</span></a>
</span><span id="MultisetEvaluator-177"><a href="#MultisetEvaluator-177"><span class="linenos">177</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-178"><a href="#MultisetEvaluator-178"><span class="linenos">178</span></a><span class="sd">            All `int`s from the min outcome to the max outcome among the generators,</span>
</span><span id="MultisetEvaluator-179"><a href="#MultisetEvaluator-179"><span class="linenos">179</span></a><span class="sd">            inclusive.</span>
</span><span id="MultisetEvaluator-180"><a href="#MultisetEvaluator-180"><span class="linenos">180</span></a>
</span><span id="MultisetEvaluator-181"><a href="#MultisetEvaluator-181"><span class="linenos">181</span></a><span class="sd">        Raises:</span>
</span><span id="MultisetEvaluator-182"><a href="#MultisetEvaluator-182"><span class="linenos">182</span></a><span class="sd">            TypeError: if any generator has any non-`int` outcome.</span>
</span><span id="MultisetEvaluator-183"><a href="#MultisetEvaluator-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-184"><a href="#MultisetEvaluator-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="MultisetEvaluator-185"><a href="#MultisetEvaluator-185"><span class="linenos">185</span></a>            <span class="k">return</span> <span class="p">()</span>
</span><span id="MultisetEvaluator-186"><a href="#MultisetEvaluator-186"><span class="linenos">186</span></a>
</span><span id="MultisetEvaluator-187"><a href="#MultisetEvaluator-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">):</span>
</span><span id="MultisetEvaluator-188"><a href="#MultisetEvaluator-188"><span class="linenos">188</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="MultisetEvaluator-189"><a href="#MultisetEvaluator-189"><span class="linenos">189</span></a>                <span class="s2">&quot;range_alignment cannot be used with outcomes of type other than &#39;int&#39;.&quot;</span>
</span><span id="MultisetEvaluator-190"><a href="#MultisetEvaluator-190"><span class="linenos">190</span></a>            <span class="p">)</span>
</span><span id="MultisetEvaluator-191"><a href="#MultisetEvaluator-191"><span class="linenos">191</span></a>
</span><span id="MultisetEvaluator-192"><a href="#MultisetEvaluator-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outcomes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="MultisetEvaluator-193"><a href="#MultisetEvaluator-193"><span class="linenos">193</span></a>
</span><span id="MultisetEvaluator-194"><a href="#MultisetEvaluator-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">prefix_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator, ...]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-195"><a href="#MultisetEvaluator-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;An optional sequence of extra generators whose counts will be prepended to *counts.&quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-196"><a href="#MultisetEvaluator-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="p">()</span>
</span><span id="MultisetEvaluator-197"><a href="#MultisetEvaluator-197"><span class="linenos">197</span></a>
</span><span id="MultisetEvaluator-198"><a href="#MultisetEvaluator-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">validate_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultisetEvaluator-199"><a href="#MultisetEvaluator-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;An optional method to verify the total input arity.</span>
</span><span id="MultisetEvaluator-200"><a href="#MultisetEvaluator-200"><span class="linenos">200</span></a>
</span><span id="MultisetEvaluator-201"><a href="#MultisetEvaluator-201"><span class="linenos">201</span></a><span class="sd">        This is called after any implicit conversion to generators, but does</span>
</span><span id="MultisetEvaluator-202"><a href="#MultisetEvaluator-202"><span class="linenos">202</span></a><span class="sd">        not include any `extra_generators()`.</span>
</span><span id="MultisetEvaluator-203"><a href="#MultisetEvaluator-203"><span class="linenos">203</span></a>
</span><span id="MultisetEvaluator-204"><a href="#MultisetEvaluator-204"><span class="linenos">204</span></a><span class="sd">        Overriding `next_state` with a fixed number of counts will make this</span>
</span><span id="MultisetEvaluator-205"><a href="#MultisetEvaluator-205"><span class="linenos">205</span></a><span class="sd">        check redundant.</span>
</span><span id="MultisetEvaluator-206"><a href="#MultisetEvaluator-206"><span class="linenos">206</span></a>
</span><span id="MultisetEvaluator-207"><a href="#MultisetEvaluator-207"><span class="linenos">207</span></a><span class="sd">        Raises:</span>
</span><span id="MultisetEvaluator-208"><a href="#MultisetEvaluator-208"><span class="linenos">208</span></a><span class="sd">            `ValueError` if the total input arity is not valid.</span>
</span><span id="MultisetEvaluator-209"><a href="#MultisetEvaluator-209"><span class="linenos">209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-210"><a href="#MultisetEvaluator-210"><span class="linenos">210</span></a>
</span><span id="MultisetEvaluator-211"><a href="#MultisetEvaluator-211"><span class="linenos">211</span></a>    <span class="nd">@cached_property</span>
</span><span id="MultisetEvaluator-212"><a href="#MultisetEvaluator-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="MultisetEvaluator-213"><a href="#MultisetEvaluator-213"><span class="linenos">213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A cache of (order, generators) -&gt; weight distribution over states. &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-214"><a href="#MultisetEvaluator-214"><span class="linenos">214</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="MultisetEvaluator-215"><a href="#MultisetEvaluator-215"><span class="linenos">215</span></a>
</span><span id="MultisetEvaluator-216"><a href="#MultisetEvaluator-216"><span class="linenos">216</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetEvaluator-217"><a href="#MultisetEvaluator-217"><span class="linenos">217</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="MultisetEvaluator-218"><a href="#MultisetEvaluator-218"><span class="linenos">218</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetEvaluator-219"><a href="#MultisetEvaluator-219"><span class="linenos">219</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U_co]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-220"><a href="#MultisetEvaluator-220"><span class="linenos">220</span></a>        <span class="o">...</span>
</span><span id="MultisetEvaluator-221"><a href="#MultisetEvaluator-221"><span class="linenos">221</span></a>
</span><span id="MultisetEvaluator-222"><a href="#MultisetEvaluator-222"><span class="linenos">222</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetEvaluator-223"><a href="#MultisetEvaluator-223"><span class="linenos">223</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="MultisetEvaluator-224"><a href="#MultisetEvaluator-224"><span class="linenos">224</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="s1">&#39;MultisetExpression[T_contra]&#39;</span>
</span><span id="MultisetEvaluator-225"><a href="#MultisetEvaluator-225"><span class="linenos">225</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultisetEvaluator[T_contra, U_co]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-226"><a href="#MultisetEvaluator-226"><span class="linenos">226</span></a>        <span class="o">...</span>
</span><span id="MultisetEvaluator-227"><a href="#MultisetEvaluator-227"><span class="linenos">227</span></a>
</span><span id="MultisetEvaluator-228"><a href="#MultisetEvaluator-228"><span class="linenos">228</span></a>    <span class="nd">@overload</span>
</span><span id="MultisetEvaluator-229"><a href="#MultisetEvaluator-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="MultisetEvaluator-230"><a href="#MultisetEvaluator-230"><span class="linenos">230</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetEvaluator-231"><a href="#MultisetEvaluator-231"><span class="linenos">231</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetEvaluator-232"><a href="#MultisetEvaluator-232"><span class="linenos">232</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U_co] | MultisetEvaluator[T_contra, U_co]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-233"><a href="#MultisetEvaluator-233"><span class="linenos">233</span></a>        <span class="o">...</span>
</span><span id="MultisetEvaluator-234"><a href="#MultisetEvaluator-234"><span class="linenos">234</span></a>
</span><span id="MultisetEvaluator-235"><a href="#MultisetEvaluator-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="MultisetEvaluator-236"><a href="#MultisetEvaluator-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetEvaluator-237"><a href="#MultisetEvaluator-237"><span class="linenos">237</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetEvaluator-238"><a href="#MultisetEvaluator-238"><span class="linenos">238</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U_co] | MultisetEvaluator[T_contra, U_co]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-239"><a href="#MultisetEvaluator-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluates generator(s).</span>
</span><span id="MultisetEvaluator-240"><a href="#MultisetEvaluator-240"><span class="linenos">240</span></a>
</span><span id="MultisetEvaluator-241"><a href="#MultisetEvaluator-241"><span class="linenos">241</span></a><span class="sd">        You can call the `MultisetEvaluator` object directly for the same effect,</span>
</span><span id="MultisetEvaluator-242"><a href="#MultisetEvaluator-242"><span class="linenos">242</span></a><span class="sd">        e.g. `sum_evaluator(generator)` is an alias for `sum_evaluator.evaluate(generator)`.</span>
</span><span id="MultisetEvaluator-243"><a href="#MultisetEvaluator-243"><span class="linenos">243</span></a>
</span><span id="MultisetEvaluator-244"><a href="#MultisetEvaluator-244"><span class="linenos">244</span></a><span class="sd">        Most evaluators will expect a fixed number of input multisets.</span>
</span><span id="MultisetEvaluator-245"><a href="#MultisetEvaluator-245"><span class="linenos">245</span></a><span class="sd">        The union of the outcomes of the generator(s) must be totally orderable.</span>
</span><span id="MultisetEvaluator-246"><a href="#MultisetEvaluator-246"><span class="linenos">246</span></a>
</span><span id="MultisetEvaluator-247"><a href="#MultisetEvaluator-247"><span class="linenos">247</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator-248"><a href="#MultisetEvaluator-248"><span class="linenos">248</span></a><span class="sd">            *args: Each may be one of the following:</span>
</span><span id="MultisetEvaluator-249"><a href="#MultisetEvaluator-249"><span class="linenos">249</span></a><span class="sd">                * A `MultisetExpression`.</span>
</span><span id="MultisetEvaluator-250"><a href="#MultisetEvaluator-250"><span class="linenos">250</span></a><span class="sd">                * A mappable mapping outcomes to the number of those outcomes.</span>
</span><span id="MultisetEvaluator-251"><a href="#MultisetEvaluator-251"><span class="linenos">251</span></a><span class="sd">                * A sequence of outcomes.</span>
</span><span id="MultisetEvaluator-252"><a href="#MultisetEvaluator-252"><span class="linenos">252</span></a>
</span><span id="MultisetEvaluator-253"><a href="#MultisetEvaluator-253"><span class="linenos">253</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-254"><a href="#MultisetEvaluator-254"><span class="linenos">254</span></a><span class="sd">            A `Die` representing the distribution of the final outcome if no</span>
</span><span id="MultisetEvaluator-255"><a href="#MultisetEvaluator-255"><span class="linenos">255</span></a><span class="sd">            arg contains a free variable. Otherwise, returns a new evaluator.</span>
</span><span id="MultisetEvaluator-256"><a href="#MultisetEvaluator-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-257"><a href="#MultisetEvaluator-257"><span class="linenos">257</span></a>        <span class="kn">from</span> <span class="nn">icepool.generator.alignment</span> <span class="kn">import</span> <span class="n">Alignment</span>
</span><span id="MultisetEvaluator-258"><a href="#MultisetEvaluator-258"><span class="linenos">258</span></a>
</span><span id="MultisetEvaluator-259"><a href="#MultisetEvaluator-259"><span class="linenos">259</span></a>        <span class="c1"># Convert arguments to expressions.</span>
</span><span id="MultisetEvaluator-260"><a href="#MultisetEvaluator-260"><span class="linenos">260</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetEvaluator-261"><a href="#MultisetEvaluator-261"><span class="linenos">261</span></a>            <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetEvaluator-262"><a href="#MultisetEvaluator-262"><span class="linenos">262</span></a>
</span><span id="MultisetEvaluator-263"><a href="#MultisetEvaluator-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">_free_arity</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">):</span>
</span><span id="MultisetEvaluator-264"><a href="#MultisetEvaluator-264"><span class="linenos">264</span></a>            <span class="kn">from</span> <span class="nn">icepool.evaluator.expression</span> <span class="kn">import</span> <span class="n">ExpressionEvaluator</span>
</span><span id="MultisetEvaluator-265"><a href="#MultisetEvaluator-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="n">ExpressionEvaluator</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetEvaluator-266"><a href="#MultisetEvaluator-266"><span class="linenos">266</span></a>
</span><span id="MultisetEvaluator-267"><a href="#MultisetEvaluator-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="MultisetEvaluator-268"><a href="#MultisetEvaluator-268"><span class="linenos">268</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">)</span>
</span><span id="MultisetEvaluator-269"><a href="#MultisetEvaluator-269"><span class="linenos">269</span></a>                <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">):</span>
</span><span id="MultisetEvaluator-270"><a href="#MultisetEvaluator-270"><span class="linenos">270</span></a>            <span class="kn">from</span> <span class="nn">icepool.evaluator.expression</span> <span class="kn">import</span> <span class="n">ExpressionEvaluator</span>
</span><span id="MultisetEvaluator-271"><a href="#MultisetEvaluator-271"><span class="linenos">271</span></a>            <span class="k">return</span> <span class="n">ExpressionEvaluator</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="MultisetEvaluator-272"><a href="#MultisetEvaluator-272"><span class="linenos">272</span></a>
</span><span id="MultisetEvaluator-273"><a href="#MultisetEvaluator-273"><span class="linenos">273</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetEvaluator-274"><a href="#MultisetEvaluator-274"><span class="linenos">274</span></a>
</span><span id="MultisetEvaluator-275"><a href="#MultisetEvaluator-275"><span class="linenos">275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate_arity</span><span class="p">(</span>
</span><span id="MultisetEvaluator-276"><a href="#MultisetEvaluator-276"><span class="linenos">276</span></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">output_arity</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">))</span>
</span><span id="MultisetEvaluator-277"><a href="#MultisetEvaluator-277"><span class="linenos">277</span></a>
</span><span id="MultisetEvaluator-278"><a href="#MultisetEvaluator-278"><span class="linenos">278</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_generators</span><span class="p">()</span> <span class="o">+</span> <span class="n">generators</span>
</span><span id="MultisetEvaluator-279"><a href="#MultisetEvaluator-279"><span class="linenos">279</span></a>
</span><span id="MultisetEvaluator-280"><a href="#MultisetEvaluator-280"><span class="linenos">280</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">_is_resolvable</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">):</span>
</span><span id="MultisetEvaluator-281"><a href="#MultisetEvaluator-281"><span class="linenos">281</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([])</span>
</span><span id="MultisetEvaluator-282"><a href="#MultisetEvaluator-282"><span class="linenos">282</span></a>
</span><span id="MultisetEvaluator-283"><a href="#MultisetEvaluator-283"><span class="linenos">283</span></a>        <span class="n">algorithm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_algorithm</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-284"><a href="#MultisetEvaluator-284"><span class="linenos">284</span></a>
</span><span id="MultisetEvaluator-285"><a href="#MultisetEvaluator-285"><span class="linenos">285</span></a>        <span class="c1"># We use a separate class to guarantee all outcomes are visited.</span>
</span><span id="MultisetEvaluator-286"><a href="#MultisetEvaluator-286"><span class="linenos">286</span></a>        <span class="n">outcomes</span> <span class="o">=</span> <span class="n">sorted_union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="MultisetEvaluator-287"><a href="#MultisetEvaluator-287"><span class="linenos">287</span></a>                                  <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">))</span>
</span><span id="MultisetEvaluator-288"><a href="#MultisetEvaluator-288"><span class="linenos">288</span></a>        <span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="n">outcomes</span><span class="p">))</span>
</span><span id="MultisetEvaluator-289"><a href="#MultisetEvaluator-289"><span class="linenos">289</span></a>
</span><span id="MultisetEvaluator-290"><a href="#MultisetEvaluator-290"><span class="linenos">290</span></a>        <span class="n">dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="MultisetEvaluator-291"><a href="#MultisetEvaluator-291"><span class="linenos">291</span></a>        <span class="n">iterators</span> <span class="o">=</span> <span class="n">MultisetEvaluator</span><span class="o">.</span><span class="n">_initialize_generators</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-292"><a href="#MultisetEvaluator-292"><span class="linenos">292</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">):</span>
</span><span id="MultisetEvaluator-293"><a href="#MultisetEvaluator-293"><span class="linenos">293</span></a>            <span class="n">sub_generators</span><span class="p">,</span> <span class="n">sub_weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span><span id="MultisetEvaluator-294"><a href="#MultisetEvaluator-294"><span class="linenos">294</span></a>            <span class="n">prod_weight</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">sub_weights</span><span class="p">)</span>
</span><span id="MultisetEvaluator-295"><a href="#MultisetEvaluator-295"><span class="linenos">295</span></a>            <span class="n">sub_result</span> <span class="o">=</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">sub_generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-296"><a href="#MultisetEvaluator-296"><span class="linenos">296</span></a>            <span class="k">for</span> <span class="n">sub_state</span><span class="p">,</span> <span class="n">sub_weight</span> <span class="ow">in</span> <span class="n">sub_result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MultisetEvaluator-297"><a href="#MultisetEvaluator-297"><span class="linenos">297</span></a>                <span class="n">dist</span><span class="p">[</span><span class="n">sub_state</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sub_weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="MultisetEvaluator-298"><a href="#MultisetEvaluator-298"><span class="linenos">298</span></a>
</span><span id="MultisetEvaluator-299"><a href="#MultisetEvaluator-299"><span class="linenos">299</span></a>        <span class="n">final_outcomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MultisetEvaluator-300"><a href="#MultisetEvaluator-300"><span class="linenos">300</span></a>        <span class="n">final_weights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MultisetEvaluator-301"><a href="#MultisetEvaluator-301"><span class="linenos">301</span></a>        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MultisetEvaluator-302"><a href="#MultisetEvaluator-302"><span class="linenos">302</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="MultisetEvaluator-303"><a href="#MultisetEvaluator-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultisetEvaluator-304"><a href="#MultisetEvaluator-304"><span class="linenos">304</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="MultisetEvaluator-305"><a href="#MultisetEvaluator-305"><span class="linenos">305</span></a>                    <span class="s2">&quot;None is not a valid final outcome.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="MultisetEvaluator-306"><a href="#MultisetEvaluator-306"><span class="linenos">306</span></a>                    <span class="s2">&quot;This may have been a result of not supplying any generator with an outcome.&quot;</span>
</span><span id="MultisetEvaluator-307"><a href="#MultisetEvaluator-307"><span class="linenos">307</span></a>                <span class="p">)</span>
</span><span id="MultisetEvaluator-308"><a href="#MultisetEvaluator-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="MultisetEvaluator-309"><a href="#MultisetEvaluator-309"><span class="linenos">309</span></a>                <span class="n">final_outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="MultisetEvaluator-310"><a href="#MultisetEvaluator-310"><span class="linenos">310</span></a>                <span class="n">final_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span><span id="MultisetEvaluator-311"><a href="#MultisetEvaluator-311"><span class="linenos">311</span></a>
</span><span id="MultisetEvaluator-312"><a href="#MultisetEvaluator-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">final_outcomes</span><span class="p">,</span> <span class="n">final_weights</span><span class="p">)</span>
</span><span id="MultisetEvaluator-313"><a href="#MultisetEvaluator-313"><span class="linenos">313</span></a>
</span><span id="MultisetEvaluator-314"><a href="#MultisetEvaluator-314"><span class="linenos">314</span></a>    <span class="fm">__call__</span> <span class="o">=</span> <span class="n">evaluate</span>
</span><span id="MultisetEvaluator-315"><a href="#MultisetEvaluator-315"><span class="linenos">315</span></a>
</span><span id="MultisetEvaluator-316"><a href="#MultisetEvaluator-316"><span class="linenos">316</span></a>    <span class="k">def</span> <span class="nf">_select_algorithm</span><span class="p">(</span>
</span><span id="MultisetEvaluator-317"><a href="#MultisetEvaluator-317"><span class="linenos">317</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="s1">&#39;icepool.MultisetGenerator[T_contra, Any]&#39;</span>
</span><span id="MultisetEvaluator-318"><a href="#MultisetEvaluator-318"><span class="linenos">318</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span id="MultisetEvaluator-319"><a href="#MultisetEvaluator-319"><span class="linenos">319</span></a>            <span class="s1">&#39;Callable[[Order, Alignment[T_contra], tuple[icepool.MultisetGenerator[T_contra, Any], ...]], Mapping[Any, int]]&#39;</span><span class="p">,</span>
</span><span id="MultisetEvaluator-320"><a href="#MultisetEvaluator-320"><span class="linenos">320</span></a>            <span class="n">Order</span><span class="p">]:</span>
</span><span id="MultisetEvaluator-321"><a href="#MultisetEvaluator-321"><span class="linenos">321</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Selects an algorithm and iteration order.</span>
</span><span id="MultisetEvaluator-322"><a href="#MultisetEvaluator-322"><span class="linenos">322</span></a>
</span><span id="MultisetEvaluator-323"><a href="#MultisetEvaluator-323"><span class="linenos">323</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-324"><a href="#MultisetEvaluator-324"><span class="linenos">324</span></a><span class="sd">            * The algorithm to use (`_eval_internal*`).</span>
</span><span id="MultisetEvaluator-325"><a href="#MultisetEvaluator-325"><span class="linenos">325</span></a><span class="sd">            * The order in which `next_state()` sees outcomes.</span>
</span><span id="MultisetEvaluator-326"><a href="#MultisetEvaluator-326"><span class="linenos">326</span></a><span class="sd">                1 for ascending and -1 for descending.</span>
</span><span id="MultisetEvaluator-327"><a href="#MultisetEvaluator-327"><span class="linenos">327</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-328"><a href="#MultisetEvaluator-328"><span class="linenos">328</span></a>        <span class="n">eval_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">()</span>
</span><span id="MultisetEvaluator-329"><a href="#MultisetEvaluator-329"><span class="linenos">329</span></a>
</span><span id="MultisetEvaluator-330"><a href="#MultisetEvaluator-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">generators</span><span class="p">:</span>
</span><span id="MultisetEvaluator-331"><a href="#MultisetEvaluator-331"><span class="linenos">331</span></a>            <span class="c1"># No generators.</span>
</span><span id="MultisetEvaluator-332"><a href="#MultisetEvaluator-332"><span class="linenos">332</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">,</span> <span class="n">eval_order</span>
</span><span id="MultisetEvaluator-333"><a href="#MultisetEvaluator-333"><span class="linenos">333</span></a>
</span><span id="MultisetEvaluator-334"><a href="#MultisetEvaluator-334"><span class="linenos">334</span></a>        <span class="n">pop_min_costs</span><span class="p">,</span> <span class="n">pop_max_costs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">_estimate_order_costs</span><span class="p">()</span>
</span><span id="MultisetEvaluator-335"><a href="#MultisetEvaluator-335"><span class="linenos">335</span></a>                                             <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">))</span>
</span><span id="MultisetEvaluator-336"><a href="#MultisetEvaluator-336"><span class="linenos">336</span></a>
</span><span id="MultisetEvaluator-337"><a href="#MultisetEvaluator-337"><span class="linenos">337</span></a>        <span class="n">pop_min_cost</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">pop_min_costs</span><span class="p">)</span>
</span><span id="MultisetEvaluator-338"><a href="#MultisetEvaluator-338"><span class="linenos">338</span></a>        <span class="n">pop_max_cost</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">pop_max_costs</span><span class="p">)</span>
</span><span id="MultisetEvaluator-339"><a href="#MultisetEvaluator-339"><span class="linenos">339</span></a>
</span><span id="MultisetEvaluator-340"><a href="#MultisetEvaluator-340"><span class="linenos">340</span></a>        <span class="c1"># No preferred order case: go directly with cost.</span>
</span><span id="MultisetEvaluator-341"><a href="#MultisetEvaluator-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="n">eval_order</span> <span class="o">==</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="MultisetEvaluator-342"><a href="#MultisetEvaluator-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="n">pop_max_cost</span> <span class="o">&lt;=</span> <span class="n">pop_min_cost</span><span class="p">:</span>
</span><span id="MultisetEvaluator-343"><a href="#MultisetEvaluator-343"><span class="linenos">343</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">,</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="MultisetEvaluator-344"><a href="#MultisetEvaluator-344"><span class="linenos">344</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator-345"><a href="#MultisetEvaluator-345"><span class="linenos">345</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">,</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span>
</span><span id="MultisetEvaluator-346"><a href="#MultisetEvaluator-346"><span class="linenos">346</span></a>
</span><span id="MultisetEvaluator-347"><a href="#MultisetEvaluator-347"><span class="linenos">347</span></a>        <span class="c1"># Preferred order case.</span>
</span><span id="MultisetEvaluator-348"><a href="#MultisetEvaluator-348"><span class="linenos">348</span></a>        <span class="c1"># Go with the preferred order unless there is a &quot;significant&quot;</span>
</span><span id="MultisetEvaluator-349"><a href="#MultisetEvaluator-349"><span class="linenos">349</span></a>        <span class="c1"># cost factor.</span>
</span><span id="MultisetEvaluator-350"><a href="#MultisetEvaluator-350"><span class="linenos">350</span></a>
</span><span id="MultisetEvaluator-351"><a href="#MultisetEvaluator-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="n">PREFERRED_ORDER_COST_FACTOR</span> <span class="o">*</span> <span class="n">pop_max_cost</span> <span class="o">&lt;</span> <span class="n">pop_min_cost</span><span class="p">:</span>
</span><span id="MultisetEvaluator-352"><a href="#MultisetEvaluator-352"><span class="linenos">352</span></a>            <span class="n">cost_order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="MultisetEvaluator-353"><a href="#MultisetEvaluator-353"><span class="linenos">353</span></a>        <span class="k">elif</span> <span class="n">PREFERRED_ORDER_COST_FACTOR</span> <span class="o">*</span> <span class="n">pop_min_cost</span> <span class="o">&lt;</span> <span class="n">pop_max_cost</span><span class="p">:</span>
</span><span id="MultisetEvaluator-354"><a href="#MultisetEvaluator-354"><span class="linenos">354</span></a>            <span class="n">cost_order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span>
</span><span id="MultisetEvaluator-355"><a href="#MultisetEvaluator-355"><span class="linenos">355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator-356"><a href="#MultisetEvaluator-356"><span class="linenos">356</span></a>            <span class="n">cost_order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span><span id="MultisetEvaluator-357"><a href="#MultisetEvaluator-357"><span class="linenos">357</span></a>
</span><span id="MultisetEvaluator-358"><a href="#MultisetEvaluator-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="n">cost_order</span> <span class="o">==</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span> <span class="ow">or</span> <span class="n">eval_order</span> <span class="o">==</span> <span class="n">cost_order</span><span class="p">:</span>
</span><span id="MultisetEvaluator-359"><a href="#MultisetEvaluator-359"><span class="linenos">359</span></a>            <span class="c1"># Use the preferred algorithm.</span>
</span><span id="MultisetEvaluator-360"><a href="#MultisetEvaluator-360"><span class="linenos">360</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">,</span> <span class="n">eval_order</span>
</span><span id="MultisetEvaluator-361"><a href="#MultisetEvaluator-361"><span class="linenos">361</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator-362"><a href="#MultisetEvaluator-362"><span class="linenos">362</span></a>            <span class="c1"># Use the less-preferred algorithm.</span>
</span><span id="MultisetEvaluator-363"><a href="#MultisetEvaluator-363"><span class="linenos">363</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal_iterative</span><span class="p">,</span> <span class="n">eval_order</span>
</span><span id="MultisetEvaluator-364"><a href="#MultisetEvaluator-364"><span class="linenos">364</span></a>
</span><span id="MultisetEvaluator-365"><a href="#MultisetEvaluator-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">_eval_internal</span><span class="p">(</span>
</span><span id="MultisetEvaluator-366"><a href="#MultisetEvaluator-366"><span class="linenos">366</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">:</span> <span class="s1">&#39;Alignment[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetEvaluator-367"><a href="#MultisetEvaluator-367"><span class="linenos">367</span></a>        <span class="n">generators</span><span class="p">:</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator[T_contra, Any], ...]&#39;</span>
</span><span id="MultisetEvaluator-368"><a href="#MultisetEvaluator-368"><span class="linenos">368</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="MultisetEvaluator-369"><a href="#MultisetEvaluator-369"><span class="linenos">369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal algorithm for iterating in the more-preferred order,</span>
</span><span id="MultisetEvaluator-370"><a href="#MultisetEvaluator-370"><span class="linenos">370</span></a><span class="sd">        i.e. giving outcomes to `next_state()` from wide to narrow.</span>
</span><span id="MultisetEvaluator-371"><a href="#MultisetEvaluator-371"><span class="linenos">371</span></a>
</span><span id="MultisetEvaluator-372"><a href="#MultisetEvaluator-372"><span class="linenos">372</span></a><span class="sd">        All intermediate return values are cached in the instance.</span>
</span><span id="MultisetEvaluator-373"><a href="#MultisetEvaluator-373"><span class="linenos">373</span></a>
</span><span id="MultisetEvaluator-374"><a href="#MultisetEvaluator-374"><span class="linenos">374</span></a><span class="sd">        Arguments:</span>
</span><span id="MultisetEvaluator-375"><a href="#MultisetEvaluator-375"><span class="linenos">375</span></a><span class="sd">            order: The order in which to send outcomes to `next_state()`.</span>
</span><span id="MultisetEvaluator-376"><a href="#MultisetEvaluator-376"><span class="linenos">376</span></a><span class="sd">            alignment: As `alignment()`. Elements will be popped off this</span>
</span><span id="MultisetEvaluator-377"><a href="#MultisetEvaluator-377"><span class="linenos">377</span></a><span class="sd">                during recursion.</span>
</span><span id="MultisetEvaluator-378"><a href="#MultisetEvaluator-378"><span class="linenos">378</span></a><span class="sd">            generators: One or more `MultisetGenerators`s to evaluate. Elements</span>
</span><span id="MultisetEvaluator-379"><a href="#MultisetEvaluator-379"><span class="linenos">379</span></a><span class="sd">                will be popped off this during recursion.</span>
</span><span id="MultisetEvaluator-380"><a href="#MultisetEvaluator-380"><span class="linenos">380</span></a>
</span><span id="MultisetEvaluator-381"><a href="#MultisetEvaluator-381"><span class="linenos">381</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-382"><a href="#MultisetEvaluator-382"><span class="linenos">382</span></a><span class="sd">            A dict `{ state : weight }` describing the probability distribution</span>
</span><span id="MultisetEvaluator-383"><a href="#MultisetEvaluator-383"><span class="linenos">383</span></a><span class="sd">                over states.</span>
</span><span id="MultisetEvaluator-384"><a href="#MultisetEvaluator-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-385"><a href="#MultisetEvaluator-385"><span class="linenos">385</span></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-386"><a href="#MultisetEvaluator-386"><span class="linenos">386</span></a>        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
</span><span id="MultisetEvaluator-387"><a href="#MultisetEvaluator-387"><span class="linenos">387</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
</span><span id="MultisetEvaluator-388"><a href="#MultisetEvaluator-388"><span class="linenos">388</span></a>
</span><span id="MultisetEvaluator-389"><a href="#MultisetEvaluator-389"><span class="linenos">389</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="MultisetEvaluator-390"><a href="#MultisetEvaluator-390"><span class="linenos">390</span></a>
</span><span id="MultisetEvaluator-391"><a href="#MultisetEvaluator-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="MultisetEvaluator-392"><a href="#MultisetEvaluator-392"><span class="linenos">392</span></a>               <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">alignment</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="MultisetEvaluator-393"><a href="#MultisetEvaluator-393"><span class="linenos">393</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="MultisetEvaluator-394"><a href="#MultisetEvaluator-394"><span class="linenos">394</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator-395"><a href="#MultisetEvaluator-395"><span class="linenos">395</span></a>            <span class="n">outcome</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span> <span class="n">iterators</span> <span class="o">=</span> <span class="n">MultisetEvaluator</span><span class="o">.</span><span class="n">_pop_generators</span><span class="p">(</span>
</span><span id="MultisetEvaluator-396"><a href="#MultisetEvaluator-396"><span class="linenos">396</span></a>                <span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-397"><a href="#MultisetEvaluator-397"><span class="linenos">397</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">):</span>
</span><span id="MultisetEvaluator-398"><a href="#MultisetEvaluator-398"><span class="linenos">398</span></a>                <span class="n">prev_generators</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span><span id="MultisetEvaluator-399"><a href="#MultisetEvaluator-399"><span class="linenos">399</span></a>                <span class="n">counts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span>
</span><span id="MultisetEvaluator-400"><a href="#MultisetEvaluator-400"><span class="linenos">400</span></a>                <span class="n">prod_weight</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="MultisetEvaluator-401"><a href="#MultisetEvaluator-401"><span class="linenos">401</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span>
</span><span id="MultisetEvaluator-402"><a href="#MultisetEvaluator-402"><span class="linenos">402</span></a>                                           <span class="n">prev_generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-403"><a href="#MultisetEvaluator-403"><span class="linenos">403</span></a>                <span class="k">for</span> <span class="n">prev_state</span><span class="p">,</span> <span class="n">prev_weight</span> <span class="ow">in</span> <span class="n">prev</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MultisetEvaluator-404"><a href="#MultisetEvaluator-404"><span class="linenos">404</span></a>                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="MultisetEvaluator-405"><a href="#MultisetEvaluator-405"><span class="linenos">405</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="MultisetEvaluator-406"><a href="#MultisetEvaluator-406"><span class="linenos">406</span></a>                        <span class="n">result</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">+=</span> <span class="n">prev_weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="MultisetEvaluator-407"><a href="#MultisetEvaluator-407"><span class="linenos">407</span></a>
</span><span id="MultisetEvaluator-408"><a href="#MultisetEvaluator-408"><span class="linenos">408</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="MultisetEvaluator-409"><a href="#MultisetEvaluator-409"><span class="linenos">409</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="MultisetEvaluator-410"><a href="#MultisetEvaluator-410"><span class="linenos">410</span></a>
</span><span id="MultisetEvaluator-411"><a href="#MultisetEvaluator-411"><span class="linenos">411</span></a>    <span class="k">def</span> <span class="nf">_eval_internal_iterative</span><span class="p">(</span>
</span><span id="MultisetEvaluator-412"><a href="#MultisetEvaluator-412"><span class="linenos">412</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">alignment</span><span class="p">:</span> <span class="s1">&#39;Alignment[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetEvaluator-413"><a href="#MultisetEvaluator-413"><span class="linenos">413</span></a>        <span class="n">generators</span><span class="p">:</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator[T_contra, Any], ...]&#39;</span>
</span><span id="MultisetEvaluator-414"><a href="#MultisetEvaluator-414"><span class="linenos">414</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="MultisetEvaluator-415"><a href="#MultisetEvaluator-415"><span class="linenos">415</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal algorithm for iterating in the less-preferred order,</span>
</span><span id="MultisetEvaluator-416"><a href="#MultisetEvaluator-416"><span class="linenos">416</span></a><span class="sd">        i.e. giving outcomes to `next_state()` from narrow to wide.</span>
</span><span id="MultisetEvaluator-417"><a href="#MultisetEvaluator-417"><span class="linenos">417</span></a>
</span><span id="MultisetEvaluator-418"><a href="#MultisetEvaluator-418"><span class="linenos">418</span></a><span class="sd">        This algorithm does not perform persistent memoization.</span>
</span><span id="MultisetEvaluator-419"><a href="#MultisetEvaluator-419"><span class="linenos">419</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-420"><a href="#MultisetEvaluator-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="MultisetEvaluator-421"><a href="#MultisetEvaluator-421"><span class="linenos">421</span></a>               <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">alignment</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="MultisetEvaluator-422"><a href="#MultisetEvaluator-422"><span class="linenos">422</span></a>            <span class="k">return</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="MultisetEvaluator-423"><a href="#MultisetEvaluator-423"><span class="linenos">423</span></a>        <span class="n">dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="MultisetEvaluator-424"><a href="#MultisetEvaluator-424"><span class="linenos">424</span></a>        <span class="n">dist</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">generators</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="MultisetEvaluator-425"><a href="#MultisetEvaluator-425"><span class="linenos">425</span></a>        <span class="n">final_dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="MultisetEvaluator-426"><a href="#MultisetEvaluator-426"><span class="linenos">426</span></a>        <span class="k">while</span> <span class="n">dist</span><span class="p">:</span>
</span><span id="MultisetEvaluator-427"><a href="#MultisetEvaluator-427"><span class="linenos">427</span></a>            <span class="n">next_dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="MultisetEvaluator-428"><a href="#MultisetEvaluator-428"><span class="linenos">428</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span>
</span><span id="MultisetEvaluator-429"><a href="#MultisetEvaluator-429"><span class="linenos">429</span></a>                 <span class="n">prev_generators</span><span class="p">),</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MultisetEvaluator-430"><a href="#MultisetEvaluator-430"><span class="linenos">430</span></a>                <span class="c1"># The order flip here is the only purpose of this algorithm.</span>
</span><span id="MultisetEvaluator-431"><a href="#MultisetEvaluator-431"><span class="linenos">431</span></a>                <span class="n">outcome</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">iterators</span> <span class="o">=</span> <span class="n">MultisetEvaluator</span><span class="o">.</span><span class="n">_pop_generators</span><span class="p">(</span>
</span><span id="MultisetEvaluator-432"><a href="#MultisetEvaluator-432"><span class="linenos">432</span></a>                    <span class="o">-</span><span class="n">order</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span> <span class="n">prev_generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-433"><a href="#MultisetEvaluator-433"><span class="linenos">433</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">):</span>
</span><span id="MultisetEvaluator-434"><a href="#MultisetEvaluator-434"><span class="linenos">434</span></a>                    <span class="n">generators</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span><span id="MultisetEvaluator-435"><a href="#MultisetEvaluator-435"><span class="linenos">435</span></a>                    <span class="n">counts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span>
</span><span id="MultisetEvaluator-436"><a href="#MultisetEvaluator-436"><span class="linenos">436</span></a>                    <span class="n">prod_weight</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="MultisetEvaluator-437"><a href="#MultisetEvaluator-437"><span class="linenos">437</span></a>                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="MultisetEvaluator-438"><a href="#MultisetEvaluator-438"><span class="linenos">438</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="MultisetEvaluator-439"><a href="#MultisetEvaluator-439"><span class="linenos">439</span></a>                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="MultisetEvaluator-440"><a href="#MultisetEvaluator-440"><span class="linenos">440</span></a>                               <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">):</span>
</span><span id="MultisetEvaluator-441"><a href="#MultisetEvaluator-441"><span class="linenos">441</span></a>                            <span class="n">final_dist</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="MultisetEvaluator-442"><a href="#MultisetEvaluator-442"><span class="linenos">442</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator-443"><a href="#MultisetEvaluator-443"><span class="linenos">443</span></a>                            <span class="n">next_dist</span><span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span>
</span><span id="MultisetEvaluator-444"><a href="#MultisetEvaluator-444"><span class="linenos">444</span></a>                                      <span class="n">generators</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="MultisetEvaluator-445"><a href="#MultisetEvaluator-445"><span class="linenos">445</span></a>            <span class="n">dist</span> <span class="o">=</span> <span class="n">next_dist</span>
</span><span id="MultisetEvaluator-446"><a href="#MultisetEvaluator-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="n">final_dist</span>
</span><span id="MultisetEvaluator-447"><a href="#MultisetEvaluator-447"><span class="linenos">447</span></a>
</span><span id="MultisetEvaluator-448"><a href="#MultisetEvaluator-448"><span class="linenos">448</span></a>    <span class="nd">@staticmethod</span>
</span><span id="MultisetEvaluator-449"><a href="#MultisetEvaluator-449"><span class="linenos">449</span></a>    <span class="k">def</span> <span class="nf">_initialize_generators</span><span class="p">(</span>
</span><span id="MultisetEvaluator-450"><a href="#MultisetEvaluator-450"><span class="linenos">450</span></a>        <span class="n">generators</span><span class="p">:</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator[T_contra, Any], ...]&#39;</span>
</span><span id="MultisetEvaluator-451"><a href="#MultisetEvaluator-451"><span class="linenos">451</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[icepool.InitialMultisetGenerator, ...]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-452"><a href="#MultisetEvaluator-452"><span class="linenos">452</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">_generate_initial</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-453"><a href="#MultisetEvaluator-453"><span class="linenos">453</span></a>
</span><span id="MultisetEvaluator-454"><a href="#MultisetEvaluator-454"><span class="linenos">454</span></a>    <span class="nd">@staticmethod</span>
</span><span id="MultisetEvaluator-455"><a href="#MultisetEvaluator-455"><span class="linenos">455</span></a>    <span class="k">def</span> <span class="nf">_pop_generators</span><span class="p">(</span>
</span><span id="MultisetEvaluator-456"><a href="#MultisetEvaluator-456"><span class="linenos">456</span></a>        <span class="n">side</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">alignment</span><span class="p">:</span> <span class="s1">&#39;Alignment[T_contra]&#39;</span><span class="p">,</span>
</span><span id="MultisetEvaluator-457"><a href="#MultisetEvaluator-457"><span class="linenos">457</span></a>        <span class="n">generators</span><span class="p">:</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator[T_contra, Any], ...]&#39;</span>
</span><span id="MultisetEvaluator-458"><a href="#MultisetEvaluator-458"><span class="linenos">458</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[T_contra, Alignment[T_contra], tuple[icepool.NextMultisetGenerator, ...]]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator-459"><a href="#MultisetEvaluator-459"><span class="linenos">459</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pops a single outcome from the generators.</span>
</span><span id="MultisetEvaluator-460"><a href="#MultisetEvaluator-460"><span class="linenos">460</span></a>
</span><span id="MultisetEvaluator-461"><a href="#MultisetEvaluator-461"><span class="linenos">461</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator-462"><a href="#MultisetEvaluator-462"><span class="linenos">462</span></a><span class="sd">            * The popped outcome.</span>
</span><span id="MultisetEvaluator-463"><a href="#MultisetEvaluator-463"><span class="linenos">463</span></a><span class="sd">            * The remaining alignment.</span>
</span><span id="MultisetEvaluator-464"><a href="#MultisetEvaluator-464"><span class="linenos">464</span></a><span class="sd">            * A tuple of iterators over the resulting generators, counts, and weights.</span>
</span><span id="MultisetEvaluator-465"><a href="#MultisetEvaluator-465"><span class="linenos">465</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-466"><a href="#MultisetEvaluator-466"><span class="linenos">466</span></a>        <span class="n">alignment_and_generators</span> <span class="o">=</span> <span class="p">(</span><span class="n">alignment</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">generators</span>
</span><span id="MultisetEvaluator-467"><a href="#MultisetEvaluator-467"><span class="linenos">467</span></a>        <span class="k">if</span> <span class="n">side</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="MultisetEvaluator-468"><a href="#MultisetEvaluator-468"><span class="linenos">468</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="MultisetEvaluator-469"><a href="#MultisetEvaluator-469"><span class="linenos">469</span></a>                          <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">alignment_and_generators</span>
</span><span id="MultisetEvaluator-470"><a href="#MultisetEvaluator-470"><span class="linenos">470</span></a>                          <span class="k">if</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="MultisetEvaluator-471"><a href="#MultisetEvaluator-471"><span class="linenos">471</span></a>
</span><span id="MultisetEvaluator-472"><a href="#MultisetEvaluator-472"><span class="linenos">472</span></a>            <span class="n">next_alignment</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">alignment</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="MultisetEvaluator-473"><a href="#MultisetEvaluator-473"><span class="linenos">473</span></a>
</span><span id="MultisetEvaluator-474"><a href="#MultisetEvaluator-474"><span class="linenos">474</span></a>            <span class="k">return</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">next_alignment</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetEvaluator-475"><a href="#MultisetEvaluator-475"><span class="linenos">475</span></a>                <span class="n">generator</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-476"><a href="#MultisetEvaluator-476"><span class="linenos">476</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator-477"><a href="#MultisetEvaluator-477"><span class="linenos">477</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="MultisetEvaluator-478"><a href="#MultisetEvaluator-478"><span class="linenos">478</span></a>                          <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">alignment_and_generators</span>
</span><span id="MultisetEvaluator-479"><a href="#MultisetEvaluator-479"><span class="linenos">479</span></a>                          <span class="k">if</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="MultisetEvaluator-480"><a href="#MultisetEvaluator-480"><span class="linenos">480</span></a>
</span><span id="MultisetEvaluator-481"><a href="#MultisetEvaluator-481"><span class="linenos">481</span></a>            <span class="n">next_alignment</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">alignment</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="MultisetEvaluator-482"><a href="#MultisetEvaluator-482"><span class="linenos">482</span></a>
</span><span id="MultisetEvaluator-483"><a href="#MultisetEvaluator-483"><span class="linenos">483</span></a>            <span class="k">return</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">next_alignment</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetEvaluator-484"><a href="#MultisetEvaluator-484"><span class="linenos">484</span></a>                <span class="n">generator</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-485"><a href="#MultisetEvaluator-485"><span class="linenos">485</span></a>
</span><span id="MultisetEvaluator-486"><a href="#MultisetEvaluator-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span>
</span><span id="MultisetEvaluator-487"><a href="#MultisetEvaluator-487"><span class="linenos">487</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span>
</span><span id="MultisetEvaluator-488"><a href="#MultisetEvaluator-488"><span class="linenos">488</span></a>        <span class="s1">&#39;icepool.MultisetGenerator[T_contra, Any] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetEvaluator-489"><a href="#MultisetEvaluator-489"><span class="linenos">489</span></a>    <span class="p">):</span>
</span><span id="MultisetEvaluator-490"><a href="#MultisetEvaluator-490"><span class="linenos">490</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Samples one result from the generator(s) and evaluates the result.&quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator-491"><a href="#MultisetEvaluator-491"><span class="linenos">491</span></a>        <span class="c1"># Convert non-`Pool` arguments to `Pool`.</span>
</span><span id="MultisetEvaluator-492"><a href="#MultisetEvaluator-492"><span class="linenos">492</span></a>        <span class="n">converted_generators</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetEvaluator-493"><a href="#MultisetEvaluator-493"><span class="linenos">493</span></a>            <span class="n">generator</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span>
</span><span id="MultisetEvaluator-494"><a href="#MultisetEvaluator-494"><span class="linenos">494</span></a>                                    <span class="p">)</span> <span class="k">else</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span><span id="MultisetEvaluator-495"><a href="#MultisetEvaluator-495"><span class="linenos">495</span></a>            <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator-496"><a href="#MultisetEvaluator-496"><span class="linenos">496</span></a>
</span><span id="MultisetEvaluator-497"><a href="#MultisetEvaluator-497"><span class="linenos">497</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="MultisetEvaluator-498"><a href="#MultisetEvaluator-498"><span class="linenos">498</span></a>            <span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">converted_generators</span><span class="p">))</span>
</span><span id="MultisetEvaluator-499"><a href="#MultisetEvaluator-499"><span class="linenos">499</span></a>
</span><span id="MultisetEvaluator-500"><a href="#MultisetEvaluator-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="MultisetEvaluator-501"><a href="#MultisetEvaluator-501"><span class="linenos">501</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MultisetEvaluator-502"><a href="#MultisetEvaluator-502"><span class="linenos">502</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator-503"><a href="#MultisetEvaluator-503"><span class="linenos">503</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="MultisetEvaluator-504"><a href="#MultisetEvaluator-504"><span class="linenos">504</span></a>
</span><span id="MultisetEvaluator-505"><a href="#MultisetEvaluator-505"><span class="linenos">505</span></a>    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultisetEvaluator-506"><a href="#MultisetEvaluator-506"><span class="linenos">506</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;MultisetEvaluator does not have a truth value.&#39;</span><span class="p">)</span>
</span><span id="MultisetEvaluator-507"><a href="#MultisetEvaluator-507"><span class="linenos">507</span></a>
</span><span id="MultisetEvaluator-508"><a href="#MultisetEvaluator-508"><span class="linenos">508</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MultisetEvaluator-509"><a href="#MultisetEvaluator-509"><span class="linenos">509</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
</span></pre></div>


            <div class="docstring"><p>An abstract, immutable, callable class for evaulating one or more <code><a href="#MultisetGenerator">MultisetGenerator</a></code>s.</p>

<p>There is one abstract method to implement: <code><a href="#MultisetEvaluator.next_state">next_state()</a></code>.
This should incrementally calculate the result given one outcome at a time
along with how many of that outcome were produced.</p>

<p>An example sequence of calls, as far as <code><a href="#MultisetEvaluator.next_state">next_state()</a></code> is concerned, is:</p>

<ol>
<li><code>state = next_state(state=None, outcome=1, count_of_1s)</code></li>
<li><code>state = next_state(state, 2, count_of_2s)</code></li>
<li><code>state = next_state(state, 3, count_of_3s)</code></li>
<li><code>state = next_state(state, 4, count_of_4s)</code></li>
<li><code>state = next_state(state, 5, count_of_5s)</code></li>
<li><code>state = next_state(state, 6, count_of_6s)</code></li>
<li><code>outcome = final_outcome(state)</code></li>
</ol>

<p>A few other methods can optionally be overridden to further customize behavior.</p>

<p>It is not expected that subclasses of <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code>
be able to handle arbitrary types or numbers of generators.
Indeed, most are expected to handle only a fixed number of generators,
and often even only generators with a particular type of <code><a href="#Die">Die</a></code>.</p>

<p>Instances cache all intermediate state distributions.
You should therefore reuse instances when possible.</p>

<p>Instances should not be modified after construction
in any way that affects the return values of these methods.
Otherwise, values in the cache may be incorrect.</p>
</div>


                            <div id="MultisetEvaluator.next_state" class="classattr">
                                        <input id="MultisetEvaluator.next_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">next_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span><span class="p">:</span> <span class="n">Hashable</span>, </span><span class="param"><span class="n">outcome</span><span class="p">:</span> <span class="o">-</span><span class="n">T_contra</span>, </span><span class="param"><span class="o">/</span>, </span><span class="param"><span class="o">*</span><span class="n">counts</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">Hashable</span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.next_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.next_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.next_state-58"><a href="#MultisetEvaluator.next_state-58"><span class="linenos"> 58</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="MultisetEvaluator.next_state-59"><a href="#MultisetEvaluator.next_state-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">:</span>
</span><span id="MultisetEvaluator.next_state-60"><a href="#MultisetEvaluator.next_state-60"><span class="linenos"> 60</span></a>                   <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="MultisetEvaluator.next_state-61"><a href="#MultisetEvaluator.next_state-61"><span class="linenos"> 61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;State transition function.</span>
</span><span id="MultisetEvaluator.next_state-62"><a href="#MultisetEvaluator.next_state-62"><span class="linenos"> 62</span></a>
</span><span id="MultisetEvaluator.next_state-63"><a href="#MultisetEvaluator.next_state-63"><span class="linenos"> 63</span></a><span class="sd">        This should produce a state given the previous state, an outcome,</span>
</span><span id="MultisetEvaluator.next_state-64"><a href="#MultisetEvaluator.next_state-64"><span class="linenos"> 64</span></a><span class="sd">        and the number that outcome produced by each generator.</span>
</span><span id="MultisetEvaluator.next_state-65"><a href="#MultisetEvaluator.next_state-65"><span class="linenos"> 65</span></a>
</span><span id="MultisetEvaluator.next_state-66"><a href="#MultisetEvaluator.next_state-66"><span class="linenos"> 66</span></a><span class="sd">        `evaluate()` will always call this using only positional arguments.</span>
</span><span id="MultisetEvaluator.next_state-67"><a href="#MultisetEvaluator.next_state-67"><span class="linenos"> 67</span></a><span class="sd">        Furthermore, there is no expectation that a subclass be able to handle</span>
</span><span id="MultisetEvaluator.next_state-68"><a href="#MultisetEvaluator.next_state-68"><span class="linenos"> 68</span></a><span class="sd">        an arbitrary number of counts. Thus, you are free to rename any of</span>
</span><span id="MultisetEvaluator.next_state-69"><a href="#MultisetEvaluator.next_state-69"><span class="linenos"> 69</span></a><span class="sd">        the parameters in a subclass, or to replace `*counts` with a fixed set</span>
</span><span id="MultisetEvaluator.next_state-70"><a href="#MultisetEvaluator.next_state-70"><span class="linenos"> 70</span></a><span class="sd">        of parameters.</span>
</span><span id="MultisetEvaluator.next_state-71"><a href="#MultisetEvaluator.next_state-71"><span class="linenos"> 71</span></a>
</span><span id="MultisetEvaluator.next_state-72"><a href="#MultisetEvaluator.next_state-72"><span class="linenos"> 72</span></a><span class="sd">        Make sure to handle the base case where `state is None`.</span>
</span><span id="MultisetEvaluator.next_state-73"><a href="#MultisetEvaluator.next_state-73"><span class="linenos"> 73</span></a>
</span><span id="MultisetEvaluator.next_state-74"><a href="#MultisetEvaluator.next_state-74"><span class="linenos"> 74</span></a><span class="sd">        States must be hashable. At current, they do not have to be orderable.</span>
</span><span id="MultisetEvaluator.next_state-75"><a href="#MultisetEvaluator.next_state-75"><span class="linenos"> 75</span></a><span class="sd">        However, this may change in the future, and if they are not totally</span>
</span><span id="MultisetEvaluator.next_state-76"><a href="#MultisetEvaluator.next_state-76"><span class="linenos"> 76</span></a><span class="sd">        orderable, you must override `final_outcome` to create totally orderable</span>
</span><span id="MultisetEvaluator.next_state-77"><a href="#MultisetEvaluator.next_state-77"><span class="linenos"> 77</span></a><span class="sd">        final outcomes.</span>
</span><span id="MultisetEvaluator.next_state-78"><a href="#MultisetEvaluator.next_state-78"><span class="linenos"> 78</span></a>
</span><span id="MultisetEvaluator.next_state-79"><a href="#MultisetEvaluator.next_state-79"><span class="linenos"> 79</span></a><span class="sd">        The behavior of returning a `Die` from `next_state` is currently</span>
</span><span id="MultisetEvaluator.next_state-80"><a href="#MultisetEvaluator.next_state-80"><span class="linenos"> 80</span></a><span class="sd">        undefined.</span>
</span><span id="MultisetEvaluator.next_state-81"><a href="#MultisetEvaluator.next_state-81"><span class="linenos"> 81</span></a>
</span><span id="MultisetEvaluator.next_state-82"><a href="#MultisetEvaluator.next_state-82"><span class="linenos"> 82</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator.next_state-83"><a href="#MultisetEvaluator.next_state-83"><span class="linenos"> 83</span></a><span class="sd">            state: A hashable object indicating the state before rolling the</span>
</span><span id="MultisetEvaluator.next_state-84"><a href="#MultisetEvaluator.next_state-84"><span class="linenos"> 84</span></a><span class="sd">                current outcome. If this is the first outcome being considered,</span>
</span><span id="MultisetEvaluator.next_state-85"><a href="#MultisetEvaluator.next_state-85"><span class="linenos"> 85</span></a><span class="sd">                `state` will be `None`.</span>
</span><span id="MultisetEvaluator.next_state-86"><a href="#MultisetEvaluator.next_state-86"><span class="linenos"> 86</span></a><span class="sd">            outcome: The current outcome.</span>
</span><span id="MultisetEvaluator.next_state-87"><a href="#MultisetEvaluator.next_state-87"><span class="linenos"> 87</span></a><span class="sd">                `next_state` will see all rolled outcomes in monotonic order;</span>
</span><span id="MultisetEvaluator.next_state-88"><a href="#MultisetEvaluator.next_state-88"><span class="linenos"> 88</span></a><span class="sd">                either ascending or descending depending on `order()`.</span>
</span><span id="MultisetEvaluator.next_state-89"><a href="#MultisetEvaluator.next_state-89"><span class="linenos"> 89</span></a><span class="sd">                If there are multiple generators, the set of outcomes is the</span>
</span><span id="MultisetEvaluator.next_state-90"><a href="#MultisetEvaluator.next_state-90"><span class="linenos"> 90</span></a><span class="sd">                union of the outcomes of the invididual generators. All outcomes</span>
</span><span id="MultisetEvaluator.next_state-91"><a href="#MultisetEvaluator.next_state-91"><span class="linenos"> 91</span></a><span class="sd">                with nonzero count will be seen. Outcomes with zero count</span>
</span><span id="MultisetEvaluator.next_state-92"><a href="#MultisetEvaluator.next_state-92"><span class="linenos"> 92</span></a><span class="sd">                may or may not be seen. If you need to enforce that certain</span>
</span><span id="MultisetEvaluator.next_state-93"><a href="#MultisetEvaluator.next_state-93"><span class="linenos"> 93</span></a><span class="sd">                outcomes are seen even if they have zero count, see</span>
</span><span id="MultisetEvaluator.next_state-94"><a href="#MultisetEvaluator.next_state-94"><span class="linenos"> 94</span></a><span class="sd">                `alignment()`.</span>
</span><span id="MultisetEvaluator.next_state-95"><a href="#MultisetEvaluator.next_state-95"><span class="linenos"> 95</span></a><span class="sd">            *counts: One value (usually an `int`) for each generator output</span>
</span><span id="MultisetEvaluator.next_state-96"><a href="#MultisetEvaluator.next_state-96"><span class="linenos"> 96</span></a><span class="sd">                indicating how many of the current outcome were produced.</span>
</span><span id="MultisetEvaluator.next_state-97"><a href="#MultisetEvaluator.next_state-97"><span class="linenos"> 97</span></a><span class="sd">                All outcomes with nonzero count are guaranteed to be seen.</span>
</span><span id="MultisetEvaluator.next_state-98"><a href="#MultisetEvaluator.next_state-98"><span class="linenos"> 98</span></a><span class="sd">                To guarantee that outcomes are seen even if they have zero</span>
</span><span id="MultisetEvaluator.next_state-99"><a href="#MultisetEvaluator.next_state-99"><span class="linenos"> 99</span></a><span class="sd">                count, override `alignment()`.</span>
</span><span id="MultisetEvaluator.next_state-100"><a href="#MultisetEvaluator.next_state-100"><span class="linenos">100</span></a>
</span><span id="MultisetEvaluator.next_state-101"><a href="#MultisetEvaluator.next_state-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator.next_state-102"><a href="#MultisetEvaluator.next_state-102"><span class="linenos">102</span></a><span class="sd">            A hashable object indicating the next state.</span>
</span><span id="MultisetEvaluator.next_state-103"><a href="#MultisetEvaluator.next_state-103"><span class="linenos">103</span></a><span class="sd">            The special value `icepool.Reroll` can be used to immediately remove</span>
</span><span id="MultisetEvaluator.next_state-104"><a href="#MultisetEvaluator.next_state-104"><span class="linenos">104</span></a><span class="sd">            the state from consideration, effectively performing a full reroll.</span>
</span><span id="MultisetEvaluator.next_state-105"><a href="#MultisetEvaluator.next_state-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>State transition function.</p>

<p>This should produce a state given the previous state, an outcome,
and the number that outcome produced by each generator.</p>

<p><code><a href="#MultisetEvaluator.evaluate">evaluate()</a></code> will always call this using only positional arguments.
Furthermore, there is no expectation that a subclass be able to handle
an arbitrary number of counts. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*counts</code> with a fixed set
of parameters.</p>

<p>Make sure to handle the base case where <code>state is None</code>.</p>

<p>States must be hashable. At current, they do not have to be orderable.
However, this may change in the future, and if they are not totally
orderable, you must override <code><a href="#MultisetEvaluator.final_outcome">final_outcome</a></code> to create totally orderable
final outcomes.</p>

<p>The behavior of returning a <code><a href="#Die">Die</a></code> from <code><a href="#MultisetEvaluator.next_state">next_state</a></code> is currently
undefined.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>state:</strong>  A hashable object indicating the state before rolling the
current outcome. If this is the first outcome being considered,
<code>state</code> will be <code>None</code>.</li>
<li><strong>outcome:</strong>  The current outcome.
<code><a href="#MultisetEvaluator.next_state">next_state</a></code> will see all rolled outcomes in monotonic order;
either ascending or descending depending on <code><a href="#MultisetEvaluator.order">order()</a></code>.
If there are multiple generators, the set of outcomes is the
union of the outcomes of the invididual generators. All outcomes
with nonzero count will be seen. Outcomes with zero count
may or may not be seen. If you need to enforce that certain
outcomes are seen even if they have zero count, see
<code><a href="#MultisetEvaluator.alignment">alignment()</a></code>.</li>
<li><strong>*counts:</strong>  One value (usually an <code>int</code>) for each generator output
indicating how many of the current outcome were produced.
All outcomes with nonzero count are guaranteed to be seen.
To guarantee that outcomes are seen even if they have zero
count, override <code><a href="#MultisetEvaluator.alignment">alignment()</a></code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A hashable object indicating the next state.
  The special value <code><a href="#Reroll">Reroll</a></code> can be used to immediately remove
  the state from consideration, effectively performing a full reroll.</p>
</blockquote>
</div>


                            </div>
                            <div id="MultisetEvaluator.final_outcome" class="classattr">
                                        <input id="MultisetEvaluator.final_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_outcome</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">final_state</span><span class="p">:</span> <span class="n">Hashable</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="o">+</span><span class="n">U_co</span><span class="p">,</span> <span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">U_co</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.final_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.final_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.final_outcome-107"><a href="#MultisetEvaluator.final_outcome-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span>
</span><span id="MultisetEvaluator.final_outcome-108"><a href="#MultisetEvaluator.final_outcome-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">:</span> <span class="n">Hashable</span>
</span><span id="MultisetEvaluator.final_outcome-109"><a href="#MultisetEvaluator.final_outcome-109"><span class="linenos">109</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;U_co | icepool.Die[U_co] | icepool.RerollType&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator.final_outcome-110"><a href="#MultisetEvaluator.final_outcome-110"><span class="linenos">110</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional function to generate a final outcome from a final state.</span>
</span><span id="MultisetEvaluator.final_outcome-111"><a href="#MultisetEvaluator.final_outcome-111"><span class="linenos">111</span></a>
</span><span id="MultisetEvaluator.final_outcome-112"><a href="#MultisetEvaluator.final_outcome-112"><span class="linenos">112</span></a><span class="sd">        By default, the final outcome is equal to the final state.</span>
</span><span id="MultisetEvaluator.final_outcome-113"><a href="#MultisetEvaluator.final_outcome-113"><span class="linenos">113</span></a><span class="sd">        Note that `None` is not a valid outcome for a `Die`,</span>
</span><span id="MultisetEvaluator.final_outcome-114"><a href="#MultisetEvaluator.final_outcome-114"><span class="linenos">114</span></a><span class="sd">        and if there are no outcomes, `final_outcome` will be immediately</span>
</span><span id="MultisetEvaluator.final_outcome-115"><a href="#MultisetEvaluator.final_outcome-115"><span class="linenos">115</span></a><span class="sd">        be callled with `final_state=None`.</span>
</span><span id="MultisetEvaluator.final_outcome-116"><a href="#MultisetEvaluator.final_outcome-116"><span class="linenos">116</span></a><span class="sd">        Subclasses that want to handle this case should explicitly define what</span>
</span><span id="MultisetEvaluator.final_outcome-117"><a href="#MultisetEvaluator.final_outcome-117"><span class="linenos">117</span></a><span class="sd">        happens.</span>
</span><span id="MultisetEvaluator.final_outcome-118"><a href="#MultisetEvaluator.final_outcome-118"><span class="linenos">118</span></a>
</span><span id="MultisetEvaluator.final_outcome-119"><a href="#MultisetEvaluator.final_outcome-119"><span class="linenos">119</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator.final_outcome-120"><a href="#MultisetEvaluator.final_outcome-120"><span class="linenos">120</span></a><span class="sd">            final_state: A state after all outcomes have been processed.</span>
</span><span id="MultisetEvaluator.final_outcome-121"><a href="#MultisetEvaluator.final_outcome-121"><span class="linenos">121</span></a>
</span><span id="MultisetEvaluator.final_outcome-122"><a href="#MultisetEvaluator.final_outcome-122"><span class="linenos">122</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator.final_outcome-123"><a href="#MultisetEvaluator.final_outcome-123"><span class="linenos">123</span></a><span class="sd">            A final outcome that will be used as part of constructing the result `Die`.</span>
</span><span id="MultisetEvaluator.final_outcome-124"><a href="#MultisetEvaluator.final_outcome-124"><span class="linenos">124</span></a><span class="sd">            As usual for `Die()`, this could itself be a `Die` or `icepool.Reroll`.</span>
</span><span id="MultisetEvaluator.final_outcome-125"><a href="#MultisetEvaluator.final_outcome-125"><span class="linenos">125</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator.final_outcome-126"><a href="#MultisetEvaluator.final_outcome-126"><span class="linenos">126</span></a>        <span class="c1"># If not overriden, the final_state should have type U_co.</span>
</span><span id="MultisetEvaluator.final_outcome-127"><a href="#MultisetEvaluator.final_outcome-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">U_co</span><span class="p">,</span> <span class="n">final_state</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to generate a final outcome from a final state.</p>

<p>By default, the final outcome is equal to the final state.
Note that <code>None</code> is not a valid outcome for a <code><a href="#Die">Die</a></code>,
and if there are no outcomes, <code><a href="#MultisetEvaluator.final_outcome">final_outcome</a></code> will be immediately
be callled with <code>final_state=None</code>.
Subclasses that want to handle this case should explicitly define what
happens.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>final_state:</strong>  A state after all outcomes have been processed.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A final outcome that will be used as part of constructing the result <code><a href="#Die">Die</a></code>.
  As usual for <code><a href="#Die">Die()</a></code>, this could itself be a <code><a href="#Die">Die</a></code> or <code><a href="#Reroll">Reroll</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="MultisetEvaluator.order" class="classattr">
                                        <input id="MultisetEvaluator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Order">Order</a></span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.order-129"><a href="#MultisetEvaluator.order-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="MultisetEvaluator.order-130"><a href="#MultisetEvaluator.order-130"><span class="linenos">130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional function to determine the order in which `next_state()` will see outcomes.</span>
</span><span id="MultisetEvaluator.order-131"><a href="#MultisetEvaluator.order-131"><span class="linenos">131</span></a>
</span><span id="MultisetEvaluator.order-132"><a href="#MultisetEvaluator.order-132"><span class="linenos">132</span></a><span class="sd">        The default is ascending order. This has better caching behavior with </span>
</span><span id="MultisetEvaluator.order-133"><a href="#MultisetEvaluator.order-133"><span class="linenos">133</span></a><span class="sd">        mixed standard dice.</span>
</span><span id="MultisetEvaluator.order-134"><a href="#MultisetEvaluator.order-134"><span class="linenos">134</span></a>
</span><span id="MultisetEvaluator.order-135"><a href="#MultisetEvaluator.order-135"><span class="linenos">135</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator.order-136"><a href="#MultisetEvaluator.order-136"><span class="linenos">136</span></a><span class="sd">            * Order.Ascending (= 1)</span>
</span><span id="MultisetEvaluator.order-137"><a href="#MultisetEvaluator.order-137"><span class="linenos">137</span></a><span class="sd">                if `next_state()` should always see the outcomes in ascending order.</span>
</span><span id="MultisetEvaluator.order-138"><a href="#MultisetEvaluator.order-138"><span class="linenos">138</span></a><span class="sd">            * Order.Descending (= -1)</span>
</span><span id="MultisetEvaluator.order-139"><a href="#MultisetEvaluator.order-139"><span class="linenos">139</span></a><span class="sd">                if `next_state()` should always see the outcomes in descending order.</span>
</span><span id="MultisetEvaluator.order-140"><a href="#MultisetEvaluator.order-140"><span class="linenos">140</span></a><span class="sd">            * Order.Any (= 0)</span>
</span><span id="MultisetEvaluator.order-141"><a href="#MultisetEvaluator.order-141"><span class="linenos">141</span></a><span class="sd">                if the result of the evaluation is order-independent.</span>
</span><span id="MultisetEvaluator.order-142"><a href="#MultisetEvaluator.order-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator.order-143"><a href="#MultisetEvaluator.order-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to determine the order in which <code><a href="#MultisetEvaluator.next_state">next_state()</a></code> will see outcomes.</p>

<p>The default is ascending order. This has better caching behavior with 
mixed standard dice.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <ul>
  <li><a href="#Order.Ascending">Order.Ascending</a> (= 1)
  if <code><a href="#MultisetEvaluator.next_state">next_state()</a></code> should always see the outcomes in ascending order.</li>
  <li><a href="#Order.Descending">Order.Descending</a> (= -1)
  if <code><a href="#MultisetEvaluator.next_state">next_state()</a></code> should always see the outcomes in descending order.</li>
  <li><a href="#Order.Any">Order.Any</a> (= 0)
  if the result of the evaluation is order-independent.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="MultisetEvaluator.alignment" class="classattr">
                                        <input id="MultisetEvaluator.alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">alignment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Collection</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.alignment-145"><a href="#MultisetEvaluator.alignment-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T_contra</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="n">T_contra</span><span class="p">]:</span>
</span><span id="MultisetEvaluator.alignment-146"><a href="#MultisetEvaluator.alignment-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Optional method to specify additional outcomes that should be seen by `next_state()`.</span>
</span><span id="MultisetEvaluator.alignment-147"><a href="#MultisetEvaluator.alignment-147"><span class="linenos">147</span></a>
</span><span id="MultisetEvaluator.alignment-148"><a href="#MultisetEvaluator.alignment-148"><span class="linenos">148</span></a><span class="sd">        These will be seen by `next_state` even if they have zero count or do</span>
</span><span id="MultisetEvaluator.alignment-149"><a href="#MultisetEvaluator.alignment-149"><span class="linenos">149</span></a><span class="sd">        not appear in the generator(s) at all.</span>
</span><span id="MultisetEvaluator.alignment-150"><a href="#MultisetEvaluator.alignment-150"><span class="linenos">150</span></a>
</span><span id="MultisetEvaluator.alignment-151"><a href="#MultisetEvaluator.alignment-151"><span class="linenos">151</span></a><span class="sd">        The default implementation returns `()`; this means outcomes with zero</span>
</span><span id="MultisetEvaluator.alignment-152"><a href="#MultisetEvaluator.alignment-152"><span class="linenos">152</span></a><span class="sd">        count may or may not be seen by `next_state`.</span>
</span><span id="MultisetEvaluator.alignment-153"><a href="#MultisetEvaluator.alignment-153"><span class="linenos">153</span></a>
</span><span id="MultisetEvaluator.alignment-154"><a href="#MultisetEvaluator.alignment-154"><span class="linenos">154</span></a><span class="sd">        If you want `next_state` to see consecutive `int` outcomes, you can set</span>
</span><span id="MultisetEvaluator.alignment-155"><a href="#MultisetEvaluator.alignment-155"><span class="linenos">155</span></a><span class="sd">        `alignment = icepool.MultisetEvaluator.range_alignment`.</span>
</span><span id="MultisetEvaluator.alignment-156"><a href="#MultisetEvaluator.alignment-156"><span class="linenos">156</span></a><span class="sd">        See `range_alignment()` below.</span>
</span><span id="MultisetEvaluator.alignment-157"><a href="#MultisetEvaluator.alignment-157"><span class="linenos">157</span></a>
</span><span id="MultisetEvaluator.alignment-158"><a href="#MultisetEvaluator.alignment-158"><span class="linenos">158</span></a><span class="sd">        If you want `next_state` to see all generator outcomes, you can return</span>
</span><span id="MultisetEvaluator.alignment-159"><a href="#MultisetEvaluator.alignment-159"><span class="linenos">159</span></a><span class="sd">        `outcomes` as-is.</span>
</span><span id="MultisetEvaluator.alignment-160"><a href="#MultisetEvaluator.alignment-160"><span class="linenos">160</span></a>
</span><span id="MultisetEvaluator.alignment-161"><a href="#MultisetEvaluator.alignment-161"><span class="linenos">161</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator.alignment-162"><a href="#MultisetEvaluator.alignment-162"><span class="linenos">162</span></a><span class="sd">            outcomes: The outcomes that could be produced by the generators, in</span>
</span><span id="MultisetEvaluator.alignment-163"><a href="#MultisetEvaluator.alignment-163"><span class="linenos">163</span></a><span class="sd">            ascending order.</span>
</span><span id="MultisetEvaluator.alignment-164"><a href="#MultisetEvaluator.alignment-164"><span class="linenos">164</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator.alignment-165"><a href="#MultisetEvaluator.alignment-165"><span class="linenos">165</span></a>        <span class="k">return</span> <span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Optional method to specify additional outcomes that should be seen by <code><a href="#MultisetEvaluator.next_state">next_state()</a></code>.</p>

<p>These will be seen by <code><a href="#MultisetEvaluator.next_state">next_state</a></code> even if they have zero count or do
not appear in the generator(s) at all.</p>

<p>The default implementation returns <code>()</code>; this means outcomes with zero
count may or may not be seen by <code><a href="#MultisetEvaluator.next_state">next_state</a></code>.</p>

<p>If you want <code><a href="#MultisetEvaluator.next_state">next_state</a></code> to see consecutive <code>int</code> outcomes, you can set
<code>alignment = <a href="#MultisetEvaluator.range_alignment">MultisetEvaluator.range_alignment</a></code>.
See <code><a href="#MultisetEvaluator.range_alignment">range_alignment()</a></code> below.</p>

<p>If you want <code><a href="#MultisetEvaluator.next_state">next_state</a></code> to see all generator outcomes, you can return
<code>outcomes</code> as-is.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>outcomes:</strong>  The outcomes that could be produced by the generators, in</li>
<li>ascending order.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetEvaluator.range_alignment" class="classattr">
                                        <input id="MultisetEvaluator.range_alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">range_alignment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.range_alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.range_alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.range_alignment-167"><a href="#MultisetEvaluator.range_alignment-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="nf">range_alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="MultisetEvaluator.range_alignment-168"><a href="#MultisetEvaluator.range_alignment-168"><span class="linenos">168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Example implementation of `alignment()` that produces consecutive `int` outcomes.</span>
</span><span id="MultisetEvaluator.range_alignment-169"><a href="#MultisetEvaluator.range_alignment-169"><span class="linenos">169</span></a>
</span><span id="MultisetEvaluator.range_alignment-170"><a href="#MultisetEvaluator.range_alignment-170"><span class="linenos">170</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="MultisetEvaluator.range_alignment-171"><a href="#MultisetEvaluator.range_alignment-171"><span class="linenos">171</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="MultisetEvaluator.range_alignment-172"><a href="#MultisetEvaluator.range_alignment-172"><span class="linenos">172</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="MultisetEvaluator.range_alignment-173"><a href="#MultisetEvaluator.range_alignment-173"><span class="linenos">173</span></a><span class="sd">        set of parameters.</span>
</span><span id="MultisetEvaluator.range_alignment-174"><a href="#MultisetEvaluator.range_alignment-174"><span class="linenos">174</span></a>
</span><span id="MultisetEvaluator.range_alignment-175"><a href="#MultisetEvaluator.range_alignment-175"><span class="linenos">175</span></a><span class="sd">        Set `alignment = icepool.MultisetEvaluator.range_alignment` to use this.</span>
</span><span id="MultisetEvaluator.range_alignment-176"><a href="#MultisetEvaluator.range_alignment-176"><span class="linenos">176</span></a>
</span><span id="MultisetEvaluator.range_alignment-177"><a href="#MultisetEvaluator.range_alignment-177"><span class="linenos">177</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator.range_alignment-178"><a href="#MultisetEvaluator.range_alignment-178"><span class="linenos">178</span></a><span class="sd">            All `int`s from the min outcome to the max outcome among the generators,</span>
</span><span id="MultisetEvaluator.range_alignment-179"><a href="#MultisetEvaluator.range_alignment-179"><span class="linenos">179</span></a><span class="sd">            inclusive.</span>
</span><span id="MultisetEvaluator.range_alignment-180"><a href="#MultisetEvaluator.range_alignment-180"><span class="linenos">180</span></a>
</span><span id="MultisetEvaluator.range_alignment-181"><a href="#MultisetEvaluator.range_alignment-181"><span class="linenos">181</span></a><span class="sd">        Raises:</span>
</span><span id="MultisetEvaluator.range_alignment-182"><a href="#MultisetEvaluator.range_alignment-182"><span class="linenos">182</span></a><span class="sd">            TypeError: if any generator has any non-`int` outcome.</span>
</span><span id="MultisetEvaluator.range_alignment-183"><a href="#MultisetEvaluator.range_alignment-183"><span class="linenos">183</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator.range_alignment-184"><a href="#MultisetEvaluator.range_alignment-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="MultisetEvaluator.range_alignment-185"><a href="#MultisetEvaluator.range_alignment-185"><span class="linenos">185</span></a>            <span class="k">return</span> <span class="p">()</span>
</span><span id="MultisetEvaluator.range_alignment-186"><a href="#MultisetEvaluator.range_alignment-186"><span class="linenos">186</span></a>
</span><span id="MultisetEvaluator.range_alignment-187"><a href="#MultisetEvaluator.range_alignment-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">):</span>
</span><span id="MultisetEvaluator.range_alignment-188"><a href="#MultisetEvaluator.range_alignment-188"><span class="linenos">188</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="MultisetEvaluator.range_alignment-189"><a href="#MultisetEvaluator.range_alignment-189"><span class="linenos">189</span></a>                <span class="s2">&quot;range_alignment cannot be used with outcomes of type other than &#39;int&#39;.&quot;</span>
</span><span id="MultisetEvaluator.range_alignment-190"><a href="#MultisetEvaluator.range_alignment-190"><span class="linenos">190</span></a>            <span class="p">)</span>
</span><span id="MultisetEvaluator.range_alignment-191"><a href="#MultisetEvaluator.range_alignment-191"><span class="linenos">191</span></a>
</span><span id="MultisetEvaluator.range_alignment-192"><a href="#MultisetEvaluator.range_alignment-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outcomes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Example implementation of <code><a href="#MultisetEvaluator.alignment">alignment()</a></code> that produces consecutive <code>int</code> outcomes.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>Set <code>alignment = <a href="#MultisetEvaluator.range_alignment">MultisetEvaluator.range_alignment</a></code> to use this.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>All <code>int</code>s from the min outcome to the max outcome among the generators,
  inclusive.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>TypeError:</strong>  if any generator has any non-<code>int</code> outcome.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetEvaluator.prefix_generators" class="classattr">
                                        <input id="MultisetEvaluator.prefix_generators-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prefix_generators</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.prefix_generators-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.prefix_generators"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.prefix_generators-194"><a href="#MultisetEvaluator.prefix_generators-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">prefix_generators</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;tuple[icepool.MultisetGenerator, ...]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator.prefix_generators-195"><a href="#MultisetEvaluator.prefix_generators-195"><span class="linenos">195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;An optional sequence of extra generators whose counts will be prepended to *counts.&quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator.prefix_generators-196"><a href="#MultisetEvaluator.prefix_generators-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>An optional sequence of extra generators whose counts will be prepended to *counts.</p>
</div>


                            </div>
                            <div id="MultisetEvaluator.validate_arity" class="classattr">
                                        <input id="MultisetEvaluator.validate_arity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_arity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">arity</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.validate_arity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.validate_arity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.validate_arity-198"><a href="#MultisetEvaluator.validate_arity-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">validate_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arity</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultisetEvaluator.validate_arity-199"><a href="#MultisetEvaluator.validate_arity-199"><span class="linenos">199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;An optional method to verify the total input arity.</span>
</span><span id="MultisetEvaluator.validate_arity-200"><a href="#MultisetEvaluator.validate_arity-200"><span class="linenos">200</span></a>
</span><span id="MultisetEvaluator.validate_arity-201"><a href="#MultisetEvaluator.validate_arity-201"><span class="linenos">201</span></a><span class="sd">        This is called after any implicit conversion to generators, but does</span>
</span><span id="MultisetEvaluator.validate_arity-202"><a href="#MultisetEvaluator.validate_arity-202"><span class="linenos">202</span></a><span class="sd">        not include any `extra_generators()`.</span>
</span><span id="MultisetEvaluator.validate_arity-203"><a href="#MultisetEvaluator.validate_arity-203"><span class="linenos">203</span></a>
</span><span id="MultisetEvaluator.validate_arity-204"><a href="#MultisetEvaluator.validate_arity-204"><span class="linenos">204</span></a><span class="sd">        Overriding `next_state` with a fixed number of counts will make this</span>
</span><span id="MultisetEvaluator.validate_arity-205"><a href="#MultisetEvaluator.validate_arity-205"><span class="linenos">205</span></a><span class="sd">        check redundant.</span>
</span><span id="MultisetEvaluator.validate_arity-206"><a href="#MultisetEvaluator.validate_arity-206"><span class="linenos">206</span></a>
</span><span id="MultisetEvaluator.validate_arity-207"><a href="#MultisetEvaluator.validate_arity-207"><span class="linenos">207</span></a><span class="sd">        Raises:</span>
</span><span id="MultisetEvaluator.validate_arity-208"><a href="#MultisetEvaluator.validate_arity-208"><span class="linenos">208</span></a><span class="sd">            `ValueError` if the total input arity is not valid.</span>
</span><span id="MultisetEvaluator.validate_arity-209"><a href="#MultisetEvaluator.validate_arity-209"><span class="linenos">209</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>An optional method to verify the total input arity.</p>

<p>This is called after any implicit conversion to generators, but does
not include any <code>extra_generators()</code>.</p>

<p>Overriding <code><a href="#MultisetEvaluator.next_state">next_state</a></code> with a fixed number of counts will make this
check redundant.</p>

<h6 id="raises">Raises:</h6>

<ul>
<li><code>ValueError</code> if the total input arity is not valid.</li>
</ul>
</div>


                            </div>
                            <div id="MultisetEvaluator.evaluate" class="classattr">
                                        <input id="MultisetEvaluator.evaluate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evaluate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetExpression">MultisetExpression</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Die">Die</a></span><span class="p">[</span><span class="o">+</span><span class="n">U_co</span><span class="p">],</span> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">+</span><span class="n">U_co</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="MultisetEvaluator.evaluate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.evaluate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.evaluate-235"><a href="#MultisetEvaluator.evaluate-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="MultisetEvaluator.evaluate-236"><a href="#MultisetEvaluator.evaluate-236"><span class="linenos">236</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="MultisetEvaluator.evaluate-237"><a href="#MultisetEvaluator.evaluate-237"><span class="linenos">237</span></a>        <span class="s1">&#39;MultisetExpression[T_contra] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetEvaluator.evaluate-238"><a href="#MultisetEvaluator.evaluate-238"><span class="linenos">238</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die[U_co] | MultisetEvaluator[T_contra, U_co]&#39;</span><span class="p">:</span>
</span><span id="MultisetEvaluator.evaluate-239"><a href="#MultisetEvaluator.evaluate-239"><span class="linenos">239</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluates generator(s).</span>
</span><span id="MultisetEvaluator.evaluate-240"><a href="#MultisetEvaluator.evaluate-240"><span class="linenos">240</span></a>
</span><span id="MultisetEvaluator.evaluate-241"><a href="#MultisetEvaluator.evaluate-241"><span class="linenos">241</span></a><span class="sd">        You can call the `MultisetEvaluator` object directly for the same effect,</span>
</span><span id="MultisetEvaluator.evaluate-242"><a href="#MultisetEvaluator.evaluate-242"><span class="linenos">242</span></a><span class="sd">        e.g. `sum_evaluator(generator)` is an alias for `sum_evaluator.evaluate(generator)`.</span>
</span><span id="MultisetEvaluator.evaluate-243"><a href="#MultisetEvaluator.evaluate-243"><span class="linenos">243</span></a>
</span><span id="MultisetEvaluator.evaluate-244"><a href="#MultisetEvaluator.evaluate-244"><span class="linenos">244</span></a><span class="sd">        Most evaluators will expect a fixed number of input multisets.</span>
</span><span id="MultisetEvaluator.evaluate-245"><a href="#MultisetEvaluator.evaluate-245"><span class="linenos">245</span></a><span class="sd">        The union of the outcomes of the generator(s) must be totally orderable.</span>
</span><span id="MultisetEvaluator.evaluate-246"><a href="#MultisetEvaluator.evaluate-246"><span class="linenos">246</span></a>
</span><span id="MultisetEvaluator.evaluate-247"><a href="#MultisetEvaluator.evaluate-247"><span class="linenos">247</span></a><span class="sd">        Args:</span>
</span><span id="MultisetEvaluator.evaluate-248"><a href="#MultisetEvaluator.evaluate-248"><span class="linenos">248</span></a><span class="sd">            *args: Each may be one of the following:</span>
</span><span id="MultisetEvaluator.evaluate-249"><a href="#MultisetEvaluator.evaluate-249"><span class="linenos">249</span></a><span class="sd">                * A `MultisetExpression`.</span>
</span><span id="MultisetEvaluator.evaluate-250"><a href="#MultisetEvaluator.evaluate-250"><span class="linenos">250</span></a><span class="sd">                * A mappable mapping outcomes to the number of those outcomes.</span>
</span><span id="MultisetEvaluator.evaluate-251"><a href="#MultisetEvaluator.evaluate-251"><span class="linenos">251</span></a><span class="sd">                * A sequence of outcomes.</span>
</span><span id="MultisetEvaluator.evaluate-252"><a href="#MultisetEvaluator.evaluate-252"><span class="linenos">252</span></a>
</span><span id="MultisetEvaluator.evaluate-253"><a href="#MultisetEvaluator.evaluate-253"><span class="linenos">253</span></a><span class="sd">        Returns:</span>
</span><span id="MultisetEvaluator.evaluate-254"><a href="#MultisetEvaluator.evaluate-254"><span class="linenos">254</span></a><span class="sd">            A `Die` representing the distribution of the final outcome if no</span>
</span><span id="MultisetEvaluator.evaluate-255"><a href="#MultisetEvaluator.evaluate-255"><span class="linenos">255</span></a><span class="sd">            arg contains a free variable. Otherwise, returns a new evaluator.</span>
</span><span id="MultisetEvaluator.evaluate-256"><a href="#MultisetEvaluator.evaluate-256"><span class="linenos">256</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator.evaluate-257"><a href="#MultisetEvaluator.evaluate-257"><span class="linenos">257</span></a>        <span class="kn">from</span> <span class="nn">icepool.generator.alignment</span> <span class="kn">import</span> <span class="n">Alignment</span>
</span><span id="MultisetEvaluator.evaluate-258"><a href="#MultisetEvaluator.evaluate-258"><span class="linenos">258</span></a>
</span><span id="MultisetEvaluator.evaluate-259"><a href="#MultisetEvaluator.evaluate-259"><span class="linenos">259</span></a>        <span class="c1"># Convert arguments to expressions.</span>
</span><span id="MultisetEvaluator.evaluate-260"><a href="#MultisetEvaluator.evaluate-260"><span class="linenos">260</span></a>        <span class="n">expressions</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetEvaluator.evaluate-261"><a href="#MultisetEvaluator.evaluate-261"><span class="linenos">261</span></a>            <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_expression</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-262"><a href="#MultisetEvaluator.evaluate-262"><span class="linenos">262</span></a>
</span><span id="MultisetEvaluator.evaluate-263"><a href="#MultisetEvaluator.evaluate-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">_free_arity</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">):</span>
</span><span id="MultisetEvaluator.evaluate-264"><a href="#MultisetEvaluator.evaluate-264"><span class="linenos">264</span></a>            <span class="kn">from</span> <span class="nn">icepool.evaluator.expression</span> <span class="kn">import</span> <span class="n">ExpressionEvaluator</span>
</span><span id="MultisetEvaluator.evaluate-265"><a href="#MultisetEvaluator.evaluate-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="n">ExpressionEvaluator</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-266"><a href="#MultisetEvaluator.evaluate-266"><span class="linenos">266</span></a>
</span><span id="MultisetEvaluator.evaluate-267"><a href="#MultisetEvaluator.evaluate-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span>
</span><span id="MultisetEvaluator.evaluate-268"><a href="#MultisetEvaluator.evaluate-268"><span class="linenos">268</span></a>                <span class="nb">isinstance</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-269"><a href="#MultisetEvaluator.evaluate-269"><span class="linenos">269</span></a>                <span class="k">for</span> <span class="n">expression</span> <span class="ow">in</span> <span class="n">expressions</span><span class="p">):</span>
</span><span id="MultisetEvaluator.evaluate-270"><a href="#MultisetEvaluator.evaluate-270"><span class="linenos">270</span></a>            <span class="kn">from</span> <span class="nn">icepool.evaluator.expression</span> <span class="kn">import</span> <span class="n">ExpressionEvaluator</span>
</span><span id="MultisetEvaluator.evaluate-271"><a href="#MultisetEvaluator.evaluate-271"><span class="linenos">271</span></a>            <span class="k">return</span> <span class="n">ExpressionEvaluator</span><span class="p">(</span><span class="o">*</span><span class="n">expressions</span><span class="p">,</span> <span class="n">evaluator</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
</span><span id="MultisetEvaluator.evaluate-272"><a href="#MultisetEvaluator.evaluate-272"><span class="linenos">272</span></a>
</span><span id="MultisetEvaluator.evaluate-273"><a href="#MultisetEvaluator.evaluate-273"><span class="linenos">273</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">tuple</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">expressions</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-274"><a href="#MultisetEvaluator.evaluate-274"><span class="linenos">274</span></a>
</span><span id="MultisetEvaluator.evaluate-275"><a href="#MultisetEvaluator.evaluate-275"><span class="linenos">275</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">validate_arity</span><span class="p">(</span>
</span><span id="MultisetEvaluator.evaluate-276"><a href="#MultisetEvaluator.evaluate-276"><span class="linenos">276</span></a>            <span class="nb">sum</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">output_arity</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">))</span>
</span><span id="MultisetEvaluator.evaluate-277"><a href="#MultisetEvaluator.evaluate-277"><span class="linenos">277</span></a>
</span><span id="MultisetEvaluator.evaluate-278"><a href="#MultisetEvaluator.evaluate-278"><span class="linenos">278</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prefix_generators</span><span class="p">()</span> <span class="o">+</span> <span class="n">generators</span>
</span><span id="MultisetEvaluator.evaluate-279"><a href="#MultisetEvaluator.evaluate-279"><span class="linenos">279</span></a>
</span><span id="MultisetEvaluator.evaluate-280"><a href="#MultisetEvaluator.evaluate-280"><span class="linenos">280</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">_is_resolvable</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">):</span>
</span><span id="MultisetEvaluator.evaluate-281"><a href="#MultisetEvaluator.evaluate-281"><span class="linenos">281</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([])</span>
</span><span id="MultisetEvaluator.evaluate-282"><a href="#MultisetEvaluator.evaluate-282"><span class="linenos">282</span></a>
</span><span id="MultisetEvaluator.evaluate-283"><a href="#MultisetEvaluator.evaluate-283"><span class="linenos">283</span></a>        <span class="n">algorithm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_algorithm</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-284"><a href="#MultisetEvaluator.evaluate-284"><span class="linenos">284</span></a>
</span><span id="MultisetEvaluator.evaluate-285"><a href="#MultisetEvaluator.evaluate-285"><span class="linenos">285</span></a>        <span class="c1"># We use a separate class to guarantee all outcomes are visited.</span>
</span><span id="MultisetEvaluator.evaluate-286"><a href="#MultisetEvaluator.evaluate-286"><span class="linenos">286</span></a>        <span class="n">outcomes</span> <span class="o">=</span> <span class="n">sorted_union</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="MultisetEvaluator.evaluate-287"><a href="#MultisetEvaluator.evaluate-287"><span class="linenos">287</span></a>                                  <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">))</span>
</span><span id="MultisetEvaluator.evaluate-288"><a href="#MultisetEvaluator.evaluate-288"><span class="linenos">288</span></a>        <span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="n">outcomes</span><span class="p">))</span>
</span><span id="MultisetEvaluator.evaluate-289"><a href="#MultisetEvaluator.evaluate-289"><span class="linenos">289</span></a>
</span><span id="MultisetEvaluator.evaluate-290"><a href="#MultisetEvaluator.evaluate-290"><span class="linenos">290</span></a>        <span class="n">dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-291"><a href="#MultisetEvaluator.evaluate-291"><span class="linenos">291</span></a>        <span class="n">iterators</span> <span class="o">=</span> <span class="n">MultisetEvaluator</span><span class="o">.</span><span class="n">_initialize_generators</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-292"><a href="#MultisetEvaluator.evaluate-292"><span class="linenos">292</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">):</span>
</span><span id="MultisetEvaluator.evaluate-293"><a href="#MultisetEvaluator.evaluate-293"><span class="linenos">293</span></a>            <span class="n">sub_generators</span><span class="p">,</span> <span class="n">sub_weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-294"><a href="#MultisetEvaluator.evaluate-294"><span class="linenos">294</span></a>            <span class="n">prod_weight</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">sub_weights</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-295"><a href="#MultisetEvaluator.evaluate-295"><span class="linenos">295</span></a>            <span class="n">sub_result</span> <span class="o">=</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">sub_generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-296"><a href="#MultisetEvaluator.evaluate-296"><span class="linenos">296</span></a>            <span class="k">for</span> <span class="n">sub_state</span><span class="p">,</span> <span class="n">sub_weight</span> <span class="ow">in</span> <span class="n">sub_result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MultisetEvaluator.evaluate-297"><a href="#MultisetEvaluator.evaluate-297"><span class="linenos">297</span></a>                <span class="n">dist</span><span class="p">[</span><span class="n">sub_state</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sub_weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="MultisetEvaluator.evaluate-298"><a href="#MultisetEvaluator.evaluate-298"><span class="linenos">298</span></a>
</span><span id="MultisetEvaluator.evaluate-299"><a href="#MultisetEvaluator.evaluate-299"><span class="linenos">299</span></a>        <span class="n">final_outcomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MultisetEvaluator.evaluate-300"><a href="#MultisetEvaluator.evaluate-300"><span class="linenos">300</span></a>        <span class="n">final_weights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MultisetEvaluator.evaluate-301"><a href="#MultisetEvaluator.evaluate-301"><span class="linenos">301</span></a>        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MultisetEvaluator.evaluate-302"><a href="#MultisetEvaluator.evaluate-302"><span class="linenos">302</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-303"><a href="#MultisetEvaluator.evaluate-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultisetEvaluator.evaluate-304"><a href="#MultisetEvaluator.evaluate-304"><span class="linenos">304</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="MultisetEvaluator.evaluate-305"><a href="#MultisetEvaluator.evaluate-305"><span class="linenos">305</span></a>                    <span class="s2">&quot;None is not a valid final outcome.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="MultisetEvaluator.evaluate-306"><a href="#MultisetEvaluator.evaluate-306"><span class="linenos">306</span></a>                    <span class="s2">&quot;This may have been a result of not supplying any generator with an outcome.&quot;</span>
</span><span id="MultisetEvaluator.evaluate-307"><a href="#MultisetEvaluator.evaluate-307"><span class="linenos">307</span></a>                <span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-308"><a href="#MultisetEvaluator.evaluate-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="MultisetEvaluator.evaluate-309"><a href="#MultisetEvaluator.evaluate-309"><span class="linenos">309</span></a>                <span class="n">final_outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-310"><a href="#MultisetEvaluator.evaluate-310"><span class="linenos">310</span></a>                <span class="n">final_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span><span id="MultisetEvaluator.evaluate-311"><a href="#MultisetEvaluator.evaluate-311"><span class="linenos">311</span></a>
</span><span id="MultisetEvaluator.evaluate-312"><a href="#MultisetEvaluator.evaluate-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">final_outcomes</span><span class="p">,</span> <span class="n">final_weights</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluates generator(s).</p>

<p>You can call the <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code> object directly for the same effect,
e.g. <code>sum_evaluator(generator)</code> is an alias for <code>sum_evaluator.evaluate(generator)</code>.</p>

<p>Most evaluators will expect a fixed number of input multisets.
The union of the outcomes of the generator(s) must be totally orderable.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*args:</strong>  Each may be one of the following:
<ul>
<li>A <code><a href="#MultisetExpression">MultisetExpression</a></code>.</li>
<li>A mappable mapping outcomes to the number of those outcomes.</li>
<li>A sequence of outcomes.</li>
</ul></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the distribution of the final outcome if no
  arg contains a free variable. Otherwise, returns a new evaluator.</p>
</blockquote>
</div>


                            </div>
                            <div id="MultisetEvaluator.sample" class="classattr">
                                        <input id="MultisetEvaluator.sample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetGenerator">MultisetGenerator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MultisetEvaluator.sample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultisetEvaluator.sample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultisetEvaluator.sample-486"><a href="#MultisetEvaluator.sample-486"><span class="linenos">486</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span>
</span><span id="MultisetEvaluator.sample-487"><a href="#MultisetEvaluator.sample-487"><span class="linenos">487</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span>
</span><span id="MultisetEvaluator.sample-488"><a href="#MultisetEvaluator.sample-488"><span class="linenos">488</span></a>        <span class="s1">&#39;icepool.MultisetGenerator[T_contra, Any] | Mapping[T_contra, int] | Sequence[T_contra]&#39;</span>
</span><span id="MultisetEvaluator.sample-489"><a href="#MultisetEvaluator.sample-489"><span class="linenos">489</span></a>    <span class="p">):</span>
</span><span id="MultisetEvaluator.sample-490"><a href="#MultisetEvaluator.sample-490"><span class="linenos">490</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Samples one result from the generator(s) and evaluates the result.&quot;&quot;&quot;</span>
</span><span id="MultisetEvaluator.sample-491"><a href="#MultisetEvaluator.sample-491"><span class="linenos">491</span></a>        <span class="c1"># Convert non-`Pool` arguments to `Pool`.</span>
</span><span id="MultisetEvaluator.sample-492"><a href="#MultisetEvaluator.sample-492"><span class="linenos">492</span></a>        <span class="n">converted_generators</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="MultisetEvaluator.sample-493"><a href="#MultisetEvaluator.sample-493"><span class="linenos">493</span></a>            <span class="n">generator</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultisetGenerator</span>
</span><span id="MultisetEvaluator.sample-494"><a href="#MultisetEvaluator.sample-494"><span class="linenos">494</span></a>                                    <span class="p">)</span> <span class="k">else</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span><span id="MultisetEvaluator.sample-495"><a href="#MultisetEvaluator.sample-495"><span class="linenos">495</span></a>            <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="MultisetEvaluator.sample-496"><a href="#MultisetEvaluator.sample-496"><span class="linenos">496</span></a>
</span><span id="MultisetEvaluator.sample-497"><a href="#MultisetEvaluator.sample-497"><span class="linenos">497</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="MultisetEvaluator.sample-498"><a href="#MultisetEvaluator.sample-498"><span class="linenos">498</span></a>            <span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">converted_generators</span><span class="p">))</span>
</span><span id="MultisetEvaluator.sample-499"><a href="#MultisetEvaluator.sample-499"><span class="linenos">499</span></a>
</span><span id="MultisetEvaluator.sample-500"><a href="#MultisetEvaluator.sample-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="MultisetEvaluator.sample-501"><a href="#MultisetEvaluator.sample-501"><span class="linenos">501</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="MultisetEvaluator.sample-502"><a href="#MultisetEvaluator.sample-502"><span class="linenos">502</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MultisetEvaluator.sample-503"><a href="#MultisetEvaluator.sample-503"><span class="linenos">503</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Samples one result from the generator(s) and evaluates the result.</p>
</div>


                            </div>
                </section>
                <section id="Order">
                            <input id="Order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Order</span><wbr>(<span class="base">enum.IntEnum</span>):

                <label class="view-source-button" for="Order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Order-34"><a href="#Order-34"><span class="linenos">34</span></a><span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span id="Order-35"><a href="#Order-35"><span class="linenos">35</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Can be used to define what order outcomes are seen in by MultisetEvaluators.&quot;&quot;&quot;</span>
</span><span id="Order-36"><a href="#Order-36"><span class="linenos">36</span></a>    <span class="n">Ascending</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Order-37"><a href="#Order-37"><span class="linenos">37</span></a>    <span class="n">Descending</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Order-38"><a href="#Order-38"><span class="linenos">38</span></a>    <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Order-39"><a href="#Order-39"><span class="linenos">39</span></a>
</span><span id="Order-40"><a href="#Order-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="o">*</span><span class="n">orders</span><span class="p">:</span> <span class="s1">&#39;Order&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Order&#39;</span><span class="p">:</span>
</span><span id="Order-41"><a href="#Order-41"><span class="linenos">41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Merges the given Orders.</span>
</span><span id="Order-42"><a href="#Order-42"><span class="linenos">42</span></a>
</span><span id="Order-43"><a href="#Order-43"><span class="linenos">43</span></a><span class="sd">        Returns:</span>
</span><span id="Order-44"><a href="#Order-44"><span class="linenos">44</span></a><span class="sd">            `Any` if all arguments are `Any`.</span>
</span><span id="Order-45"><a href="#Order-45"><span class="linenos">45</span></a><span class="sd">            `Ascending` if there is at least one `Ascending` in the arguments.</span>
</span><span id="Order-46"><a href="#Order-46"><span class="linenos">46</span></a><span class="sd">            `Descending` if there is at least one `Descending` in the arguments.</span>
</span><span id="Order-47"><a href="#Order-47"><span class="linenos">47</span></a>
</span><span id="Order-48"><a href="#Order-48"><span class="linenos">48</span></a><span class="sd">        Raises:</span>
</span><span id="Order-49"><a href="#Order-49"><span class="linenos">49</span></a><span class="sd">            `ValueError` if both `Ascending` and `Descending` are in the</span>
</span><span id="Order-50"><a href="#Order-50"><span class="linenos">50</span></a><span class="sd">            arguments.</span>
</span><span id="Order-51"><a href="#Order-51"><span class="linenos">51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Order-52"><a href="#Order-52"><span class="linenos">52</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span><span id="Order-53"><a href="#Order-53"><span class="linenos">53</span></a>        <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
</span><span id="Order-54"><a href="#Order-54"><span class="linenos">54</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">order</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">result</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Order-55"><a href="#Order-55"><span class="linenos">55</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Order-56"><a href="#Order-56"><span class="linenos">56</span></a>                    <span class="sa">f</span><span class="s1">&#39;Conflicting orders </span><span class="si">{</span><span class="n">orders</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
</span><span id="Order-57"><a href="#Order-57"><span class="linenos">57</span></a>                    <span class="s1">&#39;Tip: If you are using highest(keep=k), try using lowest(drop=n-k) instead, or vice versa.&#39;</span>
</span><span id="Order-58"><a href="#Order-58"><span class="linenos">58</span></a>                <span class="p">)</span>
</span><span id="Order-59"><a href="#Order-59"><span class="linenos">59</span></a>            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="Order-60"><a href="#Order-60"><span class="linenos">60</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="Order-61"><a href="#Order-61"><span class="linenos">61</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Can be used to define what order outcomes are seen in by MultisetEvaluators.</p>
</div>


                            <div id="Order.Ascending" class="classattr">
                                <div class="attr variable">
            <span class="name">Ascending</span>        =
<span class="default_value">&lt;<a href="#Order.Ascending">Order.Ascending</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#Order.Ascending"></a>
    
    

                            </div>
                            <div id="Order.Descending" class="classattr">
                                <div class="attr variable">
            <span class="name">Descending</span>        =
<span class="default_value">&lt;<a href="#Order.Descending">Order.Descending</a>: -1&gt;</span>

        
    </div>
    <a class="headerlink" href="#Order.Descending"></a>
    
    

                            </div>
                            <div id="Order.Any" class="classattr">
                                <div class="attr variable">
            <span class="name">Any</span>        =
<span class="default_value">&lt;<a href="#Order.Any">Order.Any</a>: 0&gt;</span>

        
    </div>
    <a class="headerlink" href="#Order.Any"></a>
    
    

                            </div>
                            <div id="Order.merge" class="classattr">
                                        <input id="Order.merge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">merge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">orders</span><span class="p">:</span> <span class="n"><a href="#Order">Order</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Order">Order</a></span>:</span></span>

                <label class="view-source-button" for="Order.merge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Order.merge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Order.merge-40"><a href="#Order.merge-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="o">*</span><span class="n">orders</span><span class="p">:</span> <span class="s1">&#39;Order&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Order&#39;</span><span class="p">:</span>
</span><span id="Order.merge-41"><a href="#Order.merge-41"><span class="linenos">41</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Merges the given Orders.</span>
</span><span id="Order.merge-42"><a href="#Order.merge-42"><span class="linenos">42</span></a>
</span><span id="Order.merge-43"><a href="#Order.merge-43"><span class="linenos">43</span></a><span class="sd">        Returns:</span>
</span><span id="Order.merge-44"><a href="#Order.merge-44"><span class="linenos">44</span></a><span class="sd">            `Any` if all arguments are `Any`.</span>
</span><span id="Order.merge-45"><a href="#Order.merge-45"><span class="linenos">45</span></a><span class="sd">            `Ascending` if there is at least one `Ascending` in the arguments.</span>
</span><span id="Order.merge-46"><a href="#Order.merge-46"><span class="linenos">46</span></a><span class="sd">            `Descending` if there is at least one `Descending` in the arguments.</span>
</span><span id="Order.merge-47"><a href="#Order.merge-47"><span class="linenos">47</span></a>
</span><span id="Order.merge-48"><a href="#Order.merge-48"><span class="linenos">48</span></a><span class="sd">        Raises:</span>
</span><span id="Order.merge-49"><a href="#Order.merge-49"><span class="linenos">49</span></a><span class="sd">            `ValueError` if both `Ascending` and `Descending` are in the</span>
</span><span id="Order.merge-50"><a href="#Order.merge-50"><span class="linenos">50</span></a><span class="sd">            arguments.</span>
</span><span id="Order.merge-51"><a href="#Order.merge-51"><span class="linenos">51</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Order.merge-52"><a href="#Order.merge-52"><span class="linenos">52</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span><span id="Order.merge-53"><a href="#Order.merge-53"><span class="linenos">53</span></a>        <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
</span><span id="Order.merge-54"><a href="#Order.merge-54"><span class="linenos">54</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">order</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">result</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Order.merge-55"><a href="#Order.merge-55"><span class="linenos">55</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Order.merge-56"><a href="#Order.merge-56"><span class="linenos">56</span></a>                    <span class="sa">f</span><span class="s1">&#39;Conflicting orders </span><span class="si">{</span><span class="n">orders</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
</span><span id="Order.merge-57"><a href="#Order.merge-57"><span class="linenos">57</span></a>                    <span class="s1">&#39;Tip: If you are using highest(keep=k), try using lowest(drop=n-k) instead, or vice versa.&#39;</span>
</span><span id="Order.merge-58"><a href="#Order.merge-58"><span class="linenos">58</span></a>                <span class="p">)</span>
</span><span id="Order.merge-59"><a href="#Order.merge-59"><span class="linenos">59</span></a>            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="Order.merge-60"><a href="#Order.merge-60"><span class="linenos">60</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">order</span>
</span><span id="Order.merge-61"><a href="#Order.merge-61"><span class="linenos">61</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Merges the given Orders.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p><code><a href="#Order.Any">Any</a></code> if all arguments are <code><a href="#Order.Any">Any</a></code>.
  <code><a href="#Order.Ascending">Ascending</a></code> if there is at least one <code><a href="#Order.Ascending">Ascending</a></code> in the arguments.
  <code><a href="#Order.Descending">Descending</a></code> if there is at least one <code><a href="#Order.Descending">Descending</a></code> in the arguments.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><code>ValueError</code> if both <code><a href="#Order.Ascending">Ascending</a></code> and <code><a href="#Order.Descending">Descending</a></code> are in the</li>
<li>arguments.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="Order.name" class="variable">name</dd>
                <dd id="Order.value" class="variable">value</dd>

            </div>
            <div><dt>builtins.int</dt>
                                <dd id="Order.conjugate" class="function">conjugate</dd>
                <dd id="Order.bit_length" class="function">bit_length</dd>
                <dd id="Order.bit_count" class="function">bit_count</dd>
                <dd id="Order.to_bytes" class="function">to_bytes</dd>
                <dd id="Order.from_bytes" class="function">from_bytes</dd>
                <dd id="Order.as_integer_ratio" class="function">as_integer_ratio</dd>
                <dd id="Order.is_integer" class="function">is_integer</dd>
                <dd id="Order.real" class="variable">real</dd>
                <dd id="Order.imag" class="variable">imag</dd>
                <dd id="Order.numerator" class="variable">numerator</dd>
                <dd id="Order.denominator" class="variable">denominator</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Deck">
                            <input id="Deck-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Deck</span><wbr>(<span class="base"><a href="#Population">icepool.Population[+T_co]</a></span>):

                <label class="view-source-button" for="Deck-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck-20"><a href="#Deck-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">Deck</span><span class="p">(</span><span class="n">Population</span><span class="p">[</span><span class="n">T_co</span><span class="p">]):</span>
</span><span id="Deck-21"><a href="#Deck-21"><span class="linenos"> 21</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sampling without replacement (within a single evaluation).</span>
</span><span id="Deck-22"><a href="#Deck-22"><span class="linenos"> 22</span></a>
</span><span id="Deck-23"><a href="#Deck-23"><span class="linenos"> 23</span></a><span class="sd">    Quantities represent duplicates.</span>
</span><span id="Deck-24"><a href="#Deck-24"><span class="linenos"> 24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Deck-25"><a href="#Deck-25"><span class="linenos"> 25</span></a>
</span><span id="Deck-26"><a href="#Deck-26"><span class="linenos"> 26</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span>
</span><span id="Deck-27"><a href="#Deck-27"><span class="linenos"> 27</span></a>    <span class="n">_deal</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Deck-28"><a href="#Deck-28"><span class="linenos"> 28</span></a>
</span><span id="Deck-29"><a href="#Deck-29"><span class="linenos"> 29</span></a>    <span class="nd">@property</span>
</span><span id="Deck-30"><a href="#Deck-30"><span class="linenos"> 30</span></a>    <span class="k">def</span> <span class="nf">_new_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="Deck-31"><a href="#Deck-31"><span class="linenos"> 31</span></a>        <span class="k">return</span> <span class="n">Deck</span>
</span><span id="Deck-32"><a href="#Deck-32"><span class="linenos"> 32</span></a>
</span><span id="Deck-33"><a href="#Deck-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Deck-34"><a href="#Deck-34"><span class="linenos"> 34</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Deck-35"><a href="#Deck-35"><span class="linenos"> 35</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-36"><a href="#Deck-36"><span class="linenos"> 36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for a `Deck`.</span>
</span><span id="Deck-37"><a href="#Deck-37"><span class="linenos"> 37</span></a>
</span><span id="Deck-38"><a href="#Deck-38"><span class="linenos"> 38</span></a><span class="sd">        Args:</span>
</span><span id="Deck-39"><a href="#Deck-39"><span class="linenos"> 39</span></a><span class="sd">            outcomes: The cards of the `Deck`. This can be one of the following:</span>
</span><span id="Deck-40"><a href="#Deck-40"><span class="linenos"> 40</span></a><span class="sd">                * A `Sequence` of outcomes. Duplicates will contribute</span>
</span><span id="Deck-41"><a href="#Deck-41"><span class="linenos"> 41</span></a><span class="sd">                    quantity for each appearance.</span>
</span><span id="Deck-42"><a href="#Deck-42"><span class="linenos"> 42</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Deck-43"><a href="#Deck-43"><span class="linenos"> 43</span></a>
</span><span id="Deck-44"><a href="#Deck-44"><span class="linenos"> 44</span></a><span class="sd">                Each outcome may be one of the following:</span>
</span><span id="Deck-45"><a href="#Deck-45"><span class="linenos"> 45</span></a><span class="sd">                * An outcome, which must be hashable and totally orderable.</span>
</span><span id="Deck-46"><a href="#Deck-46"><span class="linenos"> 46</span></a><span class="sd">                * A `Deck`, which will be flattened into the result. If a</span>
</span><span id="Deck-47"><a href="#Deck-47"><span class="linenos"> 47</span></a><span class="sd">                    `times` is assigned to the `Deck`, the entire `Deck` will</span>
</span><span id="Deck-48"><a href="#Deck-48"><span class="linenos"> 48</span></a><span class="sd">                    be duplicated that many times.</span>
</span><span id="Deck-49"><a href="#Deck-49"><span class="linenos"> 49</span></a><span class="sd">            times: Multiplies the number of times each element of `outcomes`</span>
</span><span id="Deck-50"><a href="#Deck-50"><span class="linenos"> 50</span></a><span class="sd">                will be put into the `Deck`.</span>
</span><span id="Deck-51"><a href="#Deck-51"><span class="linenos"> 51</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Deck-52"><a href="#Deck-52"><span class="linenos"> 52</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Deck-53"><a href="#Deck-53"><span class="linenos"> 53</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Deck-54"><a href="#Deck-54"><span class="linenos"> 54</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-55"><a href="#Deck-55"><span class="linenos"> 55</span></a>
</span><span id="Deck-56"><a href="#Deck-56"><span class="linenos"> 56</span></a>        <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Deck-57"><a href="#Deck-57"><span class="linenos"> 57</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Again cannot be used with Decks.&#39;</span><span class="p">)</span>
</span><span id="Deck-58"><a href="#Deck-58"><span class="linenos"> 58</span></a>
</span><span id="Deck-59"><a href="#Deck-59"><span class="linenos"> 59</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck-60"><a href="#Deck-60"><span class="linenos"> 60</span></a>
</span><span id="Deck-61"><a href="#Deck-61"><span class="linenos"> 61</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Deck-62"><a href="#Deck-62"><span class="linenos"> 62</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck-63"><a href="#Deck-63"><span class="linenos"> 63</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Deck-64"><a href="#Deck-64"><span class="linenos"> 64</span></a>
</span><span id="Deck-65"><a href="#Deck-65"><span class="linenos"> 65</span></a>        <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_deck</span><span class="p">(</span>
</span><span id="Deck-66"><a href="#Deck-66"><span class="linenos"> 66</span></a>            <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck-67"><a href="#Deck-67"><span class="linenos"> 67</span></a>
</span><span id="Deck-68"><a href="#Deck-68"><span class="linenos"> 68</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span><span id="Deck-69"><a href="#Deck-69"><span class="linenos"> 69</span></a>
</span><span id="Deck-70"><a href="#Deck-70"><span class="linenos"> 70</span></a>    <span class="nd">@classmethod</span>
</span><span id="Deck-71"><a href="#Deck-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">_new_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-72"><a href="#Deck-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a new `Deck` using already-processed arguments.</span>
</span><span id="Deck-73"><a href="#Deck-73"><span class="linenos"> 73</span></a>
</span><span id="Deck-74"><a href="#Deck-74"><span class="linenos"> 74</span></a><span class="sd">        Args:</span>
</span><span id="Deck-75"><a href="#Deck-75"><span class="linenos"> 75</span></a><span class="sd">            data: At this point, this is a Counts.</span>
</span><span id="Deck-76"><a href="#Deck-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-77"><a href="#Deck-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Population</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Deck-78"><a href="#Deck-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="Deck-79"><a href="#Deck-79"><span class="linenos"> 79</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Deck-80"><a href="#Deck-80"><span class="linenos"> 80</span></a>
</span><span id="Deck-81"><a href="#Deck-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Deck-82"><a href="#Deck-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Deck-83"><a href="#Deck-83"><span class="linenos"> 83</span></a>
</span><span id="Deck-84"><a href="#Deck-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Deck-85"><a href="#Deck-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Deck-86"><a href="#Deck-86"><span class="linenos"> 86</span></a>
</span><span id="Deck-87"><a href="#Deck-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Deck-88"><a href="#Deck-88"><span class="linenos"> 88</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Deck-89"><a href="#Deck-89"><span class="linenos"> 89</span></a>
</span><span id="Deck-90"><a href="#Deck-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-91"><a href="#Deck-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Deck-92"><a href="#Deck-92"><span class="linenos"> 92</span></a>
</span><span id="Deck-93"><a href="#Deck-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Deck-94"><a href="#Deck-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Deck-95"><a href="#Deck-95"><span class="linenos"> 95</span></a>
</span><span id="Deck-96"><a href="#Deck-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-97"><a href="#Deck-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Deck-98"><a href="#Deck-98"><span class="linenos"> 98</span></a>
</span><span id="Deck-99"><a href="#Deck-99"><span class="linenos"> 99</span></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="o">.</span><span class="n">denominator</span>
</span><span id="Deck-100"><a href="#Deck-100"><span class="linenos">100</span></a>
</span><span id="Deck-101"><a href="#Deck-101"><span class="linenos">101</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-102"><a href="#Deck-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">_popped_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-103"><a href="#Deck-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_min</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Deck-104"><a href="#Deck-104"><span class="linenos">104</span></a>
</span><span id="Deck-105"><a href="#Deck-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">_pop_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-106"><a href="#Deck-106"><span class="linenos">106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `Deck` with the min outcome removed.&quot;&quot;&quot;</span>
</span><span id="Deck-107"><a href="#Deck-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_min</span>
</span><span id="Deck-108"><a href="#Deck-108"><span class="linenos">108</span></a>
</span><span id="Deck-109"><a href="#Deck-109"><span class="linenos">109</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-110"><a href="#Deck-110"><span class="linenos">110</span></a>    <span class="k">def</span> <span class="nf">_popped_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-111"><a href="#Deck-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_max</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Deck-112"><a href="#Deck-112"><span class="linenos">112</span></a>
</span><span id="Deck-113"><a href="#Deck-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">_pop_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-114"><a href="#Deck-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A `Deck` with the max outcome removed.&quot;&quot;&quot;</span>
</span><span id="Deck-115"><a href="#Deck-115"><span class="linenos">115</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_max</span>
</span><span id="Deck-116"><a href="#Deck-116"><span class="linenos">116</span></a>
</span><span id="Deck-117"><a href="#Deck-117"><span class="linenos">117</span></a>    <span class="nd">@overload</span>
</span><span id="Deck-118"><a href="#Deck-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hand_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deal[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-119"><a href="#Deck-119"><span class="linenos">119</span></a>        <span class="o">...</span>
</span><span id="Deck-120"><a href="#Deck-120"><span class="linenos">120</span></a>
</span><span id="Deck-121"><a href="#Deck-121"><span class="linenos">121</span></a>    <span class="nd">@overload</span>
</span><span id="Deck-122"><a href="#Deck-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span>
</span><span id="Deck-123"><a href="#Deck-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">hand_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">hand_size_2</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">more_hand_sizes</span><span class="p">:</span>
</span><span id="Deck-124"><a href="#Deck-124"><span class="linenos">124</span></a>        <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.MultiDeal[T_co, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="Deck-125"><a href="#Deck-125"><span class="linenos">125</span></a>        <span class="o">...</span>
</span><span id="Deck-126"><a href="#Deck-126"><span class="linenos">126</span></a>
</span><span id="Deck-127"><a href="#Deck-127"><span class="linenos">127</span></a>    <span class="nd">@overload</span>
</span><span id="Deck-128"><a href="#Deck-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span>
</span><span id="Deck-129"><a href="#Deck-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Deck-130"><a href="#Deck-130"><span class="linenos">130</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deal[T_co] | icepool.MultiDeal[T_co, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="Deck-131"><a href="#Deck-131"><span class="linenos">131</span></a>        <span class="o">...</span>
</span><span id="Deck-132"><a href="#Deck-132"><span class="linenos">132</span></a>
</span><span id="Deck-133"><a href="#Deck-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span>
</span><span id="Deck-134"><a href="#Deck-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Deck-135"><a href="#Deck-135"><span class="linenos">135</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deal[T_co] | icepool.MultiDeal[T_co, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="Deck-136"><a href="#Deck-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a `Deal` object from this deck.</span>
</span><span id="Deck-137"><a href="#Deck-137"><span class="linenos">137</span></a>
</span><span id="Deck-138"><a href="#Deck-138"><span class="linenos">138</span></a><span class="sd">        See `Deal()` for details.</span>
</span><span id="Deck-139"><a href="#Deck-139"><span class="linenos">139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-140"><a href="#Deck-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hand_sizes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Deck-141"><a href="#Deck-141"><span class="linenos">141</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">)</span>
</span><span id="Deck-142"><a href="#Deck-142"><span class="linenos">142</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-143"><a href="#Deck-143"><span class="linenos">143</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultiDeal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">)</span>
</span><span id="Deck-144"><a href="#Deck-144"><span class="linenos">144</span></a>
</span><span id="Deck-145"><a href="#Deck-145"><span class="linenos">145</span></a>    <span class="c1"># Binary operators.</span>
</span><span id="Deck-146"><a href="#Deck-146"><span class="linenos">146</span></a>
</span><span id="Deck-147"><a href="#Deck-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span>
</span><span id="Deck-148"><a href="#Deck-148"><span class="linenos">148</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-149"><a href="#Deck-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Both decks merged together.&quot;&quot;&quot;</span>
</span><span id="Deck-150"><a href="#Deck-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Deck-151"><a href="#Deck-151"><span class="linenos">151</span></a>
</span><span id="Deck-152"><a href="#Deck-152"><span class="linenos">152</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Deck-153"><a href="#Deck-153"><span class="linenos">153</span></a>                <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-154"><a href="#Deck-154"><span class="linenos">154</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Deck-155"><a href="#Deck-155"><span class="linenos">155</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Deck-156"><a href="#Deck-156"><span class="linenos">156</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">count</span>
</span><span id="Deck-157"><a href="#Deck-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-158"><a href="#Deck-158"><span class="linenos">158</span></a>
</span><span id="Deck-159"><a href="#Deck-159"><span class="linenos">159</span></a>    <span class="fm">__radd__</span> <span class="o">=</span> <span class="fm">__add__</span>
</span><span id="Deck-160"><a href="#Deck-160"><span class="linenos">160</span></a>
</span><span id="Deck-161"><a href="#Deck-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Deck-162"><a href="#Deck-162"><span class="linenos">162</span></a>                   <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-163"><a href="#Deck-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This deck with the other cards removed (but not below zero of each card).&quot;&quot;&quot;</span>
</span><span id="Deck-164"><a href="#Deck-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Deck-165"><a href="#Deck-165"><span class="linenos">165</span></a>
</span><span id="Deck-166"><a href="#Deck-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Deck-167"><a href="#Deck-167"><span class="linenos">167</span></a>                <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-168"><a href="#Deck-168"><span class="linenos">168</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Deck-169"><a href="#Deck-169"><span class="linenos">169</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Deck-170"><a href="#Deck-170"><span class="linenos">170</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">-=</span> <span class="n">count</span>
</span><span id="Deck-171"><a href="#Deck-171"><span class="linenos">171</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-172"><a href="#Deck-172"><span class="linenos">172</span></a>
</span><span id="Deck-173"><a href="#Deck-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Deck-174"><a href="#Deck-174"><span class="linenos">174</span></a>                 <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-175"><a href="#Deck-175"><span class="linenos">175</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Deck-176"><a href="#Deck-176"><span class="linenos">176</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Deck-177"><a href="#Deck-177"><span class="linenos">177</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">-=</span> <span class="n">count</span>
</span><span id="Deck-178"><a href="#Deck-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-179"><a href="#Deck-179"><span class="linenos">179</span></a>
</span><span id="Deck-180"><a href="#Deck-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span>
</span><span id="Deck-181"><a href="#Deck-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-182"><a href="#Deck-182"><span class="linenos">182</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The cards that both decks have.&quot;&quot;&quot;</span>
</span><span id="Deck-183"><a href="#Deck-183"><span class="linenos">183</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Deck-184"><a href="#Deck-184"><span class="linenos">184</span></a>
</span><span id="Deck-185"><a href="#Deck-185"><span class="linenos">185</span></a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Deck-186"><a href="#Deck-186"><span class="linenos">186</span></a>                <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-187"><a href="#Deck-187"><span class="linenos">187</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Counter</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
</span><span id="Deck-188"><a href="#Deck-188"><span class="linenos">188</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Deck-189"><a href="#Deck-189"><span class="linenos">189</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Deck-190"><a href="#Deck-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-191"><a href="#Deck-191"><span class="linenos">191</span></a>
</span><span id="Deck-192"><a href="#Deck-192"><span class="linenos">192</span></a>    <span class="fm">__rand__</span> <span class="o">=</span> <span class="fm">__and__</span>
</span><span id="Deck-193"><a href="#Deck-193"><span class="linenos">193</span></a>
</span><span id="Deck-194"><a href="#Deck-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Deck-195"><a href="#Deck-195"><span class="linenos">195</span></a>              <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-196"><a href="#Deck-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;As many of each card as the deck that has more of them.&quot;&quot;&quot;</span>
</span><span id="Deck-197"><a href="#Deck-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Deck-198"><a href="#Deck-198"><span class="linenos">198</span></a>
</span><span id="Deck-199"><a href="#Deck-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Deck-200"><a href="#Deck-200"><span class="linenos">200</span></a>               <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-201"><a href="#Deck-201"><span class="linenos">201</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Deck-202"><a href="#Deck-202"><span class="linenos">202</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Deck-203"><a href="#Deck-203"><span class="linenos">203</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">],</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Deck-204"><a href="#Deck-204"><span class="linenos">204</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-205"><a href="#Deck-205"><span class="linenos">205</span></a>
</span><span id="Deck-206"><a href="#Deck-206"><span class="linenos">206</span></a>    <span class="fm">__ror__</span> <span class="o">=</span> <span class="fm">__or__</span>
</span><span id="Deck-207"><a href="#Deck-207"><span class="linenos">207</span></a>
</span><span id="Deck-208"><a href="#Deck-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">symmetric_difference</span><span class="p">(</span>
</span><span id="Deck-209"><a href="#Deck-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-210"><a href="#Deck-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;As many of each card as the deck that has more of them.&quot;&quot;&quot;</span>
</span><span id="Deck-211"><a href="#Deck-211"><span class="linenos">211</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">^</span> <span class="n">other</span>
</span><span id="Deck-212"><a href="#Deck-212"><span class="linenos">212</span></a>
</span><span id="Deck-213"><a href="#Deck-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Deck-214"><a href="#Deck-214"><span class="linenos">214</span></a>                <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-215"><a href="#Deck-215"><span class="linenos">215</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Deck-216"><a href="#Deck-216"><span class="linenos">216</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">Counter</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Deck-217"><a href="#Deck-217"><span class="linenos">217</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">-</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Deck-218"><a href="#Deck-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-219"><a href="#Deck-219"><span class="linenos">219</span></a>
</span><span id="Deck-220"><a href="#Deck-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="nf">multiply_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-221"><a href="#Deck-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge multiple copies of the deck.&quot;&quot;&quot;</span>
</span><span id="Deck-222"><a href="#Deck-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</span><span id="Deck-223"><a href="#Deck-223"><span class="linenos">223</span></a>
</span><span id="Deck-224"><a href="#Deck-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-225"><a href="#Deck-225"><span class="linenos">225</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Deck-226"><a href="#Deck-226"><span class="linenos">226</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Deck-227"><a href="#Deck-227"><span class="linenos">227</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">({</span><span class="n">s</span><span class="p">:</span> <span class="n">count</span> <span class="o">*</span> <span class="n">other</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</span><span id="Deck-228"><a href="#Deck-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-229"><a href="#Deck-229"><span class="linenos">229</span></a>
</span><span id="Deck-230"><a href="#Deck-230"><span class="linenos">230</span></a>    <span class="fm">__rmul__</span> <span class="o">=</span> <span class="fm">__mul__</span>
</span><span id="Deck-231"><a href="#Deck-231"><span class="linenos">231</span></a>
</span><span id="Deck-232"><a href="#Deck-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">divide_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-233"><a href="#Deck-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divide all card counts, rounding down.&quot;&quot;&quot;</span>
</span><span id="Deck-234"><a href="#Deck-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">//</span> <span class="n">other</span>
</span><span id="Deck-235"><a href="#Deck-235"><span class="linenos">235</span></a>
</span><span id="Deck-236"><a href="#Deck-236"><span class="linenos">236</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-237"><a href="#Deck-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Deck-238"><a href="#Deck-238"><span class="linenos">238</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Deck-239"><a href="#Deck-239"><span class="linenos">239</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">({</span><span class="n">s</span><span class="p">:</span> <span class="n">count</span> <span class="o">//</span> <span class="n">other</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</span><span id="Deck-240"><a href="#Deck-240"><span class="linenos">240</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-241"><a href="#Deck-241"><span class="linenos">241</span></a>
</span><span id="Deck-242"><a href="#Deck-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">modulo_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-243"><a href="#Deck-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modulo all card counts.&quot;&quot;&quot;</span>
</span><span id="Deck-244"><a href="#Deck-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">%</span> <span class="n">other</span>
</span><span id="Deck-245"><a href="#Deck-245"><span class="linenos">245</span></a>
</span><span id="Deck-246"><a href="#Deck-246"><span class="linenos">246</span></a>    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck-247"><a href="#Deck-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Deck-248"><a href="#Deck-248"><span class="linenos">248</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Deck-249"><a href="#Deck-249"><span class="linenos">249</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">({</span><span class="n">s</span><span class="p">:</span> <span class="n">count</span> <span class="o">%</span> <span class="n">other</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
</span><span id="Deck-250"><a href="#Deck-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span><span class="o">+</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-251"><a href="#Deck-251"><span class="linenos">251</span></a>
</span><span id="Deck-252"><a href="#Deck-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span>
</span><span id="Deck-253"><a href="#Deck-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Deck-254"><a href="#Deck-254"><span class="linenos">254</span></a>            <span class="n">repl</span><span class="p">:</span>
</span><span id="Deck-255"><a href="#Deck-255"><span class="linenos">255</span></a>        <span class="s1">&#39;Callable[..., U | Deck[U] | icepool.RerollType] | Mapping[T_co, U | Deck[U] | icepool.RerollType]&#39;</span><span class="p">,</span>
</span><span id="Deck-256"><a href="#Deck-256"><span class="linenos">256</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Deck-257"><a href="#Deck-257"><span class="linenos">257</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[U]&#39;</span><span class="p">:</span>
</span><span id="Deck-258"><a href="#Deck-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps outcomes of this `Deck` to other outcomes.</span>
</span><span id="Deck-259"><a href="#Deck-259"><span class="linenos">259</span></a>
</span><span id="Deck-260"><a href="#Deck-260"><span class="linenos">260</span></a><span class="sd">        Args:</span>
</span><span id="Deck-261"><a href="#Deck-261"><span class="linenos">261</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Deck-262"><a href="#Deck-262"><span class="linenos">262</span></a><span class="sd">                * A callable returning a new outcome for each old outcome.</span>
</span><span id="Deck-263"><a href="#Deck-263"><span class="linenos">263</span></a><span class="sd">                * A map from old outcomes to new outcomes.</span>
</span><span id="Deck-264"><a href="#Deck-264"><span class="linenos">264</span></a><span class="sd">                    Unmapped old outcomes stay the same.</span>
</span><span id="Deck-265"><a href="#Deck-265"><span class="linenos">265</span></a><span class="sd">                The new outcomes may be `Deck`s, in which case one card is</span>
</span><span id="Deck-266"><a href="#Deck-266"><span class="linenos">266</span></a><span class="sd">                replaced with several. This is not recommended.</span>
</span><span id="Deck-267"><a href="#Deck-267"><span class="linenos">267</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Deck-268"><a href="#Deck-268"><span class="linenos">268</span></a><span class="sd">                before sending them to a callable `repl`.</span>
</span><span id="Deck-269"><a href="#Deck-269"><span class="linenos">269</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Deck-270"><a href="#Deck-270"><span class="linenos">270</span></a><span class="sd">                signature.</span>
</span><span id="Deck-271"><a href="#Deck-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-272"><a href="#Deck-272"><span class="linenos">272</span></a>        <span class="c1"># Convert to a single-argument function.</span>
</span><span id="Deck-273"><a href="#Deck-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">repl</span><span class="p">):</span>
</span><span id="Deck-274"><a href="#Deck-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="n">star</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Deck-275"><a href="#Deck-275"><span class="linenos">275</span></a>                <span class="n">star</span> <span class="o">=</span> <span class="n">guess_star</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</span><span id="Deck-276"><a href="#Deck-276"><span class="linenos">276</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Deck-277"><a href="#Deck-277"><span class="linenos">277</span></a>
</span><span id="Deck-278"><a href="#Deck-278"><span class="linenos">278</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck-279"><a href="#Deck-279"><span class="linenos">279</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck-280"><a href="#Deck-280"><span class="linenos">280</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-281"><a href="#Deck-281"><span class="linenos">281</span></a>
</span><span id="Deck-282"><a href="#Deck-282"><span class="linenos">282</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck-283"><a href="#Deck-283"><span class="linenos">283</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck-284"><a href="#Deck-284"><span class="linenos">284</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-285"><a href="#Deck-285"><span class="linenos">285</span></a>            <span class="c1"># repl is a mapping.</span>
</span><span id="Deck-286"><a href="#Deck-286"><span class="linenos">286</span></a>            <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck-287"><a href="#Deck-287"><span class="linenos">287</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">repl</span><span class="p">:</span>
</span><span id="Deck-288"><a href="#Deck-288"><span class="linenos">288</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Deck-289"><a href="#Deck-289"><span class="linenos">289</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-290"><a href="#Deck-290"><span class="linenos">290</span></a>                    <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Deck-291"><a href="#Deck-291"><span class="linenos">291</span></a>
</span><span id="Deck-292"><a href="#Deck-292"><span class="linenos">292</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span>
</span><span id="Deck-293"><a href="#Deck-293"><span class="linenos">293</span></a>            <span class="p">[</span><span class="n">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()],</span>
</span><span id="Deck-294"><a href="#Deck-294"><span class="linenos">294</span></a>            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span><span id="Deck-295"><a href="#Deck-295"><span class="linenos">295</span></a>
</span><span id="Deck-296"><a href="#Deck-296"><span class="linenos">296</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-297"><a href="#Deck-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">_hash_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Deck-298"><a href="#Deck-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Deck-299"><a href="#Deck-299"><span class="linenos">299</span></a>
</span><span id="Deck-300"><a href="#Deck-300"><span class="linenos">300</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Deck-301"><a href="#Deck-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck-302"><a href="#Deck-302"><span class="linenos">302</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Deck-303"><a href="#Deck-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_hash_key</span>
</span><span id="Deck-304"><a href="#Deck-304"><span class="linenos">304</span></a>
</span><span id="Deck-305"><a href="#Deck-305"><span class="linenos">305</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-306"><a href="#Deck-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-307"><a href="#Deck-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hash_key</span><span class="p">)</span>
</span><span id="Deck-308"><a href="#Deck-308"><span class="linenos">308</span></a>
</span><span id="Deck-309"><a href="#Deck-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-310"><a href="#Deck-310"><span class="linenos">310</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="Deck-311"><a href="#Deck-311"><span class="linenos">311</span></a>
</span><span id="Deck-312"><a href="#Deck-312"><span class="linenos">312</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Deck-313"><a href="#Deck-313"><span class="linenos">313</span></a>        <span class="n">inner</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Deck-314"><a href="#Deck-314"><span class="linenos">314</span></a>                          <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Deck-315"><a href="#Deck-315"><span class="linenos">315</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="s1">&#39;({&#39;</span> <span class="o">+</span> <span class="n">inner</span> <span class="o">+</span> <span class="s1">&#39;})&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Sampling without replacement (within a single evaluation).</p>

<p>Quantities represent duplicates.</p>
</div>


                            <div id="Deck.__init__" class="classattr">
                                        <input id="Deck.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Deck</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">times</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></span>)</span>

                <label class="view-source-button" for="Deck.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.__init__-33"><a href="#Deck.__init__-33"><span class="linenos">33</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Deck.__init__-34"><a href="#Deck.__init__-34"><span class="linenos">34</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Deck.__init__-35"><a href="#Deck.__init__-35"><span class="linenos">35</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.__init__-36"><a href="#Deck.__init__-36"><span class="linenos">36</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for a `Deck`.</span>
</span><span id="Deck.__init__-37"><a href="#Deck.__init__-37"><span class="linenos">37</span></a>
</span><span id="Deck.__init__-38"><a href="#Deck.__init__-38"><span class="linenos">38</span></a><span class="sd">        Args:</span>
</span><span id="Deck.__init__-39"><a href="#Deck.__init__-39"><span class="linenos">39</span></a><span class="sd">            outcomes: The cards of the `Deck`. This can be one of the following:</span>
</span><span id="Deck.__init__-40"><a href="#Deck.__init__-40"><span class="linenos">40</span></a><span class="sd">                * A `Sequence` of outcomes. Duplicates will contribute</span>
</span><span id="Deck.__init__-41"><a href="#Deck.__init__-41"><span class="linenos">41</span></a><span class="sd">                    quantity for each appearance.</span>
</span><span id="Deck.__init__-42"><a href="#Deck.__init__-42"><span class="linenos">42</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Deck.__init__-43"><a href="#Deck.__init__-43"><span class="linenos">43</span></a>
</span><span id="Deck.__init__-44"><a href="#Deck.__init__-44"><span class="linenos">44</span></a><span class="sd">                Each outcome may be one of the following:</span>
</span><span id="Deck.__init__-45"><a href="#Deck.__init__-45"><span class="linenos">45</span></a><span class="sd">                * An outcome, which must be hashable and totally orderable.</span>
</span><span id="Deck.__init__-46"><a href="#Deck.__init__-46"><span class="linenos">46</span></a><span class="sd">                * A `Deck`, which will be flattened into the result. If a</span>
</span><span id="Deck.__init__-47"><a href="#Deck.__init__-47"><span class="linenos">47</span></a><span class="sd">                    `times` is assigned to the `Deck`, the entire `Deck` will</span>
</span><span id="Deck.__init__-48"><a href="#Deck.__init__-48"><span class="linenos">48</span></a><span class="sd">                    be duplicated that many times.</span>
</span><span id="Deck.__init__-49"><a href="#Deck.__init__-49"><span class="linenos">49</span></a><span class="sd">            times: Multiplies the number of times each element of `outcomes`</span>
</span><span id="Deck.__init__-50"><a href="#Deck.__init__-50"><span class="linenos">50</span></a><span class="sd">                will be put into the `Deck`.</span>
</span><span id="Deck.__init__-51"><a href="#Deck.__init__-51"><span class="linenos">51</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Deck.__init__-52"><a href="#Deck.__init__-52"><span class="linenos">52</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Deck.__init__-53"><a href="#Deck.__init__-53"><span class="linenos">53</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Deck.__init__-54"><a href="#Deck.__init__-54"><span class="linenos">54</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.__init__-55"><a href="#Deck.__init__-55"><span class="linenos">55</span></a>
</span><span id="Deck.__init__-56"><a href="#Deck.__init__-56"><span class="linenos">56</span></a>        <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Deck.__init__-57"><a href="#Deck.__init__-57"><span class="linenos">57</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Again cannot be used with Decks.&#39;</span><span class="p">)</span>
</span><span id="Deck.__init__-58"><a href="#Deck.__init__-58"><span class="linenos">58</span></a>
</span><span id="Deck.__init__-59"><a href="#Deck.__init__-59"><span class="linenos">59</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck.__init__-60"><a href="#Deck.__init__-60"><span class="linenos">60</span></a>
</span><span id="Deck.__init__-61"><a href="#Deck.__init__-61"><span class="linenos">61</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Deck.__init__-62"><a href="#Deck.__init__-62"><span class="linenos">62</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck.__init__-63"><a href="#Deck.__init__-63"><span class="linenos">63</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Deck.__init__-64"><a href="#Deck.__init__-64"><span class="linenos">64</span></a>
</span><span id="Deck.__init__-65"><a href="#Deck.__init__-65"><span class="linenos">65</span></a>        <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_deck</span><span class="p">(</span>
</span><span id="Deck.__init__-66"><a href="#Deck.__init__-66"><span class="linenos">66</span></a>            <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck.__init__-67"><a href="#Deck.__init__-67"><span class="linenos">67</span></a>
</span><span id="Deck.__init__-68"><a href="#Deck.__init__-68"><span class="linenos">68</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructor for a <code><a href="#Deck">Deck</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>outcomes:</strong>  The cards of the <code><a href="#Deck">Deck</a></code>. This can be one of the following:</p>

<ul>
<li>A <code>Sequence</code> of outcomes. Duplicates will contribute
quantity for each appearance.</li>
<li>A <code>Mapping</code> from outcomes to quantities.</li>
</ul>

<p>Each outcome may be one of the following:</p>

<ul>
<li>An outcome, which must be hashable and totally orderable.</li>
<li>A <code><a href="#Deck">Deck</a></code>, which will be flattened into the result. If a
<code>times</code> is assigned to the <code><a href="#Deck">Deck</a></code>, the entire <code><a href="#Deck">Deck</a></code> will
be duplicated that many times.</li>
</ul></li>
<li><strong>times:</strong>  Multiplies the number of times each element of <code><a href="#Deck.outcomes">outcomes</a></code>
will be put into the <code><a href="#Deck">Deck</a></code>.
<code>times</code> can either be a sequence of the same length as
<code><a href="#Deck.outcomes">outcomes</a></code> or a single <code>int</code> to apply to all elements of
<code><a href="#Deck.outcomes">outcomes</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Deck.keys" class="classattr">
                                        <input id="Deck.keys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">CountsKeysView</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.keys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.keys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.keys-81"><a href="#Deck.keys-81"><span class="linenos">81</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Deck.keys-82"><a href="#Deck.keys-82"><span class="linenos">82</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes within the population in sorted order.</p>
</div>


                            </div>
                            <div id="Deck.values" class="classattr">
                                        <input id="Deck.values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsValuesView">CountsValuesView</a></span>:</span></span>

                <label class="view-source-button" for="Deck.values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.values-84"><a href="#Deck.values-84"><span class="linenos">84</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Deck.values-85"><a href="#Deck.values-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The quantities within the population in outcome order.</p>
</div>


                            </div>
                            <div id="Deck.items" class="classattr">
                                        <input id="Deck.items-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">items</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsItemsView">CountsItemsView</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.items-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.items"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.items-87"><a href="#Deck.items-87"><span class="linenos">87</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">[</span><span class="n">T_co</span><span class="p">]:</span>
</span><span id="Deck.items-88"><a href="#Deck.items-88"><span class="linenos">88</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The (outcome, quantity)s of the population in sorted order.</p>
</div>


                            </div>
                            <div id="Deck.size" class="classattr">
                                        <input id="Deck.size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deck.size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.size-255"><a href="#Deck.size-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck.size-256"><a href="#Deck.size-256"><span class="linenos">256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The sum of all quantities (e.g. weights or duplicates).</span>
</span><span id="Deck.size-257"><a href="#Deck.size-257"><span class="linenos">257</span></a>
</span><span id="Deck.size-258"><a href="#Deck.size-258"><span class="linenos">258</span></a><span class="sd">        For the number of unique outcomes, including those with zero quantity,</span>
</span><span id="Deck.size-259"><a href="#Deck.size-259"><span class="linenos">259</span></a><span class="sd">        use `len()`.</span>
</span><span id="Deck.size-260"><a href="#Deck.size-260"><span class="linenos">260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.size-261"><a href="#Deck.size-261"><span class="linenos">261</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span></pre></div>


            <div class="docstring"><p>The sum of all quantities (e.g. weights or duplicates).</p>

<p>For the number of unique outcomes, including those with zero quantity,
use <code>len()</code>.</p>
</div>


                            </div>
                            <div id="Deck.deal" class="classattr">
                                        <input id="Deck.deal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deal</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Deal">Deal</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n"><a href="#MultiDeal">MultiDeal</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="Deck.deal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.deal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.deal-133"><a href="#Deck.deal-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span>
</span><span id="Deck.deal-134"><a href="#Deck.deal-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Deck.deal-135"><a href="#Deck.deal-135"><span class="linenos">135</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deal[T_co] | icepool.MultiDeal[T_co, tuple[int, ...]]&#39;</span><span class="p">:</span>
</span><span id="Deck.deal-136"><a href="#Deck.deal-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a `Deal` object from this deck.</span>
</span><span id="Deck.deal-137"><a href="#Deck.deal-137"><span class="linenos">137</span></a>
</span><span id="Deck.deal-138"><a href="#Deck.deal-138"><span class="linenos">138</span></a><span class="sd">        See `Deal()` for details.</span>
</span><span id="Deck.deal-139"><a href="#Deck.deal-139"><span class="linenos">139</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.deal-140"><a href="#Deck.deal-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hand_sizes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Deck.deal-141"><a href="#Deck.deal-141"><span class="linenos">141</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">)</span>
</span><span id="Deck.deal-142"><a href="#Deck.deal-142"><span class="linenos">142</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.deal-143"><a href="#Deck.deal-143"><span class="linenos">143</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">MultiDeal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a <code><a href="#Deal">Deal</a></code> object from this deck.</p>

<p>See <code><a href="#Deal">Deal()</a></code> for details.</p>
</div>


                            </div>
                            <div id="Deck.additive_union" class="classattr">
                                        <input id="Deck.additive_union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">additive_union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.additive_union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.additive_union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.additive_union-147"><a href="#Deck.additive_union-147"><span class="linenos">147</span></a>    <span class="k">def</span> <span class="nf">additive_union</span><span class="p">(</span>
</span><span id="Deck.additive_union-148"><a href="#Deck.additive_union-148"><span class="linenos">148</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.additive_union-149"><a href="#Deck.additive_union-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Both decks merged together.&quot;&quot;&quot;</span>
</span><span id="Deck.additive_union-150"><a href="#Deck.additive_union-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Both decks merged together.</p>
</div>


                            </div>
                            <div id="Deck.difference" class="classattr">
                                        <input id="Deck.difference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">difference</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.difference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.difference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.difference-161"><a href="#Deck.difference-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">difference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Deck.difference-162"><a href="#Deck.difference-162"><span class="linenos">162</span></a>                   <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.difference-163"><a href="#Deck.difference-163"><span class="linenos">163</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;This deck with the other cards removed (but not below zero of each card).&quot;&quot;&quot;</span>
</span><span id="Deck.difference-164"><a href="#Deck.difference-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This deck with the other cards removed (but not below zero of each card).</p>
</div>


                            </div>
                            <div id="Deck.intersection" class="classattr">
                                        <input id="Deck.intersection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">intersection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.intersection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.intersection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.intersection-180"><a href="#Deck.intersection-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span>
</span><span id="Deck.intersection-181"><a href="#Deck.intersection-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.intersection-182"><a href="#Deck.intersection-182"><span class="linenos">182</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The cards that both decks have.&quot;&quot;&quot;</span>
</span><span id="Deck.intersection-183"><a href="#Deck.intersection-183"><span class="linenos">183</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The cards that both decks have.</p>
</div>


                            </div>
                            <div id="Deck.union" class="classattr">
                                        <input id="Deck.union-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">union</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.union-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.union"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.union-194"><a href="#Deck.union-194"><span class="linenos">194</span></a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span>
</span><span id="Deck.union-195"><a href="#Deck.union-195"><span class="linenos">195</span></a>              <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.union-196"><a href="#Deck.union-196"><span class="linenos">196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;As many of each card as the deck that has more of them.&quot;&quot;&quot;</span>
</span><span id="Deck.union-197"><a href="#Deck.union-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>As many of each card as the deck that has more of them.</p>
</div>


                            </div>
                            <div id="Deck.symmetric_difference" class="classattr">
                                        <input id="Deck.symmetric_difference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">symmetric_difference</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.symmetric_difference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.symmetric_difference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.symmetric_difference-208"><a href="#Deck.symmetric_difference-208"><span class="linenos">208</span></a>    <span class="k">def</span> <span class="nf">symmetric_difference</span><span class="p">(</span>
</span><span id="Deck.symmetric_difference-209"><a href="#Deck.symmetric_difference-209"><span class="linenos">209</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">T_co</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.symmetric_difference-210"><a href="#Deck.symmetric_difference-210"><span class="linenos">210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;As many of each card as the deck that has more of them.&quot;&quot;&quot;</span>
</span><span id="Deck.symmetric_difference-211"><a href="#Deck.symmetric_difference-211"><span class="linenos">211</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">^</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>As many of each card as the deck that has more of them.</p>
</div>


                            </div>
                            <div id="Deck.multiply_counts" class="classattr">
                                        <input id="Deck.multiply_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">multiply_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.multiply_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.multiply_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.multiply_counts-220"><a href="#Deck.multiply_counts-220"><span class="linenos">220</span></a>    <span class="k">def</span> <span class="nf">multiply_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.multiply_counts-221"><a href="#Deck.multiply_counts-221"><span class="linenos">221</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge multiple copies of the deck.&quot;&quot;&quot;</span>
</span><span id="Deck.multiply_counts-222"><a href="#Deck.multiply_counts-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>Merge multiple copies of the deck.</p>
</div>


                            </div>
                            <div id="Deck.divide_counts" class="classattr">
                                        <input id="Deck.divide_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">divide_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.divide_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.divide_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.divide_counts-232"><a href="#Deck.divide_counts-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">divide_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.divide_counts-233"><a href="#Deck.divide_counts-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Divide all card counts, rounding down.&quot;&quot;&quot;</span>
</span><span id="Deck.divide_counts-234"><a href="#Deck.divide_counts-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">//</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>Divide all card counts, rounding down.</p>
</div>


                            </div>
                            <div id="Deck.modulo_counts" class="classattr">
                                        <input id="Deck.modulo_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modulo_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.modulo_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.modulo_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.modulo_counts-242"><a href="#Deck.modulo_counts-242"><span class="linenos">242</span></a>    <span class="k">def</span> <span class="nf">modulo_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[T_co]&#39;</span><span class="p">:</span>
</span><span id="Deck.modulo_counts-243"><a href="#Deck.modulo_counts-243"><span class="linenos">243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Modulo all card counts.&quot;&quot;&quot;</span>
</span><span id="Deck.modulo_counts-244"><a href="#Deck.modulo_counts-244"><span class="linenos">244</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">%</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>Modulo all card counts.</p>
</div>


                            </div>
                            <div id="Deck.map" class="classattr">
                                        <input id="Deck.map-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">map</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">]],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">+</span><span class="n">T_co</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">,</span> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">],</span> <span class="n"><a href="#RerollType">RerollType</a></span><span class="p">]]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">~</span><span class="n">U</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deck.map-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.map"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.map-252"><a href="#Deck.map-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="nf">map</span><span class="p">(</span>
</span><span id="Deck.map-253"><a href="#Deck.map-253"><span class="linenos">253</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="Deck.map-254"><a href="#Deck.map-254"><span class="linenos">254</span></a>            <span class="n">repl</span><span class="p">:</span>
</span><span id="Deck.map-255"><a href="#Deck.map-255"><span class="linenos">255</span></a>        <span class="s1">&#39;Callable[..., U | Deck[U] | icepool.RerollType] | Mapping[T_co, U | Deck[U] | icepool.RerollType]&#39;</span><span class="p">,</span>
</span><span id="Deck.map-256"><a href="#Deck.map-256"><span class="linenos">256</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Deck.map-257"><a href="#Deck.map-257"><span class="linenos">257</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck[U]&#39;</span><span class="p">:</span>
</span><span id="Deck.map-258"><a href="#Deck.map-258"><span class="linenos">258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps outcomes of this `Deck` to other outcomes.</span>
</span><span id="Deck.map-259"><a href="#Deck.map-259"><span class="linenos">259</span></a>
</span><span id="Deck.map-260"><a href="#Deck.map-260"><span class="linenos">260</span></a><span class="sd">        Args:</span>
</span><span id="Deck.map-261"><a href="#Deck.map-261"><span class="linenos">261</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Deck.map-262"><a href="#Deck.map-262"><span class="linenos">262</span></a><span class="sd">                * A callable returning a new outcome for each old outcome.</span>
</span><span id="Deck.map-263"><a href="#Deck.map-263"><span class="linenos">263</span></a><span class="sd">                * A map from old outcomes to new outcomes.</span>
</span><span id="Deck.map-264"><a href="#Deck.map-264"><span class="linenos">264</span></a><span class="sd">                    Unmapped old outcomes stay the same.</span>
</span><span id="Deck.map-265"><a href="#Deck.map-265"><span class="linenos">265</span></a><span class="sd">                The new outcomes may be `Deck`s, in which case one card is</span>
</span><span id="Deck.map-266"><a href="#Deck.map-266"><span class="linenos">266</span></a><span class="sd">                replaced with several. This is not recommended.</span>
</span><span id="Deck.map-267"><a href="#Deck.map-267"><span class="linenos">267</span></a><span class="sd">            star: Whether outcomes should be unpacked into separate arguments</span>
</span><span id="Deck.map-268"><a href="#Deck.map-268"><span class="linenos">268</span></a><span class="sd">                before sending them to a callable `repl`.</span>
</span><span id="Deck.map-269"><a href="#Deck.map-269"><span class="linenos">269</span></a><span class="sd">                If not provided, this will be guessed based on the function</span>
</span><span id="Deck.map-270"><a href="#Deck.map-270"><span class="linenos">270</span></a><span class="sd">                signature.</span>
</span><span id="Deck.map-271"><a href="#Deck.map-271"><span class="linenos">271</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.map-272"><a href="#Deck.map-272"><span class="linenos">272</span></a>        <span class="c1"># Convert to a single-argument function.</span>
</span><span id="Deck.map-273"><a href="#Deck.map-273"><span class="linenos">273</span></a>        <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">repl</span><span class="p">):</span>
</span><span id="Deck.map-274"><a href="#Deck.map-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="n">star</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Deck.map-275"><a href="#Deck.map-275"><span class="linenos">275</span></a>                <span class="n">star</span> <span class="o">=</span> <span class="n">guess_star</span><span class="p">(</span><span class="n">repl</span><span class="p">)</span>
</span><span id="Deck.map-276"><a href="#Deck.map-276"><span class="linenos">276</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Deck.map-277"><a href="#Deck.map-277"><span class="linenos">277</span></a>
</span><span id="Deck.map-278"><a href="#Deck.map-278"><span class="linenos">278</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck.map-279"><a href="#Deck.map-279"><span class="linenos">279</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck.map-280"><a href="#Deck.map-280"><span class="linenos">280</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.map-281"><a href="#Deck.map-281"><span class="linenos">281</span></a>
</span><span id="Deck.map-282"><a href="#Deck.map-282"><span class="linenos">282</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck.map-283"><a href="#Deck.map-283"><span class="linenos">283</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck.map-284"><a href="#Deck.map-284"><span class="linenos">284</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.map-285"><a href="#Deck.map-285"><span class="linenos">285</span></a>            <span class="c1"># repl is a mapping.</span>
</span><span id="Deck.map-286"><a href="#Deck.map-286"><span class="linenos">286</span></a>            <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck.map-287"><a href="#Deck.map-287"><span class="linenos">287</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">repl</span><span class="p">:</span>
</span><span id="Deck.map-288"><a href="#Deck.map-288"><span class="linenos">288</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Deck.map-289"><a href="#Deck.map-289"><span class="linenos">289</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.map-290"><a href="#Deck.map-290"><span class="linenos">290</span></a>                    <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Deck.map-291"><a href="#Deck.map-291"><span class="linenos">291</span></a>
</span><span id="Deck.map-292"><a href="#Deck.map-292"><span class="linenos">292</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span>
</span><span id="Deck.map-293"><a href="#Deck.map-293"><span class="linenos">293</span></a>            <span class="p">[</span><span class="n">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()],</span>
</span><span id="Deck.map-294"><a href="#Deck.map-294"><span class="linenos">294</span></a>            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Maps outcomes of this <code><a href="#Deck">Deck</a></code> to other outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>repl:</strong>  One of the following:
<ul>
<li>A callable returning a new outcome for each old outcome.</li>
<li>A map from old outcomes to new outcomes.
Unmapped old outcomes stay the same.
The new outcomes may be <code><a href="#Deck">Deck</a></code>s, in which case one card is
replaced with several. This is not recommended.</li>
</ul></li>
<li><strong>star:</strong>  Whether outcomes should be unpacked into separate arguments
before sending them to a callable <code>repl</code>.
If not provided, this will be guessed based on the function
signature.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Population">Population</a></dt>
                                <dd id="Deck.outcomes" class="function"><a href="#Population.outcomes">outcomes</a></dd>
                <dd id="Deck.common_outcome_length" class="function"><a href="#Population.common_outcome_length">common_outcome_length</a></dd>
                <dd id="Deck.is_empty" class="function"><a href="#Population.is_empty">is_empty</a></dd>
                <dd id="Deck.min_outcome" class="function"><a href="#Population.min_outcome">min_outcome</a></dd>
                <dd id="Deck.max_outcome" class="function"><a href="#Population.max_outcome">max_outcome</a></dd>
                <dd id="Deck.nearest" class="function"><a href="#Population.nearest">nearest</a></dd>
                <dd id="Deck.quantity" class="function"><a href="#Population.quantity">quantity</a></dd>
                <dd id="Deck.quantities" class="function"><a href="#Population.quantities">quantities</a></dd>
                <dd id="Deck.denominator" class="function"><a href="#Population.denominator">denominator</a></dd>
                <dd id="Deck.scale_quantities" class="function"><a href="#Population.scale_quantities">scale_quantities</a></dd>
                <dd id="Deck.has_zero_quantities" class="function"><a href="#Population.has_zero_quantities">has_zero_quantities</a></dd>
                <dd id="Deck.probability" class="function"><a href="#Population.probability">probability</a></dd>
                <dd id="Deck.probabilities" class="function"><a href="#Population.probabilities">probabilities</a></dd>
                <dd id="Deck.mode" class="function"><a href="#Population.mode">mode</a></dd>
                <dd id="Deck.modal_quantity" class="function"><a href="#Population.modal_quantity">modal_quantity</a></dd>
                <dd id="Deck.kolmogorov_smirnov" class="function"><a href="#Population.kolmogorov_smirnov">kolmogorov_smirnov</a></dd>
                <dd id="Deck.cramer_von_mises" class="function"><a href="#Population.cramer_von_mises">cramer_von_mises</a></dd>
                <dd id="Deck.median" class="function"><a href="#Population.median">median</a></dd>
                <dd id="Deck.median_low" class="function"><a href="#Population.median_low">median_low</a></dd>
                <dd id="Deck.median_high" class="function"><a href="#Population.median_high">median_high</a></dd>
                <dd id="Deck.quantile" class="function"><a href="#Population.quantile">quantile</a></dd>
                <dd id="Deck.quantile_low" class="function"><a href="#Population.quantile_low">quantile_low</a></dd>
                <dd id="Deck.quantile_high" class="function"><a href="#Population.quantile_high">quantile_high</a></dd>
                <dd id="Deck.mean" class="function"><a href="#Population.mean">mean</a></dd>
                <dd id="Deck.variance" class="function"><a href="#Population.variance">variance</a></dd>
                <dd id="Deck.standard_deviation" class="function"><a href="#Population.standard_deviation">standard_deviation</a></dd>
                <dd id="Deck.sd" class="function"><a href="#Population.sd">sd</a></dd>
                <dd id="Deck.standardized_moment" class="function"><a href="#Population.standardized_moment">standardized_moment</a></dd>
                <dd id="Deck.skewness" class="function"><a href="#Population.skewness">skewness</a></dd>
                <dd id="Deck.excess_kurtosis" class="function"><a href="#Population.excess_kurtosis">excess_kurtosis</a></dd>
                <dd id="Deck.entropy" class="function"><a href="#Population.entropy">entropy</a></dd>
                <dd id="Deck.marginals" class="variable"><a href="#Population.marginals">marginals</a></dd>
                <dd id="Deck.covariance" class="function"><a href="#Population.covariance">covariance</a></dd>
                <dd id="Deck.correlation" class="function"><a href="#Population.correlation">correlation</a></dd>
                <dd id="Deck.to_one_hot" class="function"><a href="#Population.to_one_hot">to_one_hot</a></dd>
                <dd id="Deck.sample" class="function"><a href="#Population.sample">sample</a></dd>
                <dd id="Deck.format" class="function"><a href="#Population.format">format</a></dd>

            </div>
            <div><dt>collections.abc.Mapping</dt>
                                <dd id="Deck.get" class="function">get</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Deal">
                            <input id="Deal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Deal</span><wbr>(<span class="base">icepool.generator.keep.KeepGenerator[~T]</span>):

                <label class="view-source-button" for="Deal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal-15"><a href="#Deal-15"><span class="linenos"> 15</span></a><span class="k">class</span> <span class="nc">Deal</span><span class="p">(</span><span class="n">KeepGenerator</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
</span><span id="Deal-16"><a href="#Deal-16"><span class="linenos"> 16</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an unordered deal of a single hand from a `Deck`.&quot;&quot;&quot;</span>
</span><span id="Deal-17"><a href="#Deal-17"><span class="linenos"> 17</span></a>
</span><span id="Deal-18"><a href="#Deal-18"><span class="linenos"> 18</span></a>    <span class="n">_deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span>
</span><span id="Deal-19"><a href="#Deal-19"><span class="linenos"> 19</span></a>    <span class="n">_hand_size</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Deal-20"><a href="#Deal-20"><span class="linenos"> 20</span></a>
</span><span id="Deal-21"><a href="#Deal-21"><span class="linenos"> 21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">,</span> <span class="n">hand_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Deal-22"><a href="#Deal-22"><span class="linenos"> 22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="Deal-23"><a href="#Deal-23"><span class="linenos"> 23</span></a>
</span><span id="Deal-24"><a href="#Deal-24"><span class="linenos"> 24</span></a><span class="sd">        For algorithmic reasons, you must pre-commit to the number of cards to</span>
</span><span id="Deal-25"><a href="#Deal-25"><span class="linenos"> 25</span></a><span class="sd">        deal.</span>
</span><span id="Deal-26"><a href="#Deal-26"><span class="linenos"> 26</span></a>
</span><span id="Deal-27"><a href="#Deal-27"><span class="linenos"> 27</span></a><span class="sd">        It is permissible to deal zero cards from an empty deck, but not all</span>
</span><span id="Deal-28"><a href="#Deal-28"><span class="linenos"> 28</span></a><span class="sd">        evaluators will handle this case, especially if they depend on the</span>
</span><span id="Deal-29"><a href="#Deal-29"><span class="linenos"> 29</span></a><span class="sd">        outcome type. Dealing zero cards from a non-empty deck does not have</span>
</span><span id="Deal-30"><a href="#Deal-30"><span class="linenos"> 30</span></a><span class="sd">        this issue.</span>
</span><span id="Deal-31"><a href="#Deal-31"><span class="linenos"> 31</span></a>
</span><span id="Deal-32"><a href="#Deal-32"><span class="linenos"> 32</span></a><span class="sd">        Args:</span>
</span><span id="Deal-33"><a href="#Deal-33"><span class="linenos"> 33</span></a><span class="sd">            deck: The `Deck` to deal from.</span>
</span><span id="Deal-34"><a href="#Deal-34"><span class="linenos"> 34</span></a><span class="sd">            hand_size: How many cards to deal.</span>
</span><span id="Deal-35"><a href="#Deal-35"><span class="linenos"> 35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal-36"><a href="#Deal-36"><span class="linenos"> 36</span></a>        <span class="k">if</span> <span class="n">hand_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Deal-37"><a href="#Deal-37"><span class="linenos"> 37</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;hand_size cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Deal-38"><a href="#Deal-38"><span class="linenos"> 38</span></a>        <span class="k">if</span> <span class="n">hand_size</span> <span class="o">&gt;</span> <span class="n">deck</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="Deal-39"><a href="#Deal-39"><span class="linenos"> 39</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Deal-40"><a href="#Deal-40"><span class="linenos"> 40</span></a>                <span class="s1">&#39;The number of cards dealt cannot exceed the size of the deck.&#39;</span>
</span><span id="Deal-41"><a href="#Deal-41"><span class="linenos"> 41</span></a>            <span class="p">)</span>
</span><span id="Deal-42"><a href="#Deal-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="Deal-43"><a href="#Deal-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span> <span class="o">=</span> <span class="n">hand_size</span>
</span><span id="Deal-44"><a href="#Deal-44"><span class="linenos"> 44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">hand_size</span>
</span><span id="Deal-45"><a href="#Deal-45"><span class="linenos"> 45</span></a>
</span><span id="Deal-46"><a href="#Deal-46"><span class="linenos"> 46</span></a>    <span class="nd">@classmethod</span>
</span><span id="Deal-47"><a href="#Deal-47"><span class="linenos"> 47</span></a>    <span class="k">def</span> <span class="nf">_new_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">,</span> <span class="n">hand_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Deal-48"><a href="#Deal-48"><span class="linenos"> 48</span></a>                 <span class="n">keep_tuple</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deal[T]&#39;</span><span class="p">:</span>
</span><span id="Deal-49"><a href="#Deal-49"><span class="linenos"> 49</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Deal</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Deal-50"><a href="#Deal-50"><span class="linenos"> 50</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="Deal-51"><a href="#Deal-51"><span class="linenos"> 51</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span> <span class="o">=</span> <span class="n">hand_size</span>
</span><span id="Deal-52"><a href="#Deal-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_tuple</span> <span class="o">=</span> <span class="n">keep_tuple</span>
</span><span id="Deal-53"><a href="#Deal-53"><span class="linenos"> 53</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Deal-54"><a href="#Deal-54"><span class="linenos"> 54</span></a>
</span><span id="Deal-55"><a href="#Deal-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="nf">_set_keep_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deal[T]&#39;</span><span class="p">:</span>
</span><span id="Deal-56"><a href="#Deal-56"><span class="linenos"> 56</span></a>        <span class="k">return</span> <span class="n">Deal</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_deck</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">,</span> <span class="n">keep_tuple</span><span class="p">)</span>
</span><span id="Deal-57"><a href="#Deal-57"><span class="linenos"> 57</span></a>
</span><span id="Deal-58"><a href="#Deal-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">deck</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">:</span>
</span><span id="Deal-59"><a href="#Deal-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The `Deck` the cards are dealt from.&quot;&quot;&quot;</span>
</span><span id="Deal-60"><a href="#Deal-60"><span class="linenos"> 60</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span>
</span><span id="Deal-61"><a href="#Deal-61"><span class="linenos"> 61</span></a>
</span><span id="Deal-62"><a href="#Deal-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">hand_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Deal-63"><a href="#Deal-63"><span class="linenos"> 63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of cards dealt to each hand as a tuple.&quot;&quot;&quot;</span>
</span><span id="Deal-64"><a href="#Deal-64"><span class="linenos"> 64</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">,</span> <span class="p">)</span>
</span><span id="Deal-65"><a href="#Deal-65"><span class="linenos"> 65</span></a>
</span><span id="Deal-66"><a href="#Deal-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="nf">total_cards_dealt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-67"><a href="#Deal-67"><span class="linenos"> 67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total number of cards dealt.&quot;&quot;&quot;</span>
</span><span id="Deal-68"><a href="#Deal-68"><span class="linenos"> 68</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span>
</span><span id="Deal-69"><a href="#Deal-69"><span class="linenos"> 69</span></a>
</span><span id="Deal-70"><a href="#Deal-70"><span class="linenos"> 70</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="Deal-71"><a href="#Deal-71"><span class="linenos"> 71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes of the `Deck` in ascending order.</span>
</span><span id="Deal-72"><a href="#Deal-72"><span class="linenos"> 72</span></a>
</span><span id="Deal-73"><a href="#Deal-73"><span class="linenos"> 73</span></a><span class="sd">        These are also the `keys` of the `Deck` as a `Mapping`.</span>
</span><span id="Deal-74"><a href="#Deal-74"><span class="linenos"> 74</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Deal-75"><a href="#Deal-75"><span class="linenos"> 75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal-76"><a href="#Deal-76"><span class="linenos"> 76</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Deal-77"><a href="#Deal-77"><span class="linenos"> 77</span></a>
</span><span id="Deal-78"><a href="#Deal-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-79"><a href="#Deal-79"><span class="linenos"> 79</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span><span id="Deal-80"><a href="#Deal-80"><span class="linenos"> 80</span></a>
</span><span id="Deal-81"><a href="#Deal-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Deal-82"><a href="#Deal-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Deal-83"><a href="#Deal-83"><span class="linenos"> 83</span></a>
</span><span id="Deal-84"><a href="#Deal-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-85"><a href="#Deal-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">)</span>
</span><span id="Deal-86"><a href="#Deal-86"><span class="linenos"> 86</span></a>
</span><span id="Deal-87"><a href="#Deal-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">_generate_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InitialMultisetGenerator</span><span class="p">:</span>
</span><span id="Deal-88"><a href="#Deal-88"><span class="linenos"> 88</span></a>        <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span>
</span><span id="Deal-89"><a href="#Deal-89"><span class="linenos"> 89</span></a>
</span><span id="Deal-90"><a href="#Deal-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="Deal-91"><a href="#Deal-91"><span class="linenos"> 91</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">min_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">():</span>
</span><span id="Deal-92"><a href="#Deal-92"><span class="linenos"> 92</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="Deal-93"><a href="#Deal-93"><span class="linenos"> 93</span></a>            <span class="k">return</span>
</span><span id="Deal-94"><a href="#Deal-94"><span class="linenos"> 94</span></a>
</span><span id="Deal-95"><a href="#Deal-95"><span class="linenos"> 95</span></a>        <span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">_pop_min</span><span class="p">()</span>
</span><span id="Deal-96"><a href="#Deal-96"><span class="linenos"> 96</span></a>
</span><span id="Deal-97"><a href="#Deal-97"><span class="linenos"> 97</span></a>        <span class="n">min_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Deal-98"><a href="#Deal-98"><span class="linenos"> 98</span></a>        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">)</span>
</span><span id="Deal-99"><a href="#Deal-99"><span class="linenos"> 99</span></a>        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_count</span><span class="p">,</span> <span class="n">max_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Deal-100"><a href="#Deal-100"><span class="linenos">100</span></a>            <span class="n">popped_keep_tuple</span><span class="p">,</span> <span class="n">result_count</span> <span class="o">=</span> <span class="n">pop_min_from_keep_tuple</span><span class="p">(</span>
</span><span id="Deal-101"><a href="#Deal-101"><span class="linenos">101</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">(),</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Deal-102"><a href="#Deal-102"><span class="linenos">102</span></a>            <span class="n">popped_deal</span> <span class="o">=</span> <span class="n">Deal</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">popped_deck</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span> <span class="o">-</span> <span class="n">count</span><span class="p">,</span>
</span><span id="Deal-103"><a href="#Deal-103"><span class="linenos">103</span></a>                                        <span class="n">popped_keep_tuple</span><span class="p">)</span>
</span><span id="Deal-104"><a href="#Deal-104"><span class="linenos">104</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Deal-105"><a href="#Deal-105"><span class="linenos">105</span></a>            <span class="k">yield</span> <span class="n">popped_deal</span><span class="p">,</span> <span class="p">(</span><span class="n">result_count</span><span class="p">,</span> <span class="p">),</span> <span class="n">weight</span>
</span><span id="Deal-106"><a href="#Deal-106"><span class="linenos">106</span></a>
</span><span id="Deal-107"><a href="#Deal-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="Deal-108"><a href="#Deal-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">max_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">():</span>
</span><span id="Deal-109"><a href="#Deal-109"><span class="linenos">109</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="Deal-110"><a href="#Deal-110"><span class="linenos">110</span></a>            <span class="k">return</span>
</span><span id="Deal-111"><a href="#Deal-111"><span class="linenos">111</span></a>
</span><span id="Deal-112"><a href="#Deal-112"><span class="linenos">112</span></a>        <span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">_pop_max</span><span class="p">()</span>
</span><span id="Deal-113"><a href="#Deal-113"><span class="linenos">113</span></a>
</span><span id="Deal-114"><a href="#Deal-114"><span class="linenos">114</span></a>        <span class="n">min_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Deal-115"><a href="#Deal-115"><span class="linenos">115</span></a>        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">)</span>
</span><span id="Deal-116"><a href="#Deal-116"><span class="linenos">116</span></a>        <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_count</span><span class="p">,</span> <span class="n">max_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Deal-117"><a href="#Deal-117"><span class="linenos">117</span></a>            <span class="n">popped_keep_tuple</span><span class="p">,</span> <span class="n">result_count</span> <span class="o">=</span> <span class="n">pop_max_from_keep_tuple</span><span class="p">(</span>
</span><span id="Deal-118"><a href="#Deal-118"><span class="linenos">118</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">keep_tuple</span><span class="p">(),</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Deal-119"><a href="#Deal-119"><span class="linenos">119</span></a>            <span class="n">popped_deal</span> <span class="o">=</span> <span class="n">Deal</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span><span class="n">popped_deck</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span> <span class="o">-</span> <span class="n">count</span><span class="p">,</span>
</span><span id="Deal-120"><a href="#Deal-120"><span class="linenos">120</span></a>                                        <span class="n">popped_keep_tuple</span><span class="p">)</span>
</span><span id="Deal-121"><a href="#Deal-121"><span class="linenos">121</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="Deal-122"><a href="#Deal-122"><span class="linenos">122</span></a>            <span class="k">yield</span> <span class="n">popped_deal</span><span class="p">,</span> <span class="p">(</span><span class="n">result_count</span><span class="p">,</span> <span class="p">),</span> <span class="n">weight</span>
</span><span id="Deal-123"><a href="#Deal-123"><span class="linenos">123</span></a>
</span><span id="Deal-124"><a href="#Deal-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deal-125"><a href="#Deal-125"><span class="linenos">125</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span>
</span><span id="Deal-126"><a href="#Deal-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">result</span>
</span><span id="Deal-127"><a href="#Deal-127"><span class="linenos">127</span></a>
</span><span id="Deal-128"><a href="#Deal-128"><span class="linenos">128</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deal-129"><a href="#Deal-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">_hash_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="Deal-130"><a href="#Deal-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="n">Deal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_tuple</span>
</span><span id="Deal-131"><a href="#Deal-131"><span class="linenos">131</span></a>
</span><span id="Deal-132"><a href="#Deal-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Deal-133"><a href="#Deal-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span>
</span><span id="Deal-134"><a href="#Deal-134"><span class="linenos">134</span></a>            <span class="bp">self</span>
</span><span id="Deal-135"><a href="#Deal-135"><span class="linenos">135</span></a>        <span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">())</span><span class="si">}</span><span class="s1">, hand_size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="Deal-136"><a href="#Deal-136"><span class="linenos">136</span></a>
</span><span id="Deal-137"><a href="#Deal-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Deal-138"><a href="#Deal-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span>
</span><span id="Deal-139"><a href="#Deal-139"><span class="linenos">139</span></a>            <span class="bp">self</span>
</span><span id="Deal-140"><a href="#Deal-140"><span class="linenos">140</span></a>        <span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; of hand_size=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="si">}</span><span class="s1"> from deck:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Deal-141"><a href="#Deal-141"><span class="linenos">141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Represents an unordered deal of a single hand from a <code><a href="#Deck">Deck</a></code>.</p>
</div>


                            <div id="Deal.__init__" class="classattr">
                                        <input id="Deal.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Deal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">deck</span><span class="p">:</span> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>, </span><span class="param"><span class="n">hand_size</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="Deal.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.__init__-21"><a href="#Deal.__init__-21"><span class="linenos">21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">,</span> <span class="n">hand_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Deal.__init__-22"><a href="#Deal.__init__-22"><span class="linenos">22</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="Deal.__init__-23"><a href="#Deal.__init__-23"><span class="linenos">23</span></a>
</span><span id="Deal.__init__-24"><a href="#Deal.__init__-24"><span class="linenos">24</span></a><span class="sd">        For algorithmic reasons, you must pre-commit to the number of cards to</span>
</span><span id="Deal.__init__-25"><a href="#Deal.__init__-25"><span class="linenos">25</span></a><span class="sd">        deal.</span>
</span><span id="Deal.__init__-26"><a href="#Deal.__init__-26"><span class="linenos">26</span></a>
</span><span id="Deal.__init__-27"><a href="#Deal.__init__-27"><span class="linenos">27</span></a><span class="sd">        It is permissible to deal zero cards from an empty deck, but not all</span>
</span><span id="Deal.__init__-28"><a href="#Deal.__init__-28"><span class="linenos">28</span></a><span class="sd">        evaluators will handle this case, especially if they depend on the</span>
</span><span id="Deal.__init__-29"><a href="#Deal.__init__-29"><span class="linenos">29</span></a><span class="sd">        outcome type. Dealing zero cards from a non-empty deck does not have</span>
</span><span id="Deal.__init__-30"><a href="#Deal.__init__-30"><span class="linenos">30</span></a><span class="sd">        this issue.</span>
</span><span id="Deal.__init__-31"><a href="#Deal.__init__-31"><span class="linenos">31</span></a>
</span><span id="Deal.__init__-32"><a href="#Deal.__init__-32"><span class="linenos">32</span></a><span class="sd">        Args:</span>
</span><span id="Deal.__init__-33"><a href="#Deal.__init__-33"><span class="linenos">33</span></a><span class="sd">            deck: The `Deck` to deal from.</span>
</span><span id="Deal.__init__-34"><a href="#Deal.__init__-34"><span class="linenos">34</span></a><span class="sd">            hand_size: How many cards to deal.</span>
</span><span id="Deal.__init__-35"><a href="#Deal.__init__-35"><span class="linenos">35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal.__init__-36"><a href="#Deal.__init__-36"><span class="linenos">36</span></a>        <span class="k">if</span> <span class="n">hand_size</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Deal.__init__-37"><a href="#Deal.__init__-37"><span class="linenos">37</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;hand_size cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Deal.__init__-38"><a href="#Deal.__init__-38"><span class="linenos">38</span></a>        <span class="k">if</span> <span class="n">hand_size</span> <span class="o">&gt;</span> <span class="n">deck</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="Deal.__init__-39"><a href="#Deal.__init__-39"><span class="linenos">39</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Deal.__init__-40"><a href="#Deal.__init__-40"><span class="linenos">40</span></a>                <span class="s1">&#39;The number of cards dealt cannot exceed the size of the deck.&#39;</span>
</span><span id="Deal.__init__-41"><a href="#Deal.__init__-41"><span class="linenos">41</span></a>            <span class="p">)</span>
</span><span id="Deal.__init__-42"><a href="#Deal.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="Deal.__init__-43"><a href="#Deal.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span> <span class="o">=</span> <span class="n">hand_size</span>
</span><span id="Deal.__init__-44"><a href="#Deal.__init__-44"><span class="linenos">44</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_keep_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="n">hand_size</span>
</span></pre></div>


            <div class="docstring"><p>Constructor.</p>

<p>For algorithmic reasons, you must pre-commit to the number of cards to
deal.</p>

<p>It is permissible to deal zero cards from an empty deck, but not all
evaluators will handle this case, especially if they depend on the
outcome type. Dealing zero cards from a non-empty deck does not have
this issue.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>deck:</strong>  The <code><a href="#Deck">Deck</a></code> to deal from.</li>
<li><strong>hand_size:</strong>  How many cards to deal.</li>
</ul>
</div>


                            </div>
                            <div id="Deal.deck" class="classattr">
                                        <input id="Deal.deck-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deck</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deal.deck-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.deck"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.deck-58"><a href="#Deal.deck-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">deck</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">:</span>
</span><span id="Deal.deck-59"><a href="#Deal.deck-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The `Deck` the cards are dealt from.&quot;&quot;&quot;</span>
</span><span id="Deal.deck-60"><a href="#Deal.deck-60"><span class="linenos">60</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#Deck">Deck</a></code> the cards are dealt from.</p>
</div>


                            </div>
                            <div id="Deal.hand_sizes" class="classattr">
                                        <input id="Deal.hand_sizes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hand_sizes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deal.hand_sizes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.hand_sizes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.hand_sizes-62"><a href="#Deal.hand_sizes-62"><span class="linenos">62</span></a>    <span class="k">def</span> <span class="nf">hand_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Deal.hand_sizes-63"><a href="#Deal.hand_sizes-63"><span class="linenos">63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of cards dealt to each hand as a tuple.&quot;&quot;&quot;</span>
</span><span id="Deal.hand_sizes-64"><a href="#Deal.hand_sizes-64"><span class="linenos">64</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">,</span> <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The number of cards dealt to each hand as a tuple.</p>
</div>


                            </div>
                            <div id="Deal.total_cards_dealt" class="classattr">
                                        <input id="Deal.total_cards_dealt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">total_cards_dealt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deal.total_cards_dealt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.total_cards_dealt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.total_cards_dealt-66"><a href="#Deal.total_cards_dealt-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">total_cards_dealt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal.total_cards_dealt-67"><a href="#Deal.total_cards_dealt-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total number of cards dealt.&quot;&quot;&quot;</span>
</span><span id="Deal.total_cards_dealt-68"><a href="#Deal.total_cards_dealt-68"><span class="linenos">68</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span>
</span></pre></div>


            <div class="docstring"><p>The total number of cards dealt.</p>
</div>


                            </div>
                            <div id="Deal.outcomes" class="classattr">
                                        <input id="Deal.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">CountsKeysView</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deal.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.outcomes-70"><a href="#Deal.outcomes-70"><span class="linenos">70</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="Deal.outcomes-71"><a href="#Deal.outcomes-71"><span class="linenos">71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes of the `Deck` in ascending order.</span>
</span><span id="Deal.outcomes-72"><a href="#Deal.outcomes-72"><span class="linenos">72</span></a>
</span><span id="Deal.outcomes-73"><a href="#Deal.outcomes-73"><span class="linenos">73</span></a><span class="sd">        These are also the `keys` of the `Deck` as a `Mapping`.</span>
</span><span id="Deal.outcomes-74"><a href="#Deal.outcomes-74"><span class="linenos">74</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Deal.outcomes-75"><a href="#Deal.outcomes-75"><span class="linenos">75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal.outcomes-76"><a href="#Deal.outcomes-76"><span class="linenos">76</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes of the <code><a href="#Deck">Deck</a></code> in ascending order.</p>

<p>These are also the <code>keys</code> of the <code><a href="#Deck">Deck</a></code> as a <code>Mapping</code>.
Prefer to use the name <code><a href="#Deal.outcomes">outcomes</a></code>.</p>
</div>


                            </div>
                            <div id="Deal.output_arity" class="classattr">
                                        <input id="Deal.output_arity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">output_arity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deal.output_arity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.output_arity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.output_arity-78"><a href="#Deal.output_arity-78"><span class="linenos">78</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal.output_arity-79"><a href="#Deal.output_arity-79"><span class="linenos">79</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>The number of multisets/counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="Deal.denominator" class="classattr">
                                        <input id="Deal.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deal.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.denominator-84"><a href="#Deal.denominator-84"><span class="linenos">84</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal.denominator-85"><a href="#Deal.denominator-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_size</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>icepool.generator.keep.KeepGenerator</dt>
                                <dd id="Deal.keep_size" class="function">keep_size</dd>
                <dd id="Deal.keep_tuple" class="function">keep_tuple</dd>
                <dd id="Deal.has_negative_keeps" class="function">has_negative_keeps</dd>
                <dd id="Deal.keep" class="function">keep</dd>
                <dd id="Deal.middle" class="function">middle</dd>
                <dd id="Deal.additive_union" class="function">additive_union</dd>
                <dd id="Deal.multiply_counts" class="function">multiply_counts</dd>

            </div>
            <div><dt><a href="#MultisetGenerator">MultisetGenerator</a></dt>
                                <dd id="Deal.equals" class="function"><a href="#MultisetGenerator.equals">equals</a></dd>
                <dd id="Deal.order" class="function"><a href="#MultisetGenerator.order">order</a></dd>
                <dd id="Deal.min_outcome" class="function"><a href="#MultisetGenerator.min_outcome">min_outcome</a></dd>
                <dd id="Deal.max_outcome" class="function"><a href="#MultisetGenerator.max_outcome">max_outcome</a></dd>
                <dd id="Deal.sample" class="function"><a href="#MultisetGenerator.sample">sample</a></dd>

            </div>
            <div><dt><a href="#MultisetExpression">MultisetExpression</a></dt>
                                <dd id="Deal.difference" class="function"><a href="#MultisetExpression.difference">difference</a></dd>
                <dd id="Deal.intersection" class="function"><a href="#MultisetExpression.intersection">intersection</a></dd>
                <dd id="Deal.union" class="function"><a href="#MultisetExpression.union">union</a></dd>
                <dd id="Deal.symmetric_difference" class="function"><a href="#MultisetExpression.symmetric_difference">symmetric_difference</a></dd>
                <dd id="Deal.keep_outcomes" class="function"><a href="#MultisetExpression.keep_outcomes">keep_outcomes</a></dd>
                <dd id="Deal.drop_outcomes" class="function"><a href="#MultisetExpression.drop_outcomes">drop_outcomes</a></dd>
                <dd id="Deal.map_counts" class="function"><a href="#MultisetExpression.map_counts">map_counts</a></dd>
                <dd id="Deal.divide_counts" class="function"><a href="#MultisetExpression.divide_counts">divide_counts</a></dd>
                <dd id="Deal.modulo_counts" class="function"><a href="#MultisetExpression.modulo_counts">modulo_counts</a></dd>
                <dd id="Deal.keep_counts" class="function"><a href="#MultisetExpression.keep_counts">keep_counts</a></dd>
                <dd id="Deal.unique" class="function"><a href="#MultisetExpression.unique">unique</a></dd>
                <dd id="Deal.lowest" class="function"><a href="#MultisetExpression.lowest">lowest</a></dd>
                <dd id="Deal.highest" class="function"><a href="#MultisetExpression.highest">highest</a></dd>
                <dd id="Deal.pair_le" class="function"><a href="#MultisetExpression.pair_le">pair_le</a></dd>
                <dd id="Deal.evaluate" class="function"><a href="#MultisetExpression.evaluate">evaluate</a></dd>
                <dd id="Deal.expand" class="function"><a href="#MultisetExpression.expand">expand</a></dd>
                <dd id="Deal.sum" class="function"><a href="#MultisetExpression.sum">sum</a></dd>
                <dd id="Deal.count" class="function"><a href="#MultisetExpression.count">count</a></dd>
                <dd id="Deal.any" class="function"><a href="#MultisetExpression.any">any</a></dd>
                <dd id="Deal.highest_outcome_and_count" class="function"><a href="#MultisetExpression.highest_outcome_and_count">highest_outcome_and_count</a></dd>
                <dd id="Deal.all_counts" class="function"><a href="#MultisetExpression.all_counts">all_counts</a></dd>
                <dd id="Deal.largest_count" class="function"><a href="#MultisetExpression.largest_count">largest_count</a></dd>
                <dd id="Deal.largest_count_and_outcome" class="function"><a href="#MultisetExpression.largest_count_and_outcome">largest_count_and_outcome</a></dd>
                <dd id="Deal.count_subset" class="function"><a href="#MultisetExpression.count_subset">count_subset</a></dd>
                <dd id="Deal.largest_straight" class="function"><a href="#MultisetExpression.largest_straight">largest_straight</a></dd>
                <dd id="Deal.largest_straight_and_outcome" class="function"><a href="#MultisetExpression.largest_straight_and_outcome">largest_straight_and_outcome</a></dd>
                <dd id="Deal.all_straights" class="function"><a href="#MultisetExpression.all_straights">all_straights</a></dd>
                <dd id="Deal.all_straights_reduce_counts" class="function"><a href="#MultisetExpression.all_straights_reduce_counts">all_straights_reduce_counts</a></dd>
                <dd id="Deal.argsort" class="function"><a href="#MultisetExpression.argsort">argsort</a></dd>
                <dd id="Deal.issubset" class="function"><a href="#MultisetExpression.issubset">issubset</a></dd>
                <dd id="Deal.issuperset" class="function"><a href="#MultisetExpression.issuperset">issuperset</a></dd>
                <dd id="Deal.isdisjoint" class="function"><a href="#MultisetExpression.isdisjoint">isdisjoint</a></dd>
                <dd id="Deal.compair_lt" class="function"><a href="#MultisetExpression.compair_lt">compair_lt</a></dd>
                <dd id="Deal.compair_le" class="function"><a href="#MultisetExpression.compair_le">compair_le</a></dd>
                <dd id="Deal.compair_gt" class="function"><a href="#MultisetExpression.compair_gt">compair_gt</a></dd>
                <dd id="Deal.compair_ge" class="function"><a href="#MultisetExpression.compair_ge">compair_ge</a></dd>
                <dd id="Deal.compair_eq" class="function"><a href="#MultisetExpression.compair_eq">compair_eq</a></dd>
                <dd id="Deal.compair_ne" class="function"><a href="#MultisetExpression.compair_ne">compair_ne</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MultiDeal">
                            <input id="MultiDeal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MultiDeal</span><wbr>(<span class="base"><a href="#MultisetGenerator">icepool.MultisetGenerator[~T, ~Qs]</a></span>):

                <label class="view-source-button" for="MultiDeal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal-16"><a href="#MultiDeal-16"><span class="linenos"> 16</span></a><span class="k">class</span> <span class="nc">MultiDeal</span><span class="p">(</span><span class="n">MultisetGenerator</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Qs</span><span class="p">]):</span>
</span><span id="MultiDeal-17"><a href="#MultiDeal-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents an unordered deal of multiple hands from a `Deck`.&quot;&quot;&quot;</span>
</span><span id="MultiDeal-18"><a href="#MultiDeal-18"><span class="linenos"> 18</span></a>
</span><span id="MultiDeal-19"><a href="#MultiDeal-19"><span class="linenos"> 19</span></a>    <span class="n">_deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span>
</span><span id="MultiDeal-20"><a href="#MultiDeal-20"><span class="linenos"> 20</span></a>    <span class="n">_hand_sizes</span><span class="p">:</span> <span class="n">Qs</span>
</span><span id="MultiDeal-21"><a href="#MultiDeal-21"><span class="linenos"> 21</span></a>
</span><span id="MultiDeal-22"><a href="#MultiDeal-22"><span class="linenos"> 22</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultiDeal-23"><a href="#MultiDeal-23"><span class="linenos"> 23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="MultiDeal-24"><a href="#MultiDeal-24"><span class="linenos"> 24</span></a>
</span><span id="MultiDeal-25"><a href="#MultiDeal-25"><span class="linenos"> 25</span></a><span class="sd">        For algorithmic reasons, you must pre-commit to the number of cards to</span>
</span><span id="MultiDeal-26"><a href="#MultiDeal-26"><span class="linenos"> 26</span></a><span class="sd">        deal for each hand.</span>
</span><span id="MultiDeal-27"><a href="#MultiDeal-27"><span class="linenos"> 27</span></a>
</span><span id="MultiDeal-28"><a href="#MultiDeal-28"><span class="linenos"> 28</span></a><span class="sd">        It is permissible to deal zero cards from an empty deck, but not all</span>
</span><span id="MultiDeal-29"><a href="#MultiDeal-29"><span class="linenos"> 29</span></a><span class="sd">        evaluators will handle this case, especially if they depend on the</span>
</span><span id="MultiDeal-30"><a href="#MultiDeal-30"><span class="linenos"> 30</span></a><span class="sd">        outcome type. Dealing zero cards from a non-empty deck does not have</span>
</span><span id="MultiDeal-31"><a href="#MultiDeal-31"><span class="linenos"> 31</span></a><span class="sd">        this issue.</span>
</span><span id="MultiDeal-32"><a href="#MultiDeal-32"><span class="linenos"> 32</span></a>
</span><span id="MultiDeal-33"><a href="#MultiDeal-33"><span class="linenos"> 33</span></a><span class="sd">        Args:</span>
</span><span id="MultiDeal-34"><a href="#MultiDeal-34"><span class="linenos"> 34</span></a><span class="sd">            deck: The `Deck` to deal from.</span>
</span><span id="MultiDeal-35"><a href="#MultiDeal-35"><span class="linenos"> 35</span></a><span class="sd">            *hand_sizes: How many cards to deal. If multiple `hand_sizes` are</span>
</span><span id="MultiDeal-36"><a href="#MultiDeal-36"><span class="linenos"> 36</span></a><span class="sd">                provided, `MultisetEvaluator.next_state` will recieve one count</span>
</span><span id="MultiDeal-37"><a href="#MultiDeal-37"><span class="linenos"> 37</span></a><span class="sd">                per hand in order. Try to keep the number of hands to a minimum</span>
</span><span id="MultiDeal-38"><a href="#MultiDeal-38"><span class="linenos"> 38</span></a><span class="sd">                as this can be computationally intensive.</span>
</span><span id="MultiDeal-39"><a href="#MultiDeal-39"><span class="linenos"> 39</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultiDeal-40"><a href="#MultiDeal-40"><span class="linenos"> 40</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">hand</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">hand_sizes</span><span class="p">):</span>
</span><span id="MultiDeal-41"><a href="#MultiDeal-41"><span class="linenos"> 41</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;hand_sizes cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="MultiDeal-42"><a href="#MultiDeal-42"><span class="linenos"> 42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="MultiDeal-43"><a href="#MultiDeal-43"><span class="linenos"> 43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="n">hand_sizes</span><span class="p">)</span>
</span><span id="MultiDeal-44"><a href="#MultiDeal-44"><span class="linenos"> 44</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="MultiDeal-45"><a href="#MultiDeal-45"><span class="linenos"> 45</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MultiDeal-46"><a href="#MultiDeal-46"><span class="linenos"> 46</span></a>                <span class="s1">&#39;The total number of cards dealt cannot exceed the size of the deck.&#39;</span>
</span><span id="MultiDeal-47"><a href="#MultiDeal-47"><span class="linenos"> 47</span></a>            <span class="p">)</span>
</span><span id="MultiDeal-48"><a href="#MultiDeal-48"><span class="linenos"> 48</span></a>
</span><span id="MultiDeal-49"><a href="#MultiDeal-49"><span class="linenos"> 49</span></a>    <span class="nd">@classmethod</span>
</span><span id="MultiDeal-50"><a href="#MultiDeal-50"><span class="linenos"> 50</span></a>    <span class="k">def</span> <span class="nf">_new_raw</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">,</span>
</span><span id="MultiDeal-51"><a href="#MultiDeal-51"><span class="linenos"> 51</span></a>                 <span class="n">hand_sizes</span><span class="p">:</span> <span class="n">Qs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;MultiDeal[T, Qs]&#39;</span><span class="p">:</span>
</span><span id="MultiDeal-52"><a href="#MultiDeal-52"><span class="linenos"> 52</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">MultiDeal</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="MultiDeal-53"><a href="#MultiDeal-53"><span class="linenos"> 53</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="MultiDeal-54"><a href="#MultiDeal-54"><span class="linenos"> 54</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span> <span class="o">=</span> <span class="n">hand_sizes</span>
</span><span id="MultiDeal-55"><a href="#MultiDeal-55"><span class="linenos"> 55</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="MultiDeal-56"><a href="#MultiDeal-56"><span class="linenos"> 56</span></a>
</span><span id="MultiDeal-57"><a href="#MultiDeal-57"><span class="linenos"> 57</span></a>    <span class="k">def</span> <span class="nf">deck</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">:</span>
</span><span id="MultiDeal-58"><a href="#MultiDeal-58"><span class="linenos"> 58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The `Deck` the cards are dealt from.&quot;&quot;&quot;</span>
</span><span id="MultiDeal-59"><a href="#MultiDeal-59"><span class="linenos"> 59</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span>
</span><span id="MultiDeal-60"><a href="#MultiDeal-60"><span class="linenos"> 60</span></a>
</span><span id="MultiDeal-61"><a href="#MultiDeal-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="nf">hand_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Qs</span><span class="p">:</span>
</span><span id="MultiDeal-62"><a href="#MultiDeal-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of cards dealt to each hand as a tuple.&quot;&quot;&quot;</span>
</span><span id="MultiDeal-63"><a href="#MultiDeal-63"><span class="linenos"> 63</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span>
</span><span id="MultiDeal-64"><a href="#MultiDeal-64"><span class="linenos"> 64</span></a>
</span><span id="MultiDeal-65"><a href="#MultiDeal-65"><span class="linenos"> 65</span></a>    <span class="k">def</span> <span class="nf">total_cards_dealt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultiDeal-66"><a href="#MultiDeal-66"><span class="linenos"> 66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total number of cards dealt.&quot;&quot;&quot;</span>
</span><span id="MultiDeal-67"><a href="#MultiDeal-67"><span class="linenos"> 67</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">())</span>
</span><span id="MultiDeal-68"><a href="#MultiDeal-68"><span class="linenos"> 68</span></a>
</span><span id="MultiDeal-69"><a href="#MultiDeal-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="MultiDeal-70"><a href="#MultiDeal-70"><span class="linenos"> 70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes of the `Deck` in ascending order.</span>
</span><span id="MultiDeal-71"><a href="#MultiDeal-71"><span class="linenos"> 71</span></a>
</span><span id="MultiDeal-72"><a href="#MultiDeal-72"><span class="linenos"> 72</span></a><span class="sd">        These are also the `keys` of the `Deck` as a `Mapping`.</span>
</span><span id="MultiDeal-73"><a href="#MultiDeal-73"><span class="linenos"> 73</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="MultiDeal-74"><a href="#MultiDeal-74"><span class="linenos"> 74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultiDeal-75"><a href="#MultiDeal-75"><span class="linenos"> 75</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="MultiDeal-76"><a href="#MultiDeal-76"><span class="linenos"> 76</span></a>
</span><span id="MultiDeal-77"><a href="#MultiDeal-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultiDeal-78"><a href="#MultiDeal-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span><span class="p">)</span>
</span><span id="MultiDeal-79"><a href="#MultiDeal-79"><span class="linenos"> 79</span></a>
</span><span id="MultiDeal-80"><a href="#MultiDeal-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MultiDeal-81"><a href="#MultiDeal-81"><span class="linenos"> 81</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="MultiDeal-82"><a href="#MultiDeal-82"><span class="linenos"> 82</span></a>
</span><span id="MultiDeal-83"><a href="#MultiDeal-83"><span class="linenos"> 83</span></a>    <span class="nd">@cached_property</span>
</span><span id="MultiDeal-84"><a href="#MultiDeal-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="nf">_denomiator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultiDeal-85"><a href="#MultiDeal-85"><span class="linenos"> 85</span></a>        <span class="n">d_total</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
</span><span id="MultiDeal-86"><a href="#MultiDeal-86"><span class="linenos"> 86</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">())</span>
</span><span id="MultiDeal-87"><a href="#MultiDeal-87"><span class="linenos"> 87</span></a>        <span class="n">d_split</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span>
</span><span id="MultiDeal-88"><a href="#MultiDeal-88"><span class="linenos"> 88</span></a>            <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">(),</span> <span class="n">h</span><span class="p">)</span>
</span><span id="MultiDeal-89"><a href="#MultiDeal-89"><span class="linenos"> 89</span></a>            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="MultiDeal-90"><a href="#MultiDeal-90"><span class="linenos"> 90</span></a>        <span class="k">return</span> <span class="n">d_total</span> <span class="o">*</span> <span class="n">d_split</span>
</span><span id="MultiDeal-91"><a href="#MultiDeal-91"><span class="linenos"> 91</span></a>
</span><span id="MultiDeal-92"><a href="#MultiDeal-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultiDeal-93"><a href="#MultiDeal-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denomiator</span>
</span><span id="MultiDeal-94"><a href="#MultiDeal-94"><span class="linenos"> 94</span></a>
</span><span id="MultiDeal-95"><a href="#MultiDeal-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">_generate_initial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">InitialMultisetGenerator</span><span class="p">:</span>
</span><span id="MultiDeal-96"><a href="#MultiDeal-96"><span class="linenos"> 96</span></a>        <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="mi">1</span>
</span><span id="MultiDeal-97"><a href="#MultiDeal-97"><span class="linenos"> 97</span></a>
</span><span id="MultiDeal-98"><a href="#MultiDeal-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">_generate_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">popped_deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">,</span>
</span><span id="MultiDeal-99"><a href="#MultiDeal-99"><span class="linenos"> 99</span></a>                         <span class="n">deck_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="MultiDeal-100"><a href="#MultiDeal-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Common implementation for _generate_min and _generate_max.&quot;&quot;&quot;</span>
</span><span id="MultiDeal-101"><a href="#MultiDeal-101"><span class="linenos">101</span></a>        <span class="n">min_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="MultiDeal-102"><a href="#MultiDeal-102"><span class="linenos">102</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="MultiDeal-103"><a href="#MultiDeal-103"><span class="linenos">103</span></a>        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">())</span>
</span><span id="MultiDeal-104"><a href="#MultiDeal-104"><span class="linenos">104</span></a>        <span class="k">for</span> <span class="n">count_total</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_count</span><span class="p">,</span> <span class="n">max_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MultiDeal-105"><a href="#MultiDeal-105"><span class="linenos">105</span></a>            <span class="n">weight_total</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="n">count_total</span><span class="p">)</span>
</span><span id="MultiDeal-106"><a href="#MultiDeal-106"><span class="linenos">106</span></a>            <span class="c1"># The &quot;deck&quot; is the hand sizes.</span>
</span><span id="MultiDeal-107"><a href="#MultiDeal-107"><span class="linenos">107</span></a>            <span class="k">for</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weight_split</span> <span class="ow">in</span> <span class="n">iter_hypergeom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">(),</span>
</span><span id="MultiDeal-108"><a href="#MultiDeal-108"><span class="linenos">108</span></a>                                                       <span class="n">count_total</span><span class="p">):</span>
</span><span id="MultiDeal-109"><a href="#MultiDeal-109"><span class="linenos">109</span></a>                <span class="n">popped_deal</span> <span class="o">=</span> <span class="n">MultiDeal</span><span class="o">.</span><span class="n">_new_raw</span><span class="p">(</span>
</span><span id="MultiDeal-110"><a href="#MultiDeal-110"><span class="linenos">110</span></a>                    <span class="n">popped_deck</span><span class="p">,</span>
</span><span id="MultiDeal-111"><a href="#MultiDeal-111"><span class="linenos">111</span></a>                    <span class="nb">tuple</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">c</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">(),</span> <span class="n">counts</span><span class="p">)))</span>
</span><span id="MultiDeal-112"><a href="#MultiDeal-112"><span class="linenos">112</span></a>                <span class="n">weight</span> <span class="o">=</span> <span class="n">weight_total</span> <span class="o">*</span> <span class="n">weight_split</span>
</span><span id="MultiDeal-113"><a href="#MultiDeal-113"><span class="linenos">113</span></a>                <span class="k">yield</span> <span class="n">popped_deal</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="MultiDeal-114"><a href="#MultiDeal-114"><span class="linenos">114</span></a>
</span><span id="MultiDeal-115"><a href="#MultiDeal-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="MultiDeal-116"><a href="#MultiDeal-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">min_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">():</span>
</span><span id="MultiDeal-117"><a href="#MultiDeal-117"><span class="linenos">117</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="MultiDeal-118"><a href="#MultiDeal-118"><span class="linenos">118</span></a>            <span class="k">return</span>
</span><span id="MultiDeal-119"><a href="#MultiDeal-119"><span class="linenos">119</span></a>
</span><span id="MultiDeal-120"><a href="#MultiDeal-120"><span class="linenos">120</span></a>        <span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">_pop_min</span><span class="p">()</span>
</span><span id="MultiDeal-121"><a href="#MultiDeal-121"><span class="linenos">121</span></a>
</span><span id="MultiDeal-122"><a href="#MultiDeal-122"><span class="linenos">122</span></a>        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_common</span><span class="p">(</span><span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span><span class="p">)</span>
</span><span id="MultiDeal-123"><a href="#MultiDeal-123"><span class="linenos">123</span></a>
</span><span id="MultiDeal-124"><a href="#MultiDeal-124"><span class="linenos">124</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextMultisetGenerator</span><span class="p">:</span>
</span><span id="MultiDeal-125"><a href="#MultiDeal-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">max_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">():</span>
</span><span id="MultiDeal-126"><a href="#MultiDeal-126"><span class="linenos">126</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="mi">1</span>
</span><span id="MultiDeal-127"><a href="#MultiDeal-127"><span class="linenos">127</span></a>            <span class="k">return</span>
</span><span id="MultiDeal-128"><a href="#MultiDeal-128"><span class="linenos">128</span></a>
</span><span id="MultiDeal-129"><a href="#MultiDeal-129"><span class="linenos">129</span></a>        <span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">_pop_max</span><span class="p">()</span>
</span><span id="MultiDeal-130"><a href="#MultiDeal-130"><span class="linenos">130</span></a>
</span><span id="MultiDeal-131"><a href="#MultiDeal-131"><span class="linenos">131</span></a>        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_common</span><span class="p">(</span><span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span><span class="p">)</span>
</span><span id="MultiDeal-132"><a href="#MultiDeal-132"><span class="linenos">132</span></a>
</span><span id="MultiDeal-133"><a href="#MultiDeal-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="MultiDeal-134"><a href="#MultiDeal-134"><span class="linenos">134</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">())</span>
</span><span id="MultiDeal-135"><a href="#MultiDeal-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">result</span>
</span><span id="MultiDeal-136"><a href="#MultiDeal-136"><span class="linenos">136</span></a>
</span><span id="MultiDeal-137"><a href="#MultiDeal-137"><span class="linenos">137</span></a>    <span class="nd">@cached_property</span>
</span><span id="MultiDeal-138"><a href="#MultiDeal-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">_hash_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="MultiDeal-139"><a href="#MultiDeal-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="n">MultiDeal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()</span>
</span><span id="MultiDeal-140"><a href="#MultiDeal-140"><span class="linenos">140</span></a>
</span><span id="MultiDeal-141"><a href="#MultiDeal-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MultiDeal-142"><a href="#MultiDeal-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span>
</span><span id="MultiDeal-143"><a href="#MultiDeal-143"><span class="linenos">143</span></a>            <span class="bp">self</span>
</span><span id="MultiDeal-144"><a href="#MultiDeal-144"><span class="linenos">144</span></a>        <span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">())</span><span class="si">}</span><span class="s1">, hand_sizes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="MultiDeal-145"><a href="#MultiDeal-145"><span class="linenos">145</span></a>
</span><span id="MultiDeal-146"><a href="#MultiDeal-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="MultiDeal-147"><a href="#MultiDeal-147"><span class="linenos">147</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span>
</span><span id="MultiDeal-148"><a href="#MultiDeal-148"><span class="linenos">148</span></a>            <span class="bp">self</span>
</span><span id="MultiDeal-149"><a href="#MultiDeal-149"><span class="linenos">149</span></a>        <span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39; of hand_sizes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()</span><span class="si">}</span><span class="s1"> from deck:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="MultiDeal-150"><a href="#MultiDeal-150"><span class="linenos">150</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Represents an unordered deal of multiple hands from a <code><a href="#Deck">Deck</a></code>.</p>
</div>


                            <div id="MultiDeal.__init__" class="classattr">
                                        <input id="MultiDeal.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MultiDeal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">deck</span><span class="p">:</span> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>, </span><span class="param"><span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="MultiDeal.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal.__init__-22"><a href="#MultiDeal.__init__-22"><span class="linenos">22</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MultiDeal.__init__-23"><a href="#MultiDeal.__init__-23"><span class="linenos">23</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="MultiDeal.__init__-24"><a href="#MultiDeal.__init__-24"><span class="linenos">24</span></a>
</span><span id="MultiDeal.__init__-25"><a href="#MultiDeal.__init__-25"><span class="linenos">25</span></a><span class="sd">        For algorithmic reasons, you must pre-commit to the number of cards to</span>
</span><span id="MultiDeal.__init__-26"><a href="#MultiDeal.__init__-26"><span class="linenos">26</span></a><span class="sd">        deal for each hand.</span>
</span><span id="MultiDeal.__init__-27"><a href="#MultiDeal.__init__-27"><span class="linenos">27</span></a>
</span><span id="MultiDeal.__init__-28"><a href="#MultiDeal.__init__-28"><span class="linenos">28</span></a><span class="sd">        It is permissible to deal zero cards from an empty deck, but not all</span>
</span><span id="MultiDeal.__init__-29"><a href="#MultiDeal.__init__-29"><span class="linenos">29</span></a><span class="sd">        evaluators will handle this case, especially if they depend on the</span>
</span><span id="MultiDeal.__init__-30"><a href="#MultiDeal.__init__-30"><span class="linenos">30</span></a><span class="sd">        outcome type. Dealing zero cards from a non-empty deck does not have</span>
</span><span id="MultiDeal.__init__-31"><a href="#MultiDeal.__init__-31"><span class="linenos">31</span></a><span class="sd">        this issue.</span>
</span><span id="MultiDeal.__init__-32"><a href="#MultiDeal.__init__-32"><span class="linenos">32</span></a>
</span><span id="MultiDeal.__init__-33"><a href="#MultiDeal.__init__-33"><span class="linenos">33</span></a><span class="sd">        Args:</span>
</span><span id="MultiDeal.__init__-34"><a href="#MultiDeal.__init__-34"><span class="linenos">34</span></a><span class="sd">            deck: The `Deck` to deal from.</span>
</span><span id="MultiDeal.__init__-35"><a href="#MultiDeal.__init__-35"><span class="linenos">35</span></a><span class="sd">            *hand_sizes: How many cards to deal. If multiple `hand_sizes` are</span>
</span><span id="MultiDeal.__init__-36"><a href="#MultiDeal.__init__-36"><span class="linenos">36</span></a><span class="sd">                provided, `MultisetEvaluator.next_state` will recieve one count</span>
</span><span id="MultiDeal.__init__-37"><a href="#MultiDeal.__init__-37"><span class="linenos">37</span></a><span class="sd">                per hand in order. Try to keep the number of hands to a minimum</span>
</span><span id="MultiDeal.__init__-38"><a href="#MultiDeal.__init__-38"><span class="linenos">38</span></a><span class="sd">                as this can be computationally intensive.</span>
</span><span id="MultiDeal.__init__-39"><a href="#MultiDeal.__init__-39"><span class="linenos">39</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultiDeal.__init__-40"><a href="#MultiDeal.__init__-40"><span class="linenos">40</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">hand</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">hand_sizes</span><span class="p">):</span>
</span><span id="MultiDeal.__init__-41"><a href="#MultiDeal.__init__-41"><span class="linenos">41</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;hand_sizes cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="MultiDeal.__init__-42"><a href="#MultiDeal.__init__-42"><span class="linenos">42</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="MultiDeal.__init__-43"><a href="#MultiDeal.__init__-43"><span class="linenos">43</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="n">Qs</span><span class="p">,</span> <span class="n">hand_sizes</span><span class="p">)</span>
</span><span id="MultiDeal.__init__-44"><a href="#MultiDeal.__init__-44"><span class="linenos">44</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="MultiDeal.__init__-45"><a href="#MultiDeal.__init__-45"><span class="linenos">45</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="MultiDeal.__init__-46"><a href="#MultiDeal.__init__-46"><span class="linenos">46</span></a>                <span class="s1">&#39;The total number of cards dealt cannot exceed the size of the deck.&#39;</span>
</span><span id="MultiDeal.__init__-47"><a href="#MultiDeal.__init__-47"><span class="linenos">47</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructor.</p>

<p>For algorithmic reasons, you must pre-commit to the number of cards to
deal for each hand.</p>

<p>It is permissible to deal zero cards from an empty deck, but not all
evaluators will handle this case, especially if they depend on the
outcome type. Dealing zero cards from a non-empty deck does not have
this issue.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>deck:</strong>  The <code><a href="#Deck">Deck</a></code> to deal from.</li>
<li><strong>*hand_sizes:</strong>  How many cards to deal. If multiple <code><a href="#MultiDeal.hand_sizes">hand_sizes</a></code> are
provided, <code><a href="#MultisetEvaluator.next_state">MultisetEvaluator.next_state</a></code> will recieve one count
per hand in order. Try to keep the number of hands to a minimum
as this can be computationally intensive.</li>
</ul>
</div>


                            </div>
                            <div id="MultiDeal.deck" class="classattr">
                                        <input id="MultiDeal.deck-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deck</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">Deck</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultiDeal.deck-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal.deck"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal.deck-57"><a href="#MultiDeal.deck-57"><span class="linenos">57</span></a>    <span class="k">def</span> <span class="nf">deck</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deck[T]&#39;</span><span class="p">:</span>
</span><span id="MultiDeal.deck-58"><a href="#MultiDeal.deck-58"><span class="linenos">58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The `Deck` the cards are dealt from.&quot;&quot;&quot;</span>
</span><span id="MultiDeal.deck-59"><a href="#MultiDeal.deck-59"><span class="linenos">59</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#Deck">Deck</a></code> the cards are dealt from.</p>
</div>


                            </div>
                            <div id="MultiDeal.hand_sizes" class="classattr">
                                        <input id="MultiDeal.hand_sizes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hand_sizes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">Qs</span>:</span></span>

                <label class="view-source-button" for="MultiDeal.hand_sizes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal.hand_sizes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal.hand_sizes-61"><a href="#MultiDeal.hand_sizes-61"><span class="linenos">61</span></a>    <span class="k">def</span> <span class="nf">hand_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Qs</span><span class="p">:</span>
</span><span id="MultiDeal.hand_sizes-62"><a href="#MultiDeal.hand_sizes-62"><span class="linenos">62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The number of cards dealt to each hand as a tuple.&quot;&quot;&quot;</span>
</span><span id="MultiDeal.hand_sizes-63"><a href="#MultiDeal.hand_sizes-63"><span class="linenos">63</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span>
</span></pre></div>


            <div class="docstring"><p>The number of cards dealt to each hand as a tuple.</p>
</div>


                            </div>
                            <div id="MultiDeal.total_cards_dealt" class="classattr">
                                        <input id="MultiDeal.total_cards_dealt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">total_cards_dealt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="MultiDeal.total_cards_dealt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal.total_cards_dealt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal.total_cards_dealt-65"><a href="#MultiDeal.total_cards_dealt-65"><span class="linenos">65</span></a>    <span class="k">def</span> <span class="nf">total_cards_dealt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultiDeal.total_cards_dealt-66"><a href="#MultiDeal.total_cards_dealt-66"><span class="linenos">66</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The total number of cards dealt.&quot;&quot;&quot;</span>
</span><span id="MultiDeal.total_cards_dealt-67"><a href="#MultiDeal.total_cards_dealt-67"><span class="linenos">67</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>The total number of cards dealt.</p>
</div>


                            </div>
                            <div id="MultiDeal.outcomes" class="classattr">
                                        <input id="MultiDeal.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">CountsKeysView</a></span><span class="p">[</span><span class="o">~</span><span class="n">T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="MultiDeal.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal.outcomes-69"><a href="#MultiDeal.outcomes-69"><span class="linenos">69</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">[</span><span class="n">T</span><span class="p">]:</span>
</span><span id="MultiDeal.outcomes-70"><a href="#MultiDeal.outcomes-70"><span class="linenos">70</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The outcomes of the `Deck` in ascending order.</span>
</span><span id="MultiDeal.outcomes-71"><a href="#MultiDeal.outcomes-71"><span class="linenos">71</span></a>
</span><span id="MultiDeal.outcomes-72"><a href="#MultiDeal.outcomes-72"><span class="linenos">72</span></a><span class="sd">        These are also the `keys` of the `Deck` as a `Mapping`.</span>
</span><span id="MultiDeal.outcomes-73"><a href="#MultiDeal.outcomes-73"><span class="linenos">73</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="MultiDeal.outcomes-74"><a href="#MultiDeal.outcomes-74"><span class="linenos">74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MultiDeal.outcomes-75"><a href="#MultiDeal.outcomes-75"><span class="linenos">75</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes of the <code><a href="#Deck">Deck</a></code> in ascending order.</p>

<p>These are also the <code>keys</code> of the <code><a href="#Deck">Deck</a></code> as a <code>Mapping</code>.
Prefer to use the name <code><a href="#MultiDeal.outcomes">outcomes</a></code>.</p>
</div>


                            </div>
                            <div id="MultiDeal.output_arity" class="classattr">
                                        <input id="MultiDeal.output_arity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">output_arity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="MultiDeal.output_arity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal.output_arity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal.output_arity-77"><a href="#MultiDeal.output_arity-77"><span class="linenos">77</span></a>    <span class="k">def</span> <span class="nf">output_arity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultiDeal.output_arity-78"><a href="#MultiDeal.output_arity-78"><span class="linenos">78</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The number of multisets/counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="MultiDeal.denominator" class="classattr">
                                        <input id="MultiDeal.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="MultiDeal.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MultiDeal.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MultiDeal.denominator-92"><a href="#MultiDeal.denominator-92"><span class="linenos">92</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MultiDeal.denominator-93"><a href="#MultiDeal.denominator-93"><span class="linenos">93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denomiator</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#MultisetGenerator">MultisetGenerator</a></dt>
                                <dd id="MultiDeal.equals" class="function"><a href="#MultisetGenerator.equals">equals</a></dd>
                <dd id="MultiDeal.order" class="function"><a href="#MultisetGenerator.order">order</a></dd>
                <dd id="MultiDeal.min_outcome" class="function"><a href="#MultisetGenerator.min_outcome">min_outcome</a></dd>
                <dd id="MultiDeal.max_outcome" class="function"><a href="#MultisetGenerator.max_outcome">max_outcome</a></dd>
                <dd id="MultiDeal.sample" class="function"><a href="#MultisetGenerator.sample">sample</a></dd>

            </div>
            <div><dt><a href="#MultisetExpression">MultisetExpression</a></dt>
                                <dd id="MultiDeal.additive_union" class="function"><a href="#MultisetExpression.additive_union">additive_union</a></dd>
                <dd id="MultiDeal.difference" class="function"><a href="#MultisetExpression.difference">difference</a></dd>
                <dd id="MultiDeal.intersection" class="function"><a href="#MultisetExpression.intersection">intersection</a></dd>
                <dd id="MultiDeal.union" class="function"><a href="#MultisetExpression.union">union</a></dd>
                <dd id="MultiDeal.symmetric_difference" class="function"><a href="#MultisetExpression.symmetric_difference">symmetric_difference</a></dd>
                <dd id="MultiDeal.keep_outcomes" class="function"><a href="#MultisetExpression.keep_outcomes">keep_outcomes</a></dd>
                <dd id="MultiDeal.drop_outcomes" class="function"><a href="#MultisetExpression.drop_outcomes">drop_outcomes</a></dd>
                <dd id="MultiDeal.map_counts" class="function"><a href="#MultisetExpression.map_counts">map_counts</a></dd>
                <dd id="MultiDeal.multiply_counts" class="function"><a href="#MultisetExpression.multiply_counts">multiply_counts</a></dd>
                <dd id="MultiDeal.divide_counts" class="function"><a href="#MultisetExpression.divide_counts">divide_counts</a></dd>
                <dd id="MultiDeal.modulo_counts" class="function"><a href="#MultisetExpression.modulo_counts">modulo_counts</a></dd>
                <dd id="MultiDeal.keep_counts" class="function"><a href="#MultisetExpression.keep_counts">keep_counts</a></dd>
                <dd id="MultiDeal.unique" class="function"><a href="#MultisetExpression.unique">unique</a></dd>
                <dd id="MultiDeal.keep" class="function"><a href="#MultisetExpression.keep">keep</a></dd>
                <dd id="MultiDeal.lowest" class="function"><a href="#MultisetExpression.lowest">lowest</a></dd>
                <dd id="MultiDeal.highest" class="function"><a href="#MultisetExpression.highest">highest</a></dd>
                <dd id="MultiDeal.pair_le" class="function"><a href="#MultisetExpression.pair_le">pair_le</a></dd>
                <dd id="MultiDeal.evaluate" class="function"><a href="#MultisetExpression.evaluate">evaluate</a></dd>
                <dd id="MultiDeal.expand" class="function"><a href="#MultisetExpression.expand">expand</a></dd>
                <dd id="MultiDeal.sum" class="function"><a href="#MultisetExpression.sum">sum</a></dd>
                <dd id="MultiDeal.count" class="function"><a href="#MultisetExpression.count">count</a></dd>
                <dd id="MultiDeal.any" class="function"><a href="#MultisetExpression.any">any</a></dd>
                <dd id="MultiDeal.highest_outcome_and_count" class="function"><a href="#MultisetExpression.highest_outcome_and_count">highest_outcome_and_count</a></dd>
                <dd id="MultiDeal.all_counts" class="function"><a href="#MultisetExpression.all_counts">all_counts</a></dd>
                <dd id="MultiDeal.largest_count" class="function"><a href="#MultisetExpression.largest_count">largest_count</a></dd>
                <dd id="MultiDeal.largest_count_and_outcome" class="function"><a href="#MultisetExpression.largest_count_and_outcome">largest_count_and_outcome</a></dd>
                <dd id="MultiDeal.count_subset" class="function"><a href="#MultisetExpression.count_subset">count_subset</a></dd>
                <dd id="MultiDeal.largest_straight" class="function"><a href="#MultisetExpression.largest_straight">largest_straight</a></dd>
                <dd id="MultiDeal.largest_straight_and_outcome" class="function"><a href="#MultisetExpression.largest_straight_and_outcome">largest_straight_and_outcome</a></dd>
                <dd id="MultiDeal.all_straights" class="function"><a href="#MultisetExpression.all_straights">all_straights</a></dd>
                <dd id="MultiDeal.all_straights_reduce_counts" class="function"><a href="#MultisetExpression.all_straights_reduce_counts">all_straights_reduce_counts</a></dd>
                <dd id="MultiDeal.argsort" class="function"><a href="#MultisetExpression.argsort">argsort</a></dd>
                <dd id="MultiDeal.issubset" class="function"><a href="#MultisetExpression.issubset">issubset</a></dd>
                <dd id="MultiDeal.issuperset" class="function"><a href="#MultisetExpression.issuperset">issuperset</a></dd>
                <dd id="MultiDeal.isdisjoint" class="function"><a href="#MultisetExpression.isdisjoint">isdisjoint</a></dd>
                <dd id="MultiDeal.compair_lt" class="function"><a href="#MultisetExpression.compair_lt">compair_lt</a></dd>
                <dd id="MultiDeal.compair_le" class="function"><a href="#MultisetExpression.compair_le">compair_le</a></dd>
                <dd id="MultiDeal.compair_gt" class="function"><a href="#MultisetExpression.compair_gt">compair_gt</a></dd>
                <dd id="MultiDeal.compair_ge" class="function"><a href="#MultisetExpression.compair_ge">compair_ge</a></dd>
                <dd id="MultiDeal.compair_eq" class="function"><a href="#MultisetExpression.compair_eq">compair_eq</a></dd>
                <dd id="MultiDeal.compair_ne" class="function"><a href="#MultisetExpression.compair_ne">compair_ne</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="multiset_function">
                            <input id="multiset_function-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">multiset_function</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">+</span><span class="n">U_co</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">+</span><span class="n">U_co</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;NestedTupleOrEvaluator[T_contra, U_co]&#39;</span><span class="p">),</span> <span class="o">...</span><span class="p">]],</span> <span class="o">...</span><span class="p">]]]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#MultisetEvaluator">MultisetEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="o">+</span><span class="n">U_co</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="o">+</span><span class="n">U_co</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;NestedTupleOrOutcome[U_co]&#39;</span><span class="p">),</span> <span class="o">...</span><span class="p">]],</span> <span class="o">...</span><span class="p">]]]</span>:</span></span>

                <label class="view-source-button" for="multiset_function-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#multiset_function"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="multiset_function-65"><a href="#multiset_function-65"><span class="linenos"> 65</span></a><span class="k">def</span> <span class="nf">multiset_function</span><span class="p">(</span>
</span><span id="multiset_function-66"><a href="#multiset_function-66"><span class="linenos"> 66</span></a>        <span class="n">function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">NestedTupleOrEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">]],</span>
</span><span id="multiset_function-67"><a href="#multiset_function-67"><span class="linenos"> 67</span></a>        <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MultisetEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">NestedTupleOrOutcome</span><span class="p">[</span><span class="n">U_co</span><span class="p">]]:</span>
</span><span id="multiset_function-68"><a href="#multiset_function-68"><span class="linenos"> 68</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;EXPERIMENTAL: A decorator that turns a function into a `MultisetEvaluator`.</span>
</span><span id="multiset_function-69"><a href="#multiset_function-69"><span class="linenos"> 69</span></a>
</span><span id="multiset_function-70"><a href="#multiset_function-70"><span class="linenos"> 70</span></a><span class="sd">    The provided function should take in arguments representing multisets,</span>
</span><span id="multiset_function-71"><a href="#multiset_function-71"><span class="linenos"> 71</span></a><span class="sd">    do a limited set of operations on them (see `MultisetExpression`), and</span>
</span><span id="multiset_function-72"><a href="#multiset_function-72"><span class="linenos"> 72</span></a><span class="sd">    finish off with an evaluation. You can return tuples to perform a joint</span>
</span><span id="multiset_function-73"><a href="#multiset_function-73"><span class="linenos"> 73</span></a><span class="sd">    evaluation.</span>
</span><span id="multiset_function-74"><a href="#multiset_function-74"><span class="linenos"> 74</span></a>
</span><span id="multiset_function-75"><a href="#multiset_function-75"><span class="linenos"> 75</span></a><span class="sd">    For example, to create an evaluator which computes the elements each of two</span>
</span><span id="multiset_function-76"><a href="#multiset_function-76"><span class="linenos"> 76</span></a><span class="sd">    multisets has that the other doesn&#39;t:</span>
</span><span id="multiset_function-77"><a href="#multiset_function-77"><span class="linenos"> 77</span></a>
</span><span id="multiset_function-78"><a href="#multiset_function-78"><span class="linenos"> 78</span></a><span class="sd">    ```python</span>
</span><span id="multiset_function-79"><a href="#multiset_function-79"><span class="linenos"> 79</span></a><span class="sd">    @multiset_function</span>
</span><span id="multiset_function-80"><a href="#multiset_function-80"><span class="linenos"> 80</span></a><span class="sd">    def two_way_difference(a, b):</span>
</span><span id="multiset_function-81"><a href="#multiset_function-81"><span class="linenos"> 81</span></a><span class="sd">        return (a - b).expand(), (b - a).expand()</span>
</span><span id="multiset_function-82"><a href="#multiset_function-82"><span class="linenos"> 82</span></a><span class="sd">    ```</span>
</span><span id="multiset_function-83"><a href="#multiset_function-83"><span class="linenos"> 83</span></a>
</span><span id="multiset_function-84"><a href="#multiset_function-84"><span class="linenos"> 84</span></a><span class="sd">    Any globals inside `function` are effectively bound at the time</span>
</span><span id="multiset_function-85"><a href="#multiset_function-85"><span class="linenos"> 85</span></a><span class="sd">    `multiset_function` is invoked. Note that this is different than how</span>
</span><span id="multiset_function-86"><a href="#multiset_function-86"><span class="linenos"> 86</span></a><span class="sd">    ordinary Python closures behave. For example,</span>
</span><span id="multiset_function-87"><a href="#multiset_function-87"><span class="linenos"> 87</span></a>
</span><span id="multiset_function-88"><a href="#multiset_function-88"><span class="linenos"> 88</span></a><span class="sd">    ```python</span>
</span><span id="multiset_function-89"><a href="#multiset_function-89"><span class="linenos"> 89</span></a><span class="sd">    target = [1, 2, 3]</span>
</span><span id="multiset_function-90"><a href="#multiset_function-90"><span class="linenos"> 90</span></a>
</span><span id="multiset_function-91"><a href="#multiset_function-91"><span class="linenos"> 91</span></a><span class="sd">    @multiset_function</span>
</span><span id="multiset_function-92"><a href="#multiset_function-92"><span class="linenos"> 92</span></a><span class="sd">    def count_intersection(a):</span>
</span><span id="multiset_function-93"><a href="#multiset_function-93"><span class="linenos"> 93</span></a><span class="sd">        return (a &amp; target).count()</span>
</span><span id="multiset_function-94"><a href="#multiset_function-94"><span class="linenos"> 94</span></a>
</span><span id="multiset_function-95"><a href="#multiset_function-95"><span class="linenos"> 95</span></a><span class="sd">    print(count_intersection(d6.pool(3)))</span>
</span><span id="multiset_function-96"><a href="#multiset_function-96"><span class="linenos"> 96</span></a>
</span><span id="multiset_function-97"><a href="#multiset_function-97"><span class="linenos"> 97</span></a><span class="sd">    target = [1]</span>
</span><span id="multiset_function-98"><a href="#multiset_function-98"><span class="linenos"> 98</span></a><span class="sd">    print(count_intersection(d6.pool(3)))</span>
</span><span id="multiset_function-99"><a href="#multiset_function-99"><span class="linenos"> 99</span></a><span class="sd">    ```</span>
</span><span id="multiset_function-100"><a href="#multiset_function-100"><span class="linenos">100</span></a>
</span><span id="multiset_function-101"><a href="#multiset_function-101"><span class="linenos">101</span></a><span class="sd">    would produce the same thing both times. Likewise, the function should not</span>
</span><span id="multiset_function-102"><a href="#multiset_function-102"><span class="linenos">102</span></a><span class="sd">    have any side effects.</span>
</span><span id="multiset_function-103"><a href="#multiset_function-103"><span class="linenos">103</span></a>
</span><span id="multiset_function-104"><a href="#multiset_function-104"><span class="linenos">104</span></a><span class="sd">    Be careful when using control structures: you cannot branch on the value of</span>
</span><span id="multiset_function-105"><a href="#multiset_function-105"><span class="linenos">105</span></a><span class="sd">    a multiset expression or evaluation, so e.g.</span>
</span><span id="multiset_function-106"><a href="#multiset_function-106"><span class="linenos">106</span></a>
</span><span id="multiset_function-107"><a href="#multiset_function-107"><span class="linenos">107</span></a><span class="sd">    ```python</span>
</span><span id="multiset_function-108"><a href="#multiset_function-108"><span class="linenos">108</span></a><span class="sd">    @multiset_function</span>
</span><span id="multiset_function-109"><a href="#multiset_function-109"><span class="linenos">109</span></a><span class="sd">    def bad(a, b)</span>
</span><span id="multiset_function-110"><a href="#multiset_function-110"><span class="linenos">110</span></a><span class="sd">        if a == b:</span>
</span><span id="multiset_function-111"><a href="#multiset_function-111"><span class="linenos">111</span></a><span class="sd">            ...</span>
</span><span id="multiset_function-112"><a href="#multiset_function-112"><span class="linenos">112</span></a><span class="sd">    ```</span>
</span><span id="multiset_function-113"><a href="#multiset_function-113"><span class="linenos">113</span></a>
</span><span id="multiset_function-114"><a href="#multiset_function-114"><span class="linenos">114</span></a><span class="sd">    is not allowed.</span>
</span><span id="multiset_function-115"><a href="#multiset_function-115"><span class="linenos">115</span></a>
</span><span id="multiset_function-116"><a href="#multiset_function-116"><span class="linenos">116</span></a><span class="sd">    `multiset_function` has considerable overhead, being effectively a</span>
</span><span id="multiset_function-117"><a href="#multiset_function-117"><span class="linenos">117</span></a><span class="sd">    mini-language within Python. For better performance, you can try</span>
</span><span id="multiset_function-118"><a href="#multiset_function-118"><span class="linenos">118</span></a><span class="sd">    implementing your own subclass of `MultisetEvaluator` directly.</span>
</span><span id="multiset_function-119"><a href="#multiset_function-119"><span class="linenos">119</span></a>
</span><span id="multiset_function-120"><a href="#multiset_function-120"><span class="linenos">120</span></a><span class="sd">    Args:</span>
</span><span id="multiset_function-121"><a href="#multiset_function-121"><span class="linenos">121</span></a><span class="sd">        function: This should take in a fixed number of multiset variables and</span>
</span><span id="multiset_function-122"><a href="#multiset_function-122"><span class="linenos">122</span></a><span class="sd">            output an evaluator or a nested tuple of evaluators. Tuples will</span>
</span><span id="multiset_function-123"><a href="#multiset_function-123"><span class="linenos">123</span></a><span class="sd">            result in a `JointEvaluator`.</span>
</span><span id="multiset_function-124"><a href="#multiset_function-124"><span class="linenos">124</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="multiset_function-125"><a href="#multiset_function-125"><span class="linenos">125</span></a>    <span class="n">parameters</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">follow_wrapped</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span>
</span><span id="multiset_function-126"><a href="#multiset_function-126"><span class="linenos">126</span></a>    <span class="k">for</span> <span class="n">parameter</span> <span class="ow">in</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="multiset_function-127"><a href="#multiset_function-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="multiset_function-128"><a href="#multiset_function-128"><span class="linenos">128</span></a>                <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">POSITIONAL_ONLY</span><span class="p">,</span>
</span><span id="multiset_function-129"><a href="#multiset_function-129"><span class="linenos">129</span></a>                <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">POSITIONAL_OR_KEYWORD</span><span class="p">,</span>
</span><span id="multiset_function-130"><a href="#multiset_function-130"><span class="linenos">130</span></a>        <span class="p">]</span> <span class="ow">or</span> <span class="n">parameter</span><span class="o">.</span><span class="n">default</span> <span class="o">!=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
</span><span id="multiset_function-131"><a href="#multiset_function-131"><span class="linenos">131</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="multiset_function-132"><a href="#multiset_function-132"><span class="linenos">132</span></a>                <span class="s1">&#39;Callable must take only a fixed number of positional arguments.&#39;</span>
</span><span id="multiset_function-133"><a href="#multiset_function-133"><span class="linenos">133</span></a>            <span class="p">)</span>
</span><span id="multiset_function-134"><a href="#multiset_function-134"><span class="linenos">134</span></a>    <span class="n">tuple_or_evaluator</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">MV</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">))))</span>
</span><span id="multiset_function-135"><a href="#multiset_function-135"><span class="linenos">135</span></a>    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">replace_tuples_with_joint_evaluator</span><span class="p">(</span><span class="n">tuple_or_evaluator</span><span class="p">)</span>
</span><span id="multiset_function-136"><a href="#multiset_function-136"><span class="linenos">136</span></a>    <span class="k">return</span> <span class="n">update_wrapper</span><span class="p">(</span><span class="n">evaluator</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: A decorator that turns a function into a <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code>.</p>

<p>The provided function should take in arguments representing multisets,
do a limited set of operations on them (see <code><a href="#MultisetExpression">MultisetExpression</a></code>), and
finish off with an evaluation. You can return tuples to perform a joint
evaluation.</p>

<p>For example, to create an evaluator which computes the elements each of two
multisets has that the other doesn't:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nd">@multiset_function</span>
<span class="k">def</span> <span class="nf">two_way_difference</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(),</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span>
</code></pre>
</div>

<p>Any globals inside <code>function</code> are effectively bound at the time
<code><a href="#multiset_function">multiset_function</a></code> is invoked. Note that this is different than how
ordinary Python closures behave. For example,</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="nd">@multiset_function</span>
<span class="k">def</span> <span class="nf">count_intersection</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;</span> <span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">count_intersection</span><span class="p">(</span><span class="n">d6</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>

<span class="n">target</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">count_intersection</span><span class="p">(</span><span class="n">d6</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
</code></pre>
</div>

<p>would produce the same thing both times. Likewise, the function should not
have any side effects.</p>

<p>Be careful when using control structures: you cannot branch on the value of
a multiset expression or evaluation, so e.g.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nd">@multiset_function</span>
<span class="k">def</span> <span class="nf">bad</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
        <span class="o">...</span>
</code></pre>
</div>

<p>is not allowed.</p>

<p><code><a href="#multiset_function">multiset_function</a></code> has considerable overhead, being effectively a
mini-language within Python. For better performance, you can try
implementing your own subclass of <code><a href="#MultisetEvaluator">MultisetEvaluator</a></code> directly.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>function:</strong>  This should take in a fixed number of multiset variables and
output an evaluator or a nested tuple of evaluators. Tuples will
result in a <code>JointEvaluator</code>.</li>
</ul>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>