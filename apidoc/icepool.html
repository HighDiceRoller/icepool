<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>icepool API documentation</title>
            <link rel="icon" href="favicon.png"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#standard">standard</a>
            </li>
            <li>
                    <a class="function" href="#d">d</a>
            </li>
            <li>
                    <a class="function" href="#bernoulli">bernoulli</a>
            </li>
            <li>
                    <a class="function" href="#coin">coin</a>
            </li>
            <li>
                    <a class="function" href="#one_hot">one_hot</a>
            </li>
            <li>
                    <a class="class" href="#Die">Die</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Die.__init__">Die</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.unary_op">unary_op</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.binary_op">binary_op</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.keys">keys</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.values">values</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.items">items</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.simplify">simplify</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.reroll">reroll</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.reroll_until">reroll_until</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.truncate">truncate</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.clip">clip</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.set_range">set_range</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.set_outcomes">set_outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.trim">trim</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.sub">sub</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.explode">explode</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.if_else">if_else</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.is_in">is_in</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.count">count</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.count_in">count_in</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.pool">pool</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.keep_lowest">keep_lowest</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.keep_highest">keep_highest</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.abs">abs</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.round">round</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.trunc">trunc</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.floor">floor</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.ceil">ceil</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.zero">zero</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.zero_outcome">zero_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.cmp">cmp</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.sign">sign</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.bool">bool</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.key_tuple">key_tuple</a>
                        </li>
                        <li>
                                <a class="function" href="#Die.equals">equals</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Population">Population</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Population.keys">keys</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.values">values</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.items">items</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.outcome_len">outcome_len</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.is_empty">is_empty</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.min_outcome">min_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.max_outcome">max_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.nearest_le">nearest_le</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.nearest_ge">nearest_ge</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantities">quantities</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.denominator">denominator</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.has_zero_quantities">has_zero_quantities</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantities_le">quantities_le</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantities_ge">quantities_ge</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantity">quantity</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantity_ne">quantity_ne</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantity_le">quantity_le</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantity_lt">quantity_lt</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantity_ge">quantity_ge</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantity_gt">quantity_gt</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probabilities">probabilities</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probabilities_le">probabilities_le</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probabilities_ge">probabilities_ge</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probabilities_lt">probabilities_lt</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probabilities_gt">probabilities_gt</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.probability">probability</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.mode">mode</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.modal_quantity">modal_quantity</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.kolmogorov_smirnov">kolmogorov_smirnov</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.cramer_von_mises">cramer_von_mises</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.median">median</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.median_left">median_left</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.median_right">median_right</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantile">quantile</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantile_left">quantile_left</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.quantile_right">quantile_right</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.mean">mean</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.variance">variance</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.standard_deviation">standard_deviation</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.sd">sd</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.standardized_moment">standardized_moment</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.skewness">skewness</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.excess_kurtosis">excess_kurtosis</a>
                        </li>
                        <li>
                                <a class="variable" href="#Population.marginals">marginals</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.unary_op_non_elementwise">unary_op_non_elementwise</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.covariance">covariance</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.correlation">correlation</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.sample">sample</a>
                        </li>
                        <li>
                                <a class="function" href="#Population.format">format</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Again">Again</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Again.__init__">Again</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CountsKeysView">CountsKeysView</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CountsKeysView.__init__">CountsKeysView</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CountsValuesView">CountsValuesView</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CountsValuesView.__init__">CountsValuesView</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#CountsItemsView">CountsItemsView</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CountsItemsView.__init__">CountsItemsView</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#from_cumulative_quantities">from_cumulative_quantities</a>
            </li>
            <li>
                    <a class="function" href="#from_rv">from_rv</a>
            </li>
            <li>
                    <a class="function" href="#align">align</a>
            </li>
            <li>
                    <a class="function" href="#align_range">align_range</a>
            </li>
            <li>
                    <a class="function" href="#lowest">lowest</a>
            </li>
            <li>
                    <a class="function" href="#highest">highest</a>
            </li>
            <li>
                    <a class="function" href="#min_outcome">min_outcome</a>
            </li>
            <li>
                    <a class="function" href="#max_outcome">max_outcome</a>
            </li>
            <li>
                    <a class="function" href="#reduce">reduce</a>
            </li>
            <li>
                    <a class="function" href="#accumulate">accumulate</a>
            </li>
            <li>
                    <a class="function" href="#apply">apply</a>
            </li>
            <li>
                    <a class="class" href="#apply_sorted">apply_sorted</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#apply_sorted.__init__">apply_sorted</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#Reroll">Reroll</a>
            </li>
            <li>
                    <a class="variable" href="#Unlimited">Unlimited</a>
            </li>
            <li>
                    <a class="class" href="#OutcomeCountGenerator">OutcomeCountGenerator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.counts_len">counts_len</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.denominator">denominator</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.evaluate">evaluate</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.min_outcome">min_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.max_outcome">max_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.expand">expand</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.sum">sum</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.count">count</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.count_in">count_in</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.count_unique">count_unique</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.contains_subset">contains_subset</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.intersection_size">intersection_size</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.best_matching_set">best_matching_set</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.best_straight">best_straight</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountGenerator.sample">sample</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Pool">Pool</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Pool.__init__">Pool</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.size">size</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.denominator">denominator</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.unique_dice">unique_dice</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.counts_len">counts_len</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.sorted_roll_counts">sorted_roll_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.set_sorted_roll_counts">set_sorted_roll_counts</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.min_outcome">min_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.max_outcome">max_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.lowest">lowest</a>
                        </li>
                        <li>
                                <a class="function" href="#Pool.highest">highest</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#standard_pool">standard_pool</a>
            </li>
            <li>
                    <a class="class" href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.next_state">next_state</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.final_outcome">final_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.order">order</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.alignment">alignment</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.range_alignment">range_alignment</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.final_kwargs">final_kwargs</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.evaluate">evaluate</a>
                        </li>
                        <li>
                                <a class="function" href="#OutcomeCountEvaluator.sample">sample</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Order">Order</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Order.Ascending">Ascending</a>
                        </li>
                        <li>
                                <a class="variable" href="#Order.Descending">Descending</a>
                        </li>
                        <li>
                                <a class="variable" href="#Order.Any">Any</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#JointEvaluator">JointEvaluator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#JointEvaluator.__init__">JointEvaluator</a>
                        </li>
                        <li>
                                <a class="function" href="#JointEvaluator.next_state">next_state</a>
                        </li>
                        <li>
                                <a class="function" href="#JointEvaluator.final_outcome">final_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#JointEvaluator.order">order</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SumEvaluator">SumEvaluator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SumEvaluator.__init__">SumEvaluator</a>
                        </li>
                        <li>
                                <a class="function" href="#SumEvaluator.next_state">next_state</a>
                        </li>
                        <li>
                                <a class="function" href="#SumEvaluator.final_outcome">final_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#SumEvaluator.order">order</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ExpandEvaluator">ExpandEvaluator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ExpandEvaluator.__init__">ExpandEvaluator</a>
                        </li>
                        <li>
                                <a class="function" href="#ExpandEvaluator.next_state">next_state</a>
                        </li>
                        <li>
                                <a class="function" href="#ExpandEvaluator.order">order</a>
                        </li>
                        <li>
                                <a class="function" href="#ExpandEvaluator.final_outcome">final_outcome</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Deck">Deck</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Deck.__init__">Deck</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.keys">keys</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.values">values</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.items">items</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.size">size</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.deal">deal</a>
                        </li>
                        <li>
                                <a class="function" href="#Deck.sub">sub</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Deal">Deal</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Deal.__init__">Deal</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.deck">deck</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.hand_sizes">hand_sizes</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.total_cards_dealt">total_cards_dealt</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.counts_len">counts_len</a>
                        </li>
                        <li>
                                <a class="function" href="#Deal.denominator">denominator</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SuitGenerator">SuitGenerator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SuitGenerator.__init__">SuitGenerator</a>
                        </li>
                        <li>
                                <a class="function" href="#SuitGenerator.outcomes">outcomes</a>
                        </li>
                        <li>
                                <a class="function" href="#SuitGenerator.counts_len">counts_len</a>
                        </li>
                        <li>
                                <a class="function" href="#SuitGenerator.denominator">denominator</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#clear_pool_cache">clear_pool_cache</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
icepool    </h1>

                        <div class="docstring"><p>Package for computing dice and card probabilities.</p>

<p>See <a href="https://highdiceroller.github.io/icepool/notebooks/lab/index.html">this JupyterLite distribution</a>
for examples.</p>

<p><a href="https://github.com/HighDiceRoller/icepool">Visit the project page.</a></p>

<p>General conventions:</p>

<ul>
<li>Instances are immutable (apart from internal caching). Anything that looks
like it mutates an instance actually returns a separate instance with the
change.</li>
<li>Unless explictly specified otherwise, all sorting is in ascending order.</li>
<li>Unless explictly specified otherwise, elements with zero quantity, rolls, etc.
are considered.</li>
<li>The words "min" and "max" refer to outcomes, and the words "low" and "high"
refer to dice in a pool.</li>
</ul>
</div>

                        <input id="mod-icepool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-icepool-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;Package for computing dice and card probabilities.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">See [this JupyterLite distribution](https://highdiceroller.github.io/icepool/notebooks/lab/index.html)</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">for examples.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="sd">[Visit the project page.](https://github.com/HighDiceRoller/icepool)</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="sd">General conventions:</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="sd">* Instances are immutable (apart from internal caching). Anything that looks</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="sd">    like it mutates an instance actually returns a separate instance with the</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="sd">    change.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="sd">* Unless explictly specified otherwise, all sorting is in ascending order.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="sd">* Unless explictly specified otherwise, elements with zero quantity, rolls, etc.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="sd">    are considered.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="sd">* The words &quot;min&quot; and &quot;max&quot; refer to outcomes, and the words &quot;low&quot; and &quot;high&quot;</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a><span class="sd">refer to dice in a pool.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a><span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;google&#39;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a><span class="kn">from</span> <span class="nn">icepool.constant</span> <span class="kn">import</span> <span class="n">SpecialValue</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="n">Reroll</span> <span class="o">=</span> <span class="n">SpecialValue</span><span class="o">.</span><span class="n">Reroll</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a><span class="sd">&quot;&quot;&quot;Indicates that an outcome should be rerolled (with unlimited depth).</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="sd">This can be used in place of outcomes in many places. See individual function</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a><span class="sd">and method descriptions for details.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a><span class="sd">This effectively removes the outcome from the probability space, along with its</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a><span class="sd">contribution to the denominator.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">33</span></a><span class="sd">This can be used for conditional probability by removing all outcomes not</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">34</span></a><span class="sd">consistent with the given observations.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">36</span></a><span class="sd">Operation in specific cases:</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">38</span></a><span class="sd">* When used with `Again`, only that stage is rerolled, not the entire `Again`</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">39</span></a><span class="sd">    tree.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">40</span></a><span class="sd">* To reroll with limited depth, use `Die.reroll()`, or `Again()` with no</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">41</span></a><span class="sd">    modification.</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">42</span></a><span class="sd">* When used with `OutcomeCountEvaluator`, the entire evaluation is rerolled.</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">43</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">45</span></a><span class="c1"># Expose certain names at top-level.</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">46</span></a>
</span><span id="L-47"><a href="#L-47"><span class="linenos">47</span></a><span class="kn">from</span> <span class="nn">icepool.die.func</span> <span class="kn">import</span> <span class="p">(</span><span class="n">standard</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="fm">__getattr__</span><span class="p">,</span> <span class="n">bernoulli</span><span class="p">,</span> <span class="n">coin</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">48</span></a>                              <span class="n">one_hot</span><span class="p">,</span> <span class="n">from_cumulative_quantities</span><span class="p">,</span> <span class="n">from_rv</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">49</span></a>                              <span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">align_range</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">50</span></a>                              <span class="n">reduce</span><span class="p">,</span> <span class="n">accumulate</span><span class="p">,</span> <span class="n">apply</span><span class="p">,</span> <span class="n">apply_sorted</span><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">52</span></a><span class="kn">from</span> <span class="nn">icepool.population</span> <span class="kn">import</span> <span class="n">Population</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">53</span></a><span class="kn">from</span> <span class="nn">icepool.die.die</span> <span class="kn">import</span> <span class="n">implicit_convert_to_die</span><span class="p">,</span> <span class="n">Die</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">54</span></a><span class="kn">from</span> <span class="nn">icepool.again</span> <span class="kn">import</span> <span class="n">Again</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">55</span></a><span class="kn">from</span> <span class="nn">icepool.die.die_with_truth</span> <span class="kn">import</span> <span class="n">DieWithTruth</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">57</span></a><span class="kn">from</span> <span class="nn">icepool.counts</span> <span class="kn">import</span> <span class="n">CountsKeysView</span><span class="p">,</span> <span class="n">CountsValuesView</span><span class="p">,</span> <span class="n">CountsItemsView</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">58</span></a>
</span><span id="L-59"><a href="#L-59"><span class="linenos">59</span></a><span class="kn">from</span> <span class="nn">icepool.die.lowest_highest</span> <span class="kn">import</span> <span class="n">lowest</span><span class="p">,</span> <span class="n">highest</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">61</span></a><span class="kn">from</span> <span class="nn">icepool.pool</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">standard_pool</span><span class="p">,</span> <span class="n">clear_pool_cache</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">62</span></a><span class="kn">from</span> <span class="nn">icepool.outcome_count_generator</span> <span class="kn">import</span> <span class="n">OutcomeCountGenerator</span><span class="p">,</span> <span class="n">NextOutcomeCountGenerator</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">63</span></a><span class="kn">from</span> <span class="nn">icepool.outcome_count_evaluator</span> <span class="kn">import</span> <span class="n">OutcomeCountEvaluator</span><span class="p">,</span> <span class="n">Order</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">64</span></a><span class="kn">from</span> <span class="nn">icepool.evaluators</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">65</span></a>    <span class="n">WrapFuncEvaluator</span><span class="p">,</span> <span class="n">JointEvaluator</span><span class="p">,</span> <span class="n">SumEvaluator</span><span class="p">,</span> <span class="n">sum_evaluator</span><span class="p">,</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">66</span></a>    <span class="n">ExpandEvaluator</span><span class="p">,</span> <span class="n">expand_evaluator</span><span class="p">,</span> <span class="n">CountInEvaluator</span><span class="p">,</span> <span class="n">count_unique_evaluator</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">67</span></a>    <span class="n">SubsetTargetEvaluator</span><span class="p">,</span> <span class="n">ContainsSubsetEvaluator</span><span class="p">,</span> <span class="n">IntersectionSizeEvaluator</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">68</span></a>    <span class="n">BestMatchingSetEvaluator</span><span class="p">,</span> <span class="n">best_matching_set_evaluator</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">69</span></a>    <span class="n">BestStraightEvaluator</span><span class="p">,</span> <span class="n">best_straight_evaluator</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">70</span></a>
</span><span id="L-71"><a href="#L-71"><span class="linenos">71</span></a><span class="kn">from</span> <span class="nn">icepool.deck</span> <span class="kn">import</span> <span class="n">Deck</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">72</span></a><span class="kn">from</span> <span class="nn">icepool.deal</span> <span class="kn">import</span> <span class="n">Deal</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos">74</span></a><span class="kn">from</span> <span class="nn">icepool.generators</span> <span class="kn">import</span> <span class="n">SuitGenerator</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos">76</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">77</span></a>    <span class="s1">&#39;standard&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;bernoulli&#39;</span><span class="p">,</span> <span class="s1">&#39;coin&#39;</span><span class="p">,</span> <span class="s1">&#39;one_hot&#39;</span><span class="p">,</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">78</span></a>    <span class="s1">&#39;Again&#39;</span><span class="p">,</span> <span class="s1">&#39;CountsKeysView&#39;</span><span class="p">,</span> <span class="s1">&#39;CountsValuesView&#39;</span><span class="p">,</span> <span class="s1">&#39;CountsItemsView&#39;</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">79</span></a>    <span class="s1">&#39;from_cumulative_quantities&#39;</span><span class="p">,</span> <span class="s1">&#39;from_rv&#39;</span><span class="p">,</span> <span class="s1">&#39;align&#39;</span><span class="p">,</span> <span class="s1">&#39;align_range&#39;</span><span class="p">,</span> <span class="s1">&#39;lowest&#39;</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">80</span></a>    <span class="s1">&#39;highest&#39;</span><span class="p">,</span> <span class="s1">&#39;min_outcome&#39;</span><span class="p">,</span> <span class="s1">&#39;max_outcome&#39;</span><span class="p">,</span> <span class="s1">&#39;reduce&#39;</span><span class="p">,</span> <span class="s1">&#39;accumulate&#39;</span><span class="p">,</span> <span class="s1">&#39;apply&#39;</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">81</span></a>    <span class="s1">&#39;apply_sorted&#39;</span><span class="p">,</span> <span class="s1">&#39;Reroll&#39;</span><span class="p">,</span> <span class="s1">&#39;Unlimited&#39;</span><span class="p">,</span> <span class="s1">&#39;OutcomeCountGenerator&#39;</span><span class="p">,</span> <span class="s1">&#39;Pool&#39;</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">82</span></a>    <span class="s1">&#39;standard_pool&#39;</span><span class="p">,</span> <span class="s1">&#39;OutcomeCountEvaluator&#39;</span><span class="p">,</span> <span class="s1">&#39;Order&#39;</span><span class="p">,</span> <span class="s1">&#39;JointEvaluator&#39;</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">83</span></a>    <span class="s1">&#39;SumEvaluator&#39;</span><span class="p">,</span> <span class="s1">&#39;ExpandEvaluator&#39;</span><span class="p">,</span> <span class="s1">&#39;Deck&#39;</span><span class="p">,</span> <span class="s1">&#39;Deal&#39;</span><span class="p">,</span> <span class="s1">&#39;SuitGenerator&#39;</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">84</span></a>    <span class="s1">&#39;clear_pool_cache&#39;</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">85</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="standard">
                            <input id="standard-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@cache</div>

        <span class="def">def</span>
        <span class="name">standard</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="standard-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standard"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standard-14"><a href="#standard-14"><span class="linenos">14</span></a><span class="nd">@cache</span>
</span><span id="standard-15"><a href="#standard-15"><span class="linenos">15</span></a><span class="k">def</span> <span class="nf">standard</span><span class="p">(</span><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="standard-16"><a href="#standard-16"><span class="linenos">16</span></a>    <span class="sd">&quot;&quot;&quot;A standard die.</span>
</span><span id="standard-17"><a href="#standard-17"><span class="linenos">17</span></a>
</span><span id="standard-18"><a href="#standard-18"><span class="linenos">18</span></a><span class="sd">    Specifically, the outcomes are `int`s from `1` to `sides` inclusive,</span>
</span><span id="standard-19"><a href="#standard-19"><span class="linenos">19</span></a><span class="sd">    with quantity 1 each.</span>
</span><span id="standard-20"><a href="#standard-20"><span class="linenos">20</span></a>
</span><span id="standard-21"><a href="#standard-21"><span class="linenos">21</span></a><span class="sd">    Don&#39;t confuse this with `icepool.Die()`:</span>
</span><span id="standard-22"><a href="#standard-22"><span class="linenos">22</span></a>
</span><span id="standard-23"><a href="#standard-23"><span class="linenos">23</span></a><span class="sd">    * `icepool.Die([6])`: A `Die` that always rolls the integer 6.</span>
</span><span id="standard-24"><a href="#standard-24"><span class="linenos">24</span></a><span class="sd">    * `icepool.d(6)`: A d6.</span>
</span><span id="standard-25"><a href="#standard-25"><span class="linenos">25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standard-26"><a href="#standard-26"><span class="linenos">26</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sides</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="standard-27"><a href="#standard-27"><span class="linenos">27</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Argument to standard() must be an int.&#39;</span><span class="p">)</span>
</span><span id="standard-28"><a href="#standard-28"><span class="linenos">28</span></a>    <span class="k">elif</span> <span class="n">sides</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="standard-29"><a href="#standard-29"><span class="linenos">29</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Standard die must have at least one side.&#39;</span><span class="p">)</span>
</span><span id="standard-30"><a href="#standard-30"><span class="linenos">30</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sides</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A standard die.</p>

<p>Specifically, the outcomes are <code>int</code>s from <code>1</code> to <code>sides</code> inclusive,
with quantity 1 each.</p>

<p>Don't confuse this with <code><a href="#Die">icepool.Die()</a></code>:</p>

<ul>
<li><code><a href="#Die">icepool.Die</a>([6])</code>: A <code><a href="#Die">Die</a></code> that always rolls the integer 6.</li>
<li><code><a href="#d">icepool.d</a>(6)</code>: A d6.</li>
</ul>
</div>


                </section>
                <section id="d">
                            <input id="d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@cache</div>

        <span class="def">def</span>
        <span class="name">d</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="d-14"><a href="#d-14"><span class="linenos">14</span></a><span class="nd">@cache</span>
</span><span id="d-15"><a href="#d-15"><span class="linenos">15</span></a><span class="k">def</span> <span class="nf">standard</span><span class="p">(</span><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="d-16"><a href="#d-16"><span class="linenos">16</span></a>    <span class="sd">&quot;&quot;&quot;A standard die.</span>
</span><span id="d-17"><a href="#d-17"><span class="linenos">17</span></a>
</span><span id="d-18"><a href="#d-18"><span class="linenos">18</span></a><span class="sd">    Specifically, the outcomes are `int`s from `1` to `sides` inclusive,</span>
</span><span id="d-19"><a href="#d-19"><span class="linenos">19</span></a><span class="sd">    with quantity 1 each.</span>
</span><span id="d-20"><a href="#d-20"><span class="linenos">20</span></a>
</span><span id="d-21"><a href="#d-21"><span class="linenos">21</span></a><span class="sd">    Don&#39;t confuse this with `icepool.Die()`:</span>
</span><span id="d-22"><a href="#d-22"><span class="linenos">22</span></a>
</span><span id="d-23"><a href="#d-23"><span class="linenos">23</span></a><span class="sd">    * `icepool.Die([6])`: A `Die` that always rolls the integer 6.</span>
</span><span id="d-24"><a href="#d-24"><span class="linenos">24</span></a><span class="sd">    * `icepool.d(6)`: A d6.</span>
</span><span id="d-25"><a href="#d-25"><span class="linenos">25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="d-26"><a href="#d-26"><span class="linenos">26</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sides</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="d-27"><a href="#d-27"><span class="linenos">27</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Argument to standard() must be an int.&#39;</span><span class="p">)</span>
</span><span id="d-28"><a href="#d-28"><span class="linenos">28</span></a>    <span class="k">elif</span> <span class="n">sides</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="d-29"><a href="#d-29"><span class="linenos">29</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Standard die must have at least one side.&#39;</span><span class="p">)</span>
</span><span id="d-30"><a href="#d-30"><span class="linenos">30</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sides</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A standard die.</p>

<p>Specifically, the outcomes are <code>int</code>s from <code>1</code> to <code>sides</code> inclusive,
with quantity 1 each.</p>

<p>Don't confuse this with <code><a href="#Die">icepool.Die()</a></code>:</p>

<ul>
<li><code><a href="#Die">icepool.Die</a>([6])</code>: A <code><a href="#Die">Die</a></code> that always rolls the integer 6.</li>
<li><code><a href="#d">icepool.d</a>(6)</code>: A d6.</li>
</ul>
</div>


                </section>
                <section id="bernoulli">
                            <input id="bernoulli-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bernoulli</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="bernoulli-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bernoulli"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bernoulli-52"><a href="#bernoulli-52"><span class="linenos">52</span></a><span class="k">def</span> <span class="nf">bernoulli</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="bernoulli-53"><a href="#bernoulli-53"><span class="linenos">53</span></a>    <span class="sd">&quot;&quot;&quot;A `Die` that rolls `True` with probability `n / d`, and `False` otherwise.</span>
</span><span id="bernoulli-54"><a href="#bernoulli-54"><span class="linenos">54</span></a>
</span><span id="bernoulli-55"><a href="#bernoulli-55"><span class="linenos">55</span></a><span class="sd">    If `n == 0` or `n == d` the result will have only one outcome.</span>
</span><span id="bernoulli-56"><a href="#bernoulli-56"><span class="linenos">56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="bernoulli-57"><a href="#bernoulli-57"><span class="linenos">57</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="bernoulli-58"><a href="#bernoulli-58"><span class="linenos">58</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">d</span><span class="p">:</span>
</span><span id="bernoulli-59"><a href="#bernoulli-59"><span class="linenos">59</span></a>        <span class="n">data</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span> <span class="o">-</span> <span class="n">n</span>
</span><span id="bernoulli-60"><a href="#bernoulli-60"><span class="linenos">60</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="bernoulli-61"><a href="#bernoulli-61"><span class="linenos">61</span></a>        <span class="n">data</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="bernoulli-62"><a href="#bernoulli-62"><span class="linenos">62</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Die">Die</a></code> that rolls <code>True</code> with probability <code>n / d</code>, and <code>False</code> otherwise.</p>

<p>If <code>n == 0</code> or <code>n == d</code> the result will have only one outcome.</p>
</div>


                </section>
                <section id="coin">
                            <input id="coin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">coin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="coin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#coin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="coin-52"><a href="#coin-52"><span class="linenos">52</span></a><span class="k">def</span> <span class="nf">bernoulli</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="coin-53"><a href="#coin-53"><span class="linenos">53</span></a>    <span class="sd">&quot;&quot;&quot;A `Die` that rolls `True` with probability `n / d`, and `False` otherwise.</span>
</span><span id="coin-54"><a href="#coin-54"><span class="linenos">54</span></a>
</span><span id="coin-55"><a href="#coin-55"><span class="linenos">55</span></a><span class="sd">    If `n == 0` or `n == d` the result will have only one outcome.</span>
</span><span id="coin-56"><a href="#coin-56"><span class="linenos">56</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="coin-57"><a href="#coin-57"><span class="linenos">57</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="coin-58"><a href="#coin-58"><span class="linenos">58</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">d</span><span class="p">:</span>
</span><span id="coin-59"><a href="#coin-59"><span class="linenos">59</span></a>        <span class="n">data</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span> <span class="o">-</span> <span class="n">n</span>
</span><span id="coin-60"><a href="#coin-60"><span class="linenos">60</span></a>    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="coin-61"><a href="#coin-61"><span class="linenos">61</span></a>        <span class="n">data</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="coin-62"><a href="#coin-62"><span class="linenos">62</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Die">Die</a></code> that rolls <code>True</code> with probability <code>n / d</code>, and <code>False</code> otherwise.</p>

<p>If <code>n == 0</code> or <code>n == d</code> the result will have only one outcome.</p>
</div>


                </section>
                <section id="one_hot">
                            <input id="one_hot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">one_hot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="one_hot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#one_hot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="one_hot-68"><a href="#one_hot-68"><span class="linenos">68</span></a><span class="k">def</span> <span class="nf">one_hot</span><span class="p">(</span><span class="n">sides</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span id="one_hot-69"><a href="#one_hot-69"><span class="linenos">69</span></a>    <span class="sd">&quot;&quot;&quot;A `Die` with tuple outcomes with one element set to `True` uniformly at random and the rest `False`.</span>
</span><span id="one_hot-70"><a href="#one_hot-70"><span class="linenos">70</span></a>
</span><span id="one_hot-71"><a href="#one_hot-71"><span class="linenos">71</span></a><span class="sd">    This is an easy (if expensive) way of representing how many dice in a pool</span>
</span><span id="one_hot-72"><a href="#one_hot-72"><span class="linenos">72</span></a><span class="sd">    rolled each number. For example, the outcomes of `10 @ one_hot(6)` are</span>
</span><span id="one_hot-73"><a href="#one_hot-73"><span class="linenos">73</span></a><span class="sd">    the `(ones, twos, threes, fours, fives, sixes)` rolled in 10d6.</span>
</span><span id="one_hot-74"><a href="#one_hot-74"><span class="linenos">74</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="one_hot-75"><a href="#one_hot-75"><span class="linenos">75</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="one_hot-76"><a href="#one_hot-76"><span class="linenos">76</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sides</span><span class="p">):</span>
</span><span id="one_hot-77"><a href="#one_hot-77"><span class="linenos">77</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="n">sides</span>
</span><span id="one_hot-78"><a href="#one_hot-78"><span class="linenos">78</span></a>        <span class="n">outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="one_hot-79"><a href="#one_hot-79"><span class="linenos">79</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="one_hot-80"><a href="#one_hot-80"><span class="linenos">80</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Die">Die</a></code> with tuple outcomes with one element set to <code>True</code> uniformly at random and the rest <code>False</code>.</p>

<p>This is an easy (if expensive) way of representing how many dice in a pool
rolled each number. For example, the outcomes of <code>10 @ one_hot(6)</code> are
the <code>(ones, twos, threes, fours, fives, sixes)</code> rolled in 10d6.</p>
</div>


                </section>
                <section id="Die">
                            <input id="Die-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Die</span><wbr>(<span class="base">abc.ABC</span>, <span class="base">typing.Mapping[typing.Any, int]</span>):

                <label class="view-source-button" for="Die-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die-45"><a href="#Die-45"><span class="linenos">  45</span></a><span class="k">class</span> <span class="nc">Die</span><span class="p">(</span><span class="n">Population</span><span class="p">):</span>
</span><span id="Die-46"><a href="#Die-46"><span class="linenos">  46</span></a>    <span class="sd">&quot;&quot;&quot;Sampling with replacement. Quantities represent weights.</span>
</span><span id="Die-47"><a href="#Die-47"><span class="linenos">  47</span></a>
</span><span id="Die-48"><a href="#Die-48"><span class="linenos">  48</span></a><span class="sd">    Dice are immutable. Methods do not modify the `Die` in-place;</span>
</span><span id="Die-49"><a href="#Die-49"><span class="linenos">  49</span></a><span class="sd">    rather they return a `Die` representing the result.</span>
</span><span id="Die-50"><a href="#Die-50"><span class="linenos">  50</span></a>
</span><span id="Die-51"><a href="#Die-51"><span class="linenos">  51</span></a><span class="sd">    It *is* (mostly) well-defined to have a `Die` with zero-quantity outcomes.</span>
</span><span id="Die-52"><a href="#Die-52"><span class="linenos">  52</span></a><span class="sd">    These can be useful in a few cases, such as:</span>
</span><span id="Die-53"><a href="#Die-53"><span class="linenos">  53</span></a>
</span><span id="Die-54"><a href="#Die-54"><span class="linenos">  54</span></a><span class="sd">    * `OutcomeCountEvaluator` will iterate through zero-quantity outcomes,</span>
</span><span id="Die-55"><a href="#Die-55"><span class="linenos">  55</span></a><span class="sd">        rather than possibly skipping that outcome. (Though in most cases it&#39;s</span>
</span><span id="Die-56"><a href="#Die-56"><span class="linenos">  56</span></a><span class="sd">        better to use `OutcomeCountEvaluator.alignment()`.)</span>
</span><span id="Die-57"><a href="#Die-57"><span class="linenos">  57</span></a><span class="sd">    * `icepool.align()` and the like are convenient for making dice share the</span>
</span><span id="Die-58"><a href="#Die-58"><span class="linenos">  58</span></a><span class="sd">        same set of outcomes.</span>
</span><span id="Die-59"><a href="#Die-59"><span class="linenos">  59</span></a>
</span><span id="Die-60"><a href="#Die-60"><span class="linenos">  60</span></a><span class="sd">    However, zero-quantity outcomes have a computational cost like any other</span>
</span><span id="Die-61"><a href="#Die-61"><span class="linenos">  61</span></a><span class="sd">    outcome. Unless you have a specific use case in mind, it&#39;s best to leave</span>
</span><span id="Die-62"><a href="#Die-62"><span class="linenos">  62</span></a><span class="sd">    them out.</span>
</span><span id="Die-63"><a href="#Die-63"><span class="linenos">  63</span></a>
</span><span id="Die-64"><a href="#Die-64"><span class="linenos">  64</span></a><span class="sd">    Most operators and methods will not introduce zero-quantity outcomes if</span>
</span><span id="Die-65"><a href="#Die-65"><span class="linenos">  65</span></a><span class="sd">    their arguments do not have any; nor remove zero-quantity outcomes.</span>
</span><span id="Die-66"><a href="#Die-66"><span class="linenos">  66</span></a>
</span><span id="Die-67"><a href="#Die-67"><span class="linenos">  67</span></a><span class="sd">    It&#39;s also possible to have &quot;empty&quot; dice with no outcomes at all,</span>
</span><span id="Die-68"><a href="#Die-68"><span class="linenos">  68</span></a><span class="sd">    though these have little use other than being sentinel values.</span>
</span><span id="Die-69"><a href="#Die-69"><span class="linenos">  69</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Die-70"><a href="#Die-70"><span class="linenos">  70</span></a>
</span><span id="Die-71"><a href="#Die-71"><span class="linenos">  71</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="n">Counts</span>
</span><span id="Die-72"><a href="#Die-72"><span class="linenos">  72</span></a>
</span><span id="Die-73"><a href="#Die-73"><span class="linenos">  73</span></a>    <span class="k">def</span> <span class="nf">_new_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="Die-74"><a href="#Die-74"><span class="linenos">  74</span></a>        <span class="k">return</span> <span class="n">Die</span>
</span><span id="Die-75"><a href="#Die-75"><span class="linenos">  75</span></a>
</span><span id="Die-76"><a href="#Die-76"><span class="linenos">  76</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Die-77"><a href="#Die-77"><span class="linenos">  77</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">,</span>
</span><span id="Die-78"><a href="#Die-78"><span class="linenos">  78</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-79"><a href="#Die-79"><span class="linenos">  79</span></a>                <span class="o">*</span><span class="p">,</span>
</span><span id="Die-80"><a href="#Die-80"><span class="linenos">  80</span></a>                <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-81"><a href="#Die-81"><span class="linenos">  81</span></a>                <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-82"><a href="#Die-82"><span class="linenos">  82</span></a>        <span class="sd">&quot;&quot;&quot;Constructor for a `Die`.</span>
</span><span id="Die-83"><a href="#Die-83"><span class="linenos">  83</span></a>
</span><span id="Die-84"><a href="#Die-84"><span class="linenos">  84</span></a><span class="sd">        Don&#39;t confuse this with `d()`:</span>
</span><span id="Die-85"><a href="#Die-85"><span class="linenos">  85</span></a>
</span><span id="Die-86"><a href="#Die-86"><span class="linenos">  86</span></a><span class="sd">        * `Die([6])`: A `Die` that always rolls the `int` 6.</span>
</span><span id="Die-87"><a href="#Die-87"><span class="linenos">  87</span></a><span class="sd">        * `d(6)`: A d6.</span>
</span><span id="Die-88"><a href="#Die-88"><span class="linenos">  88</span></a>
</span><span id="Die-89"><a href="#Die-89"><span class="linenos">  89</span></a><span class="sd">        Also, don&#39;t confuse this with `Pool()`:</span>
</span><span id="Die-90"><a href="#Die-90"><span class="linenos">  90</span></a>
</span><span id="Die-91"><a href="#Die-91"><span class="linenos">  91</span></a><span class="sd">        * `Die([1, 2, 3, 4, 5, 6])`: A d6.</span>
</span><span id="Die-92"><a href="#Die-92"><span class="linenos">  92</span></a><span class="sd">        * `Pool([1, 2, 3, 4, 5, 6])`: A `Pool` of six dice that always rolls one</span>
</span><span id="Die-93"><a href="#Die-93"><span class="linenos">  93</span></a><span class="sd">            of each number.</span>
</span><span id="Die-94"><a href="#Die-94"><span class="linenos">  94</span></a>
</span><span id="Die-95"><a href="#Die-95"><span class="linenos">  95</span></a><span class="sd">        Here are some different ways of constructing a d6:</span>
</span><span id="Die-96"><a href="#Die-96"><span class="linenos">  96</span></a>
</span><span id="Die-97"><a href="#Die-97"><span class="linenos">  97</span></a><span class="sd">        * Just import it: `from icepool import d6`</span>
</span><span id="Die-98"><a href="#Die-98"><span class="linenos">  98</span></a><span class="sd">        * Use the `d()` function: `icepool.d(6)`</span>
</span><span id="Die-99"><a href="#Die-99"><span class="linenos">  99</span></a><span class="sd">        * Use a d6 that you already have: `Die(d6)` or `Die([d6])`</span>
</span><span id="Die-100"><a href="#Die-100"><span class="linenos"> 100</span></a><span class="sd">        * Mix a d3 and a d3+3: `Die([d3, d3+3])`</span>
</span><span id="Die-101"><a href="#Die-101"><span class="linenos"> 101</span></a><span class="sd">        * Use a dict: `Die({1:1, 2:1, 3:1, 4:1, 5:1, 6:1})`</span>
</span><span id="Die-102"><a href="#Die-102"><span class="linenos"> 102</span></a><span class="sd">        * Give the faces as a sequence: `Die([1, 2, 3, 4, 5, 6])`</span>
</span><span id="Die-103"><a href="#Die-103"><span class="linenos"> 103</span></a>
</span><span id="Die-104"><a href="#Die-104"><span class="linenos"> 104</span></a><span class="sd">        All quantities must be non-negative, though they can be zero.</span>
</span><span id="Die-105"><a href="#Die-105"><span class="linenos"> 105</span></a>
</span><span id="Die-106"><a href="#Die-106"><span class="linenos"> 106</span></a><span class="sd">        Several methods and functions foward **kwargs to this constructor.</span>
</span><span id="Die-107"><a href="#Die-107"><span class="linenos"> 107</span></a><span class="sd">        However, these only affect the construction of the returned or yielded</span>
</span><span id="Die-108"><a href="#Die-108"><span class="linenos"> 108</span></a><span class="sd">        dice. Any other implicit conversions of arguments or operands to dice</span>
</span><span id="Die-109"><a href="#Die-109"><span class="linenos"> 109</span></a><span class="sd">        will be done with the default keyword arguments.</span>
</span><span id="Die-110"><a href="#Die-110"><span class="linenos"> 110</span></a>
</span><span id="Die-111"><a href="#Die-111"><span class="linenos"> 111</span></a><span class="sd">        EXPERIMENTAL: Use `icepool.Again()` to roll the dice again, usually with</span>
</span><span id="Die-112"><a href="#Die-112"><span class="linenos"> 112</span></a><span class="sd">        some modification. For example,</span>
</span><span id="Die-113"><a href="#Die-113"><span class="linenos"> 113</span></a>
</span><span id="Die-114"><a href="#Die-114"><span class="linenos"> 114</span></a><span class="sd">        ```</span>
</span><span id="Die-115"><a href="#Die-115"><span class="linenos"> 115</span></a><span class="sd">        Die([1, 2, 3, 4, 5, 6 + Again()])</span>
</span><span id="Die-116"><a href="#Die-116"><span class="linenos"> 116</span></a><span class="sd">        ```</span>
</span><span id="Die-117"><a href="#Die-117"><span class="linenos"> 117</span></a>
</span><span id="Die-118"><a href="#Die-118"><span class="linenos"> 118</span></a><span class="sd">        would be an exploding d6. Use the `again_depth` parameter to control</span>
</span><span id="Die-119"><a href="#Die-119"><span class="linenos"> 119</span></a><span class="sd">        the maximum depth. `again_depth` does not apply to `Reroll`.</span>
</span><span id="Die-120"><a href="#Die-120"><span class="linenos"> 120</span></a>
</span><span id="Die-121"><a href="#Die-121"><span class="linenos"> 121</span></a><span class="sd">        If the roll reaches the maximum depth, the `again_end` is used instead</span>
</span><span id="Die-122"><a href="#Die-122"><span class="linenos"> 122</span></a><span class="sd">        of rolling again. Options for `again_end` include:</span>
</span><span id="Die-123"><a href="#Die-123"><span class="linenos"> 123</span></a>
</span><span id="Die-124"><a href="#Die-124"><span class="linenos"> 124</span></a><span class="sd">        * No value (`None`), which will attempt to determine a zero value from</span>
</span><span id="Die-125"><a href="#Die-125"><span class="linenos"> 125</span></a><span class="sd">            the outcomes that don&#39;t involve `Again`.</span>
</span><span id="Die-126"><a href="#Die-126"><span class="linenos"> 126</span></a><span class="sd">        * A single outcome, or a `Die`.</span>
</span><span id="Die-127"><a href="#Die-127"><span class="linenos"> 127</span></a><span class="sd">        * `Reroll`, which will reroll any end roll involving `Again`.</span>
</span><span id="Die-128"><a href="#Die-128"><span class="linenos"> 128</span></a><span class="sd">        * You could also consider some sort of placeholder value such as</span>
</span><span id="Die-129"><a href="#Die-129"><span class="linenos"> 129</span></a><span class="sd">            `math.inf`.</span>
</span><span id="Die-130"><a href="#Die-130"><span class="linenos"> 130</span></a>
</span><span id="Die-131"><a href="#Die-131"><span class="linenos"> 131</span></a><span class="sd">        Denominator: For a flat set of outcomes, the denominator is just the</span>
</span><span id="Die-132"><a href="#Die-132"><span class="linenos"> 132</span></a><span class="sd">        sum of the corresponding quantities. If the outcomes themselves have</span>
</span><span id="Die-133"><a href="#Die-133"><span class="linenos"> 133</span></a><span class="sd">        secondary denominators, then the overall denominator is the primary</span>
</span><span id="Die-134"><a href="#Die-134"><span class="linenos"> 134</span></a><span class="sd">        denominator times the LCM of the outcome denominators.</span>
</span><span id="Die-135"><a href="#Die-135"><span class="linenos"> 135</span></a>
</span><span id="Die-136"><a href="#Die-136"><span class="linenos"> 136</span></a><span class="sd">        For example, `Die([d3, d4, d6])` has a final denominator of 36: 3 for</span>
</span><span id="Die-137"><a href="#Die-137"><span class="linenos"> 137</span></a><span class="sd">        the primary selection between the three secondary dice, times 12 for</span>
</span><span id="Die-138"><a href="#Die-138"><span class="linenos"> 138</span></a><span class="sd">        the LCM of 3, 4, and 6.</span>
</span><span id="Die-139"><a href="#Die-139"><span class="linenos"> 139</span></a>
</span><span id="Die-140"><a href="#Die-140"><span class="linenos"> 140</span></a><span class="sd">        Args:</span>
</span><span id="Die-141"><a href="#Die-141"><span class="linenos"> 141</span></a><span class="sd">            outcomes: The faces of the `Die`. This can be one of the following:</span>
</span><span id="Die-142"><a href="#Die-142"><span class="linenos"> 142</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Die-143"><a href="#Die-143"><span class="linenos"> 143</span></a><span class="sd">                * A sequence of outcomes. Each element will have the same total</span>
</span><span id="Die-144"><a href="#Die-144"><span class="linenos"> 144</span></a><span class="sd">                    quantity.</span>
</span><span id="Die-145"><a href="#Die-145"><span class="linenos"> 145</span></a>
</span><span id="Die-146"><a href="#Die-146"><span class="linenos"> 146</span></a><span class="sd">                Note that `Die` and `Deck` both count as `Mapping`s.</span>
</span><span id="Die-147"><a href="#Die-147"><span class="linenos"> 147</span></a><span class="sd">                Each outcome may be one of the following:</span>
</span><span id="Die-148"><a href="#Die-148"><span class="linenos"> 148</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Die-149"><a href="#Die-149"><span class="linenos"> 149</span></a><span class="sd">                    The outcomes of the `Mapping` will be &quot;flattened&quot; into the</span>
</span><span id="Die-150"><a href="#Die-150"><span class="linenos"> 150</span></a><span class="sd">                    result. This option will be taken in preference to treating</span>
</span><span id="Die-151"><a href="#Die-151"><span class="linenos"> 151</span></a><span class="sd">                    the `Mapping` itself as an outcome even if the `Mapping`</span>
</span><span id="Die-152"><a href="#Die-152"><span class="linenos"> 152</span></a><span class="sd">                    itself is hashable and totally orderable. This means that</span>
</span><span id="Die-153"><a href="#Die-153"><span class="linenos"> 153</span></a><span class="sd">                    `Die` and `Deck` will never be outcomes.</span>
</span><span id="Die-154"><a href="#Die-154"><span class="linenos"> 154</span></a><span class="sd">                * A tuple of outcomes. Operators on dice with tuple outcomes</span>
</span><span id="Die-155"><a href="#Die-155"><span class="linenos"> 155</span></a><span class="sd">                    are performed element-wise. See `Die.unary_op` and</span>
</span><span id="Die-156"><a href="#Die-156"><span class="linenos"> 156</span></a><span class="sd">                    `Die.binary_op` for details.</span>
</span><span id="Die-157"><a href="#Die-157"><span class="linenos"> 157</span></a>
</span><span id="Die-158"><a href="#Die-158"><span class="linenos"> 158</span></a><span class="sd">                    Any tuple elements that are `Mapping`s will expand the</span>
</span><span id="Die-159"><a href="#Die-159"><span class="linenos"> 159</span></a><span class="sd">                    tuple according to their independent joint distribution.</span>
</span><span id="Die-160"><a href="#Die-160"><span class="linenos"> 160</span></a><span class="sd">                    For example, `(d6, d6)` will expand to 36 ordered tuples</span>
</span><span id="Die-161"><a href="#Die-161"><span class="linenos"> 161</span></a><span class="sd">                    with quantity 1 each. Use this carefully since it may create a</span>
</span><span id="Die-162"><a href="#Die-162"><span class="linenos"> 162</span></a><span class="sd">                    large number of outcomes.</span>
</span><span id="Die-163"><a href="#Die-163"><span class="linenos"> 163</span></a><span class="sd">                * `str` or `bytes`, which will be treated as a single outcome.</span>
</span><span id="Die-164"><a href="#Die-164"><span class="linenos"> 164</span></a><span class="sd">                * Any other sequence. Each element will be weighted equally.</span>
</span><span id="Die-165"><a href="#Die-165"><span class="linenos"> 165</span></a><span class="sd">                * `icepool.Reroll`, which will drop itself</span>
</span><span id="Die-166"><a href="#Die-166"><span class="linenos"> 166</span></a><span class="sd">                    and the corresponding element of `times` from consideration.</span>
</span><span id="Die-167"><a href="#Die-167"><span class="linenos"> 167</span></a><span class="sd">                    If inside a tuple, the tuple will be dropped.</span>
</span><span id="Die-168"><a href="#Die-168"><span class="linenos"> 168</span></a><span class="sd">                * Anything else will be treated as a single outcome.</span>
</span><span id="Die-169"><a href="#Die-169"><span class="linenos"> 169</span></a><span class="sd">                    Each outcome must be hashable, and the</span>
</span><span id="Die-170"><a href="#Die-170"><span class="linenos"> 170</span></a><span class="sd">                    set of outcomes must be totally orderable (after expansion).</span>
</span><span id="Die-171"><a href="#Die-171"><span class="linenos"> 171</span></a><span class="sd">                    The same outcome can appear multiple times, in which case</span>
</span><span id="Die-172"><a href="#Die-172"><span class="linenos"> 172</span></a><span class="sd">                    the corresponding quantities will be accumulated.</span>
</span><span id="Die-173"><a href="#Die-173"><span class="linenos"> 173</span></a><span class="sd">            times: Multiplies the quantity of each element of `outcomes`.</span>
</span><span id="Die-174"><a href="#Die-174"><span class="linenos"> 174</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Die-175"><a href="#Die-175"><span class="linenos"> 175</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Die-176"><a href="#Die-176"><span class="linenos"> 176</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Die-177"><a href="#Die-177"><span class="linenos"> 177</span></a><span class="sd">        Raises:</span>
</span><span id="Die-178"><a href="#Die-178"><span class="linenos"> 178</span></a><span class="sd">            ValueError: `None` is not a valid outcome for a `Die`.</span>
</span><span id="Die-179"><a href="#Die-179"><span class="linenos"> 179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-180"><a href="#Die-180"><span class="linenos"> 180</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die-181"><a href="#Die-181"><span class="linenos"> 181</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die-182"><a href="#Die-182"><span class="linenos"> 182</span></a>                <span class="k">return</span> <span class="n">outcomes</span>
</span><span id="Die-183"><a href="#Die-183"><span class="linenos"> 183</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-184"><a href="#Die-184"><span class="linenos"> 184</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="n">outcomes</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Die-185"><a href="#Die-185"><span class="linenos"> 185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-186"><a href="#Die-186"><span class="linenos"> 186</span></a>            <span class="c1"># Check for Again.</span>
</span><span id="Die-187"><a href="#Die-187"><span class="linenos"> 187</span></a>            <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-188"><a href="#Die-188"><span class="linenos"> 188</span></a>                <span class="k">if</span> <span class="n">again_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-189"><a href="#Die-189"><span class="linenos"> 189</span></a>                    <span class="c1"># Create a test die with `Again`s removed,</span>
</span><span id="Die-190"><a href="#Die-190"><span class="linenos"> 190</span></a>                    <span class="c1"># then find the zero.</span>
</span><span id="Die-191"><a href="#Die-191"><span class="linenos"> 191</span></a>                    <span class="n">test</span> <span class="o">=</span> <span class="n">Die</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span>
</span><span id="Die-192"><a href="#Die-192"><span class="linenos"> 192</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="Die-193"><a href="#Die-193"><span class="linenos"> 193</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">)</span>
</span><span id="Die-194"><a href="#Die-194"><span class="linenos"> 194</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-195"><a href="#Die-195"><span class="linenos"> 195</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-196"><a href="#Die-196"><span class="linenos"> 196</span></a>                            <span class="s1">&#39;If all outcomes contain Again, an explicit again_end must be provided.&#39;</span>
</span><span id="Die-197"><a href="#Die-197"><span class="linenos"> 197</span></a>                        <span class="p">)</span>
</span><span id="Die-198"><a href="#Die-198"><span class="linenos"> 198</span></a>                    <span class="n">again_end</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
</span><span id="Die-199"><a href="#Die-199"><span class="linenos"> 199</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die-200"><a href="#Die-200"><span class="linenos"> 200</span></a>                    <span class="n">again_end</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-201"><a href="#Die-201"><span class="linenos"> 201</span></a>                    <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">again_end</span><span class="p">):</span>
</span><span id="Die-202"><a href="#Die-202"><span class="linenos"> 202</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-203"><a href="#Die-203"><span class="linenos"> 203</span></a>                            <span class="s1">&#39;again_end cannot itself contain Again.&#39;</span><span class="p">)</span>
</span><span id="Die-204"><a href="#Die-204"><span class="linenos"> 204</span></a>                <span class="k">if</span> <span class="n">again_depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-205"><a href="#Die-205"><span class="linenos"> 205</span></a>                    <span class="c1"># Base case.</span>
</span><span id="Die-206"><a href="#Die-206"><span class="linenos"> 206</span></a>                    <span class="n">outcomes</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">sub_agains</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-207"><a href="#Die-207"><span class="linenos"> 207</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die-208"><a href="#Die-208"><span class="linenos"> 208</span></a>                    <span class="n">tail</span> <span class="o">=</span> <span class="n">Die</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span>
</span><span id="Die-209"><a href="#Die-209"><span class="linenos"> 209</span></a>                               <span class="n">times</span><span class="p">,</span>
</span><span id="Die-210"><a href="#Die-210"><span class="linenos"> 210</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-211"><a href="#Die-211"><span class="linenos"> 211</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-212"><a href="#Die-212"><span class="linenos"> 212</span></a>                    <span class="n">outcomes</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">sub_agains</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>
</span><span id="Die-213"><a href="#Die-213"><span class="linenos"> 213</span></a>
</span><span id="Die-214"><a href="#Die-214"><span class="linenos"> 214</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die-215"><a href="#Die-215"><span class="linenos"> 215</span></a>
</span><span id="Die-216"><a href="#Die-216"><span class="linenos"> 216</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Die-217"><a href="#Die-217"><span class="linenos"> 217</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die-218"><a href="#Die-218"><span class="linenos"> 218</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die-219"><a href="#Die-219"><span class="linenos"> 219</span></a>
</span><span id="Die-220"><a href="#Die-220"><span class="linenos"> 220</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Population</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Die-221"><a href="#Die-221"><span class="linenos"> 221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_die</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die-222"><a href="#Die-222"><span class="linenos"> 222</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die-223"><a href="#Die-223"><span class="linenos"> 223</span></a>
</span><span id="Die-224"><a href="#Die-224"><span class="linenos"> 224</span></a>    <span class="k">def</span> <span class="nf">unary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-225"><a href="#Die-225"><span class="linenos"> 225</span></a>        <span class="sd">&quot;&quot;&quot;Performs the unary operation on the outcomes.</span>
</span><span id="Die-226"><a href="#Die-226"><span class="linenos"> 226</span></a>
</span><span id="Die-227"><a href="#Die-227"><span class="linenos"> 227</span></a><span class="sd">        Operations on tuples are performed elementwise recursively. If you need</span>
</span><span id="Die-228"><a href="#Die-228"><span class="linenos"> 228</span></a><span class="sd">        some other specific behavior, use your own outcome class, or use `sub()`</span>
</span><span id="Die-229"><a href="#Die-229"><span class="linenos"> 229</span></a><span class="sd">        rather than an operator.</span>
</span><span id="Die-230"><a href="#Die-230"><span class="linenos"> 230</span></a>
</span><span id="Die-231"><a href="#Die-231"><span class="linenos"> 231</span></a><span class="sd">        This is used for the standard unary operators</span>
</span><span id="Die-232"><a href="#Die-232"><span class="linenos"> 232</span></a><span class="sd">        `-, +, abs, ~, round, trunc, floor, ceil`</span>
</span><span id="Die-233"><a href="#Die-233"><span class="linenos"> 233</span></a><span class="sd">        as well as the additional methods</span>
</span><span id="Die-234"><a href="#Die-234"><span class="linenos"> 234</span></a><span class="sd">        `zero, bool`.</span>
</span><span id="Die-235"><a href="#Die-235"><span class="linenos"> 235</span></a>
</span><span id="Die-236"><a href="#Die-236"><span class="linenos"> 236</span></a><span class="sd">        This is NOT used for the `[]` operator; when used directly, this is</span>
</span><span id="Die-237"><a href="#Die-237"><span class="linenos"> 237</span></a><span class="sd">        interpreted as a `Mapping` operation and returns the count corresponding</span>
</span><span id="Die-238"><a href="#Die-238"><span class="linenos"> 238</span></a><span class="sd">        to a given outcome. See `marginals()` for applying the `[]` operator to</span>
</span><span id="Die-239"><a href="#Die-239"><span class="linenos"> 239</span></a><span class="sd">        outcomes.</span>
</span><span id="Die-240"><a href="#Die-240"><span class="linenos"> 240</span></a>
</span><span id="Die-241"><a href="#Die-241"><span class="linenos"> 241</span></a><span class="sd">        Returns:</span>
</span><span id="Die-242"><a href="#Die-242"><span class="linenos"> 242</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die-243"><a href="#Die-243"><span class="linenos"> 243</span></a>
</span><span id="Die-244"><a href="#Die-244"><span class="linenos"> 244</span></a><span class="sd">        Raises:</span>
</span><span id="Die-245"><a href="#Die-245"><span class="linenos"> 245</span></a><span class="sd">            ValueError: If tuples are of mismatched length.</span>
</span><span id="Die-246"><a href="#Die-246"><span class="linenos"> 246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-247"><a href="#Die-247"><span class="linenos"> 247</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die-248"><a href="#Die-248"><span class="linenos"> 248</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-249"><a href="#Die-249"><span class="linenos"> 249</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">unary_elementwise</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Die-250"><a href="#Die-250"><span class="linenos"> 250</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die-251"><a href="#Die-251"><span class="linenos"> 251</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-252"><a href="#Die-252"><span class="linenos"> 252</span></a>
</span><span id="Die-253"><a href="#Die-253"><span class="linenos"> 253</span></a>    <span class="k">def</span> <span class="nf">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-254"><a href="#Die-254"><span class="linenos"> 254</span></a>        <span class="sd">&quot;&quot;&quot;Performs the operation on pairs of outcomes.</span>
</span><span id="Die-255"><a href="#Die-255"><span class="linenos"> 255</span></a>
</span><span id="Die-256"><a href="#Die-256"><span class="linenos"> 256</span></a><span class="sd">        Operations on tuples are performed elementwise recursively. If you need</span>
</span><span id="Die-257"><a href="#Die-257"><span class="linenos"> 257</span></a><span class="sd">        some other specific behavior, use your own outcome class, or use `sub()`</span>
</span><span id="Die-258"><a href="#Die-258"><span class="linenos"> 258</span></a><span class="sd">        rather than an operator.</span>
</span><span id="Die-259"><a href="#Die-259"><span class="linenos"> 259</span></a>
</span><span id="Die-260"><a href="#Die-260"><span class="linenos"> 260</span></a><span class="sd">        By the time this is called, the other operand has already been</span>
</span><span id="Die-261"><a href="#Die-261"><span class="linenos"> 261</span></a><span class="sd">        converted to a `Die`.</span>
</span><span id="Die-262"><a href="#Die-262"><span class="linenos"> 262</span></a>
</span><span id="Die-263"><a href="#Die-263"><span class="linenos"> 263</span></a><span class="sd">        This is used for the standard binary operators</span>
</span><span id="Die-264"><a href="#Die-264"><span class="linenos"> 264</span></a><span class="sd">        `+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^`.</span>
</span><span id="Die-265"><a href="#Die-265"><span class="linenos"> 265</span></a><span class="sd">        Note that `*` multiplies outcomes directly;</span>
</span><span id="Die-266"><a href="#Die-266"><span class="linenos"> 266</span></a><span class="sd">        it is not the same as `@`, which rolls the right side multiple times,</span>
</span><span id="Die-267"><a href="#Die-267"><span class="linenos"> 267</span></a><span class="sd">        or `d()`, which creates a standard die.</span>
</span><span id="Die-268"><a href="#Die-268"><span class="linenos"> 268</span></a>
</span><span id="Die-269"><a href="#Die-269"><span class="linenos"> 269</span></a><span class="sd">        The comparators (`&lt;, &lt;=, &gt;=, &gt;, ==, !=, cmp`) use a linear algorithm</span>
</span><span id="Die-270"><a href="#Die-270"><span class="linenos"> 270</span></a><span class="sd">        using the fact that outcomes are totally ordered.</span>
</span><span id="Die-271"><a href="#Die-271"><span class="linenos"> 271</span></a>
</span><span id="Die-272"><a href="#Die-272"><span class="linenos"> 272</span></a><span class="sd">        `==` and `!=` additionally set the truth value of the `Die` according to</span>
</span><span id="Die-273"><a href="#Die-273"><span class="linenos"> 273</span></a><span class="sd">        whether the dice themselves are the same or not.</span>
</span><span id="Die-274"><a href="#Die-274"><span class="linenos"> 274</span></a>
</span><span id="Die-275"><a href="#Die-275"><span class="linenos"> 275</span></a><span class="sd">        The `@` operator does NOT use this method directly.</span>
</span><span id="Die-276"><a href="#Die-276"><span class="linenos"> 276</span></a><span class="sd">        It rolls the left `Die`, which must have integer outcomes,</span>
</span><span id="Die-277"><a href="#Die-277"><span class="linenos"> 277</span></a><span class="sd">        then rolls the right `Die` that many times and sums the outcomes.</span>
</span><span id="Die-278"><a href="#Die-278"><span class="linenos"> 278</span></a><span class="sd">        Only the sum is performed element-wise.</span>
</span><span id="Die-279"><a href="#Die-279"><span class="linenos"> 279</span></a>
</span><span id="Die-280"><a href="#Die-280"><span class="linenos"> 280</span></a><span class="sd">        Returns:</span>
</span><span id="Die-281"><a href="#Die-281"><span class="linenos"> 281</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die-282"><a href="#Die-282"><span class="linenos"> 282</span></a>
</span><span id="Die-283"><a href="#Die-283"><span class="linenos"> 283</span></a><span class="sd">        Raises:</span>
</span><span id="Die-284"><a href="#Die-284"><span class="linenos"> 284</span></a><span class="sd">            ValueError: If tuples are of mismatched length within one of the</span>
</span><span id="Die-285"><a href="#Die-285"><span class="linenos"> 285</span></a><span class="sd">                dice or between the dice.</span>
</span><span id="Die-286"><a href="#Die-286"><span class="linenos"> 286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-287"><a href="#Die-287"><span class="linenos"> 287</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die-288"><a href="#Die-288"><span class="linenos"> 288</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span>
</span><span id="Die-289"><a href="#Die-289"><span class="linenos"> 289</span></a>             <span class="n">quantity_self</span><span class="p">),</span> <span class="p">(</span><span class="n">outcome_other</span><span class="p">,</span>
</span><span id="Die-290"><a href="#Die-290"><span class="linenos"> 290</span></a>                              <span class="n">quantity_other</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
</span><span id="Die-291"><a href="#Die-291"><span class="linenos"> 291</span></a>                                  <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="Die-292"><a href="#Die-292"><span class="linenos"> 292</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">binary_elementwise</span><span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span> <span class="n">outcome_other</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span>
</span><span id="Die-293"><a href="#Die-293"><span class="linenos"> 293</span></a>                                             <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Die-294"><a href="#Die-294"><span class="linenos"> 294</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity_self</span> <span class="o">*</span> <span class="n">quantity_other</span>
</span><span id="Die-295"><a href="#Die-295"><span class="linenos"> 295</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-296"><a href="#Die-296"><span class="linenos"> 296</span></a>
</span><span id="Die-297"><a href="#Die-297"><span class="linenos"> 297</span></a>    <span class="c1"># Basic access.</span>
</span><span id="Die-298"><a href="#Die-298"><span class="linenos"> 298</span></a>
</span><span id="Die-299"><a href="#Die-299"><span class="linenos"> 299</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Die-300"><a href="#Die-300"><span class="linenos"> 300</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Die-301"><a href="#Die-301"><span class="linenos"> 301</span></a>
</span><span id="Die-302"><a href="#Die-302"><span class="linenos"> 302</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Die-303"><a href="#Die-303"><span class="linenos"> 303</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Die-304"><a href="#Die-304"><span class="linenos"> 304</span></a>
</span><span id="Die-305"><a href="#Die-305"><span class="linenos"> 305</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">:</span>
</span><span id="Die-306"><a href="#Die-306"><span class="linenos"> 306</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-307"><a href="#Die-307"><span class="linenos"> 307</span></a>
</span><span id="Die-308"><a href="#Die-308"><span class="linenos"> 308</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-309"><a href="#Die-309"><span class="linenos"> 309</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Die-310"><a href="#Die-310"><span class="linenos"> 310</span></a>
</span><span id="Die-311"><a href="#Die-311"><span class="linenos"> 311</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
</span><span id="Die-312"><a href="#Die-312"><span class="linenos"> 312</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Die-313"><a href="#Die-313"><span class="linenos"> 313</span></a>
</span><span id="Die-314"><a href="#Die-314"><span class="linenos"> 314</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-315"><a href="#Die-315"><span class="linenos"> 315</span></a>        <span class="sd">&quot;&quot;&quot;The number of outcomes. &quot;&quot;&quot;</span>
</span><span id="Die-316"><a href="#Die-316"><span class="linenos"> 316</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Die-317"><a href="#Die-317"><span class="linenos"> 317</span></a>
</span><span id="Die-318"><a href="#Die-318"><span class="linenos"> 318</span></a>    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Die-319"><a href="#Die-319"><span class="linenos"> 319</span></a>        <span class="k">return</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Die-320"><a href="#Die-320"><span class="linenos"> 320</span></a>
</span><span id="Die-321"><a href="#Die-321"><span class="linenos"> 321</span></a>    <span class="c1"># Quantity management.</span>
</span><span id="Die-322"><a href="#Die-322"><span class="linenos"> 322</span></a>
</span><span id="Die-323"><a href="#Die-323"><span class="linenos"> 323</span></a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-324"><a href="#Die-324"><span class="linenos"> 324</span></a>        <span class="sd">&quot;&quot;&quot;Divides all quantities by their greatest common denominator. &quot;&quot;&quot;</span>
</span><span id="Die-325"><a href="#Die-325"><span class="linenos"> 325</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">simplify</span><span class="p">())</span>
</span><span id="Die-326"><a href="#Die-326"><span class="linenos"> 326</span></a>
</span><span id="Die-327"><a href="#Die-327"><span class="linenos"> 327</span></a>    <span class="c1"># Rerolls and other outcome management.</span>
</span><span id="Die-328"><a href="#Die-328"><span class="linenos"> 328</span></a>
</span><span id="Die-329"><a href="#Die-329"><span class="linenos"> 329</span></a>    <span class="k">def</span> <span class="nf">reroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-330"><a href="#Die-330"><span class="linenos"> 330</span></a>               <span class="n">outcomes</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Container</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-331"><a href="#Die-331"><span class="linenos"> 331</span></a>               <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-332"><a href="#Die-332"><span class="linenos"> 332</span></a>               <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-333"><a href="#Die-333"><span class="linenos"> 333</span></a>               <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-334"><a href="#Die-334"><span class="linenos"> 334</span></a>        <span class="sd">&quot;&quot;&quot;Rerolls the given outcomes.</span>
</span><span id="Die-335"><a href="#Die-335"><span class="linenos"> 335</span></a>
</span><span id="Die-336"><a href="#Die-336"><span class="linenos"> 336</span></a><span class="sd">        Args:</span>
</span><span id="Die-337"><a href="#Die-337"><span class="linenos"> 337</span></a><span class="sd">            outcomes: Selects which outcomes to reroll. Options:</span>
</span><span id="Die-338"><a href="#Die-338"><span class="linenos"> 338</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-339"><a href="#Die-339"><span class="linenos"> 339</span></a><span class="sd">                    should be rerolled.</span>
</span><span id="Die-340"><a href="#Die-340"><span class="linenos"> 340</span></a><span class="sd">                * A container of outcomes to reroll.</span>
</span><span id="Die-341"><a href="#Die-341"><span class="linenos"> 341</span></a><span class="sd">                * If not provided, the min outcome will be rerolled.</span>
</span><span id="Die-342"><a href="#Die-342"><span class="linenos"> 342</span></a><span class="sd">            *extra_args: These will be supplied to `outcomes` as extra</span>
</span><span id="Die-343"><a href="#Die-343"><span class="linenos"> 343</span></a><span class="sd">                positional arguments after the outcome argument(s).</span>
</span><span id="Die-344"><a href="#Die-344"><span class="linenos"> 344</span></a><span class="sd">                `extra_args` can only be supplied if `outcomes` is callable.</span>
</span><span id="Die-345"><a href="#Die-345"><span class="linenos"> 345</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die-346"><a href="#Die-346"><span class="linenos"> 346</span></a><span class="sd">                If omitted, rerolls an unlimited number of times.</span>
</span><span id="Die-347"><a href="#Die-347"><span class="linenos"> 347</span></a><span class="sd">            star: If set to `True` or 1, outcomes will be unpacked as</span>
</span><span id="Die-348"><a href="#Die-348"><span class="linenos"> 348</span></a><span class="sd">                `*outcome` before giving it to the `outcomes` function.</span>
</span><span id="Die-349"><a href="#Die-349"><span class="linenos"> 349</span></a><span class="sd">                If `outcomes` is not a callable, this has no effect.</span>
</span><span id="Die-350"><a href="#Die-350"><span class="linenos"> 350</span></a>
</span><span id="Die-351"><a href="#Die-351"><span class="linenos"> 351</span></a><span class="sd">        Returns:</span>
</span><span id="Die-352"><a href="#Die-352"><span class="linenos"> 352</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die-353"><a href="#Die-353"><span class="linenos"> 353</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die-354"><a href="#Die-354"><span class="linenos"> 354</span></a>
</span><span id="Die-355"><a href="#Die-355"><span class="linenos"> 355</span></a><span class="sd">        Raises:</span>
</span><span id="Die-356"><a href="#Die-356"><span class="linenos"> 356</span></a><span class="sd">            ValueError: If `extra_args` are supplied with a non-callable `outcomes`.</span>
</span><span id="Die-357"><a href="#Die-357"><span class="linenos"> 357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-358"><a href="#Die-358"><span class="linenos"> 358</span></a>        <span class="k">if</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-359"><a href="#Die-359"><span class="linenos"> 359</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-360"><a href="#Die-360"><span class="linenos"> 360</span></a>                <span class="s1">&#39;Extra positional arguments are only valid if outcomes is callable.&#39;</span>
</span><span id="Die-361"><a href="#Die-361"><span class="linenos"> 361</span></a>            <span class="p">)</span>
</span><span id="Die-362"><a href="#Die-362"><span class="linenos"> 362</span></a>
</span><span id="Die-363"><a href="#Die-363"><span class="linenos"> 363</span></a>        <span class="k">if</span> <span class="n">outcomes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-364"><a href="#Die-364"><span class="linenos"> 364</span></a>            <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()}</span>
</span><span id="Die-365"><a href="#Die-365"><span class="linenos"> 365</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-366"><a href="#Die-366"><span class="linenos"> 366</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die-367"><a href="#Die-367"><span class="linenos"> 367</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-368"><a href="#Die-368"><span class="linenos"> 368</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-369"><a href="#Die-369"><span class="linenos"> 369</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die-370"><a href="#Die-370"><span class="linenos"> 370</span></a>                <span class="p">}</span>
</span><span id="Die-371"><a href="#Die-371"><span class="linenos"> 371</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-372"><a href="#Die-372"><span class="linenos"> 372</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-373"><a href="#Die-373"><span class="linenos"> 373</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-374"><a href="#Die-374"><span class="linenos"> 374</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die-375"><a href="#Die-375"><span class="linenos"> 375</span></a>                <span class="p">}</span>
</span><span id="Die-376"><a href="#Die-376"><span class="linenos"> 376</span></a>
</span><span id="Die-377"><a href="#Die-377"><span class="linenos"> 377</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-378"><a href="#Die-378"><span class="linenos"> 378</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-379"><a href="#Die-379"><span class="linenos"> 379</span></a>                <span class="n">outcome</span><span class="p">:</span> <span class="n">quantity</span>
</span><span id="Die-380"><a href="#Die-380"><span class="linenos"> 380</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-381"><a href="#Die-381"><span class="linenos"> 381</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outcomes</span>
</span><span id="Die-382"><a href="#Die-382"><span class="linenos"> 382</span></a>            <span class="p">}</span>
</span><span id="Die-383"><a href="#Die-383"><span class="linenos"> 383</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-384"><a href="#Die-384"><span class="linenos"> 384</span></a>            <span class="n">total_reroll_quantity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Die-385"><a href="#Die-385"><span class="linenos"> 385</span></a>                <span class="n">quantity</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-386"><a href="#Die-386"><span class="linenos"> 386</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">)</span>
</span><span id="Die-387"><a href="#Die-387"><span class="linenos"> 387</span></a>            <span class="n">rerollable_factor</span> <span class="o">=</span> <span class="n">total_reroll_quantity</span><span class="o">**</span><span class="n">depth</span>
</span><span id="Die-388"><a href="#Die-388"><span class="linenos"> 388</span></a>            <span class="n">stop_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="n">depth</span> <span class="o">+</span>
</span><span id="Die-389"><a href="#Die-389"><span class="linenos"> 389</span></a>                           <span class="n">total_reroll_quantity</span><span class="o">**</span><span class="n">depth</span><span class="p">)</span>
</span><span id="Die-390"><a href="#Die-390"><span class="linenos"> 390</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-391"><a href="#Die-391"><span class="linenos"> 391</span></a>                <span class="n">outcome</span><span class="p">:</span>
</span><span id="Die-392"><a href="#Die-392"><span class="linenos"> 392</span></a>                <span class="p">(</span><span class="n">rerollable_factor</span> <span class="o">*</span>
</span><span id="Die-393"><a href="#Die-393"><span class="linenos"> 393</span></a>                 <span class="n">quantity</span> <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span> <span class="k">else</span> <span class="n">stop_factor</span> <span class="o">*</span> <span class="n">quantity</span><span class="p">)</span>
</span><span id="Die-394"><a href="#Die-394"><span class="linenos"> 394</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die-395"><a href="#Die-395"><span class="linenos"> 395</span></a>            <span class="p">}</span>
</span><span id="Die-396"><a href="#Die-396"><span class="linenos"> 396</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-397"><a href="#Die-397"><span class="linenos"> 397</span></a>
</span><span id="Die-398"><a href="#Die-398"><span class="linenos"> 398</span></a>    <span class="k">def</span> <span class="nf">reroll_until</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-399"><a href="#Die-399"><span class="linenos"> 399</span></a>                     <span class="n">outcomes</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Container</span><span class="p">,</span>
</span><span id="Die-400"><a href="#Die-400"><span class="linenos"> 400</span></a>                     <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-401"><a href="#Die-401"><span class="linenos"> 401</span></a>                     <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-402"><a href="#Die-402"><span class="linenos"> 402</span></a>                     <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-403"><a href="#Die-403"><span class="linenos"> 403</span></a>        <span class="sd">&quot;&quot;&quot;Rerolls until getting one of the given outcomes.</span>
</span><span id="Die-404"><a href="#Die-404"><span class="linenos"> 404</span></a>
</span><span id="Die-405"><a href="#Die-405"><span class="linenos"> 405</span></a><span class="sd">        Essentially the complement of `reroll()`.</span>
</span><span id="Die-406"><a href="#Die-406"><span class="linenos"> 406</span></a>
</span><span id="Die-407"><a href="#Die-407"><span class="linenos"> 407</span></a><span class="sd">        Args:</span>
</span><span id="Die-408"><a href="#Die-408"><span class="linenos"> 408</span></a><span class="sd">            outcomes: Selects which outcomes to reroll until. Options:</span>
</span><span id="Die-409"><a href="#Die-409"><span class="linenos"> 409</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-410"><a href="#Die-410"><span class="linenos"> 410</span></a><span class="sd">                    should be accepted.</span>
</span><span id="Die-411"><a href="#Die-411"><span class="linenos"> 411</span></a><span class="sd">                * A container of outcomes to reroll until.</span>
</span><span id="Die-412"><a href="#Die-412"><span class="linenos"> 412</span></a><span class="sd">            *extra_args: These will be supplied to `outcomes` as extra</span>
</span><span id="Die-413"><a href="#Die-413"><span class="linenos"> 413</span></a><span class="sd">                positional arguments after the outcome argument(s).</span>
</span><span id="Die-414"><a href="#Die-414"><span class="linenos"> 414</span></a><span class="sd">                `extra_args` can only be supplied if `outcomes` is callable.</span>
</span><span id="Die-415"><a href="#Die-415"><span class="linenos"> 415</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die-416"><a href="#Die-416"><span class="linenos"> 416</span></a><span class="sd">                If omitted, rerolls an unlimited number of times.</span>
</span><span id="Die-417"><a href="#Die-417"><span class="linenos"> 417</span></a><span class="sd">            star: If set to `True` or 1, outcomes will be unpacked as</span>
</span><span id="Die-418"><a href="#Die-418"><span class="linenos"> 418</span></a><span class="sd">                `*outcome` before giving it to the `outcomes` function.</span>
</span><span id="Die-419"><a href="#Die-419"><span class="linenos"> 419</span></a><span class="sd">                If `outcomes` is not a callable, this has no effect.</span>
</span><span id="Die-420"><a href="#Die-420"><span class="linenos"> 420</span></a>
</span><span id="Die-421"><a href="#Die-421"><span class="linenos"> 421</span></a><span class="sd">        Returns:</span>
</span><span id="Die-422"><a href="#Die-422"><span class="linenos"> 422</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die-423"><a href="#Die-423"><span class="linenos"> 423</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die-424"><a href="#Die-424"><span class="linenos"> 424</span></a>
</span><span id="Die-425"><a href="#Die-425"><span class="linenos"> 425</span></a><span class="sd">        Raises:</span>
</span><span id="Die-426"><a href="#Die-426"><span class="linenos"> 426</span></a><span class="sd">            ValueError: If `extra_args` are supplied with a non-callable `outcomes`.</span>
</span><span id="Die-427"><a href="#Die-427"><span class="linenos"> 427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-428"><a href="#Die-428"><span class="linenos"> 428</span></a>        <span class="k">if</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-429"><a href="#Die-429"><span class="linenos"> 429</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-430"><a href="#Die-430"><span class="linenos"> 430</span></a>                <span class="s1">&#39;Extra positional arguments are only valid if outcomes is callable.&#39;</span>
</span><span id="Die-431"><a href="#Die-431"><span class="linenos"> 431</span></a>            <span class="p">)</span>
</span><span id="Die-432"><a href="#Die-432"><span class="linenos"> 432</span></a>
</span><span id="Die-433"><a href="#Die-433"><span class="linenos"> 433</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-434"><a href="#Die-434"><span class="linenos"> 434</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die-435"><a href="#Die-435"><span class="linenos"> 435</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-436"><a href="#Die-436"><span class="linenos"> 436</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-437"><a href="#Die-437"><span class="linenos"> 437</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die-438"><a href="#Die-438"><span class="linenos"> 438</span></a>                <span class="p">}</span>
</span><span id="Die-439"><a href="#Die-439"><span class="linenos"> 439</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-440"><a href="#Die-440"><span class="linenos"> 440</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-441"><a href="#Die-441"><span class="linenos"> 441</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-442"><a href="#Die-442"><span class="linenos"> 442</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die-443"><a href="#Die-443"><span class="linenos"> 443</span></a>                <span class="p">}</span>
</span><span id="Die-444"><a href="#Die-444"><span class="linenos"> 444</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-445"><a href="#Die-445"><span class="linenos"> 445</span></a>            <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-446"><a href="#Die-446"><span class="linenos"> 446</span></a>                <span class="n">not_outcome</span> <span class="k">for</span> <span class="n">not_outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-447"><a href="#Die-447"><span class="linenos"> 447</span></a>                <span class="k">if</span> <span class="n">not_outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outcomes</span>
</span><span id="Die-448"><a href="#Die-448"><span class="linenos"> 448</span></a>            <span class="p">}</span>
</span><span id="Die-449"><a href="#Die-449"><span class="linenos"> 449</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reroll</span><span class="p">(</span><span class="n">not_outcomes</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
</span><span id="Die-450"><a href="#Die-450"><span class="linenos"> 450</span></a>
</span><span id="Die-451"><a href="#Die-451"><span class="linenos"> 451</span></a>    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-452"><a href="#Die-452"><span class="linenos"> 452</span></a>        <span class="sd">&quot;&quot;&quot;Truncates the outcomes of this `Die` to the given range.</span>
</span><span id="Die-453"><a href="#Die-453"><span class="linenos"> 453</span></a>
</span><span id="Die-454"><a href="#Die-454"><span class="linenos"> 454</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die-455"><a href="#Die-455"><span class="linenos"> 455</span></a><span class="sd">        If one of the arguments is not provided, that side will not be truncated.</span>
</span><span id="Die-456"><a href="#Die-456"><span class="linenos"> 456</span></a>
</span><span id="Die-457"><a href="#Die-457"><span class="linenos"> 457</span></a><span class="sd">        This effectively rerolls outcomes outside the given range.</span>
</span><span id="Die-458"><a href="#Die-458"><span class="linenos"> 458</span></a><span class="sd">        If instead you want to replace those outcomes with the nearest endpoint,</span>
</span><span id="Die-459"><a href="#Die-459"><span class="linenos"> 459</span></a><span class="sd">        use `clip()`.</span>
</span><span id="Die-460"><a href="#Die-460"><span class="linenos"> 460</span></a>
</span><span id="Die-461"><a href="#Die-461"><span class="linenos"> 461</span></a><span class="sd">        Not to be confused with `trunc(die)`, which performs integer truncation</span>
</span><span id="Die-462"><a href="#Die-462"><span class="linenos"> 462</span></a><span class="sd">        on each outcome.</span>
</span><span id="Die-463"><a href="#Die-463"><span class="linenos"> 463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-464"><a href="#Die-464"><span class="linenos"> 464</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-465"><a href="#Die-465"><span class="linenos"> 465</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">min_outcome</span><span class="p">)</span>
</span><span id="Die-466"><a href="#Die-466"><span class="linenos"> 466</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-467"><a href="#Die-467"><span class="linenos"> 467</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-468"><a href="#Die-468"><span class="linenos"> 468</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-469"><a href="#Die-469"><span class="linenos"> 469</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">max_outcome</span><span class="p">)</span>
</span><span id="Die-470"><a href="#Die-470"><span class="linenos"> 470</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-471"><a href="#Die-471"><span class="linenos"> 471</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die-472"><a href="#Die-472"><span class="linenos"> 472</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]}</span>
</span><span id="Die-473"><a href="#Die-473"><span class="linenos"> 473</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-474"><a href="#Die-474"><span class="linenos"> 474</span></a>
</span><span id="Die-475"><a href="#Die-475"><span class="linenos"> 475</span></a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-476"><a href="#Die-476"><span class="linenos"> 476</span></a>        <span class="sd">&quot;&quot;&quot;Clips the outcomes of this `Die` to the given values.</span>
</span><span id="Die-477"><a href="#Die-477"><span class="linenos"> 477</span></a>
</span><span id="Die-478"><a href="#Die-478"><span class="linenos"> 478</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die-479"><a href="#Die-479"><span class="linenos"> 479</span></a><span class="sd">        If one of the arguments is not provided, that side will not be clipped.</span>
</span><span id="Die-480"><a href="#Die-480"><span class="linenos"> 480</span></a>
</span><span id="Die-481"><a href="#Die-481"><span class="linenos"> 481</span></a><span class="sd">        This is not the same as rerolling outcomes beyond this range;</span>
</span><span id="Die-482"><a href="#Die-482"><span class="linenos"> 482</span></a><span class="sd">        the outcome is simply adjusted to fit within the range.</span>
</span><span id="Die-483"><a href="#Die-483"><span class="linenos"> 483</span></a><span class="sd">        This will typically cause some quantity to bunch up at the endpoint.</span>
</span><span id="Die-484"><a href="#Die-484"><span class="linenos"> 484</span></a><span class="sd">        If you want to reroll outcomes beyond this range, use `truncate()`.</span>
</span><span id="Die-485"><a href="#Die-485"><span class="linenos"> 485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-486"><a href="#Die-486"><span class="linenos"> 486</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die-487"><a href="#Die-487"><span class="linenos"> 487</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-488"><a href="#Die-488"><span class="linenos"> 488</span></a>            <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&lt;=</span> <span class="n">min_outcome</span><span class="p">:</span>
</span><span id="Die-489"><a href="#Die-489"><span class="linenos"> 489</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">min_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die-490"><a href="#Die-490"><span class="linenos"> 490</span></a>            <span class="k">elif</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&gt;=</span> <span class="n">max_outcome</span><span class="p">:</span>
</span><span id="Die-491"><a href="#Die-491"><span class="linenos"> 491</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">max_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die-492"><a href="#Die-492"><span class="linenos"> 492</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-493"><a href="#Die-493"><span class="linenos"> 493</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die-494"><a href="#Die-494"><span class="linenos"> 494</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-495"><a href="#Die-495"><span class="linenos"> 495</span></a>
</span><span id="Die-496"><a href="#Die-496"><span class="linenos"> 496</span></a>    <span class="k">def</span> <span class="nf">set_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-497"><a href="#Die-497"><span class="linenos"> 497</span></a>                  <span class="n">min_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-498"><a href="#Die-498"><span class="linenos"> 498</span></a>                  <span class="n">max_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-499"><a href="#Die-499"><span class="linenos"> 499</span></a>        <span class="sd">&quot;&quot;&quot;Sets the outcomes of this `Die` to the given `int` range (inclusive).</span>
</span><span id="Die-500"><a href="#Die-500"><span class="linenos"> 500</span></a>
</span><span id="Die-501"><a href="#Die-501"><span class="linenos"> 501</span></a><span class="sd">        Args:</span>
</span><span id="Die-502"><a href="#Die-502"><span class="linenos"> 502</span></a><span class="sd">            min_outcome: The min outcome of the result.</span>
</span><span id="Die-503"><a href="#Die-503"><span class="linenos"> 503</span></a><span class="sd">                If omitted, the min outcome of this `Die` will be used.</span>
</span><span id="Die-504"><a href="#Die-504"><span class="linenos"> 504</span></a><span class="sd">            max_outcome: The max outcome of the result.</span>
</span><span id="Die-505"><a href="#Die-505"><span class="linenos"> 505</span></a><span class="sd">                If omitted, the max outcome of this `Die` will be used.</span>
</span><span id="Die-506"><a href="#Die-506"><span class="linenos"> 506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-507"><a href="#Die-507"><span class="linenos"> 507</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-508"><a href="#Die-508"><span class="linenos"> 508</span></a>            <span class="n">min_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="Die-509"><a href="#Die-509"><span class="linenos"> 509</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-510"><a href="#Die-510"><span class="linenos"> 510</span></a>            <span class="n">max_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Die-511"><a href="#Die-511"><span class="linenos"> 511</span></a>
</span><span id="Die-512"><a href="#Die-512"><span class="linenos"> 512</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="Die-513"><a href="#Die-513"><span class="linenos"> 513</span></a>
</span><span id="Die-514"><a href="#Die-514"><span class="linenos"> 514</span></a>    <span class="k">def</span> <span class="nf">set_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-515"><a href="#Die-515"><span class="linenos"> 515</span></a>        <span class="sd">&quot;&quot;&quot;Sets the set of outcomes to the argument.</span>
</span><span id="Die-516"><a href="#Die-516"><span class="linenos"> 516</span></a>
</span><span id="Die-517"><a href="#Die-517"><span class="linenos"> 517</span></a><span class="sd">        This may remove outcomes (if they are not present in the argument)</span>
</span><span id="Die-518"><a href="#Die-518"><span class="linenos"> 518</span></a><span class="sd">        and/or add zero-quantity outcomes (if they are not present in this `Die`).</span>
</span><span id="Die-519"><a href="#Die-519"><span class="linenos"> 519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-520"><a href="#Die-520"><span class="linenos"> 520</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">}</span>
</span><span id="Die-521"><a href="#Die-521"><span class="linenos"> 521</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-522"><a href="#Die-522"><span class="linenos"> 522</span></a>
</span><span id="Die-523"><a href="#Die-523"><span class="linenos"> 523</span></a>    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-524"><a href="#Die-524"><span class="linenos"> 524</span></a>        <span class="sd">&quot;&quot;&quot;Removes all zero-quantity outcomes. &quot;&quot;&quot;</span>
</span><span id="Die-525"><a href="#Die-525"><span class="linenos"> 525</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Die-526"><a href="#Die-526"><span class="linenos"> 526</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-527"><a href="#Die-527"><span class="linenos"> 527</span></a>
</span><span id="Die-528"><a href="#Die-528"><span class="linenos"> 528</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-529"><a href="#Die-529"><span class="linenos"> 529</span></a>    <span class="k">def</span> <span class="nf">_popped_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-530"><a href="#Die-530"><span class="linenos"> 530</span></a>        <span class="n">die</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_min</span><span class="p">())</span>
</span><span id="Die-531"><a href="#Die-531"><span class="linenos"> 531</span></a>        <span class="k">return</span> <span class="n">die</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die-532"><a href="#Die-532"><span class="linenos"> 532</span></a>
</span><span id="Die-533"><a href="#Die-533"><span class="linenos"> 533</span></a>    <span class="k">def</span> <span class="nf">_pop_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-534"><a href="#Die-534"><span class="linenos"> 534</span></a>        <span class="sd">&quot;&quot;&quot;A `Die` with the min outcome removed, and the quantity of the removed outcome.</span>
</span><span id="Die-535"><a href="#Die-535"><span class="linenos"> 535</span></a>
</span><span id="Die-536"><a href="#Die-536"><span class="linenos"> 536</span></a><span class="sd">        Raises:</span>
</span><span id="Die-537"><a href="#Die-537"><span class="linenos"> 537</span></a><span class="sd">            IndexError: If this `Die` has no outcome to pop.</span>
</span><span id="Die-538"><a href="#Die-538"><span class="linenos"> 538</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-539"><a href="#Die-539"><span class="linenos"> 539</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_min</span>
</span><span id="Die-540"><a href="#Die-540"><span class="linenos"> 540</span></a>
</span><span id="Die-541"><a href="#Die-541"><span class="linenos"> 541</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-542"><a href="#Die-542"><span class="linenos"> 542</span></a>    <span class="k">def</span> <span class="nf">_popped_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-543"><a href="#Die-543"><span class="linenos"> 543</span></a>        <span class="n">die</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_max</span><span class="p">())</span>
</span><span id="Die-544"><a href="#Die-544"><span class="linenos"> 544</span></a>        <span class="k">return</span> <span class="n">die</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Die-545"><a href="#Die-545"><span class="linenos"> 545</span></a>
</span><span id="Die-546"><a href="#Die-546"><span class="linenos"> 546</span></a>    <span class="k">def</span> <span class="nf">_pop_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Die-547"><a href="#Die-547"><span class="linenos"> 547</span></a>        <span class="sd">&quot;&quot;&quot;A `Die` with the max outcome removed, and the quantity of the removed outcome.</span>
</span><span id="Die-548"><a href="#Die-548"><span class="linenos"> 548</span></a>
</span><span id="Die-549"><a href="#Die-549"><span class="linenos"> 549</span></a><span class="sd">        Raises:</span>
</span><span id="Die-550"><a href="#Die-550"><span class="linenos"> 550</span></a><span class="sd">            IndexError: If this `Die` has no outcome to pop.</span>
</span><span id="Die-551"><a href="#Die-551"><span class="linenos"> 551</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-552"><a href="#Die-552"><span class="linenos"> 552</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_max</span>
</span><span id="Die-553"><a href="#Die-553"><span class="linenos"> 553</span></a>
</span><span id="Die-554"><a href="#Die-554"><span class="linenos"> 554</span></a>    <span class="c1"># Mixtures.</span>
</span><span id="Die-555"><a href="#Die-555"><span class="linenos"> 555</span></a>
</span><span id="Die-556"><a href="#Die-556"><span class="linenos"> 556</span></a>    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-557"><a href="#Die-557"><span class="linenos"> 557</span></a>            <span class="n">repl</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">,</span>
</span><span id="Die-558"><a href="#Die-558"><span class="linenos"> 558</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die-559"><a href="#Die-559"><span class="linenos"> 559</span></a>            <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-560"><a href="#Die-560"><span class="linenos"> 560</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Die-561"><a href="#Die-561"><span class="linenos"> 561</span></a>            <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-562"><a href="#Die-562"><span class="linenos"> 562</span></a>            <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-563"><a href="#Die-563"><span class="linenos"> 563</span></a>        <span class="sd">&quot;&quot;&quot;Changes outcomes of the `Die` to other outcomes.</span>
</span><span id="Die-564"><a href="#Die-564"><span class="linenos"> 564</span></a>
</span><span id="Die-565"><a href="#Die-565"><span class="linenos"> 565</span></a><span class="sd">        You can think of this as `sub`stituting outcomes of this `Die` for other</span>
</span><span id="Die-566"><a href="#Die-566"><span class="linenos"> 566</span></a><span class="sd">        outcomes or dice. Or, as executing a `sub`routine based on the roll of</span>
</span><span id="Die-567"><a href="#Die-567"><span class="linenos"> 567</span></a><span class="sd">        this `Die`.</span>
</span><span id="Die-568"><a href="#Die-568"><span class="linenos"> 568</span></a>
</span><span id="Die-569"><a href="#Die-569"><span class="linenos"> 569</span></a><span class="sd">        EXPERIMENTAL: `Again`, `again_depth`, and `again_end` can be used as the</span>
</span><span id="Die-570"><a href="#Die-570"><span class="linenos"> 570</span></a><span class="sd">        `Die()` constructor. It is not advised to use these with `repeat` other</span>
</span><span id="Die-571"><a href="#Die-571"><span class="linenos"> 571</span></a><span class="sd">        than 1.</span>
</span><span id="Die-572"><a href="#Die-572"><span class="linenos"> 572</span></a>
</span><span id="Die-573"><a href="#Die-573"><span class="linenos"> 573</span></a><span class="sd">        Args:</span>
</span><span id="Die-574"><a href="#Die-574"><span class="linenos"> 574</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Die-575"><a href="#Die-575"><span class="linenos"> 575</span></a><span class="sd">                * A callable returning a new outcome for each old outcome.</span>
</span><span id="Die-576"><a href="#Die-576"><span class="linenos"> 576</span></a><span class="sd">                * A map from old outcomes to new outcomes.</span>
</span><span id="Die-577"><a href="#Die-577"><span class="linenos"> 577</span></a><span class="sd">                    Unmapped old outcomes stay the same.</span>
</span><span id="Die-578"><a href="#Die-578"><span class="linenos"> 578</span></a><span class="sd">                The new outcomes may be dice rather than just single outcomes.</span>
</span><span id="Die-579"><a href="#Die-579"><span class="linenos"> 579</span></a><span class="sd">                The special value `icepool.Reroll` will reroll that old outcome.</span>
</span><span id="Die-580"><a href="#Die-580"><span class="linenos"> 580</span></a><span class="sd">            repeat: `sub()` will be repeated with the same argument on the</span>
</span><span id="Die-581"><a href="#Die-581"><span class="linenos"> 581</span></a><span class="sd">                result this many times.</span>
</span><span id="Die-582"><a href="#Die-582"><span class="linenos"> 582</span></a>
</span><span id="Die-583"><a href="#Die-583"><span class="linenos"> 583</span></a><span class="sd">                EXPERIMENTAL: If set to `None`, the result will be as if `sub()`</span>
</span><span id="Die-584"><a href="#Die-584"><span class="linenos"> 584</span></a><span class="sd">                    were repeated an infinite number of times. In this case, the</span>
</span><span id="Die-585"><a href="#Die-585"><span class="linenos"> 585</span></a><span class="sd">                    result will be in simplest form.</span>
</span><span id="Die-586"><a href="#Die-586"><span class="linenos"> 586</span></a><span class="sd">            star: If set to `True` or 1, outcomes of `self` will be unpacked as</span>
</span><span id="Die-587"><a href="#Die-587"><span class="linenos"> 587</span></a><span class="sd">                `*outcome` before giving it to the `repl` function. `extra_dice`</span>
</span><span id="Die-588"><a href="#Die-588"><span class="linenos"> 588</span></a><span class="sd">                are not unpacked. If `repl` is not a callable, this has no</span>
</span><span id="Die-589"><a href="#Die-589"><span class="linenos"> 589</span></a><span class="sd">                effect.</span>
</span><span id="Die-590"><a href="#Die-590"><span class="linenos"> 590</span></a><span class="sd">            again_depth: Forwarded to the final die constructor.</span>
</span><span id="Die-591"><a href="#Die-591"><span class="linenos"> 591</span></a><span class="sd">            again_end: Forwarded to the final die constructor.</span>
</span><span id="Die-592"><a href="#Die-592"><span class="linenos"> 592</span></a>
</span><span id="Die-593"><a href="#Die-593"><span class="linenos"> 593</span></a><span class="sd">        Returns:</span>
</span><span id="Die-594"><a href="#Die-594"><span class="linenos"> 594</span></a><span class="sd">            The `Die` after the modification.</span>
</span><span id="Die-595"><a href="#Die-595"><span class="linenos"> 595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-596"><a href="#Die-596"><span class="linenos"> 596</span></a>
</span><span id="Die-597"><a href="#Die-597"><span class="linenos"> 597</span></a>        <span class="k">if</span> <span class="n">repeat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-598"><a href="#Die-598"><span class="linenos"> 598</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die-599"><a href="#Die-599"><span class="linenos"> 599</span></a>
</span><span id="Die-600"><a href="#Die-600"><span class="linenos"> 600</span></a>        <span class="c1"># Convert to a single-argument function.</span>
</span><span id="Die-601"><a href="#Die-601"><span class="linenos"> 601</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">repl</span><span class="p">):</span>
</span><span id="Die-602"><a href="#Die-602"><span class="linenos"> 602</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die-603"><a href="#Die-603"><span class="linenos"> 603</span></a>
</span><span id="Die-604"><a href="#Die-604"><span class="linenos"> 604</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die-605"><a href="#Die-605"><span class="linenos"> 605</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Die-606"><a href="#Die-606"><span class="linenos"> 606</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-607"><a href="#Die-607"><span class="linenos"> 607</span></a>
</span><span id="Die-608"><a href="#Die-608"><span class="linenos"> 608</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die-609"><a href="#Die-609"><span class="linenos"> 609</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Die-610"><a href="#Die-610"><span class="linenos"> 610</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-611"><a href="#Die-611"><span class="linenos"> 611</span></a>            <span class="c1"># repl is a mapping.</span>
</span><span id="Die-612"><a href="#Die-612"><span class="linenos"> 612</span></a>            <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die-613"><a href="#Die-613"><span class="linenos"> 613</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">repl</span><span class="p">:</span>
</span><span id="Die-614"><a href="#Die-614"><span class="linenos"> 614</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Die-615"><a href="#Die-615"><span class="linenos"> 615</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die-616"><a href="#Die-616"><span class="linenos"> 616</span></a>                    <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Die-617"><a href="#Die-617"><span class="linenos"> 617</span></a>
</span><span id="Die-618"><a href="#Die-618"><span class="linenos"> 618</span></a>        <span class="k">if</span> <span class="n">repeat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-619"><a href="#Die-619"><span class="linenos"> 619</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Die-620"><a href="#Die-620"><span class="linenos"> 620</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat</span><span class="p">):</span>
</span><span id="Die-621"><a href="#Die-621"><span class="linenos"> 621</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">transition_function</span><span class="p">,</span>
</span><span id="Die-622"><a href="#Die-622"><span class="linenos"> 622</span></a>                                       <span class="n">result</span><span class="p">,</span>
</span><span id="Die-623"><a href="#Die-623"><span class="linenos"> 623</span></a>                                       <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die-624"><a href="#Die-624"><span class="linenos"> 624</span></a>                                       <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-625"><a href="#Die-625"><span class="linenos"> 625</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="Die-626"><a href="#Die-626"><span class="linenos"> 626</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-627"><a href="#Die-627"><span class="linenos"> 627</span></a>            <span class="c1"># Infinite repeat.</span>
</span><span id="Die-628"><a href="#Die-628"><span class="linenos"> 628</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">markov_chain</span><span class="o">.</span><span class="n">absorbing_markov_chain</span><span class="p">(</span>
</span><span id="Die-629"><a href="#Die-629"><span class="linenos"> 629</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">transition_function</span><span class="p">)</span>
</span><span id="Die-630"><a href="#Die-630"><span class="linenos"> 630</span></a>
</span><span id="Die-631"><a href="#Die-631"><span class="linenos"> 631</span></a>    <span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-632"><a href="#Die-632"><span class="linenos"> 632</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Container</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die-633"><a href="#Die-633"><span class="linenos"> 633</span></a>                <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die-634"><a href="#Die-634"><span class="linenos"> 634</span></a>                <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
</span><span id="Die-635"><a href="#Die-635"><span class="linenos"> 635</span></a>                <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Die-636"><a href="#Die-636"><span class="linenos"> 636</span></a>                <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-637"><a href="#Die-637"><span class="linenos"> 637</span></a>        <span class="sd">&quot;&quot;&quot;Causes outcomes to be rolled again and added to the total.</span>
</span><span id="Die-638"><a href="#Die-638"><span class="linenos"> 638</span></a>
</span><span id="Die-639"><a href="#Die-639"><span class="linenos"> 639</span></a><span class="sd">        Args:</span>
</span><span id="Die-640"><a href="#Die-640"><span class="linenos"> 640</span></a><span class="sd">            outcomes: Which outcomes to explode. Options:</span>
</span><span id="Die-641"><a href="#Die-641"><span class="linenos"> 641</span></a><span class="sd">                * An container of outcomes to explode.</span>
</span><span id="Die-642"><a href="#Die-642"><span class="linenos"> 642</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die-643"><a href="#Die-643"><span class="linenos"> 643</span></a><span class="sd">                    should be exploded.</span>
</span><span id="Die-644"><a href="#Die-644"><span class="linenos"> 644</span></a><span class="sd">                * If not supplied, the max outcome will explode.</span>
</span><span id="Die-645"><a href="#Die-645"><span class="linenos"> 645</span></a><span class="sd">            *extra_args: These will be supplied to `outcomes` as extra</span>
</span><span id="Die-646"><a href="#Die-646"><span class="linenos"> 646</span></a><span class="sd">                positional arguments after the outcome argument(s).</span>
</span><span id="Die-647"><a href="#Die-647"><span class="linenos"> 647</span></a><span class="sd">                `extra_args` can only be supplied if `outcomes` is callable.</span>
</span><span id="Die-648"><a href="#Die-648"><span class="linenos"> 648</span></a><span class="sd">            depth: The maximum number of additional dice to roll.</span>
</span><span id="Die-649"><a href="#Die-649"><span class="linenos"> 649</span></a><span class="sd">                If not supplied, a default value will be used.</span>
</span><span id="Die-650"><a href="#Die-650"><span class="linenos"> 650</span></a><span class="sd">            end: Once depth is reached, further explosions will be treated</span>
</span><span id="Die-651"><a href="#Die-651"><span class="linenos"> 651</span></a><span class="sd">                as this value. By default, a zero value will be used.</span>
</span><span id="Die-652"><a href="#Die-652"><span class="linenos"> 652</span></a><span class="sd">            star: If set to `True` or 1, outcomes will be unpacked as</span>
</span><span id="Die-653"><a href="#Die-653"><span class="linenos"> 653</span></a><span class="sd">                `*outcome` before giving it to the `outcomes` function.</span>
</span><span id="Die-654"><a href="#Die-654"><span class="linenos"> 654</span></a><span class="sd">                If `outcomes` is not a callable, this has no effect.</span>
</span><span id="Die-655"><a href="#Die-655"><span class="linenos"> 655</span></a>
</span><span id="Die-656"><a href="#Die-656"><span class="linenos"> 656</span></a><span class="sd">        Raises:</span>
</span><span id="Die-657"><a href="#Die-657"><span class="linenos"> 657</span></a><span class="sd">            ValueError: If `extra_args` are supplied with a non-callable `outcomes`.</span>
</span><span id="Die-658"><a href="#Die-658"><span class="linenos"> 658</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-659"><a href="#Die-659"><span class="linenos"> 659</span></a>        <span class="k">if</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-660"><a href="#Die-660"><span class="linenos"> 660</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-661"><a href="#Die-661"><span class="linenos"> 661</span></a>                <span class="s1">&#39;Extra positional arguments are only valid if outcomes is callable.&#39;</span>
</span><span id="Die-662"><a href="#Die-662"><span class="linenos"> 662</span></a>            <span class="p">)</span>
</span><span id="Die-663"><a href="#Die-663"><span class="linenos"> 663</span></a>
</span><span id="Die-664"><a href="#Die-664"><span class="linenos"> 664</span></a>        <span class="k">if</span> <span class="n">outcomes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die-665"><a href="#Die-665"><span class="linenos"> 665</span></a>            <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()}</span>
</span><span id="Die-666"><a href="#Die-666"><span class="linenos"> 666</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die-667"><a href="#Die-667"><span class="linenos"> 667</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die-668"><a href="#Die-668"><span class="linenos"> 668</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-669"><a href="#Die-669"><span class="linenos"> 669</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-670"><a href="#Die-670"><span class="linenos"> 670</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die-671"><a href="#Die-671"><span class="linenos"> 671</span></a>                <span class="p">}</span>
</span><span id="Die-672"><a href="#Die-672"><span class="linenos"> 672</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-673"><a href="#Die-673"><span class="linenos"> 673</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die-674"><a href="#Die-674"><span class="linenos"> 674</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die-675"><a href="#Die-675"><span class="linenos"> 675</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die-676"><a href="#Die-676"><span class="linenos"> 676</span></a>                <span class="p">}</span>
</span><span id="Die-677"><a href="#Die-677"><span class="linenos"> 677</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-678"><a href="#Die-678"><span class="linenos"> 678</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="Die-679"><a href="#Die-679"><span class="linenos"> 679</span></a>                <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die-680"><a href="#Die-680"><span class="linenos"> 680</span></a>
</span><span id="Die-681"><a href="#Die-681"><span class="linenos"> 681</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-682"><a href="#Die-682"><span class="linenos"> 682</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;depth cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Die-683"><a href="#Die-683"><span class="linenos"> 683</span></a>        <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-684"><a href="#Die-684"><span class="linenos"> 684</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die-685"><a href="#Die-685"><span class="linenos"> 685</span></a>
</span><span id="Die-686"><a href="#Die-686"><span class="linenos"> 686</span></a>        <span class="k">def</span> <span class="nf">sub_func</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die-687"><a href="#Die-687"><span class="linenos"> 687</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="Die-688"><a href="#Die-688"><span class="linenos"> 688</span></a>                <span class="k">return</span> <span class="n">outcome</span> <span class="o">+</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">()</span>
</span><span id="Die-689"><a href="#Die-689"><span class="linenos"> 689</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die-690"><a href="#Die-690"><span class="linenos"> 690</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Die-691"><a href="#Die-691"><span class="linenos"> 691</span></a>
</span><span id="Die-692"><a href="#Die-692"><span class="linenos"> 692</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">sub_func</span><span class="p">,</span> <span class="n">again_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">again_end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
</span><span id="Die-693"><a href="#Die-693"><span class="linenos"> 693</span></a>
</span><span id="Die-694"><a href="#Die-694"><span class="linenos"> 694</span></a>    <span class="k">def</span> <span class="nf">if_else</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-695"><a href="#Die-695"><span class="linenos"> 695</span></a>                <span class="n">outcome_if_true</span><span class="p">,</span>
</span><span id="Die-696"><a href="#Die-696"><span class="linenos"> 696</span></a>                <span class="n">outcome_if_false</span><span class="p">,</span>
</span><span id="Die-697"><a href="#Die-697"><span class="linenos"> 697</span></a>                <span class="o">/</span><span class="p">,</span>
</span><span id="Die-698"><a href="#Die-698"><span class="linenos"> 698</span></a>                <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-699"><a href="#Die-699"><span class="linenos"> 699</span></a>                <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-700"><a href="#Die-700"><span class="linenos"> 700</span></a>        <span class="sd">&quot;&quot;&quot;Ternary conditional operator.</span>
</span><span id="Die-701"><a href="#Die-701"><span class="linenos"> 701</span></a>
</span><span id="Die-702"><a href="#Die-702"><span class="linenos"> 702</span></a><span class="sd">        This replaces truthy outcomes with the first argument and falsy outcomes</span>
</span><span id="Die-703"><a href="#Die-703"><span class="linenos"> 703</span></a><span class="sd">        with the second argument.</span>
</span><span id="Die-704"><a href="#Die-704"><span class="linenos"> 704</span></a>
</span><span id="Die-705"><a href="#Die-705"><span class="linenos"> 705</span></a><span class="sd">        Args:</span>
</span><span id="Die-706"><a href="#Die-706"><span class="linenos"> 706</span></a><span class="sd">            again_depth: Forwarded to the final die constructor.</span>
</span><span id="Die-707"><a href="#Die-707"><span class="linenos"> 707</span></a><span class="sd">            again_end: Forwarded to the final die constructor.</span>
</span><span id="Die-708"><a href="#Die-708"><span class="linenos"> 708</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-709"><a href="#Die-709"><span class="linenos"> 709</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">outcome_if_true</span>
</span><span id="Die-710"><a href="#Die-710"><span class="linenos"> 710</span></a>                               <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="n">outcome_if_false</span><span class="p">,</span>
</span><span id="Die-711"><a href="#Die-711"><span class="linenos"> 711</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die-712"><a href="#Die-712"><span class="linenos"> 712</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die-713"><a href="#Die-713"><span class="linenos"> 713</span></a>
</span><span id="Die-714"><a href="#Die-714"><span class="linenos"> 714</span></a>    <span class="k">def</span> <span class="nf">is_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-715"><a href="#Die-715"><span class="linenos"> 715</span></a>        <span class="sd">&quot;&quot;&quot;A die that returns True iff the roll of the die is contained in the target.&quot;&quot;&quot;</span>
</span><span id="Die-716"><a href="#Die-716"><span class="linenos"> 716</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target</span><span class="p">)</span>
</span><span id="Die-717"><a href="#Die-717"><span class="linenos"> 717</span></a>
</span><span id="Die-718"><a href="#Die-718"><span class="linenos"> 718</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-719"><a href="#Die-719"><span class="linenos"> 719</span></a>        <span class="sd">&quot;&quot;&quot;Roll this dice a number of time and count how many are == the target.&quot;&quot;&quot;</span>
</span><span id="Die-720"><a href="#Die-720"><span class="linenos"> 720</span></a>        <span class="k">return</span> <span class="n">rolls</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span>
</span><span id="Die-721"><a href="#Die-721"><span class="linenos"> 721</span></a>
</span><span id="Die-722"><a href="#Die-722"><span class="linenos"> 722</span></a>    <span class="k">def</span> <span class="nf">count_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-723"><a href="#Die-723"><span class="linenos"> 723</span></a>        <span class="sd">&quot;&quot;&quot;Roll this dice a number of time and count how many are in the target.&quot;&quot;&quot;</span>
</span><span id="Die-724"><a href="#Die-724"><span class="linenos"> 724</span></a>        <span class="k">return</span> <span class="n">rolls</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_in</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span><span id="Die-725"><a href="#Die-725"><span class="linenos"> 725</span></a>
</span><span id="Die-726"><a href="#Die-726"><span class="linenos"> 726</span></a>    <span class="c1"># Pools and sums.</span>
</span><span id="Die-727"><a href="#Die-727"><span class="linenos"> 727</span></a>
</span><span id="Die-728"><a href="#Die-728"><span class="linenos"> 728</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-729"><a href="#Die-729"><span class="linenos"> 729</span></a>    <span class="k">def</span> <span class="nf">_sum_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s1">&#39;Die&#39;</span><span class="p">]:</span>
</span><span id="Die-730"><a href="#Die-730"><span class="linenos"> 730</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="Die-731"><a href="#Die-731"><span class="linenos"> 731</span></a>
</span><span id="Die-732"><a href="#Die-732"><span class="linenos"> 732</span></a>    <span class="k">def</span> <span class="nf">_sum_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-733"><a href="#Die-733"><span class="linenos"> 733</span></a>        <span class="sd">&quot;&quot;&quot;Roll this `Die` `rolls` times and sum the results.</span>
</span><span id="Die-734"><a href="#Die-734"><span class="linenos"> 734</span></a>
</span><span id="Die-735"><a href="#Die-735"><span class="linenos"> 735</span></a><span class="sd">        If `rolls` is negative, roll the `Die` `abs(rolls)` times and negate</span>
</span><span id="Die-736"><a href="#Die-736"><span class="linenos"> 736</span></a><span class="sd">        the result.</span>
</span><span id="Die-737"><a href="#Die-737"><span class="linenos"> 737</span></a>
</span><span id="Die-738"><a href="#Die-738"><span class="linenos"> 738</span></a><span class="sd">        If you instead want to replace tuple (or other sequence) outcomes with</span>
</span><span id="Die-739"><a href="#Die-739"><span class="linenos"> 739</span></a><span class="sd">        their sum, use `die.sub(sum)`.</span>
</span><span id="Die-740"><a href="#Die-740"><span class="linenos"> 740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-741"><a href="#Die-741"><span class="linenos"> 741</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_cache</span><span class="p">:</span>
</span><span id="Die-742"><a href="#Die-742"><span class="linenos"> 742</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_cache</span><span class="p">[</span><span class="n">rolls</span><span class="p">]</span>
</span><span id="Die-743"><a href="#Die-743"><span class="linenos"> 743</span></a>
</span><span id="Die-744"><a href="#Die-744"><span class="linenos"> 744</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-745"><a href="#Die-745"><span class="linenos"> 745</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_sum_all</span><span class="p">(</span><span class="o">-</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-746"><a href="#Die-746"><span class="linenos"> 746</span></a>        <span class="k">elif</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-747"><a href="#Die-747"><span class="linenos"> 747</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
</span><span id="Die-748"><a href="#Die-748"><span class="linenos"> 748</span></a>        <span class="k">elif</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die-749"><a href="#Die-749"><span class="linenos"> 749</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Die-750"><a href="#Die-750"><span class="linenos"> 750</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-751"><a href="#Die-751"><span class="linenos"> 751</span></a>            <span class="c1"># Binary split seems to perform much worse.</span>
</span><span id="Die-752"><a href="#Die-752"><span class="linenos"> 752</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sum_all</span><span class="p">(</span><span class="n">rolls</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Die-753"><a href="#Die-753"><span class="linenos"> 753</span></a>
</span><span id="Die-754"><a href="#Die-754"><span class="linenos"> 754</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sum_cache</span><span class="p">[</span><span class="n">rolls</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="Die-755"><a href="#Die-755"><span class="linenos"> 755</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Die-756"><a href="#Die-756"><span class="linenos"> 756</span></a>
</span><span id="Die-757"><a href="#Die-757"><span class="linenos"> 757</span></a>    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-758"><a href="#Die-758"><span class="linenos"> 758</span></a>        <span class="sd">&quot;&quot;&quot;Roll the left `Die`, then roll the right `Die` that many times and sum the outcomes.&quot;&quot;&quot;</span>
</span><span id="Die-759"><a href="#Die-759"><span class="linenos"> 759</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-760"><a href="#Die-760"><span class="linenos"> 760</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-761"><a href="#Die-761"><span class="linenos"> 761</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-762"><a href="#Die-762"><span class="linenos"> 762</span></a>
</span><span id="Die-763"><a href="#Die-763"><span class="linenos"> 763</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die-764"><a href="#Die-764"><span class="linenos"> 764</span></a>
</span><span id="Die-765"><a href="#Die-765"><span class="linenos"> 765</span></a>        <span class="n">max_abs_die_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()),</span>
</span><span id="Die-766"><a href="#Die-766"><span class="linenos"> 766</span></a>                                <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()))</span>
</span><span id="Die-767"><a href="#Die-767"><span class="linenos"> 767</span></a>        <span class="k">for</span> <span class="n">die_count</span><span class="p">,</span> <span class="n">die_count_quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-768"><a href="#Die-768"><span class="linenos"> 768</span></a>            <span class="n">factor</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="p">(</span><span class="n">max_abs_die_count</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">die_count</span><span class="p">))</span>
</span><span id="Die-769"><a href="#Die-769"><span class="linenos"> 769</span></a>            <span class="n">subresult</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">_sum_all</span><span class="p">(</span><span class="n">die_count</span><span class="p">)</span>
</span><span id="Die-770"><a href="#Die-770"><span class="linenos"> 770</span></a>            <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">subresult_quantity</span> <span class="ow">in</span> <span class="n">subresult</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-771"><a href="#Die-771"><span class="linenos"> 771</span></a>                <span class="n">data</span><span class="p">[</span>
</span><span id="Die-772"><a href="#Die-772"><span class="linenos"> 772</span></a>                    <span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">subresult_quantity</span> <span class="o">*</span> <span class="n">die_count_quantity</span> <span class="o">*</span> <span class="n">factor</span>
</span><span id="Die-773"><a href="#Die-773"><span class="linenos"> 773</span></a>
</span><span id="Die-774"><a href="#Die-774"><span class="linenos"> 774</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-775"><a href="#Die-775"><span class="linenos"> 775</span></a>
</span><span id="Die-776"><a href="#Die-776"><span class="linenos"> 776</span></a>    <span class="k">def</span> <span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-777"><a href="#Die-777"><span class="linenos"> 777</span></a>        <span class="sd">&quot;&quot;&quot;Roll the left `Die`, then roll the right `Die` that many times and sum the outcomes.&quot;&quot;&quot;</span>
</span><span id="Die-778"><a href="#Die-778"><span class="linenos"> 778</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-779"><a href="#Die-779"><span class="linenos"> 779</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-780"><a href="#Die-780"><span class="linenos"> 780</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-781"><a href="#Die-781"><span class="linenos"> 781</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Die-782"><a href="#Die-782"><span class="linenos"> 782</span></a>
</span><span id="Die-783"><a href="#Die-783"><span class="linenos"> 783</span></a>    <span class="k">def</span> <span class="nf">pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Pool&#39;</span><span class="p">:</span>
</span><span id="Die-784"><a href="#Die-784"><span class="linenos"> 784</span></a>        <span class="sd">&quot;&quot;&quot;Creates a `Pool` from this `Die`.</span>
</span><span id="Die-785"><a href="#Die-785"><span class="linenos"> 785</span></a>
</span><span id="Die-786"><a href="#Die-786"><span class="linenos"> 786</span></a><span class="sd">        You might subscript the pool immediately afterwards, e.g.</span>
</span><span id="Die-787"><a href="#Die-787"><span class="linenos"> 787</span></a><span class="sd">        `d6.pool(5)[-1, ..., 1]` takes the difference between the highest and</span>
</span><span id="Die-788"><a href="#Die-788"><span class="linenos"> 788</span></a><span class="sd">        lowest of 5d6.</span>
</span><span id="Die-789"><a href="#Die-789"><span class="linenos"> 789</span></a>
</span><span id="Die-790"><a href="#Die-790"><span class="linenos"> 790</span></a><span class="sd">        Args:</span>
</span><span id="Die-791"><a href="#Die-791"><span class="linenos"> 791</span></a><span class="sd">            rolls: The number of copies of this `Die` to put in the pool.</span>
</span><span id="Die-792"><a href="#Die-792"><span class="linenos"> 792</span></a><span class="sd">                Or, a sequence of one `int` per die acting as</span>
</span><span id="Die-793"><a href="#Die-793"><span class="linenos"> 793</span></a><span class="sd">                `sorted_roll_counts`. Note that `...` cannot be used in the</span>
</span><span id="Die-794"><a href="#Die-794"><span class="linenos"> 794</span></a><span class="sd">                argument to this method, as the argument determines the size of</span>
</span><span id="Die-795"><a href="#Die-795"><span class="linenos"> 795</span></a><span class="sd">                the pool.</span>
</span><span id="Die-796"><a href="#Die-796"><span class="linenos"> 796</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-797"><a href="#Die-797"><span class="linenos"> 797</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die-798"><a href="#Die-798"><span class="linenos"> 798</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">rolls</span><span class="p">})</span>
</span><span id="Die-799"><a href="#Die-799"><span class="linenos"> 799</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-800"><a href="#Die-800"><span class="linenos"> 800</span></a>            <span class="n">pool_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-801"><a href="#Die-801"><span class="linenos"> 801</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">pool_size</span><span class="p">})[</span><span class="n">rolls</span><span class="p">]</span>
</span><span id="Die-802"><a href="#Die-802"><span class="linenos"> 802</span></a>
</span><span id="Die-803"><a href="#Die-803"><span class="linenos"> 803</span></a>    <span class="k">def</span> <span class="nf">keep_lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-804"><a href="#Die-804"><span class="linenos"> 804</span></a>        <span class="sd">&quot;&quot;&quot;Roll several of this `Die` and sum the sorted results from the lowest.</span>
</span><span id="Die-805"><a href="#Die-805"><span class="linenos"> 805</span></a>
</span><span id="Die-806"><a href="#Die-806"><span class="linenos"> 806</span></a><span class="sd">        Args:</span>
</span><span id="Die-807"><a href="#Die-807"><span class="linenos"> 807</span></a><span class="sd">            rolls: The number of dice to roll. All dice will have the same</span>
</span><span id="Die-808"><a href="#Die-808"><span class="linenos"> 808</span></a><span class="sd">                outcomes as `self`.</span>
</span><span id="Die-809"><a href="#Die-809"><span class="linenos"> 809</span></a><span class="sd">            keep: The number of dice to keep.</span>
</span><span id="Die-810"><a href="#Die-810"><span class="linenos"> 810</span></a><span class="sd">            drop: If provided, this many lowest dice will be dropped before</span>
</span><span id="Die-811"><a href="#Die-811"><span class="linenos"> 811</span></a><span class="sd">                keeping.</span>
</span><span id="Die-812"><a href="#Die-812"><span class="linenos"> 812</span></a>
</span><span id="Die-813"><a href="#Die-813"><span class="linenos"> 813</span></a><span class="sd">        Returns:</span>
</span><span id="Die-814"><a href="#Die-814"><span class="linenos"> 814</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die-815"><a href="#Die-815"><span class="linenos"> 815</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-816"><a href="#Die-816"><span class="linenos"> 816</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">drop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-817"><a href="#Die-817"><span class="linenos"> 817</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_lowest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-818"><a href="#Die-818"><span class="linenos"> 818</span></a>
</span><span id="Die-819"><a href="#Die-819"><span class="linenos"> 819</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">drop</span> <span class="k">if</span> <span class="n">drop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Die-820"><a href="#Die-820"><span class="linenos"> 820</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="n">keep</span> <span class="o">+</span> <span class="p">(</span><span class="n">drop</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Die-821"><a href="#Die-821"><span class="linenos"> 821</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</span><span id="Die-822"><a href="#Die-822"><span class="linenos"> 822</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">sorted_roll_counts</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Die-823"><a href="#Die-823"><span class="linenos"> 823</span></a>
</span><span id="Die-824"><a href="#Die-824"><span class="linenos"> 824</span></a>    <span class="k">def</span> <span class="nf">_keep_lowest_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-825"><a href="#Die-825"><span class="linenos"> 825</span></a>        <span class="sd">&quot;&quot;&quot;Faster algorithm for keeping just the single lowest `Die`. &quot;&quot;&quot;</span>
</span><span id="Die-826"><a href="#Die-826"><span class="linenos"> 826</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-827"><a href="#Die-827"><span class="linenos"> 827</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
</span><span id="Die-828"><a href="#Die-828"><span class="linenos"> 828</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">from_cumulative_quantities</span><span class="p">(</span>
</span><span id="Die-829"><a href="#Die-829"><span class="linenos"> 829</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="n">rolls</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_ge</span><span class="p">()],</span>
</span><span id="Die-830"><a href="#Die-830"><span class="linenos"> 830</span></a>            <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Die-831"><a href="#Die-831"><span class="linenos"> 831</span></a>
</span><span id="Die-832"><a href="#Die-832"><span class="linenos"> 832</span></a>    <span class="k">def</span> <span class="nf">keep_highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die-833"><a href="#Die-833"><span class="linenos"> 833</span></a>                     <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die-834"><a href="#Die-834"><span class="linenos"> 834</span></a>                     <span class="o">/</span><span class="p">,</span>
</span><span id="Die-835"><a href="#Die-835"><span class="linenos"> 835</span></a>                     <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die-836"><a href="#Die-836"><span class="linenos"> 836</span></a>                     <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-837"><a href="#Die-837"><span class="linenos"> 837</span></a>        <span class="sd">&quot;&quot;&quot;Roll several of this `Die` and sum the sorted results from the highest.</span>
</span><span id="Die-838"><a href="#Die-838"><span class="linenos"> 838</span></a>
</span><span id="Die-839"><a href="#Die-839"><span class="linenos"> 839</span></a><span class="sd">        Args:</span>
</span><span id="Die-840"><a href="#Die-840"><span class="linenos"> 840</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die-841"><a href="#Die-841"><span class="linenos"> 841</span></a><span class="sd">            keep: The number of dice to keep.</span>
</span><span id="Die-842"><a href="#Die-842"><span class="linenos"> 842</span></a><span class="sd">            drop: If provided, this many highest dice will be dropped before</span>
</span><span id="Die-843"><a href="#Die-843"><span class="linenos"> 843</span></a><span class="sd">                keeping.</span>
</span><span id="Die-844"><a href="#Die-844"><span class="linenos"> 844</span></a>
</span><span id="Die-845"><a href="#Die-845"><span class="linenos"> 845</span></a><span class="sd">        Returns:</span>
</span><span id="Die-846"><a href="#Die-846"><span class="linenos"> 846</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die-847"><a href="#Die-847"><span class="linenos"> 847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-848"><a href="#Die-848"><span class="linenos"> 848</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">drop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-849"><a href="#Die-849"><span class="linenos"> 849</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_highest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die-850"><a href="#Die-850"><span class="linenos"> 850</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="p">(</span><span class="n">drop</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Die-851"><a href="#Die-851"><span class="linenos"> 851</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="o">-</span><span class="n">drop</span> <span class="k">if</span> <span class="n">drop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Die-852"><a href="#Die-852"><span class="linenos"> 852</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</span><span id="Die-853"><a href="#Die-853"><span class="linenos"> 853</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">sorted_roll_counts</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Die-854"><a href="#Die-854"><span class="linenos"> 854</span></a>
</span><span id="Die-855"><a href="#Die-855"><span class="linenos"> 855</span></a>    <span class="k">def</span> <span class="nf">_keep_highest_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-856"><a href="#Die-856"><span class="linenos"> 856</span></a>        <span class="sd">&quot;&quot;&quot;Faster algorithm for keeping just the single highest `Die`. &quot;&quot;&quot;</span>
</span><span id="Die-857"><a href="#Die-857"><span class="linenos"> 857</span></a>        <span class="k">if</span> <span class="n">rolls</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die-858"><a href="#Die-858"><span class="linenos"> 858</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span>
</span><span id="Die-859"><a href="#Die-859"><span class="linenos"> 859</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">from_cumulative_quantities</span><span class="p">(</span>
</span><span id="Die-860"><a href="#Die-860"><span class="linenos"> 860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="p">[</span><span class="n">x</span><span class="o">**</span><span class="n">rolls</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">()])</span>
</span><span id="Die-861"><a href="#Die-861"><span class="linenos"> 861</span></a>
</span><span id="Die-862"><a href="#Die-862"><span class="linenos"> 862</span></a>    <span class="c1"># Unary operators.</span>
</span><span id="Die-863"><a href="#Die-863"><span class="linenos"> 863</span></a>
</span><span id="Die-864"><a href="#Die-864"><span class="linenos"> 864</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-865"><a href="#Die-865"><span class="linenos"> 865</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">)</span>
</span><span id="Die-866"><a href="#Die-866"><span class="linenos"> 866</span></a>
</span><span id="Die-867"><a href="#Die-867"><span class="linenos"> 867</span></a>    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-868"><a href="#Die-868"><span class="linenos"> 868</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span>
</span><span id="Die-869"><a href="#Die-869"><span class="linenos"> 869</span></a>
</span><span id="Die-870"><a href="#Die-870"><span class="linenos"> 870</span></a>    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-871"><a href="#Die-871"><span class="linenos"> 871</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">invert</span><span class="p">)</span>
</span><span id="Die-872"><a href="#Die-872"><span class="linenos"> 872</span></a>
</span><span id="Die-873"><a href="#Die-873"><span class="linenos"> 873</span></a>    <span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-874"><a href="#Die-874"><span class="linenos"> 874</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</span><span id="Die-875"><a href="#Die-875"><span class="linenos"> 875</span></a>
</span><span id="Die-876"><a href="#Die-876"><span class="linenos"> 876</span></a>    <span class="fm">__abs__</span> <span class="o">=</span> <span class="nb">abs</span>
</span><span id="Die-877"><a href="#Die-877"><span class="linenos"> 877</span></a>
</span><span id="Die-878"><a href="#Die-878"><span class="linenos"> 878</span></a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-879"><a href="#Die-879"><span class="linenos"> 879</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>
</span><span id="Die-880"><a href="#Die-880"><span class="linenos"> 880</span></a>
</span><span id="Die-881"><a href="#Die-881"><span class="linenos"> 881</span></a>    <span class="fm">__round__</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="Die-882"><a href="#Die-882"><span class="linenos"> 882</span></a>
</span><span id="Die-883"><a href="#Die-883"><span class="linenos"> 883</span></a>    <span class="k">def</span> <span class="nf">trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-884"><a href="#Die-884"><span class="linenos"> 884</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">)</span>
</span><span id="Die-885"><a href="#Die-885"><span class="linenos"> 885</span></a>
</span><span id="Die-886"><a href="#Die-886"><span class="linenos"> 886</span></a>    <span class="n">__trunc__</span> <span class="o">=</span> <span class="n">trunc</span>
</span><span id="Die-887"><a href="#Die-887"><span class="linenos"> 887</span></a>
</span><span id="Die-888"><a href="#Die-888"><span class="linenos"> 888</span></a>    <span class="k">def</span> <span class="nf">floor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-889"><a href="#Die-889"><span class="linenos"> 889</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
</span><span id="Die-890"><a href="#Die-890"><span class="linenos"> 890</span></a>
</span><span id="Die-891"><a href="#Die-891"><span class="linenos"> 891</span></a>    <span class="n">__floor__</span> <span class="o">=</span> <span class="n">floor</span>
</span><span id="Die-892"><a href="#Die-892"><span class="linenos"> 892</span></a>
</span><span id="Die-893"><a href="#Die-893"><span class="linenos"> 893</span></a>    <span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-894"><a href="#Die-894"><span class="linenos"> 894</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">)</span>
</span><span id="Die-895"><a href="#Die-895"><span class="linenos"> 895</span></a>
</span><span id="Die-896"><a href="#Die-896"><span class="linenos"> 896</span></a>    <span class="n">__ceil__</span> <span class="o">=</span> <span class="n">ceil</span>
</span><span id="Die-897"><a href="#Die-897"><span class="linenos"> 897</span></a>
</span><span id="Die-898"><a href="#Die-898"><span class="linenos"> 898</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Die-899"><a href="#Die-899"><span class="linenos"> 899</span></a>    <span class="k">def</span> <span class="nf">_zero</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
</span><span id="Die-900"><a href="#Die-900"><span class="linenos"> 900</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)()</span>
</span><span id="Die-901"><a href="#Die-901"><span class="linenos"> 901</span></a>
</span><span id="Die-902"><a href="#Die-902"><span class="linenos"> 902</span></a>    <span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-903"><a href="#Die-903"><span class="linenos"> 903</span></a>        <span class="sd">&quot;&quot;&quot;Zeros all outcomes of this die.</span>
</span><span id="Die-904"><a href="#Die-904"><span class="linenos"> 904</span></a>
</span><span id="Die-905"><a href="#Die-905"><span class="linenos"> 905</span></a><span class="sd">        This is done by calling the constructor for each outcome&#39;s type with no</span>
</span><span id="Die-906"><a href="#Die-906"><span class="linenos"> 906</span></a><span class="sd">        arguments.</span>
</span><span id="Die-907"><a href="#Die-907"><span class="linenos"> 907</span></a>
</span><span id="Die-908"><a href="#Die-908"><span class="linenos"> 908</span></a><span class="sd">        The result will have the same denominator as this die.</span>
</span><span id="Die-909"><a href="#Die-909"><span class="linenos"> 909</span></a>
</span><span id="Die-910"><a href="#Die-910"><span class="linenos"> 910</span></a><span class="sd">        Raises:</span>
</span><span id="Die-911"><a href="#Die-911"><span class="linenos"> 911</span></a><span class="sd">            ValueError: If the zeros did not resolve to a single outcome.</span>
</span><span id="Die-912"><a href="#Die-912"><span class="linenos"> 912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-913"><a href="#Die-913"><span class="linenos"> 913</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_zero</span><span class="p">)</span>
</span><span id="Die-914"><a href="#Die-914"><span class="linenos"> 914</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die-915"><a href="#Die-915"><span class="linenos"> 915</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;zero() did not resolve to a single outcome.&#39;</span><span class="p">)</span>
</span><span id="Die-916"><a href="#Die-916"><span class="linenos"> 916</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Die-917"><a href="#Die-917"><span class="linenos"> 917</span></a>
</span><span id="Die-918"><a href="#Die-918"><span class="linenos"> 918</span></a>    <span class="k">def</span> <span class="nf">zero_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Die-919"><a href="#Die-919"><span class="linenos"> 919</span></a>        <span class="sd">&quot;&quot;&quot;A zero-outcome for this die.</span>
</span><span id="Die-920"><a href="#Die-920"><span class="linenos"> 920</span></a>
</span><span id="Die-921"><a href="#Die-921"><span class="linenos"> 921</span></a><span class="sd">        E.g. `0` for a `Die` whose outcomes are `int`s.</span>
</span><span id="Die-922"><a href="#Die-922"><span class="linenos"> 922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-923"><a href="#Die-923"><span class="linenos"> 923</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die-924"><a href="#Die-924"><span class="linenos"> 924</span></a>
</span><span id="Die-925"><a href="#Die-925"><span class="linenos"> 925</span></a>    <span class="c1"># Binary operators.</span>
</span><span id="Die-926"><a href="#Die-926"><span class="linenos"> 926</span></a>
</span><span id="Die-927"><a href="#Die-927"><span class="linenos"> 927</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-928"><a href="#Die-928"><span class="linenos"> 928</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-929"><a href="#Die-929"><span class="linenos"> 929</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-930"><a href="#Die-930"><span class="linenos"> 930</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-931"><a href="#Die-931"><span class="linenos"> 931</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="Die-932"><a href="#Die-932"><span class="linenos"> 932</span></a>
</span><span id="Die-933"><a href="#Die-933"><span class="linenos"> 933</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-934"><a href="#Die-934"><span class="linenos"> 934</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-935"><a href="#Die-935"><span class="linenos"> 935</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-936"><a href="#Die-936"><span class="linenos"> 936</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-937"><a href="#Die-937"><span class="linenos"> 937</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">)</span>
</span><span id="Die-938"><a href="#Die-938"><span class="linenos"> 938</span></a>
</span><span id="Die-939"><a href="#Die-939"><span class="linenos"> 939</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-940"><a href="#Die-940"><span class="linenos"> 940</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-941"><a href="#Die-941"><span class="linenos"> 941</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-942"><a href="#Die-942"><span class="linenos"> 942</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-943"><a href="#Die-943"><span class="linenos"> 943</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Die-944"><a href="#Die-944"><span class="linenos"> 944</span></a>
</span><span id="Die-945"><a href="#Die-945"><span class="linenos"> 945</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-946"><a href="#Die-946"><span class="linenos"> 946</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-947"><a href="#Die-947"><span class="linenos"> 947</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-948"><a href="#Die-948"><span class="linenos"> 948</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-949"><a href="#Die-949"><span class="linenos"> 949</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">)</span>
</span><span id="Die-950"><a href="#Die-950"><span class="linenos"> 950</span></a>
</span><span id="Die-951"><a href="#Die-951"><span class="linenos"> 951</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-952"><a href="#Die-952"><span class="linenos"> 952</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-953"><a href="#Die-953"><span class="linenos"> 953</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-954"><a href="#Die-954"><span class="linenos"> 954</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-955"><a href="#Die-955"><span class="linenos"> 955</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>
</span><span id="Die-956"><a href="#Die-956"><span class="linenos"> 956</span></a>
</span><span id="Die-957"><a href="#Die-957"><span class="linenos"> 957</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-958"><a href="#Die-958"><span class="linenos"> 958</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-959"><a href="#Die-959"><span class="linenos"> 959</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-960"><a href="#Die-960"><span class="linenos"> 960</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-961"><a href="#Die-961"><span class="linenos"> 961</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">)</span>
</span><span id="Die-962"><a href="#Die-962"><span class="linenos"> 962</span></a>
</span><span id="Die-963"><a href="#Die-963"><span class="linenos"> 963</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-964"><a href="#Die-964"><span class="linenos"> 964</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-965"><a href="#Die-965"><span class="linenos"> 965</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-966"><a href="#Die-966"><span class="linenos"> 966</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-967"><a href="#Die-967"><span class="linenos"> 967</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>
</span><span id="Die-968"><a href="#Die-968"><span class="linenos"> 968</span></a>
</span><span id="Die-969"><a href="#Die-969"><span class="linenos"> 969</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-970"><a href="#Die-970"><span class="linenos"> 970</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-971"><a href="#Die-971"><span class="linenos"> 971</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-972"><a href="#Die-972"><span class="linenos"> 972</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-973"><a href="#Die-973"><span class="linenos"> 973</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">)</span>
</span><span id="Die-974"><a href="#Die-974"><span class="linenos"> 974</span></a>
</span><span id="Die-975"><a href="#Die-975"><span class="linenos"> 975</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-976"><a href="#Die-976"><span class="linenos"> 976</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-977"><a href="#Die-977"><span class="linenos"> 977</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-978"><a href="#Die-978"><span class="linenos"> 978</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-979"><a href="#Die-979"><span class="linenos"> 979</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">)</span>
</span><span id="Die-980"><a href="#Die-980"><span class="linenos"> 980</span></a>
</span><span id="Die-981"><a href="#Die-981"><span class="linenos"> 981</span></a>    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-982"><a href="#Die-982"><span class="linenos"> 982</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-983"><a href="#Die-983"><span class="linenos"> 983</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-984"><a href="#Die-984"><span class="linenos"> 984</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-985"><a href="#Die-985"><span class="linenos"> 985</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">)</span>
</span><span id="Die-986"><a href="#Die-986"><span class="linenos"> 986</span></a>
</span><span id="Die-987"><a href="#Die-987"><span class="linenos"> 987</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-988"><a href="#Die-988"><span class="linenos"> 988</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-989"><a href="#Die-989"><span class="linenos"> 989</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-990"><a href="#Die-990"><span class="linenos"> 990</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-991"><a href="#Die-991"><span class="linenos"> 991</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="Die-992"><a href="#Die-992"><span class="linenos"> 992</span></a>
</span><span id="Die-993"><a href="#Die-993"><span class="linenos"> 993</span></a>    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-994"><a href="#Die-994"><span class="linenos"> 994</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-995"><a href="#Die-995"><span class="linenos"> 995</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-996"><a href="#Die-996"><span class="linenos"> 996</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-997"><a href="#Die-997"><span class="linenos"> 997</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">)</span>
</span><span id="Die-998"><a href="#Die-998"><span class="linenos"> 998</span></a>
</span><span id="Die-999"><a href="#Die-999"><span class="linenos"> 999</span></a>    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1000"><a href="#Die-1000"><span class="linenos">1000</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1001"><a href="#Die-1001"><span class="linenos">1001</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1002"><a href="#Die-1002"><span class="linenos">1002</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1003"><a href="#Die-1003"><span class="linenos">1003</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">)</span>
</span><span id="Die-1004"><a href="#Die-1004"><span class="linenos">1004</span></a>
</span><span id="Die-1005"><a href="#Die-1005"><span class="linenos">1005</span></a>    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1006"><a href="#Die-1006"><span class="linenos">1006</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1007"><a href="#Die-1007"><span class="linenos">1007</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1008"><a href="#Die-1008"><span class="linenos">1008</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1009"><a href="#Die-1009"><span class="linenos">1009</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">)</span>
</span><span id="Die-1010"><a href="#Die-1010"><span class="linenos">1010</span></a>
</span><span id="Die-1011"><a href="#Die-1011"><span class="linenos">1011</span></a>    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1012"><a href="#Die-1012"><span class="linenos">1012</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1013"><a href="#Die-1013"><span class="linenos">1013</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1014"><a href="#Die-1014"><span class="linenos">1014</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1015"><a href="#Die-1015"><span class="linenos">1015</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">)</span>
</span><span id="Die-1016"><a href="#Die-1016"><span class="linenos">1016</span></a>
</span><span id="Die-1017"><a href="#Die-1017"><span class="linenos">1017</span></a>    <span class="k">def</span> <span class="fm">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1018"><a href="#Die-1018"><span class="linenos">1018</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1019"><a href="#Die-1019"><span class="linenos">1019</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1020"><a href="#Die-1020"><span class="linenos">1020</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1021"><a href="#Die-1021"><span class="linenos">1021</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">)</span>
</span><span id="Die-1022"><a href="#Die-1022"><span class="linenos">1022</span></a>
</span><span id="Die-1023"><a href="#Die-1023"><span class="linenos">1023</span></a>    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1024"><a href="#Die-1024"><span class="linenos">1024</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1025"><a href="#Die-1025"><span class="linenos">1025</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1026"><a href="#Die-1026"><span class="linenos">1026</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1027"><a href="#Die-1027"><span class="linenos">1027</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">)</span>
</span><span id="Die-1028"><a href="#Die-1028"><span class="linenos">1028</span></a>
</span><span id="Die-1029"><a href="#Die-1029"><span class="linenos">1029</span></a>    <span class="k">def</span> <span class="fm">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1030"><a href="#Die-1030"><span class="linenos">1030</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1031"><a href="#Die-1031"><span class="linenos">1031</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1032"><a href="#Die-1032"><span class="linenos">1032</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1033"><a href="#Die-1033"><span class="linenos">1033</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">)</span>
</span><span id="Die-1034"><a href="#Die-1034"><span class="linenos">1034</span></a>
</span><span id="Die-1035"><a href="#Die-1035"><span class="linenos">1035</span></a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1036"><a href="#Die-1036"><span class="linenos">1036</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1037"><a href="#Die-1037"><span class="linenos">1037</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1038"><a href="#Die-1038"><span class="linenos">1038</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1039"><a href="#Die-1039"><span class="linenos">1039</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">)</span>
</span><span id="Die-1040"><a href="#Die-1040"><span class="linenos">1040</span></a>
</span><span id="Die-1041"><a href="#Die-1041"><span class="linenos">1041</span></a>    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1042"><a href="#Die-1042"><span class="linenos">1042</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1043"><a href="#Die-1043"><span class="linenos">1043</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1044"><a href="#Die-1044"><span class="linenos">1044</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1045"><a href="#Die-1045"><span class="linenos">1045</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">)</span>
</span><span id="Die-1046"><a href="#Die-1046"><span class="linenos">1046</span></a>
</span><span id="Die-1047"><a href="#Die-1047"><span class="linenos">1047</span></a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1048"><a href="#Die-1048"><span class="linenos">1048</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1049"><a href="#Die-1049"><span class="linenos">1049</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1050"><a href="#Die-1050"><span class="linenos">1050</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1051"><a href="#Die-1051"><span class="linenos">1051</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">)</span>
</span><span id="Die-1052"><a href="#Die-1052"><span class="linenos">1052</span></a>
</span><span id="Die-1053"><a href="#Die-1053"><span class="linenos">1053</span></a>    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1054"><a href="#Die-1054"><span class="linenos">1054</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1055"><a href="#Die-1055"><span class="linenos">1055</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1056"><a href="#Die-1056"><span class="linenos">1056</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1057"><a href="#Die-1057"><span class="linenos">1057</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">)</span>
</span><span id="Die-1058"><a href="#Die-1058"><span class="linenos">1058</span></a>
</span><span id="Die-1059"><a href="#Die-1059"><span class="linenos">1059</span></a>    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1060"><a href="#Die-1060"><span class="linenos">1060</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1061"><a href="#Die-1061"><span class="linenos">1061</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1062"><a href="#Die-1062"><span class="linenos">1062</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1063"><a href="#Die-1063"><span class="linenos">1063</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">)</span>
</span><span id="Die-1064"><a href="#Die-1064"><span class="linenos">1064</span></a>
</span><span id="Die-1065"><a href="#Die-1065"><span class="linenos">1065</span></a>    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1066"><a href="#Die-1066"><span class="linenos">1066</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">):</span>
</span><span id="Die-1067"><a href="#Die-1067"><span class="linenos">1067</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Die-1068"><a href="#Die-1068"><span class="linenos">1068</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1069"><a href="#Die-1069"><span class="linenos">1069</span></a>        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">)</span>
</span><span id="Die-1070"><a href="#Die-1070"><span class="linenos">1070</span></a>
</span><span id="Die-1071"><a href="#Die-1071"><span class="linenos">1071</span></a>    <span class="c1"># Comparators.</span>
</span><span id="Die-1072"><a href="#Die-1072"><span class="linenos">1072</span></a>
</span><span id="Die-1073"><a href="#Die-1073"><span class="linenos">1073</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Die-1074"><a href="#Die-1074"><span class="linenos">1074</span></a>    <span class="k">def</span> <span class="nf">_lt_le</span><span class="p">(</span><span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">lo</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="n">hi</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1075"><a href="#Die-1075"><span class="linenos">1075</span></a>        <span class="sd">&quot;&quot;&quot;Linear algorithm for &lt; and &lt;=.</span>
</span><span id="Die-1076"><a href="#Die-1076"><span class="linenos">1076</span></a>
</span><span id="Die-1077"><a href="#Die-1077"><span class="linenos">1077</span></a><span class="sd">        Args:</span>
</span><span id="Die-1078"><a href="#Die-1078"><span class="linenos">1078</span></a><span class="sd">            op: Either `operator.lt` or `operator.le`.</span>
</span><span id="Die-1079"><a href="#Die-1079"><span class="linenos">1079</span></a><span class="sd">            lo: The `Die` on the left of `op`.</span>
</span><span id="Die-1080"><a href="#Die-1080"><span class="linenos">1080</span></a><span class="sd">            hi: The `Die` on the right of `op`.</span>
</span><span id="Die-1081"><a href="#Die-1081"><span class="linenos">1081</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1082"><a href="#Die-1082"><span class="linenos">1082</span></a>        <span class="k">if</span> <span class="n">lo</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">or</span> <span class="n">hi</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="Die-1083"><a href="#Die-1083"><span class="linenos">1083</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([])</span>
</span><span id="Die-1084"><a href="#Die-1084"><span class="linenos">1084</span></a>
</span><span id="Die-1085"><a href="#Die-1085"><span class="linenos">1085</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">lo</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">hi</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Die-1086"><a href="#Die-1086"><span class="linenos">1086</span></a>
</span><span id="Die-1087"><a href="#Die-1087"><span class="linenos">1087</span></a>        <span class="c1"># One-outcome cases.</span>
</span><span id="Die-1088"><a href="#Die-1088"><span class="linenos">1088</span></a>
</span><span id="Die-1089"><a href="#Die-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="n">op</span><span class="p">(</span><span class="n">lo</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">(),</span> <span class="n">hi</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()):</span>
</span><span id="Die-1090"><a href="#Die-1090"><span class="linenos">1090</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">({</span><span class="kc">True</span><span class="p">:</span> <span class="n">d</span><span class="p">})</span>
</span><span id="Die-1091"><a href="#Die-1091"><span class="linenos">1091</span></a>
</span><span id="Die-1092"><a href="#Die-1092"><span class="linenos">1092</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="p">(</span><span class="n">lo</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">(),</span> <span class="n">hi</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()):</span>
</span><span id="Die-1093"><a href="#Die-1093"><span class="linenos">1093</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">({</span><span class="kc">False</span><span class="p">:</span> <span class="n">d</span><span class="p">})</span>
</span><span id="Die-1094"><a href="#Die-1094"><span class="linenos">1094</span></a>
</span><span id="Die-1095"><a href="#Die-1095"><span class="linenos">1095</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Die-1096"><a href="#Die-1096"><span class="linenos">1096</span></a>
</span><span id="Die-1097"><a href="#Die-1097"><span class="linenos">1097</span></a>        <span class="n">lo_cweight</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Die-1098"><a href="#Die-1098"><span class="linenos">1098</span></a>        <span class="n">lo_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">lo</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">lo</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">()))</span>
</span><span id="Die-1099"><a href="#Die-1099"><span class="linenos">1099</span></a>        <span class="n">lo_outcome</span><span class="p">,</span> <span class="n">next_lo_cweight</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">lo_iter</span><span class="p">)</span>
</span><span id="Die-1100"><a href="#Die-1100"><span class="linenos">1100</span></a>        <span class="k">for</span> <span class="n">hi_outcome</span><span class="p">,</span> <span class="n">hi_weight</span> <span class="ow">in</span> <span class="n">hi</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die-1101"><a href="#Die-1101"><span class="linenos">1101</span></a>            <span class="k">while</span> <span class="n">op</span><span class="p">(</span><span class="n">lo_outcome</span><span class="p">,</span> <span class="n">hi_outcome</span><span class="p">):</span>
</span><span id="Die-1102"><a href="#Die-1102"><span class="linenos">1102</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Die-1103"><a href="#Die-1103"><span class="linenos">1103</span></a>                    <span class="n">lo_cweight</span> <span class="o">=</span> <span class="n">next_lo_cweight</span>
</span><span id="Die-1104"><a href="#Die-1104"><span class="linenos">1104</span></a>                    <span class="n">lo_outcome</span><span class="p">,</span> <span class="n">next_lo_cweight</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">lo_iter</span><span class="p">)</span>
</span><span id="Die-1105"><a href="#Die-1105"><span class="linenos">1105</span></a>                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span><span id="Die-1106"><a href="#Die-1106"><span class="linenos">1106</span></a>                    <span class="k">break</span>
</span><span id="Die-1107"><a href="#Die-1107"><span class="linenos">1107</span></a>            <span class="n">n</span> <span class="o">+=</span> <span class="n">lo_cweight</span> <span class="o">*</span> <span class="n">hi_weight</span>
</span><span id="Die-1108"><a href="#Die-1108"><span class="linenos">1108</span></a>
</span><span id="Die-1109"><a href="#Die-1109"><span class="linenos">1109</span></a>        <span class="c1"># We don&#39;t use bernoulli because it trims zero-quantity outcomes.</span>
</span><span id="Die-1110"><a href="#Die-1110"><span class="linenos">1110</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">({</span><span class="kc">False</span><span class="p">:</span> <span class="n">d</span> <span class="o">-</span> <span class="n">n</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="n">n</span><span class="p">})</span>
</span><span id="Die-1111"><a href="#Die-1111"><span class="linenos">1111</span></a>
</span><span id="Die-1112"><a href="#Die-1112"><span class="linenos">1112</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1113"><a href="#Die-1113"><span class="linenos">1113</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1114"><a href="#Die-1114"><span class="linenos">1114</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_lt_le</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Die-1115"><a href="#Die-1115"><span class="linenos">1115</span></a>
</span><span id="Die-1116"><a href="#Die-1116"><span class="linenos">1116</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1117"><a href="#Die-1117"><span class="linenos">1117</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1118"><a href="#Die-1118"><span class="linenos">1118</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_lt_le</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Die-1119"><a href="#Die-1119"><span class="linenos">1119</span></a>
</span><span id="Die-1120"><a href="#Die-1120"><span class="linenos">1120</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1121"><a href="#Die-1121"><span class="linenos">1121</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1122"><a href="#Die-1122"><span class="linenos">1122</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_lt_le</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">le</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Die-1123"><a href="#Die-1123"><span class="linenos">1123</span></a>
</span><span id="Die-1124"><a href="#Die-1124"><span class="linenos">1124</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1125"><a href="#Die-1125"><span class="linenos">1125</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1126"><a href="#Die-1126"><span class="linenos">1126</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_lt_le</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">lt</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Die-1127"><a href="#Die-1127"><span class="linenos">1127</span></a>
</span><span id="Die-1128"><a href="#Die-1128"><span class="linenos">1128</span></a>    <span class="c1"># Equality operators. These produce a `DieWithTruth`.</span>
</span><span id="Die-1129"><a href="#Die-1129"><span class="linenos">1129</span></a>
</span><span id="Die-1130"><a href="#Die-1130"><span class="linenos">1130</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Die-1131"><a href="#Die-1131"><span class="linenos">1131</span></a>    <span class="k">def</span> <span class="nf">_eq</span><span class="p">(</span><span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Counts&#39;</span><span class="p">:</span>
</span><span id="Die-1132"><a href="#Die-1132"><span class="linenos">1132</span></a>        <span class="sd">&quot;&quot;&quot;Linear algorithm for == and !=.</span>
</span><span id="Die-1133"><a href="#Die-1133"><span class="linenos">1133</span></a>
</span><span id="Die-1134"><a href="#Die-1134"><span class="linenos">1134</span></a><span class="sd">        Args:</span>
</span><span id="Die-1135"><a href="#Die-1135"><span class="linenos">1135</span></a><span class="sd">            invert: If `False`, this computes ==; if `True` this computes !=.</span>
</span><span id="Die-1136"><a href="#Die-1136"><span class="linenos">1136</span></a><span class="sd">            a, b: The dice.</span>
</span><span id="Die-1137"><a href="#Die-1137"><span class="linenos">1137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1138"><a href="#Die-1138"><span class="linenos">1138</span></a>        <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">or</span> <span class="n">b</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="Die-1139"><a href="#Die-1139"><span class="linenos">1139</span></a>            <span class="k">return</span> <span class="n">Counts</span><span class="p">([])</span>
</span><span id="Die-1140"><a href="#Die-1140"><span class="linenos">1140</span></a>
</span><span id="Die-1141"><a href="#Die-1141"><span class="linenos">1141</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">b</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Die-1142"><a href="#Die-1142"><span class="linenos">1142</span></a>
</span><span id="Die-1143"><a href="#Die-1143"><span class="linenos">1143</span></a>        <span class="c1"># Single-outcome case.</span>
</span><span id="Die-1144"><a href="#Die-1144"><span class="linenos">1144</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="Die-1145"><a href="#Die-1145"><span class="linenos">1145</span></a>            <span class="k">return</span> <span class="n">Counts</span><span class="p">([(</span><span class="n">invert</span><span class="p">,</span> <span class="n">d</span><span class="p">)])</span>
</span><span id="Die-1146"><a href="#Die-1146"><span class="linenos">1146</span></a>
</span><span id="Die-1147"><a href="#Die-1147"><span class="linenos">1147</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Die-1148"><a href="#Die-1148"><span class="linenos">1148</span></a>
</span><span id="Die-1149"><a href="#Die-1149"><span class="linenos">1149</span></a>        <span class="n">a_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Die-1150"><a href="#Die-1150"><span class="linenos">1150</span></a>        <span class="n">b_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Die-1151"><a href="#Die-1151"><span class="linenos">1151</span></a>
</span><span id="Die-1152"><a href="#Die-1152"><span class="linenos">1152</span></a>        <span class="n">a_outcome</span><span class="p">,</span> <span class="n">a_quantity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">a_iter</span><span class="p">)</span>
</span><span id="Die-1153"><a href="#Die-1153"><span class="linenos">1153</span></a>        <span class="n">b_outcome</span><span class="p">,</span> <span class="n">b_quantity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">b_iter</span><span class="p">)</span>
</span><span id="Die-1154"><a href="#Die-1154"><span class="linenos">1154</span></a>
</span><span id="Die-1155"><a href="#Die-1155"><span class="linenos">1155</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Die-1156"><a href="#Die-1156"><span class="linenos">1156</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Die-1157"><a href="#Die-1157"><span class="linenos">1157</span></a>                <span class="k">if</span> <span class="n">a_outcome</span> <span class="o">==</span> <span class="n">b_outcome</span><span class="p">:</span>
</span><span id="Die-1158"><a href="#Die-1158"><span class="linenos">1158</span></a>                    <span class="n">n</span> <span class="o">+=</span> <span class="n">a_quantity</span> <span class="o">*</span> <span class="n">b_quantity</span>
</span><span id="Die-1159"><a href="#Die-1159"><span class="linenos">1159</span></a>                    <span class="n">a_outcome</span><span class="p">,</span> <span class="n">a_quantity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">a_iter</span><span class="p">)</span>
</span><span id="Die-1160"><a href="#Die-1160"><span class="linenos">1160</span></a>                    <span class="n">b_outcome</span><span class="p">,</span> <span class="n">b_quantity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">b_iter</span><span class="p">)</span>
</span><span id="Die-1161"><a href="#Die-1161"><span class="linenos">1161</span></a>                <span class="k">elif</span> <span class="n">a_outcome</span> <span class="o">&lt;</span> <span class="n">b_outcome</span><span class="p">:</span>
</span><span id="Die-1162"><a href="#Die-1162"><span class="linenos">1162</span></a>                    <span class="n">a_outcome</span><span class="p">,</span> <span class="n">a_quantity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">a_iter</span><span class="p">)</span>
</span><span id="Die-1163"><a href="#Die-1163"><span class="linenos">1163</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1164"><a href="#Die-1164"><span class="linenos">1164</span></a>                    <span class="n">b_outcome</span><span class="p">,</span> <span class="n">b_quantity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">b_iter</span><span class="p">)</span>
</span><span id="Die-1165"><a href="#Die-1165"><span class="linenos">1165</span></a>            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span><span id="Die-1166"><a href="#Die-1166"><span class="linenos">1166</span></a>                <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
</span><span id="Die-1167"><a href="#Die-1167"><span class="linenos">1167</span></a>                    <span class="k">return</span> <span class="n">Counts</span><span class="p">([(</span><span class="kc">False</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">n</span><span class="p">)])</span>
</span><span id="Die-1168"><a href="#Die-1168"><span class="linenos">1168</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1169"><a href="#Die-1169"><span class="linenos">1169</span></a>                    <span class="k">return</span> <span class="n">Counts</span><span class="p">([(</span><span class="kc">False</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">n</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">n</span><span class="p">)])</span>
</span><span id="Die-1170"><a href="#Die-1170"><span class="linenos">1170</span></a>
</span><span id="Die-1171"><a href="#Die-1171"><span class="linenos">1171</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Die-1172"><a href="#Die-1172"><span class="linenos">1172</span></a>        <span class="n">other_die</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1173"><a href="#Die-1173"><span class="linenos">1173</span></a>
</span><span id="Die-1174"><a href="#Die-1174"><span class="linenos">1174</span></a>        <span class="k">def</span> <span class="nf">data_callback</span><span class="p">():</span>
</span><span id="Die-1175"><a href="#Die-1175"><span class="linenos">1175</span></a>            <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_eq</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other_die</span><span class="p">)</span>
</span><span id="Die-1176"><a href="#Die-1176"><span class="linenos">1176</span></a>
</span><span id="Die-1177"><a href="#Die-1177"><span class="linenos">1177</span></a>        <span class="k">def</span> <span class="nf">truth_value_callback</span><span class="p">():</span>
</span><span id="Die-1178"><a href="#Die-1178"><span class="linenos">1178</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1179"><a href="#Die-1179"><span class="linenos">1179</span></a>
</span><span id="Die-1180"><a href="#Die-1180"><span class="linenos">1180</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">DieWithTruth</span><span class="p">(</span><span class="n">data_callback</span><span class="p">,</span> <span class="n">truth_value_callback</span><span class="p">)</span>
</span><span id="Die-1181"><a href="#Die-1181"><span class="linenos">1181</span></a>
</span><span id="Die-1182"><a href="#Die-1182"><span class="linenos">1182</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Die-1183"><a href="#Die-1183"><span class="linenos">1183</span></a>        <span class="n">other_die</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1184"><a href="#Die-1184"><span class="linenos">1184</span></a>
</span><span id="Die-1185"><a href="#Die-1185"><span class="linenos">1185</span></a>        <span class="k">def</span> <span class="nf">data_callback</span><span class="p">():</span>
</span><span id="Die-1186"><a href="#Die-1186"><span class="linenos">1186</span></a>            <span class="k">return</span> <span class="n">Die</span><span class="o">.</span><span class="n">_eq</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other_die</span><span class="p">)</span>
</span><span id="Die-1187"><a href="#Die-1187"><span class="linenos">1187</span></a>
</span><span id="Die-1188"><a href="#Die-1188"><span class="linenos">1188</span></a>        <span class="k">def</span> <span class="nf">truth_value_callback</span><span class="p">():</span>
</span><span id="Die-1189"><a href="#Die-1189"><span class="linenos">1189</span></a>            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1190"><a href="#Die-1190"><span class="linenos">1190</span></a>
</span><span id="Die-1191"><a href="#Die-1191"><span class="linenos">1191</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">DieWithTruth</span><span class="p">(</span><span class="n">data_callback</span><span class="p">,</span> <span class="n">truth_value_callback</span><span class="p">)</span>
</span><span id="Die-1192"><a href="#Die-1192"><span class="linenos">1192</span></a>
</span><span id="Die-1193"><a href="#Die-1193"><span class="linenos">1193</span></a>    <span class="k">def</span> <span class="nf">cmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1194"><a href="#Die-1194"><span class="linenos">1194</span></a>        <span class="sd">&quot;&quot;&quot;A `Die` with outcomes 1, -1, and 0.</span>
</span><span id="Die-1195"><a href="#Die-1195"><span class="linenos">1195</span></a>
</span><span id="Die-1196"><a href="#Die-1196"><span class="linenos">1196</span></a><span class="sd">        The quantities are equal to the positive outcome of `self &gt; other`,</span>
</span><span id="Die-1197"><a href="#Die-1197"><span class="linenos">1197</span></a><span class="sd">        `self &lt; other`, and the remainder respectively.</span>
</span><span id="Die-1198"><a href="#Die-1198"><span class="linenos">1198</span></a>
</span><span id="Die-1199"><a href="#Die-1199"><span class="linenos">1199</span></a><span class="sd">        This will include all three outcomes even if they have zero quantity.</span>
</span><span id="Die-1200"><a href="#Die-1200"><span class="linenos">1200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1201"><a href="#Die-1201"><span class="linenos">1201</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die-1202"><a href="#Die-1202"><span class="linenos">1202</span></a>
</span><span id="Die-1203"><a href="#Die-1203"><span class="linenos">1203</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die-1204"><a href="#Die-1204"><span class="linenos">1204</span></a>
</span><span id="Die-1205"><a href="#Die-1205"><span class="linenos">1205</span></a>        <span class="n">lt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span>
</span><span id="Die-1206"><a href="#Die-1206"><span class="linenos">1206</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">:</span>
</span><span id="Die-1207"><a href="#Die-1207"><span class="linenos">1207</span></a>            <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die-1208"><a href="#Die-1208"><span class="linenos">1208</span></a>        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Die-1209"><a href="#Die-1209"><span class="linenos">1209</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
</span><span id="Die-1210"><a href="#Die-1210"><span class="linenos">1210</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die-1211"><a href="#Die-1211"><span class="linenos">1211</span></a>        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span>
</span><span id="Die-1212"><a href="#Die-1212"><span class="linenos">1212</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">:</span>
</span><span id="Die-1213"><a href="#Die-1213"><span class="linenos">1213</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die-1214"><a href="#Die-1214"><span class="linenos">1214</span></a>
</span><span id="Die-1215"><a href="#Die-1215"><span class="linenos">1215</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Die-1216"><a href="#Die-1216"><span class="linenos">1216</span></a>
</span><span id="Die-1217"><a href="#Die-1217"><span class="linenos">1217</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Die-1218"><a href="#Die-1218"><span class="linenos">1218</span></a>    <span class="k">def</span> <span class="nf">_sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-1219"><a href="#Die-1219"><span class="linenos">1219</span></a>        <span class="n">z</span> <span class="o">=</span> <span class="n">Die</span><span class="o">.</span><span class="n">_zero</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="Die-1220"><a href="#Die-1220"><span class="linenos">1220</span></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">z</span><span class="p">:</span>
</span><span id="Die-1221"><a href="#Die-1221"><span class="linenos">1221</span></a>            <span class="k">return</span> <span class="mi">1</span>
</span><span id="Die-1222"><a href="#Die-1222"><span class="linenos">1222</span></a>        <span class="k">elif</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">z</span><span class="p">:</span>
</span><span id="Die-1223"><a href="#Die-1223"><span class="linenos">1223</span></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Die-1224"><a href="#Die-1224"><span class="linenos">1224</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1225"><a href="#Die-1225"><span class="linenos">1225</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Die-1226"><a href="#Die-1226"><span class="linenos">1226</span></a>
</span><span id="Die-1227"><a href="#Die-1227"><span class="linenos">1227</span></a>    <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1228"><a href="#Die-1228"><span class="linenos">1228</span></a>        <span class="sd">&quot;&quot;&quot;Outcomes become 1 if greater than `zero()`, -1 if less than `zero()`, and 0 otherwise.</span>
</span><span id="Die-1229"><a href="#Die-1229"><span class="linenos">1229</span></a>
</span><span id="Die-1230"><a href="#Die-1230"><span class="linenos">1230</span></a><span class="sd">        Note that for `float`s, +0.0, -0.0, and nan all become 0.</span>
</span><span id="Die-1231"><a href="#Die-1231"><span class="linenos">1231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1232"><a href="#Die-1232"><span class="linenos">1232</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_sign</span><span class="p">)</span>
</span><span id="Die-1233"><a href="#Die-1233"><span class="linenos">1233</span></a>
</span><span id="Die-1234"><a href="#Die-1234"><span class="linenos">1234</span></a>    <span class="k">def</span> <span class="nf">bool</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die-1235"><a href="#Die-1235"><span class="linenos">1235</span></a>        <span class="sd">&quot;&quot;&quot;Takes `bool()` of all outcomes.</span>
</span><span id="Die-1236"><a href="#Die-1236"><span class="linenos">1236</span></a>
</span><span id="Die-1237"><a href="#Die-1237"><span class="linenos">1237</span></a><span class="sd">        Note that a `Die` as a whole is not considered to have a truth value</span>
</span><span id="Die-1238"><a href="#Die-1238"><span class="linenos">1238</span></a><span class="sd">        unless it is the result of the `==` or `!=` operators.</span>
</span><span id="Die-1239"><a href="#Die-1239"><span class="linenos">1239</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1240"><a href="#Die-1240"><span class="linenos">1240</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="Die-1241"><a href="#Die-1241"><span class="linenos">1241</span></a>
</span><span id="Die-1242"><a href="#Die-1242"><span class="linenos">1242</span></a>    <span class="c1"># Equality and hashing.</span>
</span><span id="Die-1243"><a href="#Die-1243"><span class="linenos">1243</span></a>
</span><span id="Die-1244"><a href="#Die-1244"><span class="linenos">1244</span></a>    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Die-1245"><a href="#Die-1245"><span class="linenos">1245</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die-1246"><a href="#Die-1246"><span class="linenos">1246</span></a>            <span class="s1">&#39;A `Die` only has a truth value if it is the result of == or !=. &#39;</span>
</span><span id="Die-1247"><a href="#Die-1247"><span class="linenos">1247</span></a>            <span class="s1">&#39;If this is in the conditional of an if-statement, you probably &#39;</span>
</span><span id="Die-1248"><a href="#Die-1248"><span class="linenos">1248</span></a>            <span class="s1">&#39;want to use die.if_else() instead.&#39;</span><span class="p">)</span>
</span><span id="Die-1249"><a href="#Die-1249"><span class="linenos">1249</span></a>
</span><span id="Die-1250"><a href="#Die-1250"><span class="linenos">1250</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-1251"><a href="#Die-1251"><span class="linenos">1251</span></a>    <span class="k">def</span> <span class="nf">_key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Die-1252"><a href="#Die-1252"><span class="linenos">1252</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Die-1253"><a href="#Die-1253"><span class="linenos">1253</span></a>
</span><span id="Die-1254"><a href="#Die-1254"><span class="linenos">1254</span></a>    <span class="k">def</span> <span class="nf">key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Die-1255"><a href="#Die-1255"><span class="linenos">1255</span></a>        <span class="sd">&quot;&quot;&quot;A tuple that uniquely (as `equals()`) identifies this die.</span>
</span><span id="Die-1256"><a href="#Die-1256"><span class="linenos">1256</span></a>
</span><span id="Die-1257"><a href="#Die-1257"><span class="linenos">1257</span></a><span class="sd">        Apart from being hashable and totally orderable, this is not guaranteed</span>
</span><span id="Die-1258"><a href="#Die-1258"><span class="linenos">1258</span></a><span class="sd">        to be in any particular format or have any other properties.</span>
</span><span id="Die-1259"><a href="#Die-1259"><span class="linenos">1259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1260"><a href="#Die-1260"><span class="linenos">1260</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span>
</span><span id="Die-1261"><a href="#Die-1261"><span class="linenos">1261</span></a>
</span><span id="Die-1262"><a href="#Die-1262"><span class="linenos">1262</span></a>    <span class="nd">@cached_property</span>
</span><span id="Die-1263"><a href="#Die-1263"><span class="linenos">1263</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-1264"><a href="#Die-1264"><span class="linenos">1264</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">())</span>
</span><span id="Die-1265"><a href="#Die-1265"><span class="linenos">1265</span></a>
</span><span id="Die-1266"><a href="#Die-1266"><span class="linenos">1266</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Die-1267"><a href="#Die-1267"><span class="linenos">1267</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="Die-1268"><a href="#Die-1268"><span class="linenos">1268</span></a>
</span><span id="Die-1269"><a href="#Die-1269"><span class="linenos">1269</span></a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Die-1270"><a href="#Die-1270"><span class="linenos">1270</span></a>        <span class="sd">&quot;&quot;&quot;`True` iff both dice have the same outcomes and quantities.</span>
</span><span id="Die-1271"><a href="#Die-1271"><span class="linenos">1271</span></a>
</span><span id="Die-1272"><a href="#Die-1272"><span class="linenos">1272</span></a><span class="sd">        This is `False` if `other` is not a `Die`, even if it would convert</span>
</span><span id="Die-1273"><a href="#Die-1273"><span class="linenos">1273</span></a><span class="sd">        to an equal `Die`.</span>
</span><span id="Die-1274"><a href="#Die-1274"><span class="linenos">1274</span></a>
</span><span id="Die-1275"><a href="#Die-1275"><span class="linenos">1275</span></a><span class="sd">        Truth value does NOT matter.</span>
</span><span id="Die-1276"><a href="#Die-1276"><span class="linenos">1276</span></a>
</span><span id="Die-1277"><a href="#Die-1277"><span class="linenos">1277</span></a><span class="sd">        If one `Die` has a zero-quantity outcome and the other `Die` does not</span>
</span><span id="Die-1278"><a href="#Die-1278"><span class="linenos">1278</span></a><span class="sd">        contain that outcome, they are treated as unequal by this function.</span>
</span><span id="Die-1279"><a href="#Die-1279"><span class="linenos">1279</span></a>
</span><span id="Die-1280"><a href="#Die-1280"><span class="linenos">1280</span></a><span class="sd">        The `==` and `!=` operators have a dual purpose; they return a `Die`</span>
</span><span id="Die-1281"><a href="#Die-1281"><span class="linenos">1281</span></a><span class="sd">        with a truth value determined by this method.</span>
</span><span id="Die-1282"><a href="#Die-1282"><span class="linenos">1282</span></a><span class="sd">        Only dice returned by these methods have a truth value. The data of</span>
</span><span id="Die-1283"><a href="#Die-1283"><span class="linenos">1283</span></a><span class="sd">        these dice is lazily evaluated since the caller may only be interested</span>
</span><span id="Die-1284"><a href="#Die-1284"><span class="linenos">1284</span></a><span class="sd">        in the `Die` value or the truth value.</span>
</span><span id="Die-1285"><a href="#Die-1285"><span class="linenos">1285</span></a>
</span><span id="Die-1286"><a href="#Die-1286"><span class="linenos">1286</span></a><span class="sd">        Args:</span>
</span><span id="Die-1287"><a href="#Die-1287"><span class="linenos">1287</span></a><span class="sd">            simplify: If `True`, the dice will be simplified before comparing.</span>
</span><span id="Die-1288"><a href="#Die-1288"><span class="linenos">1288</span></a><span class="sd">                Otherwise, e.g. a 2:2 coin is not `equals()` to a 1:1 coin.</span>
</span><span id="Die-1289"><a href="#Die-1289"><span class="linenos">1289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die-1290"><a href="#Die-1290"><span class="linenos">1290</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die-1291"><a href="#Die-1291"><span class="linenos">1291</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Die-1292"><a href="#Die-1292"><span class="linenos">1292</span></a>
</span><span id="Die-1293"><a href="#Die-1293"><span class="linenos">1293</span></a>        <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
</span><span id="Die-1294"><a href="#Die-1294"><span class="linenos">1294</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span>
</span><span id="Die-1295"><a href="#Die-1295"><span class="linenos">1295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die-1296"><a href="#Die-1296"><span class="linenos">1296</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span>
</span><span id="Die-1297"><a href="#Die-1297"><span class="linenos">1297</span></a>
</span><span id="Die-1298"><a href="#Die-1298"><span class="linenos">1298</span></a>    <span class="c1"># Strings.</span>
</span><span id="Die-1299"><a href="#Die-1299"><span class="linenos">1299</span></a>
</span><span id="Die-1300"><a href="#Die-1300"><span class="linenos">1300</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Die-1301"><a href="#Die-1301"><span class="linenos">1301</span></a>        <span class="n">inner</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Die-1302"><a href="#Die-1302"><span class="linenos">1302</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">weight</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Die-1303"><a href="#Die-1303"><span class="linenos">1303</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="s1">&#39;({&#39;</span> <span class="o">+</span> <span class="n">inner</span> <span class="o">+</span> <span class="s1">&#39;})&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Sampling with replacement. Quantities represent weights.</p>

<p>Dice are immutable. Methods do not modify the <code><a href="#Die">Die</a></code> in-place;
rather they return a <code><a href="#Die">Die</a></code> representing the result.</p>

<p>It <em>is</em> (mostly) well-defined to have a <code><a href="#Die">Die</a></code> with zero-quantity outcomes.
These can be useful in a few cases, such as:</p>

<ul>
<li><code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> will iterate through zero-quantity outcomes,
rather than possibly skipping that outcome. (Though in most cases it's
better to use <code><a href="#OutcomeCountEvaluator.alignment">OutcomeCountEvaluator.alignment()</a></code>.)</li>
<li><code><a href="#align">icepool.align()</a></code> and the like are convenient for making dice share the
same set of outcomes.</li>
</ul>

<p>However, zero-quantity outcomes have a computational cost like any other
outcome. Unless you have a specific use case in mind, it's best to leave
them out.</p>

<p>Most operators and methods will not introduce zero-quantity outcomes if
their arguments do not have any; nor remove zero-quantity outcomes.</p>

<p>It's also possible to have "empty" dice with no outcomes at all,
though these have little use other than being sentinel values.</p>
</div>


                            <div id="Die.__init__" class="classattr">
                                        <input id="Die.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Die</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">]</span>,</span><span class="param">	<span class="n">times</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_end</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Die.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.__init__-76"><a href="#Die.__init__-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Die.__init__-77"><a href="#Die.__init__-77"><span class="linenos"> 77</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">,</span>
</span><span id="Die.__init__-78"><a href="#Die.__init__-78"><span class="linenos"> 78</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.__init__-79"><a href="#Die.__init__-79"><span class="linenos"> 79</span></a>                <span class="o">*</span><span class="p">,</span>
</span><span id="Die.__init__-80"><a href="#Die.__init__-80"><span class="linenos"> 80</span></a>                <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.__init__-81"><a href="#Die.__init__-81"><span class="linenos"> 81</span></a>                <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.__init__-82"><a href="#Die.__init__-82"><span class="linenos"> 82</span></a>        <span class="sd">&quot;&quot;&quot;Constructor for a `Die`.</span>
</span><span id="Die.__init__-83"><a href="#Die.__init__-83"><span class="linenos"> 83</span></a>
</span><span id="Die.__init__-84"><a href="#Die.__init__-84"><span class="linenos"> 84</span></a><span class="sd">        Don&#39;t confuse this with `d()`:</span>
</span><span id="Die.__init__-85"><a href="#Die.__init__-85"><span class="linenos"> 85</span></a>
</span><span id="Die.__init__-86"><a href="#Die.__init__-86"><span class="linenos"> 86</span></a><span class="sd">        * `Die([6])`: A `Die` that always rolls the `int` 6.</span>
</span><span id="Die.__init__-87"><a href="#Die.__init__-87"><span class="linenos"> 87</span></a><span class="sd">        * `d(6)`: A d6.</span>
</span><span id="Die.__init__-88"><a href="#Die.__init__-88"><span class="linenos"> 88</span></a>
</span><span id="Die.__init__-89"><a href="#Die.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        Also, don&#39;t confuse this with `Pool()`:</span>
</span><span id="Die.__init__-90"><a href="#Die.__init__-90"><span class="linenos"> 90</span></a>
</span><span id="Die.__init__-91"><a href="#Die.__init__-91"><span class="linenos"> 91</span></a><span class="sd">        * `Die([1, 2, 3, 4, 5, 6])`: A d6.</span>
</span><span id="Die.__init__-92"><a href="#Die.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        * `Pool([1, 2, 3, 4, 5, 6])`: A `Pool` of six dice that always rolls one</span>
</span><span id="Die.__init__-93"><a href="#Die.__init__-93"><span class="linenos"> 93</span></a><span class="sd">            of each number.</span>
</span><span id="Die.__init__-94"><a href="#Die.__init__-94"><span class="linenos"> 94</span></a>
</span><span id="Die.__init__-95"><a href="#Die.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        Here are some different ways of constructing a d6:</span>
</span><span id="Die.__init__-96"><a href="#Die.__init__-96"><span class="linenos"> 96</span></a>
</span><span id="Die.__init__-97"><a href="#Die.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        * Just import it: `from icepool import d6`</span>
</span><span id="Die.__init__-98"><a href="#Die.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        * Use the `d()` function: `icepool.d(6)`</span>
</span><span id="Die.__init__-99"><a href="#Die.__init__-99"><span class="linenos"> 99</span></a><span class="sd">        * Use a d6 that you already have: `Die(d6)` or `Die([d6])`</span>
</span><span id="Die.__init__-100"><a href="#Die.__init__-100"><span class="linenos">100</span></a><span class="sd">        * Mix a d3 and a d3+3: `Die([d3, d3+3])`</span>
</span><span id="Die.__init__-101"><a href="#Die.__init__-101"><span class="linenos">101</span></a><span class="sd">        * Use a dict: `Die({1:1, 2:1, 3:1, 4:1, 5:1, 6:1})`</span>
</span><span id="Die.__init__-102"><a href="#Die.__init__-102"><span class="linenos">102</span></a><span class="sd">        * Give the faces as a sequence: `Die([1, 2, 3, 4, 5, 6])`</span>
</span><span id="Die.__init__-103"><a href="#Die.__init__-103"><span class="linenos">103</span></a>
</span><span id="Die.__init__-104"><a href="#Die.__init__-104"><span class="linenos">104</span></a><span class="sd">        All quantities must be non-negative, though they can be zero.</span>
</span><span id="Die.__init__-105"><a href="#Die.__init__-105"><span class="linenos">105</span></a>
</span><span id="Die.__init__-106"><a href="#Die.__init__-106"><span class="linenos">106</span></a><span class="sd">        Several methods and functions foward **kwargs to this constructor.</span>
</span><span id="Die.__init__-107"><a href="#Die.__init__-107"><span class="linenos">107</span></a><span class="sd">        However, these only affect the construction of the returned or yielded</span>
</span><span id="Die.__init__-108"><a href="#Die.__init__-108"><span class="linenos">108</span></a><span class="sd">        dice. Any other implicit conversions of arguments or operands to dice</span>
</span><span id="Die.__init__-109"><a href="#Die.__init__-109"><span class="linenos">109</span></a><span class="sd">        will be done with the default keyword arguments.</span>
</span><span id="Die.__init__-110"><a href="#Die.__init__-110"><span class="linenos">110</span></a>
</span><span id="Die.__init__-111"><a href="#Die.__init__-111"><span class="linenos">111</span></a><span class="sd">        EXPERIMENTAL: Use `icepool.Again()` to roll the dice again, usually with</span>
</span><span id="Die.__init__-112"><a href="#Die.__init__-112"><span class="linenos">112</span></a><span class="sd">        some modification. For example,</span>
</span><span id="Die.__init__-113"><a href="#Die.__init__-113"><span class="linenos">113</span></a>
</span><span id="Die.__init__-114"><a href="#Die.__init__-114"><span class="linenos">114</span></a><span class="sd">        ```</span>
</span><span id="Die.__init__-115"><a href="#Die.__init__-115"><span class="linenos">115</span></a><span class="sd">        Die([1, 2, 3, 4, 5, 6 + Again()])</span>
</span><span id="Die.__init__-116"><a href="#Die.__init__-116"><span class="linenos">116</span></a><span class="sd">        ```</span>
</span><span id="Die.__init__-117"><a href="#Die.__init__-117"><span class="linenos">117</span></a>
</span><span id="Die.__init__-118"><a href="#Die.__init__-118"><span class="linenos">118</span></a><span class="sd">        would be an exploding d6. Use the `again_depth` parameter to control</span>
</span><span id="Die.__init__-119"><a href="#Die.__init__-119"><span class="linenos">119</span></a><span class="sd">        the maximum depth. `again_depth` does not apply to `Reroll`.</span>
</span><span id="Die.__init__-120"><a href="#Die.__init__-120"><span class="linenos">120</span></a>
</span><span id="Die.__init__-121"><a href="#Die.__init__-121"><span class="linenos">121</span></a><span class="sd">        If the roll reaches the maximum depth, the `again_end` is used instead</span>
</span><span id="Die.__init__-122"><a href="#Die.__init__-122"><span class="linenos">122</span></a><span class="sd">        of rolling again. Options for `again_end` include:</span>
</span><span id="Die.__init__-123"><a href="#Die.__init__-123"><span class="linenos">123</span></a>
</span><span id="Die.__init__-124"><a href="#Die.__init__-124"><span class="linenos">124</span></a><span class="sd">        * No value (`None`), which will attempt to determine a zero value from</span>
</span><span id="Die.__init__-125"><a href="#Die.__init__-125"><span class="linenos">125</span></a><span class="sd">            the outcomes that don&#39;t involve `Again`.</span>
</span><span id="Die.__init__-126"><a href="#Die.__init__-126"><span class="linenos">126</span></a><span class="sd">        * A single outcome, or a `Die`.</span>
</span><span id="Die.__init__-127"><a href="#Die.__init__-127"><span class="linenos">127</span></a><span class="sd">        * `Reroll`, which will reroll any end roll involving `Again`.</span>
</span><span id="Die.__init__-128"><a href="#Die.__init__-128"><span class="linenos">128</span></a><span class="sd">        * You could also consider some sort of placeholder value such as</span>
</span><span id="Die.__init__-129"><a href="#Die.__init__-129"><span class="linenos">129</span></a><span class="sd">            `math.inf`.</span>
</span><span id="Die.__init__-130"><a href="#Die.__init__-130"><span class="linenos">130</span></a>
</span><span id="Die.__init__-131"><a href="#Die.__init__-131"><span class="linenos">131</span></a><span class="sd">        Denominator: For a flat set of outcomes, the denominator is just the</span>
</span><span id="Die.__init__-132"><a href="#Die.__init__-132"><span class="linenos">132</span></a><span class="sd">        sum of the corresponding quantities. If the outcomes themselves have</span>
</span><span id="Die.__init__-133"><a href="#Die.__init__-133"><span class="linenos">133</span></a><span class="sd">        secondary denominators, then the overall denominator is the primary</span>
</span><span id="Die.__init__-134"><a href="#Die.__init__-134"><span class="linenos">134</span></a><span class="sd">        denominator times the LCM of the outcome denominators.</span>
</span><span id="Die.__init__-135"><a href="#Die.__init__-135"><span class="linenos">135</span></a>
</span><span id="Die.__init__-136"><a href="#Die.__init__-136"><span class="linenos">136</span></a><span class="sd">        For example, `Die([d3, d4, d6])` has a final denominator of 36: 3 for</span>
</span><span id="Die.__init__-137"><a href="#Die.__init__-137"><span class="linenos">137</span></a><span class="sd">        the primary selection between the three secondary dice, times 12 for</span>
</span><span id="Die.__init__-138"><a href="#Die.__init__-138"><span class="linenos">138</span></a><span class="sd">        the LCM of 3, 4, and 6.</span>
</span><span id="Die.__init__-139"><a href="#Die.__init__-139"><span class="linenos">139</span></a>
</span><span id="Die.__init__-140"><a href="#Die.__init__-140"><span class="linenos">140</span></a><span class="sd">        Args:</span>
</span><span id="Die.__init__-141"><a href="#Die.__init__-141"><span class="linenos">141</span></a><span class="sd">            outcomes: The faces of the `Die`. This can be one of the following:</span>
</span><span id="Die.__init__-142"><a href="#Die.__init__-142"><span class="linenos">142</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Die.__init__-143"><a href="#Die.__init__-143"><span class="linenos">143</span></a><span class="sd">                * A sequence of outcomes. Each element will have the same total</span>
</span><span id="Die.__init__-144"><a href="#Die.__init__-144"><span class="linenos">144</span></a><span class="sd">                    quantity.</span>
</span><span id="Die.__init__-145"><a href="#Die.__init__-145"><span class="linenos">145</span></a>
</span><span id="Die.__init__-146"><a href="#Die.__init__-146"><span class="linenos">146</span></a><span class="sd">                Note that `Die` and `Deck` both count as `Mapping`s.</span>
</span><span id="Die.__init__-147"><a href="#Die.__init__-147"><span class="linenos">147</span></a><span class="sd">                Each outcome may be one of the following:</span>
</span><span id="Die.__init__-148"><a href="#Die.__init__-148"><span class="linenos">148</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Die.__init__-149"><a href="#Die.__init__-149"><span class="linenos">149</span></a><span class="sd">                    The outcomes of the `Mapping` will be &quot;flattened&quot; into the</span>
</span><span id="Die.__init__-150"><a href="#Die.__init__-150"><span class="linenos">150</span></a><span class="sd">                    result. This option will be taken in preference to treating</span>
</span><span id="Die.__init__-151"><a href="#Die.__init__-151"><span class="linenos">151</span></a><span class="sd">                    the `Mapping` itself as an outcome even if the `Mapping`</span>
</span><span id="Die.__init__-152"><a href="#Die.__init__-152"><span class="linenos">152</span></a><span class="sd">                    itself is hashable and totally orderable. This means that</span>
</span><span id="Die.__init__-153"><a href="#Die.__init__-153"><span class="linenos">153</span></a><span class="sd">                    `Die` and `Deck` will never be outcomes.</span>
</span><span id="Die.__init__-154"><a href="#Die.__init__-154"><span class="linenos">154</span></a><span class="sd">                * A tuple of outcomes. Operators on dice with tuple outcomes</span>
</span><span id="Die.__init__-155"><a href="#Die.__init__-155"><span class="linenos">155</span></a><span class="sd">                    are performed element-wise. See `Die.unary_op` and</span>
</span><span id="Die.__init__-156"><a href="#Die.__init__-156"><span class="linenos">156</span></a><span class="sd">                    `Die.binary_op` for details.</span>
</span><span id="Die.__init__-157"><a href="#Die.__init__-157"><span class="linenos">157</span></a>
</span><span id="Die.__init__-158"><a href="#Die.__init__-158"><span class="linenos">158</span></a><span class="sd">                    Any tuple elements that are `Mapping`s will expand the</span>
</span><span id="Die.__init__-159"><a href="#Die.__init__-159"><span class="linenos">159</span></a><span class="sd">                    tuple according to their independent joint distribution.</span>
</span><span id="Die.__init__-160"><a href="#Die.__init__-160"><span class="linenos">160</span></a><span class="sd">                    For example, `(d6, d6)` will expand to 36 ordered tuples</span>
</span><span id="Die.__init__-161"><a href="#Die.__init__-161"><span class="linenos">161</span></a><span class="sd">                    with quantity 1 each. Use this carefully since it may create a</span>
</span><span id="Die.__init__-162"><a href="#Die.__init__-162"><span class="linenos">162</span></a><span class="sd">                    large number of outcomes.</span>
</span><span id="Die.__init__-163"><a href="#Die.__init__-163"><span class="linenos">163</span></a><span class="sd">                * `str` or `bytes`, which will be treated as a single outcome.</span>
</span><span id="Die.__init__-164"><a href="#Die.__init__-164"><span class="linenos">164</span></a><span class="sd">                * Any other sequence. Each element will be weighted equally.</span>
</span><span id="Die.__init__-165"><a href="#Die.__init__-165"><span class="linenos">165</span></a><span class="sd">                * `icepool.Reroll`, which will drop itself</span>
</span><span id="Die.__init__-166"><a href="#Die.__init__-166"><span class="linenos">166</span></a><span class="sd">                    and the corresponding element of `times` from consideration.</span>
</span><span id="Die.__init__-167"><a href="#Die.__init__-167"><span class="linenos">167</span></a><span class="sd">                    If inside a tuple, the tuple will be dropped.</span>
</span><span id="Die.__init__-168"><a href="#Die.__init__-168"><span class="linenos">168</span></a><span class="sd">                * Anything else will be treated as a single outcome.</span>
</span><span id="Die.__init__-169"><a href="#Die.__init__-169"><span class="linenos">169</span></a><span class="sd">                    Each outcome must be hashable, and the</span>
</span><span id="Die.__init__-170"><a href="#Die.__init__-170"><span class="linenos">170</span></a><span class="sd">                    set of outcomes must be totally orderable (after expansion).</span>
</span><span id="Die.__init__-171"><a href="#Die.__init__-171"><span class="linenos">171</span></a><span class="sd">                    The same outcome can appear multiple times, in which case</span>
</span><span id="Die.__init__-172"><a href="#Die.__init__-172"><span class="linenos">172</span></a><span class="sd">                    the corresponding quantities will be accumulated.</span>
</span><span id="Die.__init__-173"><a href="#Die.__init__-173"><span class="linenos">173</span></a><span class="sd">            times: Multiplies the quantity of each element of `outcomes`.</span>
</span><span id="Die.__init__-174"><a href="#Die.__init__-174"><span class="linenos">174</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Die.__init__-175"><a href="#Die.__init__-175"><span class="linenos">175</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Die.__init__-176"><a href="#Die.__init__-176"><span class="linenos">176</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Die.__init__-177"><a href="#Die.__init__-177"><span class="linenos">177</span></a><span class="sd">        Raises:</span>
</span><span id="Die.__init__-178"><a href="#Die.__init__-178"><span class="linenos">178</span></a><span class="sd">            ValueError: `None` is not a valid outcome for a `Die`.</span>
</span><span id="Die.__init__-179"><a href="#Die.__init__-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.__init__-180"><a href="#Die.__init__-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die.__init__-181"><a href="#Die.__init__-181"><span class="linenos">181</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die.__init__-182"><a href="#Die.__init__-182"><span class="linenos">182</span></a>                <span class="k">return</span> <span class="n">outcomes</span>
</span><span id="Die.__init__-183"><a href="#Die.__init__-183"><span class="linenos">183</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.__init__-184"><a href="#Die.__init__-184"><span class="linenos">184</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="n">outcomes</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Die.__init__-185"><a href="#Die.__init__-185"><span class="linenos">185</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.__init__-186"><a href="#Die.__init__-186"><span class="linenos">186</span></a>            <span class="c1"># Check for Again.</span>
</span><span id="Die.__init__-187"><a href="#Die.__init__-187"><span class="linenos">187</span></a>            <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.__init__-188"><a href="#Die.__init__-188"><span class="linenos">188</span></a>                <span class="k">if</span> <span class="n">again_end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.__init__-189"><a href="#Die.__init__-189"><span class="linenos">189</span></a>                    <span class="c1"># Create a test die with `Again`s removed,</span>
</span><span id="Die.__init__-190"><a href="#Die.__init__-190"><span class="linenos">190</span></a>                    <span class="c1"># then find the zero.</span>
</span><span id="Die.__init__-191"><a href="#Die.__init__-191"><span class="linenos">191</span></a>                    <span class="n">test</span> <span class="o">=</span> <span class="n">Die</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span>
</span><span id="Die.__init__-192"><a href="#Die.__init__-192"><span class="linenos">192</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="Die.__init__-193"><a href="#Die.__init__-193"><span class="linenos">193</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">)</span>
</span><span id="Die.__init__-194"><a href="#Die.__init__-194"><span class="linenos">194</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.__init__-195"><a href="#Die.__init__-195"><span class="linenos">195</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.__init__-196"><a href="#Die.__init__-196"><span class="linenos">196</span></a>                            <span class="s1">&#39;If all outcomes contain Again, an explicit again_end must be provided.&#39;</span>
</span><span id="Die.__init__-197"><a href="#Die.__init__-197"><span class="linenos">197</span></a>                        <span class="p">)</span>
</span><span id="Die.__init__-198"><a href="#Die.__init__-198"><span class="linenos">198</span></a>                    <span class="n">again_end</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
</span><span id="Die.__init__-199"><a href="#Die.__init__-199"><span class="linenos">199</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die.__init__-200"><a href="#Die.__init__-200"><span class="linenos">200</span></a>                    <span class="n">again_end</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die.__init__-201"><a href="#Die.__init__-201"><span class="linenos">201</span></a>                    <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">again_end</span><span class="p">):</span>
</span><span id="Die.__init__-202"><a href="#Die.__init__-202"><span class="linenos">202</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.__init__-203"><a href="#Die.__init__-203"><span class="linenos">203</span></a>                            <span class="s1">&#39;again_end cannot itself contain Again.&#39;</span><span class="p">)</span>
</span><span id="Die.__init__-204"><a href="#Die.__init__-204"><span class="linenos">204</span></a>                <span class="k">if</span> <span class="n">again_depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.__init__-205"><a href="#Die.__init__-205"><span class="linenos">205</span></a>                    <span class="c1"># Base case.</span>
</span><span id="Die.__init__-206"><a href="#Die.__init__-206"><span class="linenos">206</span></a>                    <span class="n">outcomes</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">sub_agains</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">again_end</span><span class="p">)</span>
</span><span id="Die.__init__-207"><a href="#Die.__init__-207"><span class="linenos">207</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die.__init__-208"><a href="#Die.__init__-208"><span class="linenos">208</span></a>                    <span class="n">tail</span> <span class="o">=</span> <span class="n">Die</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span>
</span><span id="Die.__init__-209"><a href="#Die.__init__-209"><span class="linenos">209</span></a>                               <span class="n">times</span><span class="p">,</span>
</span><span id="Die.__init__-210"><a href="#Die.__init__-210"><span class="linenos">210</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.__init__-211"><a href="#Die.__init__-211"><span class="linenos">211</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die.__init__-212"><a href="#Die.__init__-212"><span class="linenos">212</span></a>                    <span class="n">outcomes</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">sub_agains</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>
</span><span id="Die.__init__-213"><a href="#Die.__init__-213"><span class="linenos">213</span></a>
</span><span id="Die.__init__-214"><a href="#Die.__init__-214"><span class="linenos">214</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die.__init__-215"><a href="#Die.__init__-215"><span class="linenos">215</span></a>
</span><span id="Die.__init__-216"><a href="#Die.__init__-216"><span class="linenos">216</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Die.__init__-217"><a href="#Die.__init__-217"><span class="linenos">217</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die.__init__-218"><a href="#Die.__init__-218"><span class="linenos">218</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Die.__init__-219"><a href="#Die.__init__-219"><span class="linenos">219</span></a>
</span><span id="Die.__init__-220"><a href="#Die.__init__-220"><span class="linenos">220</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Population</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Die.__init__-221"><a href="#Die.__init__-221"><span class="linenos">221</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_die</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Die.__init__-222"><a href="#Die.__init__-222"><span class="linenos">222</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Constructor for a <code><a href="#Die">Die</a></code>.</p>

<p>Don't confuse this with <code><a href="#d">d()</a></code>:</p>

<ul>
<li><code>Die([6])</code>: A <code><a href="#Die">Die</a></code> that always rolls the <code>int</code> 6.</li>
<li><code>d(6)</code>: A d6.</li>
</ul>

<p>Also, don't confuse this with <code><a href="#Pool">Pool()</a></code>:</p>

<ul>
<li><code>Die([1, 2, 3, 4, 5, 6])</code>: A d6.</li>
<li><code>Pool([1, 2, 3, 4, 5, 6])</code>: A <code><a href="#Pool">Pool</a></code> of six dice that always rolls one
of each number.</li>
</ul>

<p>Here are some different ways of constructing a d6:</p>

<ul>
<li>Just import it: <code>from icepool import d6</code></li>
<li>Use the <code><a href="#d">d()</a></code> function: <code><a href="#d">icepool.d</a>(6)</code></li>
<li>Use a d6 that you already have: <code>Die(d6)</code> or <code>Die([d6])</code></li>
<li>Mix a d3 and a d3+3: <code>Die([d3, d3+3])</code></li>
<li>Use a dict: <code>Die({1:1, 2:1, 3:1, 4:1, 5:1, 6:1})</code></li>
<li>Give the faces as a sequence: <code>Die([1, 2, 3, 4, 5, 6])</code></li>
</ul>

<p>All quantities must be non-negative, though they can be zero.</p>

<p>Several methods and functions foward **kwargs to this constructor.
However, these only affect the construction of the returned or yielded
dice. Any other implicit conversions of arguments or operands to dice
will be done with the default keyword arguments.</p>

<p>EXPERIMENTAL: Use <code><a href="#Again">icepool.Again()</a></code> to roll the dice again, usually with
some modification. For example,</p>

<pre><code>Die([1, 2, 3, 4, 5, 6 + Again()])
</code></pre>

<p>would be an exploding d6. Use the <code>again_depth</code> parameter to control
the maximum depth. <code>again_depth</code> does not apply to <code><a href="#Reroll">Reroll</a></code>.</p>

<p>If the roll reaches the maximum depth, the <code>again_end</code> is used instead
of rolling again. Options for <code>again_end</code> include:</p>

<ul>
<li>No value (<code>None</code>), which will attempt to determine a zero value from
the outcomes that don't involve <code><a href="#Again">Again</a></code>.</li>
<li>A single outcome, or a <code><a href="#Die">Die</a></code>.</li>
<li><code><a href="#Reroll">Reroll</a></code>, which will reroll any end roll involving <code><a href="#Again">Again</a></code>.</li>
<li>You could also consider some sort of placeholder value such as
<code>math.inf</code>.</li>
</ul>

<p>Denominator: For a flat set of outcomes, the denominator is just the
sum of the corresponding quantities. If the outcomes themselves have
secondary denominators, then the overall denominator is the primary
denominator times the LCM of the outcome denominators.</p>

<p>For example, <code>Die([d3, d4, d6])</code> has a final denominator of 36: 3 for
the primary selection between the three secondary dice, times 12 for
the LCM of 3, 4, and 6.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>outcomes:</strong>  The faces of the <code><a href="#Die">Die</a></code>. This can be one of the following:</p>

<ul>
<li>A <code>Mapping</code> from outcomes to quantities.</li>
<li>A sequence of outcomes. Each element will have the same total
quantity.</li>
</ul>

<p>Note that <code><a href="#Die">Die</a></code> and <code><a href="#Deck">Deck</a></code> both count as <code>Mapping</code>s.
Each outcome may be one of the following:</p>

<ul>
<li>A <code>Mapping</code> from outcomes to quantities.
The outcomes of the <code>Mapping</code> will be "flattened" into the
result. This option will be taken in preference to treating
the <code>Mapping</code> itself as an outcome even if the <code>Mapping</code>
itself is hashable and totally orderable. This means that
<code><a href="#Die">Die</a></code> and <code><a href="#Deck">Deck</a></code> will never be outcomes.</li>
<li><p>A tuple of outcomes. Operators on dice with tuple outcomes
are performed element-wise. See <code><a href="#Die.unary_op">Die.unary_op</a></code> and
<code><a href="#Die.binary_op">Die.binary_op</a></code> for details.</p>

<p>Any tuple elements that are <code>Mapping</code>s will expand the
tuple according to their independent joint distribution.
For example, <code>(d6, d6)</code> will expand to 36 ordered tuples
with quantity 1 each. Use this carefully since it may create a
large number of outcomes.</p></li>
<li><code>str</code> or <code>bytes</code>, which will be treated as a single outcome.</li>
<li>Any other sequence. Each element will be weighted equally.</li>
<li><code><a href="#Reroll">icepool.Reroll</a></code>, which will drop itself
and the corresponding element of <code>times</code> from consideration.
If inside a tuple, the tuple will be dropped.</li>
<li>Anything else will be treated as a single outcome.
Each outcome must be hashable, and the
set of outcomes must be totally orderable (after expansion).
The same outcome can appear multiple times, in which case
the corresponding quantities will be accumulated.</li>
</ul></li>
<li><strong>times:</strong>  Multiplies the quantity of each element of <code><a href="#Die.outcomes">outcomes</a></code>.
<code>times</code> can either be a sequence of the same length as
<code><a href="#Die.outcomes">outcomes</a></code> or a single <code>int</code> to apply to all elements of
<code><a href="#Die.outcomes">outcomes</a></code>.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  <code>None</code> is not a valid outcome for a <code><a href="#Die">Die</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Die.unary_op" class="classattr">
                                        <input id="Die.unary_op-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unary_op</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">op</span><span class="p">:</span> <span class="n">Callable</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.unary_op-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.unary_op"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.unary_op-224"><a href="#Die.unary_op-224"><span class="linenos">224</span></a>    <span class="k">def</span> <span class="nf">unary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.unary_op-225"><a href="#Die.unary_op-225"><span class="linenos">225</span></a>        <span class="sd">&quot;&quot;&quot;Performs the unary operation on the outcomes.</span>
</span><span id="Die.unary_op-226"><a href="#Die.unary_op-226"><span class="linenos">226</span></a>
</span><span id="Die.unary_op-227"><a href="#Die.unary_op-227"><span class="linenos">227</span></a><span class="sd">        Operations on tuples are performed elementwise recursively. If you need</span>
</span><span id="Die.unary_op-228"><a href="#Die.unary_op-228"><span class="linenos">228</span></a><span class="sd">        some other specific behavior, use your own outcome class, or use `sub()`</span>
</span><span id="Die.unary_op-229"><a href="#Die.unary_op-229"><span class="linenos">229</span></a><span class="sd">        rather than an operator.</span>
</span><span id="Die.unary_op-230"><a href="#Die.unary_op-230"><span class="linenos">230</span></a>
</span><span id="Die.unary_op-231"><a href="#Die.unary_op-231"><span class="linenos">231</span></a><span class="sd">        This is used for the standard unary operators</span>
</span><span id="Die.unary_op-232"><a href="#Die.unary_op-232"><span class="linenos">232</span></a><span class="sd">        `-, +, abs, ~, round, trunc, floor, ceil`</span>
</span><span id="Die.unary_op-233"><a href="#Die.unary_op-233"><span class="linenos">233</span></a><span class="sd">        as well as the additional methods</span>
</span><span id="Die.unary_op-234"><a href="#Die.unary_op-234"><span class="linenos">234</span></a><span class="sd">        `zero, bool`.</span>
</span><span id="Die.unary_op-235"><a href="#Die.unary_op-235"><span class="linenos">235</span></a>
</span><span id="Die.unary_op-236"><a href="#Die.unary_op-236"><span class="linenos">236</span></a><span class="sd">        This is NOT used for the `[]` operator; when used directly, this is</span>
</span><span id="Die.unary_op-237"><a href="#Die.unary_op-237"><span class="linenos">237</span></a><span class="sd">        interpreted as a `Mapping` operation and returns the count corresponding</span>
</span><span id="Die.unary_op-238"><a href="#Die.unary_op-238"><span class="linenos">238</span></a><span class="sd">        to a given outcome. See `marginals()` for applying the `[]` operator to</span>
</span><span id="Die.unary_op-239"><a href="#Die.unary_op-239"><span class="linenos">239</span></a><span class="sd">        outcomes.</span>
</span><span id="Die.unary_op-240"><a href="#Die.unary_op-240"><span class="linenos">240</span></a>
</span><span id="Die.unary_op-241"><a href="#Die.unary_op-241"><span class="linenos">241</span></a><span class="sd">        Returns:</span>
</span><span id="Die.unary_op-242"><a href="#Die.unary_op-242"><span class="linenos">242</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die.unary_op-243"><a href="#Die.unary_op-243"><span class="linenos">243</span></a>
</span><span id="Die.unary_op-244"><a href="#Die.unary_op-244"><span class="linenos">244</span></a><span class="sd">        Raises:</span>
</span><span id="Die.unary_op-245"><a href="#Die.unary_op-245"><span class="linenos">245</span></a><span class="sd">            ValueError: If tuples are of mismatched length.</span>
</span><span id="Die.unary_op-246"><a href="#Die.unary_op-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.unary_op-247"><a href="#Die.unary_op-247"><span class="linenos">247</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die.unary_op-248"><a href="#Die.unary_op-248"><span class="linenos">248</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die.unary_op-249"><a href="#Die.unary_op-249"><span class="linenos">249</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">unary_elementwise</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Die.unary_op-250"><a href="#Die.unary_op-250"><span class="linenos">250</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die.unary_op-251"><a href="#Die.unary_op-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs the unary operation on the outcomes.</p>

<p>Operations on tuples are performed elementwise recursively. If you need
some other specific behavior, use your own outcome class, or use <code><a href="#Die.sub">sub()</a></code>
rather than an operator.</p>

<p>This is used for the standard unary operators
<code>-, +, abs, ~, round, trunc, floor, ceil</code>
as well as the additional methods
<code>zero, bool</code>.</p>

<p>This is NOT used for the <code>[]</code> operator; when used directly, this is
interpreted as a <code>Mapping</code> operation and returns the count corresponding
to a given outcome. See <code><a href="#Die.marginals">marginals()</a></code> for applying the <code>[]</code> operator to
outcomes.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the result.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If tuples are of mismatched length.</li>
</ul>
</div>


                            </div>
                            <div id="Die.binary_op" class="classattr">
                                        <input id="Die.binary_op-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">binary_op</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">other</span><span class="p">:</span> <span class="n"><a href="#Die">icepool.Die</a></span>,</span><span class="param">	<span class="n">op</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="o">*</span><span class="n">args</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.binary_op-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.binary_op"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.binary_op-253"><a href="#Die.binary_op-253"><span class="linenos">253</span></a>    <span class="k">def</span> <span class="nf">binary_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s1">&#39;Die&#39;</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.binary_op-254"><a href="#Die.binary_op-254"><span class="linenos">254</span></a>        <span class="sd">&quot;&quot;&quot;Performs the operation on pairs of outcomes.</span>
</span><span id="Die.binary_op-255"><a href="#Die.binary_op-255"><span class="linenos">255</span></a>
</span><span id="Die.binary_op-256"><a href="#Die.binary_op-256"><span class="linenos">256</span></a><span class="sd">        Operations on tuples are performed elementwise recursively. If you need</span>
</span><span id="Die.binary_op-257"><a href="#Die.binary_op-257"><span class="linenos">257</span></a><span class="sd">        some other specific behavior, use your own outcome class, or use `sub()`</span>
</span><span id="Die.binary_op-258"><a href="#Die.binary_op-258"><span class="linenos">258</span></a><span class="sd">        rather than an operator.</span>
</span><span id="Die.binary_op-259"><a href="#Die.binary_op-259"><span class="linenos">259</span></a>
</span><span id="Die.binary_op-260"><a href="#Die.binary_op-260"><span class="linenos">260</span></a><span class="sd">        By the time this is called, the other operand has already been</span>
</span><span id="Die.binary_op-261"><a href="#Die.binary_op-261"><span class="linenos">261</span></a><span class="sd">        converted to a `Die`.</span>
</span><span id="Die.binary_op-262"><a href="#Die.binary_op-262"><span class="linenos">262</span></a>
</span><span id="Die.binary_op-263"><a href="#Die.binary_op-263"><span class="linenos">263</span></a><span class="sd">        This is used for the standard binary operators</span>
</span><span id="Die.binary_op-264"><a href="#Die.binary_op-264"><span class="linenos">264</span></a><span class="sd">        `+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^`.</span>
</span><span id="Die.binary_op-265"><a href="#Die.binary_op-265"><span class="linenos">265</span></a><span class="sd">        Note that `*` multiplies outcomes directly;</span>
</span><span id="Die.binary_op-266"><a href="#Die.binary_op-266"><span class="linenos">266</span></a><span class="sd">        it is not the same as `@`, which rolls the right side multiple times,</span>
</span><span id="Die.binary_op-267"><a href="#Die.binary_op-267"><span class="linenos">267</span></a><span class="sd">        or `d()`, which creates a standard die.</span>
</span><span id="Die.binary_op-268"><a href="#Die.binary_op-268"><span class="linenos">268</span></a>
</span><span id="Die.binary_op-269"><a href="#Die.binary_op-269"><span class="linenos">269</span></a><span class="sd">        The comparators (`&lt;, &lt;=, &gt;=, &gt;, ==, !=, cmp`) use a linear algorithm</span>
</span><span id="Die.binary_op-270"><a href="#Die.binary_op-270"><span class="linenos">270</span></a><span class="sd">        using the fact that outcomes are totally ordered.</span>
</span><span id="Die.binary_op-271"><a href="#Die.binary_op-271"><span class="linenos">271</span></a>
</span><span id="Die.binary_op-272"><a href="#Die.binary_op-272"><span class="linenos">272</span></a><span class="sd">        `==` and `!=` additionally set the truth value of the `Die` according to</span>
</span><span id="Die.binary_op-273"><a href="#Die.binary_op-273"><span class="linenos">273</span></a><span class="sd">        whether the dice themselves are the same or not.</span>
</span><span id="Die.binary_op-274"><a href="#Die.binary_op-274"><span class="linenos">274</span></a>
</span><span id="Die.binary_op-275"><a href="#Die.binary_op-275"><span class="linenos">275</span></a><span class="sd">        The `@` operator does NOT use this method directly.</span>
</span><span id="Die.binary_op-276"><a href="#Die.binary_op-276"><span class="linenos">276</span></a><span class="sd">        It rolls the left `Die`, which must have integer outcomes,</span>
</span><span id="Die.binary_op-277"><a href="#Die.binary_op-277"><span class="linenos">277</span></a><span class="sd">        then rolls the right `Die` that many times and sums the outcomes.</span>
</span><span id="Die.binary_op-278"><a href="#Die.binary_op-278"><span class="linenos">278</span></a><span class="sd">        Only the sum is performed element-wise.</span>
</span><span id="Die.binary_op-279"><a href="#Die.binary_op-279"><span class="linenos">279</span></a>
</span><span id="Die.binary_op-280"><a href="#Die.binary_op-280"><span class="linenos">280</span></a><span class="sd">        Returns:</span>
</span><span id="Die.binary_op-281"><a href="#Die.binary_op-281"><span class="linenos">281</span></a><span class="sd">            A `Die` representing the result.</span>
</span><span id="Die.binary_op-282"><a href="#Die.binary_op-282"><span class="linenos">282</span></a>
</span><span id="Die.binary_op-283"><a href="#Die.binary_op-283"><span class="linenos">283</span></a><span class="sd">        Raises:</span>
</span><span id="Die.binary_op-284"><a href="#Die.binary_op-284"><span class="linenos">284</span></a><span class="sd">            ValueError: If tuples are of mismatched length within one of the</span>
</span><span id="Die.binary_op-285"><a href="#Die.binary_op-285"><span class="linenos">285</span></a><span class="sd">                dice or between the dice.</span>
</span><span id="Die.binary_op-286"><a href="#Die.binary_op-286"><span class="linenos">286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.binary_op-287"><a href="#Die.binary_op-287"><span class="linenos">287</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die.binary_op-288"><a href="#Die.binary_op-288"><span class="linenos">288</span></a>        <span class="k">for</span> <span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span>
</span><span id="Die.binary_op-289"><a href="#Die.binary_op-289"><span class="linenos">289</span></a>             <span class="n">quantity_self</span><span class="p">),</span> <span class="p">(</span><span class="n">outcome_other</span><span class="p">,</span>
</span><span id="Die.binary_op-290"><a href="#Die.binary_op-290"><span class="linenos">290</span></a>                              <span class="n">quantity_other</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span>
</span><span id="Die.binary_op-291"><a href="#Die.binary_op-291"><span class="linenos">291</span></a>                                  <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="Die.binary_op-292"><a href="#Die.binary_op-292"><span class="linenos">292</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">binary_elementwise</span><span class="p">(</span><span class="n">outcome_self</span><span class="p">,</span> <span class="n">outcome_other</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span>
</span><span id="Die.binary_op-293"><a href="#Die.binary_op-293"><span class="linenos">293</span></a>                                             <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Die.binary_op-294"><a href="#Die.binary_op-294"><span class="linenos">294</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity_self</span> <span class="o">*</span> <span class="n">quantity_other</span>
</span><span id="Die.binary_op-295"><a href="#Die.binary_op-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs the operation on pairs of outcomes.</p>

<p>Operations on tuples are performed elementwise recursively. If you need
some other specific behavior, use your own outcome class, or use <code><a href="#Die.sub">sub()</a></code>
rather than an operator.</p>

<p>By the time this is called, the other operand has already been
converted to a <code><a href="#Die">Die</a></code>.</p>

<p>This is used for the standard binary operators
<code>+, -, *, /, //, %, **, &lt;&lt;, &gt;&gt;, &amp;, |, ^</code>.
Note that <code>*</code> multiplies outcomes directly;
it is not the same as <code>@</code>, which rolls the right side multiple times,
or <code><a href="#d">d()</a></code>, which creates a standard die.</p>

<p>The comparators (<code>&lt;, &lt;=, &gt;=, &gt;, ==, !=, cmp</code>) use a linear algorithm
using the fact that outcomes are totally ordered.</p>

<p><code>==</code> and <code>!=</code> additionally set the truth value of the <code><a href="#Die">Die</a></code> according to
whether the dice themselves are the same or not.</p>

<p>The <code>@</code> operator does NOT use this method directly.
It rolls the left <code><a href="#Die">Die</a></code>, which must have integer outcomes,
then rolls the right <code><a href="#Die">Die</a></code> that many times and sums the outcomes.
Only the sum is performed element-wise.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the result.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If tuples are of mismatched length within one of the
dice or between the dice.</li>
</ul>
</div>


                            </div>
                            <div id="Die.keys" class="classattr">
                                        <input id="Die.keys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">icepool.CountsKeysView</a></span>:</span></span>

                <label class="view-source-button" for="Die.keys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.keys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.keys-299"><a href="#Die.keys-299"><span class="linenos">299</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Die.keys-300"><a href="#Die.keys-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes within the population in sorted order.</p>
</div>


                            </div>
                            <div id="Die.values" class="classattr">
                                        <input id="Die.values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsValuesView">icepool.CountsValuesView</a></span>:</span></span>

                <label class="view-source-button" for="Die.values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.values-302"><a href="#Die.values-302"><span class="linenos">302</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Die.values-303"><a href="#Die.values-303"><span class="linenos">303</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The quantities within the population in outcome order.</p>
</div>


                            </div>
                            <div id="Die.items" class="classattr">
                                        <input id="Die.items-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">items</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsItemsView">icepool.CountsItemsView</a></span>:</span></span>

                <label class="view-source-button" for="Die.items-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.items"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.items-305"><a href="#Die.items-305"><span class="linenos">305</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">:</span>
</span><span id="Die.items-306"><a href="#Die.items-306"><span class="linenos">306</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The (outcome, quantity)s of the population in sorted order.</p>
</div>


                            </div>
                            <div id="Die.simplify" class="classattr">
                                        <input id="Die.simplify-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">simplify</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.simplify-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.simplify"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.simplify-323"><a href="#Die.simplify-323"><span class="linenos">323</span></a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.simplify-324"><a href="#Die.simplify-324"><span class="linenos">324</span></a>        <span class="sd">&quot;&quot;&quot;Divides all quantities by their greatest common denominator. &quot;&quot;&quot;</span>
</span><span id="Die.simplify-325"><a href="#Die.simplify-325"><span class="linenos">325</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">simplify</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Divides all quantities by their greatest common denominator.</p>
</div>


                            </div>
                            <div id="Die.reroll" class="classattr">
                                        <input id="Die.reroll-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reroll</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Container</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">extra_args</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.reroll-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.reroll"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.reroll-329"><a href="#Die.reroll-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">reroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.reroll-330"><a href="#Die.reroll-330"><span class="linenos">330</span></a>               <span class="n">outcomes</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Container</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.reroll-331"><a href="#Die.reroll-331"><span class="linenos">331</span></a>               <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.reroll-332"><a href="#Die.reroll-332"><span class="linenos">332</span></a>               <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.reroll-333"><a href="#Die.reroll-333"><span class="linenos">333</span></a>               <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.reroll-334"><a href="#Die.reroll-334"><span class="linenos">334</span></a>        <span class="sd">&quot;&quot;&quot;Rerolls the given outcomes.</span>
</span><span id="Die.reroll-335"><a href="#Die.reroll-335"><span class="linenos">335</span></a>
</span><span id="Die.reroll-336"><a href="#Die.reroll-336"><span class="linenos">336</span></a><span class="sd">        Args:</span>
</span><span id="Die.reroll-337"><a href="#Die.reroll-337"><span class="linenos">337</span></a><span class="sd">            outcomes: Selects which outcomes to reroll. Options:</span>
</span><span id="Die.reroll-338"><a href="#Die.reroll-338"><span class="linenos">338</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.reroll-339"><a href="#Die.reroll-339"><span class="linenos">339</span></a><span class="sd">                    should be rerolled.</span>
</span><span id="Die.reroll-340"><a href="#Die.reroll-340"><span class="linenos">340</span></a><span class="sd">                * A container of outcomes to reroll.</span>
</span><span id="Die.reroll-341"><a href="#Die.reroll-341"><span class="linenos">341</span></a><span class="sd">                * If not provided, the min outcome will be rerolled.</span>
</span><span id="Die.reroll-342"><a href="#Die.reroll-342"><span class="linenos">342</span></a><span class="sd">            *extra_args: These will be supplied to `outcomes` as extra</span>
</span><span id="Die.reroll-343"><a href="#Die.reroll-343"><span class="linenos">343</span></a><span class="sd">                positional arguments after the outcome argument(s).</span>
</span><span id="Die.reroll-344"><a href="#Die.reroll-344"><span class="linenos">344</span></a><span class="sd">                `extra_args` can only be supplied if `outcomes` is callable.</span>
</span><span id="Die.reroll-345"><a href="#Die.reroll-345"><span class="linenos">345</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die.reroll-346"><a href="#Die.reroll-346"><span class="linenos">346</span></a><span class="sd">                If omitted, rerolls an unlimited number of times.</span>
</span><span id="Die.reroll-347"><a href="#Die.reroll-347"><span class="linenos">347</span></a><span class="sd">            star: If set to `True` or 1, outcomes will be unpacked as</span>
</span><span id="Die.reroll-348"><a href="#Die.reroll-348"><span class="linenos">348</span></a><span class="sd">                `*outcome` before giving it to the `outcomes` function.</span>
</span><span id="Die.reroll-349"><a href="#Die.reroll-349"><span class="linenos">349</span></a><span class="sd">                If `outcomes` is not a callable, this has no effect.</span>
</span><span id="Die.reroll-350"><a href="#Die.reroll-350"><span class="linenos">350</span></a>
</span><span id="Die.reroll-351"><a href="#Die.reroll-351"><span class="linenos">351</span></a><span class="sd">        Returns:</span>
</span><span id="Die.reroll-352"><a href="#Die.reroll-352"><span class="linenos">352</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die.reroll-353"><a href="#Die.reroll-353"><span class="linenos">353</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die.reroll-354"><a href="#Die.reroll-354"><span class="linenos">354</span></a>
</span><span id="Die.reroll-355"><a href="#Die.reroll-355"><span class="linenos">355</span></a><span class="sd">        Raises:</span>
</span><span id="Die.reroll-356"><a href="#Die.reroll-356"><span class="linenos">356</span></a><span class="sd">            ValueError: If `extra_args` are supplied with a non-callable `outcomes`.</span>
</span><span id="Die.reroll-357"><a href="#Die.reroll-357"><span class="linenos">357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.reroll-358"><a href="#Die.reroll-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.reroll-359"><a href="#Die.reroll-359"><span class="linenos">359</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.reroll-360"><a href="#Die.reroll-360"><span class="linenos">360</span></a>                <span class="s1">&#39;Extra positional arguments are only valid if outcomes is callable.&#39;</span>
</span><span id="Die.reroll-361"><a href="#Die.reroll-361"><span class="linenos">361</span></a>            <span class="p">)</span>
</span><span id="Die.reroll-362"><a href="#Die.reroll-362"><span class="linenos">362</span></a>
</span><span id="Die.reroll-363"><a href="#Die.reroll-363"><span class="linenos">363</span></a>        <span class="k">if</span> <span class="n">outcomes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.reroll-364"><a href="#Die.reroll-364"><span class="linenos">364</span></a>            <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()}</span>
</span><span id="Die.reroll-365"><a href="#Die.reroll-365"><span class="linenos">365</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.reroll-366"><a href="#Die.reroll-366"><span class="linenos">366</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die.reroll-367"><a href="#Die.reroll-367"><span class="linenos">367</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll-368"><a href="#Die.reroll-368"><span class="linenos">368</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.reroll-369"><a href="#Die.reroll-369"><span class="linenos">369</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die.reroll-370"><a href="#Die.reroll-370"><span class="linenos">370</span></a>                <span class="p">}</span>
</span><span id="Die.reroll-371"><a href="#Die.reroll-371"><span class="linenos">371</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.reroll-372"><a href="#Die.reroll-372"><span class="linenos">372</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll-373"><a href="#Die.reroll-373"><span class="linenos">373</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.reroll-374"><a href="#Die.reroll-374"><span class="linenos">374</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die.reroll-375"><a href="#Die.reroll-375"><span class="linenos">375</span></a>                <span class="p">}</span>
</span><span id="Die.reroll-376"><a href="#Die.reroll-376"><span class="linenos">376</span></a>
</span><span id="Die.reroll-377"><a href="#Die.reroll-377"><span class="linenos">377</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.reroll-378"><a href="#Die.reroll-378"><span class="linenos">378</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll-379"><a href="#Die.reroll-379"><span class="linenos">379</span></a>                <span class="n">outcome</span><span class="p">:</span> <span class="n">quantity</span>
</span><span id="Die.reroll-380"><a href="#Die.reroll-380"><span class="linenos">380</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die.reroll-381"><a href="#Die.reroll-381"><span class="linenos">381</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outcomes</span>
</span><span id="Die.reroll-382"><a href="#Die.reroll-382"><span class="linenos">382</span></a>            <span class="p">}</span>
</span><span id="Die.reroll-383"><a href="#Die.reroll-383"><span class="linenos">383</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.reroll-384"><a href="#Die.reroll-384"><span class="linenos">384</span></a>            <span class="n">total_reroll_quantity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Die.reroll-385"><a href="#Die.reroll-385"><span class="linenos">385</span></a>                <span class="n">quantity</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die.reroll-386"><a href="#Die.reroll-386"><span class="linenos">386</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">)</span>
</span><span id="Die.reroll-387"><a href="#Die.reroll-387"><span class="linenos">387</span></a>            <span class="n">rerollable_factor</span> <span class="o">=</span> <span class="n">total_reroll_quantity</span><span class="o">**</span><span class="n">depth</span>
</span><span id="Die.reroll-388"><a href="#Die.reroll-388"><span class="linenos">388</span></a>            <span class="n">stop_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="n">depth</span> <span class="o">+</span>
</span><span id="Die.reroll-389"><a href="#Die.reroll-389"><span class="linenos">389</span></a>                           <span class="n">total_reroll_quantity</span><span class="o">**</span><span class="n">depth</span><span class="p">)</span>
</span><span id="Die.reroll-390"><a href="#Die.reroll-390"><span class="linenos">390</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll-391"><a href="#Die.reroll-391"><span class="linenos">391</span></a>                <span class="n">outcome</span><span class="p">:</span>
</span><span id="Die.reroll-392"><a href="#Die.reroll-392"><span class="linenos">392</span></a>                <span class="p">(</span><span class="n">rerollable_factor</span> <span class="o">*</span>
</span><span id="Die.reroll-393"><a href="#Die.reroll-393"><span class="linenos">393</span></a>                 <span class="n">quantity</span> <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span> <span class="k">else</span> <span class="n">stop_factor</span> <span class="o">*</span> <span class="n">quantity</span><span class="p">)</span>
</span><span id="Die.reroll-394"><a href="#Die.reroll-394"><span class="linenos">394</span></a>                <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Die.reroll-395"><a href="#Die.reroll-395"><span class="linenos">395</span></a>            <span class="p">}</span>
</span><span id="Die.reroll-396"><a href="#Die.reroll-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rerolls the given outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>outcomes:</strong>  Selects which outcomes to reroll. Options:
<ul>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be rerolled.</li>
<li>A container of outcomes to reroll.</li>
<li>If not provided, the min outcome will be rerolled.</li>
</ul></li>
<li><strong>*extra_args:</strong>  These will be supplied to <code><a href="#Die.outcomes">outcomes</a></code> as extra
positional arguments after the outcome argument(s).
<code>extra_args</code> can only be supplied if <code><a href="#Die.outcomes">outcomes</a></code> is callable.</li>
<li><strong>depth:</strong>  The maximum number of times to reroll.
If omitted, rerolls an unlimited number of times.</li>
<li><strong>star:</strong>  If set to <code>True</code> or 1, outcomes will be unpacked as
<code>*outcome</code> before giving it to the <code><a href="#Die.outcomes">outcomes</a></code> function.
If <code><a href="#Die.outcomes">outcomes</a></code> is not a callable, this has no effect.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the reroll.
  If the reroll would never terminate, the result has no outcomes.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If <code>extra_args</code> are supplied with a non-callable <code><a href="#Die.outcomes">outcomes</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Die.reroll_until" class="classattr">
                                        <input id="Die.reroll_until-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reroll_until</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Container</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span><span class="n">extra_args</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.reroll_until-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.reroll_until"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.reroll_until-398"><a href="#Die.reroll_until-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">reroll_until</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.reroll_until-399"><a href="#Die.reroll_until-399"><span class="linenos">399</span></a>                     <span class="n">outcomes</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="n">Container</span><span class="p">,</span>
</span><span id="Die.reroll_until-400"><a href="#Die.reroll_until-400"><span class="linenos">400</span></a>                     <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.reroll_until-401"><a href="#Die.reroll_until-401"><span class="linenos">401</span></a>                     <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.reroll_until-402"><a href="#Die.reroll_until-402"><span class="linenos">402</span></a>                     <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.reroll_until-403"><a href="#Die.reroll_until-403"><span class="linenos">403</span></a>        <span class="sd">&quot;&quot;&quot;Rerolls until getting one of the given outcomes.</span>
</span><span id="Die.reroll_until-404"><a href="#Die.reroll_until-404"><span class="linenos">404</span></a>
</span><span id="Die.reroll_until-405"><a href="#Die.reroll_until-405"><span class="linenos">405</span></a><span class="sd">        Essentially the complement of `reroll()`.</span>
</span><span id="Die.reroll_until-406"><a href="#Die.reroll_until-406"><span class="linenos">406</span></a>
</span><span id="Die.reroll_until-407"><a href="#Die.reroll_until-407"><span class="linenos">407</span></a><span class="sd">        Args:</span>
</span><span id="Die.reroll_until-408"><a href="#Die.reroll_until-408"><span class="linenos">408</span></a><span class="sd">            outcomes: Selects which outcomes to reroll until. Options:</span>
</span><span id="Die.reroll_until-409"><a href="#Die.reroll_until-409"><span class="linenos">409</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.reroll_until-410"><a href="#Die.reroll_until-410"><span class="linenos">410</span></a><span class="sd">                    should be accepted.</span>
</span><span id="Die.reroll_until-411"><a href="#Die.reroll_until-411"><span class="linenos">411</span></a><span class="sd">                * A container of outcomes to reroll until.</span>
</span><span id="Die.reroll_until-412"><a href="#Die.reroll_until-412"><span class="linenos">412</span></a><span class="sd">            *extra_args: These will be supplied to `outcomes` as extra</span>
</span><span id="Die.reroll_until-413"><a href="#Die.reroll_until-413"><span class="linenos">413</span></a><span class="sd">                positional arguments after the outcome argument(s).</span>
</span><span id="Die.reroll_until-414"><a href="#Die.reroll_until-414"><span class="linenos">414</span></a><span class="sd">                `extra_args` can only be supplied if `outcomes` is callable.</span>
</span><span id="Die.reroll_until-415"><a href="#Die.reroll_until-415"><span class="linenos">415</span></a><span class="sd">            depth: The maximum number of times to reroll.</span>
</span><span id="Die.reroll_until-416"><a href="#Die.reroll_until-416"><span class="linenos">416</span></a><span class="sd">                If omitted, rerolls an unlimited number of times.</span>
</span><span id="Die.reroll_until-417"><a href="#Die.reroll_until-417"><span class="linenos">417</span></a><span class="sd">            star: If set to `True` or 1, outcomes will be unpacked as</span>
</span><span id="Die.reroll_until-418"><a href="#Die.reroll_until-418"><span class="linenos">418</span></a><span class="sd">                `*outcome` before giving it to the `outcomes` function.</span>
</span><span id="Die.reroll_until-419"><a href="#Die.reroll_until-419"><span class="linenos">419</span></a><span class="sd">                If `outcomes` is not a callable, this has no effect.</span>
</span><span id="Die.reroll_until-420"><a href="#Die.reroll_until-420"><span class="linenos">420</span></a>
</span><span id="Die.reroll_until-421"><a href="#Die.reroll_until-421"><span class="linenos">421</span></a><span class="sd">        Returns:</span>
</span><span id="Die.reroll_until-422"><a href="#Die.reroll_until-422"><span class="linenos">422</span></a><span class="sd">            A `Die` representing the reroll.</span>
</span><span id="Die.reroll_until-423"><a href="#Die.reroll_until-423"><span class="linenos">423</span></a><span class="sd">            If the reroll would never terminate, the result has no outcomes.</span>
</span><span id="Die.reroll_until-424"><a href="#Die.reroll_until-424"><span class="linenos">424</span></a>
</span><span id="Die.reroll_until-425"><a href="#Die.reroll_until-425"><span class="linenos">425</span></a><span class="sd">        Raises:</span>
</span><span id="Die.reroll_until-426"><a href="#Die.reroll_until-426"><span class="linenos">426</span></a><span class="sd">            ValueError: If `extra_args` are supplied with a non-callable `outcomes`.</span>
</span><span id="Die.reroll_until-427"><a href="#Die.reroll_until-427"><span class="linenos">427</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.reroll_until-428"><a href="#Die.reroll_until-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.reroll_until-429"><a href="#Die.reroll_until-429"><span class="linenos">429</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.reroll_until-430"><a href="#Die.reroll_until-430"><span class="linenos">430</span></a>                <span class="s1">&#39;Extra positional arguments are only valid if outcomes is callable.&#39;</span>
</span><span id="Die.reroll_until-431"><a href="#Die.reroll_until-431"><span class="linenos">431</span></a>            <span class="p">)</span>
</span><span id="Die.reroll_until-432"><a href="#Die.reroll_until-432"><span class="linenos">432</span></a>
</span><span id="Die.reroll_until-433"><a href="#Die.reroll_until-433"><span class="linenos">433</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.reroll_until-434"><a href="#Die.reroll_until-434"><span class="linenos">434</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die.reroll_until-435"><a href="#Die.reroll_until-435"><span class="linenos">435</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll_until-436"><a href="#Die.reroll_until-436"><span class="linenos">436</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.reroll_until-437"><a href="#Die.reroll_until-437"><span class="linenos">437</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die.reroll_until-438"><a href="#Die.reroll_until-438"><span class="linenos">438</span></a>                <span class="p">}</span>
</span><span id="Die.reroll_until-439"><a href="#Die.reroll_until-439"><span class="linenos">439</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.reroll_until-440"><a href="#Die.reroll_until-440"><span class="linenos">440</span></a>                <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll_until-441"><a href="#Die.reroll_until-441"><span class="linenos">441</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.reroll_until-442"><a href="#Die.reroll_until-442"><span class="linenos">442</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die.reroll_until-443"><a href="#Die.reroll_until-443"><span class="linenos">443</span></a>                <span class="p">}</span>
</span><span id="Die.reroll_until-444"><a href="#Die.reroll_until-444"><span class="linenos">444</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.reroll_until-445"><a href="#Die.reroll_until-445"><span class="linenos">445</span></a>            <span class="n">not_outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.reroll_until-446"><a href="#Die.reroll_until-446"><span class="linenos">446</span></a>                <span class="n">not_outcome</span> <span class="k">for</span> <span class="n">not_outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.reroll_until-447"><a href="#Die.reroll_until-447"><span class="linenos">447</span></a>                <span class="k">if</span> <span class="n">not_outcome</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">outcomes</span>
</span><span id="Die.reroll_until-448"><a href="#Die.reroll_until-448"><span class="linenos">448</span></a>            <span class="p">}</span>
</span><span id="Die.reroll_until-449"><a href="#Die.reroll_until-449"><span class="linenos">449</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reroll</span><span class="p">(</span><span class="n">not_outcomes</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rerolls until getting one of the given outcomes.</p>

<p>Essentially the complement of <code><a href="#Die.reroll">reroll()</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>outcomes:</strong>  Selects which outcomes to reroll until. Options:
<ul>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be accepted.</li>
<li>A container of outcomes to reroll until.</li>
</ul></li>
<li><strong>*extra_args:</strong>  These will be supplied to <code><a href="#Die.outcomes">outcomes</a></code> as extra
positional arguments after the outcome argument(s).
<code>extra_args</code> can only be supplied if <code><a href="#Die.outcomes">outcomes</a></code> is callable.</li>
<li><strong>depth:</strong>  The maximum number of times to reroll.
If omitted, rerolls an unlimited number of times.</li>
<li><strong>star:</strong>  If set to <code>True</code> or 1, outcomes will be unpacked as
<code>*outcome</code> before giving it to the <code><a href="#Die.outcomes">outcomes</a></code> function.
If <code><a href="#Die.outcomes">outcomes</a></code> is not a callable, this has no effect.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the reroll.
  If the reroll would never terminate, the result has no outcomes.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If <code>extra_args</code> are supplied with a non-callable <code><a href="#Die.outcomes">outcomes</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Die.truncate" class="classattr">
                                        <input id="Die.truncate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">truncate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.truncate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.truncate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.truncate-451"><a href="#Die.truncate-451"><span class="linenos">451</span></a>    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.truncate-452"><a href="#Die.truncate-452"><span class="linenos">452</span></a>        <span class="sd">&quot;&quot;&quot;Truncates the outcomes of this `Die` to the given range.</span>
</span><span id="Die.truncate-453"><a href="#Die.truncate-453"><span class="linenos">453</span></a>
</span><span id="Die.truncate-454"><a href="#Die.truncate-454"><span class="linenos">454</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die.truncate-455"><a href="#Die.truncate-455"><span class="linenos">455</span></a><span class="sd">        If one of the arguments is not provided, that side will not be truncated.</span>
</span><span id="Die.truncate-456"><a href="#Die.truncate-456"><span class="linenos">456</span></a>
</span><span id="Die.truncate-457"><a href="#Die.truncate-457"><span class="linenos">457</span></a><span class="sd">        This effectively rerolls outcomes outside the given range.</span>
</span><span id="Die.truncate-458"><a href="#Die.truncate-458"><span class="linenos">458</span></a><span class="sd">        If instead you want to replace those outcomes with the nearest endpoint,</span>
</span><span id="Die.truncate-459"><a href="#Die.truncate-459"><span class="linenos">459</span></a><span class="sd">        use `clip()`.</span>
</span><span id="Die.truncate-460"><a href="#Die.truncate-460"><span class="linenos">460</span></a>
</span><span id="Die.truncate-461"><a href="#Die.truncate-461"><span class="linenos">461</span></a><span class="sd">        Not to be confused with `trunc(die)`, which performs integer truncation</span>
</span><span id="Die.truncate-462"><a href="#Die.truncate-462"><span class="linenos">462</span></a><span class="sd">        on each outcome.</span>
</span><span id="Die.truncate-463"><a href="#Die.truncate-463"><span class="linenos">463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.truncate-464"><a href="#Die.truncate-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.truncate-465"><a href="#Die.truncate-465"><span class="linenos">465</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">min_outcome</span><span class="p">)</span>
</span><span id="Die.truncate-466"><a href="#Die.truncate-466"><span class="linenos">466</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.truncate-467"><a href="#Die.truncate-467"><span class="linenos">467</span></a>            <span class="n">start</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.truncate-468"><a href="#Die.truncate-468"><span class="linenos">468</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.truncate-469"><a href="#Die.truncate-469"><span class="linenos">469</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">max_outcome</span><span class="p">)</span>
</span><span id="Die.truncate-470"><a href="#Die.truncate-470"><span class="linenos">470</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.truncate-471"><a href="#Die.truncate-471"><span class="linenos">471</span></a>            <span class="n">stop</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Die.truncate-472"><a href="#Die.truncate-472"><span class="linenos">472</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]}</span>
</span><span id="Die.truncate-473"><a href="#Die.truncate-473"><span class="linenos">473</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Truncates the outcomes of this <code><a href="#Die">Die</a></code> to the given range.</p>

<p>The endpoints are included in the result if applicable.
If one of the arguments is not provided, that side will not be truncated.</p>

<p>This effectively rerolls outcomes outside the given range.
If instead you want to replace those outcomes with the nearest endpoint,
use <code><a href="#Die.clip">clip()</a></code>.</p>

<p>Not to be confused with <code>trunc(die)</code>, which performs integer truncation
on each outcome.</p>
</div>


                            </div>
                            <div id="Die.clip" class="classattr">
                                        <input id="Die.clip-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clip</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.clip-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.clip"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.clip-475"><a href="#Die.clip-475"><span class="linenos">475</span></a>    <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_outcome</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.clip-476"><a href="#Die.clip-476"><span class="linenos">476</span></a>        <span class="sd">&quot;&quot;&quot;Clips the outcomes of this `Die` to the given values.</span>
</span><span id="Die.clip-477"><a href="#Die.clip-477"><span class="linenos">477</span></a>
</span><span id="Die.clip-478"><a href="#Die.clip-478"><span class="linenos">478</span></a><span class="sd">        The endpoints are included in the result if applicable.</span>
</span><span id="Die.clip-479"><a href="#Die.clip-479"><span class="linenos">479</span></a><span class="sd">        If one of the arguments is not provided, that side will not be clipped.</span>
</span><span id="Die.clip-480"><a href="#Die.clip-480"><span class="linenos">480</span></a>
</span><span id="Die.clip-481"><a href="#Die.clip-481"><span class="linenos">481</span></a><span class="sd">        This is not the same as rerolling outcomes beyond this range;</span>
</span><span id="Die.clip-482"><a href="#Die.clip-482"><span class="linenos">482</span></a><span class="sd">        the outcome is simply adjusted to fit within the range.</span>
</span><span id="Die.clip-483"><a href="#Die.clip-483"><span class="linenos">483</span></a><span class="sd">        This will typically cause some quantity to bunch up at the endpoint.</span>
</span><span id="Die.clip-484"><a href="#Die.clip-484"><span class="linenos">484</span></a><span class="sd">        If you want to reroll outcomes beyond this range, use `truncate()`.</span>
</span><span id="Die.clip-485"><a href="#Die.clip-485"><span class="linenos">485</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.clip-486"><a href="#Die.clip-486"><span class="linenos">486</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Die.clip-487"><a href="#Die.clip-487"><span class="linenos">487</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Die.clip-488"><a href="#Die.clip-488"><span class="linenos">488</span></a>            <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&lt;=</span> <span class="n">min_outcome</span><span class="p">:</span>
</span><span id="Die.clip-489"><a href="#Die.clip-489"><span class="linenos">489</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">min_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die.clip-490"><a href="#Die.clip-490"><span class="linenos">490</span></a>            <span class="k">elif</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">outcome</span> <span class="o">&gt;=</span> <span class="n">max_outcome</span><span class="p">:</span>
</span><span id="Die.clip-491"><a href="#Die.clip-491"><span class="linenos">491</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">max_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die.clip-492"><a href="#Die.clip-492"><span class="linenos">492</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.clip-493"><a href="#Die.clip-493"><span class="linenos">493</span></a>                <span class="n">data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Die.clip-494"><a href="#Die.clip-494"><span class="linenos">494</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Clips the outcomes of this <code><a href="#Die">Die</a></code> to the given values.</p>

<p>The endpoints are included in the result if applicable.
If one of the arguments is not provided, that side will not be clipped.</p>

<p>This is not the same as rerolling outcomes beyond this range;
the outcome is simply adjusted to fit within the range.
This will typically cause some quantity to bunch up at the endpoint.
If you want to reroll outcomes beyond this range, use <code><a href="#Die.truncate">truncate()</a></code>.</p>
</div>


                            </div>
                            <div id="Die.set_range" class="classattr">
                                        <input id="Die.set_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_range</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">min_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.set_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.set_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.set_range-496"><a href="#Die.set_range-496"><span class="linenos">496</span></a>    <span class="k">def</span> <span class="nf">set_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.set_range-497"><a href="#Die.set_range-497"><span class="linenos">497</span></a>                  <span class="n">min_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.set_range-498"><a href="#Die.set_range-498"><span class="linenos">498</span></a>                  <span class="n">max_outcome</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.set_range-499"><a href="#Die.set_range-499"><span class="linenos">499</span></a>        <span class="sd">&quot;&quot;&quot;Sets the outcomes of this `Die` to the given `int` range (inclusive).</span>
</span><span id="Die.set_range-500"><a href="#Die.set_range-500"><span class="linenos">500</span></a>
</span><span id="Die.set_range-501"><a href="#Die.set_range-501"><span class="linenos">501</span></a><span class="sd">        Args:</span>
</span><span id="Die.set_range-502"><a href="#Die.set_range-502"><span class="linenos">502</span></a><span class="sd">            min_outcome: The min outcome of the result.</span>
</span><span id="Die.set_range-503"><a href="#Die.set_range-503"><span class="linenos">503</span></a><span class="sd">                If omitted, the min outcome of this `Die` will be used.</span>
</span><span id="Die.set_range-504"><a href="#Die.set_range-504"><span class="linenos">504</span></a><span class="sd">            max_outcome: The max outcome of the result.</span>
</span><span id="Die.set_range-505"><a href="#Die.set_range-505"><span class="linenos">505</span></a><span class="sd">                If omitted, the max outcome of this `Die` will be used.</span>
</span><span id="Die.set_range-506"><a href="#Die.set_range-506"><span class="linenos">506</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.set_range-507"><a href="#Die.set_range-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">min_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.set_range-508"><a href="#Die.set_range-508"><span class="linenos">508</span></a>            <span class="n">min_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="Die.set_range-509"><a href="#Die.set_range-509"><span class="linenos">509</span></a>        <span class="k">if</span> <span class="n">max_outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.set_range-510"><a href="#Die.set_range-510"><span class="linenos">510</span></a>            <span class="n">max_outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Die.set_range-511"><a href="#Die.set_range-511"><span class="linenos">511</span></a>
</span><span id="Die.set_range-512"><a href="#Die.set_range-512"><span class="linenos">512</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Sets the outcomes of this <code><a href="#Die">Die</a></code> to the given <code>int</code> range (inclusive).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>min_outcome:</strong>  The min outcome of the result.
If omitted, the min outcome of this <code><a href="#Die">Die</a></code> will be used.</li>
<li><strong>max_outcome:</strong>  The max outcome of the result.
If omitted, the max outcome of this <code><a href="#Die">Die</a></code> will be used.</li>
</ul>
</div>


                            </div>
                            <div id="Die.set_outcomes" class="classattr">
                                        <input id="Die.set_outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcomes</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.set_outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.set_outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.set_outcomes-514"><a href="#Die.set_outcomes-514"><span class="linenos">514</span></a>    <span class="k">def</span> <span class="nf">set_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.set_outcomes-515"><a href="#Die.set_outcomes-515"><span class="linenos">515</span></a>        <span class="sd">&quot;&quot;&quot;Sets the set of outcomes to the argument.</span>
</span><span id="Die.set_outcomes-516"><a href="#Die.set_outcomes-516"><span class="linenos">516</span></a>
</span><span id="Die.set_outcomes-517"><a href="#Die.set_outcomes-517"><span class="linenos">517</span></a><span class="sd">        This may remove outcomes (if they are not present in the argument)</span>
</span><span id="Die.set_outcomes-518"><a href="#Die.set_outcomes-518"><span class="linenos">518</span></a><span class="sd">        and/or add zero-quantity outcomes (if they are not present in this `Die`).</span>
</span><span id="Die.set_outcomes-519"><a href="#Die.set_outcomes-519"><span class="linenos">519</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.set_outcomes-520"><a href="#Die.set_outcomes-520"><span class="linenos">520</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">}</span>
</span><span id="Die.set_outcomes-521"><a href="#Die.set_outcomes-521"><span class="linenos">521</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sets the set of outcomes to the argument.</p>

<p>This may remove outcomes (if they are not present in the argument)
and/or add zero-quantity outcomes (if they are not present in this <code><a href="#Die">Die</a></code>).</p>
</div>


                            </div>
                            <div id="Die.trim" class="classattr">
                                        <input id="Die.trim-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trim</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.trim-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.trim"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.trim-523"><a href="#Die.trim-523"><span class="linenos">523</span></a>    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.trim-524"><a href="#Die.trim-524"><span class="linenos">524</span></a>        <span class="sd">&quot;&quot;&quot;Removes all zero-quantity outcomes. &quot;&quot;&quot;</span>
</span><span id="Die.trim-525"><a href="#Die.trim-525"><span class="linenos">525</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">}</span>
</span><span id="Die.trim-526"><a href="#Die.trim-526"><span class="linenos">526</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Removes all zero-quantity outcomes.</p>
</div>


                            </div>
                            <div id="Die.sub" class="classattr">
                                        <input id="Die.sub-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sub</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_end</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.sub-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.sub"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.sub-556"><a href="#Die.sub-556"><span class="linenos">556</span></a>    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.sub-557"><a href="#Die.sub-557"><span class="linenos">557</span></a>            <span class="n">repl</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">,</span>
</span><span id="Die.sub-558"><a href="#Die.sub-558"><span class="linenos">558</span></a>            <span class="o">/</span><span class="p">,</span>
</span><span id="Die.sub-559"><a href="#Die.sub-559"><span class="linenos">559</span></a>            <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.sub-560"><a href="#Die.sub-560"><span class="linenos">560</span></a>            <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Die.sub-561"><a href="#Die.sub-561"><span class="linenos">561</span></a>            <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.sub-562"><a href="#Die.sub-562"><span class="linenos">562</span></a>            <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.sub-563"><a href="#Die.sub-563"><span class="linenos">563</span></a>        <span class="sd">&quot;&quot;&quot;Changes outcomes of the `Die` to other outcomes.</span>
</span><span id="Die.sub-564"><a href="#Die.sub-564"><span class="linenos">564</span></a>
</span><span id="Die.sub-565"><a href="#Die.sub-565"><span class="linenos">565</span></a><span class="sd">        You can think of this as `sub`stituting outcomes of this `Die` for other</span>
</span><span id="Die.sub-566"><a href="#Die.sub-566"><span class="linenos">566</span></a><span class="sd">        outcomes or dice. Or, as executing a `sub`routine based on the roll of</span>
</span><span id="Die.sub-567"><a href="#Die.sub-567"><span class="linenos">567</span></a><span class="sd">        this `Die`.</span>
</span><span id="Die.sub-568"><a href="#Die.sub-568"><span class="linenos">568</span></a>
</span><span id="Die.sub-569"><a href="#Die.sub-569"><span class="linenos">569</span></a><span class="sd">        EXPERIMENTAL: `Again`, `again_depth`, and `again_end` can be used as the</span>
</span><span id="Die.sub-570"><a href="#Die.sub-570"><span class="linenos">570</span></a><span class="sd">        `Die()` constructor. It is not advised to use these with `repeat` other</span>
</span><span id="Die.sub-571"><a href="#Die.sub-571"><span class="linenos">571</span></a><span class="sd">        than 1.</span>
</span><span id="Die.sub-572"><a href="#Die.sub-572"><span class="linenos">572</span></a>
</span><span id="Die.sub-573"><a href="#Die.sub-573"><span class="linenos">573</span></a><span class="sd">        Args:</span>
</span><span id="Die.sub-574"><a href="#Die.sub-574"><span class="linenos">574</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Die.sub-575"><a href="#Die.sub-575"><span class="linenos">575</span></a><span class="sd">                * A callable returning a new outcome for each old outcome.</span>
</span><span id="Die.sub-576"><a href="#Die.sub-576"><span class="linenos">576</span></a><span class="sd">                * A map from old outcomes to new outcomes.</span>
</span><span id="Die.sub-577"><a href="#Die.sub-577"><span class="linenos">577</span></a><span class="sd">                    Unmapped old outcomes stay the same.</span>
</span><span id="Die.sub-578"><a href="#Die.sub-578"><span class="linenos">578</span></a><span class="sd">                The new outcomes may be dice rather than just single outcomes.</span>
</span><span id="Die.sub-579"><a href="#Die.sub-579"><span class="linenos">579</span></a><span class="sd">                The special value `icepool.Reroll` will reroll that old outcome.</span>
</span><span id="Die.sub-580"><a href="#Die.sub-580"><span class="linenos">580</span></a><span class="sd">            repeat: `sub()` will be repeated with the same argument on the</span>
</span><span id="Die.sub-581"><a href="#Die.sub-581"><span class="linenos">581</span></a><span class="sd">                result this many times.</span>
</span><span id="Die.sub-582"><a href="#Die.sub-582"><span class="linenos">582</span></a>
</span><span id="Die.sub-583"><a href="#Die.sub-583"><span class="linenos">583</span></a><span class="sd">                EXPERIMENTAL: If set to `None`, the result will be as if `sub()`</span>
</span><span id="Die.sub-584"><a href="#Die.sub-584"><span class="linenos">584</span></a><span class="sd">                    were repeated an infinite number of times. In this case, the</span>
</span><span id="Die.sub-585"><a href="#Die.sub-585"><span class="linenos">585</span></a><span class="sd">                    result will be in simplest form.</span>
</span><span id="Die.sub-586"><a href="#Die.sub-586"><span class="linenos">586</span></a><span class="sd">            star: If set to `True` or 1, outcomes of `self` will be unpacked as</span>
</span><span id="Die.sub-587"><a href="#Die.sub-587"><span class="linenos">587</span></a><span class="sd">                `*outcome` before giving it to the `repl` function. `extra_dice`</span>
</span><span id="Die.sub-588"><a href="#Die.sub-588"><span class="linenos">588</span></a><span class="sd">                are not unpacked. If `repl` is not a callable, this has no</span>
</span><span id="Die.sub-589"><a href="#Die.sub-589"><span class="linenos">589</span></a><span class="sd">                effect.</span>
</span><span id="Die.sub-590"><a href="#Die.sub-590"><span class="linenos">590</span></a><span class="sd">            again_depth: Forwarded to the final die constructor.</span>
</span><span id="Die.sub-591"><a href="#Die.sub-591"><span class="linenos">591</span></a><span class="sd">            again_end: Forwarded to the final die constructor.</span>
</span><span id="Die.sub-592"><a href="#Die.sub-592"><span class="linenos">592</span></a>
</span><span id="Die.sub-593"><a href="#Die.sub-593"><span class="linenos">593</span></a><span class="sd">        Returns:</span>
</span><span id="Die.sub-594"><a href="#Die.sub-594"><span class="linenos">594</span></a><span class="sd">            The `Die` after the modification.</span>
</span><span id="Die.sub-595"><a href="#Die.sub-595"><span class="linenos">595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.sub-596"><a href="#Die.sub-596"><span class="linenos">596</span></a>
</span><span id="Die.sub-597"><a href="#Die.sub-597"><span class="linenos">597</span></a>        <span class="k">if</span> <span class="n">repeat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.sub-598"><a href="#Die.sub-598"><span class="linenos">598</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die.sub-599"><a href="#Die.sub-599"><span class="linenos">599</span></a>
</span><span id="Die.sub-600"><a href="#Die.sub-600"><span class="linenos">600</span></a>        <span class="c1"># Convert to a single-argument function.</span>
</span><span id="Die.sub-601"><a href="#Die.sub-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">repl</span><span class="p">):</span>
</span><span id="Die.sub-602"><a href="#Die.sub-602"><span class="linenos">602</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die.sub-603"><a href="#Die.sub-603"><span class="linenos">603</span></a>
</span><span id="Die.sub-604"><a href="#Die.sub-604"><span class="linenos">604</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die.sub-605"><a href="#Die.sub-605"><span class="linenos">605</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Die.sub-606"><a href="#Die.sub-606"><span class="linenos">606</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.sub-607"><a href="#Die.sub-607"><span class="linenos">607</span></a>
</span><span id="Die.sub-608"><a href="#Die.sub-608"><span class="linenos">608</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die.sub-609"><a href="#Die.sub-609"><span class="linenos">609</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Die.sub-610"><a href="#Die.sub-610"><span class="linenos">610</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.sub-611"><a href="#Die.sub-611"><span class="linenos">611</span></a>            <span class="c1"># repl is a mapping.</span>
</span><span id="Die.sub-612"><a href="#Die.sub-612"><span class="linenos">612</span></a>            <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die.sub-613"><a href="#Die.sub-613"><span class="linenos">613</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">repl</span><span class="p">:</span>
</span><span id="Die.sub-614"><a href="#Die.sub-614"><span class="linenos">614</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Die.sub-615"><a href="#Die.sub-615"><span class="linenos">615</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Die.sub-616"><a href="#Die.sub-616"><span class="linenos">616</span></a>                    <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Die.sub-617"><a href="#Die.sub-617"><span class="linenos">617</span></a>
</span><span id="Die.sub-618"><a href="#Die.sub-618"><span class="linenos">618</span></a>        <span class="k">if</span> <span class="n">repeat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.sub-619"><a href="#Die.sub-619"><span class="linenos">619</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Die.sub-620"><a href="#Die.sub-620"><span class="linenos">620</span></a>            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat</span><span class="p">):</span>
</span><span id="Die.sub-621"><a href="#Die.sub-621"><span class="linenos">621</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">transition_function</span><span class="p">,</span>
</span><span id="Die.sub-622"><a href="#Die.sub-622"><span class="linenos">622</span></a>                                       <span class="n">result</span><span class="p">,</span>
</span><span id="Die.sub-623"><a href="#Die.sub-623"><span class="linenos">623</span></a>                                       <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die.sub-624"><a href="#Die.sub-624"><span class="linenos">624</span></a>                                       <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="Die.sub-625"><a href="#Die.sub-625"><span class="linenos">625</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="Die.sub-626"><a href="#Die.sub-626"><span class="linenos">626</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.sub-627"><a href="#Die.sub-627"><span class="linenos">627</span></a>            <span class="c1"># Infinite repeat.</span>
</span><span id="Die.sub-628"><a href="#Die.sub-628"><span class="linenos">628</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">markov_chain</span><span class="o">.</span><span class="n">absorbing_markov_chain</span><span class="p">(</span>
</span><span id="Die.sub-629"><a href="#Die.sub-629"><span class="linenos">629</span></a>                <span class="bp">self</span><span class="p">,</span> <span class="n">transition_function</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Changes outcomes of the <code><a href="#Die">Die</a></code> to other outcomes.</p>

<p>You can think of this as <code><a href="#Die.sub">sub</a></code>stituting outcomes of this <code><a href="#Die">Die</a></code> for other
outcomes or dice. Or, as executing a <code><a href="#Die.sub">sub</a></code>routine based on the roll of
this <code><a href="#Die">Die</a></code>.</p>

<p>EXPERIMENTAL: <code><a href="#Again">Again</a></code>, <code>again_depth</code>, and <code>again_end</code> can be used as the
<code><a href="#Die">Die()</a></code> constructor. It is not advised to use these with <code>repeat</code> other
than 1.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>repl:</strong>  One of the following:
<ul>
<li>A callable returning a new outcome for each old outcome.</li>
<li>A map from old outcomes to new outcomes.
Unmapped old outcomes stay the same.
The new outcomes may be dice rather than just single outcomes.
The special value <code><a href="#Reroll">icepool.Reroll</a></code> will reroll that old outcome.</li>
</ul></li>
<li><p><strong>repeat:</strong>  <code><a href="#Die.sub">sub()</a></code> will be repeated with the same argument on the
result this many times.</p>

<p>EXPERIMENTAL: If set to <code>None</code>, the result will be as if <code><a href="#Die.sub">sub()</a></code>
   were repeated an infinite number of times. In this case, the
   result will be in simplest form.</p></li>
<li><strong>star:</strong>  If set to <code>True</code> or 1, outcomes of <code>self</code> will be unpacked as
<code>*outcome</code> before giving it to the <code>repl</code> function. <code>extra_dice</code>
are not unpacked. If <code>repl</code> is not a callable, this has no
effect.</li>
<li><strong>again_depth:</strong>  Forwarded to the final die constructor.</li>
<li><strong>again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>The <code><a href="#Die">Die</a></code> after the modification.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.explode" class="classattr">
                                        <input id="Die.explode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">explode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span> <span class="n">Container</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span><span class="n">extra_args</span>,</span><span class="param">	<span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span>,</span><span class="param">	<span class="n">end</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.explode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.explode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.explode-631"><a href="#Die.explode-631"><span class="linenos">631</span></a>    <span class="k">def</span> <span class="nf">explode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.explode-632"><a href="#Die.explode-632"><span class="linenos">632</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Container</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Die.explode-633"><a href="#Die.explode-633"><span class="linenos">633</span></a>                <span class="o">*</span><span class="n">extra_args</span><span class="p">,</span>
</span><span id="Die.explode-634"><a href="#Die.explode-634"><span class="linenos">634</span></a>                <span class="n">depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
</span><span id="Die.explode-635"><a href="#Die.explode-635"><span class="linenos">635</span></a>                <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Die.explode-636"><a href="#Die.explode-636"><span class="linenos">636</span></a>                <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.explode-637"><a href="#Die.explode-637"><span class="linenos">637</span></a>        <span class="sd">&quot;&quot;&quot;Causes outcomes to be rolled again and added to the total.</span>
</span><span id="Die.explode-638"><a href="#Die.explode-638"><span class="linenos">638</span></a>
</span><span id="Die.explode-639"><a href="#Die.explode-639"><span class="linenos">639</span></a><span class="sd">        Args:</span>
</span><span id="Die.explode-640"><a href="#Die.explode-640"><span class="linenos">640</span></a><span class="sd">            outcomes: Which outcomes to explode. Options:</span>
</span><span id="Die.explode-641"><a href="#Die.explode-641"><span class="linenos">641</span></a><span class="sd">                * An container of outcomes to explode.</span>
</span><span id="Die.explode-642"><a href="#Die.explode-642"><span class="linenos">642</span></a><span class="sd">                * A callable that takes an outcome and returns `True` if it</span>
</span><span id="Die.explode-643"><a href="#Die.explode-643"><span class="linenos">643</span></a><span class="sd">                    should be exploded.</span>
</span><span id="Die.explode-644"><a href="#Die.explode-644"><span class="linenos">644</span></a><span class="sd">                * If not supplied, the max outcome will explode.</span>
</span><span id="Die.explode-645"><a href="#Die.explode-645"><span class="linenos">645</span></a><span class="sd">            *extra_args: These will be supplied to `outcomes` as extra</span>
</span><span id="Die.explode-646"><a href="#Die.explode-646"><span class="linenos">646</span></a><span class="sd">                positional arguments after the outcome argument(s).</span>
</span><span id="Die.explode-647"><a href="#Die.explode-647"><span class="linenos">647</span></a><span class="sd">                `extra_args` can only be supplied if `outcomes` is callable.</span>
</span><span id="Die.explode-648"><a href="#Die.explode-648"><span class="linenos">648</span></a><span class="sd">            depth: The maximum number of additional dice to roll.</span>
</span><span id="Die.explode-649"><a href="#Die.explode-649"><span class="linenos">649</span></a><span class="sd">                If not supplied, a default value will be used.</span>
</span><span id="Die.explode-650"><a href="#Die.explode-650"><span class="linenos">650</span></a><span class="sd">            end: Once depth is reached, further explosions will be treated</span>
</span><span id="Die.explode-651"><a href="#Die.explode-651"><span class="linenos">651</span></a><span class="sd">                as this value. By default, a zero value will be used.</span>
</span><span id="Die.explode-652"><a href="#Die.explode-652"><span class="linenos">652</span></a><span class="sd">            star: If set to `True` or 1, outcomes will be unpacked as</span>
</span><span id="Die.explode-653"><a href="#Die.explode-653"><span class="linenos">653</span></a><span class="sd">                `*outcome` before giving it to the `outcomes` function.</span>
</span><span id="Die.explode-654"><a href="#Die.explode-654"><span class="linenos">654</span></a><span class="sd">                If `outcomes` is not a callable, this has no effect.</span>
</span><span id="Die.explode-655"><a href="#Die.explode-655"><span class="linenos">655</span></a>
</span><span id="Die.explode-656"><a href="#Die.explode-656"><span class="linenos">656</span></a><span class="sd">        Raises:</span>
</span><span id="Die.explode-657"><a href="#Die.explode-657"><span class="linenos">657</span></a><span class="sd">            ValueError: If `extra_args` are supplied with a non-callable `outcomes`.</span>
</span><span id="Die.explode-658"><a href="#Die.explode-658"><span class="linenos">658</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.explode-659"><a href="#Die.explode-659"><span class="linenos">659</span></a>        <span class="k">if</span> <span class="n">extra_args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.explode-660"><a href="#Die.explode-660"><span class="linenos">660</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Die.explode-661"><a href="#Die.explode-661"><span class="linenos">661</span></a>                <span class="s1">&#39;Extra positional arguments are only valid if outcomes is callable.&#39;</span>
</span><span id="Die.explode-662"><a href="#Die.explode-662"><span class="linenos">662</span></a>            <span class="p">)</span>
</span><span id="Die.explode-663"><a href="#Die.explode-663"><span class="linenos">663</span></a>
</span><span id="Die.explode-664"><a href="#Die.explode-664"><span class="linenos">664</span></a>        <span class="k">if</span> <span class="n">outcomes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Die.explode-665"><a href="#Die.explode-665"><span class="linenos">665</span></a>            <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()}</span>
</span><span id="Die.explode-666"><a href="#Die.explode-666"><span class="linenos">666</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Die.explode-667"><a href="#Die.explode-667"><span class="linenos">667</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Die.explode-668"><a href="#Die.explode-668"><span class="linenos">668</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.explode-669"><a href="#Die.explode-669"><span class="linenos">669</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.explode-670"><a href="#Die.explode-670"><span class="linenos">670</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die.explode-671"><a href="#Die.explode-671"><span class="linenos">671</span></a>                <span class="p">}</span>
</span><span id="Die.explode-672"><a href="#Die.explode-672"><span class="linenos">672</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.explode-673"><a href="#Die.explode-673"><span class="linenos">673</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Die.explode-674"><a href="#Die.explode-674"><span class="linenos">674</span></a>                    <span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Die.explode-675"><a href="#Die.explode-675"><span class="linenos">675</span></a>                    <span class="k">if</span> <span class="n">outcomes</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_args</span><span class="p">)</span>
</span><span id="Die.explode-676"><a href="#Die.explode-676"><span class="linenos">676</span></a>                <span class="p">}</span>
</span><span id="Die.explode-677"><a href="#Die.explode-677"><span class="linenos">677</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.explode-678"><a href="#Die.explode-678"><span class="linenos">678</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="Die.explode-679"><a href="#Die.explode-679"><span class="linenos">679</span></a>                <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die.explode-680"><a href="#Die.explode-680"><span class="linenos">680</span></a>
</span><span id="Die.explode-681"><a href="#Die.explode-681"><span class="linenos">681</span></a>        <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.explode-682"><a href="#Die.explode-682"><span class="linenos">682</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;depth cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Die.explode-683"><a href="#Die.explode-683"><span class="linenos">683</span></a>        <span class="k">elif</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.explode-684"><a href="#Die.explode-684"><span class="linenos">684</span></a>            <span class="k">return</span> <span class="bp">self</span>
</span><span id="Die.explode-685"><a href="#Die.explode-685"><span class="linenos">685</span></a>
</span><span id="Die.explode-686"><a href="#Die.explode-686"><span class="linenos">686</span></a>        <span class="k">def</span> <span class="nf">sub_func</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Die.explode-687"><a href="#Die.explode-687"><span class="linenos">687</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">:</span>
</span><span id="Die.explode-688"><a href="#Die.explode-688"><span class="linenos">688</span></a>                <span class="k">return</span> <span class="n">outcome</span> <span class="o">+</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Again</span><span class="p">()</span>
</span><span id="Die.explode-689"><a href="#Die.explode-689"><span class="linenos">689</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Die.explode-690"><a href="#Die.explode-690"><span class="linenos">690</span></a>                <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Die.explode-691"><a href="#Die.explode-691"><span class="linenos">691</span></a>
</span><span id="Die.explode-692"><a href="#Die.explode-692"><span class="linenos">692</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">sub_func</span><span class="p">,</span> <span class="n">again_depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">again_end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Causes outcomes to be rolled again and added to the total.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>outcomes:</strong>  Which outcomes to explode. Options:
<ul>
<li>An container of outcomes to explode.</li>
<li>A callable that takes an outcome and returns <code>True</code> if it
should be exploded.</li>
<li>If not supplied, the max outcome will explode.</li>
</ul></li>
<li><strong>*extra_args:</strong>  These will be supplied to <code><a href="#Die.outcomes">outcomes</a></code> as extra
positional arguments after the outcome argument(s).
<code>extra_args</code> can only be supplied if <code><a href="#Die.outcomes">outcomes</a></code> is callable.</li>
<li><strong>depth:</strong>  The maximum number of additional dice to roll.
If not supplied, a default value will be used.</li>
<li><strong>end:</strong>  Once depth is reached, further explosions will be treated
as this value. By default, a zero value will be used.</li>
<li><strong>star:</strong>  If set to <code>True</code> or 1, outcomes will be unpacked as
<code>*outcome</code> before giving it to the <code><a href="#Die.outcomes">outcomes</a></code> function.
If <code><a href="#Die.outcomes">outcomes</a></code> is not a callable, this has no effect.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If <code>extra_args</code> are supplied with a non-callable <code><a href="#Die.outcomes">outcomes</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Die.if_else" class="classattr">
                                        <input id="Die.if_else-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">if_else</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">outcome_if_true</span>,</span><span class="param">	<span class="n">outcome_if_false</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_end</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.if_else-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.if_else"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.if_else-694"><a href="#Die.if_else-694"><span class="linenos">694</span></a>    <span class="k">def</span> <span class="nf">if_else</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.if_else-695"><a href="#Die.if_else-695"><span class="linenos">695</span></a>                <span class="n">outcome_if_true</span><span class="p">,</span>
</span><span id="Die.if_else-696"><a href="#Die.if_else-696"><span class="linenos">696</span></a>                <span class="n">outcome_if_false</span><span class="p">,</span>
</span><span id="Die.if_else-697"><a href="#Die.if_else-697"><span class="linenos">697</span></a>                <span class="o">/</span><span class="p">,</span>
</span><span id="Die.if_else-698"><a href="#Die.if_else-698"><span class="linenos">698</span></a>                <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.if_else-699"><a href="#Die.if_else-699"><span class="linenos">699</span></a>                <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.if_else-700"><a href="#Die.if_else-700"><span class="linenos">700</span></a>        <span class="sd">&quot;&quot;&quot;Ternary conditional operator.</span>
</span><span id="Die.if_else-701"><a href="#Die.if_else-701"><span class="linenos">701</span></a>
</span><span id="Die.if_else-702"><a href="#Die.if_else-702"><span class="linenos">702</span></a><span class="sd">        This replaces truthy outcomes with the first argument and falsy outcomes</span>
</span><span id="Die.if_else-703"><a href="#Die.if_else-703"><span class="linenos">703</span></a><span class="sd">        with the second argument.</span>
</span><span id="Die.if_else-704"><a href="#Die.if_else-704"><span class="linenos">704</span></a>
</span><span id="Die.if_else-705"><a href="#Die.if_else-705"><span class="linenos">705</span></a><span class="sd">        Args:</span>
</span><span id="Die.if_else-706"><a href="#Die.if_else-706"><span class="linenos">706</span></a><span class="sd">            again_depth: Forwarded to the final die constructor.</span>
</span><span id="Die.if_else-707"><a href="#Die.if_else-707"><span class="linenos">707</span></a><span class="sd">            again_end: Forwarded to the final die constructor.</span>
</span><span id="Die.if_else-708"><a href="#Die.if_else-708"><span class="linenos">708</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.if_else-709"><a href="#Die.if_else-709"><span class="linenos">709</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bool</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">outcome_if_true</span>
</span><span id="Die.if_else-710"><a href="#Die.if_else-710"><span class="linenos">710</span></a>                               <span class="k">if</span> <span class="n">x</span> <span class="k">else</span> <span class="n">outcome_if_false</span><span class="p">,</span>
</span><span id="Die.if_else-711"><a href="#Die.if_else-711"><span class="linenos">711</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="Die.if_else-712"><a href="#Die.if_else-712"><span class="linenos">712</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Ternary conditional operator.</p>

<p>This replaces truthy outcomes with the first argument and falsy outcomes
with the second argument.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>again_depth:</strong>  Forwarded to the final die constructor.</li>
<li><strong>again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>
</div>


                            </div>
                            <div id="Die.is_in" class="classattr">
                                        <input id="Die.is_in-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_in</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">target</span><span class="p">:</span> <span class="n">Container</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.is_in-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.is_in"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.is_in-714"><a href="#Die.is_in-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">is_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.is_in-715"><a href="#Die.is_in-715"><span class="linenos">715</span></a>        <span class="sd">&quot;&quot;&quot;A die that returns True iff the roll of the die is contained in the target.&quot;&quot;&quot;</span>
</span><span id="Die.is_in-716"><a href="#Die.is_in-716"><span class="linenos">716</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A die that returns True iff the roll of the die is contained in the target.</p>
</div>


                            </div>
                            <div id="Die.count" class="classattr">
                                        <input id="Die.count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">target</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.count-718"><a href="#Die.count-718"><span class="linenos">718</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.count-719"><a href="#Die.count-719"><span class="linenos">719</span></a>        <span class="sd">&quot;&quot;&quot;Roll this dice a number of time and count how many are == the target.&quot;&quot;&quot;</span>
</span><span id="Die.count-720"><a href="#Die.count-720"><span class="linenos">720</span></a>        <span class="k">return</span> <span class="n">rolls</span> <span class="o">@</span> <span class="p">(</span><span class="bp">self</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Roll this dice a number of time and count how many are == the target.</p>
</div>


                            </div>
                            <div id="Die.count_in" class="classattr">
                                        <input id="Die.count_in-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_in</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">target</span><span class="p">:</span> <span class="n">Container</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.count_in-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.count_in"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.count_in-722"><a href="#Die.count_in-722"><span class="linenos">722</span></a>    <span class="k">def</span> <span class="nf">count_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.count_in-723"><a href="#Die.count_in-723"><span class="linenos">723</span></a>        <span class="sd">&quot;&quot;&quot;Roll this dice a number of time and count how many are in the target.&quot;&quot;&quot;</span>
</span><span id="Die.count_in-724"><a href="#Die.count_in-724"><span class="linenos">724</span></a>        <span class="k">return</span> <span class="n">rolls</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_in</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Roll this dice a number of time and count how many are in the target.</p>
</div>


                            </div>
                            <div id="Die.pool" class="classattr">
                                        <input id="Die.pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pool</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rolls</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Pool">icepool.Pool</a></span>:</span></span>

                <label class="view-source-button" for="Die.pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.pool-783"><a href="#Die.pool-783"><span class="linenos">783</span></a>    <span class="k">def</span> <span class="nf">pool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Pool&#39;</span><span class="p">:</span>
</span><span id="Die.pool-784"><a href="#Die.pool-784"><span class="linenos">784</span></a>        <span class="sd">&quot;&quot;&quot;Creates a `Pool` from this `Die`.</span>
</span><span id="Die.pool-785"><a href="#Die.pool-785"><span class="linenos">785</span></a>
</span><span id="Die.pool-786"><a href="#Die.pool-786"><span class="linenos">786</span></a><span class="sd">        You might subscript the pool immediately afterwards, e.g.</span>
</span><span id="Die.pool-787"><a href="#Die.pool-787"><span class="linenos">787</span></a><span class="sd">        `d6.pool(5)[-1, ..., 1]` takes the difference between the highest and</span>
</span><span id="Die.pool-788"><a href="#Die.pool-788"><span class="linenos">788</span></a><span class="sd">        lowest of 5d6.</span>
</span><span id="Die.pool-789"><a href="#Die.pool-789"><span class="linenos">789</span></a>
</span><span id="Die.pool-790"><a href="#Die.pool-790"><span class="linenos">790</span></a><span class="sd">        Args:</span>
</span><span id="Die.pool-791"><a href="#Die.pool-791"><span class="linenos">791</span></a><span class="sd">            rolls: The number of copies of this `Die` to put in the pool.</span>
</span><span id="Die.pool-792"><a href="#Die.pool-792"><span class="linenos">792</span></a><span class="sd">                Or, a sequence of one `int` per die acting as</span>
</span><span id="Die.pool-793"><a href="#Die.pool-793"><span class="linenos">793</span></a><span class="sd">                `sorted_roll_counts`. Note that `...` cannot be used in the</span>
</span><span id="Die.pool-794"><a href="#Die.pool-794"><span class="linenos">794</span></a><span class="sd">                argument to this method, as the argument determines the size of</span>
</span><span id="Die.pool-795"><a href="#Die.pool-795"><span class="linenos">795</span></a><span class="sd">                the pool.</span>
</span><span id="Die.pool-796"><a href="#Die.pool-796"><span class="linenos">796</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.pool-797"><a href="#Die.pool-797"><span class="linenos">797</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rolls</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Die.pool-798"><a href="#Die.pool-798"><span class="linenos">798</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">rolls</span><span class="p">})</span>
</span><span id="Die.pool-799"><a href="#Die.pool-799"><span class="linenos">799</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.pool-800"><a href="#Die.pool-800"><span class="linenos">800</span></a>            <span class="n">pool_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.pool-801"><a href="#Die.pool-801"><span class="linenos">801</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">({</span><span class="bp">self</span><span class="p">:</span> <span class="n">pool_size</span><span class="p">})[</span><span class="n">rolls</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Creates a <code><a href="#Pool">Pool</a></code> from this <code><a href="#Die">Die</a></code>.</p>

<p>You might subscript the pool immediately afterwards, e.g.
<code>d6.pool(5)[-1, ..., 1]</code> takes the difference between the highest and
lowest of 5d6.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of copies of this <code><a href="#Die">Die</a></code> to put in the pool.
Or, a sequence of one <code>int</code> per die acting as
<code>sorted_roll_counts</code>. Note that <code>...</code> cannot be used in the
argument to this method, as the argument determines the size of
the pool.</li>
</ul>
</div>


                            </div>
                            <div id="Die.keep_lowest" class="classattr">
                                        <input id="Die.keep_lowest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keep_lowest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span>, </span><span class="param"><span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.keep_lowest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.keep_lowest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.keep_lowest-803"><a href="#Die.keep_lowest-803"><span class="linenos">803</span></a>    <span class="k">def</span> <span class="nf">keep_lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.keep_lowest-804"><a href="#Die.keep_lowest-804"><span class="linenos">804</span></a>        <span class="sd">&quot;&quot;&quot;Roll several of this `Die` and sum the sorted results from the lowest.</span>
</span><span id="Die.keep_lowest-805"><a href="#Die.keep_lowest-805"><span class="linenos">805</span></a>
</span><span id="Die.keep_lowest-806"><a href="#Die.keep_lowest-806"><span class="linenos">806</span></a><span class="sd">        Args:</span>
</span><span id="Die.keep_lowest-807"><a href="#Die.keep_lowest-807"><span class="linenos">807</span></a><span class="sd">            rolls: The number of dice to roll. All dice will have the same</span>
</span><span id="Die.keep_lowest-808"><a href="#Die.keep_lowest-808"><span class="linenos">808</span></a><span class="sd">                outcomes as `self`.</span>
</span><span id="Die.keep_lowest-809"><a href="#Die.keep_lowest-809"><span class="linenos">809</span></a><span class="sd">            keep: The number of dice to keep.</span>
</span><span id="Die.keep_lowest-810"><a href="#Die.keep_lowest-810"><span class="linenos">810</span></a><span class="sd">            drop: If provided, this many lowest dice will be dropped before</span>
</span><span id="Die.keep_lowest-811"><a href="#Die.keep_lowest-811"><span class="linenos">811</span></a><span class="sd">                keeping.</span>
</span><span id="Die.keep_lowest-812"><a href="#Die.keep_lowest-812"><span class="linenos">812</span></a>
</span><span id="Die.keep_lowest-813"><a href="#Die.keep_lowest-813"><span class="linenos">813</span></a><span class="sd">        Returns:</span>
</span><span id="Die.keep_lowest-814"><a href="#Die.keep_lowest-814"><span class="linenos">814</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die.keep_lowest-815"><a href="#Die.keep_lowest-815"><span class="linenos">815</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.keep_lowest-816"><a href="#Die.keep_lowest-816"><span class="linenos">816</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">drop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.keep_lowest-817"><a href="#Die.keep_lowest-817"><span class="linenos">817</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_lowest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.keep_lowest-818"><a href="#Die.keep_lowest-818"><span class="linenos">818</span></a>
</span><span id="Die.keep_lowest-819"><a href="#Die.keep_lowest-819"><span class="linenos">819</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="n">drop</span> <span class="k">if</span> <span class="n">drop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Die.keep_lowest-820"><a href="#Die.keep_lowest-820"><span class="linenos">820</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="n">keep</span> <span class="o">+</span> <span class="p">(</span><span class="n">drop</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Die.keep_lowest-821"><a href="#Die.keep_lowest-821"><span class="linenos">821</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</span><span id="Die.keep_lowest-822"><a href="#Die.keep_lowest-822"><span class="linenos">822</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">sorted_roll_counts</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Roll several of this <code><a href="#Die">Die</a></code> and sum the sorted results from the lowest.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of dice to roll. All dice will have the same
outcomes as <code>self</code>.</li>
<li><strong>keep:</strong>  The number of dice to keep.</li>
<li><strong>drop:</strong>  If provided, this many lowest dice will be dropped before
keeping.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the probability distribution of the sum.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.keep_highest" class="classattr">
                                        <input id="Die.keep_highest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keep_highest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">/</span>, </span><span class="param"><span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.keep_highest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.keep_highest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.keep_highest-832"><a href="#Die.keep_highest-832"><span class="linenos">832</span></a>    <span class="k">def</span> <span class="nf">keep_highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Die.keep_highest-833"><a href="#Die.keep_highest-833"><span class="linenos">833</span></a>                     <span class="n">rolls</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="Die.keep_highest-834"><a href="#Die.keep_highest-834"><span class="linenos">834</span></a>                     <span class="o">/</span><span class="p">,</span>
</span><span id="Die.keep_highest-835"><a href="#Die.keep_highest-835"><span class="linenos">835</span></a>                     <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Die.keep_highest-836"><a href="#Die.keep_highest-836"><span class="linenos">836</span></a>                     <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.keep_highest-837"><a href="#Die.keep_highest-837"><span class="linenos">837</span></a>        <span class="sd">&quot;&quot;&quot;Roll several of this `Die` and sum the sorted results from the highest.</span>
</span><span id="Die.keep_highest-838"><a href="#Die.keep_highest-838"><span class="linenos">838</span></a>
</span><span id="Die.keep_highest-839"><a href="#Die.keep_highest-839"><span class="linenos">839</span></a><span class="sd">        Args:</span>
</span><span id="Die.keep_highest-840"><a href="#Die.keep_highest-840"><span class="linenos">840</span></a><span class="sd">            rolls: The number of dice to roll.</span>
</span><span id="Die.keep_highest-841"><a href="#Die.keep_highest-841"><span class="linenos">841</span></a><span class="sd">            keep: The number of dice to keep.</span>
</span><span id="Die.keep_highest-842"><a href="#Die.keep_highest-842"><span class="linenos">842</span></a><span class="sd">            drop: If provided, this many highest dice will be dropped before</span>
</span><span id="Die.keep_highest-843"><a href="#Die.keep_highest-843"><span class="linenos">843</span></a><span class="sd">                keeping.</span>
</span><span id="Die.keep_highest-844"><a href="#Die.keep_highest-844"><span class="linenos">844</span></a>
</span><span id="Die.keep_highest-845"><a href="#Die.keep_highest-845"><span class="linenos">845</span></a><span class="sd">        Returns:</span>
</span><span id="Die.keep_highest-846"><a href="#Die.keep_highest-846"><span class="linenos">846</span></a><span class="sd">            A `Die` representing the probability distribution of the sum.</span>
</span><span id="Die.keep_highest-847"><a href="#Die.keep_highest-847"><span class="linenos">847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.keep_highest-848"><a href="#Die.keep_highest-848"><span class="linenos">848</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">drop</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Die.keep_highest-849"><a href="#Die.keep_highest-849"><span class="linenos">849</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_highest_single</span><span class="p">(</span><span class="n">rolls</span><span class="p">)</span>
</span><span id="Die.keep_highest-850"><a href="#Die.keep_highest-850"><span class="linenos">850</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="p">(</span><span class="n">drop</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="Die.keep_highest-851"><a href="#Die.keep_highest-851"><span class="linenos">851</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="o">-</span><span class="n">drop</span> <span class="k">if</span> <span class="n">drop</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Die.keep_highest-852"><a href="#Die.keep_highest-852"><span class="linenos">852</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
</span><span id="Die.keep_highest-853"><a href="#Die.keep_highest-853"><span class="linenos">853</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">rolls</span><span class="p">)[</span><span class="n">sorted_roll_counts</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Roll several of this <code><a href="#Die">Die</a></code> and sum the sorted results from the highest.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rolls:</strong>  The number of dice to roll.</li>
<li><strong>keep:</strong>  The number of dice to keep.</li>
<li><strong>drop:</strong>  If provided, this many highest dice will be dropped before
keeping.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the probability distribution of the sum.</p>
</blockquote>
</div>


                            </div>
                            <div id="Die.abs" class="classattr">
                                        <input id="Die.abs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">abs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.abs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.abs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.abs-873"><a href="#Die.abs-873"><span class="linenos">873</span></a>    <span class="k">def</span> <span class="nf">abs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.abs-874"><a href="#Die.abs-874"><span class="linenos">874</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.round" class="classattr">
                                        <input id="Die.round-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">round</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.round-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.round"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.round-878"><a href="#Die.round-878"><span class="linenos">878</span></a>    <span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.round-879"><a href="#Die.round-879"><span class="linenos">879</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="n">ndigits</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.trunc" class="classattr">
                                        <input id="Die.trunc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">trunc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.trunc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.trunc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.trunc-883"><a href="#Die.trunc-883"><span class="linenos">883</span></a>    <span class="k">def</span> <span class="nf">trunc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.trunc-884"><a href="#Die.trunc-884"><span class="linenos">884</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">trunc</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.floor" class="classattr">
                                        <input id="Die.floor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">floor</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.floor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.floor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.floor-888"><a href="#Die.floor-888"><span class="linenos">888</span></a>    <span class="k">def</span> <span class="nf">floor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.floor-889"><a href="#Die.floor-889"><span class="linenos">889</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.ceil" class="classattr">
                                        <input id="Die.ceil-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ceil</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.ceil-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.ceil"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.ceil-893"><a href="#Die.ceil-893"><span class="linenos">893</span></a>    <span class="k">def</span> <span class="nf">ceil</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.ceil-894"><a href="#Die.ceil-894"><span class="linenos">894</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Die.zero" class="classattr">
                                        <input id="Die.zero-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zero</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.zero-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.zero"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.zero-902"><a href="#Die.zero-902"><span class="linenos">902</span></a>    <span class="k">def</span> <span class="nf">zero</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.zero-903"><a href="#Die.zero-903"><span class="linenos">903</span></a>        <span class="sd">&quot;&quot;&quot;Zeros all outcomes of this die.</span>
</span><span id="Die.zero-904"><a href="#Die.zero-904"><span class="linenos">904</span></a>
</span><span id="Die.zero-905"><a href="#Die.zero-905"><span class="linenos">905</span></a><span class="sd">        This is done by calling the constructor for each outcome&#39;s type with no</span>
</span><span id="Die.zero-906"><a href="#Die.zero-906"><span class="linenos">906</span></a><span class="sd">        arguments.</span>
</span><span id="Die.zero-907"><a href="#Die.zero-907"><span class="linenos">907</span></a>
</span><span id="Die.zero-908"><a href="#Die.zero-908"><span class="linenos">908</span></a><span class="sd">        The result will have the same denominator as this die.</span>
</span><span id="Die.zero-909"><a href="#Die.zero-909"><span class="linenos">909</span></a>
</span><span id="Die.zero-910"><a href="#Die.zero-910"><span class="linenos">910</span></a><span class="sd">        Raises:</span>
</span><span id="Die.zero-911"><a href="#Die.zero-911"><span class="linenos">911</span></a><span class="sd">            ValueError: If the zeros did not resolve to a single outcome.</span>
</span><span id="Die.zero-912"><a href="#Die.zero-912"><span class="linenos">912</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.zero-913"><a href="#Die.zero-913"><span class="linenos">913</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_zero</span><span class="p">)</span>
</span><span id="Die.zero-914"><a href="#Die.zero-914"><span class="linenos">914</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Die.zero-915"><a href="#Die.zero-915"><span class="linenos">915</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;zero() did not resolve to a single outcome.&#39;</span><span class="p">)</span>
</span><span id="Die.zero-916"><a href="#Die.zero-916"><span class="linenos">916</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Zeros all outcomes of this die.</p>

<p>This is done by calling the constructor for each outcome's type with no
arguments.</p>

<p>The result will have the same denominator as this die.</p>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If the zeros did not resolve to a single outcome.</li>
</ul>
</div>


                            </div>
                            <div id="Die.zero_outcome" class="classattr">
                                        <input id="Die.zero_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">zero_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Die.zero_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.zero_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.zero_outcome-918"><a href="#Die.zero_outcome-918"><span class="linenos">918</span></a>    <span class="k">def</span> <span class="nf">zero_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Die.zero_outcome-919"><a href="#Die.zero_outcome-919"><span class="linenos">919</span></a>        <span class="sd">&quot;&quot;&quot;A zero-outcome for this die.</span>
</span><span id="Die.zero_outcome-920"><a href="#Die.zero_outcome-920"><span class="linenos">920</span></a>
</span><span id="Die.zero_outcome-921"><a href="#Die.zero_outcome-921"><span class="linenos">921</span></a><span class="sd">        E.g. `0` for a `Die` whose outcomes are `int`s.</span>
</span><span id="Die.zero_outcome-922"><a href="#Die.zero_outcome-922"><span class="linenos">922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.zero_outcome-923"><a href="#Die.zero_outcome-923"><span class="linenos">923</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A zero-outcome for this die.</p>

<p>E.g. <code>0</code> for a <code><a href="#Die">Die</a></code> whose outcomes are <code>int</code>s.</p>
</div>


                            </div>
                            <div id="Die.cmp" class="classattr">
                                        <input id="Die.cmp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cmp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.cmp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.cmp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.cmp-1193"><a href="#Die.cmp-1193"><span class="linenos">1193</span></a>    <span class="k">def</span> <span class="nf">cmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.cmp-1194"><a href="#Die.cmp-1194"><span class="linenos">1194</span></a>        <span class="sd">&quot;&quot;&quot;A `Die` with outcomes 1, -1, and 0.</span>
</span><span id="Die.cmp-1195"><a href="#Die.cmp-1195"><span class="linenos">1195</span></a>
</span><span id="Die.cmp-1196"><a href="#Die.cmp-1196"><span class="linenos">1196</span></a><span class="sd">        The quantities are equal to the positive outcome of `self &gt; other`,</span>
</span><span id="Die.cmp-1197"><a href="#Die.cmp-1197"><span class="linenos">1197</span></a><span class="sd">        `self &lt; other`, and the remainder respectively.</span>
</span><span id="Die.cmp-1198"><a href="#Die.cmp-1198"><span class="linenos">1198</span></a>
</span><span id="Die.cmp-1199"><a href="#Die.cmp-1199"><span class="linenos">1199</span></a><span class="sd">        This will include all three outcomes even if they have zero quantity.</span>
</span><span id="Die.cmp-1200"><a href="#Die.cmp-1200"><span class="linenos">1200</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.cmp-1201"><a href="#Die.cmp-1201"><span class="linenos">1201</span></a>        <span class="n">other</span> <span class="o">=</span> <span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="Die.cmp-1202"><a href="#Die.cmp-1202"><span class="linenos">1202</span></a>
</span><span id="Die.cmp-1203"><a href="#Die.cmp-1203"><span class="linenos">1203</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Die.cmp-1204"><a href="#Die.cmp-1204"><span class="linenos">1204</span></a>
</span><span id="Die.cmp-1205"><a href="#Die.cmp-1205"><span class="linenos">1205</span></a>        <span class="n">lt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&lt;</span> <span class="n">other</span>
</span><span id="Die.cmp-1206"><a href="#Die.cmp-1206"><span class="linenos">1206</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">lt</span><span class="p">:</span>
</span><span id="Die.cmp-1207"><a href="#Die.cmp-1207"><span class="linenos">1207</span></a>            <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">lt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die.cmp-1208"><a href="#Die.cmp-1208"><span class="linenos">1208</span></a>        <span class="n">eq</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Die.cmp-1209"><a href="#Die.cmp-1209"><span class="linenos">1209</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">eq</span><span class="p">:</span>
</span><span id="Die.cmp-1210"><a href="#Die.cmp-1210"><span class="linenos">1210</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die.cmp-1211"><a href="#Die.cmp-1211"><span class="linenos">1211</span></a>        <span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span> <span class="o">&gt;</span> <span class="n">other</span>
</span><span id="Die.cmp-1212"><a href="#Die.cmp-1212"><span class="linenos">1212</span></a>        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">:</span>
</span><span id="Die.cmp-1213"><a href="#Die.cmp-1213"><span class="linenos">1213</span></a>            <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gt</span><span class="p">[</span><span class="kc">True</span><span class="p">]</span>
</span><span id="Die.cmp-1214"><a href="#Die.cmp-1214"><span class="linenos">1214</span></a>
</span><span id="Die.cmp-1215"><a href="#Die.cmp-1215"><span class="linenos">1215</span></a>        <span class="k">return</span> <span class="n">Die</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Die">Die</a></code> with outcomes 1, -1, and 0.</p>

<p>The quantities are equal to the positive outcome of <code>self &gt; other</code>,
<code>self &lt; other</code>, and the remainder respectively.</p>

<p>This will include all three outcomes even if they have zero quantity.</p>
</div>


                            </div>
                            <div id="Die.sign" class="classattr">
                                        <input id="Die.sign-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sign</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.sign-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.sign"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.sign-1227"><a href="#Die.sign-1227"><span class="linenos">1227</span></a>    <span class="k">def</span> <span class="nf">sign</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.sign-1228"><a href="#Die.sign-1228"><span class="linenos">1228</span></a>        <span class="sd">&quot;&quot;&quot;Outcomes become 1 if greater than `zero()`, -1 if less than `zero()`, and 0 otherwise.</span>
</span><span id="Die.sign-1229"><a href="#Die.sign-1229"><span class="linenos">1229</span></a>
</span><span id="Die.sign-1230"><a href="#Die.sign-1230"><span class="linenos">1230</span></a><span class="sd">        Note that for `float`s, +0.0, -0.0, and nan all become 0.</span>
</span><span id="Die.sign-1231"><a href="#Die.sign-1231"><span class="linenos">1231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.sign-1232"><a href="#Die.sign-1232"><span class="linenos">1232</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="n">Die</span><span class="o">.</span><span class="n">_sign</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Outcomes become 1 if greater than <code><a href="#Die.zero">zero()</a></code>, -1 if less than <code><a href="#Die.zero">zero()</a></code>, and 0 otherwise.</p>

<p>Note that for <code>float</code>s, +0.0, -0.0, and nan all become 0.</p>
</div>


                            </div>
                            <div id="Die.bool" class="classattr">
                                        <input id="Die.bool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bool</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Die.bool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.bool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.bool-1234"><a href="#Die.bool-1234"><span class="linenos">1234</span></a>    <span class="k">def</span> <span class="nf">bool</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Die&#39;</span><span class="p">:</span>
</span><span id="Die.bool-1235"><a href="#Die.bool-1235"><span class="linenos">1235</span></a>        <span class="sd">&quot;&quot;&quot;Takes `bool()` of all outcomes.</span>
</span><span id="Die.bool-1236"><a href="#Die.bool-1236"><span class="linenos">1236</span></a>
</span><span id="Die.bool-1237"><a href="#Die.bool-1237"><span class="linenos">1237</span></a><span class="sd">        Note that a `Die` as a whole is not considered to have a truth value</span>
</span><span id="Die.bool-1238"><a href="#Die.bool-1238"><span class="linenos">1238</span></a><span class="sd">        unless it is the result of the `==` or `!=` operators.</span>
</span><span id="Die.bool-1239"><a href="#Die.bool-1239"><span class="linenos">1239</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.bool-1240"><a href="#Die.bool-1240"><span class="linenos">1240</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">unary_op</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Takes <code><a href="#Die.bool">bool()</a></code> of all outcomes.</p>

<p>Note that a <code><a href="#Die">Die</a></code> as a whole is not considered to have a truth value
unless it is the result of the <code>==</code> or <code>!=</code> operators.</p>
</div>


                            </div>
                            <div id="Die.key_tuple" class="classattr">
                                        <input id="Die.key_tuple-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">key_tuple</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="Die.key_tuple-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.key_tuple"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.key_tuple-1254"><a href="#Die.key_tuple-1254"><span class="linenos">1254</span></a>    <span class="k">def</span> <span class="nf">key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Die.key_tuple-1255"><a href="#Die.key_tuple-1255"><span class="linenos">1255</span></a>        <span class="sd">&quot;&quot;&quot;A tuple that uniquely (as `equals()`) identifies this die.</span>
</span><span id="Die.key_tuple-1256"><a href="#Die.key_tuple-1256"><span class="linenos">1256</span></a>
</span><span id="Die.key_tuple-1257"><a href="#Die.key_tuple-1257"><span class="linenos">1257</span></a><span class="sd">        Apart from being hashable and totally orderable, this is not guaranteed</span>
</span><span id="Die.key_tuple-1258"><a href="#Die.key_tuple-1258"><span class="linenos">1258</span></a><span class="sd">        to be in any particular format or have any other properties.</span>
</span><span id="Die.key_tuple-1259"><a href="#Die.key_tuple-1259"><span class="linenos">1259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.key_tuple-1260"><a href="#Die.key_tuple-1260"><span class="linenos">1260</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span>
</span></pre></div>


            <div class="docstring"><p>A tuple that uniquely (as <code><a href="#Die.equals">equals()</a></code>) identifies this die.</p>

<p>Apart from being hashable and totally orderable, this is not guaranteed
to be in any particular format or have any other properties.</p>
</div>


                            </div>
                            <div id="Die.equals" class="classattr">
                                        <input id="Die.equals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">equals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span>, </span><span class="param"><span class="o">*</span>, </span><span class="param"><span class="n">simplify</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Die.equals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Die.equals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Die.equals-1269"><a href="#Die.equals-1269"><span class="linenos">1269</span></a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Die.equals-1270"><a href="#Die.equals-1270"><span class="linenos">1270</span></a>        <span class="sd">&quot;&quot;&quot;`True` iff both dice have the same outcomes and quantities.</span>
</span><span id="Die.equals-1271"><a href="#Die.equals-1271"><span class="linenos">1271</span></a>
</span><span id="Die.equals-1272"><a href="#Die.equals-1272"><span class="linenos">1272</span></a><span class="sd">        This is `False` if `other` is not a `Die`, even if it would convert</span>
</span><span id="Die.equals-1273"><a href="#Die.equals-1273"><span class="linenos">1273</span></a><span class="sd">        to an equal `Die`.</span>
</span><span id="Die.equals-1274"><a href="#Die.equals-1274"><span class="linenos">1274</span></a>
</span><span id="Die.equals-1275"><a href="#Die.equals-1275"><span class="linenos">1275</span></a><span class="sd">        Truth value does NOT matter.</span>
</span><span id="Die.equals-1276"><a href="#Die.equals-1276"><span class="linenos">1276</span></a>
</span><span id="Die.equals-1277"><a href="#Die.equals-1277"><span class="linenos">1277</span></a><span class="sd">        If one `Die` has a zero-quantity outcome and the other `Die` does not</span>
</span><span id="Die.equals-1278"><a href="#Die.equals-1278"><span class="linenos">1278</span></a><span class="sd">        contain that outcome, they are treated as unequal by this function.</span>
</span><span id="Die.equals-1279"><a href="#Die.equals-1279"><span class="linenos">1279</span></a>
</span><span id="Die.equals-1280"><a href="#Die.equals-1280"><span class="linenos">1280</span></a><span class="sd">        The `==` and `!=` operators have a dual purpose; they return a `Die`</span>
</span><span id="Die.equals-1281"><a href="#Die.equals-1281"><span class="linenos">1281</span></a><span class="sd">        with a truth value determined by this method.</span>
</span><span id="Die.equals-1282"><a href="#Die.equals-1282"><span class="linenos">1282</span></a><span class="sd">        Only dice returned by these methods have a truth value. The data of</span>
</span><span id="Die.equals-1283"><a href="#Die.equals-1283"><span class="linenos">1283</span></a><span class="sd">        these dice is lazily evaluated since the caller may only be interested</span>
</span><span id="Die.equals-1284"><a href="#Die.equals-1284"><span class="linenos">1284</span></a><span class="sd">        in the `Die` value or the truth value.</span>
</span><span id="Die.equals-1285"><a href="#Die.equals-1285"><span class="linenos">1285</span></a>
</span><span id="Die.equals-1286"><a href="#Die.equals-1286"><span class="linenos">1286</span></a><span class="sd">        Args:</span>
</span><span id="Die.equals-1287"><a href="#Die.equals-1287"><span class="linenos">1287</span></a><span class="sd">            simplify: If `True`, the dice will be simplified before comparing.</span>
</span><span id="Die.equals-1288"><a href="#Die.equals-1288"><span class="linenos">1288</span></a><span class="sd">                Otherwise, e.g. a 2:2 coin is not `equals()` to a 1:1 coin.</span>
</span><span id="Die.equals-1289"><a href="#Die.equals-1289"><span class="linenos">1289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Die.equals-1290"><a href="#Die.equals-1290"><span class="linenos">1290</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Die</span><span class="p">):</span>
</span><span id="Die.equals-1291"><a href="#Die.equals-1291"><span class="linenos">1291</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Die.equals-1292"><a href="#Die.equals-1292"><span class="linenos">1292</span></a>
</span><span id="Die.equals-1293"><a href="#Die.equals-1293"><span class="linenos">1293</span></a>        <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
</span><span id="Die.equals-1294"><a href="#Die.equals-1294"><span class="linenos">1294</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span>
</span><span id="Die.equals-1295"><a href="#Die.equals-1295"><span class="linenos">1295</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Die.equals-1296"><a href="#Die.equals-1296"><span class="linenos">1296</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p><code>True</code> iff both dice have the same outcomes and quantities.</p>

<p>This is <code>False</code> if <code>other</code> is not a <code><a href="#Die">Die</a></code>, even if it would convert
to an equal <code><a href="#Die">Die</a></code>.</p>

<p>Truth value does NOT matter.</p>

<p>If one <code><a href="#Die">Die</a></code> has a zero-quantity outcome and the other <code><a href="#Die">Die</a></code> does not
contain that outcome, they are treated as unequal by this function.</p>

<p>The <code>==</code> and <code>!=</code> operators have a dual purpose; they return a <code><a href="#Die">Die</a></code>
with a truth value determined by this method.
Only dice returned by these methods have a truth value. The data of
these dice is lazily evaluated since the caller may only be interested
in the <code><a href="#Die">Die</a></code> value or the truth value.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>simplify:</strong>  If <code>True</code>, the dice will be simplified before comparing.
Otherwise, e.g. a 2:2 coin is not <code><a href="#Die.equals">equals()</a></code> to a 1:1 coin.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Population">Population</a></dt>
                                <dd id="Die.outcomes" class="function"><a href="#Population.outcomes">outcomes</a></dd>
                <dd id="Die.outcome_len" class="function"><a href="#Population.outcome_len">outcome_len</a></dd>
                <dd id="Die.is_empty" class="function"><a href="#Population.is_empty">is_empty</a></dd>
                <dd id="Die.min_outcome" class="function"><a href="#Population.min_outcome">min_outcome</a></dd>
                <dd id="Die.max_outcome" class="function"><a href="#Population.max_outcome">max_outcome</a></dd>
                <dd id="Die.nearest_le" class="function"><a href="#Population.nearest_le">nearest_le</a></dd>
                <dd id="Die.nearest_ge" class="function"><a href="#Population.nearest_ge">nearest_ge</a></dd>
                <dd id="Die.quantities" class="function"><a href="#Population.quantities">quantities</a></dd>
                <dd id="Die.denominator" class="function"><a href="#Population.denominator">denominator</a></dd>
                <dd id="Die.has_zero_quantities" class="function"><a href="#Population.has_zero_quantities">has_zero_quantities</a></dd>
                <dd id="Die.quantities_le" class="function"><a href="#Population.quantities_le">quantities_le</a></dd>
                <dd id="Die.quantities_ge" class="function"><a href="#Population.quantities_ge">quantities_ge</a></dd>
                <dd id="Die.quantity" class="function"><a href="#Population.quantity">quantity</a></dd>
                <dd id="Die.quantity_ne" class="function"><a href="#Population.quantity_ne">quantity_ne</a></dd>
                <dd id="Die.quantity_le" class="function"><a href="#Population.quantity_le">quantity_le</a></dd>
                <dd id="Die.quantity_lt" class="function"><a href="#Population.quantity_lt">quantity_lt</a></dd>
                <dd id="Die.quantity_ge" class="function"><a href="#Population.quantity_ge">quantity_ge</a></dd>
                <dd id="Die.quantity_gt" class="function"><a href="#Population.quantity_gt">quantity_gt</a></dd>
                <dd id="Die.probabilities" class="function"><a href="#Population.probabilities">probabilities</a></dd>
                <dd id="Die.probabilities_le" class="function"><a href="#Population.probabilities_le">probabilities_le</a></dd>
                <dd id="Die.probabilities_ge" class="function"><a href="#Population.probabilities_ge">probabilities_ge</a></dd>
                <dd id="Die.probabilities_lt" class="function"><a href="#Population.probabilities_lt">probabilities_lt</a></dd>
                <dd id="Die.probabilities_gt" class="function"><a href="#Population.probabilities_gt">probabilities_gt</a></dd>
                <dd id="Die.probability" class="function"><a href="#Population.probability">probability</a></dd>
                <dd id="Die.mode" class="function"><a href="#Population.mode">mode</a></dd>
                <dd id="Die.modal_quantity" class="function"><a href="#Population.modal_quantity">modal_quantity</a></dd>
                <dd id="Die.kolmogorov_smirnov" class="function"><a href="#Population.kolmogorov_smirnov">kolmogorov_smirnov</a></dd>
                <dd id="Die.cramer_von_mises" class="function"><a href="#Population.cramer_von_mises">cramer_von_mises</a></dd>
                <dd id="Die.median" class="function"><a href="#Population.median">median</a></dd>
                <dd id="Die.median_left" class="function"><a href="#Population.median_left">median_left</a></dd>
                <dd id="Die.median_right" class="function"><a href="#Population.median_right">median_right</a></dd>
                <dd id="Die.quantile" class="function"><a href="#Population.quantile">quantile</a></dd>
                <dd id="Die.quantile_left" class="function"><a href="#Population.quantile_left">quantile_left</a></dd>
                <dd id="Die.quantile_right" class="function"><a href="#Population.quantile_right">quantile_right</a></dd>
                <dd id="Die.mean" class="function"><a href="#Population.mean">mean</a></dd>
                <dd id="Die.variance" class="function"><a href="#Population.variance">variance</a></dd>
                <dd id="Die.standard_deviation" class="function"><a href="#Population.standard_deviation">standard_deviation</a></dd>
                <dd id="Die.sd" class="function"><a href="#Population.sd">sd</a></dd>
                <dd id="Die.standardized_moment" class="function"><a href="#Population.standardized_moment">standardized_moment</a></dd>
                <dd id="Die.skewness" class="function"><a href="#Population.skewness">skewness</a></dd>
                <dd id="Die.excess_kurtosis" class="function"><a href="#Population.excess_kurtosis">excess_kurtosis</a></dd>
                <dd id="Die.marginals" class="variable"><a href="#Population.marginals">marginals</a></dd>
                <dd id="Die.unary_op_non_elementwise" class="function"><a href="#Population.unary_op_non_elementwise">unary_op_non_elementwise</a></dd>
                <dd id="Die.covariance" class="function"><a href="#Population.covariance">covariance</a></dd>
                <dd id="Die.correlation" class="function"><a href="#Population.correlation">correlation</a></dd>
                <dd id="Die.sample" class="function"><a href="#Population.sample">sample</a></dd>
                <dd id="Die.format" class="function"><a href="#Population.format">format</a></dd>

            </div>
            <div><dt>collections.abc.Mapping</dt>
                                <dd id="Die.get" class="function">get</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Population">
                            <input id="Population-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Population</span><wbr>(<span class="base">abc.ABC</span>, <span class="base">typing.Mapping[typing.Any, int]</span>):

                <label class="view-source-button" for="Population-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population-22"><a href="#Population-22"><span class="linenos"> 22</span></a><span class="k">class</span> <span class="nc">Population</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
</span><span id="Population-23"><a href="#Population-23"><span class="linenos"> 23</span></a>    <span class="sd">&quot;&quot;&quot;A mapping from outcomes to `int` quantities.</span>
</span><span id="Population-24"><a href="#Population-24"><span class="linenos"> 24</span></a>
</span><span id="Population-25"><a href="#Population-25"><span class="linenos"> 25</span></a><span class="sd">    Outcomes with each instance must be hashable and totally orderable.</span>
</span><span id="Population-26"><a href="#Population-26"><span class="linenos"> 26</span></a>
</span><span id="Population-27"><a href="#Population-27"><span class="linenos"> 27</span></a><span class="sd">    Subclasses include `Die` and `Deck`.</span>
</span><span id="Population-28"><a href="#Population-28"><span class="linenos"> 28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Population-29"><a href="#Population-29"><span class="linenos"> 29</span></a>
</span><span id="Population-30"><a href="#Population-30"><span class="linenos"> 30</span></a>    <span class="c1"># Abstract methods.</span>
</span><span id="Population-31"><a href="#Population-31"><span class="linenos"> 31</span></a>
</span><span id="Population-32"><a href="#Population-32"><span class="linenos"> 32</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-33"><a href="#Population-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="nf">_new_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="Population-34"><a href="#Population-34"><span class="linenos"> 34</span></a>        <span class="sd">&quot;&quot;&quot;The type to use when constructing a new instance.&quot;&quot;&quot;</span>
</span><span id="Population-35"><a href="#Population-35"><span class="linenos"> 35</span></a>
</span><span id="Population-36"><a href="#Population-36"><span class="linenos"> 36</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-37"><a href="#Population-37"><span class="linenos"> 37</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Population-38"><a href="#Population-38"><span class="linenos"> 38</span></a>        <span class="sd">&quot;&quot;&quot;The outcomes within the population in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-39"><a href="#Population-39"><span class="linenos"> 39</span></a>
</span><span id="Population-40"><a href="#Population-40"><span class="linenos"> 40</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-41"><a href="#Population-41"><span class="linenos"> 41</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Population-42"><a href="#Population-42"><span class="linenos"> 42</span></a>        <span class="sd">&quot;&quot;&quot;The quantities within the population in outcome order.&quot;&quot;&quot;</span>
</span><span id="Population-43"><a href="#Population-43"><span class="linenos"> 43</span></a>
</span><span id="Population-44"><a href="#Population-44"><span class="linenos"> 44</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population-45"><a href="#Population-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">:</span>
</span><span id="Population-46"><a href="#Population-46"><span class="linenos"> 46</span></a>        <span class="sd">&quot;&quot;&quot;The (outcome, quantity)s of the population in sorted order.&quot;&quot;&quot;</span>
</span><span id="Population-47"><a href="#Population-47"><span class="linenos"> 47</span></a>
</span><span id="Population-48"><a href="#Population-48"><span class="linenos"> 48</span></a>    <span class="c1"># Outcomes.</span>
</span><span id="Population-49"><a href="#Population-49"><span class="linenos"> 49</span></a>
</span><span id="Population-50"><a href="#Population-50"><span class="linenos"> 50</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Population-51"><a href="#Population-51"><span class="linenos"> 51</span></a>        <span class="sd">&quot;&quot;&quot;The sorted outcomes of the mapping.</span>
</span><span id="Population-52"><a href="#Population-52"><span class="linenos"> 52</span></a>
</span><span id="Population-53"><a href="#Population-53"><span class="linenos"> 53</span></a><span class="sd">        These are also the `keys` of the mapping.</span>
</span><span id="Population-54"><a href="#Population-54"><span class="linenos"> 54</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Population-55"><a href="#Population-55"><span class="linenos"> 55</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-56"><a href="#Population-56"><span class="linenos"> 56</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Population-57"><a href="#Population-57"><span class="linenos"> 57</span></a>
</span><span id="Population-58"><a href="#Population-58"><span class="linenos"> 58</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-59"><a href="#Population-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="nf">_outcome_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-60"><a href="#Population-60"><span class="linenos"> 60</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Population-61"><a href="#Population-61"><span class="linenos"> 61</span></a>        <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="Population-62"><a href="#Population-62"><span class="linenos"> 62</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Population-63"><a href="#Population-63"><span class="linenos"> 63</span></a>                <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-64"><a href="#Population-64"><span class="linenos"> 64</span></a>                    <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-65"><a href="#Population-65"><span class="linenos"> 65</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="o">!=</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Population-66"><a href="#Population-66"><span class="linenos"> 66</span></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-67"><a href="#Population-67"><span class="linenos"> 67</span></a>            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="Population-68"><a href="#Population-68"><span class="linenos"> 68</span></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-69"><a href="#Population-69"><span class="linenos"> 69</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Population-70"><a href="#Population-70"><span class="linenos"> 70</span></a>
</span><span id="Population-71"><a href="#Population-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">outcome_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population-72"><a href="#Population-72"><span class="linenos"> 72</span></a>        <span class="sd">&quot;&quot;&quot;The common length of tuple outcomes.</span>
</span><span id="Population-73"><a href="#Population-73"><span class="linenos"> 73</span></a>
</span><span id="Population-74"><a href="#Population-74"><span class="linenos"> 74</span></a><span class="sd">        This is `None` if outcomes are not tuples,</span>
</span><span id="Population-75"><a href="#Population-75"><span class="linenos"> 75</span></a><span class="sd">        or if there are tuples of different lengths.</span>
</span><span id="Population-76"><a href="#Population-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-77"><a href="#Population-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcome_len</span>
</span><span id="Population-78"><a href="#Population-78"><span class="linenos"> 78</span></a>
</span><span id="Population-79"><a href="#Population-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population-80"><a href="#Population-80"><span class="linenos"> 80</span></a>        <span class="sd">&quot;&quot;&quot;`True` iff this mapping has no outcomes. &quot;&quot;&quot;</span>
</span><span id="Population-81"><a href="#Population-81"><span class="linenos"> 81</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="Population-82"><a href="#Population-82"><span class="linenos"> 82</span></a>
</span><span id="Population-83"><a href="#Population-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-84"><a href="#Population-84"><span class="linenos"> 84</span></a>        <span class="sd">&quot;&quot;&quot;The least outcome.&quot;&quot;&quot;</span>
</span><span id="Population-85"><a href="#Population-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Population-86"><a href="#Population-86"><span class="linenos"> 86</span></a>
</span><span id="Population-87"><a href="#Population-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-88"><a href="#Population-88"><span class="linenos"> 88</span></a>        <span class="sd">&quot;&quot;&quot;The greatest outcome.&quot;&quot;&quot;</span>
</span><span id="Population-89"><a href="#Population-89"><span class="linenos"> 89</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Population-90"><a href="#Population-90"><span class="linenos"> 90</span></a>
</span><span id="Population-91"><a href="#Population-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="nf">nearest_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
</span><span id="Population-92"><a href="#Population-92"><span class="linenos"> 92</span></a>        <span class="sd">&quot;&quot;&quot;The nearest outcome that is &lt;= the argument.</span>
</span><span id="Population-93"><a href="#Population-93"><span class="linenos"> 93</span></a>
</span><span id="Population-94"><a href="#Population-94"><span class="linenos"> 94</span></a><span class="sd">        Returns `None` if there is no such outcome.</span>
</span><span id="Population-95"><a href="#Population-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-96"><a href="#Population-96"><span class="linenos"> 96</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population-97"><a href="#Population-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population-98"><a href="#Population-98"><span class="linenos"> 98</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-99"><a href="#Population-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-100"><a href="#Population-100"><span class="linenos">100</span></a>
</span><span id="Population-101"><a href="#Population-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">nearest_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
</span><span id="Population-102"><a href="#Population-102"><span class="linenos">102</span></a>        <span class="sd">&quot;&quot;&quot;The nearest outcome that is &gt;= the argument.</span>
</span><span id="Population-103"><a href="#Population-103"><span class="linenos">103</span></a>
</span><span id="Population-104"><a href="#Population-104"><span class="linenos">104</span></a><span class="sd">        Returns `None` if there is no such outcome.</span>
</span><span id="Population-105"><a href="#Population-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-106"><a href="#Population-106"><span class="linenos">106</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-107"><a href="#Population-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-108"><a href="#Population-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population-109"><a href="#Population-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-110"><a href="#Population-110"><span class="linenos">110</span></a>
</span><span id="Population-111"><a href="#Population-111"><span class="linenos">111</span></a>    <span class="c1"># Quantities.</span>
</span><span id="Population-112"><a href="#Population-112"><span class="linenos">112</span></a>
</span><span id="Population-113"><a href="#Population-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Population-114"><a href="#Population-114"><span class="linenos">114</span></a>        <span class="sd">&quot;&quot;&quot;The quantities of the mapping in sorted order.</span>
</span><span id="Population-115"><a href="#Population-115"><span class="linenos">115</span></a>
</span><span id="Population-116"><a href="#Population-116"><span class="linenos">116</span></a><span class="sd">        These are also the `values` of the mapping.</span>
</span><span id="Population-117"><a href="#Population-117"><span class="linenos">117</span></a><span class="sd">        Prefer to use the name `quantities`.</span>
</span><span id="Population-118"><a href="#Population-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-119"><a href="#Population-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Population-120"><a href="#Population-120"><span class="linenos">120</span></a>
</span><span id="Population-121"><a href="#Population-121"><span class="linenos">121</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-122"><a href="#Population-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-123"><a href="#Population-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Population-124"><a href="#Population-124"><span class="linenos">124</span></a>
</span><span id="Population-125"><a href="#Population-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-126"><a href="#Population-126"><span class="linenos">126</span></a>        <span class="sd">&quot;&quot;&quot;The sum of all quantities (e.g. weights or duplicates).</span>
</span><span id="Population-127"><a href="#Population-127"><span class="linenos">127</span></a>
</span><span id="Population-128"><a href="#Population-128"><span class="linenos">128</span></a><span class="sd">        For the number of unique outcomes, including those with zero quantity,</span>
</span><span id="Population-129"><a href="#Population-129"><span class="linenos">129</span></a><span class="sd">        use `len()`.</span>
</span><span id="Population-130"><a href="#Population-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-131"><a href="#Population-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span><span id="Population-132"><a href="#Population-132"><span class="linenos">132</span></a>
</span><span id="Population-133"><a href="#Population-133"><span class="linenos">133</span></a>    <span class="c1"># Quantities.</span>
</span><span id="Population-134"><a href="#Population-134"><span class="linenos">134</span></a>
</span><span id="Population-135"><a href="#Population-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">has_zero_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population-136"><a href="#Population-136"><span class="linenos">136</span></a>        <span class="sd">&quot;&quot;&quot;`True` iff `self` contains at least one outcome with zero quantity. &quot;&quot;&quot;</span>
</span><span id="Population-137"><a href="#Population-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="mi">0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Population-138"><a href="#Population-138"><span class="linenos">138</span></a>
</span><span id="Population-139"><a href="#Population-139"><span class="linenos">139</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-140"><a href="#Population-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">_quantities_le</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population-141"><a href="#Population-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span id="Population-142"><a href="#Population-142"><span class="linenos">142</span></a>
</span><span id="Population-143"><a href="#Population-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">quantities_le</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population-144"><a href="#Population-144"><span class="linenos">144</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &lt;= each outcome in order. &quot;&quot;&quot;</span>
</span><span id="Population-145"><a href="#Population-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_le</span>
</span><span id="Population-146"><a href="#Population-146"><span class="linenos">146</span></a>
</span><span id="Population-147"><a href="#Population-147"><span class="linenos">147</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-148"><a href="#Population-148"><span class="linenos">148</span></a>    <span class="k">def</span> <span class="nf">_quantities_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population-149"><a href="#Population-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Population-150"><a href="#Population-150"><span class="linenos">150</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="Population-151"><a href="#Population-151"><span class="linenos">151</span></a>                                 <span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span>
</span><span id="Population-152"><a href="#Population-152"><span class="linenos">152</span></a>                                 <span class="n">initial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()))</span>
</span><span id="Population-153"><a href="#Population-153"><span class="linenos">153</span></a>
</span><span id="Population-154"><a href="#Population-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">quantities_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population-155"><a href="#Population-155"><span class="linenos">155</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &gt;= each outcome in order. &quot;&quot;&quot;</span>
</span><span id="Population-156"><a href="#Population-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_ge</span>
</span><span id="Population-157"><a href="#Population-157"><span class="linenos">157</span></a>
</span><span id="Population-158"><a href="#Population-158"><span class="linenos">158</span></a>    <span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-159"><a href="#Population-159"><span class="linenos">159</span></a>        <span class="sd">&quot;&quot;&quot;The quantity of a single outcome, or 0 if not present. &quot;&quot;&quot;</span>
</span><span id="Population-160"><a href="#Population-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Population-161"><a href="#Population-161"><span class="linenos">161</span></a>
</span><span id="Population-162"><a href="#Population-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">quantity_ne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-163"><a href="#Population-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;The quantity != a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population-164"><a href="#Population-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-165"><a href="#Population-165"><span class="linenos">165</span></a>
</span><span id="Population-166"><a href="#Population-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="nf">quantity_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-167"><a href="#Population-167"><span class="linenos">167</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &lt;= a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population-168"><a href="#Population-168"><span class="linenos">168</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population-169"><a href="#Population-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population-170"><a href="#Population-170"><span class="linenos">170</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population-171"><a href="#Population-171"><span class="linenos">171</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-172"><a href="#Population-172"><span class="linenos">172</span></a>
</span><span id="Population-173"><a href="#Population-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">quantity_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-174"><a href="#Population-174"><span class="linenos">174</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &lt; a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population-175"><a href="#Population-175"><span class="linenos">175</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population-176"><a href="#Population-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population-177"><a href="#Population-177"><span class="linenos">177</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population-178"><a href="#Population-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-179"><a href="#Population-179"><span class="linenos">179</span></a>
</span><span id="Population-180"><a href="#Population-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">quantity_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-181"><a href="#Population-181"><span class="linenos">181</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &gt;= a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population-182"><a href="#Population-182"><span class="linenos">182</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-183"><a href="#Population-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-184"><a href="#Population-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population-185"><a href="#Population-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_ge</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-186"><a href="#Population-186"><span class="linenos">186</span></a>
</span><span id="Population-187"><a href="#Population-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">quantity_gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-188"><a href="#Population-188"><span class="linenos">188</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &gt; a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population-189"><a href="#Population-189"><span class="linenos">189</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population-190"><a href="#Population-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-191"><a href="#Population-191"><span class="linenos">191</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population-192"><a href="#Population-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_ge</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-193"><a href="#Population-193"><span class="linenos">193</span></a>
</span><span id="Population-194"><a href="#Population-194"><span class="linenos">194</span></a>    <span class="c1"># Probabilities.</span>
</span><span id="Population-195"><a href="#Population-195"><span class="linenos">195</span></a>
</span><span id="Population-196"><a href="#Population-196"><span class="linenos">196</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-197"><a href="#Population-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">_probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-198"><a href="#Population-198"><span class="linenos">198</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">v</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="Population-199"><a href="#Population-199"><span class="linenos">199</span></a>
</span><span id="Population-200"><a href="#Population-200"><span class="linenos">200</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Population-201"><a href="#Population-201"><span class="linenos">201</span></a>        <span class="sd">&quot;&quot;&quot;The probability of each outcome in order.</span>
</span><span id="Population-202"><a href="#Population-202"><span class="linenos">202</span></a>
</span><span id="Population-203"><a href="#Population-203"><span class="linenos">203</span></a><span class="sd">        Also known as the probability mass function (PMF).</span>
</span><span id="Population-204"><a href="#Population-204"><span class="linenos">204</span></a>
</span><span id="Population-205"><a href="#Population-205"><span class="linenos">205</span></a><span class="sd">        Args:</span>
</span><span id="Population-206"><a href="#Population-206"><span class="linenos">206</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population-207"><a href="#Population-207"><span class="linenos">207</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population-208"><a href="#Population-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-209"><a href="#Population-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population-210"><a href="#Population-210"><span class="linenos">210</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span><span class="p">)</span>
</span><span id="Population-211"><a href="#Population-211"><span class="linenos">211</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-212"><a href="#Population-212"><span class="linenos">212</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span>
</span><span id="Population-213"><a href="#Population-213"><span class="linenos">213</span></a>
</span><span id="Population-214"><a href="#Population-214"><span class="linenos">214</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-215"><a href="#Population-215"><span class="linenos">215</span></a>    <span class="k">def</span> <span class="nf">_probabilities_le</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-216"><a href="#Population-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Population-217"><a href="#Population-217"><span class="linenos">217</span></a>            <span class="n">quantity</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="k">for</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">())</span>
</span><span id="Population-218"><a href="#Population-218"><span class="linenos">218</span></a>
</span><span id="Population-219"><a href="#Population-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">probabilities_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-220"><a href="#Population-220"><span class="linenos">220</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &lt;= each outcome in order.</span>
</span><span id="Population-221"><a href="#Population-221"><span class="linenos">221</span></a>
</span><span id="Population-222"><a href="#Population-222"><span class="linenos">222</span></a><span class="sd">        Also known as the cumulative distribution function (CDF),</span>
</span><span id="Population-223"><a href="#Population-223"><span class="linenos">223</span></a><span class="sd">        though this term is ambigiuous whether it is &lt; or &lt;=.</span>
</span><span id="Population-224"><a href="#Population-224"><span class="linenos">224</span></a>
</span><span id="Population-225"><a href="#Population-225"><span class="linenos">225</span></a><span class="sd">        Args:</span>
</span><span id="Population-226"><a href="#Population-226"><span class="linenos">226</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population-227"><a href="#Population-227"><span class="linenos">227</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population-228"><a href="#Population-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-229"><a href="#Population-229"><span class="linenos">229</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population-230"><a href="#Population-230"><span class="linenos">230</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span><span class="p">)</span>
</span><span id="Population-231"><a href="#Population-231"><span class="linenos">231</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-232"><a href="#Population-232"><span class="linenos">232</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span>
</span><span id="Population-233"><a href="#Population-233"><span class="linenos">233</span></a>
</span><span id="Population-234"><a href="#Population-234"><span class="linenos">234</span></a>    <span class="nd">@cached_property</span>
</span><span id="Population-235"><a href="#Population-235"><span class="linenos">235</span></a>    <span class="k">def</span> <span class="nf">_probabilities_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-236"><a href="#Population-236"><span class="linenos">236</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Population-237"><a href="#Population-237"><span class="linenos">237</span></a>            <span class="n">quantity</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="k">for</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_ge</span><span class="p">())</span>
</span><span id="Population-238"><a href="#Population-238"><span class="linenos">238</span></a>
</span><span id="Population-239"><a href="#Population-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">probabilities_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-240"><a href="#Population-240"><span class="linenos">240</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &gt;= each outcome in order.</span>
</span><span id="Population-241"><a href="#Population-241"><span class="linenos">241</span></a>
</span><span id="Population-242"><a href="#Population-242"><span class="linenos">242</span></a><span class="sd">        Also known as the survival function (SF) or</span>
</span><span id="Population-243"><a href="#Population-243"><span class="linenos">243</span></a><span class="sd">        complementary cumulative distribution function (CCDF),</span>
</span><span id="Population-244"><a href="#Population-244"><span class="linenos">244</span></a><span class="sd">        though these term are ambigiuous whether they are is &gt; or &gt;=.</span>
</span><span id="Population-245"><a href="#Population-245"><span class="linenos">245</span></a>
</span><span id="Population-246"><a href="#Population-246"><span class="linenos">246</span></a><span class="sd">        Args:</span>
</span><span id="Population-247"><a href="#Population-247"><span class="linenos">247</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population-248"><a href="#Population-248"><span class="linenos">248</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population-249"><a href="#Population-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-250"><a href="#Population-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population-251"><a href="#Population-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span><span class="p">)</span>
</span><span id="Population-252"><a href="#Population-252"><span class="linenos">252</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-253"><a href="#Population-253"><span class="linenos">253</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span>
</span><span id="Population-254"><a href="#Population-254"><span class="linenos">254</span></a>
</span><span id="Population-255"><a href="#Population-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">probabilities_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-256"><a href="#Population-256"><span class="linenos">256</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &lt; each outcome in order.</span>
</span><span id="Population-257"><a href="#Population-257"><span class="linenos">257</span></a>
</span><span id="Population-258"><a href="#Population-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="Population-259"><a href="#Population-259"><span class="linenos">259</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population-260"><a href="#Population-260"><span class="linenos">260</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population-261"><a href="#Population-261"><span class="linenos">261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-262"><a href="#Population-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population-263"><a href="#Population-263"><span class="linenos">263</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span><span class="p">)</span>
</span><span id="Population-264"><a href="#Population-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-265"><a href="#Population-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span><span class="p">)</span>
</span><span id="Population-266"><a href="#Population-266"><span class="linenos">266</span></a>
</span><span id="Population-267"><a href="#Population-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">probabilities_gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population-268"><a href="#Population-268"><span class="linenos">268</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &gt; each outcome in order.</span>
</span><span id="Population-269"><a href="#Population-269"><span class="linenos">269</span></a>
</span><span id="Population-270"><a href="#Population-270"><span class="linenos">270</span></a><span class="sd">        Args:</span>
</span><span id="Population-271"><a href="#Population-271"><span class="linenos">271</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population-272"><a href="#Population-272"><span class="linenos">272</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population-273"><a href="#Population-273"><span class="linenos">273</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-274"><a href="#Population-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population-275"><a href="#Population-275"><span class="linenos">275</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span><span class="p">)</span>
</span><span id="Population-276"><a href="#Population-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-277"><a href="#Population-277"><span class="linenos">277</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span><span class="p">)</span>
</span><span id="Population-278"><a href="#Population-278"><span class="linenos">278</span></a>
</span><span id="Population-279"><a href="#Population-279"><span class="linenos">279</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population-280"><a href="#Population-280"><span class="linenos">280</span></a>        <span class="sd">&quot;&quot;&quot;The probability of a single outcome, or 0.0 if not present. &quot;&quot;&quot;</span>
</span><span id="Population-281"><a href="#Population-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Population-282"><a href="#Population-282"><span class="linenos">282</span></a>
</span><span id="Population-283"><a href="#Population-283"><span class="linenos">283</span></a>    <span class="c1"># Scalar statistics.</span>
</span><span id="Population-284"><a href="#Population-284"><span class="linenos">284</span></a>
</span><span id="Population-285"><a href="#Population-285"><span class="linenos">285</span></a>    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Population-286"><a href="#Population-286"><span class="linenos">286</span></a>        <span class="sd">&quot;&quot;&quot;A tuple containing the most common outcome(s) of the population.</span>
</span><span id="Population-287"><a href="#Population-287"><span class="linenos">287</span></a>
</span><span id="Population-288"><a href="#Population-288"><span class="linenos">288</span></a><span class="sd">        These are sorted from lowest to highest.</span>
</span><span id="Population-289"><a href="#Population-289"><span class="linenos">289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-290"><a href="#Population-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Population-291"><a href="#Population-291"><span class="linenos">291</span></a>                     <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">())</span>
</span><span id="Population-292"><a href="#Population-292"><span class="linenos">292</span></a>
</span><span id="Population-293"><a href="#Population-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">modal_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-294"><a href="#Population-294"><span class="linenos">294</span></a>        <span class="sd">&quot;&quot;&quot;The highest quantity of any single outcome. &quot;&quot;&quot;</span>
</span><span id="Population-295"><a href="#Population-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span><span id="Population-296"><a href="#Population-296"><span class="linenos">296</span></a>
</span><span id="Population-297"><a href="#Population-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">kolmogorov_smirnov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Population-298"><a href="#Population-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;Kolmogorov–Smirnov statistic. The maximum absolute difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population-299"><a href="#Population-299"><span class="linenos">299</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population-300"><a href="#Population-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="Population-301"><a href="#Population-301"><span class="linenos">301</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Population-302"><a href="#Population-302"><span class="linenos">302</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">()))</span>
</span><span id="Population-303"><a href="#Population-303"><span class="linenos">303</span></a>
</span><span id="Population-304"><a href="#Population-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="nf">cramer_von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Population-305"><a href="#Population-305"><span class="linenos">305</span></a>        <span class="sd">&quot;&quot;&quot;Cramér-von Mises statistic. The sum-of-squares difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population-306"><a href="#Population-306"><span class="linenos">306</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population-307"><a href="#Population-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Population-308"><a href="#Population-308"><span class="linenos">308</span></a>                   <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">()))</span>
</span><span id="Population-309"><a href="#Population-309"><span class="linenos">309</span></a>
</span><span id="Population-310"><a href="#Population-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-311"><a href="#Population-311"><span class="linenos">311</span></a>        <span class="sd">&quot;&quot;&quot;The median, taking the mean in case of a tie.</span>
</span><span id="Population-312"><a href="#Population-312"><span class="linenos">312</span></a>
</span><span id="Population-313"><a href="#Population-313"><span class="linenos">313</span></a><span class="sd">        This will fail if the outcomes do not support division;</span>
</span><span id="Population-314"><a href="#Population-314"><span class="linenos">314</span></a><span class="sd">        in this case, use `median_left` or `median_right` instead.</span>
</span><span id="Population-315"><a href="#Population-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-316"><a href="#Population-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Population-317"><a href="#Population-317"><span class="linenos">317</span></a>
</span><span id="Population-318"><a href="#Population-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">median_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-319"><a href="#Population-319"><span class="linenos">319</span></a>        <span class="sd">&quot;&quot;&quot;The median, taking the lesser in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-320"><a href="#Population-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_left</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Population-321"><a href="#Population-321"><span class="linenos">321</span></a>
</span><span id="Population-322"><a href="#Population-322"><span class="linenos">322</span></a>    <span class="k">def</span> <span class="nf">median_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-323"><a href="#Population-323"><span class="linenos">323</span></a>        <span class="sd">&quot;&quot;&quot;The median, taking the greater in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-324"><a href="#Population-324"><span class="linenos">324</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_right</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Population-325"><a href="#Population-325"><span class="linenos">325</span></a>
</span><span id="Population-326"><a href="#Population-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">quantile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population-327"><a href="#Population-327"><span class="linenos">327</span></a>        <span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the mean in case of a tie.</span>
</span><span id="Population-328"><a href="#Population-328"><span class="linenos">328</span></a>
</span><span id="Population-329"><a href="#Population-329"><span class="linenos">329</span></a><span class="sd">        This will fail if the outcomes do not support division;</span>
</span><span id="Population-330"><a href="#Population-330"><span class="linenos">330</span></a><span class="sd">        in this case, use `quantile_left` or `quantile_right` instead.</span>
</span><span id="Population-331"><a href="#Population-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-332"><a href="#Population-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantile_left</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_right</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Population-333"><a href="#Population-333"><span class="linenos">333</span></a>
</span><span id="Population-334"><a href="#Population-334"><span class="linenos">334</span></a>    <span class="k">def</span> <span class="nf">quantile_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population-335"><a href="#Population-335"><span class="linenos">335</span></a>        <span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the lesser in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-336"><a href="#Population-336"><span class="linenos">336</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">(),</span>
</span><span id="Population-337"><a href="#Population-337"><span class="linenos">337</span></a>                                   <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population-338"><a href="#Population-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-339"><a href="#Population-339"><span class="linenos">339</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population-340"><a href="#Population-340"><span class="linenos">340</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-341"><a href="#Population-341"><span class="linenos">341</span></a>
</span><span id="Population-342"><a href="#Population-342"><span class="linenos">342</span></a>    <span class="k">def</span> <span class="nf">quantile_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population-343"><a href="#Population-343"><span class="linenos">343</span></a>        <span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the greater in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population-344"><a href="#Population-344"><span class="linenos">344</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">(),</span>
</span><span id="Population-345"><a href="#Population-345"><span class="linenos">345</span></a>                                    <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population-346"><a href="#Population-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-347"><a href="#Population-347"><span class="linenos">347</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population-348"><a href="#Population-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-349"><a href="#Population-349"><span class="linenos">349</span></a>
</span><span id="Population-350"><a href="#Population-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-351"><a href="#Population-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">outcome</span> <span class="o">*</span> <span class="n">quantity</span>
</span><span id="Population-352"><a href="#Population-352"><span class="linenos">352</span></a>                   <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Population-353"><a href="#Population-353"><span class="linenos">353</span></a>
</span><span id="Population-354"><a href="#Population-354"><span class="linenos">354</span></a>    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-355"><a href="#Population-355"><span class="linenos">355</span></a>        <span class="sd">&quot;&quot;&quot;This is the population variance, not the sample variance.&quot;&quot;&quot;</span>
</span><span id="Population-356"><a href="#Population-356"><span class="linenos">356</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-357"><a href="#Population-357"><span class="linenos">357</span></a>        <span class="n">mean_of_squares</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Population-358"><a href="#Population-358"><span class="linenos">358</span></a>            <span class="n">quantity</span> <span class="o">*</span> <span class="n">outcome</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Population-359"><a href="#Population-359"><span class="linenos">359</span></a>            <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Population-360"><a href="#Population-360"><span class="linenos">360</span></a>        <span class="k">return</span> <span class="n">mean_of_squares</span> <span class="o">-</span> <span class="n">mean</span> <span class="o">*</span> <span class="n">mean</span>
</span><span id="Population-361"><a href="#Population-361"><span class="linenos">361</span></a>
</span><span id="Population-362"><a href="#Population-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-363"><a href="#Population-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">())</span>
</span><span id="Population-364"><a href="#Population-364"><span class="linenos">364</span></a>
</span><span id="Population-365"><a href="#Population-365"><span class="linenos">365</span></a>    <span class="n">sd</span> <span class="o">=</span> <span class="n">standard_deviation</span>
</span><span id="Population-366"><a href="#Population-366"><span class="linenos">366</span></a>
</span><span id="Population-367"><a href="#Population-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="nf">standardized_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Population-368"><a href="#Population-368"><span class="linenos">368</span></a>        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population-369"><a href="#Population-369"><span class="linenos">369</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-370"><a href="#Population-370"><span class="linenos">370</span></a>        <span class="n">ev</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="n">k</span>
</span><span id="Population-371"><a href="#Population-371"><span class="linenos">371</span></a>                 <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span><span class="p">()))</span>
</span><span id="Population-372"><a href="#Population-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">ev</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
</span><span id="Population-373"><a href="#Population-373"><span class="linenos">373</span></a>
</span><span id="Population-374"><a href="#Population-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">skewness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-375"><a href="#Population-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
</span><span id="Population-376"><a href="#Population-376"><span class="linenos">376</span></a>
</span><span id="Population-377"><a href="#Population-377"><span class="linenos">377</span></a>    <span class="k">def</span> <span class="nf">excess_kurtosis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-378"><a href="#Population-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.0</span>
</span><span id="Population-379"><a href="#Population-379"><span class="linenos">379</span></a>
</span><span id="Population-380"><a href="#Population-380"><span class="linenos">380</span></a>    <span class="c1"># Joint statistics.</span>
</span><span id="Population-381"><a href="#Population-381"><span class="linenos">381</span></a>
</span><span id="Population-382"><a href="#Population-382"><span class="linenos">382</span></a>    <span class="k">class</span> <span class="nc">_Marginals</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">P</span><span class="p">]):</span>
</span><span id="Population-383"><a href="#Population-383"><span class="linenos">383</span></a>        <span class="sd">&quot;&quot;&quot;Helper class for implementing `marginals()`.&quot;&quot;&quot;</span>
</span><span id="Population-384"><a href="#Population-384"><span class="linenos">384</span></a>
</span><span id="Population-385"><a href="#Population-385"><span class="linenos">385</span></a>        <span class="n">_population</span><span class="p">:</span> <span class="n">P</span>
</span><span id="Population-386"><a href="#Population-386"><span class="linenos">386</span></a>
</span><span id="Population-387"><a href="#Population-387"><span class="linenos">387</span></a>        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">population</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span id="Population-388"><a href="#Population-388"><span class="linenos">388</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_population</span> <span class="o">=</span> <span class="n">population</span>
</span><span id="Population-389"><a href="#Population-389"><span class="linenos">389</span></a>
</span><span id="Population-390"><a href="#Population-390"><span class="linenos">390</span></a>        <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population-391"><a href="#Population-391"><span class="linenos">391</span></a>            <span class="sd">&quot;&quot;&quot;The minimum len() of all outcomes.&quot;&quot;&quot;</span>
</span><span id="Population-392"><a href="#Population-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="Population-393"><a href="#Population-393"><span class="linenos">393</span></a>
</span><span id="Population-394"><a href="#Population-394"><span class="linenos">394</span></a>        <span class="nd">@overload</span>
</span><span id="Population-395"><a href="#Population-395"><span class="linenos">395</span></a>        <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">P</span><span class="p">:</span>
</span><span id="Population-396"><a href="#Population-396"><span class="linenos">396</span></a>            <span class="o">...</span>
</span><span id="Population-397"><a href="#Population-397"><span class="linenos">397</span></a>
</span><span id="Population-398"><a href="#Population-398"><span class="linenos">398</span></a>        <span class="nd">@overload</span>
</span><span id="Population-399"><a href="#Population-399"><span class="linenos">399</span></a>        <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="nb">slice</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">P</span><span class="p">]:</span>
</span><span id="Population-400"><a href="#Population-400"><span class="linenos">400</span></a>            <span class="o">...</span>
</span><span id="Population-401"><a href="#Population-401"><span class="linenos">401</span></a>
</span><span id="Population-402"><a href="#Population-402"><span class="linenos">402</span></a>        <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dims</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">P</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">P</span><span class="p">]:</span>
</span><span id="Population-403"><a href="#Population-403"><span class="linenos">403</span></a>            <span class="sd">&quot;&quot;&quot;Marginalizes the given dimensions.&quot;&quot;&quot;</span>
</span><span id="Population-404"><a href="#Population-404"><span class="linenos">404</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_population</span><span class="o">.</span><span class="n">unary_op_non_elementwise</span><span class="p">(</span>
</span><span id="Population-405"><a href="#Population-405"><span class="linenos">405</span></a>                <span class="n">operator</span><span class="o">.</span><span class="n">getitem</span><span class="p">,</span> <span class="n">dims</span><span class="p">)</span>
</span><span id="Population-406"><a href="#Population-406"><span class="linenos">406</span></a>
</span><span id="Population-407"><a href="#Population-407"><span class="linenos">407</span></a>    <span class="nd">@property</span>
</span><span id="Population-408"><a href="#Population-408"><span class="linenos">408</span></a>    <span class="k">def</span> <span class="nf">marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">P</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">P</span><span class="p">]:</span>
</span><span id="Population-409"><a href="#Population-409"><span class="linenos">409</span></a>        <span class="sd">&quot;&quot;&quot;A property that applies the `[]` operator to outcomes.</span>
</span><span id="Population-410"><a href="#Population-410"><span class="linenos">410</span></a>
</span><span id="Population-411"><a href="#Population-411"><span class="linenos">411</span></a><span class="sd">        This is not performed elementwise on tuples, so that this can be used</span>
</span><span id="Population-412"><a href="#Population-412"><span class="linenos">412</span></a><span class="sd">        to slice tuple outcomes. For example, `population.marginals[:2]` will</span>
</span><span id="Population-413"><a href="#Population-413"><span class="linenos">413</span></a><span class="sd">        marginalize the first two elements of tuples.</span>
</span><span id="Population-414"><a href="#Population-414"><span class="linenos">414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-415"><a href="#Population-415"><span class="linenos">415</span></a>        <span class="k">return</span> <span class="n">Population</span><span class="o">.</span><span class="n">_Marginals</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Population-416"><a href="#Population-416"><span class="linenos">416</span></a>
</span><span id="Population-417"><a href="#Population-417"><span class="linenos">417</span></a>    <span class="k">def</span> <span class="nf">unary_op_non_elementwise</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">P</span><span class="p">:</span>
</span><span id="Population-418"><a href="#Population-418"><span class="linenos">418</span></a>        <span class="sd">&quot;&quot;&quot;As `unary_op()`, but not elementwise.</span>
</span><span id="Population-419"><a href="#Population-419"><span class="linenos">419</span></a>
</span><span id="Population-420"><a href="#Population-420"><span class="linenos">420</span></a><span class="sd">        This is used for `marginals()`.</span>
</span><span id="Population-421"><a href="#Population-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-422"><a href="#Population-422"><span class="linenos">422</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Population-423"><a href="#Population-423"><span class="linenos">423</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Population-424"><a href="#Population-424"><span class="linenos">424</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Population-425"><a href="#Population-425"><span class="linenos">425</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Population-426"><a href="#Population-426"><span class="linenos">426</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">()(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Population-427"><a href="#Population-427"><span class="linenos">427</span></a>
</span><span id="Population-428"><a href="#Population-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Population-429"><a href="#Population-429"><span class="linenos">429</span></a>        <span class="n">mean_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-430"><a href="#Population-430"><span class="linenos">430</span></a>        <span class="n">mean_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population-431"><a href="#Population-431"><span class="linenos">431</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_j</span><span class="p">)</span> <span class="o">*</span> <span class="n">quantity</span>
</span><span id="Population-432"><a href="#Population-432"><span class="linenos">432</span></a>                   <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Population-433"><a href="#Population-433"><span class="linenos">433</span></a>
</span><span id="Population-434"><a href="#Population-434"><span class="linenos">434</span></a>    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Population-435"><a href="#Population-435"><span class="linenos">435</span></a>        <span class="n">sd_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population-436"><a href="#Population-436"><span class="linenos">436</span></a>        <span class="n">sd_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population-437"><a href="#Population-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd_i</span> <span class="o">*</span> <span class="n">sd_j</span><span class="p">)</span>
</span><span id="Population-438"><a href="#Population-438"><span class="linenos">438</span></a>
</span><span id="Population-439"><a href="#Population-439"><span class="linenos">439</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population-440"><a href="#Population-440"><span class="linenos">440</span></a>        <span class="sd">&quot;&quot;&quot;A single random sample from this population.</span>
</span><span id="Population-441"><a href="#Population-441"><span class="linenos">441</span></a>
</span><span id="Population-442"><a href="#Population-442"><span class="linenos">442</span></a><span class="sd">        Note that this is always &quot;with replacement&quot; even for `Deck` since</span>
</span><span id="Population-443"><a href="#Population-443"><span class="linenos">443</span></a><span class="sd">        instances are immutable.</span>
</span><span id="Population-444"><a href="#Population-444"><span class="linenos">444</span></a>
</span><span id="Population-445"><a href="#Population-445"><span class="linenos">445</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="Population-446"><a href="#Population-446"><span class="linenos">446</span></a><span class="sd">        secure.</span>
</span><span id="Population-447"><a href="#Population-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-448"><a href="#Population-448"><span class="linenos">448</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="Population-449"><a href="#Population-449"><span class="linenos">449</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population-450"><a href="#Population-450"><span class="linenos">450</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">(),</span> <span class="n">r</span><span class="p">)</span>
</span><span id="Population-451"><a href="#Population-451"><span class="linenos">451</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span><span id="Population-452"><a href="#Population-452"><span class="linenos">452</span></a>
</span><span id="Population-453"><a href="#Population-453"><span class="linenos">453</span></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population-454"><a href="#Population-454"><span class="linenos">454</span></a>        <span class="sd">&quot;&quot;&quot;Formats this mapping as a string.</span>
</span><span id="Population-455"><a href="#Population-455"><span class="linenos">455</span></a>
</span><span id="Population-456"><a href="#Population-456"><span class="linenos">456</span></a><span class="sd">        `format_spec` should start with the output format,</span>
</span><span id="Population-457"><a href="#Population-457"><span class="linenos">457</span></a><span class="sd">        which is either `md` (Markdown) or `csv` (comma-separated values),</span>
</span><span id="Population-458"><a href="#Population-458"><span class="linenos">458</span></a><span class="sd">        followed by a &#39;:&#39; character.</span>
</span><span id="Population-459"><a href="#Population-459"><span class="linenos">459</span></a>
</span><span id="Population-460"><a href="#Population-460"><span class="linenos">460</span></a><span class="sd">        After this, zero or more columns should follow. Options are:</span>
</span><span id="Population-461"><a href="#Population-461"><span class="linenos">461</span></a>
</span><span id="Population-462"><a href="#Population-462"><span class="linenos">462</span></a><span class="sd">        * `o`: Outcomes.</span>
</span><span id="Population-463"><a href="#Population-463"><span class="linenos">463</span></a><span class="sd">        * `*o`: Outcomes, unpacked if applicable.</span>
</span><span id="Population-464"><a href="#Population-464"><span class="linenos">464</span></a><span class="sd">        * `q==`, `q&lt;=`, `q&gt;=`: Quantities ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population-465"><a href="#Population-465"><span class="linenos">465</span></a><span class="sd">        * `p==`, `p&lt;=`, `p&gt;=`: Probabilities (0-1) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population-466"><a href="#Population-466"><span class="linenos">466</span></a><span class="sd">        * `%==`, `%&lt;=`, `%&gt;=`: Probabilities (0%-100%) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population-467"><a href="#Population-467"><span class="linenos">467</span></a>
</span><span id="Population-468"><a href="#Population-468"><span class="linenos">468</span></a><span class="sd">        Columns may optionally be separated using ` ` (space) or `|` characters.</span>
</span><span id="Population-469"><a href="#Population-469"><span class="linenos">469</span></a>
</span><span id="Population-470"><a href="#Population-470"><span class="linenos">470</span></a><span class="sd">        The default is `&#39;md:*o|q==|%==&#39;`, with the quantity column being omitted</span>
</span><span id="Population-471"><a href="#Population-471"><span class="linenos">471</span></a><span class="sd">        if any quantity exceeds 10**30.</span>
</span><span id="Population-472"><a href="#Population-472"><span class="linenos">472</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population-473"><a href="#Population-473"><span class="linenos">473</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population-474"><a href="#Population-474"><span class="linenos">474</span></a>            <span class="n">format_spec</span> <span class="o">=</span> <span class="s1">&#39;md:*o&#39;</span>
</span><span id="Population-475"><a href="#Population-475"><span class="linenos">475</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">30</span><span class="p">:</span>
</span><span id="Population-476"><a href="#Population-476"><span class="linenos">476</span></a>                <span class="n">format_spec</span> <span class="o">+=</span> <span class="s1">&#39;q==&#39;</span>
</span><span id="Population-477"><a href="#Population-477"><span class="linenos">477</span></a>            <span class="n">format_spec</span> <span class="o">+=</span> <span class="s1">&#39;%==&#39;</span>
</span><span id="Population-478"><a href="#Population-478"><span class="linenos">478</span></a>
</span><span id="Population-479"><a href="#Population-479"><span class="linenos">479</span></a>        <span class="n">format_spec</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Population-480"><a href="#Population-480"><span class="linenos">480</span></a>
</span><span id="Population-481"><a href="#Population-481"><span class="linenos">481</span></a>        <span class="n">output_format</span><span class="p">,</span> <span class="n">format_spec</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="Population-482"><a href="#Population-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Population-483"><a href="#Population-483"><span class="linenos">483</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">)</span>
</span><span id="Population-484"><a href="#Population-484"><span class="linenos">484</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="Population-485"><a href="#Population-485"><span class="linenos">485</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Population-486"><a href="#Population-486"><span class="linenos">486</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population-487"><a href="#Population-487"><span class="linenos">487</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported output format &#39;</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span id="Population-488"><a href="#Population-488"><span class="linenos">488</span></a>
</span><span id="Population-489"><a href="#Population-489"><span class="linenos">489</span></a>    <span class="k">def</span> <span class="fm">__format__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population-490"><a href="#Population-490"><span class="linenos">490</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">format_spec</span><span class="p">)</span>
</span><span id="Population-491"><a href="#Population-491"><span class="linenos">491</span></a>
</span><span id="Population-492"><a href="#Population-492"><span class="linenos">492</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population-493"><a href="#Population-493"><span class="linenos">493</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s1">&#39;</span>
</span></pre></div>


            <div class="docstring"><p>A mapping from outcomes to <code>int</code> quantities.</p>

<p>Outcomes with each instance must be hashable and totally orderable.</p>

<p>Subclasses include <code><a href="#Die">Die</a></code> and <code><a href="#Deck">Deck</a></code>.</p>
</div>


                            <div id="Population.keys" class="classattr">
                                        <input id="Population.keys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">keys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">icepool.CountsKeysView</a></span>:</span></span>

                <label class="view-source-button" for="Population.keys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.keys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.keys-36"><a href="#Population.keys-36"><span class="linenos">36</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population.keys-37"><a href="#Population.keys-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Population.keys-38"><a href="#Population.keys-38"><span class="linenos">38</span></a>        <span class="sd">&quot;&quot;&quot;The outcomes within the population in sorted order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes within the population in sorted order.</p>
</div>


                            </div>
                            <div id="Population.values" class="classattr">
                                        <input id="Population.values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsValuesView">icepool.CountsValuesView</a></span>:</span></span>

                <label class="view-source-button" for="Population.values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.values-40"><a href="#Population.values-40"><span class="linenos">40</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population.values-41"><a href="#Population.values-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Population.values-42"><a href="#Population.values-42"><span class="linenos">42</span></a>        <span class="sd">&quot;&quot;&quot;The quantities within the population in outcome order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The quantities within the population in outcome order.</p>
</div>


                            </div>
                            <div id="Population.items" class="classattr">
                                        <input id="Population.items-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">items</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsItemsView">icepool.CountsItemsView</a></span>:</span></span>

                <label class="view-source-button" for="Population.items-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.items"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.items-44"><a href="#Population.items-44"><span class="linenos">44</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="Population.items-45"><a href="#Population.items-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">:</span>
</span><span id="Population.items-46"><a href="#Population.items-46"><span class="linenos">46</span></a>        <span class="sd">&quot;&quot;&quot;The (outcome, quantity)s of the population in sorted order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The (outcome, quantity)s of the population in sorted order.</p>
</div>


                            </div>
                            <div id="Population.outcomes" class="classattr">
                                        <input id="Population.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">icepool.CountsKeysView</a></span>:</span></span>

                <label class="view-source-button" for="Population.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.outcomes-50"><a href="#Population.outcomes-50"><span class="linenos">50</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Population.outcomes-51"><a href="#Population.outcomes-51"><span class="linenos">51</span></a>        <span class="sd">&quot;&quot;&quot;The sorted outcomes of the mapping.</span>
</span><span id="Population.outcomes-52"><a href="#Population.outcomes-52"><span class="linenos">52</span></a>
</span><span id="Population.outcomes-53"><a href="#Population.outcomes-53"><span class="linenos">53</span></a><span class="sd">        These are also the `keys` of the mapping.</span>
</span><span id="Population.outcomes-54"><a href="#Population.outcomes-54"><span class="linenos">54</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Population.outcomes-55"><a href="#Population.outcomes-55"><span class="linenos">55</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.outcomes-56"><a href="#Population.outcomes-56"><span class="linenos">56</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The sorted outcomes of the mapping.</p>

<p>These are also the <code><a href="#Population.keys">keys</a></code> of the mapping.
Prefer to use the name <code><a href="#Population.outcomes">outcomes</a></code>.</p>
</div>


                            </div>
                            <div id="Population.outcome_len" class="classattr">
                                        <input id="Population.outcome_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcome_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="Population.outcome_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.outcome_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.outcome_len-71"><a href="#Population.outcome_len-71"><span class="linenos">71</span></a>    <span class="k">def</span> <span class="nf">outcome_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Population.outcome_len-72"><a href="#Population.outcome_len-72"><span class="linenos">72</span></a>        <span class="sd">&quot;&quot;&quot;The common length of tuple outcomes.</span>
</span><span id="Population.outcome_len-73"><a href="#Population.outcome_len-73"><span class="linenos">73</span></a>
</span><span id="Population.outcome_len-74"><a href="#Population.outcome_len-74"><span class="linenos">74</span></a><span class="sd">        This is `None` if outcomes are not tuples,</span>
</span><span id="Population.outcome_len-75"><a href="#Population.outcome_len-75"><span class="linenos">75</span></a><span class="sd">        or if there are tuples of different lengths.</span>
</span><span id="Population.outcome_len-76"><a href="#Population.outcome_len-76"><span class="linenos">76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.outcome_len-77"><a href="#Population.outcome_len-77"><span class="linenos">77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcome_len</span>
</span></pre></div>


            <div class="docstring"><p>The common length of tuple outcomes.</p>

<p>This is <code>None</code> if outcomes are not tuples,
or if there are tuples of different lengths.</p>
</div>


                            </div>
                            <div id="Population.is_empty" class="classattr">
                                        <input id="Population.is_empty-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_empty</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Population.is_empty-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.is_empty"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.is_empty-79"><a href="#Population.is_empty-79"><span class="linenos">79</span></a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population.is_empty-80"><a href="#Population.is_empty-80"><span class="linenos">80</span></a>        <span class="sd">&quot;&quot;&quot;`True` iff this mapping has no outcomes. &quot;&quot;&quot;</span>
</span><span id="Population.is_empty-81"><a href="#Population.is_empty-81"><span class="linenos">81</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p><code>True</code> iff this mapping has no outcomes.</p>
</div>


                            </div>
                            <div id="Population.min_outcome" class="classattr">
                                        <input id="Population.min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.min_outcome-83"><a href="#Population.min_outcome-83"><span class="linenos">83</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.min_outcome-84"><a href="#Population.min_outcome-84"><span class="linenos">84</span></a>        <span class="sd">&quot;&quot;&quot;The least outcome.&quot;&quot;&quot;</span>
</span><span id="Population.min_outcome-85"><a href="#Population.min_outcome-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The least outcome.</p>
</div>


                            </div>
                            <div id="Population.max_outcome" class="classattr">
                                        <input id="Population.max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.max_outcome-87"><a href="#Population.max_outcome-87"><span class="linenos">87</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.max_outcome-88"><a href="#Population.max_outcome-88"><span class="linenos">88</span></a>        <span class="sd">&quot;&quot;&quot;The greatest outcome.&quot;&quot;&quot;</span>
</span><span id="Population.max_outcome-89"><a href="#Population.max_outcome-89"><span class="linenos">89</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The greatest outcome.</p>
</div>


                            </div>
                            <div id="Population.nearest_le" class="classattr">
                                        <input id="Population.nearest_le-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nearest_le</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.nearest_le-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.nearest_le"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.nearest_le-91"><a href="#Population.nearest_le-91"><span class="linenos">91</span></a>    <span class="k">def</span> <span class="nf">nearest_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
</span><span id="Population.nearest_le-92"><a href="#Population.nearest_le-92"><span class="linenos">92</span></a>        <span class="sd">&quot;&quot;&quot;The nearest outcome that is &lt;= the argument.</span>
</span><span id="Population.nearest_le-93"><a href="#Population.nearest_le-93"><span class="linenos">93</span></a>
</span><span id="Population.nearest_le-94"><a href="#Population.nearest_le-94"><span class="linenos">94</span></a><span class="sd">        Returns `None` if there is no such outcome.</span>
</span><span id="Population.nearest_le-95"><a href="#Population.nearest_le-95"><span class="linenos">95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.nearest_le-96"><a href="#Population.nearest_le-96"><span class="linenos">96</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population.nearest_le-97"><a href="#Population.nearest_le-97"><span class="linenos">97</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population.nearest_le-98"><a href="#Population.nearest_le-98"><span class="linenos">98</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population.nearest_le-99"><a href="#Population.nearest_le-99"><span class="linenos">99</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The nearest outcome that is &lt;= the argument.</p>

<p>Returns <code>None</code> if there is no such outcome.</p>
</div>


                            </div>
                            <div id="Population.nearest_ge" class="classattr">
                                        <input id="Population.nearest_ge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nearest_ge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.nearest_ge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.nearest_ge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.nearest_ge-101"><a href="#Population.nearest_ge-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">nearest_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">):</span>
</span><span id="Population.nearest_ge-102"><a href="#Population.nearest_ge-102"><span class="linenos">102</span></a>        <span class="sd">&quot;&quot;&quot;The nearest outcome that is &gt;= the argument.</span>
</span><span id="Population.nearest_ge-103"><a href="#Population.nearest_ge-103"><span class="linenos">103</span></a>
</span><span id="Population.nearest_ge-104"><a href="#Population.nearest_ge-104"><span class="linenos">104</span></a><span class="sd">        Returns `None` if there is no such outcome.</span>
</span><span id="Population.nearest_ge-105"><a href="#Population.nearest_ge-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.nearest_ge-106"><a href="#Population.nearest_ge-106"><span class="linenos">106</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.nearest_ge-107"><a href="#Population.nearest_ge-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.nearest_ge-108"><a href="#Population.nearest_ge-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Population.nearest_ge-109"><a href="#Population.nearest_ge-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The nearest outcome that is &gt;= the argument.</p>

<p>Returns <code>None</code> if there is no such outcome.</p>
</div>


                            </div>
                            <div id="Population.quantities" class="classattr">
                                        <input id="Population.quantities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantities</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsValuesView">icepool.CountsValuesView</a></span>:</span></span>

                <label class="view-source-button" for="Population.quantities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantities-113"><a href="#Population.quantities-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Population.quantities-114"><a href="#Population.quantities-114"><span class="linenos">114</span></a>        <span class="sd">&quot;&quot;&quot;The quantities of the mapping in sorted order.</span>
</span><span id="Population.quantities-115"><a href="#Population.quantities-115"><span class="linenos">115</span></a>
</span><span id="Population.quantities-116"><a href="#Population.quantities-116"><span class="linenos">116</span></a><span class="sd">        These are also the `values` of the mapping.</span>
</span><span id="Population.quantities-117"><a href="#Population.quantities-117"><span class="linenos">117</span></a><span class="sd">        Prefer to use the name `quantities`.</span>
</span><span id="Population.quantities-118"><a href="#Population.quantities-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.quantities-119"><a href="#Population.quantities-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The quantities of the mapping in sorted order.</p>

<p>These are also the <code><a href="#Population.values">values</a></code> of the mapping.
Prefer to use the name <code><a href="#Population.quantities">quantities</a></code>.</p>
</div>


                            </div>
                            <div id="Population.denominator" class="classattr">
                                        <input id="Population.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.denominator-125"><a href="#Population.denominator-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.denominator-126"><a href="#Population.denominator-126"><span class="linenos">126</span></a>        <span class="sd">&quot;&quot;&quot;The sum of all quantities (e.g. weights or duplicates).</span>
</span><span id="Population.denominator-127"><a href="#Population.denominator-127"><span class="linenos">127</span></a>
</span><span id="Population.denominator-128"><a href="#Population.denominator-128"><span class="linenos">128</span></a><span class="sd">        For the number of unique outcomes, including those with zero quantity,</span>
</span><span id="Population.denominator-129"><a href="#Population.denominator-129"><span class="linenos">129</span></a><span class="sd">        use `len()`.</span>
</span><span id="Population.denominator-130"><a href="#Population.denominator-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.denominator-131"><a href="#Population.denominator-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span></pre></div>


            <div class="docstring"><p>The sum of all quantities (e.g. weights or duplicates).</p>

<p>For the number of unique outcomes, including those with zero quantity,
use <code>len()</code>.</p>
</div>


                            </div>
                            <div id="Population.has_zero_quantities" class="classattr">
                                        <input id="Population.has_zero_quantities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_zero_quantities</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="Population.has_zero_quantities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.has_zero_quantities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.has_zero_quantities-135"><a href="#Population.has_zero_quantities-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">has_zero_quantities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Population.has_zero_quantities-136"><a href="#Population.has_zero_quantities-136"><span class="linenos">136</span></a>        <span class="sd">&quot;&quot;&quot;`True` iff `self` contains at least one outcome with zero quantity. &quot;&quot;&quot;</span>
</span><span id="Population.has_zero_quantities-137"><a href="#Population.has_zero_quantities-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="mi">0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p><code>True</code> iff <code>self</code> contains at least one outcome with zero quantity.</p>
</div>


                            </div>
                            <div id="Population.quantities_le" class="classattr">
                                        <input id="Population.quantities_le-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantities_le</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.quantities_le-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantities_le"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantities_le-143"><a href="#Population.quantities_le-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">quantities_le</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population.quantities_le-144"><a href="#Population.quantities_le-144"><span class="linenos">144</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &lt;= each outcome in order. &quot;&quot;&quot;</span>
</span><span id="Population.quantities_le-145"><a href="#Population.quantities_le-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_le</span>
</span></pre></div>


            <div class="docstring"><p>The quantity &lt;= each outcome in order.</p>
</div>


                            </div>
                            <div id="Population.quantities_ge" class="classattr">
                                        <input id="Population.quantities_ge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantities_ge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.quantities_ge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantities_ge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantities_ge-154"><a href="#Population.quantities_ge-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">quantities_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="Population.quantities_ge-155"><a href="#Population.quantities_ge-155"><span class="linenos">155</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &gt;= each outcome in order. &quot;&quot;&quot;</span>
</span><span id="Population.quantities_ge-156"><a href="#Population.quantities_ge-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quantities_ge</span>
</span></pre></div>


            <div class="docstring"><p>The quantity &gt;= each outcome in order.</p>
</div>


                            </div>
                            <div id="Population.quantity" class="classattr">
                                        <input id="Population.quantity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.quantity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantity-158"><a href="#Population.quantity-158"><span class="linenos">158</span></a>    <span class="k">def</span> <span class="nf">quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.quantity-159"><a href="#Population.quantity-159"><span class="linenos">159</span></a>        <span class="sd">&quot;&quot;&quot;The quantity of a single outcome, or 0 if not present. &quot;&quot;&quot;</span>
</span><span id="Population.quantity-160"><a href="#Population.quantity-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The quantity of a single outcome, or 0 if not present.</p>
</div>


                            </div>
                            <div id="Population.quantity_ne" class="classattr">
                                        <input id="Population.quantity_ne-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantity_ne</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.quantity_ne-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantity_ne"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantity_ne-162"><a href="#Population.quantity_ne-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">quantity_ne</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.quantity_ne-163"><a href="#Population.quantity_ne-163"><span class="linenos">163</span></a>        <span class="sd">&quot;&quot;&quot;The quantity != a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population.quantity_ne-164"><a href="#Population.quantity_ne-164"><span class="linenos">164</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The quantity != a single outcome.</p>
</div>


                            </div>
                            <div id="Population.quantity_le" class="classattr">
                                        <input id="Population.quantity_le-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantity_le</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.quantity_le-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantity_le"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantity_le-166"><a href="#Population.quantity_le-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="nf">quantity_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.quantity_le-167"><a href="#Population.quantity_le-167"><span class="linenos">167</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &lt;= a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population.quantity_le-168"><a href="#Population.quantity_le-168"><span class="linenos">168</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population.quantity_le-169"><a href="#Population.quantity_le-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population.quantity_le-170"><a href="#Population.quantity_le-170"><span class="linenos">170</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population.quantity_le-171"><a href="#Population.quantity_le-171"><span class="linenos">171</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The quantity &lt;= a single outcome.</p>
</div>


                            </div>
                            <div id="Population.quantity_lt" class="classattr">
                                        <input id="Population.quantity_lt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantity_lt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.quantity_lt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantity_lt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantity_lt-173"><a href="#Population.quantity_lt-173"><span class="linenos">173</span></a>    <span class="k">def</span> <span class="nf">quantity_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.quantity_lt-174"><a href="#Population.quantity_lt-174"><span class="linenos">174</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &lt; a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population.quantity_lt-175"><a href="#Population.quantity_lt-175"><span class="linenos">175</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Population.quantity_lt-176"><a href="#Population.quantity_lt-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population.quantity_lt-177"><a href="#Population.quantity_lt-177"><span class="linenos">177</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population.quantity_lt-178"><a href="#Population.quantity_lt-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The quantity &lt; a single outcome.</p>
</div>


                            </div>
                            <div id="Population.quantity_ge" class="classattr">
                                        <input id="Population.quantity_ge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantity_ge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.quantity_ge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantity_ge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantity_ge-180"><a href="#Population.quantity_ge-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">quantity_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.quantity_ge-181"><a href="#Population.quantity_ge-181"><span class="linenos">181</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &gt;= a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population.quantity_ge-182"><a href="#Population.quantity_ge-182"><span class="linenos">182</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.quantity_ge-183"><a href="#Population.quantity_ge-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.quantity_ge-184"><a href="#Population.quantity_ge-184"><span class="linenos">184</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population.quantity_ge-185"><a href="#Population.quantity_ge-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_ge</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The quantity &gt;= a single outcome.</p>
</div>


                            </div>
                            <div id="Population.quantity_gt" class="classattr">
                                        <input id="Population.quantity_gt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantity_gt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.quantity_gt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantity_gt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantity_gt-187"><a href="#Population.quantity_gt-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">quantity_gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.quantity_gt-188"><a href="#Population.quantity_gt-188"><span class="linenos">188</span></a>        <span class="sd">&quot;&quot;&quot;The quantity &gt; a single outcome. &quot;&quot;&quot;</span>
</span><span id="Population.quantity_gt-189"><a href="#Population.quantity_gt-189"><span class="linenos">189</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="Population.quantity_gt-190"><a href="#Population.quantity_gt-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.quantity_gt-191"><a href="#Population.quantity_gt-191"><span class="linenos">191</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="Population.quantity_gt-192"><a href="#Population.quantity_gt-192"><span class="linenos">192</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities_ge</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The quantity &gt; a single outcome.</p>
</div>


                            </div>
                            <div id="Population.probabilities" class="classattr">
                                        <input id="Population.probabilities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probabilities</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.probabilities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probabilities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probabilities-200"><a href="#Population.probabilities-200"><span class="linenos">200</span></a>    <span class="k">def</span> <span class="nf">probabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="Population.probabilities-201"><a href="#Population.probabilities-201"><span class="linenos">201</span></a>        <span class="sd">&quot;&quot;&quot;The probability of each outcome in order.</span>
</span><span id="Population.probabilities-202"><a href="#Population.probabilities-202"><span class="linenos">202</span></a>
</span><span id="Population.probabilities-203"><a href="#Population.probabilities-203"><span class="linenos">203</span></a><span class="sd">        Also known as the probability mass function (PMF).</span>
</span><span id="Population.probabilities-204"><a href="#Population.probabilities-204"><span class="linenos">204</span></a>
</span><span id="Population.probabilities-205"><a href="#Population.probabilities-205"><span class="linenos">205</span></a><span class="sd">        Args:</span>
</span><span id="Population.probabilities-206"><a href="#Population.probabilities-206"><span class="linenos">206</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population.probabilities-207"><a href="#Population.probabilities-207"><span class="linenos">207</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population.probabilities-208"><a href="#Population.probabilities-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.probabilities-209"><a href="#Population.probabilities-209"><span class="linenos">209</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population.probabilities-210"><a href="#Population.probabilities-210"><span class="linenos">210</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span><span class="p">)</span>
</span><span id="Population.probabilities-211"><a href="#Population.probabilities-211"><span class="linenos">211</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.probabilities-212"><a href="#Population.probabilities-212"><span class="linenos">212</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities</span>
</span></pre></div>


            <div class="docstring"><p>The probability of each outcome in order.</p>

<p>Also known as the probability mass function (PMF).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>percent:</strong>  If set, the results will be in percent (i.e. total of 100.0).
Otherwise, the total will be 1.0.</li>
</ul>
</div>


                            </div>
                            <div id="Population.probabilities_le" class="classattr">
                                        <input id="Population.probabilities_le-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probabilities_le</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.probabilities_le-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probabilities_le"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probabilities_le-219"><a href="#Population.probabilities_le-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">probabilities_le</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population.probabilities_le-220"><a href="#Population.probabilities_le-220"><span class="linenos">220</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &lt;= each outcome in order.</span>
</span><span id="Population.probabilities_le-221"><a href="#Population.probabilities_le-221"><span class="linenos">221</span></a>
</span><span id="Population.probabilities_le-222"><a href="#Population.probabilities_le-222"><span class="linenos">222</span></a><span class="sd">        Also known as the cumulative distribution function (CDF),</span>
</span><span id="Population.probabilities_le-223"><a href="#Population.probabilities_le-223"><span class="linenos">223</span></a><span class="sd">        though this term is ambigiuous whether it is &lt; or &lt;=.</span>
</span><span id="Population.probabilities_le-224"><a href="#Population.probabilities_le-224"><span class="linenos">224</span></a>
</span><span id="Population.probabilities_le-225"><a href="#Population.probabilities_le-225"><span class="linenos">225</span></a><span class="sd">        Args:</span>
</span><span id="Population.probabilities_le-226"><a href="#Population.probabilities_le-226"><span class="linenos">226</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population.probabilities_le-227"><a href="#Population.probabilities_le-227"><span class="linenos">227</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population.probabilities_le-228"><a href="#Population.probabilities_le-228"><span class="linenos">228</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.probabilities_le-229"><a href="#Population.probabilities_le-229"><span class="linenos">229</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population.probabilities_le-230"><a href="#Population.probabilities_le-230"><span class="linenos">230</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span><span class="p">)</span>
</span><span id="Population.probabilities_le-231"><a href="#Population.probabilities_le-231"><span class="linenos">231</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.probabilities_le-232"><a href="#Population.probabilities_le-232"><span class="linenos">232</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span>
</span></pre></div>


            <div class="docstring"><p>The probability of rolling &lt;= each outcome in order.</p>

<p>Also known as the cumulative distribution function (CDF),
though this term is ambigiuous whether it is &lt; or &lt;=.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>percent:</strong>  If set, the results will be in percent (i.e. total of 100.0).
Otherwise, the total will be 1.0.</li>
</ul>
</div>


                            </div>
                            <div id="Population.probabilities_ge" class="classattr">
                                        <input id="Population.probabilities_ge-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probabilities_ge</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.probabilities_ge-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probabilities_ge"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probabilities_ge-239"><a href="#Population.probabilities_ge-239"><span class="linenos">239</span></a>    <span class="k">def</span> <span class="nf">probabilities_ge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population.probabilities_ge-240"><a href="#Population.probabilities_ge-240"><span class="linenos">240</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &gt;= each outcome in order.</span>
</span><span id="Population.probabilities_ge-241"><a href="#Population.probabilities_ge-241"><span class="linenos">241</span></a>
</span><span id="Population.probabilities_ge-242"><a href="#Population.probabilities_ge-242"><span class="linenos">242</span></a><span class="sd">        Also known as the survival function (SF) or</span>
</span><span id="Population.probabilities_ge-243"><a href="#Population.probabilities_ge-243"><span class="linenos">243</span></a><span class="sd">        complementary cumulative distribution function (CCDF),</span>
</span><span id="Population.probabilities_ge-244"><a href="#Population.probabilities_ge-244"><span class="linenos">244</span></a><span class="sd">        though these term are ambigiuous whether they are is &gt; or &gt;=.</span>
</span><span id="Population.probabilities_ge-245"><a href="#Population.probabilities_ge-245"><span class="linenos">245</span></a>
</span><span id="Population.probabilities_ge-246"><a href="#Population.probabilities_ge-246"><span class="linenos">246</span></a><span class="sd">        Args:</span>
</span><span id="Population.probabilities_ge-247"><a href="#Population.probabilities_ge-247"><span class="linenos">247</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population.probabilities_ge-248"><a href="#Population.probabilities_ge-248"><span class="linenos">248</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population.probabilities_ge-249"><a href="#Population.probabilities_ge-249"><span class="linenos">249</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.probabilities_ge-250"><a href="#Population.probabilities_ge-250"><span class="linenos">250</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population.probabilities_ge-251"><a href="#Population.probabilities_ge-251"><span class="linenos">251</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span><span class="p">)</span>
</span><span id="Population.probabilities_ge-252"><a href="#Population.probabilities_ge-252"><span class="linenos">252</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.probabilities_ge-253"><a href="#Population.probabilities_ge-253"><span class="linenos">253</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span>
</span></pre></div>


            <div class="docstring"><p>The probability of rolling &gt;= each outcome in order.</p>

<p>Also known as the survival function (SF) or
complementary cumulative distribution function (CCDF),
though these term are ambigiuous whether they are is &gt; or &gt;=.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>percent:</strong>  If set, the results will be in percent (i.e. total of 100.0).
Otherwise, the total will be 1.0.</li>
</ul>
</div>


                            </div>
                            <div id="Population.probabilities_lt" class="classattr">
                                        <input id="Population.probabilities_lt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probabilities_lt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.probabilities_lt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probabilities_lt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probabilities_lt-255"><a href="#Population.probabilities_lt-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="nf">probabilities_lt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population.probabilities_lt-256"><a href="#Population.probabilities_lt-256"><span class="linenos">256</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &lt; each outcome in order.</span>
</span><span id="Population.probabilities_lt-257"><a href="#Population.probabilities_lt-257"><span class="linenos">257</span></a>
</span><span id="Population.probabilities_lt-258"><a href="#Population.probabilities_lt-258"><span class="linenos">258</span></a><span class="sd">        Args:</span>
</span><span id="Population.probabilities_lt-259"><a href="#Population.probabilities_lt-259"><span class="linenos">259</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population.probabilities_lt-260"><a href="#Population.probabilities_lt-260"><span class="linenos">260</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population.probabilities_lt-261"><a href="#Population.probabilities_lt-261"><span class="linenos">261</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.probabilities_lt-262"><a href="#Population.probabilities_lt-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population.probabilities_lt-263"><a href="#Population.probabilities_lt-263"><span class="linenos">263</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span><span class="p">)</span>
</span><span id="Population.probabilities_lt-264"><a href="#Population.probabilities_lt-264"><span class="linenos">264</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.probabilities_lt-265"><a href="#Population.probabilities_lt-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_ge</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The probability of rolling &lt; each outcome in order.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>percent:</strong>  If set, the results will be in percent (i.e. total of 100.0).
Otherwise, the total will be 1.0.</li>
</ul>
</div>


                            </div>
                            <div id="Population.probabilities_gt" class="classattr">
                                        <input id="Population.probabilities_gt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probabilities_gt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Population.probabilities_gt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probabilities_gt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probabilities_gt-267"><a href="#Population.probabilities_gt-267"><span class="linenos">267</span></a>    <span class="k">def</span> <span class="nf">probabilities_gt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">percent</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="Population.probabilities_gt-268"><a href="#Population.probabilities_gt-268"><span class="linenos">268</span></a>        <span class="sd">&quot;&quot;&quot;The probability of rolling &gt; each outcome in order.</span>
</span><span id="Population.probabilities_gt-269"><a href="#Population.probabilities_gt-269"><span class="linenos">269</span></a>
</span><span id="Population.probabilities_gt-270"><a href="#Population.probabilities_gt-270"><span class="linenos">270</span></a><span class="sd">        Args:</span>
</span><span id="Population.probabilities_gt-271"><a href="#Population.probabilities_gt-271"><span class="linenos">271</span></a><span class="sd">            percent: If set, the results will be in percent (i.e. total of 100.0).</span>
</span><span id="Population.probabilities_gt-272"><a href="#Population.probabilities_gt-272"><span class="linenos">272</span></a><span class="sd">                Otherwise, the total will be 1.0.</span>
</span><span id="Population.probabilities_gt-273"><a href="#Population.probabilities_gt-273"><span class="linenos">273</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.probabilities_gt-274"><a href="#Population.probabilities_gt-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="n">percent</span><span class="p">:</span>
</span><span id="Population.probabilities_gt-275"><a href="#Population.probabilities_gt-275"><span class="linenos">275</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="mf">100.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span><span class="p">)</span>
</span><span id="Population.probabilities_gt-276"><a href="#Population.probabilities_gt-276"><span class="linenos">276</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.probabilities_gt-277"><a href="#Population.probabilities_gt-277"><span class="linenos">277</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_probabilities_le</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The probability of rolling &gt; each outcome in order.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>percent:</strong>  If set, the results will be in percent (i.e. total of 100.0).
Otherwise, the total will be 1.0.</li>
</ul>
</div>


                            </div>
                            <div id="Population.probability" class="classattr">
                                        <input id="Population.probability-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">probability</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">outcome</span></span><span class="return-annotation">) -> <span class="nb">float</span>:</span></span>

                <label class="view-source-button" for="Population.probability-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.probability"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.probability-279"><a href="#Population.probability-279"><span class="linenos">279</span></a>    <span class="k">def</span> <span class="nf">probability</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="Population.probability-280"><a href="#Population.probability-280"><span class="linenos">280</span></a>        <span class="sd">&quot;&quot;&quot;The probability of a single outcome, or 0.0 if not present. &quot;&quot;&quot;</span>
</span><span id="Population.probability-281"><a href="#Population.probability-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantity</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The probability of a single outcome, or 0.0 if not present.</p>
</div>


                            </div>
                            <div id="Population.mode" class="classattr">
                                        <input id="Population.mode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="Population.mode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.mode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.mode-285"><a href="#Population.mode-285"><span class="linenos">285</span></a>    <span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Population.mode-286"><a href="#Population.mode-286"><span class="linenos">286</span></a>        <span class="sd">&quot;&quot;&quot;A tuple containing the most common outcome(s) of the population.</span>
</span><span id="Population.mode-287"><a href="#Population.mode-287"><span class="linenos">287</span></a>
</span><span id="Population.mode-288"><a href="#Population.mode-288"><span class="linenos">288</span></a><span class="sd">        These are sorted from lowest to highest.</span>
</span><span id="Population.mode-289"><a href="#Population.mode-289"><span class="linenos">289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.mode-290"><a href="#Population.mode-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outcome</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Population.mode-291"><a href="#Population.mode-291"><span class="linenos">291</span></a>                     <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>A tuple containing the most common outcome(s) of the population.</p>

<p>These are sorted from lowest to highest.</p>
</div>


                            </div>
                            <div id="Population.modal_quantity" class="classattr">
                                        <input id="Population.modal_quantity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">modal_quantity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Population.modal_quantity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.modal_quantity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.modal_quantity-293"><a href="#Population.modal_quantity-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="nf">modal_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Population.modal_quantity-294"><a href="#Population.modal_quantity-294"><span class="linenos">294</span></a>        <span class="sd">&quot;&quot;&quot;The highest quantity of any single outcome. &quot;&quot;&quot;</span>
</span><span id="Population.modal_quantity-295"><a href="#Population.modal_quantity-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>The highest quantity of any single outcome.</p>
</div>


                            </div>
                            <div id="Population.kolmogorov_smirnov" class="classattr">
                                        <input id="Population.kolmogorov_smirnov-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">kolmogorov_smirnov</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.kolmogorov_smirnov-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.kolmogorov_smirnov"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.kolmogorov_smirnov-297"><a href="#Population.kolmogorov_smirnov-297"><span class="linenos">297</span></a>    <span class="k">def</span> <span class="nf">kolmogorov_smirnov</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Population.kolmogorov_smirnov-298"><a href="#Population.kolmogorov_smirnov-298"><span class="linenos">298</span></a>        <span class="sd">&quot;&quot;&quot;Kolmogorov–Smirnov statistic. The maximum absolute difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population.kolmogorov_smirnov-299"><a href="#Population.kolmogorov_smirnov-299"><span class="linenos">299</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population.kolmogorov_smirnov-300"><a href="#Population.kolmogorov_smirnov-300"><span class="linenos">300</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="Population.kolmogorov_smirnov-301"><a href="#Population.kolmogorov_smirnov-301"><span class="linenos">301</span></a>            <span class="nb">abs</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Population.kolmogorov_smirnov-302"><a href="#Population.kolmogorov_smirnov-302"><span class="linenos">302</span></a>            <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">()))</span>
</span></pre></div>


            <div class="docstring"><p>Kolmogorov–Smirnov statistic. The maximum absolute difference between CDFs.</p>
</div>


                            </div>
                            <div id="Population.cramer_von_mises" class="classattr">
                                        <input id="Population.cramer_von_mises-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cramer_von_mises</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.cramer_von_mises-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.cramer_von_mises"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.cramer_von_mises-304"><a href="#Population.cramer_von_mises-304"><span class="linenos">304</span></a>    <span class="k">def</span> <span class="nf">cramer_von_mises</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Population.cramer_von_mises-305"><a href="#Population.cramer_von_mises-305"><span class="linenos">305</span></a>        <span class="sd">&quot;&quot;&quot;Cramér-von Mises statistic. The sum-of-squares difference between CDFs. &quot;&quot;&quot;</span>
</span><span id="Population.cramer_von_mises-306"><a href="#Population.cramer_von_mises-306"><span class="linenos">306</span></a>        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Population.cramer_von_mises-307"><a href="#Population.cramer_von_mises-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Population.cramer_von_mises-308"><a href="#Population.cramer_von_mises-308"><span class="linenos">308</span></a>                   <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">probabilities_le</span><span class="p">()))</span>
</span></pre></div>


            <div class="docstring"><p>Cramér-von Mises statistic. The sum-of-squares difference between CDFs.</p>
</div>


                            </div>
                            <div id="Population.median" class="classattr">
                                        <input id="Population.median-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.median-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.median"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.median-310"><a href="#Population.median-310"><span class="linenos">310</span></a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.median-311"><a href="#Population.median-311"><span class="linenos">311</span></a>        <span class="sd">&quot;&quot;&quot;The median, taking the mean in case of a tie.</span>
</span><span id="Population.median-312"><a href="#Population.median-312"><span class="linenos">312</span></a>
</span><span id="Population.median-313"><a href="#Population.median-313"><span class="linenos">313</span></a><span class="sd">        This will fail if the outcomes do not support division;</span>
</span><span id="Population.median-314"><a href="#Population.median-314"><span class="linenos">314</span></a><span class="sd">        in this case, use `median_left` or `median_right` instead.</span>
</span><span id="Population.median-315"><a href="#Population.median-315"><span class="linenos">315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.median-316"><a href="#Population.median-316"><span class="linenos">316</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The median, taking the mean in case of a tie.</p>

<p>This will fail if the outcomes do not support division;
in this case, use <code><a href="#Population.median_left">median_left</a></code> or <code><a href="#Population.median_right">median_right</a></code> instead.</p>
</div>


                            </div>
                            <div id="Population.median_left" class="classattr">
                                        <input id="Population.median_left-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median_left</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.median_left-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.median_left"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.median_left-318"><a href="#Population.median_left-318"><span class="linenos">318</span></a>    <span class="k">def</span> <span class="nf">median_left</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.median_left-319"><a href="#Population.median_left-319"><span class="linenos">319</span></a>        <span class="sd">&quot;&quot;&quot;The median, taking the lesser in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.median_left-320"><a href="#Population.median_left-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_left</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The median, taking the lesser in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.median_right" class="classattr">
                                        <input id="Population.median_right-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">median_right</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.median_right-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.median_right"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.median_right-322"><a href="#Population.median_right-322"><span class="linenos">322</span></a>    <span class="k">def</span> <span class="nf">median_right</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.median_right-323"><a href="#Population.median_right-323"><span class="linenos">323</span></a>        <span class="sd">&quot;&quot;&quot;The median, taking the greater in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.median_right-324"><a href="#Population.median_right-324"><span class="linenos">324</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_right</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The median, taking the greater in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.quantile" class="classattr">
                                        <input id="Population.quantile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.quantile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantile-326"><a href="#Population.quantile-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">quantile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population.quantile-327"><a href="#Population.quantile-327"><span class="linenos">327</span></a>        <span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the mean in case of a tie.</span>
</span><span id="Population.quantile-328"><a href="#Population.quantile-328"><span class="linenos">328</span></a>
</span><span id="Population.quantile-329"><a href="#Population.quantile-329"><span class="linenos">329</span></a><span class="sd">        This will fail if the outcomes do not support division;</span>
</span><span id="Population.quantile-330"><a href="#Population.quantile-330"><span class="linenos">330</span></a><span class="sd">        in this case, use `quantile_left` or `quantile_right` instead.</span>
</span><span id="Population.quantile-331"><a href="#Population.quantile-331"><span class="linenos">331</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.quantile-332"><a href="#Population.quantile-332"><span class="linenos">332</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantile_left</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantile_right</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span>
</span></pre></div>


            <div class="docstring"><p>The outcome <code>n / d</code> of the way through the CDF, taking the mean in case of a tie.</p>

<p>This will fail if the outcomes do not support division;
in this case, use <code><a href="#Population.quantile_left">quantile_left</a></code> or <code><a href="#Population.quantile_right">quantile_right</a></code> instead.</p>
</div>


                            </div>
                            <div id="Population.quantile_left" class="classattr">
                                        <input id="Population.quantile_left-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantile_left</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.quantile_left-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantile_left"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantile_left-334"><a href="#Population.quantile_left-334"><span class="linenos">334</span></a>    <span class="k">def</span> <span class="nf">quantile_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population.quantile_left-335"><a href="#Population.quantile_left-335"><span class="linenos">335</span></a>        <span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the lesser in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.quantile_left-336"><a href="#Population.quantile_left-336"><span class="linenos">336</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_left</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">(),</span>
</span><span id="Population.quantile_left-337"><a href="#Population.quantile_left-337"><span class="linenos">337</span></a>                                   <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population.quantile_left-338"><a href="#Population.quantile_left-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.quantile_left-339"><a href="#Population.quantile_left-339"><span class="linenos">339</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population.quantile_left-340"><a href="#Population.quantile_left-340"><span class="linenos">340</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The outcome <code>n / d</code> of the way through the CDF, taking the lesser in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.quantile_right" class="classattr">
                                        <input id="Population.quantile_right-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">quantile_right</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">n</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.quantile_right-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.quantile_right"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.quantile_right-342"><a href="#Population.quantile_right-342"><span class="linenos">342</span></a>    <span class="k">def</span> <span class="nf">quantile_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
</span><span id="Population.quantile_right-343"><a href="#Population.quantile_right-343"><span class="linenos">343</span></a>        <span class="sd">&quot;&quot;&quot;The outcome `n / d` of the way through the CDF, taking the greater in case of a tie.&quot;&quot;&quot;</span>
</span><span id="Population.quantile_right-344"><a href="#Population.quantile_right-344"><span class="linenos">344</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">(),</span>
</span><span id="Population.quantile_right-345"><a href="#Population.quantile_right-345"><span class="linenos">345</span></a>                                    <span class="n">n</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">//</span> <span class="n">d</span><span class="p">)</span>
</span><span id="Population.quantile_right-346"><a href="#Population.quantile_right-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.quantile_right-347"><a href="#Population.quantile_right-347"><span class="linenos">347</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="Population.quantile_right-348"><a href="#Population.quantile_right-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>The outcome <code>n / d</code> of the way through the CDF, taking the greater in case of a tie.</p>
</div>


                            </div>
                            <div id="Population.mean" class="classattr">
                                        <input id="Population.mean-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mean</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.mean-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.mean"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.mean-350"><a href="#Population.mean-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.mean-351"><a href="#Population.mean-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">outcome</span> <span class="o">*</span> <span class="n">quantity</span>
</span><span id="Population.mean-352"><a href="#Population.mean-352"><span class="linenos">352</span></a>                   <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.variance" class="classattr">
                                        <input id="Population.variance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">variance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.variance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.variance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.variance-354"><a href="#Population.variance-354"><span class="linenos">354</span></a>    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.variance-355"><a href="#Population.variance-355"><span class="linenos">355</span></a>        <span class="sd">&quot;&quot;&quot;This is the population variance, not the sample variance.&quot;&quot;&quot;</span>
</span><span id="Population.variance-356"><a href="#Population.variance-356"><span class="linenos">356</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.variance-357"><a href="#Population.variance-357"><span class="linenos">357</span></a>        <span class="n">mean_of_squares</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
</span><span id="Population.variance-358"><a href="#Population.variance-358"><span class="linenos">358</span></a>            <span class="n">quantity</span> <span class="o">*</span> <span class="n">outcome</span><span class="o">**</span><span class="mi">2</span>
</span><span id="Population.variance-359"><a href="#Population.variance-359"><span class="linenos">359</span></a>            <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Population.variance-360"><a href="#Population.variance-360"><span class="linenos">360</span></a>        <span class="k">return</span> <span class="n">mean_of_squares</span> <span class="o">-</span> <span class="n">mean</span> <span class="o">*</span> <span class="n">mean</span>
</span></pre></div>


            <div class="docstring"><p>This is the population variance, not the sample variance.</p>
</div>


                            </div>
                            <div id="Population.standard_deviation" class="classattr">
                                        <input id="Population.standard_deviation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standard_deviation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.standard_deviation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.standard_deviation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.standard_deviation-362"><a href="#Population.standard_deviation-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.standard_deviation-363"><a href="#Population.standard_deviation-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.sd" class="classattr">
                                        <input id="Population.sd-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sd</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.sd-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.sd"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.sd-362"><a href="#Population.sd-362"><span class="linenos">362</span></a>    <span class="k">def</span> <span class="nf">standard_deviation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.sd-363"><a href="#Population.sd-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variance</span><span class="p">())</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.standardized_moment" class="classattr">
                                        <input id="Population.standardized_moment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standardized_moment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">k</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.standardized_moment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.standardized_moment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.standardized_moment-367"><a href="#Population.standardized_moment-367"><span class="linenos">367</span></a>    <span class="k">def</span> <span class="nf">standardized_moment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Population.standardized_moment-368"><a href="#Population.standardized_moment-368"><span class="linenos">368</span></a>        <span class="n">sd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population.standardized_moment-369"><a href="#Population.standardized_moment-369"><span class="linenos">369</span></a>        <span class="n">mean</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.standardized_moment-370"><a href="#Population.standardized_moment-370"><span class="linenos">370</span></a>        <span class="n">ev</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="n">k</span>
</span><span id="Population.standardized_moment-371"><a href="#Population.standardized_moment-371"><span class="linenos">371</span></a>                 <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">probabilities</span><span class="p">()))</span>
</span><span id="Population.standardized_moment-372"><a href="#Population.standardized_moment-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">ev</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.skewness" class="classattr">
                                        <input id="Population.skewness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">skewness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.skewness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.skewness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.skewness-374"><a href="#Population.skewness-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">skewness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.skewness-375"><a href="#Population.skewness-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.excess_kurtosis" class="classattr">
                                        <input id="Population.excess_kurtosis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">excess_kurtosis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.excess_kurtosis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.excess_kurtosis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.excess_kurtosis-377"><a href="#Population.excess_kurtosis-377"><span class="linenos">377</span></a>    <span class="k">def</span> <span class="nf">excess_kurtosis</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.excess_kurtosis-378"><a href="#Population.excess_kurtosis-378"><span class="linenos">378</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">standardized_moment</span><span class="p">(</span><span class="mf">4.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.0</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.marginals" class="classattr">
                                <div class="attr variable">
            <span class="name">marginals</span><span class="annotation">: Sequence[~P]</span>

        
    </div>
    <a class="headerlink" href="#Population.marginals"></a>
    
            <div class="docstring"><p>A property that applies the <code>[]</code> operator to outcomes.</p>

<p>This is not performed elementwise on tuples, so that this can be used
to slice tuple outcomes. For example, <code>population.marginals[:2]</code> will
marginalize the first two elements of tuples.</p>
</div>


                            </div>
                            <div id="Population.unary_op_non_elementwise" class="classattr">
                                        <input id="Population.unary_op_non_elementwise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unary_op_non_elementwise</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span><span class="p">:</span> <span class="o">~</span><span class="n">P</span>, </span><span class="param"><span class="n">op</span><span class="p">:</span> <span class="n">Callable</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">P</span>:</span></span>

                <label class="view-source-button" for="Population.unary_op_non_elementwise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.unary_op_non_elementwise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.unary_op_non_elementwise-417"><a href="#Population.unary_op_non_elementwise-417"><span class="linenos">417</span></a>    <span class="k">def</span> <span class="nf">unary_op_non_elementwise</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">op</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">P</span><span class="p">:</span>
</span><span id="Population.unary_op_non_elementwise-418"><a href="#Population.unary_op_non_elementwise-418"><span class="linenos">418</span></a>        <span class="sd">&quot;&quot;&quot;As `unary_op()`, but not elementwise.</span>
</span><span id="Population.unary_op_non_elementwise-419"><a href="#Population.unary_op_non_elementwise-419"><span class="linenos">419</span></a>
</span><span id="Population.unary_op_non_elementwise-420"><a href="#Population.unary_op_non_elementwise-420"><span class="linenos">420</span></a><span class="sd">        This is used for `marginals()`.</span>
</span><span id="Population.unary_op_non_elementwise-421"><a href="#Population.unary_op_non_elementwise-421"><span class="linenos">421</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.unary_op_non_elementwise-422"><a href="#Population.unary_op_non_elementwise-422"><span class="linenos">422</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Population.unary_op_non_elementwise-423"><a href="#Population.unary_op_non_elementwise-423"><span class="linenos">423</span></a>        <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Population.unary_op_non_elementwise-424"><a href="#Population.unary_op_non_elementwise-424"><span class="linenos">424</span></a>            <span class="n">new_outcome</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Population.unary_op_non_elementwise-425"><a href="#Population.unary_op_non_elementwise-425"><span class="linenos">425</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">new_outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
</span><span id="Population.unary_op_non_elementwise-426"><a href="#Population.unary_op_non_elementwise-426"><span class="linenos">426</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_type</span><span class="p">()(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>As <code>unary_op()</code>, but not elementwise.</p>

<p>This is used for <code><a href="#Population.marginals">marginals()</a></code>.</p>
</div>


                            </div>
                            <div id="Population.covariance" class="classattr">
                                        <input id="Population.covariance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">covariance</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">j</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.covariance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.covariance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.covariance-428"><a href="#Population.covariance-428"><span class="linenos">428</span></a>    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Population.covariance-429"><a href="#Population.covariance-429"><span class="linenos">429</span></a>        <span class="n">mean_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.covariance-430"><a href="#Population.covariance-430"><span class="linenos">430</span></a>        <span class="n">mean_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</span><span id="Population.covariance-431"><a href="#Population.covariance-431"><span class="linenos">431</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">((</span><span class="n">outcome</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">mean_j</span><span class="p">)</span> <span class="o">*</span> <span class="n">quantity</span>
</span><span id="Population.covariance-432"><a href="#Population.covariance-432"><span class="linenos">432</span></a>                   <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.correlation" class="classattr">
                                        <input id="Population.correlation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">correlation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">j</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.correlation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.correlation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.correlation-434"><a href="#Population.correlation-434"><span class="linenos">434</span></a>    <span class="k">def</span> <span class="nf">correlation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Population.correlation-435"><a href="#Population.correlation-435"><span class="linenos">435</span></a>        <span class="n">sd_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population.correlation-436"><a href="#Population.correlation-436"><span class="linenos">436</span></a>        <span class="n">sd_j</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">marginals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">standard_deviation</span><span class="p">()</span>
</span><span id="Population.correlation-437"><a href="#Population.correlation-437"><span class="linenos">437</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">covariance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd_i</span> <span class="o">*</span> <span class="n">sd_j</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Population.sample" class="classattr">
                                        <input id="Population.sample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Population.sample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.sample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.sample-439"><a href="#Population.sample-439"><span class="linenos">439</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Population.sample-440"><a href="#Population.sample-440"><span class="linenos">440</span></a>        <span class="sd">&quot;&quot;&quot;A single random sample from this population.</span>
</span><span id="Population.sample-441"><a href="#Population.sample-441"><span class="linenos">441</span></a>
</span><span id="Population.sample-442"><a href="#Population.sample-442"><span class="linenos">442</span></a><span class="sd">        Note that this is always &quot;with replacement&quot; even for `Deck` since</span>
</span><span id="Population.sample-443"><a href="#Population.sample-443"><span class="linenos">443</span></a><span class="sd">        instances are immutable.</span>
</span><span id="Population.sample-444"><a href="#Population.sample-444"><span class="linenos">444</span></a>
</span><span id="Population.sample-445"><a href="#Population.sample-445"><span class="linenos">445</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="Population.sample-446"><a href="#Population.sample-446"><span class="linenos">446</span></a><span class="sd">        secure.</span>
</span><span id="Population.sample-447"><a href="#Population.sample-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.sample-448"><a href="#Population.sample-448"><span class="linenos">448</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="Population.sample-449"><a href="#Population.sample-449"><span class="linenos">449</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator</span><span class="p">())</span>
</span><span id="Population.sample-450"><a href="#Population.sample-450"><span class="linenos">450</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities_le</span><span class="p">(),</span> <span class="n">r</span><span class="p">)</span>
</span><span id="Population.sample-451"><a href="#Population.sample-451"><span class="linenos">451</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="n">index</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>A single random sample from this population.</p>

<p>Note that this is always "with replacement" even for <code><a href="#Deck">Deck</a></code> since
instances are immutable.</p>

<p>This uses the standard <code>random</code> package and is not cryptographically
secure.</p>
</div>


                            </div>
                            <div id="Population.format" class="classattr">
                                        <input id="Population.format-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">format</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="Population.format-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Population.format"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Population.format-453"><a href="#Population.format-453"><span class="linenos">453</span></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Population.format-454"><a href="#Population.format-454"><span class="linenos">454</span></a>        <span class="sd">&quot;&quot;&quot;Formats this mapping as a string.</span>
</span><span id="Population.format-455"><a href="#Population.format-455"><span class="linenos">455</span></a>
</span><span id="Population.format-456"><a href="#Population.format-456"><span class="linenos">456</span></a><span class="sd">        `format_spec` should start with the output format,</span>
</span><span id="Population.format-457"><a href="#Population.format-457"><span class="linenos">457</span></a><span class="sd">        which is either `md` (Markdown) or `csv` (comma-separated values),</span>
</span><span id="Population.format-458"><a href="#Population.format-458"><span class="linenos">458</span></a><span class="sd">        followed by a &#39;:&#39; character.</span>
</span><span id="Population.format-459"><a href="#Population.format-459"><span class="linenos">459</span></a>
</span><span id="Population.format-460"><a href="#Population.format-460"><span class="linenos">460</span></a><span class="sd">        After this, zero or more columns should follow. Options are:</span>
</span><span id="Population.format-461"><a href="#Population.format-461"><span class="linenos">461</span></a>
</span><span id="Population.format-462"><a href="#Population.format-462"><span class="linenos">462</span></a><span class="sd">        * `o`: Outcomes.</span>
</span><span id="Population.format-463"><a href="#Population.format-463"><span class="linenos">463</span></a><span class="sd">        * `*o`: Outcomes, unpacked if applicable.</span>
</span><span id="Population.format-464"><a href="#Population.format-464"><span class="linenos">464</span></a><span class="sd">        * `q==`, `q&lt;=`, `q&gt;=`: Quantities ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population.format-465"><a href="#Population.format-465"><span class="linenos">465</span></a><span class="sd">        * `p==`, `p&lt;=`, `p&gt;=`: Probabilities (0-1) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population.format-466"><a href="#Population.format-466"><span class="linenos">466</span></a><span class="sd">        * `%==`, `%&lt;=`, `%&gt;=`: Probabilities (0%-100%) ==, &lt;=, or &gt;= each outcome.</span>
</span><span id="Population.format-467"><a href="#Population.format-467"><span class="linenos">467</span></a>
</span><span id="Population.format-468"><a href="#Population.format-468"><span class="linenos">468</span></a><span class="sd">        Columns may optionally be separated using ` ` (space) or `|` characters.</span>
</span><span id="Population.format-469"><a href="#Population.format-469"><span class="linenos">469</span></a>
</span><span id="Population.format-470"><a href="#Population.format-470"><span class="linenos">470</span></a><span class="sd">        The default is `&#39;md:*o|q==|%==&#39;`, with the quantity column being omitted</span>
</span><span id="Population.format-471"><a href="#Population.format-471"><span class="linenos">471</span></a><span class="sd">        if any quantity exceeds 10**30.</span>
</span><span id="Population.format-472"><a href="#Population.format-472"><span class="linenos">472</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Population.format-473"><a href="#Population.format-473"><span class="linenos">473</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">format_spec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Population.format-474"><a href="#Population.format-474"><span class="linenos">474</span></a>            <span class="n">format_spec</span> <span class="o">=</span> <span class="s1">&#39;md:*o&#39;</span>
</span><span id="Population.format-475"><a href="#Population.format-475"><span class="linenos">475</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_quantity</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">**</span><span class="mi">30</span><span class="p">:</span>
</span><span id="Population.format-476"><a href="#Population.format-476"><span class="linenos">476</span></a>                <span class="n">format_spec</span> <span class="o">+=</span> <span class="s1">&#39;q==&#39;</span>
</span><span id="Population.format-477"><a href="#Population.format-477"><span class="linenos">477</span></a>            <span class="n">format_spec</span> <span class="o">+=</span> <span class="s1">&#39;%==&#39;</span>
</span><span id="Population.format-478"><a href="#Population.format-478"><span class="linenos">478</span></a>
</span><span id="Population.format-479"><a href="#Population.format-479"><span class="linenos">479</span></a>        <span class="n">format_spec</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Population.format-480"><a href="#Population.format-480"><span class="linenos">480</span></a>
</span><span id="Population.format-481"><a href="#Population.format-481"><span class="linenos">481</span></a>        <span class="n">output_format</span><span class="p">,</span> <span class="n">format_spec</span> <span class="o">=</span> <span class="n">format_spec</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
</span><span id="Population.format-482"><a href="#Population.format-482"><span class="linenos">482</span></a>        <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;md&#39;</span><span class="p">:</span>
</span><span id="Population.format-483"><a href="#Population.format-483"><span class="linenos">483</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">markdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">)</span>
</span><span id="Population.format-484"><a href="#Population.format-484"><span class="linenos">484</span></a>        <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span><span id="Population.format-485"><a href="#Population.format-485"><span class="linenos">485</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Population.format-486"><a href="#Population.format-486"><span class="linenos">486</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Population.format-487"><a href="#Population.format-487"><span class="linenos">487</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported output format &#39;</span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Formats this mapping as a string.</p>

<p><code>format_spec</code> should start with the output format,
which is either <code>md</code> (Markdown) or <code>csv</code> (comma-separated values),
followed by a ':' character.</p>

<p>After this, zero or more columns should follow. Options are:</p>

<ul>
<li><code>o</code>: Outcomes.</li>
<li><code>*o</code>: Outcomes, unpacked if applicable.</li>
<li><code>q==</code>, <code>q&lt;=</code>, <code>q&gt;=</code>: Quantities ==, &lt;=, or &gt;= each outcome.</li>
<li><code>p==</code>, <code>p&lt;=</code>, <code>p&gt;=</code>: Probabilities (0-1) ==, &lt;=, or &gt;= each outcome.</li>
<li><code>%==</code>, <code>%&lt;=</code>, <code>%&gt;=</code>: Probabilities (0%-100%) ==, &lt;=, or &gt;= each outcome.</li>
</ul>

<p>Columns may optionally be separated using <code></code> (space) or <code>|</code> characters.</p>

<p>The default is <code>'md:*o|q==|%=='</code>, with the quantity column being omitted
if any quantity exceeds 10**30.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Mapping</dt>
                                <dd id="Population.get" class="function">get</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Again">
                            <input id="Again-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Again</span>:

                <label class="view-source-button" for="Again-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Again"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Again-12"><a href="#Again-12"><span class="linenos"> 12</span></a><span class="k">class</span> <span class="nc">Again</span><span class="p">():</span>
</span><span id="Again-13"><a href="#Again-13"><span class="linenos"> 13</span></a>    <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: A placeholder value used to indicate that the die should be rolled again with some modification.</span>
</span><span id="Again-14"><a href="#Again-14"><span class="linenos"> 14</span></a>
</span><span id="Again-15"><a href="#Again-15"><span class="linenos"> 15</span></a><span class="sd">    Examples:</span>
</span><span id="Again-16"><a href="#Again-16"><span class="linenos"> 16</span></a>
</span><span id="Again-17"><a href="#Again-17"><span class="linenos"> 17</span></a><span class="sd">    * `Again()` + 6: Roll again and add 6.</span>
</span><span id="Again-18"><a href="#Again-18"><span class="linenos"> 18</span></a><span class="sd">    * `Again(lambda x: x + 6)`: Another way of doing the same thing.</span>
</span><span id="Again-19"><a href="#Again-19"><span class="linenos"> 19</span></a><span class="sd">    * `Again()` + `Again()`: Roll again twice and sum.</span>
</span><span id="Again-20"><a href="#Again-20"><span class="linenos"> 20</span></a>
</span><span id="Again-21"><a href="#Again-21"><span class="linenos"> 21</span></a><span class="sd">    This can also be used as part of a return value with functions such as</span>
</span><span id="Again-22"><a href="#Again-22"><span class="linenos"> 22</span></a><span class="sd">    `Die.sub()`, though I don&#39;t recommend getting too fancy---it can get</span>
</span><span id="Again-23"><a href="#Again-23"><span class="linenos"> 23</span></a><span class="sd">    confusing very quickly.</span>
</span><span id="Again-24"><a href="#Again-24"><span class="linenos"> 24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Again-25"><a href="#Again-25"><span class="linenos"> 25</span></a>
</span><span id="Again-26"><a href="#Again-26"><span class="linenos"> 26</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="Again-27"><a href="#Again-27"><span class="linenos"> 27</span></a>        <span class="sd">&quot;&quot;&quot;Creates an `Again` placeholder from the given function and args.</span>
</span><span id="Again-28"><a href="#Again-28"><span class="linenos"> 28</span></a>
</span><span id="Again-29"><a href="#Again-29"><span class="linenos"> 29</span></a><span class="sd">        Any of the args may themselves be instances of `Again`. These are</span>
</span><span id="Again-30"><a href="#Again-30"><span class="linenos"> 30</span></a><span class="sd">        considered to be at the same level for purposes of `again_depth`.</span>
</span><span id="Again-31"><a href="#Again-31"><span class="linenos"> 31</span></a>
</span><span id="Again-32"><a href="#Again-32"><span class="linenos"> 32</span></a><span class="sd">        The supplied function will be called with the given args, except any</span>
</span><span id="Again-33"><a href="#Again-33"><span class="linenos"> 33</span></a><span class="sd">        arguments of type `Again` will have resolved to the `Die` resulting</span>
</span><span id="Again-34"><a href="#Again-34"><span class="linenos"> 34</span></a><span class="sd">        from rolling again.</span>
</span><span id="Again-35"><a href="#Again-35"><span class="linenos"> 35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Again-36"><a href="#Again-36"><span class="linenos"> 36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="Again-37"><a href="#Again-37"><span class="linenos"> 37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="Again-38"><a href="#Again-38"><span class="linenos"> 38</span></a>
</span><span id="Again-39"><a href="#Again-39"><span class="linenos"> 39</span></a>    <span class="k">def</span> <span class="nf">_evaluate_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">die</span><span class="p">:</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">):</span>
</span><span id="Again-40"><a href="#Again-40"><span class="linenos"> 40</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">Again</span><span class="p">):</span>
</span><span id="Again-41"><a href="#Again-41"><span class="linenos"> 41</span></a>            <span class="k">return</span> <span class="n">arg</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">die</span><span class="p">)</span>
</span><span id="Again-42"><a href="#Again-42"><span class="linenos"> 42</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Again-43"><a href="#Again-43"><span class="linenos"> 43</span></a>            <span class="k">return</span> <span class="n">arg</span>
</span><span id="Again-44"><a href="#Again-44"><span class="linenos"> 44</span></a>
</span><span id="Again-45"><a href="#Again-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="nf">_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">die</span><span class="p">:</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">):</span>
</span><span id="Again-46"><a href="#Again-46"><span class="linenos"> 46</span></a>        <span class="sd">&quot;&quot;&quot;Recursively substitutes the provided `Die` for the `Again` placeholders.&quot;&quot;&quot;</span>
</span><span id="Again-47"><a href="#Again-47"><span class="linenos"> 47</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Again-48"><a href="#Again-48"><span class="linenos"> 48</span></a>            <span class="k">return</span> <span class="n">die</span>
</span><span id="Again-49"><a href="#Again-49"><span class="linenos"> 49</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Again-50"><a href="#Again-50"><span class="linenos"> 50</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">(</span>
</span><span id="Again-51"><a href="#Again-51"><span class="linenos"> 51</span></a>                <span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_arg</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">))</span>
</span><span id="Again-52"><a href="#Again-52"><span class="linenos"> 52</span></a>
</span><span id="Again-53"><a href="#Again-53"><span class="linenos"> 53</span></a>    <span class="c1"># Unary operators.</span>
</span><span id="Again-54"><a href="#Again-54"><span class="linenos"> 54</span></a>
</span><span id="Again-55"><a href="#Again-55"><span class="linenos"> 55</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-56"><a href="#Again-56"><span class="linenos"> 56</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-57"><a href="#Again-57"><span class="linenos"> 57</span></a>
</span><span id="Again-58"><a href="#Again-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="fm">__pos__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-59"><a href="#Again-59"><span class="linenos"> 59</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-60"><a href="#Again-60"><span class="linenos"> 60</span></a>
</span><span id="Again-61"><a href="#Again-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__invert__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-62"><a href="#Again-62"><span class="linenos"> 62</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">invert</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-63"><a href="#Again-63"><span class="linenos"> 63</span></a>
</span><span id="Again-64"><a href="#Again-64"><span class="linenos"> 64</span></a>    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-65"><a href="#Again-65"><span class="linenos"> 65</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">abs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-66"><a href="#Again-66"><span class="linenos"> 66</span></a>
</span><span id="Again-67"><a href="#Again-67"><span class="linenos"> 67</span></a>    <span class="c1"># Binary operators.</span>
</span><span id="Again-68"><a href="#Again-68"><span class="linenos"> 68</span></a>
</span><span id="Again-69"><a href="#Again-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-70"><a href="#Again-70"><span class="linenos"> 70</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-71"><a href="#Again-71"><span class="linenos"> 71</span></a>
</span><span id="Again-72"><a href="#Again-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-73"><a href="#Again-73"><span class="linenos"> 73</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-74"><a href="#Again-74"><span class="linenos"> 74</span></a>
</span><span id="Again-75"><a href="#Again-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-76"><a href="#Again-76"><span class="linenos"> 76</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-77"><a href="#Again-77"><span class="linenos"> 77</span></a>
</span><span id="Again-78"><a href="#Again-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-79"><a href="#Again-79"><span class="linenos"> 79</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-80"><a href="#Again-80"><span class="linenos"> 80</span></a>
</span><span id="Again-81"><a href="#Again-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-82"><a href="#Again-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-83"><a href="#Again-83"><span class="linenos"> 83</span></a>
</span><span id="Again-84"><a href="#Again-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-85"><a href="#Again-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-86"><a href="#Again-86"><span class="linenos"> 86</span></a>
</span><span id="Again-87"><a href="#Again-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-88"><a href="#Again-88"><span class="linenos"> 88</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-89"><a href="#Again-89"><span class="linenos"> 89</span></a>
</span><span id="Again-90"><a href="#Again-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-91"><a href="#Again-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">truediv</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-92"><a href="#Again-92"><span class="linenos"> 92</span></a>
</span><span id="Again-93"><a href="#Again-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="fm">__floordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-94"><a href="#Again-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-95"><a href="#Again-95"><span class="linenos"> 95</span></a>
</span><span id="Again-96"><a href="#Again-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="fm">__rfloordiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-97"><a href="#Again-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">floordiv</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-98"><a href="#Again-98"><span class="linenos"> 98</span></a>
</span><span id="Again-99"><a href="#Again-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-100"><a href="#Again-100"><span class="linenos">100</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-101"><a href="#Again-101"><span class="linenos">101</span></a>
</span><span id="Again-102"><a href="#Again-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="fm">__rpow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-103"><a href="#Again-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">pow</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-104"><a href="#Again-104"><span class="linenos">104</span></a>
</span><span id="Again-105"><a href="#Again-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="fm">__mod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-106"><a href="#Again-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-107"><a href="#Again-107"><span class="linenos">107</span></a>
</span><span id="Again-108"><a href="#Again-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="fm">__rmod__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-109"><a href="#Again-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mod</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-110"><a href="#Again-110"><span class="linenos">110</span></a>
</span><span id="Again-111"><a href="#Again-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="fm">__lshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-112"><a href="#Again-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-113"><a href="#Again-113"><span class="linenos">113</span></a>
</span><span id="Again-114"><a href="#Again-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="fm">__rlshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-115"><a href="#Again-115"><span class="linenos">115</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">lshift</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-116"><a href="#Again-116"><span class="linenos">116</span></a>
</span><span id="Again-117"><a href="#Again-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="fm">__rshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-118"><a href="#Again-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-119"><a href="#Again-119"><span class="linenos">119</span></a>
</span><span id="Again-120"><a href="#Again-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="fm">__rrshift__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-121"><a href="#Again-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">rshift</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-122"><a href="#Again-122"><span class="linenos">122</span></a>
</span><span id="Again-123"><a href="#Again-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="fm">__and__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-124"><a href="#Again-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-125"><a href="#Again-125"><span class="linenos">125</span></a>
</span><span id="Again-126"><a href="#Again-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="fm">__rand__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-127"><a href="#Again-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">and_</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-128"><a href="#Again-128"><span class="linenos">128</span></a>
</span><span id="Again-129"><a href="#Again-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="fm">__or__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-130"><a href="#Again-130"><span class="linenos">130</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-131"><a href="#Again-131"><span class="linenos">131</span></a>
</span><span id="Again-132"><a href="#Again-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="fm">__ror__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-133"><a href="#Again-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">or_</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-134"><a href="#Again-134"><span class="linenos">134</span></a>
</span><span id="Again-135"><a href="#Again-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="fm">__xor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-136"><a href="#Again-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-137"><a href="#Again-137"><span class="linenos">137</span></a>
</span><span id="Again-138"><a href="#Again-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="fm">__rxor__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-139"><a href="#Again-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">xor</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-140"><a href="#Again-140"><span class="linenos">140</span></a>
</span><span id="Again-141"><a href="#Again-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="fm">__matmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-142"><a href="#Again-142"><span class="linenos">142</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">matmul</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</span><span id="Again-143"><a href="#Again-143"><span class="linenos">143</span></a>
</span><span id="Again-144"><a href="#Again-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="fm">__rmatmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Again&#39;</span><span class="p">:</span>
</span><span id="Again-145"><a href="#Again-145"><span class="linenos">145</span></a>        <span class="k">return</span> <span class="n">Again</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">matmul</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Again-146"><a href="#Again-146"><span class="linenos">146</span></a>
</span><span id="Again-147"><a href="#Again-147"><span class="linenos">147</span></a>    <span class="c1"># Hashing and equality.</span>
</span><span id="Again-148"><a href="#Again-148"><span class="linenos">148</span></a>
</span><span id="Again-149"><a href="#Again-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="Again-150"><a href="#Again-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Again</span><span class="p">):</span>
</span><span id="Again-151"><a href="#Again-151"><span class="linenos">151</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Again-152"><a href="#Again-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_key_tuple</span>
</span><span id="Again-153"><a href="#Again-153"><span class="linenos">153</span></a>
</span><span id="Again-154"><a href="#Again-154"><span class="linenos">154</span></a>    <span class="nd">@cached_property</span>
</span><span id="Again-155"><a href="#Again-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="nf">_key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Again-156"><a href="#Again-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_func</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_args</span><span class="p">)</span>
</span><span id="Again-157"><a href="#Again-157"><span class="linenos">157</span></a>
</span><span id="Again-158"><a href="#Again-158"><span class="linenos">158</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Again-159"><a href="#Again-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: A placeholder value used to indicate that the die should be rolled again with some modification.</p>

<p>Examples:</p>

<ul>
<li><code><a href="#Again">Again()</a></code> + 6: Roll again and add 6.</li>
<li><code>Again(lambda x: x + 6)</code>: Another way of doing the same thing.</li>
<li><code><a href="#Again">Again()</a></code> + <code><a href="#Again">Again()</a></code>: Roll again twice and sum.</li>
</ul>

<p>This can also be used as part of a return value with functions such as
<code><a href="#Die.sub">Die.sub()</a></code>, though I don't recommend getting too fancy---it can get
confusing very quickly.</p>
</div>


                            <div id="Again.__init__" class="classattr">
                                        <input id="Again.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Again</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">func</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="o">/</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span></span>)</span>

                <label class="view-source-button" for="Again.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Again.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Again.__init__-26"><a href="#Again.__init__-26"><span class="linenos">26</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="Again.__init__-27"><a href="#Again.__init__-27"><span class="linenos">27</span></a>        <span class="sd">&quot;&quot;&quot;Creates an `Again` placeholder from the given function and args.</span>
</span><span id="Again.__init__-28"><a href="#Again.__init__-28"><span class="linenos">28</span></a>
</span><span id="Again.__init__-29"><a href="#Again.__init__-29"><span class="linenos">29</span></a><span class="sd">        Any of the args may themselves be instances of `Again`. These are</span>
</span><span id="Again.__init__-30"><a href="#Again.__init__-30"><span class="linenos">30</span></a><span class="sd">        considered to be at the same level for purposes of `again_depth`.</span>
</span><span id="Again.__init__-31"><a href="#Again.__init__-31"><span class="linenos">31</span></a>
</span><span id="Again.__init__-32"><a href="#Again.__init__-32"><span class="linenos">32</span></a><span class="sd">        The supplied function will be called with the given args, except any</span>
</span><span id="Again.__init__-33"><a href="#Again.__init__-33"><span class="linenos">33</span></a><span class="sd">        arguments of type `Again` will have resolved to the `Die` resulting</span>
</span><span id="Again.__init__-34"><a href="#Again.__init__-34"><span class="linenos">34</span></a><span class="sd">        from rolling again.</span>
</span><span id="Again.__init__-35"><a href="#Again.__init__-35"><span class="linenos">35</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Again.__init__-36"><a href="#Again.__init__-36"><span class="linenos">36</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_func</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="Again.__init__-37"><a href="#Again.__init__-37"><span class="linenos">37</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_args</span> <span class="o">=</span> <span class="n">args</span>
</span></pre></div>


            <div class="docstring"><p>Creates an <code><a href="#Again">Again</a></code> placeholder from the given function and args.</p>

<p>Any of the args may themselves be instances of <code><a href="#Again">Again</a></code>. These are
considered to be at the same level for purposes of <code>again_depth</code>.</p>

<p>The supplied function will be called with the given args, except any
arguments of type <code><a href="#Again">Again</a></code> will have resolved to the <code><a href="#Die">Die</a></code> resulting
from rolling again.</p>
</div>


                            </div>
                </section>
                <section id="CountsKeysView">
                            <input id="CountsKeysView-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CountsKeysView</span><wbr>(<span class="base">typing.KeysView</span>, <span class="base">typing.Sequence</span>):

                <label class="view-source-button" for="CountsKeysView-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsKeysView"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsKeysView-131"><a href="#CountsKeysView-131"><span class="linenos">131</span></a><span class="k">class</span> <span class="nc">CountsKeysView</span><span class="p">(</span><span class="n">KeysView</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="CountsKeysView-132"><a href="#CountsKeysView-132"><span class="linenos">132</span></a>    <span class="sd">&quot;&quot;&quot;This functions as both a `KeysView` and a `Sequence`.&quot;&quot;&quot;</span>
</span><span id="CountsKeysView-133"><a href="#CountsKeysView-133"><span class="linenos">133</span></a>
</span><span id="CountsKeysView-134"><a href="#CountsKeysView-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsKeysView-135"><a href="#CountsKeysView-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span><span id="CountsKeysView-136"><a href="#CountsKeysView-136"><span class="linenos">136</span></a>
</span><span id="CountsKeysView-137"><a href="#CountsKeysView-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="CountsKeysView-138"><a href="#CountsKeysView-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_keys</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="CountsKeysView-139"><a href="#CountsKeysView-139"><span class="linenos">139</span></a>
</span><span id="CountsKeysView-140"><a href="#CountsKeysView-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CountsKeysView-141"><a href="#CountsKeysView-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">)</span>
</span><span id="CountsKeysView-142"><a href="#CountsKeysView-142"><span class="linenos">142</span></a>
</span><span id="CountsKeysView-143"><a href="#CountsKeysView-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CountsKeysView-144"><a href="#CountsKeysView-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_keys</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>This functions as both a <code>KeysView</code> and a <code>Sequence</code>.</p>
</div>


                            <div id="CountsKeysView.__init__" class="classattr">
                                        <input id="CountsKeysView.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CountsKeysView</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">counts</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">Counts</span></span>)</span>

                <label class="view-source-button" for="CountsKeysView.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsKeysView.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsKeysView.__init__-134"><a href="#CountsKeysView.__init__-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsKeysView.__init__-135"><a href="#CountsKeysView.__init__-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Set</dt>
                                <dd id="CountsKeysView.isdisjoint" class="function">isdisjoint</dd>

            </div>
            <div><dt>collections.abc.Sequence</dt>
                                <dd id="CountsKeysView.index" class="function">index</dd>
                <dd id="CountsKeysView.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CountsValuesView">
                            <input id="CountsValuesView-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CountsValuesView</span><wbr>(<span class="base">typing.ValuesView[int]</span>, <span class="base">typing.Sequence[int]</span>):

                <label class="view-source-button" for="CountsValuesView-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsValuesView"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsValuesView-147"><a href="#CountsValuesView-147"><span class="linenos">147</span></a><span class="k">class</span> <span class="nc">CountsValuesView</span><span class="p">(</span><span class="n">ValuesView</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="CountsValuesView-148"><a href="#CountsValuesView-148"><span class="linenos">148</span></a>    <span class="sd">&quot;&quot;&quot;This functions as both a `ValuesView` and a `Sequence`.&quot;&quot;&quot;</span>
</span><span id="CountsValuesView-149"><a href="#CountsValuesView-149"><span class="linenos">149</span></a>
</span><span id="CountsValuesView-150"><a href="#CountsValuesView-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsValuesView-151"><a href="#CountsValuesView-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span><span id="CountsValuesView-152"><a href="#CountsValuesView-152"><span class="linenos">152</span></a>
</span><span id="CountsValuesView-153"><a href="#CountsValuesView-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="CountsValuesView-154"><a href="#CountsValuesView-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="CountsValuesView-155"><a href="#CountsValuesView-155"><span class="linenos">155</span></a>
</span><span id="CountsValuesView-156"><a href="#CountsValuesView-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="CountsValuesView-157"><a href="#CountsValuesView-157"><span class="linenos">157</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="p">)</span>
</span><span id="CountsValuesView-158"><a href="#CountsValuesView-158"><span class="linenos">158</span></a>
</span><span id="CountsValuesView-159"><a href="#CountsValuesView-159"><span class="linenos">159</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CountsValuesView-160"><a href="#CountsValuesView-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_values</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>This functions as both a <code>ValuesView</code> and a <code>Sequence</code>.</p>
</div>


                            <div id="CountsValuesView.__init__" class="classattr">
                                        <input id="CountsValuesView.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CountsValuesView</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">counts</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">Counts</span></span>)</span>

                <label class="view-source-button" for="CountsValuesView.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsValuesView.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsValuesView.__init__-150"><a href="#CountsValuesView.__init__-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsValuesView.__init__-151"><a href="#CountsValuesView.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Sequence</dt>
                                <dd id="CountsValuesView.index" class="function">index</dd>
                <dd id="CountsValuesView.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="CountsItemsView">
                            <input id="CountsItemsView-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CountsItemsView</span><wbr>(<span class="base">typing.ItemsView[typing.Any, int]</span>, <span class="base">typing.Sequence[tuple[typing.Any, int]]</span>):

                <label class="view-source-button" for="CountsItemsView-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsItemsView"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsItemsView-163"><a href="#CountsItemsView-163"><span class="linenos">163</span></a><span class="k">class</span> <span class="nc">CountsItemsView</span><span class="p">(</span><span class="n">ItemsView</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]):</span>
</span><span id="CountsItemsView-164"><a href="#CountsItemsView-164"><span class="linenos">164</span></a>    <span class="sd">&quot;&quot;&quot;This functions as both an `ItemsView` and a `Sequence`.&quot;&quot;&quot;</span>
</span><span id="CountsItemsView-165"><a href="#CountsItemsView-165"><span class="linenos">165</span></a>
</span><span id="CountsItemsView-166"><a href="#CountsItemsView-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsItemsView-167"><a href="#CountsItemsView-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span><span id="CountsItemsView-168"><a href="#CountsItemsView-168"><span class="linenos">168</span></a>
</span><span id="CountsItemsView-169"><a href="#CountsItemsView-169"><span class="linenos">169</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
</span><span id="CountsItemsView-170"><a href="#CountsItemsView-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_items</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="CountsItemsView-171"><a href="#CountsItemsView-171"><span class="linenos">171</span></a>
</span><span id="CountsItemsView-172"><a href="#CountsItemsView-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="CountsItemsView-173"><a href="#CountsItemsView-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span><span class="o">.</span><span class="n">_items</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>This functions as both an <code>ItemsView</code> and a <code>Sequence</code>.</p>
</div>


                            <div id="CountsItemsView.__init__" class="classattr">
                                        <input id="CountsItemsView.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">CountsItemsView</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">counts</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">counts</span><span class="o">.</span><span class="n">Counts</span></span>)</span>

                <label class="view-source-button" for="CountsItemsView.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CountsItemsView.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CountsItemsView.__init__-166"><a href="#CountsItemsView.__init__-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">counts</span><span class="p">:</span> <span class="n">Counts</span><span class="p">):</span>
</span><span id="CountsItemsView.__init__-167"><a href="#CountsItemsView.__init__-167"><span class="linenos">167</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mapping</span> <span class="o">=</span> <span class="n">counts</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>collections.abc.Set</dt>
                                <dd id="CountsItemsView.isdisjoint" class="function">isdisjoint</dd>

            </div>
            <div><dt>collections.abc.Sequence</dt>
                                <dd id="CountsItemsView.index" class="function">index</dd>
                <dd id="CountsItemsView.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="from_cumulative_quantities">
                            <input id="from_cumulative_quantities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_cumulative_quantities</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span>,</span><span class="param">	<span class="n">cumulative_quantities</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="from_cumulative_quantities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_cumulative_quantities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_cumulative_quantities-83"><a href="#from_cumulative_quantities-83"><span class="linenos"> 83</span></a><span class="k">def</span> <span class="nf">from_cumulative_quantities</span><span class="p">(</span><span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span>
</span><span id="from_cumulative_quantities-84"><a href="#from_cumulative_quantities-84"><span class="linenos"> 84</span></a>                               <span class="n">cumulative_quantities</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="from_cumulative_quantities-85"><a href="#from_cumulative_quantities-85"><span class="linenos"> 85</span></a>                               <span class="o">*</span><span class="p">,</span>
</span><span id="from_cumulative_quantities-86"><a href="#from_cumulative_quantities-86"><span class="linenos"> 86</span></a>                               <span class="n">reverse</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="from_cumulative_quantities-87"><a href="#from_cumulative_quantities-87"><span class="linenos"> 87</span></a>    <span class="sd">&quot;&quot;&quot;Constructs a `Die` from a sequence of cumulative quantities.</span>
</span><span id="from_cumulative_quantities-88"><a href="#from_cumulative_quantities-88"><span class="linenos"> 88</span></a>
</span><span id="from_cumulative_quantities-89"><a href="#from_cumulative_quantities-89"><span class="linenos"> 89</span></a><span class="sd">    Args:</span>
</span><span id="from_cumulative_quantities-90"><a href="#from_cumulative_quantities-90"><span class="linenos"> 90</span></a><span class="sd">        outcomes: The outcomes of the resulting die. Sorted order is recommended</span>
</span><span id="from_cumulative_quantities-91"><a href="#from_cumulative_quantities-91"><span class="linenos"> 91</span></a><span class="sd">            but not necessary.</span>
</span><span id="from_cumulative_quantities-92"><a href="#from_cumulative_quantities-92"><span class="linenos"> 92</span></a><span class="sd">        cumulative_quantities: The cumulative quantities (inclusive) of the</span>
</span><span id="from_cumulative_quantities-93"><a href="#from_cumulative_quantities-93"><span class="linenos"> 93</span></a><span class="sd">            outcomes in the order they are given to this function.</span>
</span><span id="from_cumulative_quantities-94"><a href="#from_cumulative_quantities-94"><span class="linenos"> 94</span></a><span class="sd">        reverse: Iff true, both of the arguments will be reversed. This allows</span>
</span><span id="from_cumulative_quantities-95"><a href="#from_cumulative_quantities-95"><span class="linenos"> 95</span></a><span class="sd">            e.g. constructing using a survival distribution.</span>
</span><span id="from_cumulative_quantities-96"><a href="#from_cumulative_quantities-96"><span class="linenos"> 96</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="from_cumulative_quantities-97"><a href="#from_cumulative_quantities-97"><span class="linenos"> 97</span></a>
</span><span id="from_cumulative_quantities-98"><a href="#from_cumulative_quantities-98"><span class="linenos"> 98</span></a>    <span class="n">prev</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="from_cumulative_quantities-99"><a href="#from_cumulative_quantities-99"><span class="linenos"> 99</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="from_cumulative_quantities-100"><a href="#from_cumulative_quantities-100"><span class="linenos">100</span></a>    <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">((</span><span class="nb">reversed</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="n">outcomes</span><span class="p">),</span>
</span><span id="from_cumulative_quantities-101"><a href="#from_cumulative_quantities-101"><span class="linenos">101</span></a>                                 <span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">cumulative_quantities</span><span class="p">)</span>
</span><span id="from_cumulative_quantities-102"><a href="#from_cumulative_quantities-102"><span class="linenos">102</span></a>                                  <span class="k">if</span> <span class="n">reverse</span> <span class="k">else</span> <span class="n">cumulative_quantities</span><span class="p">)):</span>
</span><span id="from_cumulative_quantities-103"><a href="#from_cumulative_quantities-103"><span class="linenos">103</span></a>        <span class="n">d</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">=</span> <span class="n">quantity</span> <span class="o">-</span> <span class="n">prev</span>
</span><span id="from_cumulative_quantities-104"><a href="#from_cumulative_quantities-104"><span class="linenos">104</span></a>        <span class="n">prev</span> <span class="o">=</span> <span class="n">quantity</span>
</span><span id="from_cumulative_quantities-105"><a href="#from_cumulative_quantities-105"><span class="linenos">105</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructs a <code><a href="#Die">Die</a></code> from a sequence of cumulative quantities.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>outcomes:</strong>  The outcomes of the resulting die. Sorted order is recommended
but not necessary.</li>
<li><strong>cumulative_quantities:</strong>  The cumulative quantities (inclusive) of the
outcomes in the order they are given to this function.</li>
<li><strong>reverse:</strong>  Iff true, both of the arguments will be reversed. This allows
e.g. constructing using a survival distribution.</li>
</ul>
</div>


                </section>
                <section id="from_rv">
                            <input id="from_rv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_rv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">rv</span>, </span><span class="param"><span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">]</span>, </span><span class="param"><span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="from_rv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_rv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_rv-108"><a href="#from_rv-108"><span class="linenos">108</span></a><span class="k">def</span> <span class="nf">from_rv</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="n">outcomes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">],</span> <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="from_rv-109"><a href="#from_rv-109"><span class="linenos">109</span></a>    <span class="sd">&quot;&quot;&quot;Constructs a `Die` from a rv object (as `scipy.stats`).</span>
</span><span id="from_rv-110"><a href="#from_rv-110"><span class="linenos">110</span></a><span class="sd">    Args:</span>
</span><span id="from_rv-111"><a href="#from_rv-111"><span class="linenos">111</span></a><span class="sd">        rv: A rv object (as `scipy.stats`).</span>
</span><span id="from_rv-112"><a href="#from_rv-112"><span class="linenos">112</span></a><span class="sd">        outcomes: An iterable of `int`s or `float`s that will be the outcomes</span>
</span><span id="from_rv-113"><a href="#from_rv-113"><span class="linenos">113</span></a><span class="sd">            of the resulting `Die`.</span>
</span><span id="from_rv-114"><a href="#from_rv-114"><span class="linenos">114</span></a><span class="sd">            If the distribution is discrete, outcomes must be `int`s.</span>
</span><span id="from_rv-115"><a href="#from_rv-115"><span class="linenos">115</span></a><span class="sd">        denominator: The denominator of the resulting `Die` will be set to this.</span>
</span><span id="from_rv-116"><a href="#from_rv-116"><span class="linenos">116</span></a><span class="sd">        **kwargs: These will be forwarded to `rv.cdf()`.</span>
</span><span id="from_rv-117"><a href="#from_rv-117"><span class="linenos">117</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="from_rv-118"><a href="#from_rv-118"><span class="linenos">118</span></a>    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">rv</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="from_rv-119"><a href="#from_rv-119"><span class="linenos">119</span></a>        <span class="c1"># Continuous distributions use midpoints.</span>
</span><span id="from_rv-120"><a href="#from_rv-120"><span class="linenos">120</span></a>        <span class="n">midpoints</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">outcomes</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
</span><span id="from_rv-121"><a href="#from_rv-121"><span class="linenos">121</span></a>        <span class="n">cdf</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">midpoints</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="from_rv-122"><a href="#from_rv-122"><span class="linenos">122</span></a>        <span class="n">quantities_le</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="from_rv-123"><a href="#from_rv-123"><span class="linenos">123</span></a>            <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cdf</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">denominator</span><span class="p">,)</span>
</span><span id="from_rv-124"><a href="#from_rv-124"><span class="linenos">124</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="from_rv-125"><a href="#from_rv-125"><span class="linenos">125</span></a>        <span class="n">cdf</span> <span class="o">=</span> <span class="n">rv</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="from_rv-126"><a href="#from_rv-126"><span class="linenos">126</span></a>        <span class="n">quantities_le</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">denominator</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cdf</span><span class="p">)</span>
</span><span id="from_rv-127"><a href="#from_rv-127"><span class="linenos">127</span></a>    <span class="k">return</span> <span class="n">from_cumulative_quantities</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">quantities_le</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructs a <code><a href="#Die">Die</a></code> from a rv object (as <code>scipy.stats</code>).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>rv:</strong>  A rv object (as <code>scipy.stats</code>).</li>
<li><strong>outcomes:</strong>  An iterable of <code>int</code>s or <code>float</code>s that will be the outcomes
of the resulting <code><a href="#Die">Die</a></code>.
If the distribution is discrete, outcomes must be <code>int</code>s.</li>
<li><strong>denominator:</strong>  The denominator of the resulting <code><a href="#Die">Die</a></code> will be set to this.</li>
<li><strong>**kwargs:</strong>  These will be forwarded to <code>rv.cdf()</code>.</li>
</ul>
</div>


                </section>
                <section id="align">
                            <input id="align-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">align</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="#Die">icepool.Die</a></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="align-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#align"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="align-142"><a href="#align-142"><span class="linenos">142</span></a><span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="align-143"><a href="#align-143"><span class="linenos">143</span></a>    <span class="sd">&quot;&quot;&quot;Pads dice with zero quantities so that all have the same set of outcomes.</span>
</span><span id="align-144"><a href="#align-144"><span class="linenos">144</span></a>
</span><span id="align-145"><a href="#align-145"><span class="linenos">145</span></a><span class="sd">    Args:</span>
</span><span id="align-146"><a href="#align-146"><span class="linenos">146</span></a><span class="sd">        *dice: One `Die` per argument.</span>
</span><span id="align-147"><a href="#align-147"><span class="linenos">147</span></a>
</span><span id="align-148"><a href="#align-148"><span class="linenos">148</span></a><span class="sd">    Returns:</span>
</span><span id="align-149"><a href="#align-149"><span class="linenos">149</span></a><span class="sd">        A tuple of aligned dice.</span>
</span><span id="align-150"><a href="#align-150"><span class="linenos">150</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="align-151"><a href="#align-151"><span class="linenos">151</span></a>    <span class="n">dice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span><span id="align-152"><a href="#align-152"><span class="linenos">152</span></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="align-153"><a href="#align-153"><span class="linenos">153</span></a>        <span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">))</span>
</span><span id="align-154"><a href="#align-154"><span class="linenos">154</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pads dice with zero quantities so that all have the same set of outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*dice:</strong>  One <code><a href="#Die">Die</a></code> per argument.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A tuple of aligned dice.</p>
</blockquote>
</div>


                </section>
                <section id="align_range">
                            <input id="align_range-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">align_range</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="#Die">icepool.Die</a></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="align_range-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#align_range"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="align_range-157"><a href="#align_range-157"><span class="linenos">157</span></a><span class="k">def</span> <span class="nf">align_range</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="align_range-158"><a href="#align_range-158"><span class="linenos">158</span></a>    <span class="sd">&quot;&quot;&quot;Pads dice with zero quantities so that all have the same set of consecutive `int` outcomes.</span>
</span><span id="align_range-159"><a href="#align_range-159"><span class="linenos">159</span></a>
</span><span id="align_range-160"><a href="#align_range-160"><span class="linenos">160</span></a><span class="sd">    Args:</span>
</span><span id="align_range-161"><a href="#align_range-161"><span class="linenos">161</span></a><span class="sd">        *dice: One `Die` per argument.</span>
</span><span id="align_range-162"><a href="#align_range-162"><span class="linenos">162</span></a>
</span><span id="align_range-163"><a href="#align_range-163"><span class="linenos">163</span></a><span class="sd">    Returns:</span>
</span><span id="align_range-164"><a href="#align_range-164"><span class="linenos">164</span></a><span class="sd">        A tuple of aligned dice.</span>
</span><span id="align_range-165"><a href="#align_range-165"><span class="linenos">165</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="align_range-166"><a href="#align_range-166"><span class="linenos">166</span></a>    <span class="n">dice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span><span id="align_range-167"><a href="#align_range-167"><span class="linenos">167</span></a>    <span class="n">outcomes</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="align_range-168"><a href="#align_range-168"><span class="linenos">168</span></a>        <span class="nb">range</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">),</span>
</span><span id="align_range-169"><a href="#align_range-169"><span class="linenos">169</span></a>              <span class="n">icepool</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="align_range-170"><a href="#align_range-170"><span class="linenos">170</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">set_outcomes</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pads dice with zero quantities so that all have the same set of consecutive <code>int</code> outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*dice:</strong>  One <code><a href="#Die">Die</a></code> per argument.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A tuple of aligned dice.</p>
</blockquote>
</div>


                </section>
                <section id="lowest">
                            <input id="lowest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lowest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span>, </span><span class="param"><span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="lowest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#lowest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="lowest-9"><a href="#lowest-9"><span class="linenos"> 9</span></a><span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="lowest-10"><a href="#lowest-10"><span class="linenos">10</span></a>    <span class="sd">&quot;&quot;&quot;The lowest outcome or sum of the lowest outcomes among the dice.</span>
</span><span id="lowest-11"><a href="#lowest-11"><span class="linenos">11</span></a>
</span><span id="lowest-12"><a href="#lowest-12"><span class="linenos">12</span></a><span class="sd">    Args:</span>
</span><span id="lowest-13"><a href="#lowest-13"><span class="linenos">13</span></a><span class="sd">        *dice: The dice to be considered. At least one `Die` must be provided.</span>
</span><span id="lowest-14"><a href="#lowest-14"><span class="linenos">14</span></a><span class="sd">        keep: The number of lowest dice will be summed.</span>
</span><span id="lowest-15"><a href="#lowest-15"><span class="linenos">15</span></a><span class="sd">        drop: This number of lowest dice will be dropped before keeping dice</span>
</span><span id="lowest-16"><a href="#lowest-16"><span class="linenos">16</span></a><span class="sd">            to be summed.</span>
</span><span id="lowest-17"><a href="#lowest-17"><span class="linenos">17</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="lowest-18"><a href="#lowest-18"><span class="linenos">18</span></a>    <span class="k">if</span> <span class="n">keep</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="lowest-19"><a href="#lowest-19"><span class="linenos">19</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;keep=</span><span class="si">{</span><span class="n">keep</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="lowest-20"><a href="#lowest-20"><span class="linenos">20</span></a>    <span class="k">if</span> <span class="n">drop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="lowest-21"><a href="#lowest-21"><span class="linenos">21</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;drop=</span><span class="si">{</span><span class="n">drop</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="lowest-22"><a href="#lowest-22"><span class="linenos">22</span></a>
</span><span id="lowest-23"><a href="#lowest-23"><span class="linenos">23</span></a>    <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dice</span><span class="p">))</span>
</span><span id="lowest-24"><a href="#lowest-24"><span class="linenos">24</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="n">drop</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dice</span><span class="p">))</span>
</span><span id="lowest-25"><a href="#lowest-25"><span class="linenos">25</span></a>    <span class="k">return</span> <span class="n">_lowest_highest</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The lowest outcome or sum of the lowest outcomes among the dice.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*dice:</strong>  The dice to be considered. At least one <code><a href="#Die">Die</a></code> must be provided.</li>
<li><strong>keep:</strong>  The number of lowest dice will be summed.</li>
<li><strong>drop:</strong>  This number of lowest dice will be dropped before keeping dice
to be summed.</li>
</ul>
</div>


                </section>
                <section id="highest">
                            <input id="highest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">highest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span>, </span><span class="param"><span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="highest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#highest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="highest-28"><a href="#highest-28"><span class="linenos">28</span></a><span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="highest-29"><a href="#highest-29"><span class="linenos">29</span></a>    <span class="sd">&quot;&quot;&quot;The highest outcome or sum of the highest outcomes among the dice.</span>
</span><span id="highest-30"><a href="#highest-30"><span class="linenos">30</span></a>
</span><span id="highest-31"><a href="#highest-31"><span class="linenos">31</span></a><span class="sd">    Args:</span>
</span><span id="highest-32"><a href="#highest-32"><span class="linenos">32</span></a><span class="sd">        *dice: The dice to be considered. At least one `Die` must be provided.</span>
</span><span id="highest-33"><a href="#highest-33"><span class="linenos">33</span></a><span class="sd">        keep: The number of highest dice will be summed.</span>
</span><span id="highest-34"><a href="#highest-34"><span class="linenos">34</span></a><span class="sd">        drop: This number of highest dice will be dropped before keeping dice</span>
</span><span id="highest-35"><a href="#highest-35"><span class="linenos">35</span></a><span class="sd">            to be summed.</span>
</span><span id="highest-36"><a href="#highest-36"><span class="linenos">36</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="highest-37"><a href="#highest-37"><span class="linenos">37</span></a>    <span class="k">if</span> <span class="n">keep</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="highest-38"><a href="#highest-38"><span class="linenos">38</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;keep=</span><span class="si">{</span><span class="n">keep</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="highest-39"><a href="#highest-39"><span class="linenos">39</span></a>    <span class="k">if</span> <span class="n">drop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="highest-40"><a href="#highest-40"><span class="linenos">40</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;drop=</span><span class="si">{</span><span class="n">drop</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="highest-41"><a href="#highest-41"><span class="linenos">41</span></a>
</span><span id="highest-42"><a href="#highest-42"><span class="linenos">42</span></a>    <span class="n">start</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="n">drop</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dice</span><span class="p">))</span>
</span><span id="highest-43"><a href="#highest-43"><span class="linenos">43</span></a>    <span class="n">stop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dice</span><span class="p">))</span>
</span><span id="highest-44"><a href="#highest-44"><span class="linenos">44</span></a>    <span class="k">return</span> <span class="n">_lowest_highest</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The highest outcome or sum of the highest outcomes among the dice.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*dice:</strong>  The dice to be considered. At least one <code><a href="#Die">Die</a></code> must be provided.</li>
<li><strong>keep:</strong>  The number of highest dice will be summed.</li>
<li><strong>drop:</strong>  This number of highest dice will be dropped before keeping dice
to be summed.</li>
</ul>
</div>


                </section>
                <section id="min_outcome">
                            <input id="min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="min_outcome-130"><a href="#min_outcome-130"><span class="linenos">130</span></a><span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">):</span>
</span><span id="min_outcome-131"><a href="#min_outcome-131"><span class="linenos">131</span></a>    <span class="sd">&quot;&quot;&quot;The minimum outcome among the dice. &quot;&quot;&quot;</span>
</span><span id="min_outcome-132"><a href="#min_outcome-132"><span class="linenos">132</span></a>    <span class="n">dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="min_outcome-133"><a href="#min_outcome-133"><span class="linenos">133</span></a>    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The minimum outcome among the dice.</p>
</div>


                </section>
                <section id="max_outcome">
                            <input id="max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">dice</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="max_outcome-136"><a href="#max_outcome-136"><span class="linenos">136</span></a><span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">):</span>
</span><span id="max_outcome-137"><a href="#max_outcome-137"><span class="linenos">137</span></a>    <span class="sd">&quot;&quot;&quot;The maximum outcome among the dice. &quot;&quot;&quot;</span>
</span><span id="max_outcome-138"><a href="#max_outcome-138"><span class="linenos">138</span></a>    <span class="n">dice</span> <span class="o">=</span> <span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">]</span>
</span><span id="max_outcome-139"><a href="#max_outcome-139"><span class="linenos">139</span></a>    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The maximum outcome among the dice.</p>
</div>


                </section>
                <section id="reduce">
                            <input id="reduce-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reduce</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">dice</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">initial</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_end</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="reduce-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#reduce"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="reduce-173"><a href="#reduce-173"><span class="linenos">173</span></a><span class="k">def</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="reduce-174"><a href="#reduce-174"><span class="linenos">174</span></a>           <span class="n">dice</span><span class="p">,</span>
</span><span id="reduce-175"><a href="#reduce-175"><span class="linenos">175</span></a>           <span class="o">*</span><span class="p">,</span>
</span><span id="reduce-176"><a href="#reduce-176"><span class="linenos">176</span></a>           <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="reduce-177"><a href="#reduce-177"><span class="linenos">177</span></a>           <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="reduce-178"><a href="#reduce-178"><span class="linenos">178</span></a>           <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="reduce-179"><a href="#reduce-179"><span class="linenos">179</span></a>    <span class="sd">&quot;&quot;&quot;Applies a function of two arguments cumulatively to a sequence of dice.</span>
</span><span id="reduce-180"><a href="#reduce-180"><span class="linenos">180</span></a>
</span><span id="reduce-181"><a href="#reduce-181"><span class="linenos">181</span></a><span class="sd">    Analogous to</span>
</span><span id="reduce-182"><a href="#reduce-182"><span class="linenos">182</span></a><span class="sd">    [`functools.reduce()`](https://docs.python.org/3/library/functools.html#functools.reduce).</span>
</span><span id="reduce-183"><a href="#reduce-183"><span class="linenos">183</span></a>
</span><span id="reduce-184"><a href="#reduce-184"><span class="linenos">184</span></a><span class="sd">    The function is applied non-elementwise to tuple outcomes.</span>
</span><span id="reduce-185"><a href="#reduce-185"><span class="linenos">185</span></a>
</span><span id="reduce-186"><a href="#reduce-186"><span class="linenos">186</span></a><span class="sd">    Args:</span>
</span><span id="reduce-187"><a href="#reduce-187"><span class="linenos">187</span></a><span class="sd">        func: The function to apply. The function should take two arguments,</span>
</span><span id="reduce-188"><a href="#reduce-188"><span class="linenos">188</span></a><span class="sd">            which are an outcome from each of two dice.</span>
</span><span id="reduce-189"><a href="#reduce-189"><span class="linenos">189</span></a><span class="sd">        dice: A sequence of dice to apply the function to, from left to right.</span>
</span><span id="reduce-190"><a href="#reduce-190"><span class="linenos">190</span></a><span class="sd">        initial: If provided, this will be placed at the front of the sequence</span>
</span><span id="reduce-191"><a href="#reduce-191"><span class="linenos">191</span></a><span class="sd">            of dice.</span>
</span><span id="reduce-192"><a href="#reduce-192"><span class="linenos">192</span></a><span class="sd">        again_depth: Forwarded to the final die constructor.</span>
</span><span id="reduce-193"><a href="#reduce-193"><span class="linenos">193</span></a><span class="sd">        again_end: Forwarded to the final die constructor.</span>
</span><span id="reduce-194"><a href="#reduce-194"><span class="linenos">194</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="reduce-195"><a href="#reduce-195"><span class="linenos">195</span></a>    <span class="c1"># Conversion to dice is not necessary since apply() takes care of that.</span>
</span><span id="reduce-196"><a href="#reduce-196"><span class="linenos">196</span></a>    <span class="n">iter_dice</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span id="reduce-197"><a href="#reduce-197"><span class="linenos">197</span></a>    <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="reduce-198"><a href="#reduce-198"><span class="linenos">198</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
</span><span id="reduce-199"><a href="#reduce-199"><span class="linenos">199</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="reduce-200"><a href="#reduce-200"><span class="linenos">200</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iter_dice</span><span class="p">)</span>
</span><span id="reduce-201"><a href="#reduce-201"><span class="linenos">201</span></a>    <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">iter_dice</span><span class="p">:</span>
</span><span id="reduce-202"><a href="#reduce-202"><span class="linenos">202</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
</span><span id="reduce-203"><a href="#reduce-203"><span class="linenos">203</span></a>                       <span class="n">result</span><span class="p">,</span>
</span><span id="reduce-204"><a href="#reduce-204"><span class="linenos">204</span></a>                       <span class="n">die</span><span class="p">,</span>
</span><span id="reduce-205"><a href="#reduce-205"><span class="linenos">205</span></a>                       <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="reduce-206"><a href="#reduce-206"><span class="linenos">206</span></a>                       <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="reduce-207"><a href="#reduce-207"><span class="linenos">207</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Applies a function of two arguments cumulatively to a sequence of dice.</p>

<p>Analogous to
<a href="https://docs.python.org/3/library/functools.html#functools.reduce"><code>functools.reduce()</code></a>.</p>

<p>The function is applied non-elementwise to tuple outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>func:</strong>  The function to apply. The function should take two arguments,
which are an outcome from each of two dice.</li>
<li><strong>dice:</strong>  A sequence of dice to apply the function to, from left to right.</li>
<li><strong>initial:</strong>  If provided, this will be placed at the front of the sequence
of dice.</li>
<li><strong>again_depth:</strong>  Forwarded to the final die constructor.</li>
<li><strong>again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>
</div>


                </section>
                <section id="accumulate">
                            <input id="accumulate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">accumulate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">dice</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">initial</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_end</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Generator</span><span class="p">[</span><span class="n"><a href="#Die">icepool.Die</a></span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="accumulate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#accumulate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="accumulate-210"><a href="#accumulate-210"><span class="linenos">210</span></a><span class="k">def</span> <span class="nf">accumulate</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="accumulate-211"><a href="#accumulate-211"><span class="linenos">211</span></a>               <span class="n">dice</span><span class="p">,</span>
</span><span id="accumulate-212"><a href="#accumulate-212"><span class="linenos">212</span></a>               <span class="o">*</span><span class="p">,</span>
</span><span id="accumulate-213"><a href="#accumulate-213"><span class="linenos">213</span></a>               <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="accumulate-214"><a href="#accumulate-214"><span class="linenos">214</span></a>               <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="accumulate-215"><a href="#accumulate-215"><span class="linenos">215</span></a>               <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="accumulate-216"><a href="#accumulate-216"><span class="linenos">216</span></a>    <span class="sd">&quot;&quot;&quot;Applies a function of two arguments cumulatively to a sequence of dice, yielding each result in turn.</span>
</span><span id="accumulate-217"><a href="#accumulate-217"><span class="linenos">217</span></a>
</span><span id="accumulate-218"><a href="#accumulate-218"><span class="linenos">218</span></a><span class="sd">    Analogous to</span>
</span><span id="accumulate-219"><a href="#accumulate-219"><span class="linenos">219</span></a><span class="sd">    [`itertools.accumulate()`](https://docs.python.org/3/library/itertools.html#itertools.accumulate)</span>
</span><span id="accumulate-220"><a href="#accumulate-220"><span class="linenos">220</span></a><span class="sd">    , though with no default function and</span>
</span><span id="accumulate-221"><a href="#accumulate-221"><span class="linenos">221</span></a><span class="sd">    the same parameter order as `reduce()`.</span>
</span><span id="accumulate-222"><a href="#accumulate-222"><span class="linenos">222</span></a>
</span><span id="accumulate-223"><a href="#accumulate-223"><span class="linenos">223</span></a><span class="sd">    The number of results is equal to the number of elements of `dice`, with</span>
</span><span id="accumulate-224"><a href="#accumulate-224"><span class="linenos">224</span></a><span class="sd">    one additional element if `initial` is provided.</span>
</span><span id="accumulate-225"><a href="#accumulate-225"><span class="linenos">225</span></a>
</span><span id="accumulate-226"><a href="#accumulate-226"><span class="linenos">226</span></a><span class="sd">    The function is applied non-elementwise to tuple outcomes.</span>
</span><span id="accumulate-227"><a href="#accumulate-227"><span class="linenos">227</span></a>
</span><span id="accumulate-228"><a href="#accumulate-228"><span class="linenos">228</span></a><span class="sd">    Args:</span>
</span><span id="accumulate-229"><a href="#accumulate-229"><span class="linenos">229</span></a><span class="sd">        func: The function to apply. The function should take two arguments,</span>
</span><span id="accumulate-230"><a href="#accumulate-230"><span class="linenos">230</span></a><span class="sd">            which are an outcome from each of two dice.</span>
</span><span id="accumulate-231"><a href="#accumulate-231"><span class="linenos">231</span></a><span class="sd">        dice: A sequence of dice to apply the function to, from left to right.</span>
</span><span id="accumulate-232"><a href="#accumulate-232"><span class="linenos">232</span></a><span class="sd">        initial: If provided, this will be placed at the front of the sequence</span>
</span><span id="accumulate-233"><a href="#accumulate-233"><span class="linenos">233</span></a><span class="sd">            of dice.</span>
</span><span id="accumulate-234"><a href="#accumulate-234"><span class="linenos">234</span></a><span class="sd">        again_depth: Forwarded to the final die constructor.</span>
</span><span id="accumulate-235"><a href="#accumulate-235"><span class="linenos">235</span></a><span class="sd">        again_end: Forwarded to the final die constructor.</span>
</span><span id="accumulate-236"><a href="#accumulate-236"><span class="linenos">236</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="accumulate-237"><a href="#accumulate-237"><span class="linenos">237</span></a>    <span class="c1"># Conversion to dice is not necessary since apply() takes care of that.</span>
</span><span id="accumulate-238"><a href="#accumulate-238"><span class="linenos">238</span></a>    <span class="n">iter_dice</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span id="accumulate-239"><a href="#accumulate-239"><span class="linenos">239</span></a>    <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="accumulate-240"><a href="#accumulate-240"><span class="linenos">240</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">initial</span><span class="p">)</span>
</span><span id="accumulate-241"><a href="#accumulate-241"><span class="linenos">241</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="accumulate-242"><a href="#accumulate-242"><span class="linenos">242</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="accumulate-243"><a href="#accumulate-243"><span class="linenos">243</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iter_dice</span><span class="p">)</span>
</span><span id="accumulate-244"><a href="#accumulate-244"><span class="linenos">244</span></a>        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span><span id="accumulate-245"><a href="#accumulate-245"><span class="linenos">245</span></a>            <span class="k">return</span>
</span><span id="accumulate-246"><a href="#accumulate-246"><span class="linenos">246</span></a>    <span class="k">yield</span> <span class="n">result</span>
</span><span id="accumulate-247"><a href="#accumulate-247"><span class="linenos">247</span></a>    <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">iter_dice</span><span class="p">:</span>
</span><span id="accumulate-248"><a href="#accumulate-248"><span class="linenos">248</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">apply</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
</span><span id="accumulate-249"><a href="#accumulate-249"><span class="linenos">249</span></a>                       <span class="n">result</span><span class="p">,</span>
</span><span id="accumulate-250"><a href="#accumulate-250"><span class="linenos">250</span></a>                       <span class="n">die</span><span class="p">,</span>
</span><span id="accumulate-251"><a href="#accumulate-251"><span class="linenos">251</span></a>                       <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="accumulate-252"><a href="#accumulate-252"><span class="linenos">252</span></a>                       <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="accumulate-253"><a href="#accumulate-253"><span class="linenos">253</span></a>        <span class="k">yield</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Applies a function of two arguments cumulatively to a sequence of dice, yielding each result in turn.</p>

<p>Analogous to
<a href="https://docs.python.org/3/library/itertools.html#itertools.accumulate"><code>itertools.accumulate()</code></a>
, though with no default function and
the same parameter order as <code><a href="#reduce">reduce()</a></code>.</p>

<p>The number of results is equal to the number of elements of <code>dice</code>, with
one additional element if <code>initial</code> is provided.</p>

<p>The function is applied non-elementwise to tuple outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>func:</strong>  The function to apply. The function should take two arguments,
which are an outcome from each of two dice.</li>
<li><strong>dice:</strong>  A sequence of dice to apply the function to, from left to right.</li>
<li><strong>initial:</strong>  If provided, this will be placed at the front of the sequence
of dice.</li>
<li><strong>again_depth:</strong>  Forwarded to the final die constructor.</li>
<li><strong>again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>
</div>


                </section>
                <section id="apply">
                            <input id="apply-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">apply</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">func</span><span class="p">:</span> <span class="n">Callable</span>,</span><span class="param">	<span class="o">*</span><span class="n">dice</span>,</span><span class="param">	<span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">again_end</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="apply-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#apply"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="apply-274"><a href="#apply-274"><span class="linenos">274</span></a><span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="apply-275"><a href="#apply-275"><span class="linenos">275</span></a>          <span class="o">*</span><span class="n">dice</span><span class="p">,</span>
</span><span id="apply-276"><a href="#apply-276"><span class="linenos">276</span></a>          <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="apply-277"><a href="#apply-277"><span class="linenos">277</span></a>          <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="apply-278"><a href="#apply-278"><span class="linenos">278</span></a>    <span class="sd">&quot;&quot;&quot;Applies `func(outcome_of_die_0, outcome_of_die_1, ...)` for all outcomes of the dice.</span>
</span><span id="apply-279"><a href="#apply-279"><span class="linenos">279</span></a>
</span><span id="apply-280"><a href="#apply-280"><span class="linenos">280</span></a><span class="sd">    Example: `apply(lambda a, b: a + b, d6, d6)` is the same as d6 + d6.</span>
</span><span id="apply-281"><a href="#apply-281"><span class="linenos">281</span></a>
</span><span id="apply-282"><a href="#apply-282"><span class="linenos">282</span></a><span class="sd">    `apply()` is flexible but not very efficient for more than a few dice.</span>
</span><span id="apply-283"><a href="#apply-283"><span class="linenos">283</span></a><span class="sd">    Instead of using several arguments:</span>
</span><span id="apply-284"><a href="#apply-284"><span class="linenos">284</span></a>
</span><span id="apply-285"><a href="#apply-285"><span class="linenos">285</span></a><span class="sd">    * If the problem is easy to solve by considering how many dice rolled each</span>
</span><span id="apply-286"><a href="#apply-286"><span class="linenos">286</span></a><span class="sd">        outcome, one outcome at a time, try using</span>
</span><span id="apply-287"><a href="#apply-287"><span class="linenos">287</span></a><span class="sd">        `icepool.Pool` and `icepool.OutcomeCountEvaluator`.</span>
</span><span id="apply-288"><a href="#apply-288"><span class="linenos">288</span></a><span class="sd">    * If the problem is easy to solve by considering one additional `Die` at a</span>
</span><span id="apply-289"><a href="#apply-289"><span class="linenos">289</span></a><span class="sd">        time, try using `reduce()` instead.</span>
</span><span id="apply-290"><a href="#apply-290"><span class="linenos">290</span></a><span class="sd">    * If the order in which the dice are rolled is not important, you can use</span>
</span><span id="apply-291"><a href="#apply-291"><span class="linenos">291</span></a><span class="sd">        `apply_sorted()`. This is less efficient than either of the above two,</span>
</span><span id="apply-292"><a href="#apply-292"><span class="linenos">292</span></a><span class="sd">        but is still more efficient than `apply()`.</span>
</span><span id="apply-293"><a href="#apply-293"><span class="linenos">293</span></a>
</span><span id="apply-294"><a href="#apply-294"><span class="linenos">294</span></a><span class="sd">    Args:</span>
</span><span id="apply-295"><a href="#apply-295"><span class="linenos">295</span></a><span class="sd">        func: A function that takes one argument per input `Die` and returns an</span>
</span><span id="apply-296"><a href="#apply-296"><span class="linenos">296</span></a><span class="sd">            argument to `Die()`.</span>
</span><span id="apply-297"><a href="#apply-297"><span class="linenos">297</span></a><span class="sd">        *dice: Any number of dice. `func` will be called with all joint outcomes</span>
</span><span id="apply-298"><a href="#apply-298"><span class="linenos">298</span></a><span class="sd">            of `dice`, with one argument per `Die`.</span>
</span><span id="apply-299"><a href="#apply-299"><span class="linenos">299</span></a><span class="sd">            Non-dice will be left as-is.</span>
</span><span id="apply-300"><a href="#apply-300"><span class="linenos">300</span></a><span class="sd">        again_depth: Forwarded to the final die constructor.</span>
</span><span id="apply-301"><a href="#apply-301"><span class="linenos">301</span></a><span class="sd">        again_end: Forwarded to the final die constructor.</span>
</span><span id="apply-302"><a href="#apply-302"><span class="linenos">302</span></a>
</span><span id="apply-303"><a href="#apply-303"><span class="linenos">303</span></a><span class="sd">    Returns:</span>
</span><span id="apply-304"><a href="#apply-304"><span class="linenos">304</span></a><span class="sd">        A `Die` constructed from the outputs of `func` and the product of the</span>
</span><span id="apply-305"><a href="#apply-305"><span class="linenos">305</span></a><span class="sd">        quantities of the dice.</span>
</span><span id="apply-306"><a href="#apply-306"><span class="linenos">306</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="apply-307"><a href="#apply-307"><span class="linenos">307</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="apply-308"><a href="#apply-308"><span class="linenos">308</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="apply-309"><a href="#apply-309"><span class="linenos">309</span></a>            <span class="s1">&#39;The first argument must be callable. Did you forget to provide a function?&#39;</span>
</span><span id="apply-310"><a href="#apply-310"><span class="linenos">310</span></a>        <span class="p">)</span>
</span><span id="apply-311"><a href="#apply-311"><span class="linenos">311</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="apply-312"><a href="#apply-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([</span><span class="n">func</span><span class="p">()],</span>
</span><span id="apply-313"><a href="#apply-313"><span class="linenos">313</span></a>                           <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="apply-314"><a href="#apply-314"><span class="linenos">314</span></a>                           <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="apply-315"><a href="#apply-315"><span class="linenos">315</span></a>    <span class="n">final_outcomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="apply-316"><a href="#apply-316"><span class="linenos">316</span></a>    <span class="n">final_quantities</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="apply-317"><a href="#apply-317"><span class="linenos">317</span></a>    <span class="k">for</span> <span class="n">outcomes</span><span class="p">,</span> <span class="n">final_quantity</span> <span class="ow">in</span> <span class="n">iter_product_args</span><span class="p">(</span><span class="o">*</span><span class="n">dice</span><span class="p">):</span>
</span><span id="apply-318"><a href="#apply-318"><span class="linenos">318</span></a>        <span class="n">final_outcome</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">outcomes</span><span class="p">)</span>
</span><span id="apply-319"><a href="#apply-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="n">final_outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="apply-320"><a href="#apply-320"><span class="linenos">320</span></a>            <span class="n">final_outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_outcome</span><span class="p">)</span>
</span><span id="apply-321"><a href="#apply-321"><span class="linenos">321</span></a>            <span class="n">final_quantities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">final_quantity</span><span class="p">)</span>
</span><span id="apply-322"><a href="#apply-322"><span class="linenos">322</span></a>
</span><span id="apply-323"><a href="#apply-323"><span class="linenos">323</span></a>    <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">final_outcomes</span><span class="p">,</span>
</span><span id="apply-324"><a href="#apply-324"><span class="linenos">324</span></a>                       <span class="n">final_quantities</span><span class="p">,</span>
</span><span id="apply-325"><a href="#apply-325"><span class="linenos">325</span></a>                       <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="apply-326"><a href="#apply-326"><span class="linenos">326</span></a>                       <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Applies <code>func(outcome_of_die_0, outcome_of_die_1, ...)</code> for all outcomes of the dice.</p>

<p>Example: <code>apply(lambda a, b: a + b, d6, d6)</code> is the same as d6 + d6.</p>

<p><code><a href="#apply">apply()</a></code> is flexible but not very efficient for more than a few dice.
Instead of using several arguments:</p>

<ul>
<li>If the problem is easy to solve by considering how many dice rolled each
outcome, one outcome at a time, try using
<code><a href="#Pool">icepool.Pool</a></code> and <code><a href="#OutcomeCountEvaluator">icepool.OutcomeCountEvaluator</a></code>.</li>
<li>If the problem is easy to solve by considering one additional <code><a href="#Die">Die</a></code> at a
time, try using <code><a href="#reduce">reduce()</a></code> instead.</li>
<li>If the order in which the dice are rolled is not important, you can use
<code><a href="#apply_sorted">apply_sorted()</a></code>. This is less efficient than either of the above two,
but is still more efficient than <code><a href="#apply">apply()</a></code>.</li>
</ul>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>func:</strong>  A function that takes one argument per input <code><a href="#Die">Die</a></code> and returns an
argument to <code><a href="#Die">Die()</a></code>.</li>
<li><strong>*dice:</strong>  Any number of dice. <code>func</code> will be called with all joint outcomes
of <code>dice</code>, with one argument per <code><a href="#Die">Die</a></code>.
Non-dice will be left as-is.</li>
<li><strong>again_depth:</strong>  Forwarded to the final die constructor.</li>
<li><strong>again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> constructed from the outputs of <code>func</code> and the product of the
  quantities of the dice.</p>
</blockquote>
</div>


                </section>
                <section id="apply_sorted">
                            <input id="apply_sorted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">apply_sorted</span>:

                <label class="view-source-button" for="apply_sorted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#apply_sorted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="apply_sorted-329"><a href="#apply_sorted-329"><span class="linenos">329</span></a><span class="k">class</span> <span class="nc">apply_sorted</span><span class="p">():</span>
</span><span id="apply_sorted-330"><a href="#apply_sorted-330"><span class="linenos">330</span></a>    <span class="sd">&quot;&quot;&quot;This is really a function implemented as a class.</span>
</span><span id="apply_sorted-331"><a href="#apply_sorted-331"><span class="linenos">331</span></a>
</span><span id="apply_sorted-332"><a href="#apply_sorted-332"><span class="linenos">332</span></a><span class="sd">    See the &quot;constructor&quot; for details.</span>
</span><span id="apply_sorted-333"><a href="#apply_sorted-333"><span class="linenos">333</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="apply_sorted-334"><a href="#apply_sorted-334"><span class="linenos">334</span></a>
</span><span id="apply_sorted-335"><a href="#apply_sorted-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="apply_sorted-336"><a href="#apply_sorted-336"><span class="linenos">336</span></a>            <span class="bp">cls</span><span class="p">,</span>
</span><span id="apply_sorted-337"><a href="#apply_sorted-337"><span class="linenos">337</span></a>            <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="apply_sorted-338"><a href="#apply_sorted-338"><span class="linenos">338</span></a>            <span class="o">*</span><span class="n">dice</span><span class="p">,</span>
</span><span id="apply_sorted-339"><a href="#apply_sorted-339"><span class="linenos">339</span></a>            <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="apply_sorted-340"><a href="#apply_sorted-340"><span class="linenos">340</span></a>            <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="apply_sorted-341"><a href="#apply_sorted-341"><span class="linenos">341</span></a>        <span class="sd">&quot;&quot;&quot;Applies `func(lowest_outcome, next_lowest_outcome...)` for all sorted joint outcomes of the dice.</span>
</span><span id="apply_sorted-342"><a href="#apply_sorted-342"><span class="linenos">342</span></a>
</span><span id="apply_sorted-343"><a href="#apply_sorted-343"><span class="linenos">343</span></a><span class="sd">        Treat this as an ordinary function, not a constructor.</span>
</span><span id="apply_sorted-344"><a href="#apply_sorted-344"><span class="linenos">344</span></a>
</span><span id="apply_sorted-345"><a href="#apply_sorted-345"><span class="linenos">345</span></a><span class="sd">        `apply_sorted()` is more efficient than `apply()` but still not very</span>
</span><span id="apply_sorted-346"><a href="#apply_sorted-346"><span class="linenos">346</span></a><span class="sd">        efficient. Use `OutcomeCountEvaluator` instead if at all possible.</span>
</span><span id="apply_sorted-347"><a href="#apply_sorted-347"><span class="linenos">347</span></a>
</span><span id="apply_sorted-348"><a href="#apply_sorted-348"><span class="linenos">348</span></a><span class="sd">        You can use `apply_sorted[]` to only see outcomes at particular sorted indexes.</span>
</span><span id="apply_sorted-349"><a href="#apply_sorted-349"><span class="linenos">349</span></a><span class="sd">        For example, `apply_sorted[-2:](func, *dice)` would give the two highest</span>
</span><span id="apply_sorted-350"><a href="#apply_sorted-350"><span class="linenos">350</span></a><span class="sd">        outcomes to `func()`. This is more efficient than selecting outcomes inside</span>
</span><span id="apply_sorted-351"><a href="#apply_sorted-351"><span class="linenos">351</span></a><span class="sd">        `func`.</span>
</span><span id="apply_sorted-352"><a href="#apply_sorted-352"><span class="linenos">352</span></a>
</span><span id="apply_sorted-353"><a href="#apply_sorted-353"><span class="linenos">353</span></a><span class="sd">        Args:</span>
</span><span id="apply_sorted-354"><a href="#apply_sorted-354"><span class="linenos">354</span></a><span class="sd">            func: A function that takes one argument per input `Die` and returns an</span>
</span><span id="apply_sorted-355"><a href="#apply_sorted-355"><span class="linenos">355</span></a><span class="sd">                argument to `Die()`.</span>
</span><span id="apply_sorted-356"><a href="#apply_sorted-356"><span class="linenos">356</span></a><span class="sd">            *dice: Any number of dice (or objects convertible to dice).</span>
</span><span id="apply_sorted-357"><a href="#apply_sorted-357"><span class="linenos">357</span></a><span class="sd">                `func` will be called with all sorted joint outcomes of `dice`,</span>
</span><span id="apply_sorted-358"><a href="#apply_sorted-358"><span class="linenos">358</span></a><span class="sd">                with one argument per die. All outcomes must be totally orderable.</span>
</span><span id="apply_sorted-359"><a href="#apply_sorted-359"><span class="linenos">359</span></a><span class="sd">            again_depth: Forwarded to the final die constructor.</span>
</span><span id="apply_sorted-360"><a href="#apply_sorted-360"><span class="linenos">360</span></a><span class="sd">            again_end: Forwarded to the final die constructor.</span>
</span><span id="apply_sorted-361"><a href="#apply_sorted-361"><span class="linenos">361</span></a>
</span><span id="apply_sorted-362"><a href="#apply_sorted-362"><span class="linenos">362</span></a><span class="sd">        Returns:</span>
</span><span id="apply_sorted-363"><a href="#apply_sorted-363"><span class="linenos">363</span></a><span class="sd">            A `Die` constructed from the outputs of `func` and the weight of rolling</span>
</span><span id="apply_sorted-364"><a href="#apply_sorted-364"><span class="linenos">364</span></a><span class="sd">            the corresponding sorted outcomes.</span>
</span><span id="apply_sorted-365"><a href="#apply_sorted-365"><span class="linenos">365</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="apply_sorted-366"><a href="#apply_sorted-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="apply_sorted-367"><a href="#apply_sorted-367"><span class="linenos">367</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="apply_sorted-368"><a href="#apply_sorted-368"><span class="linenos">368</span></a>                <span class="s1">&#39;The first argument must be callable. Did you forget to provide a function?&#39;</span>
</span><span id="apply_sorted-369"><a href="#apply_sorted-369"><span class="linenos">369</span></a>            <span class="p">)</span>
</span><span id="apply_sorted-370"><a href="#apply_sorted-370"><span class="linenos">370</span></a>        <span class="n">pool</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span id="apply_sorted-371"><a href="#apply_sorted-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">pool</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
</span><span id="apply_sorted-372"><a href="#apply_sorted-372"><span class="linenos">372</span></a>                                 <span class="n">star</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="apply_sorted-373"><a href="#apply_sorted-373"><span class="linenos">373</span></a>                                 <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="apply_sorted-374"><a href="#apply_sorted-374"><span class="linenos">374</span></a>                                 <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="apply_sorted-375"><a href="#apply_sorted-375"><span class="linenos">375</span></a>
</span><span id="apply_sorted-376"><a href="#apply_sorted-376"><span class="linenos">376</span></a>    <span class="k">def</span> <span class="nf">__class_getitem__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="apply_sorted-377"><a href="#apply_sorted-377"><span class="linenos">377</span></a>                          <span class="n">sorted_roll_counts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span>
</span><span id="apply_sorted-378"><a href="#apply_sorted-378"><span class="linenos">378</span></a>                          <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">]:</span>
</span><span id="apply_sorted-379"><a href="#apply_sorted-379"><span class="linenos">379</span></a>        <span class="sd">&quot;&quot;&quot;Implements `[]` syntax for `apply_sorted`.&quot;&quot;&quot;</span>
</span><span id="apply_sorted-380"><a href="#apply_sorted-380"><span class="linenos">380</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sorted_roll_counts</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="apply_sorted-381"><a href="#apply_sorted-381"><span class="linenos">381</span></a>
</span><span id="apply_sorted-382"><a href="#apply_sorted-382"><span class="linenos">382</span></a>            <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="apply_sorted-383"><a href="#apply_sorted-383"><span class="linenos">383</span></a>                       <span class="o">*</span><span class="n">dice</span><span class="p">,</span>
</span><span id="apply_sorted-384"><a href="#apply_sorted-384"><span class="linenos">384</span></a>                       <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="apply_sorted-385"><a href="#apply_sorted-385"><span class="linenos">385</span></a>                       <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="apply_sorted-386"><a href="#apply_sorted-386"><span class="linenos">386</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="apply_sorted-387"><a href="#apply_sorted-387"><span class="linenos">387</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="apply_sorted-388"><a href="#apply_sorted-388"><span class="linenos">388</span></a>                        <span class="s1">&#39;The first argument must be callable. Did you forget to provide a function?&#39;</span>
</span><span id="apply_sorted-389"><a href="#apply_sorted-389"><span class="linenos">389</span></a>                    <span class="p">)</span>
</span><span id="apply_sorted-390"><a href="#apply_sorted-390"><span class="linenos">390</span></a>                <span class="n">die</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">dice</span><span class="p">)[</span><span class="n">sorted_roll_counts</span><span class="p">]</span>
</span><span id="apply_sorted-391"><a href="#apply_sorted-391"><span class="linenos">391</span></a>                <span class="k">return</span> <span class="n">die</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
</span><span id="apply_sorted-392"><a href="#apply_sorted-392"><span class="linenos">392</span></a>                               <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="apply_sorted-393"><a href="#apply_sorted-393"><span class="linenos">393</span></a>                               <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="apply_sorted-394"><a href="#apply_sorted-394"><span class="linenos">394</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="apply_sorted-395"><a href="#apply_sorted-395"><span class="linenos">395</span></a>
</span><span id="apply_sorted-396"><a href="#apply_sorted-396"><span class="linenos">396</span></a>            <span class="k">def</span> <span class="nf">result</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="apply_sorted-397"><a href="#apply_sorted-397"><span class="linenos">397</span></a>                       <span class="o">*</span><span class="n">dice</span><span class="p">,</span>
</span><span id="apply_sorted-398"><a href="#apply_sorted-398"><span class="linenos">398</span></a>                       <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="apply_sorted-399"><a href="#apply_sorted-399"><span class="linenos">399</span></a>                       <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="apply_sorted-400"><a href="#apply_sorted-400"><span class="linenos">400</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="apply_sorted-401"><a href="#apply_sorted-401"><span class="linenos">401</span></a>                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="apply_sorted-402"><a href="#apply_sorted-402"><span class="linenos">402</span></a>                        <span class="s1">&#39;The first argument must be callable. Did you forget to provide a function?&#39;</span>
</span><span id="apply_sorted-403"><a href="#apply_sorted-403"><span class="linenos">403</span></a>                    <span class="p">)</span>
</span><span id="apply_sorted-404"><a href="#apply_sorted-404"><span class="linenos">404</span></a>                <span class="n">pool</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">dice</span><span class="p">)[</span><span class="n">sorted_roll_counts</span><span class="p">]</span>
</span><span id="apply_sorted-405"><a href="#apply_sorted-405"><span class="linenos">405</span></a>                <span class="k">return</span> <span class="n">pool</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
</span><span id="apply_sorted-406"><a href="#apply_sorted-406"><span class="linenos">406</span></a>                                         <span class="n">star</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="apply_sorted-407"><a href="#apply_sorted-407"><span class="linenos">407</span></a>                                         <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="apply_sorted-408"><a href="#apply_sorted-408"><span class="linenos">408</span></a>                                         <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span><span id="apply_sorted-409"><a href="#apply_sorted-409"><span class="linenos">409</span></a>
</span><span id="apply_sorted-410"><a href="#apply_sorted-410"><span class="linenos">410</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>This is really a function implemented as a class.</p>

<p>See the "constructor" for details.</p>
</div>


                            <div id="apply_sorted.__init__" class="classattr">
                                        <input id="apply_sorted.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">apply_sorted</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span>, </span><span class="param"><span class="o">*</span><span class="n">dice</span>, </span><span class="param"><span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">again_end</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="apply_sorted.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#apply_sorted.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="apply_sorted.__init__-335"><a href="#apply_sorted.__init__-335"><span class="linenos">335</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="apply_sorted.__init__-336"><a href="#apply_sorted.__init__-336"><span class="linenos">336</span></a>            <span class="bp">cls</span><span class="p">,</span>
</span><span id="apply_sorted.__init__-337"><a href="#apply_sorted.__init__-337"><span class="linenos">337</span></a>            <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="apply_sorted.__init__-338"><a href="#apply_sorted.__init__-338"><span class="linenos">338</span></a>            <span class="o">*</span><span class="n">dice</span><span class="p">,</span>
</span><span id="apply_sorted.__init__-339"><a href="#apply_sorted.__init__-339"><span class="linenos">339</span></a>            <span class="n">again_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="apply_sorted.__init__-340"><a href="#apply_sorted.__init__-340"><span class="linenos">340</span></a>            <span class="n">again_end</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="apply_sorted.__init__-341"><a href="#apply_sorted.__init__-341"><span class="linenos">341</span></a>        <span class="sd">&quot;&quot;&quot;Applies `func(lowest_outcome, next_lowest_outcome...)` for all sorted joint outcomes of the dice.</span>
</span><span id="apply_sorted.__init__-342"><a href="#apply_sorted.__init__-342"><span class="linenos">342</span></a>
</span><span id="apply_sorted.__init__-343"><a href="#apply_sorted.__init__-343"><span class="linenos">343</span></a><span class="sd">        Treat this as an ordinary function, not a constructor.</span>
</span><span id="apply_sorted.__init__-344"><a href="#apply_sorted.__init__-344"><span class="linenos">344</span></a>
</span><span id="apply_sorted.__init__-345"><a href="#apply_sorted.__init__-345"><span class="linenos">345</span></a><span class="sd">        `apply_sorted()` is more efficient than `apply()` but still not very</span>
</span><span id="apply_sorted.__init__-346"><a href="#apply_sorted.__init__-346"><span class="linenos">346</span></a><span class="sd">        efficient. Use `OutcomeCountEvaluator` instead if at all possible.</span>
</span><span id="apply_sorted.__init__-347"><a href="#apply_sorted.__init__-347"><span class="linenos">347</span></a>
</span><span id="apply_sorted.__init__-348"><a href="#apply_sorted.__init__-348"><span class="linenos">348</span></a><span class="sd">        You can use `apply_sorted[]` to only see outcomes at particular sorted indexes.</span>
</span><span id="apply_sorted.__init__-349"><a href="#apply_sorted.__init__-349"><span class="linenos">349</span></a><span class="sd">        For example, `apply_sorted[-2:](func, *dice)` would give the two highest</span>
</span><span id="apply_sorted.__init__-350"><a href="#apply_sorted.__init__-350"><span class="linenos">350</span></a><span class="sd">        outcomes to `func()`. This is more efficient than selecting outcomes inside</span>
</span><span id="apply_sorted.__init__-351"><a href="#apply_sorted.__init__-351"><span class="linenos">351</span></a><span class="sd">        `func`.</span>
</span><span id="apply_sorted.__init__-352"><a href="#apply_sorted.__init__-352"><span class="linenos">352</span></a>
</span><span id="apply_sorted.__init__-353"><a href="#apply_sorted.__init__-353"><span class="linenos">353</span></a><span class="sd">        Args:</span>
</span><span id="apply_sorted.__init__-354"><a href="#apply_sorted.__init__-354"><span class="linenos">354</span></a><span class="sd">            func: A function that takes one argument per input `Die` and returns an</span>
</span><span id="apply_sorted.__init__-355"><a href="#apply_sorted.__init__-355"><span class="linenos">355</span></a><span class="sd">                argument to `Die()`.</span>
</span><span id="apply_sorted.__init__-356"><a href="#apply_sorted.__init__-356"><span class="linenos">356</span></a><span class="sd">            *dice: Any number of dice (or objects convertible to dice).</span>
</span><span id="apply_sorted.__init__-357"><a href="#apply_sorted.__init__-357"><span class="linenos">357</span></a><span class="sd">                `func` will be called with all sorted joint outcomes of `dice`,</span>
</span><span id="apply_sorted.__init__-358"><a href="#apply_sorted.__init__-358"><span class="linenos">358</span></a><span class="sd">                with one argument per die. All outcomes must be totally orderable.</span>
</span><span id="apply_sorted.__init__-359"><a href="#apply_sorted.__init__-359"><span class="linenos">359</span></a><span class="sd">            again_depth: Forwarded to the final die constructor.</span>
</span><span id="apply_sorted.__init__-360"><a href="#apply_sorted.__init__-360"><span class="linenos">360</span></a><span class="sd">            again_end: Forwarded to the final die constructor.</span>
</span><span id="apply_sorted.__init__-361"><a href="#apply_sorted.__init__-361"><span class="linenos">361</span></a>
</span><span id="apply_sorted.__init__-362"><a href="#apply_sorted.__init__-362"><span class="linenos">362</span></a><span class="sd">        Returns:</span>
</span><span id="apply_sorted.__init__-363"><a href="#apply_sorted.__init__-363"><span class="linenos">363</span></a><span class="sd">            A `Die` constructed from the outputs of `func` and the weight of rolling</span>
</span><span id="apply_sorted.__init__-364"><a href="#apply_sorted.__init__-364"><span class="linenos">364</span></a><span class="sd">            the corresponding sorted outcomes.</span>
</span><span id="apply_sorted.__init__-365"><a href="#apply_sorted.__init__-365"><span class="linenos">365</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="apply_sorted.__init__-366"><a href="#apply_sorted.__init__-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="apply_sorted.__init__-367"><a href="#apply_sorted.__init__-367"><span class="linenos">367</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="apply_sorted.__init__-368"><a href="#apply_sorted.__init__-368"><span class="linenos">368</span></a>                <span class="s1">&#39;The first argument must be callable. Did you forget to provide a function?&#39;</span>
</span><span id="apply_sorted.__init__-369"><a href="#apply_sorted.__init__-369"><span class="linenos">369</span></a>            <span class="p">)</span>
</span><span id="apply_sorted.__init__-370"><a href="#apply_sorted.__init__-370"><span class="linenos">370</span></a>        <span class="n">pool</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span id="apply_sorted.__init__-371"><a href="#apply_sorted.__init__-371"><span class="linenos">371</span></a>        <span class="k">return</span> <span class="n">pool</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">func</span><span class="p">,</span>
</span><span id="apply_sorted.__init__-372"><a href="#apply_sorted.__init__-372"><span class="linenos">372</span></a>                                 <span class="n">star</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="apply_sorted.__init__-373"><a href="#apply_sorted.__init__-373"><span class="linenos">373</span></a>                                 <span class="n">again_depth</span><span class="o">=</span><span class="n">again_depth</span><span class="p">,</span>
</span><span id="apply_sorted.__init__-374"><a href="#apply_sorted.__init__-374"><span class="linenos">374</span></a>                                 <span class="n">again_end</span><span class="o">=</span><span class="n">again_end</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Applies <code>func(lowest_outcome, next_lowest_outcome...)</code> for all sorted joint outcomes of the dice.</p>

<p>Treat this as an ordinary function, not a constructor.</p>

<p><code><a href="#apply_sorted">apply_sorted()</a></code> is more efficient than <code><a href="#apply">apply()</a></code> but still not very
efficient. Use <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> instead if at all possible.</p>

<p>You can use <code>apply_sorted[]</code> to only see outcomes at particular sorted indexes.
For example, <code>apply_sorted[-2:](func, *dice)</code> would give the two highest
outcomes to <code>func()</code>. This is more efficient than selecting outcomes inside
<code>func</code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>func:</strong>  A function that takes one argument per input <code><a href="#Die">Die</a></code> and returns an
argument to <code><a href="#Die">Die()</a></code>.</li>
<li><strong>*dice:</strong>  Any number of dice (or objects convertible to dice).
<code>func</code> will be called with all sorted joint outcomes of <code>dice</code>,
with one argument per die. All outcomes must be totally orderable.</li>
<li><strong>again_depth:</strong>  Forwarded to the final die constructor.</li>
<li><strong>again_end:</strong>  Forwarded to the final die constructor.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> constructed from the outputs of <code>func</code> and the weight of rolling
  the corresponding sorted outcomes.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="Reroll">
                    <div class="attr variable">
            <span class="name">Reroll</span><span class="default_value"> = &lt;SpecialValue.Reroll: &#39;Reroll&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#Reroll"></a>
    
            <div class="docstring"><p>Indicates that an outcome should be rerolled (with unlimited depth).</p>

<p>This can be used in place of outcomes in many places. See individual function
and method descriptions for details.</p>

<p>This effectively removes the outcome from the probability space, along with its
contribution to the denominator.</p>

<p>This can be used for conditional probability by removing all outcomes not
consistent with the given observations.</p>

<p>Operation in specific cases:</p>

<ul>
<li>When used with <code><a href="#Again">Again</a></code>, only that stage is rerolled, not the entire <code><a href="#Again">Again</a></code>
tree.</li>
<li>To reroll with limited depth, use <code><a href="#Die.reroll">Die.reroll()</a></code>, or <code><a href="#Again">Again()</a></code> with no
modification.</li>
<li>When used with <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code>, the entire evaluation is rerolled.</li>
</ul>
</div>


                </section>
                <section id="Unlimited">
                    <div class="attr variable">
            <span class="name">Unlimited</span>

        
    </div>
    <a class="headerlink" href="#Unlimited"></a>
    
    

                </section>
                <section id="OutcomeCountGenerator">
                            <input id="OutcomeCountGenerator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">OutcomeCountGenerator</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="OutcomeCountGenerator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator-19"><a href="#OutcomeCountGenerator-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">OutcomeCountGenerator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="OutcomeCountGenerator-20"><a href="#OutcomeCountGenerator-20"><span class="linenos"> 20</span></a>    <span class="sd">&quot;&quot;&quot;Abstract base class for incrementally generating `(outcome, counts, weight)`s.</span>
</span><span id="OutcomeCountGenerator-21"><a href="#OutcomeCountGenerator-21"><span class="linenos"> 21</span></a>
</span><span id="OutcomeCountGenerator-22"><a href="#OutcomeCountGenerator-22"><span class="linenos"> 22</span></a><span class="sd">    These include dice pools (`Pool`) and card deals (`Deal`). Most likely you</span>
</span><span id="OutcomeCountGenerator-23"><a href="#OutcomeCountGenerator-23"><span class="linenos"> 23</span></a><span class="sd">    will be using one of these two rather than writing your own subclass of</span>
</span><span id="OutcomeCountGenerator-24"><a href="#OutcomeCountGenerator-24"><span class="linenos"> 24</span></a><span class="sd">    `OutcomeCountGenerator`.</span>
</span><span id="OutcomeCountGenerator-25"><a href="#OutcomeCountGenerator-25"><span class="linenos"> 25</span></a>
</span><span id="OutcomeCountGenerator-26"><a href="#OutcomeCountGenerator-26"><span class="linenos"> 26</span></a><span class="sd">    These generators can be evaluated by an `OutcomeCountEvaluator`, which you</span>
</span><span id="OutcomeCountGenerator-27"><a href="#OutcomeCountGenerator-27"><span class="linenos"> 27</span></a><span class="sd">    *are* likely to write your own concrete subclass of.</span>
</span><span id="OutcomeCountGenerator-28"><a href="#OutcomeCountGenerator-28"><span class="linenos"> 28</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-29"><a href="#OutcomeCountGenerator-29"><span class="linenos"> 29</span></a>
</span><span id="OutcomeCountGenerator-30"><a href="#OutcomeCountGenerator-30"><span class="linenos"> 30</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-31"><a href="#OutcomeCountGenerator-31"><span class="linenos"> 31</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-32"><a href="#OutcomeCountGenerator-32"><span class="linenos"> 32</span></a>        <span class="sd">&quot;&quot;&quot;The set of outcomes, in sorted order.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-33"><a href="#OutcomeCountGenerator-33"><span class="linenos"> 33</span></a>
</span><span id="OutcomeCountGenerator-34"><a href="#OutcomeCountGenerator-34"><span class="linenos"> 34</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-35"><a href="#OutcomeCountGenerator-35"><span class="linenos"> 35</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-36"><a href="#OutcomeCountGenerator-36"><span class="linenos"> 36</span></a>        <span class="sd">&quot;&quot;&quot;The number of counts generated. Must be constant.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-37"><a href="#OutcomeCountGenerator-37"><span class="linenos"> 37</span></a>
</span><span id="OutcomeCountGenerator-38"><a href="#OutcomeCountGenerator-38"><span class="linenos"> 38</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-39"><a href="#OutcomeCountGenerator-39"><span class="linenos"> 39</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-40"><a href="#OutcomeCountGenerator-40"><span class="linenos"> 40</span></a>        <span class="sd">&quot;&quot;&quot;`True` iff the generator is capable of producing an overall outcome.</span>
</span><span id="OutcomeCountGenerator-41"><a href="#OutcomeCountGenerator-41"><span class="linenos"> 41</span></a>
</span><span id="OutcomeCountGenerator-42"><a href="#OutcomeCountGenerator-42"><span class="linenos"> 42</span></a><span class="sd">        For example, a dice `Pool` will return `False` if it contains any dice</span>
</span><span id="OutcomeCountGenerator-43"><a href="#OutcomeCountGenerator-43"><span class="linenos"> 43</span></a><span class="sd">        with no outcomes.</span>
</span><span id="OutcomeCountGenerator-44"><a href="#OutcomeCountGenerator-44"><span class="linenos"> 44</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-45"><a href="#OutcomeCountGenerator-45"><span class="linenos"> 45</span></a>
</span><span id="OutcomeCountGenerator-46"><a href="#OutcomeCountGenerator-46"><span class="linenos"> 46</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-47"><a href="#OutcomeCountGenerator-47"><span class="linenos"> 47</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-48"><a href="#OutcomeCountGenerator-48"><span class="linenos"> 48</span></a>        <span class="sd">&quot;&quot;&quot;Pops the min outcome from this generator if it matches the argument.</span>
</span><span id="OutcomeCountGenerator-49"><a href="#OutcomeCountGenerator-49"><span class="linenos"> 49</span></a>
</span><span id="OutcomeCountGenerator-50"><a href="#OutcomeCountGenerator-50"><span class="linenos"> 50</span></a><span class="sd">        Yields:</span>
</span><span id="OutcomeCountGenerator-51"><a href="#OutcomeCountGenerator-51"><span class="linenos"> 51</span></a><span class="sd">            * A generator with the min outcome popped.</span>
</span><span id="OutcomeCountGenerator-52"><a href="#OutcomeCountGenerator-52"><span class="linenos"> 52</span></a><span class="sd">            * A tuple of counts for the min outcome.</span>
</span><span id="OutcomeCountGenerator-53"><a href="#OutcomeCountGenerator-53"><span class="linenos"> 53</span></a><span class="sd">            * The weight for this many of the min outcome appearing.</span>
</span><span id="OutcomeCountGenerator-54"><a href="#OutcomeCountGenerator-54"><span class="linenos"> 54</span></a>
</span><span id="OutcomeCountGenerator-55"><a href="#OutcomeCountGenerator-55"><span class="linenos"> 55</span></a><span class="sd">            If the argument does not match the min outcome, or this generator</span>
</span><span id="OutcomeCountGenerator-56"><a href="#OutcomeCountGenerator-56"><span class="linenos"> 56</span></a><span class="sd">            has no outcomes, only a single tuple is yielded:</span>
</span><span id="OutcomeCountGenerator-57"><a href="#OutcomeCountGenerator-57"><span class="linenos"> 57</span></a>
</span><span id="OutcomeCountGenerator-58"><a href="#OutcomeCountGenerator-58"><span class="linenos"> 58</span></a><span class="sd">            * `self`</span>
</span><span id="OutcomeCountGenerator-59"><a href="#OutcomeCountGenerator-59"><span class="linenos"> 59</span></a><span class="sd">            * A tuple of zeros.</span>
</span><span id="OutcomeCountGenerator-60"><a href="#OutcomeCountGenerator-60"><span class="linenos"> 60</span></a><span class="sd">            * weight = 1.</span>
</span><span id="OutcomeCountGenerator-61"><a href="#OutcomeCountGenerator-61"><span class="linenos"> 61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-62"><a href="#OutcomeCountGenerator-62"><span class="linenos"> 62</span></a>
</span><span id="OutcomeCountGenerator-63"><a href="#OutcomeCountGenerator-63"><span class="linenos"> 63</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-64"><a href="#OutcomeCountGenerator-64"><span class="linenos"> 64</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-65"><a href="#OutcomeCountGenerator-65"><span class="linenos"> 65</span></a>        <span class="sd">&quot;&quot;&quot;Pops the max outcome from this generator if it matches the argument.</span>
</span><span id="OutcomeCountGenerator-66"><a href="#OutcomeCountGenerator-66"><span class="linenos"> 66</span></a>
</span><span id="OutcomeCountGenerator-67"><a href="#OutcomeCountGenerator-67"><span class="linenos"> 67</span></a><span class="sd">        Yields:</span>
</span><span id="OutcomeCountGenerator-68"><a href="#OutcomeCountGenerator-68"><span class="linenos"> 68</span></a><span class="sd">            * A generator with the min outcome popped.</span>
</span><span id="OutcomeCountGenerator-69"><a href="#OutcomeCountGenerator-69"><span class="linenos"> 69</span></a><span class="sd">            * A tuple of counts for the min outcome.</span>
</span><span id="OutcomeCountGenerator-70"><a href="#OutcomeCountGenerator-70"><span class="linenos"> 70</span></a><span class="sd">            * The weight for this many of the min outcome appearing.</span>
</span><span id="OutcomeCountGenerator-71"><a href="#OutcomeCountGenerator-71"><span class="linenos"> 71</span></a>
</span><span id="OutcomeCountGenerator-72"><a href="#OutcomeCountGenerator-72"><span class="linenos"> 72</span></a><span class="sd">            If the argument does not match the min outcome, or this generator</span>
</span><span id="OutcomeCountGenerator-73"><a href="#OutcomeCountGenerator-73"><span class="linenos"> 73</span></a><span class="sd">            has no outcomes, only a single tuple is yielded:</span>
</span><span id="OutcomeCountGenerator-74"><a href="#OutcomeCountGenerator-74"><span class="linenos"> 74</span></a>
</span><span id="OutcomeCountGenerator-75"><a href="#OutcomeCountGenerator-75"><span class="linenos"> 75</span></a><span class="sd">            * `self`</span>
</span><span id="OutcomeCountGenerator-76"><a href="#OutcomeCountGenerator-76"><span class="linenos"> 76</span></a><span class="sd">            * A tuple of zeros.</span>
</span><span id="OutcomeCountGenerator-77"><a href="#OutcomeCountGenerator-77"><span class="linenos"> 77</span></a><span class="sd">            * weight = 1.</span>
</span><span id="OutcomeCountGenerator-78"><a href="#OutcomeCountGenerator-78"><span class="linenos"> 78</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-79"><a href="#OutcomeCountGenerator-79"><span class="linenos"> 79</span></a>
</span><span id="OutcomeCountGenerator-80"><a href="#OutcomeCountGenerator-80"><span class="linenos"> 80</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-81"><a href="#OutcomeCountGenerator-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="OutcomeCountGenerator-82"><a href="#OutcomeCountGenerator-82"><span class="linenos"> 82</span></a>        <span class="sd">&quot;&quot;&quot;Estimates the cost of popping from the min and max sides during an evaluation.</span>
</span><span id="OutcomeCountGenerator-83"><a href="#OutcomeCountGenerator-83"><span class="linenos"> 83</span></a>
</span><span id="OutcomeCountGenerator-84"><a href="#OutcomeCountGenerator-84"><span class="linenos"> 84</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountGenerator-85"><a href="#OutcomeCountGenerator-85"><span class="linenos"> 85</span></a><span class="sd">            pop_min_cost: A positive `int`.</span>
</span><span id="OutcomeCountGenerator-86"><a href="#OutcomeCountGenerator-86"><span class="linenos"> 86</span></a><span class="sd">            pop_max_cost: A positive `int`.</span>
</span><span id="OutcomeCountGenerator-87"><a href="#OutcomeCountGenerator-87"><span class="linenos"> 87</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-88"><a href="#OutcomeCountGenerator-88"><span class="linenos"> 88</span></a>
</span><span id="OutcomeCountGenerator-89"><a href="#OutcomeCountGenerator-89"><span class="linenos"> 89</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-90"><a href="#OutcomeCountGenerator-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-91"><a href="#OutcomeCountGenerator-91"><span class="linenos"> 91</span></a>        <span class="sd">&quot;&quot;&quot;The total weight of all paths through this generator.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-92"><a href="#OutcomeCountGenerator-92"><span class="linenos"> 92</span></a>
</span><span id="OutcomeCountGenerator-93"><a href="#OutcomeCountGenerator-93"><span class="linenos"> 93</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-94"><a href="#OutcomeCountGenerator-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-95"><a href="#OutcomeCountGenerator-95"><span class="linenos"> 95</span></a>        <span class="sd">&quot;&quot;&quot;All `OutcomeCountGenerator`s must implement equality.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-96"><a href="#OutcomeCountGenerator-96"><span class="linenos"> 96</span></a>
</span><span id="OutcomeCountGenerator-97"><a href="#OutcomeCountGenerator-97"><span class="linenos"> 97</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator-98"><a href="#OutcomeCountGenerator-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-99"><a href="#OutcomeCountGenerator-99"><span class="linenos"> 99</span></a>        <span class="sd">&quot;&quot;&quot;All `OutcomeCountGenerator`s must be hashable.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-100"><a href="#OutcomeCountGenerator-100"><span class="linenos">100</span></a>
</span><span id="OutcomeCountGenerator-101"><a href="#OutcomeCountGenerator-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-102"><a href="#OutcomeCountGenerator-102"><span class="linenos">102</span></a>                 <span class="n">evaluator_or_func</span><span class="p">:</span> <span class="s1">&#39;icepool.OutcomeCountEvaluator&#39;</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-103"><a href="#OutcomeCountGenerator-103"><span class="linenos">103</span></a>                 <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-104"><a href="#OutcomeCountGenerator-104"><span class="linenos">104</span></a>        <span class="sd">&quot;&quot;&quot;Evaluates this generator using the given `OutcomeCountEvaluator` or function.</span>
</span><span id="OutcomeCountGenerator-105"><a href="#OutcomeCountGenerator-105"><span class="linenos">105</span></a>
</span><span id="OutcomeCountGenerator-106"><a href="#OutcomeCountGenerator-106"><span class="linenos">106</span></a><span class="sd">        Note that each `OutcomeCountEvaluator` instance carries its own cache;</span>
</span><span id="OutcomeCountGenerator-107"><a href="#OutcomeCountGenerator-107"><span class="linenos">107</span></a><span class="sd">        if you plan to use an evaluation multiple times,</span>
</span><span id="OutcomeCountGenerator-108"><a href="#OutcomeCountGenerator-108"><span class="linenos">108</span></a><span class="sd">        you may want to explicitly create an `OutcomeCountEvaluator` instance</span>
</span><span id="OutcomeCountGenerator-109"><a href="#OutcomeCountGenerator-109"><span class="linenos">109</span></a><span class="sd">        rather than passing a function to this method directly.</span>
</span><span id="OutcomeCountGenerator-110"><a href="#OutcomeCountGenerator-110"><span class="linenos">110</span></a>
</span><span id="OutcomeCountGenerator-111"><a href="#OutcomeCountGenerator-111"><span class="linenos">111</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator-112"><a href="#OutcomeCountGenerator-112"><span class="linenos">112</span></a><span class="sd">            func: This can be an `OutcomeCountEvaluator`, in which case it evaluates</span>
</span><span id="OutcomeCountGenerator-113"><a href="#OutcomeCountGenerator-113"><span class="linenos">113</span></a><span class="sd">                the generator directly.</span>
</span><span id="OutcomeCountGenerator-114"><a href="#OutcomeCountGenerator-114"><span class="linenos">114</span></a><span class="sd">                Or it can be a `OutcomeCountEvaluator.next_state()`-like</span>
</span><span id="OutcomeCountGenerator-115"><a href="#OutcomeCountGenerator-115"><span class="linenos">115</span></a><span class="sd">                function, taking in `state, outcome, *counts` and returning the</span>
</span><span id="OutcomeCountGenerator-116"><a href="#OutcomeCountGenerator-116"><span class="linenos">116</span></a><span class="sd">                next state. In this case a temporary `WrapFuncEvaluator`</span>
</span><span id="OutcomeCountGenerator-117"><a href="#OutcomeCountGenerator-117"><span class="linenos">117</span></a><span class="sd">                is constructed and used to evaluate this generator.</span>
</span><span id="OutcomeCountGenerator-118"><a href="#OutcomeCountGenerator-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-119"><a href="#OutcomeCountGenerator-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">evaluator_or_func</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountEvaluator</span><span class="p">):</span>
</span><span id="OutcomeCountGenerator-120"><a href="#OutcomeCountGenerator-120"><span class="linenos">120</span></a>            <span class="n">evaluator_or_func</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">WrapFuncEvaluator</span><span class="p">(</span><span class="n">evaluator_or_func</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-121"><a href="#OutcomeCountGenerator-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="n">evaluator_or_func</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-122"><a href="#OutcomeCountGenerator-122"><span class="linenos">122</span></a>
</span><span id="OutcomeCountGenerator-123"><a href="#OutcomeCountGenerator-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="OutcomeCountGenerator-124"><a href="#OutcomeCountGenerator-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="OutcomeCountGenerator-125"><a href="#OutcomeCountGenerator-125"><span class="linenos">125</span></a>
</span><span id="OutcomeCountGenerator-126"><a href="#OutcomeCountGenerator-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="OutcomeCountGenerator-127"><a href="#OutcomeCountGenerator-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="OutcomeCountGenerator-128"><a href="#OutcomeCountGenerator-128"><span class="linenos">128</span></a>
</span><span id="OutcomeCountGenerator-129"><a href="#OutcomeCountGenerator-129"><span class="linenos">129</span></a>    <span class="c1"># Built-in evaluators.</span>
</span><span id="OutcomeCountGenerator-130"><a href="#OutcomeCountGenerator-130"><span class="linenos">130</span></a>
</span><span id="OutcomeCountGenerator-131"><a href="#OutcomeCountGenerator-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-132"><a href="#OutcomeCountGenerator-132"><span class="linenos">132</span></a>        <span class="sd">&quot;&quot;&quot;All possible (unordered) tuples of outcomes.</span>
</span><span id="OutcomeCountGenerator-133"><a href="#OutcomeCountGenerator-133"><span class="linenos">133</span></a>
</span><span id="OutcomeCountGenerator-134"><a href="#OutcomeCountGenerator-134"><span class="linenos">134</span></a><span class="sd">        This is expensive and not recommended unless there are few possibilities.</span>
</span><span id="OutcomeCountGenerator-135"><a href="#OutcomeCountGenerator-135"><span class="linenos">135</span></a>
</span><span id="OutcomeCountGenerator-136"><a href="#OutcomeCountGenerator-136"><span class="linenos">136</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator-137"><a href="#OutcomeCountGenerator-137"><span class="linenos">137</span></a><span class="sd">            unique: If set, at most one of each outcome will be produced.</span>
</span><span id="OutcomeCountGenerator-138"><a href="#OutcomeCountGenerator-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-139"><a href="#OutcomeCountGenerator-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-140"><a href="#OutcomeCountGenerator-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">ExpandEvaluator</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-141"><a href="#OutcomeCountGenerator-141"><span class="linenos">141</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-142"><a href="#OutcomeCountGenerator-142"><span class="linenos">142</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expand_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-143"><a href="#OutcomeCountGenerator-143"><span class="linenos">143</span></a>
</span><span id="OutcomeCountGenerator-144"><a href="#OutcomeCountGenerator-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span>
</span><span id="OutcomeCountGenerator-145"><a href="#OutcomeCountGenerator-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-146"><a href="#OutcomeCountGenerator-146"><span class="linenos">146</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-147"><a href="#OutcomeCountGenerator-147"><span class="linenos">147</span></a>        <span class="n">sub</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Hashable</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">]</span> <span class="o">|</span>
</span><span id="OutcomeCountGenerator-148"><a href="#OutcomeCountGenerator-148"><span class="linenos">148</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="OutcomeCountGenerator-149"><a href="#OutcomeCountGenerator-149"><span class="linenos">149</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-150"><a href="#OutcomeCountGenerator-150"><span class="linenos">150</span></a>        <span class="sd">&quot;&quot;&quot;The sum of the outcomes.</span>
</span><span id="OutcomeCountGenerator-151"><a href="#OutcomeCountGenerator-151"><span class="linenos">151</span></a>
</span><span id="OutcomeCountGenerator-152"><a href="#OutcomeCountGenerator-152"><span class="linenos">152</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator-153"><a href="#OutcomeCountGenerator-153"><span class="linenos">153</span></a><span class="sd">            sub: If provided, the outcomes will be substituted according to</span>
</span><span id="OutcomeCountGenerator-154"><a href="#OutcomeCountGenerator-154"><span class="linenos">154</span></a><span class="sd">                this before summing.</span>
</span><span id="OutcomeCountGenerator-155"><a href="#OutcomeCountGenerator-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-156"><a href="#OutcomeCountGenerator-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-157"><a href="#OutcomeCountGenerator-157"><span class="linenos">157</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">SumEvaluator</span><span class="p">(</span><span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-158"><a href="#OutcomeCountGenerator-158"><span class="linenos">158</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-159"><a href="#OutcomeCountGenerator-159"><span class="linenos">159</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">sum_evaluator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-160"><a href="#OutcomeCountGenerator-160"><span class="linenos">160</span></a>
</span><span id="OutcomeCountGenerator-161"><a href="#OutcomeCountGenerator-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-162"><a href="#OutcomeCountGenerator-162"><span class="linenos">162</span></a>        <span class="sd">&quot;&quot;&quot;The number of outcomes that are == the target.</span>
</span><span id="OutcomeCountGenerator-163"><a href="#OutcomeCountGenerator-163"><span class="linenos">163</span></a>
</span><span id="OutcomeCountGenerator-164"><a href="#OutcomeCountGenerator-164"><span class="linenos">164</span></a><span class="sd">        If no target is provided, all outcomes will be counted.</span>
</span><span id="OutcomeCountGenerator-165"><a href="#OutcomeCountGenerator-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-166"><a href="#OutcomeCountGenerator-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">CountInEvaluator</span><span class="p">({</span><span class="n">target</span><span class="p">})</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-167"><a href="#OutcomeCountGenerator-167"><span class="linenos">167</span></a>
</span><span id="OutcomeCountGenerator-168"><a href="#OutcomeCountGenerator-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">count_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-169"><a href="#OutcomeCountGenerator-169"><span class="linenos">169</span></a>        <span class="sd">&quot;&quot;&quot;The number of outcomes that are in the target.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-170"><a href="#OutcomeCountGenerator-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">CountInEvaluator</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-171"><a href="#OutcomeCountGenerator-171"><span class="linenos">171</span></a>
</span><span id="OutcomeCountGenerator-172"><a href="#OutcomeCountGenerator-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="nf">count_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-173"><a href="#OutcomeCountGenerator-173"><span class="linenos">173</span></a>        <span class="sd">&quot;&quot;&quot;The number of outcomes with count greater than zero.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-174"><a href="#OutcomeCountGenerator-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">count_unique_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-175"><a href="#OutcomeCountGenerator-175"><span class="linenos">175</span></a>
</span><span id="OutcomeCountGenerator-176"><a href="#OutcomeCountGenerator-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">contains_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-177"><a href="#OutcomeCountGenerator-177"><span class="linenos">177</span></a>                        <span class="n">targets</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="OutcomeCountGenerator-178"><a href="#OutcomeCountGenerator-178"><span class="linenos">178</span></a>                        <span class="o">/</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-179"><a href="#OutcomeCountGenerator-179"><span class="linenos">179</span></a>                        <span class="o">*</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-180"><a href="#OutcomeCountGenerator-180"><span class="linenos">180</span></a>                        <span class="n">wilds</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-181"><a href="#OutcomeCountGenerator-181"><span class="linenos">181</span></a>        <span class="sd">&quot;&quot;&quot;Whether the outcomes contain all of the targets.</span>
</span><span id="OutcomeCountGenerator-182"><a href="#OutcomeCountGenerator-182"><span class="linenos">182</span></a>
</span><span id="OutcomeCountGenerator-183"><a href="#OutcomeCountGenerator-183"><span class="linenos">183</span></a><span class="sd">        The targets may contain duplicate elements.</span>
</span><span id="OutcomeCountGenerator-184"><a href="#OutcomeCountGenerator-184"><span class="linenos">184</span></a>
</span><span id="OutcomeCountGenerator-185"><a href="#OutcomeCountGenerator-185"><span class="linenos">185</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator-186"><a href="#OutcomeCountGenerator-186"><span class="linenos">186</span></a><span class="sd">            targets: Either a collection of outcomes, counting once per appearance.</span>
</span><span id="OutcomeCountGenerator-187"><a href="#OutcomeCountGenerator-187"><span class="linenos">187</span></a><span class="sd">                Or a mapping from outcomes to target counts.</span>
</span><span id="OutcomeCountGenerator-188"><a href="#OutcomeCountGenerator-188"><span class="linenos">188</span></a><span class="sd">            wilds: A collection of outcomes that will be treated as wilds.</span>
</span><span id="OutcomeCountGenerator-189"><a href="#OutcomeCountGenerator-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-190"><a href="#OutcomeCountGenerator-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">ContainsSubsetEvaluator</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-191"><a href="#OutcomeCountGenerator-191"><span class="linenos">191</span></a>                                               <span class="n">wilds</span><span class="o">=</span><span class="n">wilds</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-192"><a href="#OutcomeCountGenerator-192"><span class="linenos">192</span></a>
</span><span id="OutcomeCountGenerator-193"><a href="#OutcomeCountGenerator-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">intersection_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-194"><a href="#OutcomeCountGenerator-194"><span class="linenos">194</span></a>                          <span class="n">targets</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="OutcomeCountGenerator-195"><a href="#OutcomeCountGenerator-195"><span class="linenos">195</span></a>                          <span class="o">/</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-196"><a href="#OutcomeCountGenerator-196"><span class="linenos">196</span></a>                          <span class="o">*</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-197"><a href="#OutcomeCountGenerator-197"><span class="linenos">197</span></a>                          <span class="n">wilds</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-198"><a href="#OutcomeCountGenerator-198"><span class="linenos">198</span></a>        <span class="sd">&quot;&quot;&quot;The size of the intersection of the outcomes and the targets.</span>
</span><span id="OutcomeCountGenerator-199"><a href="#OutcomeCountGenerator-199"><span class="linenos">199</span></a>
</span><span id="OutcomeCountGenerator-200"><a href="#OutcomeCountGenerator-200"><span class="linenos">200</span></a><span class="sd">        The targets may contain duplicate elements.</span>
</span><span id="OutcomeCountGenerator-201"><a href="#OutcomeCountGenerator-201"><span class="linenos">201</span></a>
</span><span id="OutcomeCountGenerator-202"><a href="#OutcomeCountGenerator-202"><span class="linenos">202</span></a><span class="sd">        E.g. a roll of 1, 2, 2 and a target of 1, 1, 2, 3 would result in 2.</span>
</span><span id="OutcomeCountGenerator-203"><a href="#OutcomeCountGenerator-203"><span class="linenos">203</span></a>
</span><span id="OutcomeCountGenerator-204"><a href="#OutcomeCountGenerator-204"><span class="linenos">204</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator-205"><a href="#OutcomeCountGenerator-205"><span class="linenos">205</span></a><span class="sd">            targets: Either a collection of outcomes, counting once per appearance.</span>
</span><span id="OutcomeCountGenerator-206"><a href="#OutcomeCountGenerator-206"><span class="linenos">206</span></a><span class="sd">                Or a mapping from outcomes to target counts.</span>
</span><span id="OutcomeCountGenerator-207"><a href="#OutcomeCountGenerator-207"><span class="linenos">207</span></a><span class="sd">            wilds: A collection of outcomes that will be treated as wilds.</span>
</span><span id="OutcomeCountGenerator-208"><a href="#OutcomeCountGenerator-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-209"><a href="#OutcomeCountGenerator-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">IntersectionSizeEvaluator</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator-210"><a href="#OutcomeCountGenerator-210"><span class="linenos">210</span></a>                                                 <span class="n">wilds</span><span class="o">=</span><span class="n">wilds</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-211"><a href="#OutcomeCountGenerator-211"><span class="linenos">211</span></a>
</span><span id="OutcomeCountGenerator-212"><a href="#OutcomeCountGenerator-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">best_matching_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-213"><a href="#OutcomeCountGenerator-213"><span class="linenos">213</span></a>        <span class="sd">&quot;&quot;&quot;The best matching set among the outcomes.</span>
</span><span id="OutcomeCountGenerator-214"><a href="#OutcomeCountGenerator-214"><span class="linenos">214</span></a>
</span><span id="OutcomeCountGenerator-215"><a href="#OutcomeCountGenerator-215"><span class="linenos">215</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountGenerator-216"><a href="#OutcomeCountGenerator-216"><span class="linenos">216</span></a><span class="sd">            A `Die` with outcomes (set_size, outcome).</span>
</span><span id="OutcomeCountGenerator-217"><a href="#OutcomeCountGenerator-217"><span class="linenos">217</span></a><span class="sd">            The greatest single such set is returned.</span>
</span><span id="OutcomeCountGenerator-218"><a href="#OutcomeCountGenerator-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-219"><a href="#OutcomeCountGenerator-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">best_matching_set_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-220"><a href="#OutcomeCountGenerator-220"><span class="linenos">220</span></a>
</span><span id="OutcomeCountGenerator-221"><a href="#OutcomeCountGenerator-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">best_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-222"><a href="#OutcomeCountGenerator-222"><span class="linenos">222</span></a>        <span class="sd">&quot;&quot;&quot;The best straight among the outcomes.</span>
</span><span id="OutcomeCountGenerator-223"><a href="#OutcomeCountGenerator-223"><span class="linenos">223</span></a>
</span><span id="OutcomeCountGenerator-224"><a href="#OutcomeCountGenerator-224"><span class="linenos">224</span></a><span class="sd">        Outcomes must be `int`s.</span>
</span><span id="OutcomeCountGenerator-225"><a href="#OutcomeCountGenerator-225"><span class="linenos">225</span></a>
</span><span id="OutcomeCountGenerator-226"><a href="#OutcomeCountGenerator-226"><span class="linenos">226</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountGenerator-227"><a href="#OutcomeCountGenerator-227"><span class="linenos">227</span></a><span class="sd">            A `Die` with outcomes (straight_length, outcome).</span>
</span><span id="OutcomeCountGenerator-228"><a href="#OutcomeCountGenerator-228"><span class="linenos">228</span></a><span class="sd">            The greatest single such straight is returned.</span>
</span><span id="OutcomeCountGenerator-229"><a href="#OutcomeCountGenerator-229"><span class="linenos">229</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-230"><a href="#OutcomeCountGenerator-230"><span class="linenos">230</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">best_straight_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-231"><a href="#OutcomeCountGenerator-231"><span class="linenos">231</span></a>
</span><span id="OutcomeCountGenerator-232"><a href="#OutcomeCountGenerator-232"><span class="linenos">232</span></a>    <span class="c1"># Sampling.</span>
</span><span id="OutcomeCountGenerator-233"><a href="#OutcomeCountGenerator-233"><span class="linenos">233</span></a>
</span><span id="OutcomeCountGenerator-234"><a href="#OutcomeCountGenerator-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="OutcomeCountGenerator-235"><a href="#OutcomeCountGenerator-235"><span class="linenos">235</span></a>        <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: A single random sample from this generator.</span>
</span><span id="OutcomeCountGenerator-236"><a href="#OutcomeCountGenerator-236"><span class="linenos">236</span></a>
</span><span id="OutcomeCountGenerator-237"><a href="#OutcomeCountGenerator-237"><span class="linenos">237</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="OutcomeCountGenerator-238"><a href="#OutcomeCountGenerator-238"><span class="linenos">238</span></a><span class="sd">        secure.</span>
</span><span id="OutcomeCountGenerator-239"><a href="#OutcomeCountGenerator-239"><span class="linenos">239</span></a>
</span><span id="OutcomeCountGenerator-240"><a href="#OutcomeCountGenerator-240"><span class="linenos">240</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountGenerator-241"><a href="#OutcomeCountGenerator-241"><span class="linenos">241</span></a><span class="sd">            A sorted tuple of outcomes for each output of this generator.</span>
</span><span id="OutcomeCountGenerator-242"><a href="#OutcomeCountGenerator-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator-243"><a href="#OutcomeCountGenerator-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="OutcomeCountGenerator-244"><a href="#OutcomeCountGenerator-244"><span class="linenos">244</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot sample from an empty set of outcomes.&#39;</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-245"><a href="#OutcomeCountGenerator-245"><span class="linenos">245</span></a>
</span><span id="OutcomeCountGenerator-246"><a href="#OutcomeCountGenerator-246"><span class="linenos">246</span></a>        <span class="n">min_cost</span><span class="p">,</span> <span class="n">max_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_order_costs</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator-247"><a href="#OutcomeCountGenerator-247"><span class="linenos">247</span></a>
</span><span id="OutcomeCountGenerator-248"><a href="#OutcomeCountGenerator-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="n">min_cost</span> <span class="o">&lt;</span> <span class="n">max_cost</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-249"><a href="#OutcomeCountGenerator-249"><span class="linenos">249</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator-250"><a href="#OutcomeCountGenerator-250"><span class="linenos">250</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator-251"><a href="#OutcomeCountGenerator-251"><span class="linenos">251</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-252"><a href="#OutcomeCountGenerator-252"><span class="linenos">252</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator-253"><a href="#OutcomeCountGenerator-253"><span class="linenos">253</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator-254"><a href="#OutcomeCountGenerator-254"><span class="linenos">254</span></a>
</span><span id="OutcomeCountGenerator-255"><a href="#OutcomeCountGenerator-255"><span class="linenos">255</span></a>        <span class="n">cumulative_weights</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountGenerator-256"><a href="#OutcomeCountGenerator-256"><span class="linenos">256</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">generated</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator-257"><a href="#OutcomeCountGenerator-257"><span class="linenos">257</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="OutcomeCountGenerator-258"><a href="#OutcomeCountGenerator-258"><span class="linenos">258</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="OutcomeCountGenerator-259"><a href="#OutcomeCountGenerator-259"><span class="linenos">259</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-260"><a href="#OutcomeCountGenerator-260"><span class="linenos">260</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">cumulative_weights</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-261"><a href="#OutcomeCountGenerator-261"><span class="linenos">261</span></a>        <span class="n">popped_generator</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generated</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="OutcomeCountGenerator-262"><a href="#OutcomeCountGenerator-262"><span class="linenos">262</span></a>        <span class="n">head</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">outcome</span><span class="p">,)</span> <span class="o">*</span> <span class="n">count</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator-263"><a href="#OutcomeCountGenerator-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="OutcomeCountGenerator-264"><a href="#OutcomeCountGenerator-264"><span class="linenos">264</span></a>            <span class="n">tail</span> <span class="o">=</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator-265"><a href="#OutcomeCountGenerator-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator-266"><a href="#OutcomeCountGenerator-266"><span class="linenos">266</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator-267"><a href="#OutcomeCountGenerator-267"><span class="linenos">267</span></a>            <span class="k">return</span> <span class="n">head</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base class for incrementally generating <code>(outcome, counts, weight)</code>s.</p>

<p>These include dice pools (<code><a href="#Pool">Pool</a></code>) and card deals (<code><a href="#Deal">Deal</a></code>). Most likely you
will be using one of these two rather than writing your own subclass of
<code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>.</p>

<p>These generators can be evaluated by an <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code>, which you
<em>are</em> likely to write your own concrete subclass of.</p>
</div>


                            <div id="OutcomeCountGenerator.outcomes" class="classattr">
                                        <input id="OutcomeCountGenerator.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.outcomes-30"><a href="#OutcomeCountGenerator.outcomes-30"><span class="linenos">30</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator.outcomes-31"><a href="#OutcomeCountGenerator.outcomes-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.outcomes-32"><a href="#OutcomeCountGenerator.outcomes-32"><span class="linenos">32</span></a>        <span class="sd">&quot;&quot;&quot;The set of outcomes, in sorted order.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The set of outcomes, in sorted order.</p>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.counts_len" class="classattr">
                                        <input id="OutcomeCountGenerator.counts_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">counts_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.counts_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.counts_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.counts_len-34"><a href="#OutcomeCountGenerator.counts_len-34"><span class="linenos">34</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator.counts_len-35"><a href="#OutcomeCountGenerator.counts_len-35"><span class="linenos">35</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.counts_len-36"><a href="#OutcomeCountGenerator.counts_len-36"><span class="linenos">36</span></a>        <span class="sd">&quot;&quot;&quot;The number of counts generated. Must be constant.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The number of counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.denominator" class="classattr">
                                        <input id="OutcomeCountGenerator.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.denominator-89"><a href="#OutcomeCountGenerator.denominator-89"><span class="linenos">89</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountGenerator.denominator-90"><a href="#OutcomeCountGenerator.denominator-90"><span class="linenos">90</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.denominator-91"><a href="#OutcomeCountGenerator.denominator-91"><span class="linenos">91</span></a>        <span class="sd">&quot;&quot;&quot;The total weight of all paths through this generator.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.evaluate" class="classattr">
                                        <input id="OutcomeCountGenerator.evaluate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evaluate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">evaluator_or_func</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#OutcomeCountEvaluator">icepool.OutcomeCountEvaluator</a></span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.evaluate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.evaluate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.evaluate-101"><a href="#OutcomeCountGenerator.evaluate-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.evaluate-102"><a href="#OutcomeCountGenerator.evaluate-102"><span class="linenos">102</span></a>                 <span class="n">evaluator_or_func</span><span class="p">:</span> <span class="s1">&#39;icepool.OutcomeCountEvaluator&#39;</span> <span class="o">|</span> <span class="n">Callable</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.evaluate-103"><a href="#OutcomeCountGenerator.evaluate-103"><span class="linenos">103</span></a>                 <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.evaluate-104"><a href="#OutcomeCountGenerator.evaluate-104"><span class="linenos">104</span></a>        <span class="sd">&quot;&quot;&quot;Evaluates this generator using the given `OutcomeCountEvaluator` or function.</span>
</span><span id="OutcomeCountGenerator.evaluate-105"><a href="#OutcomeCountGenerator.evaluate-105"><span class="linenos">105</span></a>
</span><span id="OutcomeCountGenerator.evaluate-106"><a href="#OutcomeCountGenerator.evaluate-106"><span class="linenos">106</span></a><span class="sd">        Note that each `OutcomeCountEvaluator` instance carries its own cache;</span>
</span><span id="OutcomeCountGenerator.evaluate-107"><a href="#OutcomeCountGenerator.evaluate-107"><span class="linenos">107</span></a><span class="sd">        if you plan to use an evaluation multiple times,</span>
</span><span id="OutcomeCountGenerator.evaluate-108"><a href="#OutcomeCountGenerator.evaluate-108"><span class="linenos">108</span></a><span class="sd">        you may want to explicitly create an `OutcomeCountEvaluator` instance</span>
</span><span id="OutcomeCountGenerator.evaluate-109"><a href="#OutcomeCountGenerator.evaluate-109"><span class="linenos">109</span></a><span class="sd">        rather than passing a function to this method directly.</span>
</span><span id="OutcomeCountGenerator.evaluate-110"><a href="#OutcomeCountGenerator.evaluate-110"><span class="linenos">110</span></a>
</span><span id="OutcomeCountGenerator.evaluate-111"><a href="#OutcomeCountGenerator.evaluate-111"><span class="linenos">111</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator.evaluate-112"><a href="#OutcomeCountGenerator.evaluate-112"><span class="linenos">112</span></a><span class="sd">            func: This can be an `OutcomeCountEvaluator`, in which case it evaluates</span>
</span><span id="OutcomeCountGenerator.evaluate-113"><a href="#OutcomeCountGenerator.evaluate-113"><span class="linenos">113</span></a><span class="sd">                the generator directly.</span>
</span><span id="OutcomeCountGenerator.evaluate-114"><a href="#OutcomeCountGenerator.evaluate-114"><span class="linenos">114</span></a><span class="sd">                Or it can be a `OutcomeCountEvaluator.next_state()`-like</span>
</span><span id="OutcomeCountGenerator.evaluate-115"><a href="#OutcomeCountGenerator.evaluate-115"><span class="linenos">115</span></a><span class="sd">                function, taking in `state, outcome, *counts` and returning the</span>
</span><span id="OutcomeCountGenerator.evaluate-116"><a href="#OutcomeCountGenerator.evaluate-116"><span class="linenos">116</span></a><span class="sd">                next state. In this case a temporary `WrapFuncEvaluator`</span>
</span><span id="OutcomeCountGenerator.evaluate-117"><a href="#OutcomeCountGenerator.evaluate-117"><span class="linenos">117</span></a><span class="sd">                is constructed and used to evaluate this generator.</span>
</span><span id="OutcomeCountGenerator.evaluate-118"><a href="#OutcomeCountGenerator.evaluate-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.evaluate-119"><a href="#OutcomeCountGenerator.evaluate-119"><span class="linenos">119</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">evaluator_or_func</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountEvaluator</span><span class="p">):</span>
</span><span id="OutcomeCountGenerator.evaluate-120"><a href="#OutcomeCountGenerator.evaluate-120"><span class="linenos">120</span></a>            <span class="n">evaluator_or_func</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">WrapFuncEvaluator</span><span class="p">(</span><span class="n">evaluator_or_func</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator.evaluate-121"><a href="#OutcomeCountGenerator.evaluate-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="n">evaluator_or_func</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evaluates this generator using the given <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> or function.</p>

<p>Note that each <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> instance carries its own cache;
if you plan to use an evaluation multiple times,
you may want to explicitly create an <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> instance
rather than passing a function to this method directly.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>func:</strong>  This can be an <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code>, in which case it evaluates
the generator directly.
Or it can be a <code><a href="#OutcomeCountEvaluator.next_state">OutcomeCountEvaluator.next_state()</a></code>-like
function, taking in <code>state, outcome, *counts</code> and returning the
next state. In this case a temporary <code>WrapFuncEvaluator</code>
is constructed and used to evaluate this generator.</li>
</ul>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.min_outcome" class="classattr">
                                        <input id="OutcomeCountGenerator.min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.min_outcome-123"><a href="#OutcomeCountGenerator.min_outcome-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="OutcomeCountGenerator.min_outcome-124"><a href="#OutcomeCountGenerator.min_outcome-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="OutcomeCountGenerator.max_outcome" class="classattr">
                                        <input id="OutcomeCountGenerator.max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.max_outcome-126"><a href="#OutcomeCountGenerator.max_outcome-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="OutcomeCountGenerator.max_outcome-127"><a href="#OutcomeCountGenerator.max_outcome-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


    

                            </div>
                            <div id="OutcomeCountGenerator.expand" class="classattr">
                                        <input id="OutcomeCountGenerator.expand-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">expand</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">unique</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.expand-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.expand"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.expand-131"><a href="#OutcomeCountGenerator.expand-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.expand-132"><a href="#OutcomeCountGenerator.expand-132"><span class="linenos">132</span></a>        <span class="sd">&quot;&quot;&quot;All possible (unordered) tuples of outcomes.</span>
</span><span id="OutcomeCountGenerator.expand-133"><a href="#OutcomeCountGenerator.expand-133"><span class="linenos">133</span></a>
</span><span id="OutcomeCountGenerator.expand-134"><a href="#OutcomeCountGenerator.expand-134"><span class="linenos">134</span></a><span class="sd">        This is expensive and not recommended unless there are few possibilities.</span>
</span><span id="OutcomeCountGenerator.expand-135"><a href="#OutcomeCountGenerator.expand-135"><span class="linenos">135</span></a>
</span><span id="OutcomeCountGenerator.expand-136"><a href="#OutcomeCountGenerator.expand-136"><span class="linenos">136</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator.expand-137"><a href="#OutcomeCountGenerator.expand-137"><span class="linenos">137</span></a><span class="sd">            unique: If set, at most one of each outcome will be produced.</span>
</span><span id="OutcomeCountGenerator.expand-138"><a href="#OutcomeCountGenerator.expand-138"><span class="linenos">138</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.expand-139"><a href="#OutcomeCountGenerator.expand-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="n">unique</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.expand-140"><a href="#OutcomeCountGenerator.expand-140"><span class="linenos">140</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">ExpandEvaluator</span><span class="p">(</span><span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator.expand-141"><a href="#OutcomeCountGenerator.expand-141"><span class="linenos">141</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.expand-142"><a href="#OutcomeCountGenerator.expand-142"><span class="linenos">142</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">expand_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>All possible (unordered) tuples of outcomes.</p>

<p>This is expensive and not recommended unless there are few possibilities.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>unique:</strong>  If set, at most one of each outcome will be produced.</li>
</ul>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.sum" class="classattr">
                                        <input id="OutcomeCountGenerator.sum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sum</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">sub</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Hashable</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.sum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.sum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.sum-144"><a href="#OutcomeCountGenerator.sum-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span>
</span><span id="OutcomeCountGenerator.sum-145"><a href="#OutcomeCountGenerator.sum-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.sum-146"><a href="#OutcomeCountGenerator.sum-146"><span class="linenos">146</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.sum-147"><a href="#OutcomeCountGenerator.sum-147"><span class="linenos">147</span></a>        <span class="n">sub</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Hashable</span><span class="p">],</span> <span class="n">Hashable</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">]</span> <span class="o">|</span>
</span><span id="OutcomeCountGenerator.sum-148"><a href="#OutcomeCountGenerator.sum-148"><span class="linenos">148</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="OutcomeCountGenerator.sum-149"><a href="#OutcomeCountGenerator.sum-149"><span class="linenos">149</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.sum-150"><a href="#OutcomeCountGenerator.sum-150"><span class="linenos">150</span></a>        <span class="sd">&quot;&quot;&quot;The sum of the outcomes.</span>
</span><span id="OutcomeCountGenerator.sum-151"><a href="#OutcomeCountGenerator.sum-151"><span class="linenos">151</span></a>
</span><span id="OutcomeCountGenerator.sum-152"><a href="#OutcomeCountGenerator.sum-152"><span class="linenos">152</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator.sum-153"><a href="#OutcomeCountGenerator.sum-153"><span class="linenos">153</span></a><span class="sd">            sub: If provided, the outcomes will be substituted according to</span>
</span><span id="OutcomeCountGenerator.sum-154"><a href="#OutcomeCountGenerator.sum-154"><span class="linenos">154</span></a><span class="sd">                this before summing.</span>
</span><span id="OutcomeCountGenerator.sum-155"><a href="#OutcomeCountGenerator.sum-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.sum-156"><a href="#OutcomeCountGenerator.sum-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.sum-157"><a href="#OutcomeCountGenerator.sum-157"><span class="linenos">157</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">SumEvaluator</span><span class="p">(</span><span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">)(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator.sum-158"><a href="#OutcomeCountGenerator.sum-158"><span class="linenos">158</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.sum-159"><a href="#OutcomeCountGenerator.sum-159"><span class="linenos">159</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">sum_evaluator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The sum of the outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>sub:</strong>  If provided, the outcomes will be substituted according to
this before summing.</li>
</ul>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.count" class="classattr">
                                        <input id="OutcomeCountGenerator.count-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">target</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.count-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.count"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.count-161"><a href="#OutcomeCountGenerator.count-161"><span class="linenos">161</span></a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.count-162"><a href="#OutcomeCountGenerator.count-162"><span class="linenos">162</span></a>        <span class="sd">&quot;&quot;&quot;The number of outcomes that are == the target.</span>
</span><span id="OutcomeCountGenerator.count-163"><a href="#OutcomeCountGenerator.count-163"><span class="linenos">163</span></a>
</span><span id="OutcomeCountGenerator.count-164"><a href="#OutcomeCountGenerator.count-164"><span class="linenos">164</span></a><span class="sd">        If no target is provided, all outcomes will be counted.</span>
</span><span id="OutcomeCountGenerator.count-165"><a href="#OutcomeCountGenerator.count-165"><span class="linenos">165</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.count-166"><a href="#OutcomeCountGenerator.count-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">CountInEvaluator</span><span class="p">({</span><span class="n">target</span><span class="p">})</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The number of outcomes that are == the target.</p>

<p>If no target is provided, all outcomes will be counted.</p>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.count_in" class="classattr">
                                        <input id="OutcomeCountGenerator.count_in-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_in</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">target</span><span class="p">:</span> <span class="n">Container</span>, </span><span class="param"><span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.count_in-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.count_in"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.count_in-168"><a href="#OutcomeCountGenerator.count_in-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">count_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Container</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.count_in-169"><a href="#OutcomeCountGenerator.count_in-169"><span class="linenos">169</span></a>        <span class="sd">&quot;&quot;&quot;The number of outcomes that are in the target.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.count_in-170"><a href="#OutcomeCountGenerator.count_in-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">CountInEvaluator</span><span class="p">(</span><span class="n">target</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The number of outcomes that are in the target.</p>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.count_unique" class="classattr">
                                        <input id="OutcomeCountGenerator.count_unique-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">count_unique</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.count_unique-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.count_unique"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.count_unique-172"><a href="#OutcomeCountGenerator.count_unique-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="nf">count_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.count_unique-173"><a href="#OutcomeCountGenerator.count_unique-173"><span class="linenos">173</span></a>        <span class="sd">&quot;&quot;&quot;The number of outcomes with count greater than zero.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.count_unique-174"><a href="#OutcomeCountGenerator.count_unique-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">count_unique_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The number of outcomes with count greater than zero.</p>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.contains_subset" class="classattr">
                                        <input id="OutcomeCountGenerator.contains_subset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">contains_subset</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">targets</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">wilds</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="p">()</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.contains_subset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.contains_subset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.contains_subset-176"><a href="#OutcomeCountGenerator.contains_subset-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">contains_subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.contains_subset-177"><a href="#OutcomeCountGenerator.contains_subset-177"><span class="linenos">177</span></a>                        <span class="n">targets</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="OutcomeCountGenerator.contains_subset-178"><a href="#OutcomeCountGenerator.contains_subset-178"><span class="linenos">178</span></a>                        <span class="o">/</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.contains_subset-179"><a href="#OutcomeCountGenerator.contains_subset-179"><span class="linenos">179</span></a>                        <span class="o">*</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.contains_subset-180"><a href="#OutcomeCountGenerator.contains_subset-180"><span class="linenos">180</span></a>                        <span class="n">wilds</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.contains_subset-181"><a href="#OutcomeCountGenerator.contains_subset-181"><span class="linenos">181</span></a>        <span class="sd">&quot;&quot;&quot;Whether the outcomes contain all of the targets.</span>
</span><span id="OutcomeCountGenerator.contains_subset-182"><a href="#OutcomeCountGenerator.contains_subset-182"><span class="linenos">182</span></a>
</span><span id="OutcomeCountGenerator.contains_subset-183"><a href="#OutcomeCountGenerator.contains_subset-183"><span class="linenos">183</span></a><span class="sd">        The targets may contain duplicate elements.</span>
</span><span id="OutcomeCountGenerator.contains_subset-184"><a href="#OutcomeCountGenerator.contains_subset-184"><span class="linenos">184</span></a>
</span><span id="OutcomeCountGenerator.contains_subset-185"><a href="#OutcomeCountGenerator.contains_subset-185"><span class="linenos">185</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator.contains_subset-186"><a href="#OutcomeCountGenerator.contains_subset-186"><span class="linenos">186</span></a><span class="sd">            targets: Either a collection of outcomes, counting once per appearance.</span>
</span><span id="OutcomeCountGenerator.contains_subset-187"><a href="#OutcomeCountGenerator.contains_subset-187"><span class="linenos">187</span></a><span class="sd">                Or a mapping from outcomes to target counts.</span>
</span><span id="OutcomeCountGenerator.contains_subset-188"><a href="#OutcomeCountGenerator.contains_subset-188"><span class="linenos">188</span></a><span class="sd">            wilds: A collection of outcomes that will be treated as wilds.</span>
</span><span id="OutcomeCountGenerator.contains_subset-189"><a href="#OutcomeCountGenerator.contains_subset-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.contains_subset-190"><a href="#OutcomeCountGenerator.contains_subset-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">ContainsSubsetEvaluator</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.contains_subset-191"><a href="#OutcomeCountGenerator.contains_subset-191"><span class="linenos">191</span></a>                                               <span class="n">wilds</span><span class="o">=</span><span class="n">wilds</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Whether the outcomes contain all of the targets.</p>

<p>The targets may contain duplicate elements.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>targets:</strong>  Either a collection of outcomes, counting once per appearance.
Or a mapping from outcomes to target counts.</li>
<li><strong>wilds:</strong>  A collection of outcomes that will be treated as wilds.</li>
</ul>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.intersection_size" class="classattr">
                                        <input id="OutcomeCountGenerator.intersection_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">intersection_size</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">targets</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">wilds</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="p">()</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.intersection_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.intersection_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.intersection_size-193"><a href="#OutcomeCountGenerator.intersection_size-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">intersection_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.intersection_size-194"><a href="#OutcomeCountGenerator.intersection_size-194"><span class="linenos">194</span></a>                          <span class="n">targets</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="OutcomeCountGenerator.intersection_size-195"><a href="#OutcomeCountGenerator.intersection_size-195"><span class="linenos">195</span></a>                          <span class="o">/</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.intersection_size-196"><a href="#OutcomeCountGenerator.intersection_size-196"><span class="linenos">196</span></a>                          <span class="o">*</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.intersection_size-197"><a href="#OutcomeCountGenerator.intersection_size-197"><span class="linenos">197</span></a>                          <span class="n">wilds</span><span class="p">:</span> <span class="n">Collection</span> <span class="o">=</span> <span class="p">())</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.intersection_size-198"><a href="#OutcomeCountGenerator.intersection_size-198"><span class="linenos">198</span></a>        <span class="sd">&quot;&quot;&quot;The size of the intersection of the outcomes and the targets.</span>
</span><span id="OutcomeCountGenerator.intersection_size-199"><a href="#OutcomeCountGenerator.intersection_size-199"><span class="linenos">199</span></a>
</span><span id="OutcomeCountGenerator.intersection_size-200"><a href="#OutcomeCountGenerator.intersection_size-200"><span class="linenos">200</span></a><span class="sd">        The targets may contain duplicate elements.</span>
</span><span id="OutcomeCountGenerator.intersection_size-201"><a href="#OutcomeCountGenerator.intersection_size-201"><span class="linenos">201</span></a>
</span><span id="OutcomeCountGenerator.intersection_size-202"><a href="#OutcomeCountGenerator.intersection_size-202"><span class="linenos">202</span></a><span class="sd">        E.g. a roll of 1, 2, 2 and a target of 1, 1, 2, 3 would result in 2.</span>
</span><span id="OutcomeCountGenerator.intersection_size-203"><a href="#OutcomeCountGenerator.intersection_size-203"><span class="linenos">203</span></a>
</span><span id="OutcomeCountGenerator.intersection_size-204"><a href="#OutcomeCountGenerator.intersection_size-204"><span class="linenos">204</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountGenerator.intersection_size-205"><a href="#OutcomeCountGenerator.intersection_size-205"><span class="linenos">205</span></a><span class="sd">            targets: Either a collection of outcomes, counting once per appearance.</span>
</span><span id="OutcomeCountGenerator.intersection_size-206"><a href="#OutcomeCountGenerator.intersection_size-206"><span class="linenos">206</span></a><span class="sd">                Or a mapping from outcomes to target counts.</span>
</span><span id="OutcomeCountGenerator.intersection_size-207"><a href="#OutcomeCountGenerator.intersection_size-207"><span class="linenos">207</span></a><span class="sd">            wilds: A collection of outcomes that will be treated as wilds.</span>
</span><span id="OutcomeCountGenerator.intersection_size-208"><a href="#OutcomeCountGenerator.intersection_size-208"><span class="linenos">208</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.intersection_size-209"><a href="#OutcomeCountGenerator.intersection_size-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">IntersectionSizeEvaluator</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span>
</span><span id="OutcomeCountGenerator.intersection_size-210"><a href="#OutcomeCountGenerator.intersection_size-210"><span class="linenos">210</span></a>                                                 <span class="n">wilds</span><span class="o">=</span><span class="n">wilds</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The size of the intersection of the outcomes and the targets.</p>

<p>The targets may contain duplicate elements.</p>

<p>E.g. a roll of 1, 2, 2 and a target of 1, 1, 2, 3 would result in 2.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>targets:</strong>  Either a collection of outcomes, counting once per appearance.
Or a mapping from outcomes to target counts.</li>
<li><strong>wilds:</strong>  A collection of outcomes that will be treated as wilds.</li>
</ul>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.best_matching_set" class="classattr">
                                        <input id="OutcomeCountGenerator.best_matching_set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">best_matching_set</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.best_matching_set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.best_matching_set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.best_matching_set-212"><a href="#OutcomeCountGenerator.best_matching_set-212"><span class="linenos">212</span></a>    <span class="k">def</span> <span class="nf">best_matching_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.best_matching_set-213"><a href="#OutcomeCountGenerator.best_matching_set-213"><span class="linenos">213</span></a>        <span class="sd">&quot;&quot;&quot;The best matching set among the outcomes.</span>
</span><span id="OutcomeCountGenerator.best_matching_set-214"><a href="#OutcomeCountGenerator.best_matching_set-214"><span class="linenos">214</span></a>
</span><span id="OutcomeCountGenerator.best_matching_set-215"><a href="#OutcomeCountGenerator.best_matching_set-215"><span class="linenos">215</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountGenerator.best_matching_set-216"><a href="#OutcomeCountGenerator.best_matching_set-216"><span class="linenos">216</span></a><span class="sd">            A `Die` with outcomes (set_size, outcome).</span>
</span><span id="OutcomeCountGenerator.best_matching_set-217"><a href="#OutcomeCountGenerator.best_matching_set-217"><span class="linenos">217</span></a><span class="sd">            The greatest single such set is returned.</span>
</span><span id="OutcomeCountGenerator.best_matching_set-218"><a href="#OutcomeCountGenerator.best_matching_set-218"><span class="linenos">218</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.best_matching_set-219"><a href="#OutcomeCountGenerator.best_matching_set-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">best_matching_set_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The best matching set among the outcomes.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> with outcomes (set_size, outcome).
  The greatest single such set is returned.</p>
</blockquote>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.best_straight" class="classattr">
                                        <input id="OutcomeCountGenerator.best_straight-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">best_straight</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.best_straight-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.best_straight"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.best_straight-221"><a href="#OutcomeCountGenerator.best_straight-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">best_straight</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.best_straight-222"><a href="#OutcomeCountGenerator.best_straight-222"><span class="linenos">222</span></a>        <span class="sd">&quot;&quot;&quot;The best straight among the outcomes.</span>
</span><span id="OutcomeCountGenerator.best_straight-223"><a href="#OutcomeCountGenerator.best_straight-223"><span class="linenos">223</span></a>
</span><span id="OutcomeCountGenerator.best_straight-224"><a href="#OutcomeCountGenerator.best_straight-224"><span class="linenos">224</span></a><span class="sd">        Outcomes must be `int`s.</span>
</span><span id="OutcomeCountGenerator.best_straight-225"><a href="#OutcomeCountGenerator.best_straight-225"><span class="linenos">225</span></a>
</span><span id="OutcomeCountGenerator.best_straight-226"><a href="#OutcomeCountGenerator.best_straight-226"><span class="linenos">226</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountGenerator.best_straight-227"><a href="#OutcomeCountGenerator.best_straight-227"><span class="linenos">227</span></a><span class="sd">            A `Die` with outcomes (straight_length, outcome).</span>
</span><span id="OutcomeCountGenerator.best_straight-228"><a href="#OutcomeCountGenerator.best_straight-228"><span class="linenos">228</span></a><span class="sd">            The greatest single such straight is returned.</span>
</span><span id="OutcomeCountGenerator.best_straight-229"><a href="#OutcomeCountGenerator.best_straight-229"><span class="linenos">229</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.best_straight-230"><a href="#OutcomeCountGenerator.best_straight-230"><span class="linenos">230</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">best_straight_evaluator</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The best straight among the outcomes.</p>

<p>Outcomes must be <code>int</code>s.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> with outcomes (straight_length, outcome).
  The greatest single such straight is returned.</p>
</blockquote>
</div>


                            </div>
                            <div id="OutcomeCountGenerator.sample" class="classattr">
                                        <input id="OutcomeCountGenerator.sample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountGenerator.sample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountGenerator.sample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountGenerator.sample-234"><a href="#OutcomeCountGenerator.sample-234"><span class="linenos">234</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="OutcomeCountGenerator.sample-235"><a href="#OutcomeCountGenerator.sample-235"><span class="linenos">235</span></a>        <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: A single random sample from this generator.</span>
</span><span id="OutcomeCountGenerator.sample-236"><a href="#OutcomeCountGenerator.sample-236"><span class="linenos">236</span></a>
</span><span id="OutcomeCountGenerator.sample-237"><a href="#OutcomeCountGenerator.sample-237"><span class="linenos">237</span></a><span class="sd">        This uses the standard `random` package and is not cryptographically</span>
</span><span id="OutcomeCountGenerator.sample-238"><a href="#OutcomeCountGenerator.sample-238"><span class="linenos">238</span></a><span class="sd">        secure.</span>
</span><span id="OutcomeCountGenerator.sample-239"><a href="#OutcomeCountGenerator.sample-239"><span class="linenos">239</span></a>
</span><span id="OutcomeCountGenerator.sample-240"><a href="#OutcomeCountGenerator.sample-240"><span class="linenos">240</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountGenerator.sample-241"><a href="#OutcomeCountGenerator.sample-241"><span class="linenos">241</span></a><span class="sd">            A sorted tuple of outcomes for each output of this generator.</span>
</span><span id="OutcomeCountGenerator.sample-242"><a href="#OutcomeCountGenerator.sample-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountGenerator.sample-243"><a href="#OutcomeCountGenerator.sample-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="OutcomeCountGenerator.sample-244"><a href="#OutcomeCountGenerator.sample-244"><span class="linenos">244</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot sample from an empty set of outcomes.&#39;</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator.sample-245"><a href="#OutcomeCountGenerator.sample-245"><span class="linenos">245</span></a>
</span><span id="OutcomeCountGenerator.sample-246"><a href="#OutcomeCountGenerator.sample-246"><span class="linenos">246</span></a>        <span class="n">min_cost</span><span class="p">,</span> <span class="n">max_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_estimate_order_costs</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator.sample-247"><a href="#OutcomeCountGenerator.sample-247"><span class="linenos">247</span></a>
</span><span id="OutcomeCountGenerator.sample-248"><a href="#OutcomeCountGenerator.sample-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="n">min_cost</span> <span class="o">&lt;</span> <span class="n">max_cost</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.sample-249"><a href="#OutcomeCountGenerator.sample-249"><span class="linenos">249</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator.sample-250"><a href="#OutcomeCountGenerator.sample-250"><span class="linenos">250</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator.sample-251"><a href="#OutcomeCountGenerator.sample-251"><span class="linenos">251</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.sample-252"><a href="#OutcomeCountGenerator.sample-252"><span class="linenos">252</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator.sample-253"><a href="#OutcomeCountGenerator.sample-253"><span class="linenos">253</span></a>            <span class="n">generated</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator.sample-254"><a href="#OutcomeCountGenerator.sample-254"><span class="linenos">254</span></a>
</span><span id="OutcomeCountGenerator.sample-255"><a href="#OutcomeCountGenerator.sample-255"><span class="linenos">255</span></a>        <span class="n">cumulative_weights</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountGenerator.sample-256"><a href="#OutcomeCountGenerator.sample-256"><span class="linenos">256</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">generated</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator.sample-257"><a href="#OutcomeCountGenerator.sample-257"><span class="linenos">257</span></a>        <span class="n">denominator</span> <span class="o">=</span> <span class="n">cumulative_weights</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="OutcomeCountGenerator.sample-258"><a href="#OutcomeCountGenerator.sample-258"><span class="linenos">258</span></a>        <span class="c1"># We don&#39;t use random.choices since that is based on floats rather than ints.</span>
</span><span id="OutcomeCountGenerator.sample-259"><a href="#OutcomeCountGenerator.sample-259"><span class="linenos">259</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator.sample-260"><a href="#OutcomeCountGenerator.sample-260"><span class="linenos">260</span></a>        <span class="n">index</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">cumulative_weights</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator.sample-261"><a href="#OutcomeCountGenerator.sample-261"><span class="linenos">261</span></a>        <span class="n">popped_generator</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">generated</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="OutcomeCountGenerator.sample-262"><a href="#OutcomeCountGenerator.sample-262"><span class="linenos">262</span></a>        <span class="n">head</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">outcome</span><span class="p">,)</span> <span class="o">*</span> <span class="n">count</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">)</span>
</span><span id="OutcomeCountGenerator.sample-263"><a href="#OutcomeCountGenerator.sample-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="OutcomeCountGenerator.sample-264"><a href="#OutcomeCountGenerator.sample-264"><span class="linenos">264</span></a>            <span class="n">tail</span> <span class="o">=</span> <span class="n">popped_generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
</span><span id="OutcomeCountGenerator.sample-265"><a href="#OutcomeCountGenerator.sample-265"><span class="linenos">265</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">tail</span><span class="p">))</span>
</span><span id="OutcomeCountGenerator.sample-266"><a href="#OutcomeCountGenerator.sample-266"><span class="linenos">266</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountGenerator.sample-267"><a href="#OutcomeCountGenerator.sample-267"><span class="linenos">267</span></a>            <span class="k">return</span> <span class="n">head</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: A single random sample from this generator.</p>

<p>This uses the standard <code>random</code> package and is not cryptographically
secure.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A sorted tuple of outcomes for each output of this generator.</p>
</blockquote>
</div>


                            </div>
                </section>
                <section id="Pool">
                            <input id="Pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Pool</span><wbr>(<span class="base"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span>):

                <label class="view-source-button" for="Pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool-40"><a href="#Pool-40"><span class="linenos"> 40</span></a><span class="k">class</span> <span class="nc">Pool</span><span class="p">(</span><span class="n">OutcomeCountGenerator</span><span class="p">):</span>
</span><span id="Pool-41"><a href="#Pool-41"><span class="linenos"> 41</span></a>    <span class="sd">&quot;&quot;&quot;Represents a set of sorted/unordered dice, only distinguished by the outcomes they roll.</span>
</span><span id="Pool-42"><a href="#Pool-42"><span class="linenos"> 42</span></a>
</span><span id="Pool-43"><a href="#Pool-43"><span class="linenos"> 43</span></a><span class="sd">    This should be used in conjunction with `OutcomeCountEvaluator` to generate a result.</span>
</span><span id="Pool-44"><a href="#Pool-44"><span class="linenos"> 44</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Pool-45"><a href="#Pool-45"><span class="linenos"> 45</span></a>
</span><span id="Pool-46"><a href="#Pool-46"><span class="linenos"> 46</span></a>    <span class="n">_sorted_roll_counts</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="Pool-47"><a href="#Pool-47"><span class="linenos"> 47</span></a>    <span class="n">_dice</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</span><span id="Pool-48"><a href="#Pool-48"><span class="linenos"> 48</span></a>
</span><span id="Pool-49"><a href="#Pool-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Pool-50"><a href="#Pool-50"><span class="linenos"> 50</span></a>                <span class="n">dice</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">,</span>
</span><span id="Pool-51"><a href="#Pool-51"><span class="linenos"> 51</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="Pool-52"><a href="#Pool-52"><span class="linenos"> 52</span></a>        <span class="sd">&quot;&quot;&quot;Public constructor for a pool.</span>
</span><span id="Pool-53"><a href="#Pool-53"><span class="linenos"> 53</span></a>
</span><span id="Pool-54"><a href="#Pool-54"><span class="linenos"> 54</span></a><span class="sd">        Evaulation is most efficient when the dice are the same or same-side</span>
</span><span id="Pool-55"><a href="#Pool-55"><span class="linenos"> 55</span></a><span class="sd">        truncations of each other. For example, d4, d6, d8, d10, d12 are all</span>
</span><span id="Pool-56"><a href="#Pool-56"><span class="linenos"> 56</span></a><span class="sd">        same-side truncations of d12.</span>
</span><span id="Pool-57"><a href="#Pool-57"><span class="linenos"> 57</span></a>
</span><span id="Pool-58"><a href="#Pool-58"><span class="linenos"> 58</span></a><span class="sd">        Args:</span>
</span><span id="Pool-59"><a href="#Pool-59"><span class="linenos"> 59</span></a><span class="sd">            dice: The dice to put in the `Pool`. This can be one of the following:</span>
</span><span id="Pool-60"><a href="#Pool-60"><span class="linenos"> 60</span></a>
</span><span id="Pool-61"><a href="#Pool-61"><span class="linenos"> 61</span></a><span class="sd">                * A sequence of dice.</span>
</span><span id="Pool-62"><a href="#Pool-62"><span class="linenos"> 62</span></a><span class="sd">                * A mapping of dice and how many of that `Die` to put in the `Pool`.</span>
</span><span id="Pool-63"><a href="#Pool-63"><span class="linenos"> 63</span></a>
</span><span id="Pool-64"><a href="#Pool-64"><span class="linenos"> 64</span></a><span class="sd">                All outcomes within a `Pool` must be totally orderable.</span>
</span><span id="Pool-65"><a href="#Pool-65"><span class="linenos"> 65</span></a><span class="sd">            times: Multiplies the number of times each element of `dice` will</span>
</span><span id="Pool-66"><a href="#Pool-66"><span class="linenos"> 66</span></a><span class="sd">                be put into the pool.</span>
</span><span id="Pool-67"><a href="#Pool-67"><span class="linenos"> 67</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Pool-68"><a href="#Pool-68"><span class="linenos"> 68</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Pool-69"><a href="#Pool-69"><span class="linenos"> 69</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Pool-70"><a href="#Pool-70"><span class="linenos"> 70</span></a>
</span><span id="Pool-71"><a href="#Pool-71"><span class="linenos"> 71</span></a><span class="sd">        Raises:</span>
</span><span id="Pool-72"><a href="#Pool-72"><span class="linenos"> 72</span></a><span class="sd">            ValueError: If a bare `Deck` or `Die` argument is provided.</span>
</span><span id="Pool-73"><a href="#Pool-73"><span class="linenos"> 73</span></a><span class="sd">                A `Pool` of a single `Die` should constructed as `Pool([die])`.</span>
</span><span id="Pool-74"><a href="#Pool-74"><span class="linenos"> 74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-75"><a href="#Pool-75"><span class="linenos"> 75</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">Pool</span><span class="p">):</span>
</span><span id="Pool-76"><a href="#Pool-76"><span class="linenos"> 76</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Pool-77"><a href="#Pool-77"><span class="linenos"> 77</span></a>                <span class="k">return</span> <span class="n">dice</span>
</span><span id="Pool-78"><a href="#Pool-78"><span class="linenos"> 78</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Pool-79"><a href="#Pool-79"><span class="linenos"> 79</span></a>                <span class="n">dice</span> <span class="o">=</span> <span class="n">dice</span><span class="o">.</span><span class="n">_dice</span>
</span><span id="Pool-80"><a href="#Pool-80"><span class="linenos"> 80</span></a>
</span><span id="Pool-81"><a href="#Pool-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Deck</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deal</span><span class="p">)):</span>
</span><span id="Pool-82"><a href="#Pool-82"><span class="linenos"> 82</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool-83"><a href="#Pool-83"><span class="linenos"> 83</span></a>                <span class="sa">f</span><span class="s1">&#39;A Pool cannot be constructed with a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> argument.&#39;</span>
</span><span id="Pool-84"><a href="#Pool-84"><span class="linenos"> 84</span></a>            <span class="p">)</span>
</span><span id="Pool-85"><a href="#Pool-85"><span class="linenos"> 85</span></a>
</span><span id="Pool-86"><a href="#Pool-86"><span class="linenos"> 86</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">):</span>
</span><span id="Pool-87"><a href="#Pool-87"><span class="linenos"> 87</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool-88"><a href="#Pool-88"><span class="linenos"> 88</span></a>                <span class="s1">&#39;A Pool cannot be constructed with a Die argument. &#39;</span>
</span><span id="Pool-89"><a href="#Pool-89"><span class="linenos"> 89</span></a>                <span class="s1">&#39;Use Pool([die]) or die.pool() to construct a pool of a single die.&#39;</span>
</span><span id="Pool-90"><a href="#Pool-90"><span class="linenos"> 90</span></a>            <span class="p">)</span>
</span><span id="Pool-91"><a href="#Pool-91"><span class="linenos"> 91</span></a>
</span><span id="Pool-92"><a href="#Pool-92"><span class="linenos"> 92</span></a>        <span class="n">dice</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Pool-93"><a href="#Pool-93"><span class="linenos"> 93</span></a>        <span class="n">dice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span><span id="Pool-94"><a href="#Pool-94"><span class="linenos"> 94</span></a>
</span><span id="Pool-95"><a href="#Pool-95"><span class="linenos"> 95</span></a>        <span class="n">dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-96"><a href="#Pool-96"><span class="linenos"> 96</span></a>        <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">qty</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
</span><span id="Pool-97"><a href="#Pool-97"><span class="linenos"> 97</span></a>            <span class="n">dice_counts</span><span class="p">[</span><span class="n">die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">qty</span>
</span><span id="Pool-98"><a href="#Pool-98"><span class="linenos"> 98</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="Pool-99"><a href="#Pool-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_new_pool_from_mapping</span><span class="p">(</span><span class="n">dice_counts</span><span class="p">,</span> <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-100"><a href="#Pool-100"><span class="linenos">100</span></a>
</span><span id="Pool-101"><a href="#Pool-101"><span class="linenos">101</span></a>    <span class="nd">@classmethod</span>
</span><span id="Pool-102"><a href="#Pool-102"><span class="linenos">102</span></a>    <span class="k">def</span> <span class="nf">_new_pool_from_mapping</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dice_counts</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="Pool-103"><a href="#Pool-103"><span class="linenos">103</span></a>                               <span class="n">sorted_roll_counts</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="Pool-104"><a href="#Pool-104"><span class="linenos">104</span></a>        <span class="sd">&quot;&quot;&quot;Creates a new pool.</span>
</span><span id="Pool-105"><a href="#Pool-105"><span class="linenos">105</span></a>
</span><span id="Pool-106"><a href="#Pool-106"><span class="linenos">106</span></a><span class="sd">        Args:</span>
</span><span id="Pool-107"><a href="#Pool-107"><span class="linenos">107</span></a><span class="sd">            dice_counts: A map from dice to rolls.</span>
</span><span id="Pool-108"><a href="#Pool-108"><span class="linenos">108</span></a><span class="sd">            sorted_roll_counts: A tuple with length equal to the number of dice.</span>
</span><span id="Pool-109"><a href="#Pool-109"><span class="linenos">109</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-110"><a href="#Pool-110"><span class="linenos">110</span></a>        <span class="n">dice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="Pool-111"><a href="#Pool-111"><span class="linenos">111</span></a>            <span class="nb">sorted</span><span class="p">(</span><span class="n">dice_counts</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">kv</span><span class="p">:</span> <span class="n">kv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">key_tuple</span><span class="p">()))</span>
</span><span id="Pool-112"><a href="#Pool-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="n">new_pool_cached</span><span class="p">(</span>
</span><span id="Pool-113"><a href="#Pool-113"><span class="linenos">113</span></a>            <span class="bp">cls</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="Pool-114"><a href="#Pool-114"><span class="linenos">114</span></a>            <span class="n">dice</span><span class="p">,</span>
</span><span id="Pool-115"><a href="#Pool-115"><span class="linenos">115</span></a>            <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-116"><a href="#Pool-116"><span class="linenos">116</span></a>
</span><span id="Pool-117"><a href="#Pool-117"><span class="linenos">117</span></a>    <span class="nd">@classmethod</span>
</span><span id="Pool-118"><a href="#Pool-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">_new_pool_from_tuple</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dice</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
</span><span id="Pool-119"><a href="#Pool-119"><span class="linenos">119</span></a>                             <span class="n">sorted_roll_counts</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="Pool-120"><a href="#Pool-120"><span class="linenos">120</span></a>        <span class="sd">&quot;&quot;&quot;Creates a new pool.</span>
</span><span id="Pool-121"><a href="#Pool-121"><span class="linenos">121</span></a>
</span><span id="Pool-122"><a href="#Pool-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="Pool-123"><a href="#Pool-123"><span class="linenos">123</span></a><span class="sd">            dice: A sorted tuple of (dice, count).</span>
</span><span id="Pool-124"><a href="#Pool-124"><span class="linenos">124</span></a><span class="sd">            sorted_roll_counts: A tuple with length equal to the number of dice.</span>
</span><span id="Pool-125"><a href="#Pool-125"><span class="linenos">125</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-126"><a href="#Pool-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">new_pool_cached</span><span class="p">(</span>
</span><span id="Pool-127"><a href="#Pool-127"><span class="linenos">127</span></a>            <span class="bp">cls</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
</span><span id="Pool-128"><a href="#Pool-128"><span class="linenos">128</span></a>            <span class="n">dice</span><span class="p">,</span>
</span><span id="Pool-129"><a href="#Pool-129"><span class="linenos">129</span></a>            <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-130"><a href="#Pool-130"><span class="linenos">130</span></a>
</span><span id="Pool-131"><a href="#Pool-131"><span class="linenos">131</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-132"><a href="#Pool-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="nf">_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-133"><a href="#Pool-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">count</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-134"><a href="#Pool-134"><span class="linenos">134</span></a>
</span><span id="Pool-135"><a href="#Pool-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-136"><a href="#Pool-136"><span class="linenos">136</span></a>        <span class="sd">&quot;&quot;&quot;The number of dice in this pool, counting multiples of the same `Die`.&quot;&quot;&quot;</span>
</span><span id="Pool-137"><a href="#Pool-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>
</span><span id="Pool-138"><a href="#Pool-138"><span class="linenos">138</span></a>
</span><span id="Pool-139"><a href="#Pool-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Pool-140"><a href="#Pool-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-141"><a href="#Pool-141"><span class="linenos">141</span></a>
</span><span id="Pool-142"><a href="#Pool-142"><span class="linenos">142</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-143"><a href="#Pool-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">_denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-144"><a href="#Pool-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span><span class="o">**</span><span class="n">count</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-145"><a href="#Pool-145"><span class="linenos">145</span></a>
</span><span id="Pool-146"><a href="#Pool-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-147"><a href="#Pool-147"><span class="linenos">147</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span><span id="Pool-148"><a href="#Pool-148"><span class="linenos">148</span></a>
</span><span id="Pool-149"><a href="#Pool-149"><span class="linenos">149</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-150"><a href="#Pool-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">_dice_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Pool-151"><a href="#Pool-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(((</span><span class="n">die</span><span class="p">,)</span> <span class="o">*</span> <span class="n">count</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">),</span> <span class="n">start</span><span class="o">=</span><span class="p">())</span>
</span><span id="Pool-152"><a href="#Pool-152"><span class="linenos">152</span></a>
</span><span id="Pool-153"><a href="#Pool-153"><span class="linenos">153</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-154"><a href="#Pool-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="nf">_unique_dice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">]:</span>
</span><span id="Pool-155"><a href="#Pool-155"><span class="linenos">155</span></a>        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">die</span> <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span>
</span><span id="Pool-156"><a href="#Pool-156"><span class="linenos">156</span></a>
</span><span id="Pool-157"><a href="#Pool-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">unique_dice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">]:</span>
</span><span id="Pool-158"><a href="#Pool-158"><span class="linenos">158</span></a>        <span class="sd">&quot;&quot;&quot;The collection of unique dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool-159"><a href="#Pool-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_dice</span>
</span><span id="Pool-160"><a href="#Pool-160"><span class="linenos">160</span></a>
</span><span id="Pool-161"><a href="#Pool-161"><span class="linenos">161</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-162"><a href="#Pool-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="Pool-163"><a href="#Pool-163"><span class="linenos">163</span></a>        <span class="n">outcome_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="Pool-164"><a href="#Pool-164"><span class="linenos">164</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="Pool-165"><a href="#Pool-165"><span class="linenos">165</span></a>                <span class="n">die</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_dice</span><span class="p">()))</span>
</span><span id="Pool-166"><a href="#Pool-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">outcome_set</span><span class="p">))</span>
</span><span id="Pool-167"><a href="#Pool-167"><span class="linenos">167</span></a>
</span><span id="Pool-168"><a href="#Pool-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="Pool-169"><a href="#Pool-169"><span class="linenos">169</span></a>        <span class="sd">&quot;&quot;&quot;The union of outcomes among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool-170"><a href="#Pool-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span><span id="Pool-171"><a href="#Pool-171"><span class="linenos">171</span></a>
</span><span id="Pool-172"><a href="#Pool-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-173"><a href="#Pool-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span><span id="Pool-174"><a href="#Pool-174"><span class="linenos">174</span></a>
</span><span id="Pool-175"><a href="#Pool-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Pool-176"><a href="#Pool-176"><span class="linenos">176</span></a>        <span class="sd">&quot;&quot;&quot;Estimates the cost of popping from the min and max sides.</span>
</span><span id="Pool-177"><a href="#Pool-177"><span class="linenos">177</span></a>
</span><span id="Pool-178"><a href="#Pool-178"><span class="linenos">178</span></a><span class="sd">        Returns:</span>
</span><span id="Pool-179"><a href="#Pool-179"><span class="linenos">179</span></a><span class="sd">            pop_min_cost</span>
</span><span id="Pool-180"><a href="#Pool-180"><span class="linenos">180</span></a><span class="sd">            pop_max_cost</span>
</span><span id="Pool-181"><a href="#Pool-181"><span class="linenos">181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-182"><a href="#Pool-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">pool_cost</span><span class="o">.</span><span class="n">estimate_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Pool-183"><a href="#Pool-183"><span class="linenos">183</span></a>
</span><span id="Pool-184"><a href="#Pool-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">sorted_roll_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Pool-185"><a href="#Pool-185"><span class="linenos">185</span></a>        <span class="sd">&quot;&quot;&quot;The tuple indicating which dice in the pool will be counted.</span>
</span><span id="Pool-186"><a href="#Pool-186"><span class="linenos">186</span></a>
</span><span id="Pool-187"><a href="#Pool-187"><span class="linenos">187</span></a><span class="sd">        The tuple has one element per `Die` in the pool, from lowest roll to</span>
</span><span id="Pool-188"><a href="#Pool-188"><span class="linenos">188</span></a><span class="sd">        highest roll. The `Die` in the corresponding sorted position will be</span>
</span><span id="Pool-189"><a href="#Pool-189"><span class="linenos">189</span></a><span class="sd">        counted that many times.</span>
</span><span id="Pool-190"><a href="#Pool-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-191"><a href="#Pool-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_roll_counts</span>
</span><span id="Pool-192"><a href="#Pool-192"><span class="linenos">192</span></a>
</span><span id="Pool-193"><a href="#Pool-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">set_sorted_roll_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Pool-194"><a href="#Pool-194"><span class="linenos">194</span></a>                               <span class="n">sorted_roll_counts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="Pool-195"><a href="#Pool-195"><span class="linenos">195</span></a>        <span class="sd">&quot;&quot;&quot;A `Pool` with the selected dice counted after rolling and sorting.</span>
</span><span id="Pool-196"><a href="#Pool-196"><span class="linenos">196</span></a>
</span><span id="Pool-197"><a href="#Pool-197"><span class="linenos">197</span></a><span class="sd">        Use `pool[sorted_roll_counts]` for the same effect as this method.</span>
</span><span id="Pool-198"><a href="#Pool-198"><span class="linenos">198</span></a>
</span><span id="Pool-199"><a href="#Pool-199"><span class="linenos">199</span></a><span class="sd">        The dice are sorted in ascending order for this purpose,</span>
</span><span id="Pool-200"><a href="#Pool-200"><span class="linenos">200</span></a><span class="sd">        regardless of which order the outcomes are evaluated in.</span>
</span><span id="Pool-201"><a href="#Pool-201"><span class="linenos">201</span></a>
</span><span id="Pool-202"><a href="#Pool-202"><span class="linenos">202</span></a><span class="sd">        This is always an absolute selection on all `size` dice,</span>
</span><span id="Pool-203"><a href="#Pool-203"><span class="linenos">203</span></a><span class="sd">        not a relative selection on already-selected dice,</span>
</span><span id="Pool-204"><a href="#Pool-204"><span class="linenos">204</span></a><span class="sd">        which would be ambiguous in the presence of multiple or negative counts.</span>
</span><span id="Pool-205"><a href="#Pool-205"><span class="linenos">205</span></a>
</span><span id="Pool-206"><a href="#Pool-206"><span class="linenos">206</span></a><span class="sd">        For example, here are some ways of selecting the two highest dice out of 5:</span>
</span><span id="Pool-207"><a href="#Pool-207"><span class="linenos">207</span></a>
</span><span id="Pool-208"><a href="#Pool-208"><span class="linenos">208</span></a><span class="sd">        * `pool[3:5]`</span>
</span><span id="Pool-209"><a href="#Pool-209"><span class="linenos">209</span></a><span class="sd">        * `pool[3:]`</span>
</span><span id="Pool-210"><a href="#Pool-210"><span class="linenos">210</span></a><span class="sd">        * `pool[-2:]`</span>
</span><span id="Pool-211"><a href="#Pool-211"><span class="linenos">211</span></a><span class="sd">        * `pool[..., 1, 1]`</span>
</span><span id="Pool-212"><a href="#Pool-212"><span class="linenos">212</span></a><span class="sd">        * `pool[0, 0, 0, 1, 1]`</span>
</span><span id="Pool-213"><a href="#Pool-213"><span class="linenos">213</span></a>
</span><span id="Pool-214"><a href="#Pool-214"><span class="linenos">214</span></a><span class="sd">        These will count the highest as a positive and the lowest as a negative:</span>
</span><span id="Pool-215"><a href="#Pool-215"><span class="linenos">215</span></a>
</span><span id="Pool-216"><a href="#Pool-216"><span class="linenos">216</span></a><span class="sd">        * `pool[-1, 0, 0, 0, 1]`</span>
</span><span id="Pool-217"><a href="#Pool-217"><span class="linenos">217</span></a><span class="sd">        * `pool[-1, ..., 1]`</span>
</span><span id="Pool-218"><a href="#Pool-218"><span class="linenos">218</span></a>
</span><span id="Pool-219"><a href="#Pool-219"><span class="linenos">219</span></a><span class="sd">        Args: One of the following:</span>
</span><span id="Pool-220"><a href="#Pool-220"><span class="linenos">220</span></a><span class="sd">            * An `int`. This will count only the `Die` at the specified index</span>
</span><span id="Pool-221"><a href="#Pool-221"><span class="linenos">221</span></a><span class="sd">                (once). In this case, the result will be a `Die`, not a `Pool`.</span>
</span><span id="Pool-222"><a href="#Pool-222"><span class="linenos">222</span></a><span class="sd">            * A `slice`. The selected dice are counted once each.</span>
</span><span id="Pool-223"><a href="#Pool-223"><span class="linenos">223</span></a><span class="sd">            * A sequence of one `int` for each `Die`.</span>
</span><span id="Pool-224"><a href="#Pool-224"><span class="linenos">224</span></a><span class="sd">                Each `Die` is counted that many times, which could be multiple or</span>
</span><span id="Pool-225"><a href="#Pool-225"><span class="linenos">225</span></a><span class="sd">                negative times.</span>
</span><span id="Pool-226"><a href="#Pool-226"><span class="linenos">226</span></a>
</span><span id="Pool-227"><a href="#Pool-227"><span class="linenos">227</span></a><span class="sd">                Up to one `...` (`Ellipsis`) may be used.</span>
</span><span id="Pool-228"><a href="#Pool-228"><span class="linenos">228</span></a><span class="sd">                `...` will be replaced with a number of zero</span>
</span><span id="Pool-229"><a href="#Pool-229"><span class="linenos">229</span></a><span class="sd">                counts depending on the size of the pool.</span>
</span><span id="Pool-230"><a href="#Pool-230"><span class="linenos">230</span></a><span class="sd">                This number may be &quot;negative&quot; if more `int`s are provided than</span>
</span><span id="Pool-231"><a href="#Pool-231"><span class="linenos">231</span></a><span class="sd">                the size of the `Pool`. Specifically:</span>
</span><span id="Pool-232"><a href="#Pool-232"><span class="linenos">232</span></a>
</span><span id="Pool-233"><a href="#Pool-233"><span class="linenos">233</span></a><span class="sd">                * If `sorted_roll_counts` is shorter than `size`, `...`</span>
</span><span id="Pool-234"><a href="#Pool-234"><span class="linenos">234</span></a><span class="sd">                    acts as enough zero counts to make up the difference.</span>
</span><span id="Pool-235"><a href="#Pool-235"><span class="linenos">235</span></a><span class="sd">                    E.g. `pool[1, ..., 1]` on five dice would act as `pool[1, 0, 0, 0, 1]`.</span>
</span><span id="Pool-236"><a href="#Pool-236"><span class="linenos">236</span></a><span class="sd">                * If `sorted_roll_counts` has length equal to `size`, `...` has no effect.</span>
</span><span id="Pool-237"><a href="#Pool-237"><span class="linenos">237</span></a><span class="sd">                    E.g. `pool[1, ..., 1]` on two dice would act as `pool[1, 1]`.</span>
</span><span id="Pool-238"><a href="#Pool-238"><span class="linenos">238</span></a><span class="sd">                * If `sorted_roll_counts` is longer than `size` and `...` is on one side,</span>
</span><span id="Pool-239"><a href="#Pool-239"><span class="linenos">239</span></a><span class="sd">                    elements will be dropped from `sorted_roll_counts` on the side with `...`.</span>
</span><span id="Pool-240"><a href="#Pool-240"><span class="linenos">240</span></a><span class="sd">                    E.g. `pool[..., 1, 2, 3]` on two dice would act as `pool[2, 3]`.</span>
</span><span id="Pool-241"><a href="#Pool-241"><span class="linenos">241</span></a><span class="sd">                * If `sorted_roll_counts` is longer than `size` and `...`</span>
</span><span id="Pool-242"><a href="#Pool-242"><span class="linenos">242</span></a><span class="sd">                    is in the middle, the counts will be as the sum of two</span>
</span><span id="Pool-243"><a href="#Pool-243"><span class="linenos">243</span></a><span class="sd">                    one-sided `...`.</span>
</span><span id="Pool-244"><a href="#Pool-244"><span class="linenos">244</span></a><span class="sd">                    E.g. `pool[-1, ..., 1]` acts like `[-1, ...]` plus `[..., 1]`.</span>
</span><span id="Pool-245"><a href="#Pool-245"><span class="linenos">245</span></a><span class="sd">                    On a `Pool` consisting of a single `Die` this would have</span>
</span><span id="Pool-246"><a href="#Pool-246"><span class="linenos">246</span></a><span class="sd">                    the -1 and 1 cancel each other out.</span>
</span><span id="Pool-247"><a href="#Pool-247"><span class="linenos">247</span></a>
</span><span id="Pool-248"><a href="#Pool-248"><span class="linenos">248</span></a><span class="sd">        Raises:</span>
</span><span id="Pool-249"><a href="#Pool-249"><span class="linenos">249</span></a><span class="sd">            ValueError: If more than one `...` is used.</span>
</span><span id="Pool-250"><a href="#Pool-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-251"><a href="#Pool-251"><span class="linenos">251</span></a>        <span class="n">convert_to_die</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sorted_roll_counts</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-252"><a href="#Pool-252"><span class="linenos">252</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="n">sorted_roll_counts_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
</span><span id="Pool-253"><a href="#Pool-253"><span class="linenos">253</span></a>                                                      <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-254"><a href="#Pool-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_roll_counts</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="Pool-255"><a href="#Pool-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Pool-256"><a href="#Pool-256"><span class="linenos">256</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool-257"><a href="#Pool-257"><span class="linenos">257</span></a>                    <span class="s1">&#39;Cannot change the size of a pool unless it has exactly one type of die.&#39;</span>
</span><span id="Pool-258"><a href="#Pool-258"><span class="linenos">258</span></a>                <span class="p">)</span>
</span><span id="Pool-259"><a href="#Pool-259"><span class="linenos">259</span></a>            <span class="n">dice</span> <span class="o">=</span> <span class="n">Counts</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_roll_counts</span><span class="p">))])</span>
</span><span id="Pool-260"><a href="#Pool-260"><span class="linenos">260</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_pool_from_mapping</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-261"><a href="#Pool-261"><span class="linenos">261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Pool-262"><a href="#Pool-262"><span class="linenos">262</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_pool_from_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">,</span> <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-263"><a href="#Pool-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="n">convert_to_die</span><span class="p">:</span>
</span><span id="Pool-264"><a href="#Pool-264"><span class="linenos">264</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="n">outcome</span>
</span><span id="Pool-265"><a href="#Pool-265"><span class="linenos">265</span></a>                                   <span class="k">if</span> <span class="n">count</span> <span class="k">else</span> <span class="n">state</span><span class="p">)</span>
</span><span id="Pool-266"><a href="#Pool-266"><span class="linenos">266</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Pool-267"><a href="#Pool-267"><span class="linenos">267</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="Pool-268"><a href="#Pool-268"><span class="linenos">268</span></a>
</span><span id="Pool-269"><a href="#Pool-269"><span class="linenos">269</span></a>    <span class="fm">__getitem__</span> <span class="o">=</span> <span class="n">set_sorted_roll_counts</span>
</span><span id="Pool-270"><a href="#Pool-270"><span class="linenos">270</span></a>
</span><span id="Pool-271"><a href="#Pool-271"><span class="linenos">271</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-272"><a href="#Pool-272"><span class="linenos">272</span></a>    <span class="k">def</span> <span class="nf">_min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Pool-273"><a href="#Pool-273"><span class="linenos">273</span></a>        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_dice</span><span class="p">())</span>
</span><span id="Pool-274"><a href="#Pool-274"><span class="linenos">274</span></a>
</span><span id="Pool-275"><a href="#Pool-275"><span class="linenos">275</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Pool-276"><a href="#Pool-276"><span class="linenos">276</span></a>        <span class="sd">&quot;&quot;&quot;The min outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool-277"><a href="#Pool-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_outcome</span>
</span><span id="Pool-278"><a href="#Pool-278"><span class="linenos">278</span></a>
</span><span id="Pool-279"><a href="#Pool-279"><span class="linenos">279</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-280"><a href="#Pool-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="nf">_max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Pool-281"><a href="#Pool-281"><span class="linenos">281</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">die</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">unique_dice</span><span class="p">())</span>
</span><span id="Pool-282"><a href="#Pool-282"><span class="linenos">282</span></a>
</span><span id="Pool-283"><a href="#Pool-283"><span class="linenos">283</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Pool-284"><a href="#Pool-284"><span class="linenos">284</span></a>        <span class="sd">&quot;&quot;&quot;The max outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool-285"><a href="#Pool-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_outcome</span>
</span><span id="Pool-286"><a href="#Pool-286"><span class="linenos">286</span></a>
</span><span id="Pool-287"><a href="#Pool-287"><span class="linenos">287</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="Pool-288"><a href="#Pool-288"><span class="linenos">288</span></a>        <span class="sd">&quot;&quot;&quot;Pops the given outcome from this pool, if it is the min outcome.</span>
</span><span id="Pool-289"><a href="#Pool-289"><span class="linenos">289</span></a>
</span><span id="Pool-290"><a href="#Pool-290"><span class="linenos">290</span></a><span class="sd">        Yields:</span>
</span><span id="Pool-291"><a href="#Pool-291"><span class="linenos">291</span></a><span class="sd">            popped_pool: The pool after the min outcome is popped.</span>
</span><span id="Pool-292"><a href="#Pool-292"><span class="linenos">292</span></a><span class="sd">            net_count: The number of dice that rolled the min outcome, after</span>
</span><span id="Pool-293"><a href="#Pool-293"><span class="linenos">293</span></a><span class="sd">                accounting for sorted_roll_counts.</span>
</span><span id="Pool-294"><a href="#Pool-294"><span class="linenos">294</span></a><span class="sd">            net_weight: The weight of this incremental result.</span>
</span><span id="Pool-295"><a href="#Pool-295"><span class="linenos">295</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-296"><a href="#Pool-296"><span class="linenos">296</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="Pool-297"><a href="#Pool-297"><span class="linenos">297</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="mi">1</span>
</span><span id="Pool-298"><a href="#Pool-298"><span class="linenos">298</span></a>            <span class="k">return</span>
</span><span id="Pool-299"><a href="#Pool-299"><span class="linenos">299</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Pool-300"><a href="#Pool-300"><span class="linenos">300</span></a>            <span class="n">iter_die_pop_min</span><span class="p">(</span><span class="n">die</span><span class="p">,</span> <span class="n">die_count</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span>
</span><span id="Pool-301"><a href="#Pool-301"><span class="linenos">301</span></a>            <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">die_count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span>
</span><span id="Pool-302"><a href="#Pool-302"><span class="linenos">302</span></a>        <span class="p">]</span>
</span><span id="Pool-303"><a href="#Pool-303"><span class="linenos">303</span></a>        <span class="n">skip_weight</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Pool-304"><a href="#Pool-304"><span class="linenos">304</span></a>        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="Pool-305"><a href="#Pool-305"><span class="linenos">305</span></a>            <span class="n">total_hits</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Pool-306"><a href="#Pool-306"><span class="linenos">306</span></a>            <span class="n">result_weight</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Pool-307"><a href="#Pool-307"><span class="linenos">307</span></a>            <span class="n">next_dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-308"><a href="#Pool-308"><span class="linenos">308</span></a>            <span class="k">for</span> <span class="n">popped_die</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
</span><span id="Pool-309"><a href="#Pool-309"><span class="linenos">309</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">popped_die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="Pool-310"><a href="#Pool-310"><span class="linenos">310</span></a>                    <span class="n">next_dice_counts</span><span class="p">[</span><span class="n">popped_die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">misses</span>
</span><span id="Pool-311"><a href="#Pool-311"><span class="linenos">311</span></a>                <span class="n">total_hits</span> <span class="o">+=</span> <span class="n">hits</span>
</span><span id="Pool-312"><a href="#Pool-312"><span class="linenos">312</span></a>                <span class="n">result_weight</span> <span class="o">*=</span> <span class="n">weight</span>
</span><span id="Pool-313"><a href="#Pool-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="n">total_hits</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-314"><a href="#Pool-314"><span class="linenos">314</span></a>                <span class="n">result_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Pool-315"><a href="#Pool-315"><span class="linenos">315</span></a>                <span class="n">popped_sorted_roll_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">()</span>
</span><span id="Pool-316"><a href="#Pool-316"><span class="linenos">316</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Pool-317"><a href="#Pool-317"><span class="linenos">317</span></a>                <span class="n">result_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">()[:</span><span class="n">total_hits</span><span class="p">])</span>
</span><span id="Pool-318"><a href="#Pool-318"><span class="linenos">318</span></a>                <span class="n">popped_sorted_roll_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">(</span>
</span><span id="Pool-319"><a href="#Pool-319"><span class="linenos">319</span></a>                <span class="p">)[</span><span class="n">total_hits</span><span class="p">:]</span>
</span><span id="Pool-320"><a href="#Pool-320"><span class="linenos">320</span></a>            <span class="n">popped_pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_pool_from_mapping</span><span class="p">(</span>
</span><span id="Pool-321"><a href="#Pool-321"><span class="linenos">321</span></a>                <span class="n">next_dice_counts</span><span class="p">,</span> <span class="n">popped_sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-322"><a href="#Pool-322"><span class="linenos">322</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">popped_sorted_roll_counts</span><span class="p">):</span>
</span><span id="Pool-323"><a href="#Pool-323"><span class="linenos">323</span></a>                <span class="c1"># Dump all dice in exchange for the denominator.</span>
</span><span id="Pool-324"><a href="#Pool-324"><span class="linenos">324</span></a>                <span class="n">skip_weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip_weight</span> <span class="ow">or</span>
</span><span id="Pool-325"><a href="#Pool-325"><span class="linenos">325</span></a>                               <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">result_weight</span> <span class="o">*</span> <span class="n">popped_pool</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Pool-326"><a href="#Pool-326"><span class="linenos">326</span></a>                <span class="k">continue</span>
</span><span id="Pool-327"><a href="#Pool-327"><span class="linenos">327</span></a>
</span><span id="Pool-328"><a href="#Pool-328"><span class="linenos">328</span></a>            <span class="k">yield</span> <span class="n">popped_pool</span><span class="p">,</span> <span class="p">(</span><span class="n">result_count</span><span class="p">,),</span> <span class="n">result_weight</span>
</span><span id="Pool-329"><a href="#Pool-329"><span class="linenos">329</span></a>
</span><span id="Pool-330"><a href="#Pool-330"><span class="linenos">330</span></a>        <span class="k">if</span> <span class="n">skip_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Pool-331"><a href="#Pool-331"><span class="linenos">331</span></a>            <span class="k">yield</span> <span class="n">Pool</span><span class="p">([]),</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">()),),</span> <span class="n">skip_weight</span>
</span><span id="Pool-332"><a href="#Pool-332"><span class="linenos">332</span></a>
</span><span id="Pool-333"><a href="#Pool-333"><span class="linenos">333</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="Pool-334"><a href="#Pool-334"><span class="linenos">334</span></a>        <span class="sd">&quot;&quot;&quot;Pops the given outcome from this pool, if it is the max outcome.</span>
</span><span id="Pool-335"><a href="#Pool-335"><span class="linenos">335</span></a>
</span><span id="Pool-336"><a href="#Pool-336"><span class="linenos">336</span></a><span class="sd">        Yields:</span>
</span><span id="Pool-337"><a href="#Pool-337"><span class="linenos">337</span></a><span class="sd">            popped_pool: The pool after the max outcome is popped.</span>
</span><span id="Pool-338"><a href="#Pool-338"><span class="linenos">338</span></a><span class="sd">            net_count: The number of dice that rolled the max outcome, after</span>
</span><span id="Pool-339"><a href="#Pool-339"><span class="linenos">339</span></a><span class="sd">                accounting for sorted_roll_counts.</span>
</span><span id="Pool-340"><a href="#Pool-340"><span class="linenos">340</span></a><span class="sd">            net_weight: The weight of this incremental result.</span>
</span><span id="Pool-341"><a href="#Pool-341"><span class="linenos">341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-342"><a href="#Pool-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="Pool-343"><a href="#Pool-343"><span class="linenos">343</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="mi">1</span>
</span><span id="Pool-344"><a href="#Pool-344"><span class="linenos">344</span></a>            <span class="k">return</span>
</span><span id="Pool-345"><a href="#Pool-345"><span class="linenos">345</span></a>        <span class="n">generators</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Pool-346"><a href="#Pool-346"><span class="linenos">346</span></a>            <span class="n">iter_die_pop_max</span><span class="p">(</span><span class="n">die</span><span class="p">,</span> <span class="n">die_count</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span>
</span><span id="Pool-347"><a href="#Pool-347"><span class="linenos">347</span></a>            <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">die_count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span>
</span><span id="Pool-348"><a href="#Pool-348"><span class="linenos">348</span></a>        <span class="p">]</span>
</span><span id="Pool-349"><a href="#Pool-349"><span class="linenos">349</span></a>        <span class="n">skip_weight</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Pool-350"><a href="#Pool-350"><span class="linenos">350</span></a>        <span class="k">for</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="Pool-351"><a href="#Pool-351"><span class="linenos">351</span></a>            <span class="n">total_hits</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Pool-352"><a href="#Pool-352"><span class="linenos">352</span></a>            <span class="n">result_weight</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Pool-353"><a href="#Pool-353"><span class="linenos">353</span></a>            <span class="n">next_dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool-354"><a href="#Pool-354"><span class="linenos">354</span></a>            <span class="k">for</span> <span class="n">popped_die</span><span class="p">,</span> <span class="n">misses</span><span class="p">,</span> <span class="n">hits</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">:</span>
</span><span id="Pool-355"><a href="#Pool-355"><span class="linenos">355</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">popped_die</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="Pool-356"><a href="#Pool-356"><span class="linenos">356</span></a>                    <span class="n">next_dice_counts</span><span class="p">[</span><span class="n">popped_die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">misses</span>
</span><span id="Pool-357"><a href="#Pool-357"><span class="linenos">357</span></a>                <span class="n">total_hits</span> <span class="o">+=</span> <span class="n">hits</span>
</span><span id="Pool-358"><a href="#Pool-358"><span class="linenos">358</span></a>                <span class="n">result_weight</span> <span class="o">*=</span> <span class="n">weight</span>
</span><span id="Pool-359"><a href="#Pool-359"><span class="linenos">359</span></a>            <span class="k">if</span> <span class="n">total_hits</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-360"><a href="#Pool-360"><span class="linenos">360</span></a>                <span class="n">result_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Pool-361"><a href="#Pool-361"><span class="linenos">361</span></a>                <span class="n">popped_sorted_roll_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">()</span>
</span><span id="Pool-362"><a href="#Pool-362"><span class="linenos">362</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Pool-363"><a href="#Pool-363"><span class="linenos">363</span></a>                <span class="n">result_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">()[</span><span class="o">-</span><span class="n">total_hits</span><span class="p">:])</span>
</span><span id="Pool-364"><a href="#Pool-364"><span class="linenos">364</span></a>                <span class="n">popped_sorted_roll_counts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">(</span>
</span><span id="Pool-365"><a href="#Pool-365"><span class="linenos">365</span></a>                <span class="p">)[:</span><span class="o">-</span><span class="n">total_hits</span><span class="p">]</span>
</span><span id="Pool-366"><a href="#Pool-366"><span class="linenos">366</span></a>            <span class="n">popped_pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_pool_from_mapping</span><span class="p">(</span>
</span><span id="Pool-367"><a href="#Pool-367"><span class="linenos">367</span></a>                <span class="n">next_dice_counts</span><span class="p">,</span> <span class="n">popped_sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool-368"><a href="#Pool-368"><span class="linenos">368</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">popped_sorted_roll_counts</span><span class="p">):</span>
</span><span id="Pool-369"><a href="#Pool-369"><span class="linenos">369</span></a>                <span class="c1"># Dump all dice in exchange for the denominator.</span>
</span><span id="Pool-370"><a href="#Pool-370"><span class="linenos">370</span></a>                <span class="n">skip_weight</span> <span class="o">=</span> <span class="p">(</span><span class="n">skip_weight</span> <span class="ow">or</span>
</span><span id="Pool-371"><a href="#Pool-371"><span class="linenos">371</span></a>                               <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">result_weight</span> <span class="o">*</span> <span class="n">popped_pool</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="Pool-372"><a href="#Pool-372"><span class="linenos">372</span></a>                <span class="k">continue</span>
</span><span id="Pool-373"><a href="#Pool-373"><span class="linenos">373</span></a>
</span><span id="Pool-374"><a href="#Pool-374"><span class="linenos">374</span></a>            <span class="k">yield</span> <span class="n">popped_pool</span><span class="p">,</span> <span class="p">(</span><span class="n">result_count</span><span class="p">,),</span> <span class="n">result_weight</span>
</span><span id="Pool-375"><a href="#Pool-375"><span class="linenos">375</span></a>
</span><span id="Pool-376"><a href="#Pool-376"><span class="linenos">376</span></a>        <span class="k">if</span> <span class="n">skip_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Pool-377"><a href="#Pool-377"><span class="linenos">377</span></a>            <span class="k">yield</span> <span class="n">Pool</span><span class="p">([]),</span> <span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">()),),</span> <span class="n">skip_weight</span>
</span><span id="Pool-378"><a href="#Pool-378"><span class="linenos">378</span></a>
</span><span id="Pool-379"><a href="#Pool-379"><span class="linenos">379</span></a>    <span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="Pool-380"><a href="#Pool-380"><span class="linenos">380</span></a>        <span class="sd">&quot;&quot;&quot;The lowest outcome or sum of the lowest outcomes in the pool.</span>
</span><span id="Pool-381"><a href="#Pool-381"><span class="linenos">381</span></a>
</span><span id="Pool-382"><a href="#Pool-382"><span class="linenos">382</span></a><span class="sd">        The args override any `sorted_roll_counts` of this pool.</span>
</span><span id="Pool-383"><a href="#Pool-383"><span class="linenos">383</span></a>
</span><span id="Pool-384"><a href="#Pool-384"><span class="linenos">384</span></a><span class="sd">        Args:</span>
</span><span id="Pool-385"><a href="#Pool-385"><span class="linenos">385</span></a><span class="sd">            keep: The number of lowest dice will be summed.</span>
</span><span id="Pool-386"><a href="#Pool-386"><span class="linenos">386</span></a><span class="sd">            drop: This number of lowest dice will be dropped before keeping</span>
</span><span id="Pool-387"><a href="#Pool-387"><span class="linenos">387</span></a><span class="sd">                dice to be summed.</span>
</span><span id="Pool-388"><a href="#Pool-388"><span class="linenos">388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-389"><a href="#Pool-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-390"><a href="#Pool-390"><span class="linenos">390</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;keep=</span><span class="si">{</span><span class="n">keep</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool-391"><a href="#Pool-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="n">drop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-392"><a href="#Pool-392"><span class="linenos">392</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;drop=</span><span class="si">{</span><span class="n">drop</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool-393"><a href="#Pool-393"><span class="linenos">393</span></a>
</span><span id="Pool-394"><a href="#Pool-394"><span class="linenos">394</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool-395"><a href="#Pool-395"><span class="linenos">395</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool-396"><a href="#Pool-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Pool-397"><a href="#Pool-397"><span class="linenos">397</span></a>
</span><span id="Pool-398"><a href="#Pool-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="Pool-399"><a href="#Pool-399"><span class="linenos">399</span></a>        <span class="sd">&quot;&quot;&quot;The highest outcome or sum of the highest outcomes in the pool.</span>
</span><span id="Pool-400"><a href="#Pool-400"><span class="linenos">400</span></a>
</span><span id="Pool-401"><a href="#Pool-401"><span class="linenos">401</span></a><span class="sd">        The args override any `sorted_roll_counts` of this pool.</span>
</span><span id="Pool-402"><a href="#Pool-402"><span class="linenos">402</span></a>
</span><span id="Pool-403"><a href="#Pool-403"><span class="linenos">403</span></a><span class="sd">        Args:</span>
</span><span id="Pool-404"><a href="#Pool-404"><span class="linenos">404</span></a><span class="sd">            keep: The number of highest dice will be summed.</span>
</span><span id="Pool-405"><a href="#Pool-405"><span class="linenos">405</span></a><span class="sd">            drop: This number of highest dice will be dropped before keeping</span>
</span><span id="Pool-406"><a href="#Pool-406"><span class="linenos">406</span></a><span class="sd">                dice to be summed.</span>
</span><span id="Pool-407"><a href="#Pool-407"><span class="linenos">407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool-408"><a href="#Pool-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-409"><a href="#Pool-409"><span class="linenos">409</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;keep=</span><span class="si">{</span><span class="n">keep</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool-410"><a href="#Pool-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="n">drop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool-411"><a href="#Pool-411"><span class="linenos">411</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;drop=</span><span class="si">{</span><span class="n">drop</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool-412"><a href="#Pool-412"><span class="linenos">412</span></a>
</span><span id="Pool-413"><a href="#Pool-413"><span class="linenos">413</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool-414"><a href="#Pool-414"><span class="linenos">414</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool-415"><a href="#Pool-415"><span class="linenos">415</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span><span id="Pool-416"><a href="#Pool-416"><span class="linenos">416</span></a>
</span><span id="Pool-417"><a href="#Pool-417"><span class="linenos">417</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Pool-418"><a href="#Pool-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="Pool-419"><a href="#Pool-419"><span class="linenos">419</span></a>            <span class="sa">f</span><span class="s1">&#39;Pool of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="si">}</span><span class="s1"> dice with sorted_roll_counts=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sorted_roll_counts</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Pool-420"><a href="#Pool-420"><span class="linenos">420</span></a>            <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">die</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice_tuple</span><span class="p">))</span>
</span><span id="Pool-421"><a href="#Pool-421"><span class="linenos">421</span></a>
</span><span id="Pool-422"><a href="#Pool-422"><span class="linenos">422</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-423"><a href="#Pool-423"><span class="linenos">423</span></a>    <span class="k">def</span> <span class="nf">_key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Pool-424"><a href="#Pool-424"><span class="linenos">424</span></a>        <span class="k">return</span> <span class="n">Pool</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_roll_counts</span>
</span><span id="Pool-425"><a href="#Pool-425"><span class="linenos">425</span></a>
</span><span id="Pool-426"><a href="#Pool-426"><span class="linenos">426</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Pool-427"><a href="#Pool-427"><span class="linenos">427</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Pool</span><span class="p">):</span>
</span><span id="Pool-428"><a href="#Pool-428"><span class="linenos">428</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Pool-429"><a href="#Pool-429"><span class="linenos">429</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_key_tuple</span>
</span><span id="Pool-430"><a href="#Pool-430"><span class="linenos">430</span></a>
</span><span id="Pool-431"><a href="#Pool-431"><span class="linenos">431</span></a>    <span class="nd">@cached_property</span>
</span><span id="Pool-432"><a href="#Pool-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-433"><a href="#Pool-433"><span class="linenos">433</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span><span class="p">)</span>
</span><span id="Pool-434"><a href="#Pool-434"><span class="linenos">434</span></a>
</span><span id="Pool-435"><a href="#Pool-435"><span class="linenos">435</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool-436"><a href="#Pool-436"><span class="linenos">436</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span></pre></div>


            <div class="docstring"><p>Represents a set of sorted/unordered dice, only distinguished by the outcomes they roll.</p>

<p>This should be used in conjunction with <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> to generate a result.</p>
</div>


                            <div id="Pool.__init__" class="classattr">
                                        <input id="Pool.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">dice</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">]</span>,</span><span class="param">	<span class="n">times</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></span>)</span>

                <label class="view-source-button" for="Pool.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.__init__-49"><a href="#Pool.__init__-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Pool.__init__-50"><a href="#Pool.__init__-50"><span class="linenos">50</span></a>                <span class="n">dice</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">,</span>
</span><span id="Pool.__init__-51"><a href="#Pool.__init__-51"><span class="linenos">51</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="Pool.__init__-52"><a href="#Pool.__init__-52"><span class="linenos">52</span></a>        <span class="sd">&quot;&quot;&quot;Public constructor for a pool.</span>
</span><span id="Pool.__init__-53"><a href="#Pool.__init__-53"><span class="linenos">53</span></a>
</span><span id="Pool.__init__-54"><a href="#Pool.__init__-54"><span class="linenos">54</span></a><span class="sd">        Evaulation is most efficient when the dice are the same or same-side</span>
</span><span id="Pool.__init__-55"><a href="#Pool.__init__-55"><span class="linenos">55</span></a><span class="sd">        truncations of each other. For example, d4, d6, d8, d10, d12 are all</span>
</span><span id="Pool.__init__-56"><a href="#Pool.__init__-56"><span class="linenos">56</span></a><span class="sd">        same-side truncations of d12.</span>
</span><span id="Pool.__init__-57"><a href="#Pool.__init__-57"><span class="linenos">57</span></a>
</span><span id="Pool.__init__-58"><a href="#Pool.__init__-58"><span class="linenos">58</span></a><span class="sd">        Args:</span>
</span><span id="Pool.__init__-59"><a href="#Pool.__init__-59"><span class="linenos">59</span></a><span class="sd">            dice: The dice to put in the `Pool`. This can be one of the following:</span>
</span><span id="Pool.__init__-60"><a href="#Pool.__init__-60"><span class="linenos">60</span></a>
</span><span id="Pool.__init__-61"><a href="#Pool.__init__-61"><span class="linenos">61</span></a><span class="sd">                * A sequence of dice.</span>
</span><span id="Pool.__init__-62"><a href="#Pool.__init__-62"><span class="linenos">62</span></a><span class="sd">                * A mapping of dice and how many of that `Die` to put in the `Pool`.</span>
</span><span id="Pool.__init__-63"><a href="#Pool.__init__-63"><span class="linenos">63</span></a>
</span><span id="Pool.__init__-64"><a href="#Pool.__init__-64"><span class="linenos">64</span></a><span class="sd">                All outcomes within a `Pool` must be totally orderable.</span>
</span><span id="Pool.__init__-65"><a href="#Pool.__init__-65"><span class="linenos">65</span></a><span class="sd">            times: Multiplies the number of times each element of `dice` will</span>
</span><span id="Pool.__init__-66"><a href="#Pool.__init__-66"><span class="linenos">66</span></a><span class="sd">                be put into the pool.</span>
</span><span id="Pool.__init__-67"><a href="#Pool.__init__-67"><span class="linenos">67</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Pool.__init__-68"><a href="#Pool.__init__-68"><span class="linenos">68</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Pool.__init__-69"><a href="#Pool.__init__-69"><span class="linenos">69</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Pool.__init__-70"><a href="#Pool.__init__-70"><span class="linenos">70</span></a>
</span><span id="Pool.__init__-71"><a href="#Pool.__init__-71"><span class="linenos">71</span></a><span class="sd">        Raises:</span>
</span><span id="Pool.__init__-72"><a href="#Pool.__init__-72"><span class="linenos">72</span></a><span class="sd">            ValueError: If a bare `Deck` or `Die` argument is provided.</span>
</span><span id="Pool.__init__-73"><a href="#Pool.__init__-73"><span class="linenos">73</span></a><span class="sd">                A `Pool` of a single `Die` should constructed as `Pool([die])`.</span>
</span><span id="Pool.__init__-74"><a href="#Pool.__init__-74"><span class="linenos">74</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool.__init__-75"><a href="#Pool.__init__-75"><span class="linenos">75</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">Pool</span><span class="p">):</span>
</span><span id="Pool.__init__-76"><a href="#Pool.__init__-76"><span class="linenos">76</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Pool.__init__-77"><a href="#Pool.__init__-77"><span class="linenos">77</span></a>                <span class="k">return</span> <span class="n">dice</span>
</span><span id="Pool.__init__-78"><a href="#Pool.__init__-78"><span class="linenos">78</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Pool.__init__-79"><a href="#Pool.__init__-79"><span class="linenos">79</span></a>                <span class="n">dice</span> <span class="o">=</span> <span class="n">dice</span><span class="o">.</span><span class="n">_dice</span>
</span><span id="Pool.__init__-80"><a href="#Pool.__init__-80"><span class="linenos">80</span></a>
</span><span id="Pool.__init__-81"><a href="#Pool.__init__-81"><span class="linenos">81</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">Deck</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deal</span><span class="p">)):</span>
</span><span id="Pool.__init__-82"><a href="#Pool.__init__-82"><span class="linenos">82</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool.__init__-83"><a href="#Pool.__init__-83"><span class="linenos">83</span></a>                <span class="sa">f</span><span class="s1">&#39;A Pool cannot be constructed with a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> argument.&#39;</span>
</span><span id="Pool.__init__-84"><a href="#Pool.__init__-84"><span class="linenos">84</span></a>            <span class="p">)</span>
</span><span id="Pool.__init__-85"><a href="#Pool.__init__-85"><span class="linenos">85</span></a>
</span><span id="Pool.__init__-86"><a href="#Pool.__init__-86"><span class="linenos">86</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">):</span>
</span><span id="Pool.__init__-87"><a href="#Pool.__init__-87"><span class="linenos">87</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool.__init__-88"><a href="#Pool.__init__-88"><span class="linenos">88</span></a>                <span class="s1">&#39;A Pool cannot be constructed with a Die argument. &#39;</span>
</span><span id="Pool.__init__-89"><a href="#Pool.__init__-89"><span class="linenos">89</span></a>                <span class="s1">&#39;Use Pool([die]) or die.pool() to construct a pool of a single die.&#39;</span>
</span><span id="Pool.__init__-90"><a href="#Pool.__init__-90"><span class="linenos">90</span></a>            <span class="p">)</span>
</span><span id="Pool.__init__-91"><a href="#Pool.__init__-91"><span class="linenos">91</span></a>
</span><span id="Pool.__init__-92"><a href="#Pool.__init__-92"><span class="linenos">92</span></a>        <span class="n">dice</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Pool.__init__-93"><a href="#Pool.__init__-93"><span class="linenos">93</span></a>        <span class="n">dice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">implicit_convert_to_die</span><span class="p">(</span><span class="n">die</span><span class="p">)</span> <span class="k">for</span> <span class="n">die</span> <span class="ow">in</span> <span class="n">dice</span><span class="p">)</span>
</span><span id="Pool.__init__-94"><a href="#Pool.__init__-94"><span class="linenos">94</span></a>
</span><span id="Pool.__init__-95"><a href="#Pool.__init__-95"><span class="linenos">95</span></a>        <span class="n">dice_counts</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Pool.__init__-96"><a href="#Pool.__init__-96"><span class="linenos">96</span></a>        <span class="k">for</span> <span class="n">die</span><span class="p">,</span> <span class="n">qty</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
</span><span id="Pool.__init__-97"><a href="#Pool.__init__-97"><span class="linenos">97</span></a>            <span class="n">dice_counts</span><span class="p">[</span><span class="n">die</span><span class="p">]</span> <span class="o">+=</span> <span class="n">qty</span>
</span><span id="Pool.__init__-98"><a href="#Pool.__init__-98"><span class="linenos">98</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
</span><span id="Pool.__init__-99"><a href="#Pool.__init__-99"><span class="linenos">99</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_new_pool_from_mapping</span><span class="p">(</span><span class="n">dice_counts</span><span class="p">,</span> <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Public constructor for a pool.</p>

<p>Evaulation is most efficient when the dice are the same or same-side
truncations of each other. For example, d4, d6, d8, d10, d12 are all
same-side truncations of d12.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>dice:</strong>  The dice to put in the <code><a href="#Pool">Pool</a></code>. This can be one of the following:</p>

<ul>
<li>A sequence of dice.</li>
<li>A mapping of dice and how many of that <code><a href="#Die">Die</a></code> to put in the <code><a href="#Pool">Pool</a></code>.</li>
</ul>

<p><p>All outcomes within a <code><a href="#Pool">Pool</a></code> must be totally orderable.</p></li>
<li><strong>times:</strong>  Multiplies the number of times each element of <code>dice</code> will
be put into the pool.
<code>times</code> can either be a sequence of the same length as
<code><a href="#Pool.outcomes">outcomes</a></code> or a single <code>int</code> to apply to all elements of
<code><a href="#Pool.outcomes">outcomes</a></code>.</li>
</ul></p>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If a bare <code><a href="#Deck">Deck</a></code> or <code><a href="#Die">Die</a></code> argument is provided.
A <code><a href="#Pool">Pool</a></code> of a single <code><a href="#Die">Die</a></code> should constructed as <code>Pool([die])</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Pool.size" class="classattr">
                                        <input id="Pool.size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Pool.size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.size-135"><a href="#Pool.size-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool.size-136"><a href="#Pool.size-136"><span class="linenos">136</span></a>        <span class="sd">&quot;&quot;&quot;The number of dice in this pool, counting multiples of the same `Die`.&quot;&quot;&quot;</span>
</span><span id="Pool.size-137"><a href="#Pool.size-137"><span class="linenos">137</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_size</span>
</span></pre></div>


            <div class="docstring"><p>The number of dice in this pool, counting multiples of the same <code><a href="#Die">Die</a></code>.</p>
</div>


                            </div>
                            <div id="Pool.denominator" class="classattr">
                                        <input id="Pool.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Pool.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.denominator-146"><a href="#Pool.denominator-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool.denominator-147"><a href="#Pool.denominator-147"><span class="linenos">147</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div id="Pool.unique_dice" class="classattr">
                                        <input id="Pool.unique_dice-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unique_dice</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Collection</span><span class="p">[</span><span class="n"><a href="#Die">icepool.Die</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Pool.unique_dice-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.unique_dice"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.unique_dice-157"><a href="#Pool.unique_dice-157"><span class="linenos">157</span></a>    <span class="k">def</span> <span class="nf">unique_dice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="s1">&#39;icepool.Die&#39;</span><span class="p">]:</span>
</span><span id="Pool.unique_dice-158"><a href="#Pool.unique_dice-158"><span class="linenos">158</span></a>        <span class="sd">&quot;&quot;&quot;The collection of unique dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool.unique_dice-159"><a href="#Pool.unique_dice-159"><span class="linenos">159</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique_dice</span>
</span></pre></div>


            <div class="docstring"><p>The collection of unique dice in this pool.</p>
</div>


                            </div>
                            <div id="Pool.outcomes" class="classattr">
                                        <input id="Pool.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span>:</span></span>

                <label class="view-source-button" for="Pool.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.outcomes-168"><a href="#Pool.outcomes-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="Pool.outcomes-169"><a href="#Pool.outcomes-169"><span class="linenos">169</span></a>        <span class="sd">&quot;&quot;&quot;The union of outcomes among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool.outcomes-170"><a href="#Pool.outcomes-170"><span class="linenos">170</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span></pre></div>


            <div class="docstring"><p>The union of outcomes among all dice in this pool.</p>
</div>


                            </div>
                            <div id="Pool.counts_len" class="classattr">
                                        <input id="Pool.counts_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">counts_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Pool.counts_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.counts_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.counts_len-172"><a href="#Pool.counts_len-172"><span class="linenos">172</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Pool.counts_len-173"><a href="#Pool.counts_len-173"><span class="linenos">173</span></a>        <span class="k">return</span> <span class="mi">1</span>
</span></pre></div>


            <div class="docstring"><p>The number of counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="Pool.sorted_roll_counts" class="classattr">
                                        <input id="Pool.sorted_roll_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sorted_roll_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Pool.sorted_roll_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.sorted_roll_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.sorted_roll_counts-184"><a href="#Pool.sorted_roll_counts-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">sorted_roll_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Pool.sorted_roll_counts-185"><a href="#Pool.sorted_roll_counts-185"><span class="linenos">185</span></a>        <span class="sd">&quot;&quot;&quot;The tuple indicating which dice in the pool will be counted.</span>
</span><span id="Pool.sorted_roll_counts-186"><a href="#Pool.sorted_roll_counts-186"><span class="linenos">186</span></a>
</span><span id="Pool.sorted_roll_counts-187"><a href="#Pool.sorted_roll_counts-187"><span class="linenos">187</span></a><span class="sd">        The tuple has one element per `Die` in the pool, from lowest roll to</span>
</span><span id="Pool.sorted_roll_counts-188"><a href="#Pool.sorted_roll_counts-188"><span class="linenos">188</span></a><span class="sd">        highest roll. The `Die` in the corresponding sorted position will be</span>
</span><span id="Pool.sorted_roll_counts-189"><a href="#Pool.sorted_roll_counts-189"><span class="linenos">189</span></a><span class="sd">        counted that many times.</span>
</span><span id="Pool.sorted_roll_counts-190"><a href="#Pool.sorted_roll_counts-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool.sorted_roll_counts-191"><a href="#Pool.sorted_roll_counts-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sorted_roll_counts</span>
</span></pre></div>


            <div class="docstring"><p>The tuple indicating which dice in the pool will be counted.</p>

<p>The tuple has one element per <code><a href="#Die">Die</a></code> in the pool, from lowest roll to
highest roll. The <code><a href="#Die">Die</a></code> in the corresponding sorted position will be
counted that many times.</p>
</div>


                            </div>
                            <div id="Pool.set_sorted_roll_counts" class="classattr">
                                        <input id="Pool.set_sorted_roll_counts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_sorted_roll_counts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">sorted_roll_counts</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Pool.set_sorted_roll_counts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.set_sorted_roll_counts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.set_sorted_roll_counts-193"><a href="#Pool.set_sorted_roll_counts-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="nf">set_sorted_roll_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="Pool.set_sorted_roll_counts-194"><a href="#Pool.set_sorted_roll_counts-194"><span class="linenos">194</span></a>                               <span class="n">sorted_roll_counts</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">slice</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="Pool.set_sorted_roll_counts-195"><a href="#Pool.set_sorted_roll_counts-195"><span class="linenos">195</span></a>        <span class="sd">&quot;&quot;&quot;A `Pool` with the selected dice counted after rolling and sorting.</span>
</span><span id="Pool.set_sorted_roll_counts-196"><a href="#Pool.set_sorted_roll_counts-196"><span class="linenos">196</span></a>
</span><span id="Pool.set_sorted_roll_counts-197"><a href="#Pool.set_sorted_roll_counts-197"><span class="linenos">197</span></a><span class="sd">        Use `pool[sorted_roll_counts]` for the same effect as this method.</span>
</span><span id="Pool.set_sorted_roll_counts-198"><a href="#Pool.set_sorted_roll_counts-198"><span class="linenos">198</span></a>
</span><span id="Pool.set_sorted_roll_counts-199"><a href="#Pool.set_sorted_roll_counts-199"><span class="linenos">199</span></a><span class="sd">        The dice are sorted in ascending order for this purpose,</span>
</span><span id="Pool.set_sorted_roll_counts-200"><a href="#Pool.set_sorted_roll_counts-200"><span class="linenos">200</span></a><span class="sd">        regardless of which order the outcomes are evaluated in.</span>
</span><span id="Pool.set_sorted_roll_counts-201"><a href="#Pool.set_sorted_roll_counts-201"><span class="linenos">201</span></a>
</span><span id="Pool.set_sorted_roll_counts-202"><a href="#Pool.set_sorted_roll_counts-202"><span class="linenos">202</span></a><span class="sd">        This is always an absolute selection on all `size` dice,</span>
</span><span id="Pool.set_sorted_roll_counts-203"><a href="#Pool.set_sorted_roll_counts-203"><span class="linenos">203</span></a><span class="sd">        not a relative selection on already-selected dice,</span>
</span><span id="Pool.set_sorted_roll_counts-204"><a href="#Pool.set_sorted_roll_counts-204"><span class="linenos">204</span></a><span class="sd">        which would be ambiguous in the presence of multiple or negative counts.</span>
</span><span id="Pool.set_sorted_roll_counts-205"><a href="#Pool.set_sorted_roll_counts-205"><span class="linenos">205</span></a>
</span><span id="Pool.set_sorted_roll_counts-206"><a href="#Pool.set_sorted_roll_counts-206"><span class="linenos">206</span></a><span class="sd">        For example, here are some ways of selecting the two highest dice out of 5:</span>
</span><span id="Pool.set_sorted_roll_counts-207"><a href="#Pool.set_sorted_roll_counts-207"><span class="linenos">207</span></a>
</span><span id="Pool.set_sorted_roll_counts-208"><a href="#Pool.set_sorted_roll_counts-208"><span class="linenos">208</span></a><span class="sd">        * `pool[3:5]`</span>
</span><span id="Pool.set_sorted_roll_counts-209"><a href="#Pool.set_sorted_roll_counts-209"><span class="linenos">209</span></a><span class="sd">        * `pool[3:]`</span>
</span><span id="Pool.set_sorted_roll_counts-210"><a href="#Pool.set_sorted_roll_counts-210"><span class="linenos">210</span></a><span class="sd">        * `pool[-2:]`</span>
</span><span id="Pool.set_sorted_roll_counts-211"><a href="#Pool.set_sorted_roll_counts-211"><span class="linenos">211</span></a><span class="sd">        * `pool[..., 1, 1]`</span>
</span><span id="Pool.set_sorted_roll_counts-212"><a href="#Pool.set_sorted_roll_counts-212"><span class="linenos">212</span></a><span class="sd">        * `pool[0, 0, 0, 1, 1]`</span>
</span><span id="Pool.set_sorted_roll_counts-213"><a href="#Pool.set_sorted_roll_counts-213"><span class="linenos">213</span></a>
</span><span id="Pool.set_sorted_roll_counts-214"><a href="#Pool.set_sorted_roll_counts-214"><span class="linenos">214</span></a><span class="sd">        These will count the highest as a positive and the lowest as a negative:</span>
</span><span id="Pool.set_sorted_roll_counts-215"><a href="#Pool.set_sorted_roll_counts-215"><span class="linenos">215</span></a>
</span><span id="Pool.set_sorted_roll_counts-216"><a href="#Pool.set_sorted_roll_counts-216"><span class="linenos">216</span></a><span class="sd">        * `pool[-1, 0, 0, 0, 1]`</span>
</span><span id="Pool.set_sorted_roll_counts-217"><a href="#Pool.set_sorted_roll_counts-217"><span class="linenos">217</span></a><span class="sd">        * `pool[-1, ..., 1]`</span>
</span><span id="Pool.set_sorted_roll_counts-218"><a href="#Pool.set_sorted_roll_counts-218"><span class="linenos">218</span></a>
</span><span id="Pool.set_sorted_roll_counts-219"><a href="#Pool.set_sorted_roll_counts-219"><span class="linenos">219</span></a><span class="sd">        Args: One of the following:</span>
</span><span id="Pool.set_sorted_roll_counts-220"><a href="#Pool.set_sorted_roll_counts-220"><span class="linenos">220</span></a><span class="sd">            * An `int`. This will count only the `Die` at the specified index</span>
</span><span id="Pool.set_sorted_roll_counts-221"><a href="#Pool.set_sorted_roll_counts-221"><span class="linenos">221</span></a><span class="sd">                (once). In this case, the result will be a `Die`, not a `Pool`.</span>
</span><span id="Pool.set_sorted_roll_counts-222"><a href="#Pool.set_sorted_roll_counts-222"><span class="linenos">222</span></a><span class="sd">            * A `slice`. The selected dice are counted once each.</span>
</span><span id="Pool.set_sorted_roll_counts-223"><a href="#Pool.set_sorted_roll_counts-223"><span class="linenos">223</span></a><span class="sd">            * A sequence of one `int` for each `Die`.</span>
</span><span id="Pool.set_sorted_roll_counts-224"><a href="#Pool.set_sorted_roll_counts-224"><span class="linenos">224</span></a><span class="sd">                Each `Die` is counted that many times, which could be multiple or</span>
</span><span id="Pool.set_sorted_roll_counts-225"><a href="#Pool.set_sorted_roll_counts-225"><span class="linenos">225</span></a><span class="sd">                negative times.</span>
</span><span id="Pool.set_sorted_roll_counts-226"><a href="#Pool.set_sorted_roll_counts-226"><span class="linenos">226</span></a>
</span><span id="Pool.set_sorted_roll_counts-227"><a href="#Pool.set_sorted_roll_counts-227"><span class="linenos">227</span></a><span class="sd">                Up to one `...` (`Ellipsis`) may be used.</span>
</span><span id="Pool.set_sorted_roll_counts-228"><a href="#Pool.set_sorted_roll_counts-228"><span class="linenos">228</span></a><span class="sd">                `...` will be replaced with a number of zero</span>
</span><span id="Pool.set_sorted_roll_counts-229"><a href="#Pool.set_sorted_roll_counts-229"><span class="linenos">229</span></a><span class="sd">                counts depending on the size of the pool.</span>
</span><span id="Pool.set_sorted_roll_counts-230"><a href="#Pool.set_sorted_roll_counts-230"><span class="linenos">230</span></a><span class="sd">                This number may be &quot;negative&quot; if more `int`s are provided than</span>
</span><span id="Pool.set_sorted_roll_counts-231"><a href="#Pool.set_sorted_roll_counts-231"><span class="linenos">231</span></a><span class="sd">                the size of the `Pool`. Specifically:</span>
</span><span id="Pool.set_sorted_roll_counts-232"><a href="#Pool.set_sorted_roll_counts-232"><span class="linenos">232</span></a>
</span><span id="Pool.set_sorted_roll_counts-233"><a href="#Pool.set_sorted_roll_counts-233"><span class="linenos">233</span></a><span class="sd">                * If `sorted_roll_counts` is shorter than `size`, `...`</span>
</span><span id="Pool.set_sorted_roll_counts-234"><a href="#Pool.set_sorted_roll_counts-234"><span class="linenos">234</span></a><span class="sd">                    acts as enough zero counts to make up the difference.</span>
</span><span id="Pool.set_sorted_roll_counts-235"><a href="#Pool.set_sorted_roll_counts-235"><span class="linenos">235</span></a><span class="sd">                    E.g. `pool[1, ..., 1]` on five dice would act as `pool[1, 0, 0, 0, 1]`.</span>
</span><span id="Pool.set_sorted_roll_counts-236"><a href="#Pool.set_sorted_roll_counts-236"><span class="linenos">236</span></a><span class="sd">                * If `sorted_roll_counts` has length equal to `size`, `...` has no effect.</span>
</span><span id="Pool.set_sorted_roll_counts-237"><a href="#Pool.set_sorted_roll_counts-237"><span class="linenos">237</span></a><span class="sd">                    E.g. `pool[1, ..., 1]` on two dice would act as `pool[1, 1]`.</span>
</span><span id="Pool.set_sorted_roll_counts-238"><a href="#Pool.set_sorted_roll_counts-238"><span class="linenos">238</span></a><span class="sd">                * If `sorted_roll_counts` is longer than `size` and `...` is on one side,</span>
</span><span id="Pool.set_sorted_roll_counts-239"><a href="#Pool.set_sorted_roll_counts-239"><span class="linenos">239</span></a><span class="sd">                    elements will be dropped from `sorted_roll_counts` on the side with `...`.</span>
</span><span id="Pool.set_sorted_roll_counts-240"><a href="#Pool.set_sorted_roll_counts-240"><span class="linenos">240</span></a><span class="sd">                    E.g. `pool[..., 1, 2, 3]` on two dice would act as `pool[2, 3]`.</span>
</span><span id="Pool.set_sorted_roll_counts-241"><a href="#Pool.set_sorted_roll_counts-241"><span class="linenos">241</span></a><span class="sd">                * If `sorted_roll_counts` is longer than `size` and `...`</span>
</span><span id="Pool.set_sorted_roll_counts-242"><a href="#Pool.set_sorted_roll_counts-242"><span class="linenos">242</span></a><span class="sd">                    is in the middle, the counts will be as the sum of two</span>
</span><span id="Pool.set_sorted_roll_counts-243"><a href="#Pool.set_sorted_roll_counts-243"><span class="linenos">243</span></a><span class="sd">                    one-sided `...`.</span>
</span><span id="Pool.set_sorted_roll_counts-244"><a href="#Pool.set_sorted_roll_counts-244"><span class="linenos">244</span></a><span class="sd">                    E.g. `pool[-1, ..., 1]` acts like `[-1, ...]` plus `[..., 1]`.</span>
</span><span id="Pool.set_sorted_roll_counts-245"><a href="#Pool.set_sorted_roll_counts-245"><span class="linenos">245</span></a><span class="sd">                    On a `Pool` consisting of a single `Die` this would have</span>
</span><span id="Pool.set_sorted_roll_counts-246"><a href="#Pool.set_sorted_roll_counts-246"><span class="linenos">246</span></a><span class="sd">                    the -1 and 1 cancel each other out.</span>
</span><span id="Pool.set_sorted_roll_counts-247"><a href="#Pool.set_sorted_roll_counts-247"><span class="linenos">247</span></a>
</span><span id="Pool.set_sorted_roll_counts-248"><a href="#Pool.set_sorted_roll_counts-248"><span class="linenos">248</span></a><span class="sd">        Raises:</span>
</span><span id="Pool.set_sorted_roll_counts-249"><a href="#Pool.set_sorted_roll_counts-249"><span class="linenos">249</span></a><span class="sd">            ValueError: If more than one `...` is used.</span>
</span><span id="Pool.set_sorted_roll_counts-250"><a href="#Pool.set_sorted_roll_counts-250"><span class="linenos">250</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool.set_sorted_roll_counts-251"><a href="#Pool.set_sorted_roll_counts-251"><span class="linenos">251</span></a>        <span class="n">convert_to_die</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sorted_roll_counts</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="Pool.set_sorted_roll_counts-252"><a href="#Pool.set_sorted_roll_counts-252"><span class="linenos">252</span></a>        <span class="n">sorted_roll_counts</span> <span class="o">=</span> <span class="n">sorted_roll_counts_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
</span><span id="Pool.set_sorted_roll_counts-253"><a href="#Pool.set_sorted_roll_counts-253"><span class="linenos">253</span></a>                                                      <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool.set_sorted_roll_counts-254"><a href="#Pool.set_sorted_roll_counts-254"><span class="linenos">254</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_roll_counts</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="Pool.set_sorted_roll_counts-255"><a href="#Pool.set_sorted_roll_counts-255"><span class="linenos">255</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Pool.set_sorted_roll_counts-256"><a href="#Pool.set_sorted_roll_counts-256"><span class="linenos">256</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Pool.set_sorted_roll_counts-257"><a href="#Pool.set_sorted_roll_counts-257"><span class="linenos">257</span></a>                    <span class="s1">&#39;Cannot change the size of a pool unless it has exactly one type of die.&#39;</span>
</span><span id="Pool.set_sorted_roll_counts-258"><a href="#Pool.set_sorted_roll_counts-258"><span class="linenos">258</span></a>                <span class="p">)</span>
</span><span id="Pool.set_sorted_roll_counts-259"><a href="#Pool.set_sorted_roll_counts-259"><span class="linenos">259</span></a>            <span class="n">dice</span> <span class="o">=</span> <span class="n">Counts</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_roll_counts</span><span class="p">))])</span>
</span><span id="Pool.set_sorted_roll_counts-260"><a href="#Pool.set_sorted_roll_counts-260"><span class="linenos">260</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_pool_from_mapping</span><span class="p">(</span><span class="n">dice</span><span class="p">,</span> <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool.set_sorted_roll_counts-261"><a href="#Pool.set_sorted_roll_counts-261"><span class="linenos">261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Pool.set_sorted_roll_counts-262"><a href="#Pool.set_sorted_roll_counts-262"><span class="linenos">262</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">Pool</span><span class="o">.</span><span class="n">_new_pool_from_tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dice</span><span class="p">,</span> <span class="n">sorted_roll_counts</span><span class="p">)</span>
</span><span id="Pool.set_sorted_roll_counts-263"><a href="#Pool.set_sorted_roll_counts-263"><span class="linenos">263</span></a>        <span class="k">if</span> <span class="n">convert_to_die</span><span class="p">:</span>
</span><span id="Pool.set_sorted_roll_counts-264"><a href="#Pool.set_sorted_roll_counts-264"><span class="linenos">264</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="n">outcome</span>
</span><span id="Pool.set_sorted_roll_counts-265"><a href="#Pool.set_sorted_roll_counts-265"><span class="linenos">265</span></a>                                   <span class="k">if</span> <span class="n">count</span> <span class="k">else</span> <span class="n">state</span><span class="p">)</span>
</span><span id="Pool.set_sorted_roll_counts-266"><a href="#Pool.set_sorted_roll_counts-266"><span class="linenos">266</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Pool.set_sorted_roll_counts-267"><a href="#Pool.set_sorted_roll_counts-267"><span class="linenos">267</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Pool">Pool</a></code> with the selected dice counted after rolling and sorting.</p>

<p>Use <code>pool[sorted_roll_counts]</code> for the same effect as this method.</p>

<p>The dice are sorted in ascending order for this purpose,
regardless of which order the outcomes are evaluated in.</p>

<p>This is always an absolute selection on all <code><a href="#Pool.size">size</a></code> dice,
not a relative selection on already-selected dice,
which would be ambiguous in the presence of multiple or negative counts.</p>

<p>For example, here are some ways of selecting the two highest dice out of 5:</p>

<ul>
<li><code>pool[3:5]</code></li>
<li><code>pool[3:]</code></li>
<li><code>pool[-2:]</code></li>
<li><code>pool[..., 1, 1]</code></li>
<li><code>pool[0, 0, 0, 1, 1]</code></li>
</ul>

<p>These will count the highest as a positive and the lowest as a negative:</p>

<ul>
<li><code>pool[-1, 0, 0, 0, 1]</code></li>
<li><code>pool[-1, ..., 1]</code></li>
</ul>

<p>Args: One of the following:
    * An <code>int</code>. This will count only the <code><a href="#Die">Die</a></code> at the specified index
        (once). In this case, the result will be a <code><a href="#Die">Die</a></code>, not a <code><a href="#Pool">Pool</a></code>.
    * A <code>slice</code>. The selected dice are counted once each.
    * A sequence of one <code>int</code> for each <code><a href="#Die">Die</a></code>.
        Each <code><a href="#Die">Die</a></code> is counted that many times, which could be multiple or
        negative times.</p>

<pre><code>    Up to one `...` (`Ellipsis`) may be used.
    `...` will be replaced with a number of zero
    counts depending on the size of the pool.
    This number may be "negative" if more `int`s are provided than
    the size of the `Pool`. Specifically:

    * If `sorted_roll_counts` is shorter than `size`, `...`
        acts as enough zero counts to make up the difference.
        E.g. `pool[1, ..., 1]` on five dice would act as `pool[1, 0, 0, 0, 1]`.
    * If `sorted_roll_counts` has length equal to `size`, `...` has no effect.
        E.g. `pool[1, ..., 1]` on two dice would act as `pool[1, 1]`.
    * If `sorted_roll_counts` is longer than `size` and `...` is on one side,
        elements will be dropped from `sorted_roll_counts` on the side with `...`.
        E.g. `pool[..., 1, 2, 3]` on two dice would act as `pool[2, 3]`.
    * If `sorted_roll_counts` is longer than `size` and `...`
        is in the middle, the counts will be as the sum of two
        one-sided `...`.
        E.g. `pool[-1, ..., 1]` acts like `[-1, ...]` plus `[..., 1]`.
        On a `Pool` consisting of a single `Die` this would have
        the -1 and 1 cancel each other out.
</code></pre>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If more than one <code>...</code> is used.</li>
</ul>
</div>


                            </div>
                            <div id="Pool.min_outcome" class="classattr">
                                        <input id="Pool.min_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Pool.min_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.min_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.min_outcome-275"><a href="#Pool.min_outcome-275"><span class="linenos">275</span></a>    <span class="k">def</span> <span class="nf">min_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Pool.min_outcome-276"><a href="#Pool.min_outcome-276"><span class="linenos">276</span></a>        <span class="sd">&quot;&quot;&quot;The min outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool.min_outcome-277"><a href="#Pool.min_outcome-277"><span class="linenos">277</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_outcome</span>
</span></pre></div>


            <div class="docstring"><p>The min outcome among all dice in this pool.</p>
</div>


                            </div>
                            <div id="Pool.max_outcome" class="classattr">
                                        <input id="Pool.max_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Pool.max_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.max_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.max_outcome-283"><a href="#Pool.max_outcome-283"><span class="linenos">283</span></a>    <span class="k">def</span> <span class="nf">max_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Pool.max_outcome-284"><a href="#Pool.max_outcome-284"><span class="linenos">284</span></a>        <span class="sd">&quot;&quot;&quot;The max outcome among all dice in this pool.&quot;&quot;&quot;</span>
</span><span id="Pool.max_outcome-285"><a href="#Pool.max_outcome-285"><span class="linenos">285</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_outcome</span>
</span></pre></div>


            <div class="docstring"><p>The max outcome among all dice in this pool.</p>
</div>


                            </div>
                            <div id="Pool.lowest" class="classattr">
                                        <input id="Pool.lowest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lowest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Pool.lowest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.lowest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.lowest-379"><a href="#Pool.lowest-379"><span class="linenos">379</span></a>    <span class="k">def</span> <span class="nf">lowest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="Pool.lowest-380"><a href="#Pool.lowest-380"><span class="linenos">380</span></a>        <span class="sd">&quot;&quot;&quot;The lowest outcome or sum of the lowest outcomes in the pool.</span>
</span><span id="Pool.lowest-381"><a href="#Pool.lowest-381"><span class="linenos">381</span></a>
</span><span id="Pool.lowest-382"><a href="#Pool.lowest-382"><span class="linenos">382</span></a><span class="sd">        The args override any `sorted_roll_counts` of this pool.</span>
</span><span id="Pool.lowest-383"><a href="#Pool.lowest-383"><span class="linenos">383</span></a>
</span><span id="Pool.lowest-384"><a href="#Pool.lowest-384"><span class="linenos">384</span></a><span class="sd">        Args:</span>
</span><span id="Pool.lowest-385"><a href="#Pool.lowest-385"><span class="linenos">385</span></a><span class="sd">            keep: The number of lowest dice will be summed.</span>
</span><span id="Pool.lowest-386"><a href="#Pool.lowest-386"><span class="linenos">386</span></a><span class="sd">            drop: This number of lowest dice will be dropped before keeping</span>
</span><span id="Pool.lowest-387"><a href="#Pool.lowest-387"><span class="linenos">387</span></a><span class="sd">                dice to be summed.</span>
</span><span id="Pool.lowest-388"><a href="#Pool.lowest-388"><span class="linenos">388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool.lowest-389"><a href="#Pool.lowest-389"><span class="linenos">389</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool.lowest-390"><a href="#Pool.lowest-390"><span class="linenos">390</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;keep=</span><span class="si">{</span><span class="n">keep</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool.lowest-391"><a href="#Pool.lowest-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="n">drop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool.lowest-392"><a href="#Pool.lowest-392"><span class="linenos">392</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;drop=</span><span class="si">{</span><span class="n">drop</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool.lowest-393"><a href="#Pool.lowest-393"><span class="linenos">393</span></a>
</span><span id="Pool.lowest-394"><a href="#Pool.lowest-394"><span class="linenos">394</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool.lowest-395"><a href="#Pool.lowest-395"><span class="linenos">395</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool.lowest-396"><a href="#Pool.lowest-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>The lowest outcome or sum of the lowest outcomes in the pool.</p>

<p>The args override any <code><a href="#Pool.sorted_roll_counts">sorted_roll_counts</a></code> of this pool.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>keep:</strong>  The number of lowest dice will be summed.</li>
<li><strong>drop:</strong>  This number of lowest dice will be dropped before keeping
dice to be summed.</li>
</ul>
</div>


                            </div>
                            <div id="Pool.highest" class="classattr">
                                        <input id="Pool.highest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">highest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>, </span><span class="param"><span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="Pool.highest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Pool.highest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Pool.highest-398"><a href="#Pool.highest-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">highest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">drop</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="Pool.highest-399"><a href="#Pool.highest-399"><span class="linenos">399</span></a>        <span class="sd">&quot;&quot;&quot;The highest outcome or sum of the highest outcomes in the pool.</span>
</span><span id="Pool.highest-400"><a href="#Pool.highest-400"><span class="linenos">400</span></a>
</span><span id="Pool.highest-401"><a href="#Pool.highest-401"><span class="linenos">401</span></a><span class="sd">        The args override any `sorted_roll_counts` of this pool.</span>
</span><span id="Pool.highest-402"><a href="#Pool.highest-402"><span class="linenos">402</span></a>
</span><span id="Pool.highest-403"><a href="#Pool.highest-403"><span class="linenos">403</span></a><span class="sd">        Args:</span>
</span><span id="Pool.highest-404"><a href="#Pool.highest-404"><span class="linenos">404</span></a><span class="sd">            keep: The number of highest dice will be summed.</span>
</span><span id="Pool.highest-405"><a href="#Pool.highest-405"><span class="linenos">405</span></a><span class="sd">            drop: This number of highest dice will be dropped before keeping</span>
</span><span id="Pool.highest-406"><a href="#Pool.highest-406"><span class="linenos">406</span></a><span class="sd">                dice to be summed.</span>
</span><span id="Pool.highest-407"><a href="#Pool.highest-407"><span class="linenos">407</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Pool.highest-408"><a href="#Pool.highest-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">keep</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool.highest-409"><a href="#Pool.highest-409"><span class="linenos">409</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;keep=</span><span class="si">{</span><span class="n">keep</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool.highest-410"><a href="#Pool.highest-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="n">drop</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Pool.highest-411"><a href="#Pool.highest-411"><span class="linenos">411</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;drop=</span><span class="si">{</span><span class="n">drop</span><span class="si">}</span><span class="s1"> cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Pool.highest-412"><a href="#Pool.highest-412"><span class="linenos">412</span></a>
</span><span id="Pool.highest-413"><a href="#Pool.highest-413"><span class="linenos">413</span></a>        <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">keep</span> <span class="o">+</span> <span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool.highest-414"><a href="#Pool.highest-414"><span class="linenos">414</span></a>        <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">drop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Pool.highest-415"><a href="#Pool.highest-415"><span class="linenos">415</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>The highest outcome or sum of the highest outcomes in the pool.</p>

<p>The args override any <code><a href="#Pool.sorted_roll_counts">sorted_roll_counts</a></code> of this pool.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>keep:</strong>  The number of highest dice will be summed.</li>
<li><strong>drop:</strong>  This number of highest dice will be dropped before keeping
dice to be summed.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></dt>
                                <dd id="Pool.evaluate" class="function"><a href="#OutcomeCountGenerator.evaluate">evaluate</a></dd>
                <dd id="Pool.expand" class="function"><a href="#OutcomeCountGenerator.expand">expand</a></dd>
                <dd id="Pool.sum" class="function"><a href="#OutcomeCountGenerator.sum">sum</a></dd>
                <dd id="Pool.count" class="function"><a href="#OutcomeCountGenerator.count">count</a></dd>
                <dd id="Pool.count_in" class="function"><a href="#OutcomeCountGenerator.count_in">count_in</a></dd>
                <dd id="Pool.count_unique" class="function"><a href="#OutcomeCountGenerator.count_unique">count_unique</a></dd>
                <dd id="Pool.contains_subset" class="function"><a href="#OutcomeCountGenerator.contains_subset">contains_subset</a></dd>
                <dd id="Pool.intersection_size" class="function"><a href="#OutcomeCountGenerator.intersection_size">intersection_size</a></dd>
                <dd id="Pool.best_matching_set" class="function"><a href="#OutcomeCountGenerator.best_matching_set">best_matching_set</a></dd>
                <dd id="Pool.best_straight" class="function"><a href="#OutcomeCountGenerator.best_straight">best_straight</a></dd>
                <dd id="Pool.sample" class="function"><a href="#OutcomeCountGenerator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="standard_pool">
                            <input id="standard_pool-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">standard_pool</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">die_sizes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Pool">icepool.Pool</a></span>:</span></span>

                <label class="view-source-button" for="standard_pool-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#standard_pool"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="standard_pool-514"><a href="#standard_pool-514"><span class="linenos">514</span></a><span class="k">def</span> <span class="nf">standard_pool</span><span class="p">(</span><span class="n">die_sizes</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s1">&#39;Pool&#39;</span><span class="p">:</span>
</span><span id="standard_pool-515"><a href="#standard_pool-515"><span class="linenos">515</span></a>    <span class="sd">&quot;&quot;&quot;A `Pool` of standard dice (e.g. d6, d8...).</span>
</span><span id="standard_pool-516"><a href="#standard_pool-516"><span class="linenos">516</span></a>
</span><span id="standard_pool-517"><a href="#standard_pool-517"><span class="linenos">517</span></a><span class="sd">    Args:</span>
</span><span id="standard_pool-518"><a href="#standard_pool-518"><span class="linenos">518</span></a><span class="sd">        die_sizes: A collection of die sizes, which will put one die of that</span>
</span><span id="standard_pool-519"><a href="#standard_pool-519"><span class="linenos">519</span></a><span class="sd">            sizes in the pool for each element.</span>
</span><span id="standard_pool-520"><a href="#standard_pool-520"><span class="linenos">520</span></a><span class="sd">            Or, a mapping of die sizes to how many dice of that size to put</span>
</span><span id="standard_pool-521"><a href="#standard_pool-521"><span class="linenos">521</span></a><span class="sd">            into the pool.</span>
</span><span id="standard_pool-522"><a href="#standard_pool-522"><span class="linenos">522</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="standard_pool-523"><a href="#standard_pool-523"><span class="linenos">523</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">die_sizes</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="standard_pool-524"><a href="#standard_pool-524"><span class="linenos">524</span></a>        <span class="n">die_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="standard_pool-525"><a href="#standard_pool-525"><span class="linenos">525</span></a>            <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="standard_pool-526"><a href="#standard_pool-526"><span class="linenos">526</span></a>                <span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">die_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>  <span class="c1"># type: ignore</span>
</span><span id="standard_pool-527"><a href="#standard_pool-527"><span class="linenos">527</span></a>    <span class="k">return</span> <span class="n">Pool</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">icepool</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">die_sizes</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A <code><a href="#Pool">Pool</a></code> of standard dice (e.g. d6, d8...).</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>die_sizes:</strong>  A collection of die sizes, which will put one die of that
sizes in the pool for each element.
Or, a mapping of die sizes to how many dice of that size to put
into the pool.</li>
</ul>
</div>


                </section>
                <section id="OutcomeCountEvaluator">
                            <input id="OutcomeCountEvaluator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">OutcomeCountEvaluator</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="OutcomeCountEvaluator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator-27"><a href="#OutcomeCountEvaluator-27"><span class="linenos"> 27</span></a><span class="k">class</span> <span class="nc">OutcomeCountEvaluator</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator-28"><a href="#OutcomeCountEvaluator-28"><span class="linenos"> 28</span></a>    <span class="sd">&quot;&quot;&quot;An abstract, immutable, callable class for evaulating one or more `OutcomeCountGenerator`s.</span>
</span><span id="OutcomeCountEvaluator-29"><a href="#OutcomeCountEvaluator-29"><span class="linenos"> 29</span></a>
</span><span id="OutcomeCountEvaluator-30"><a href="#OutcomeCountEvaluator-30"><span class="linenos"> 30</span></a><span class="sd">    There is one abstract method to implement: `next_state()`.</span>
</span><span id="OutcomeCountEvaluator-31"><a href="#OutcomeCountEvaluator-31"><span class="linenos"> 31</span></a><span class="sd">    This should incrementally calculate the result given one outcome at a time</span>
</span><span id="OutcomeCountEvaluator-32"><a href="#OutcomeCountEvaluator-32"><span class="linenos"> 32</span></a><span class="sd">    along with how many of that outcome were produced.</span>
</span><span id="OutcomeCountEvaluator-33"><a href="#OutcomeCountEvaluator-33"><span class="linenos"> 33</span></a>
</span><span id="OutcomeCountEvaluator-34"><a href="#OutcomeCountEvaluator-34"><span class="linenos"> 34</span></a><span class="sd">    An example sequence of calls, as far as `next_state()` is concerned, is:</span>
</span><span id="OutcomeCountEvaluator-35"><a href="#OutcomeCountEvaluator-35"><span class="linenos"> 35</span></a>
</span><span id="OutcomeCountEvaluator-36"><a href="#OutcomeCountEvaluator-36"><span class="linenos"> 36</span></a><span class="sd">    1. `state = next_state(state=None, outcome=1, count_of_1s)`</span>
</span><span id="OutcomeCountEvaluator-37"><a href="#OutcomeCountEvaluator-37"><span class="linenos"> 37</span></a><span class="sd">    2. `state = next_state(state, 2, count_of_2s)`</span>
</span><span id="OutcomeCountEvaluator-38"><a href="#OutcomeCountEvaluator-38"><span class="linenos"> 38</span></a><span class="sd">    3. `state = next_state(state, 3, count_of_3s)`</span>
</span><span id="OutcomeCountEvaluator-39"><a href="#OutcomeCountEvaluator-39"><span class="linenos"> 39</span></a><span class="sd">    4. `state = next_state(state, 4, count_of_4s)`</span>
</span><span id="OutcomeCountEvaluator-40"><a href="#OutcomeCountEvaluator-40"><span class="linenos"> 40</span></a><span class="sd">    5. `state = next_state(state, 5, count_of_5s)`</span>
</span><span id="OutcomeCountEvaluator-41"><a href="#OutcomeCountEvaluator-41"><span class="linenos"> 41</span></a><span class="sd">    6. `state = next_state(state, 6, count_of_6s)`</span>
</span><span id="OutcomeCountEvaluator-42"><a href="#OutcomeCountEvaluator-42"><span class="linenos"> 42</span></a><span class="sd">    7. `outcome = final_outcome(state, *generators)`</span>
</span><span id="OutcomeCountEvaluator-43"><a href="#OutcomeCountEvaluator-43"><span class="linenos"> 43</span></a>
</span><span id="OutcomeCountEvaluator-44"><a href="#OutcomeCountEvaluator-44"><span class="linenos"> 44</span></a><span class="sd">    A few other methods can optionally be overridden to further customize behavior.</span>
</span><span id="OutcomeCountEvaluator-45"><a href="#OutcomeCountEvaluator-45"><span class="linenos"> 45</span></a>
</span><span id="OutcomeCountEvaluator-46"><a href="#OutcomeCountEvaluator-46"><span class="linenos"> 46</span></a><span class="sd">    It is not expected that subclasses of `OutcomeCountEvaluator`</span>
</span><span id="OutcomeCountEvaluator-47"><a href="#OutcomeCountEvaluator-47"><span class="linenos"> 47</span></a><span class="sd">    be able to handle arbitrary types or numbers of generators.</span>
</span><span id="OutcomeCountEvaluator-48"><a href="#OutcomeCountEvaluator-48"><span class="linenos"> 48</span></a><span class="sd">    Indeed, most are expected to handle only a fixed number of generators,</span>
</span><span id="OutcomeCountEvaluator-49"><a href="#OutcomeCountEvaluator-49"><span class="linenos"> 49</span></a><span class="sd">    and often even only generators with a particular type of `Die`.</span>
</span><span id="OutcomeCountEvaluator-50"><a href="#OutcomeCountEvaluator-50"><span class="linenos"> 50</span></a>
</span><span id="OutcomeCountEvaluator-51"><a href="#OutcomeCountEvaluator-51"><span class="linenos"> 51</span></a><span class="sd">    Instances cache all intermediate state distributions.</span>
</span><span id="OutcomeCountEvaluator-52"><a href="#OutcomeCountEvaluator-52"><span class="linenos"> 52</span></a><span class="sd">    You should therefore reuse instances when possible.</span>
</span><span id="OutcomeCountEvaluator-53"><a href="#OutcomeCountEvaluator-53"><span class="linenos"> 53</span></a>
</span><span id="OutcomeCountEvaluator-54"><a href="#OutcomeCountEvaluator-54"><span class="linenos"> 54</span></a><span class="sd">    Instances should not be modified after construction</span>
</span><span id="OutcomeCountEvaluator-55"><a href="#OutcomeCountEvaluator-55"><span class="linenos"> 55</span></a><span class="sd">    in any way that affects the return values of these methods.</span>
</span><span id="OutcomeCountEvaluator-56"><a href="#OutcomeCountEvaluator-56"><span class="linenos"> 56</span></a><span class="sd">    Otherwise, values in the cache may be incorrect.</span>
</span><span id="OutcomeCountEvaluator-57"><a href="#OutcomeCountEvaluator-57"><span class="linenos"> 57</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-58"><a href="#OutcomeCountEvaluator-58"><span class="linenos"> 58</span></a>
</span><span id="OutcomeCountEvaluator-59"><a href="#OutcomeCountEvaluator-59"><span class="linenos"> 59</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountEvaluator-60"><a href="#OutcomeCountEvaluator-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-61"><a href="#OutcomeCountEvaluator-61"><span class="linenos"> 61</span></a>        <span class="sd">&quot;&quot;&quot;State transition function.</span>
</span><span id="OutcomeCountEvaluator-62"><a href="#OutcomeCountEvaluator-62"><span class="linenos"> 62</span></a>
</span><span id="OutcomeCountEvaluator-63"><a href="#OutcomeCountEvaluator-63"><span class="linenos"> 63</span></a><span class="sd">        This should produce a state given the previous state, an outcome,</span>
</span><span id="OutcomeCountEvaluator-64"><a href="#OutcomeCountEvaluator-64"><span class="linenos"> 64</span></a><span class="sd">        and the number that outcome produced by each generator.</span>
</span><span id="OutcomeCountEvaluator-65"><a href="#OutcomeCountEvaluator-65"><span class="linenos"> 65</span></a>
</span><span id="OutcomeCountEvaluator-66"><a href="#OutcomeCountEvaluator-66"><span class="linenos"> 66</span></a><span class="sd">        `evaluate()` will always call this using only positional arguments.</span>
</span><span id="OutcomeCountEvaluator-67"><a href="#OutcomeCountEvaluator-67"><span class="linenos"> 67</span></a><span class="sd">        Furthermore, there is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator-68"><a href="#OutcomeCountEvaluator-68"><span class="linenos"> 68</span></a><span class="sd">        an arbitrary number of counts. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator-69"><a href="#OutcomeCountEvaluator-69"><span class="linenos"> 69</span></a><span class="sd">        the parameters in a subclass, or to replace `*counts` with a fixed set</span>
</span><span id="OutcomeCountEvaluator-70"><a href="#OutcomeCountEvaluator-70"><span class="linenos"> 70</span></a><span class="sd">        of parameters.</span>
</span><span id="OutcomeCountEvaluator-71"><a href="#OutcomeCountEvaluator-71"><span class="linenos"> 71</span></a>
</span><span id="OutcomeCountEvaluator-72"><a href="#OutcomeCountEvaluator-72"><span class="linenos"> 72</span></a><span class="sd">        Make sure to handle the base case where `state is None`.</span>
</span><span id="OutcomeCountEvaluator-73"><a href="#OutcomeCountEvaluator-73"><span class="linenos"> 73</span></a>
</span><span id="OutcomeCountEvaluator-74"><a href="#OutcomeCountEvaluator-74"><span class="linenos"> 74</span></a><span class="sd">        States must be hashable. At current, they do not have to be orderable.</span>
</span><span id="OutcomeCountEvaluator-75"><a href="#OutcomeCountEvaluator-75"><span class="linenos"> 75</span></a><span class="sd">        However, this may change in the future, and if they are not totally</span>
</span><span id="OutcomeCountEvaluator-76"><a href="#OutcomeCountEvaluator-76"><span class="linenos"> 76</span></a><span class="sd">        orderable, you must override `final_outcome` to create totally orderable</span>
</span><span id="OutcomeCountEvaluator-77"><a href="#OutcomeCountEvaluator-77"><span class="linenos"> 77</span></a><span class="sd">        final outcomes.</span>
</span><span id="OutcomeCountEvaluator-78"><a href="#OutcomeCountEvaluator-78"><span class="linenos"> 78</span></a>
</span><span id="OutcomeCountEvaluator-79"><a href="#OutcomeCountEvaluator-79"><span class="linenos"> 79</span></a><span class="sd">        The behavior of returning a `Die` from `next_state` is currently</span>
</span><span id="OutcomeCountEvaluator-80"><a href="#OutcomeCountEvaluator-80"><span class="linenos"> 80</span></a><span class="sd">        undefined.</span>
</span><span id="OutcomeCountEvaluator-81"><a href="#OutcomeCountEvaluator-81"><span class="linenos"> 81</span></a>
</span><span id="OutcomeCountEvaluator-82"><a href="#OutcomeCountEvaluator-82"><span class="linenos"> 82</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator-83"><a href="#OutcomeCountEvaluator-83"><span class="linenos"> 83</span></a><span class="sd">            state: A hashable object indicating the state before rolling the</span>
</span><span id="OutcomeCountEvaluator-84"><a href="#OutcomeCountEvaluator-84"><span class="linenos"> 84</span></a><span class="sd">                current outcome. If this is the first outcome being considered,</span>
</span><span id="OutcomeCountEvaluator-85"><a href="#OutcomeCountEvaluator-85"><span class="linenos"> 85</span></a><span class="sd">                `state` will be `None`.</span>
</span><span id="OutcomeCountEvaluator-86"><a href="#OutcomeCountEvaluator-86"><span class="linenos"> 86</span></a><span class="sd">            outcome: The current outcome.</span>
</span><span id="OutcomeCountEvaluator-87"><a href="#OutcomeCountEvaluator-87"><span class="linenos"> 87</span></a><span class="sd">                `next_state` will see all rolled outcomes in monotonic order;</span>
</span><span id="OutcomeCountEvaluator-88"><a href="#OutcomeCountEvaluator-88"><span class="linenos"> 88</span></a><span class="sd">                either ascending or descending depending on `order()`.</span>
</span><span id="OutcomeCountEvaluator-89"><a href="#OutcomeCountEvaluator-89"><span class="linenos"> 89</span></a><span class="sd">                If there are multiple generators, the set of outcomes is the</span>
</span><span id="OutcomeCountEvaluator-90"><a href="#OutcomeCountEvaluator-90"><span class="linenos"> 90</span></a><span class="sd">                union of the outcomes of the invididual generators. All outcomes</span>
</span><span id="OutcomeCountEvaluator-91"><a href="#OutcomeCountEvaluator-91"><span class="linenos"> 91</span></a><span class="sd">                with nonzero count will be seen. Outcomes with zero count</span>
</span><span id="OutcomeCountEvaluator-92"><a href="#OutcomeCountEvaluator-92"><span class="linenos"> 92</span></a><span class="sd">                may or may not be seen. If you need to enforce that certain</span>
</span><span id="OutcomeCountEvaluator-93"><a href="#OutcomeCountEvaluator-93"><span class="linenos"> 93</span></a><span class="sd">                outcomes are seen even if they have zero count, see</span>
</span><span id="OutcomeCountEvaluator-94"><a href="#OutcomeCountEvaluator-94"><span class="linenos"> 94</span></a><span class="sd">                `alignment()`.</span>
</span><span id="OutcomeCountEvaluator-95"><a href="#OutcomeCountEvaluator-95"><span class="linenos"> 95</span></a><span class="sd">            *counts: One value (usually an `int`) for each generator output</span>
</span><span id="OutcomeCountEvaluator-96"><a href="#OutcomeCountEvaluator-96"><span class="linenos"> 96</span></a><span class="sd">                indicating how many of the current outcome were produced.</span>
</span><span id="OutcomeCountEvaluator-97"><a href="#OutcomeCountEvaluator-97"><span class="linenos"> 97</span></a><span class="sd">                All outcomes with nonzero count are guaranteed to be seen.</span>
</span><span id="OutcomeCountEvaluator-98"><a href="#OutcomeCountEvaluator-98"><span class="linenos"> 98</span></a><span class="sd">                To guarantee that outcomes are seen even if they have zero</span>
</span><span id="OutcomeCountEvaluator-99"><a href="#OutcomeCountEvaluator-99"><span class="linenos"> 99</span></a><span class="sd">                count, override `alignment()`.</span>
</span><span id="OutcomeCountEvaluator-100"><a href="#OutcomeCountEvaluator-100"><span class="linenos">100</span></a>
</span><span id="OutcomeCountEvaluator-101"><a href="#OutcomeCountEvaluator-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-102"><a href="#OutcomeCountEvaluator-102"><span class="linenos">102</span></a><span class="sd">            A hashable object indicating the next state.</span>
</span><span id="OutcomeCountEvaluator-103"><a href="#OutcomeCountEvaluator-103"><span class="linenos">103</span></a><span class="sd">            The special value `icepool.Reroll` can be used to immediately remove</span>
</span><span id="OutcomeCountEvaluator-104"><a href="#OutcomeCountEvaluator-104"><span class="linenos">104</span></a><span class="sd">            the state from consideration, effectively performing a full reroll.</span>
</span><span id="OutcomeCountEvaluator-105"><a href="#OutcomeCountEvaluator-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-106"><a href="#OutcomeCountEvaluator-106"><span class="linenos">106</span></a>
</span><span id="OutcomeCountEvaluator-107"><a href="#OutcomeCountEvaluator-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-108"><a href="#OutcomeCountEvaluator-108"><span class="linenos">108</span></a>                      <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-109"><a href="#OutcomeCountEvaluator-109"><span class="linenos">109</span></a>        <span class="sd">&quot;&quot;&quot;Optional function to generate a final outcome from a final state.</span>
</span><span id="OutcomeCountEvaluator-110"><a href="#OutcomeCountEvaluator-110"><span class="linenos">110</span></a>
</span><span id="OutcomeCountEvaluator-111"><a href="#OutcomeCountEvaluator-111"><span class="linenos">111</span></a><span class="sd">        Tthere is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator-112"><a href="#OutcomeCountEvaluator-112"><span class="linenos">112</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator-113"><a href="#OutcomeCountEvaluator-113"><span class="linenos">113</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator-114"><a href="#OutcomeCountEvaluator-114"><span class="linenos">114</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator-115"><a href="#OutcomeCountEvaluator-115"><span class="linenos">115</span></a>
</span><span id="OutcomeCountEvaluator-116"><a href="#OutcomeCountEvaluator-116"><span class="linenos">116</span></a><span class="sd">        By default, the final outcome is equal to the final state.</span>
</span><span id="OutcomeCountEvaluator-117"><a href="#OutcomeCountEvaluator-117"><span class="linenos">117</span></a><span class="sd">        Note that `None` is not a valid outcome for a `Die`,</span>
</span><span id="OutcomeCountEvaluator-118"><a href="#OutcomeCountEvaluator-118"><span class="linenos">118</span></a><span class="sd">        and if there are no outcomes, the final state will be `None`.</span>
</span><span id="OutcomeCountEvaluator-119"><a href="#OutcomeCountEvaluator-119"><span class="linenos">119</span></a><span class="sd">        Subclasses that want to handle this case should explicitly define what</span>
</span><span id="OutcomeCountEvaluator-120"><a href="#OutcomeCountEvaluator-120"><span class="linenos">120</span></a><span class="sd">        happens.</span>
</span><span id="OutcomeCountEvaluator-121"><a href="#OutcomeCountEvaluator-121"><span class="linenos">121</span></a>
</span><span id="OutcomeCountEvaluator-122"><a href="#OutcomeCountEvaluator-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator-123"><a href="#OutcomeCountEvaluator-123"><span class="linenos">123</span></a><span class="sd">            final_state: A state after all outcomes have been processed.</span>
</span><span id="OutcomeCountEvaluator-124"><a href="#OutcomeCountEvaluator-124"><span class="linenos">124</span></a><span class="sd">            *generators: One or more `OutcomeCountGenerator`s being evaluated.</span>
</span><span id="OutcomeCountEvaluator-125"><a href="#OutcomeCountEvaluator-125"><span class="linenos">125</span></a><span class="sd">                Most subclasses will expect a fixed number of generators and</span>
</span><span id="OutcomeCountEvaluator-126"><a href="#OutcomeCountEvaluator-126"><span class="linenos">126</span></a><span class="sd">                can replace this variadic parameter with a fixed number of named</span>
</span><span id="OutcomeCountEvaluator-127"><a href="#OutcomeCountEvaluator-127"><span class="linenos">127</span></a><span class="sd">                parameters.</span>
</span><span id="OutcomeCountEvaluator-128"><a href="#OutcomeCountEvaluator-128"><span class="linenos">128</span></a>
</span><span id="OutcomeCountEvaluator-129"><a href="#OutcomeCountEvaluator-129"><span class="linenos">129</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-130"><a href="#OutcomeCountEvaluator-130"><span class="linenos">130</span></a><span class="sd">            A final outcome that will be used as part of constructing the result `Die`.</span>
</span><span id="OutcomeCountEvaluator-131"><a href="#OutcomeCountEvaluator-131"><span class="linenos">131</span></a><span class="sd">            As usual for `Die()`, this could itself be a `Die` or `icepool.Reroll`.</span>
</span><span id="OutcomeCountEvaluator-132"><a href="#OutcomeCountEvaluator-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-133"><a href="#OutcomeCountEvaluator-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">final_state</span>
</span><span id="OutcomeCountEvaluator-134"><a href="#OutcomeCountEvaluator-134"><span class="linenos">134</span></a>
</span><span id="OutcomeCountEvaluator-135"><a href="#OutcomeCountEvaluator-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-136"><a href="#OutcomeCountEvaluator-136"><span class="linenos">136</span></a>        <span class="sd">&quot;&quot;&quot;Optional function to determine the order in which `next_state()` will see outcomes.</span>
</span><span id="OutcomeCountEvaluator-137"><a href="#OutcomeCountEvaluator-137"><span class="linenos">137</span></a>
</span><span id="OutcomeCountEvaluator-138"><a href="#OutcomeCountEvaluator-138"><span class="linenos">138</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator-139"><a href="#OutcomeCountEvaluator-139"><span class="linenos">139</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator-140"><a href="#OutcomeCountEvaluator-140"><span class="linenos">140</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator-141"><a href="#OutcomeCountEvaluator-141"><span class="linenos">141</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator-142"><a href="#OutcomeCountEvaluator-142"><span class="linenos">142</span></a>
</span><span id="OutcomeCountEvaluator-143"><a href="#OutcomeCountEvaluator-143"><span class="linenos">143</span></a><span class="sd">        The default is ascending order. This works well with mixed standard dice,</span>
</span><span id="OutcomeCountEvaluator-144"><a href="#OutcomeCountEvaluator-144"><span class="linenos">144</span></a><span class="sd">        and other dice that differ only by right-truncation.</span>
</span><span id="OutcomeCountEvaluator-145"><a href="#OutcomeCountEvaluator-145"><span class="linenos">145</span></a>
</span><span id="OutcomeCountEvaluator-146"><a href="#OutcomeCountEvaluator-146"><span class="linenos">146</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator-147"><a href="#OutcomeCountEvaluator-147"><span class="linenos">147</span></a><span class="sd">            *generators: One or more `OutcomeCountGenerator`s being evaluated.</span>
</span><span id="OutcomeCountEvaluator-148"><a href="#OutcomeCountEvaluator-148"><span class="linenos">148</span></a><span class="sd">                Most subclasses will expect a fixed number of generators and</span>
</span><span id="OutcomeCountEvaluator-149"><a href="#OutcomeCountEvaluator-149"><span class="linenos">149</span></a><span class="sd">                can replace this variadic parameter with a fixed number of named</span>
</span><span id="OutcomeCountEvaluator-150"><a href="#OutcomeCountEvaluator-150"><span class="linenos">150</span></a><span class="sd">                parameters.</span>
</span><span id="OutcomeCountEvaluator-151"><a href="#OutcomeCountEvaluator-151"><span class="linenos">151</span></a>
</span><span id="OutcomeCountEvaluator-152"><a href="#OutcomeCountEvaluator-152"><span class="linenos">152</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-153"><a href="#OutcomeCountEvaluator-153"><span class="linenos">153</span></a><span class="sd">            * Order.Ascending (= 1)</span>
</span><span id="OutcomeCountEvaluator-154"><a href="#OutcomeCountEvaluator-154"><span class="linenos">154</span></a><span class="sd">                if `next_state()` should always see the outcomes in ascending order.</span>
</span><span id="OutcomeCountEvaluator-155"><a href="#OutcomeCountEvaluator-155"><span class="linenos">155</span></a><span class="sd">            * Order.Descending (= -1)</span>
</span><span id="OutcomeCountEvaluator-156"><a href="#OutcomeCountEvaluator-156"><span class="linenos">156</span></a><span class="sd">                if `next_state()` should always see the outcomes in descending order.</span>
</span><span id="OutcomeCountEvaluator-157"><a href="#OutcomeCountEvaluator-157"><span class="linenos">157</span></a><span class="sd">            * Order.Any (= 0)</span>
</span><span id="OutcomeCountEvaluator-158"><a href="#OutcomeCountEvaluator-158"><span class="linenos">158</span></a><span class="sd">                if the result of the evaluation is order-independent.</span>
</span><span id="OutcomeCountEvaluator-159"><a href="#OutcomeCountEvaluator-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-160"><a href="#OutcomeCountEvaluator-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="OutcomeCountEvaluator-161"><a href="#OutcomeCountEvaluator-161"><span class="linenos">161</span></a>
</span><span id="OutcomeCountEvaluator-162"><a href="#OutcomeCountEvaluator-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-163"><a href="#OutcomeCountEvaluator-163"><span class="linenos">163</span></a>                  <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-164"><a href="#OutcomeCountEvaluator-164"><span class="linenos">164</span></a>        <span class="sd">&quot;&quot;&quot;Optional method to specify an collection of outcomes that should always be given to `next_state()` even if they have zero count.</span>
</span><span id="OutcomeCountEvaluator-165"><a href="#OutcomeCountEvaluator-165"><span class="linenos">165</span></a>
</span><span id="OutcomeCountEvaluator-166"><a href="#OutcomeCountEvaluator-166"><span class="linenos">166</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator-167"><a href="#OutcomeCountEvaluator-167"><span class="linenos">167</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator-168"><a href="#OutcomeCountEvaluator-168"><span class="linenos">168</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator-169"><a href="#OutcomeCountEvaluator-169"><span class="linenos">169</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator-170"><a href="#OutcomeCountEvaluator-170"><span class="linenos">170</span></a>
</span><span id="OutcomeCountEvaluator-171"><a href="#OutcomeCountEvaluator-171"><span class="linenos">171</span></a><span class="sd">        The default implementation returns `()`; this means outcomes with zero</span>
</span><span id="OutcomeCountEvaluator-172"><a href="#OutcomeCountEvaluator-172"><span class="linenos">172</span></a><span class="sd">        count may or may not be seen by `next_state`.</span>
</span><span id="OutcomeCountEvaluator-173"><a href="#OutcomeCountEvaluator-173"><span class="linenos">173</span></a>
</span><span id="OutcomeCountEvaluator-174"><a href="#OutcomeCountEvaluator-174"><span class="linenos">174</span></a><span class="sd">        If you want the outcomes seen by `next_state` to be consecutive</span>
</span><span id="OutcomeCountEvaluator-175"><a href="#OutcomeCountEvaluator-175"><span class="linenos">175</span></a><span class="sd">        `int`s, you can set `alignment = icepool.OutcomeCountEvaluator.range_alignment`.</span>
</span><span id="OutcomeCountEvaluator-176"><a href="#OutcomeCountEvaluator-176"><span class="linenos">176</span></a><span class="sd">        See `range_alignment()` below.</span>
</span><span id="OutcomeCountEvaluator-177"><a href="#OutcomeCountEvaluator-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-178"><a href="#OutcomeCountEvaluator-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="p">()</span>
</span><span id="OutcomeCountEvaluator-179"><a href="#OutcomeCountEvaluator-179"><span class="linenos">179</span></a>
</span><span id="OutcomeCountEvaluator-180"><a href="#OutcomeCountEvaluator-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">range_alignment</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-181"><a href="#OutcomeCountEvaluator-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-182"><a href="#OutcomeCountEvaluator-182"><span class="linenos">182</span></a>            <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="OutcomeCountEvaluator-183"><a href="#OutcomeCountEvaluator-183"><span class="linenos">183</span></a>        <span class="sd">&quot;&quot;&quot;Example implementation of `alignment()` that produces consecutive `int` outcomes.</span>
</span><span id="OutcomeCountEvaluator-184"><a href="#OutcomeCountEvaluator-184"><span class="linenos">184</span></a>
</span><span id="OutcomeCountEvaluator-185"><a href="#OutcomeCountEvaluator-185"><span class="linenos">185</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator-186"><a href="#OutcomeCountEvaluator-186"><span class="linenos">186</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator-187"><a href="#OutcomeCountEvaluator-187"><span class="linenos">187</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator-188"><a href="#OutcomeCountEvaluator-188"><span class="linenos">188</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator-189"><a href="#OutcomeCountEvaluator-189"><span class="linenos">189</span></a>
</span><span id="OutcomeCountEvaluator-190"><a href="#OutcomeCountEvaluator-190"><span class="linenos">190</span></a><span class="sd">        Set `alignment = icepool.OutcomeCountEvaluator.range_alignment` to use this.</span>
</span><span id="OutcomeCountEvaluator-191"><a href="#OutcomeCountEvaluator-191"><span class="linenos">191</span></a>
</span><span id="OutcomeCountEvaluator-192"><a href="#OutcomeCountEvaluator-192"><span class="linenos">192</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-193"><a href="#OutcomeCountEvaluator-193"><span class="linenos">193</span></a><span class="sd">            All `int`s from the min outcome to the max outcome among the generators,</span>
</span><span id="OutcomeCountEvaluator-194"><a href="#OutcomeCountEvaluator-194"><span class="linenos">194</span></a><span class="sd">            inclusive.</span>
</span><span id="OutcomeCountEvaluator-195"><a href="#OutcomeCountEvaluator-195"><span class="linenos">195</span></a>
</span><span id="OutcomeCountEvaluator-196"><a href="#OutcomeCountEvaluator-196"><span class="linenos">196</span></a><span class="sd">        Raises:</span>
</span><span id="OutcomeCountEvaluator-197"><a href="#OutcomeCountEvaluator-197"><span class="linenos">197</span></a><span class="sd">            TypeError: if any generator has any non-`int` outcome.</span>
</span><span id="OutcomeCountEvaluator-198"><a href="#OutcomeCountEvaluator-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-199"><a href="#OutcomeCountEvaluator-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-200"><a href="#OutcomeCountEvaluator-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="p">()</span>
</span><span id="OutcomeCountEvaluator-201"><a href="#OutcomeCountEvaluator-201"><span class="linenos">201</span></a>
</span><span id="OutcomeCountEvaluator-202"><a href="#OutcomeCountEvaluator-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-203"><a href="#OutcomeCountEvaluator-203"><span class="linenos">203</span></a>                <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-204"><a href="#OutcomeCountEvaluator-204"><span class="linenos">204</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="OutcomeCountEvaluator-205"><a href="#OutcomeCountEvaluator-205"><span class="linenos">205</span></a>                <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator-206"><a href="#OutcomeCountEvaluator-206"><span class="linenos">206</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-207"><a href="#OutcomeCountEvaluator-207"><span class="linenos">207</span></a>                <span class="s2">&quot;range_alignment cannot be used with outcomes of type other than &#39;int&#39;.&quot;</span>
</span><span id="OutcomeCountEvaluator-208"><a href="#OutcomeCountEvaluator-208"><span class="linenos">208</span></a>            <span class="p">)</span>
</span><span id="OutcomeCountEvaluator-209"><a href="#OutcomeCountEvaluator-209"><span class="linenos">209</span></a>
</span><span id="OutcomeCountEvaluator-210"><a href="#OutcomeCountEvaluator-210"><span class="linenos">210</span></a>        <span class="n">min_outcome</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-211"><a href="#OutcomeCountEvaluator-211"><span class="linenos">211</span></a>        <span class="n">max_outcome</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-212"><a href="#OutcomeCountEvaluator-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-213"><a href="#OutcomeCountEvaluator-213"><span class="linenos">213</span></a>
</span><span id="OutcomeCountEvaluator-214"><a href="#OutcomeCountEvaluator-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">final_kwargs</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-215"><a href="#OutcomeCountEvaluator-215"><span class="linenos">215</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-216"><a href="#OutcomeCountEvaluator-216"><span class="linenos">216</span></a>            <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="OutcomeCountEvaluator-217"><a href="#OutcomeCountEvaluator-217"><span class="linenos">217</span></a>        <span class="sd">&quot;&quot;&quot;Optional method to specify any extra keyword arguments to the final die constructor.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-218"><a href="#OutcomeCountEvaluator-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="OutcomeCountEvaluator-219"><a href="#OutcomeCountEvaluator-219"><span class="linenos">219</span></a>
</span><span id="OutcomeCountEvaluator-220"><a href="#OutcomeCountEvaluator-220"><span class="linenos">220</span></a>    <span class="nd">@cached_property</span>
</span><span id="OutcomeCountEvaluator-221"><a href="#OutcomeCountEvaluator-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
</span><span id="OutcomeCountEvaluator-222"><a href="#OutcomeCountEvaluator-222"><span class="linenos">222</span></a>        <span class="sd">&quot;&quot;&quot;A cache of (order, generators) -&gt; weight distribution over states. &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-223"><a href="#OutcomeCountEvaluator-223"><span class="linenos">223</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="OutcomeCountEvaluator-224"><a href="#OutcomeCountEvaluator-224"><span class="linenos">224</span></a>
</span><span id="OutcomeCountEvaluator-225"><a href="#OutcomeCountEvaluator-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-226"><a href="#OutcomeCountEvaluator-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span>
</span><span id="OutcomeCountEvaluator-227"><a href="#OutcomeCountEvaluator-227"><span class="linenos">227</span></a>        <span class="n">Sequence</span>
</span><span id="OutcomeCountEvaluator-228"><a href="#OutcomeCountEvaluator-228"><span class="linenos">228</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-229"><a href="#OutcomeCountEvaluator-229"><span class="linenos">229</span></a>        <span class="sd">&quot;&quot;&quot;Evaluates generator(s).</span>
</span><span id="OutcomeCountEvaluator-230"><a href="#OutcomeCountEvaluator-230"><span class="linenos">230</span></a>
</span><span id="OutcomeCountEvaluator-231"><a href="#OutcomeCountEvaluator-231"><span class="linenos">231</span></a><span class="sd">        You can call the `OutcomeCountEvaluator` object directly for the same effect,</span>
</span><span id="OutcomeCountEvaluator-232"><a href="#OutcomeCountEvaluator-232"><span class="linenos">232</span></a><span class="sd">        e.g. `sum_evaluator(generator)` is an alias for `sum_evaluator.evaluate(generator)`.</span>
</span><span id="OutcomeCountEvaluator-233"><a href="#OutcomeCountEvaluator-233"><span class="linenos">233</span></a>
</span><span id="OutcomeCountEvaluator-234"><a href="#OutcomeCountEvaluator-234"><span class="linenos">234</span></a><span class="sd">        Most evaluators will expect a fixed number of generators.</span>
</span><span id="OutcomeCountEvaluator-235"><a href="#OutcomeCountEvaluator-235"><span class="linenos">235</span></a><span class="sd">        The union of the outcomes of the generator(s) must be totally orderable.</span>
</span><span id="OutcomeCountEvaluator-236"><a href="#OutcomeCountEvaluator-236"><span class="linenos">236</span></a>
</span><span id="OutcomeCountEvaluator-237"><a href="#OutcomeCountEvaluator-237"><span class="linenos">237</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator-238"><a href="#OutcomeCountEvaluator-238"><span class="linenos">238</span></a><span class="sd">            *generators: Each element may be one of the following:</span>
</span><span id="OutcomeCountEvaluator-239"><a href="#OutcomeCountEvaluator-239"><span class="linenos">239</span></a><span class="sd">                * A `OutcomeCountGenerator`.</span>
</span><span id="OutcomeCountEvaluator-240"><a href="#OutcomeCountEvaluator-240"><span class="linenos">240</span></a><span class="sd">                * A mappable mapping dice to the number of those dice.</span>
</span><span id="OutcomeCountEvaluator-241"><a href="#OutcomeCountEvaluator-241"><span class="linenos">241</span></a><span class="sd">                * A sequence of arguments to create a `Pool`.</span>
</span><span id="OutcomeCountEvaluator-242"><a href="#OutcomeCountEvaluator-242"><span class="linenos">242</span></a>
</span><span id="OutcomeCountEvaluator-243"><a href="#OutcomeCountEvaluator-243"><span class="linenos">243</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-244"><a href="#OutcomeCountEvaluator-244"><span class="linenos">244</span></a><span class="sd">            A `Die` representing the distribution of the final score.</span>
</span><span id="OutcomeCountEvaluator-245"><a href="#OutcomeCountEvaluator-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-246"><a href="#OutcomeCountEvaluator-246"><span class="linenos">246</span></a>
</span><span id="OutcomeCountEvaluator-247"><a href="#OutcomeCountEvaluator-247"><span class="linenos">247</span></a>        <span class="c1"># Convert non-`Pool` arguments to `Pool`.</span>
</span><span id="OutcomeCountEvaluator-248"><a href="#OutcomeCountEvaluator-248"><span class="linenos">248</span></a>        <span class="n">converted_generators</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-249"><a href="#OutcomeCountEvaluator-249"><span class="linenos">249</span></a>            <span class="n">generator</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span>
</span><span id="OutcomeCountEvaluator-250"><a href="#OutcomeCountEvaluator-250"><span class="linenos">250</span></a>                                   <span class="p">)</span> <span class="k">else</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-251"><a href="#OutcomeCountEvaluator-251"><span class="linenos">251</span></a>            <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-252"><a href="#OutcomeCountEvaluator-252"><span class="linenos">252</span></a>
</span><span id="OutcomeCountEvaluator-253"><a href="#OutcomeCountEvaluator-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">_is_resolvable</span><span class="p">()</span>
</span><span id="OutcomeCountEvaluator-254"><a href="#OutcomeCountEvaluator-254"><span class="linenos">254</span></a>                   <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">converted_generators</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator-255"><a href="#OutcomeCountEvaluator-255"><span class="linenos">255</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([])</span>
</span><span id="OutcomeCountEvaluator-256"><a href="#OutcomeCountEvaluator-256"><span class="linenos">256</span></a>
</span><span id="OutcomeCountEvaluator-257"><a href="#OutcomeCountEvaluator-257"><span class="linenos">257</span></a>        <span class="n">algorithm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_algorithm</span><span class="p">(</span><span class="o">*</span><span class="n">converted_generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-258"><a href="#OutcomeCountEvaluator-258"><span class="linenos">258</span></a>
</span><span id="OutcomeCountEvaluator-259"><a href="#OutcomeCountEvaluator-259"><span class="linenos">259</span></a>        <span class="c1"># We use a separate class to guarantee all outcomes are visited.</span>
</span><span id="OutcomeCountEvaluator-260"><a href="#OutcomeCountEvaluator-260"><span class="linenos">260</span></a>        <span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">converted_generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-261"><a href="#OutcomeCountEvaluator-261"><span class="linenos">261</span></a>
</span><span id="OutcomeCountEvaluator-262"><a href="#OutcomeCountEvaluator-262"><span class="linenos">262</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">converted_generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-263"><a href="#OutcomeCountEvaluator-263"><span class="linenos">263</span></a>
</span><span id="OutcomeCountEvaluator-264"><a href="#OutcomeCountEvaluator-264"><span class="linenos">264</span></a>        <span class="n">final_outcomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="OutcomeCountEvaluator-265"><a href="#OutcomeCountEvaluator-265"><span class="linenos">265</span></a>        <span class="n">final_weights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="OutcomeCountEvaluator-266"><a href="#OutcomeCountEvaluator-266"><span class="linenos">266</span></a>        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator-267"><a href="#OutcomeCountEvaluator-267"><span class="linenos">267</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">*</span><span class="n">converted_generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-268"><a href="#OutcomeCountEvaluator-268"><span class="linenos">268</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-269"><a href="#OutcomeCountEvaluator-269"><span class="linenos">269</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-270"><a href="#OutcomeCountEvaluator-270"><span class="linenos">270</span></a>                    <span class="s2">&quot;None is not a valid final outcome. &quot;</span>
</span><span id="OutcomeCountEvaluator-271"><a href="#OutcomeCountEvaluator-271"><span class="linenos">271</span></a>                    <span class="s2">&quot;This may have resulted from supplying an empty generator to OutcomeCountEvaluator. &quot;</span>
</span><span id="OutcomeCountEvaluator-272"><a href="#OutcomeCountEvaluator-272"><span class="linenos">272</span></a>                    <span class="s2">&quot;If so, refrain from using empty generators, or override OutcomeCountEvaluator.final_outcome() to handle this case.&quot;</span>
</span><span id="OutcomeCountEvaluator-273"><a href="#OutcomeCountEvaluator-273"><span class="linenos">273</span></a>                <span class="p">)</span>
</span><span id="OutcomeCountEvaluator-274"><a href="#OutcomeCountEvaluator-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-275"><a href="#OutcomeCountEvaluator-275"><span class="linenos">275</span></a>                <span class="n">final_outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-276"><a href="#OutcomeCountEvaluator-276"><span class="linenos">276</span></a>                <span class="n">final_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-277"><a href="#OutcomeCountEvaluator-277"><span class="linenos">277</span></a>
</span><span id="OutcomeCountEvaluator-278"><a href="#OutcomeCountEvaluator-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">final_outcomes</span><span class="p">,</span> <span class="n">final_weights</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-279"><a href="#OutcomeCountEvaluator-279"><span class="linenos">279</span></a>                           <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">final_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">converted_generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-280"><a href="#OutcomeCountEvaluator-280"><span class="linenos">280</span></a>
</span><span id="OutcomeCountEvaluator-281"><a href="#OutcomeCountEvaluator-281"><span class="linenos">281</span></a>    <span class="fm">__call__</span> <span class="o">=</span> <span class="n">evaluate</span>
</span><span id="OutcomeCountEvaluator-282"><a href="#OutcomeCountEvaluator-282"><span class="linenos">282</span></a>
</span><span id="OutcomeCountEvaluator-283"><a href="#OutcomeCountEvaluator-283"><span class="linenos">283</span></a>    <span class="k">def</span> <span class="nf">_select_algorithm</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-284"><a href="#OutcomeCountEvaluator-284"><span class="linenos">284</span></a>            <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span>
</span><span id="OutcomeCountEvaluator-285"><a href="#OutcomeCountEvaluator-285"><span class="linenos">285</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Order</span><span class="p">]:</span>
</span><span id="OutcomeCountEvaluator-286"><a href="#OutcomeCountEvaluator-286"><span class="linenos">286</span></a>        <span class="sd">&quot;&quot;&quot;Selects an algorithm and iteration order.</span>
</span><span id="OutcomeCountEvaluator-287"><a href="#OutcomeCountEvaluator-287"><span class="linenos">287</span></a>
</span><span id="OutcomeCountEvaluator-288"><a href="#OutcomeCountEvaluator-288"><span class="linenos">288</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-289"><a href="#OutcomeCountEvaluator-289"><span class="linenos">289</span></a><span class="sd">            * The algorithm to use (`_eval_internal*`).</span>
</span><span id="OutcomeCountEvaluator-290"><a href="#OutcomeCountEvaluator-290"><span class="linenos">290</span></a><span class="sd">            * The order in which `next_state()` sees outcomes.</span>
</span><span id="OutcomeCountEvaluator-291"><a href="#OutcomeCountEvaluator-291"><span class="linenos">291</span></a><span class="sd">                1 for ascending and -1 for descending.</span>
</span><span id="OutcomeCountEvaluator-292"><a href="#OutcomeCountEvaluator-292"><span class="linenos">292</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-293"><a href="#OutcomeCountEvaluator-293"><span class="linenos">293</span></a>        <span class="n">eval_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-294"><a href="#OutcomeCountEvaluator-294"><span class="linenos">294</span></a>
</span><span id="OutcomeCountEvaluator-295"><a href="#OutcomeCountEvaluator-295"><span class="linenos">295</span></a>        <span class="n">pop_min_costs</span><span class="p">,</span> <span class="n">pop_max_costs</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-296"><a href="#OutcomeCountEvaluator-296"><span class="linenos">296</span></a>            <span class="o">*</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">_estimate_order_costs</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-297"><a href="#OutcomeCountEvaluator-297"><span class="linenos">297</span></a>
</span><span id="OutcomeCountEvaluator-298"><a href="#OutcomeCountEvaluator-298"><span class="linenos">298</span></a>        <span class="n">pop_min_cost</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">pop_min_costs</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-299"><a href="#OutcomeCountEvaluator-299"><span class="linenos">299</span></a>        <span class="n">pop_max_cost</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">pop_max_costs</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-300"><a href="#OutcomeCountEvaluator-300"><span class="linenos">300</span></a>
</span><span id="OutcomeCountEvaluator-301"><a href="#OutcomeCountEvaluator-301"><span class="linenos">301</span></a>        <span class="c1"># No preferred order case: go directly with cost.</span>
</span><span id="OutcomeCountEvaluator-302"><a href="#OutcomeCountEvaluator-302"><span class="linenos">302</span></a>        <span class="k">if</span> <span class="n">eval_order</span> <span class="o">==</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-303"><a href="#OutcomeCountEvaluator-303"><span class="linenos">303</span></a>            <span class="k">if</span> <span class="n">pop_max_cost</span> <span class="o">&lt;=</span> <span class="n">pop_min_cost</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-304"><a href="#OutcomeCountEvaluator-304"><span class="linenos">304</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">,</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="OutcomeCountEvaluator-305"><a href="#OutcomeCountEvaluator-305"><span class="linenos">305</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-306"><a href="#OutcomeCountEvaluator-306"><span class="linenos">306</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">,</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span>
</span><span id="OutcomeCountEvaluator-307"><a href="#OutcomeCountEvaluator-307"><span class="linenos">307</span></a>
</span><span id="OutcomeCountEvaluator-308"><a href="#OutcomeCountEvaluator-308"><span class="linenos">308</span></a>        <span class="c1"># Preferred order case.</span>
</span><span id="OutcomeCountEvaluator-309"><a href="#OutcomeCountEvaluator-309"><span class="linenos">309</span></a>        <span class="c1"># Go with the preferred order unless there is a &quot;significant&quot;</span>
</span><span id="OutcomeCountEvaluator-310"><a href="#OutcomeCountEvaluator-310"><span class="linenos">310</span></a>        <span class="c1"># cost factor.</span>
</span><span id="OutcomeCountEvaluator-311"><a href="#OutcomeCountEvaluator-311"><span class="linenos">311</span></a>
</span><span id="OutcomeCountEvaluator-312"><a href="#OutcomeCountEvaluator-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">PREFERRED_ORDER_COST_FACTOR</span> <span class="o">*</span> <span class="n">pop_max_cost</span> <span class="o">&lt;</span> <span class="n">pop_min_cost</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-313"><a href="#OutcomeCountEvaluator-313"><span class="linenos">313</span></a>            <span class="n">cost_order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="OutcomeCountEvaluator-314"><a href="#OutcomeCountEvaluator-314"><span class="linenos">314</span></a>        <span class="k">elif</span> <span class="n">PREFERRED_ORDER_COST_FACTOR</span> <span class="o">*</span> <span class="n">pop_min_cost</span> <span class="o">&lt;</span> <span class="n">pop_max_cost</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-315"><a href="#OutcomeCountEvaluator-315"><span class="linenos">315</span></a>            <span class="n">cost_order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span>
</span><span id="OutcomeCountEvaluator-316"><a href="#OutcomeCountEvaluator-316"><span class="linenos">316</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-317"><a href="#OutcomeCountEvaluator-317"><span class="linenos">317</span></a>            <span class="n">cost_order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span><span id="OutcomeCountEvaluator-318"><a href="#OutcomeCountEvaluator-318"><span class="linenos">318</span></a>
</span><span id="OutcomeCountEvaluator-319"><a href="#OutcomeCountEvaluator-319"><span class="linenos">319</span></a>        <span class="k">if</span> <span class="n">cost_order</span> <span class="o">==</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span> <span class="ow">or</span> <span class="n">eval_order</span> <span class="o">==</span> <span class="n">cost_order</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-320"><a href="#OutcomeCountEvaluator-320"><span class="linenos">320</span></a>            <span class="c1"># Use the preferred algorithm.</span>
</span><span id="OutcomeCountEvaluator-321"><a href="#OutcomeCountEvaluator-321"><span class="linenos">321</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">,</span> <span class="n">eval_order</span>
</span><span id="OutcomeCountEvaluator-322"><a href="#OutcomeCountEvaluator-322"><span class="linenos">322</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-323"><a href="#OutcomeCountEvaluator-323"><span class="linenos">323</span></a>            <span class="c1"># Use the less-preferred algorithm.</span>
</span><span id="OutcomeCountEvaluator-324"><a href="#OutcomeCountEvaluator-324"><span class="linenos">324</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal_iterative</span><span class="p">,</span> <span class="n">eval_order</span>
</span><span id="OutcomeCountEvaluator-325"><a href="#OutcomeCountEvaluator-325"><span class="linenos">325</span></a>
</span><span id="OutcomeCountEvaluator-326"><a href="#OutcomeCountEvaluator-326"><span class="linenos">326</span></a>    <span class="k">def</span> <span class="nf">_eval_internal</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-327"><a href="#OutcomeCountEvaluator-327"><span class="linenos">327</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">alignment</span><span class="p">:</span> <span class="n">Alignment</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-328"><a href="#OutcomeCountEvaluator-328"><span class="linenos">328</span></a>        <span class="n">generators</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-329"><a href="#OutcomeCountEvaluator-329"><span class="linenos">329</span></a>                          <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="OutcomeCountEvaluator-330"><a href="#OutcomeCountEvaluator-330"><span class="linenos">330</span></a>        <span class="sd">&quot;&quot;&quot;Internal algorithm for iterating in the more-preferred order,</span>
</span><span id="OutcomeCountEvaluator-331"><a href="#OutcomeCountEvaluator-331"><span class="linenos">331</span></a><span class="sd">        i.e. giving outcomes to `next_state()` from wide to narrow.</span>
</span><span id="OutcomeCountEvaluator-332"><a href="#OutcomeCountEvaluator-332"><span class="linenos">332</span></a>
</span><span id="OutcomeCountEvaluator-333"><a href="#OutcomeCountEvaluator-333"><span class="linenos">333</span></a><span class="sd">        All intermediate return values are cached in the instance.</span>
</span><span id="OutcomeCountEvaluator-334"><a href="#OutcomeCountEvaluator-334"><span class="linenos">334</span></a>
</span><span id="OutcomeCountEvaluator-335"><a href="#OutcomeCountEvaluator-335"><span class="linenos">335</span></a><span class="sd">        Arguments:</span>
</span><span id="OutcomeCountEvaluator-336"><a href="#OutcomeCountEvaluator-336"><span class="linenos">336</span></a><span class="sd">            order: The order in which to send outcomes to `next_state()`.</span>
</span><span id="OutcomeCountEvaluator-337"><a href="#OutcomeCountEvaluator-337"><span class="linenos">337</span></a><span class="sd">            alignment: As `alignment()`. Elements will be popped off this</span>
</span><span id="OutcomeCountEvaluator-338"><a href="#OutcomeCountEvaluator-338"><span class="linenos">338</span></a><span class="sd">                during recursion.</span>
</span><span id="OutcomeCountEvaluator-339"><a href="#OutcomeCountEvaluator-339"><span class="linenos">339</span></a><span class="sd">            generators: One or more `OutcomeCountGenerators`s to evaluate. Elements</span>
</span><span id="OutcomeCountEvaluator-340"><a href="#OutcomeCountEvaluator-340"><span class="linenos">340</span></a><span class="sd">                will be popped off this during recursion.</span>
</span><span id="OutcomeCountEvaluator-341"><a href="#OutcomeCountEvaluator-341"><span class="linenos">341</span></a>
</span><span id="OutcomeCountEvaluator-342"><a href="#OutcomeCountEvaluator-342"><span class="linenos">342</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-343"><a href="#OutcomeCountEvaluator-343"><span class="linenos">343</span></a><span class="sd">            A dict `{ state : weight }` describing the probability distribution</span>
</span><span id="OutcomeCountEvaluator-344"><a href="#OutcomeCountEvaluator-344"><span class="linenos">344</span></a><span class="sd">                over states.</span>
</span><span id="OutcomeCountEvaluator-345"><a href="#OutcomeCountEvaluator-345"><span class="linenos">345</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-346"><a href="#OutcomeCountEvaluator-346"><span class="linenos">346</span></a>        <span class="n">cache_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-347"><a href="#OutcomeCountEvaluator-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-348"><a href="#OutcomeCountEvaluator-348"><span class="linenos">348</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
</span><span id="OutcomeCountEvaluator-349"><a href="#OutcomeCountEvaluator-349"><span class="linenos">349</span></a>
</span><span id="OutcomeCountEvaluator-350"><a href="#OutcomeCountEvaluator-350"><span class="linenos">350</span></a>        <span class="n">result</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-351"><a href="#OutcomeCountEvaluator-351"><span class="linenos">351</span></a>
</span><span id="OutcomeCountEvaluator-352"><a href="#OutcomeCountEvaluator-352"><span class="linenos">352</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="OutcomeCountEvaluator-353"><a href="#OutcomeCountEvaluator-353"><span class="linenos">353</span></a>               <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">alignment</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator-354"><a href="#OutcomeCountEvaluator-354"><span class="linenos">354</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="OutcomeCountEvaluator-355"><a href="#OutcomeCountEvaluator-355"><span class="linenos">355</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-356"><a href="#OutcomeCountEvaluator-356"><span class="linenos">356</span></a>            <span class="n">outcome</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span> <span class="n">iterators</span> <span class="o">=</span> <span class="n">OutcomeCountEvaluator</span><span class="o">.</span><span class="n">_pop_generators</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-357"><a href="#OutcomeCountEvaluator-357"><span class="linenos">357</span></a>                <span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-358"><a href="#OutcomeCountEvaluator-358"><span class="linenos">358</span></a>            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator-359"><a href="#OutcomeCountEvaluator-359"><span class="linenos">359</span></a>                <span class="n">prev_generators</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-360"><a href="#OutcomeCountEvaluator-360"><span class="linenos">360</span></a>                <span class="n">counts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-361"><a href="#OutcomeCountEvaluator-361"><span class="linenos">361</span></a>                <span class="n">prod_weight</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-362"><a href="#OutcomeCountEvaluator-362"><span class="linenos">362</span></a>                <span class="n">prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eval_internal</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-363"><a href="#OutcomeCountEvaluator-363"><span class="linenos">363</span></a>                                           <span class="n">prev_generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-364"><a href="#OutcomeCountEvaluator-364"><span class="linenos">364</span></a>                <span class="k">for</span> <span class="n">prev_state</span><span class="p">,</span> <span class="n">prev_weight</span> <span class="ow">in</span> <span class="n">prev</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator-365"><a href="#OutcomeCountEvaluator-365"><span class="linenos">365</span></a>                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-366"><a href="#OutcomeCountEvaluator-366"><span class="linenos">366</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-367"><a href="#OutcomeCountEvaluator-367"><span class="linenos">367</span></a>                        <span class="n">result</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">+=</span> <span class="n">prev_weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="OutcomeCountEvaluator-368"><a href="#OutcomeCountEvaluator-368"><span class="linenos">368</span></a>
</span><span id="OutcomeCountEvaluator-369"><a href="#OutcomeCountEvaluator-369"><span class="linenos">369</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="OutcomeCountEvaluator-370"><a href="#OutcomeCountEvaluator-370"><span class="linenos">370</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="OutcomeCountEvaluator-371"><a href="#OutcomeCountEvaluator-371"><span class="linenos">371</span></a>
</span><span id="OutcomeCountEvaluator-372"><a href="#OutcomeCountEvaluator-372"><span class="linenos">372</span></a>    <span class="k">def</span> <span class="nf">_eval_internal_iterative</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-373"><a href="#OutcomeCountEvaluator-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">alignment</span><span class="p">:</span> <span class="n">Alignment</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-374"><a href="#OutcomeCountEvaluator-374"><span class="linenos">374</span></a>        <span class="n">generators</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-375"><a href="#OutcomeCountEvaluator-375"><span class="linenos">375</span></a>                          <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="OutcomeCountEvaluator-376"><a href="#OutcomeCountEvaluator-376"><span class="linenos">376</span></a>        <span class="sd">&quot;&quot;&quot;Internal algorithm for iterating in the less-preferred order,</span>
</span><span id="OutcomeCountEvaluator-377"><a href="#OutcomeCountEvaluator-377"><span class="linenos">377</span></a><span class="sd">        i.e. giving outcomes to `next_state()` from narrow to wide.</span>
</span><span id="OutcomeCountEvaluator-378"><a href="#OutcomeCountEvaluator-378"><span class="linenos">378</span></a>
</span><span id="OutcomeCountEvaluator-379"><a href="#OutcomeCountEvaluator-379"><span class="linenos">379</span></a><span class="sd">        This algorithm does not perform persistent memoization.</span>
</span><span id="OutcomeCountEvaluator-380"><a href="#OutcomeCountEvaluator-380"><span class="linenos">380</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-381"><a href="#OutcomeCountEvaluator-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="OutcomeCountEvaluator-382"><a href="#OutcomeCountEvaluator-382"><span class="linenos">382</span></a>               <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">alignment</span><span class="o">.</span><span class="n">outcomes</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator-383"><a href="#OutcomeCountEvaluator-383"><span class="linenos">383</span></a>            <span class="k">return</span> <span class="p">{</span><span class="kc">None</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="OutcomeCountEvaluator-384"><a href="#OutcomeCountEvaluator-384"><span class="linenos">384</span></a>        <span class="n">dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-385"><a href="#OutcomeCountEvaluator-385"><span class="linenos">385</span></a>        <span class="n">dist</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">generators</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="OutcomeCountEvaluator-386"><a href="#OutcomeCountEvaluator-386"><span class="linenos">386</span></a>        <span class="n">final_dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-387"><a href="#OutcomeCountEvaluator-387"><span class="linenos">387</span></a>        <span class="k">while</span> <span class="n">dist</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-388"><a href="#OutcomeCountEvaluator-388"><span class="linenos">388</span></a>            <span class="n">next_dist</span><span class="p">:</span> <span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-389"><a href="#OutcomeCountEvaluator-389"><span class="linenos">389</span></a>            <span class="k">for</span> <span class="p">(</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-390"><a href="#OutcomeCountEvaluator-390"><span class="linenos">390</span></a>                 <span class="n">prev_generators</span><span class="p">),</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator-391"><a href="#OutcomeCountEvaluator-391"><span class="linenos">391</span></a>                <span class="c1"># The order flip here is the only purpose of this algorithm.</span>
</span><span id="OutcomeCountEvaluator-392"><a href="#OutcomeCountEvaluator-392"><span class="linenos">392</span></a>                <span class="n">outcome</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">iterators</span> <span class="o">=</span> <span class="n">OutcomeCountEvaluator</span><span class="o">.</span><span class="n">_pop_generators</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-393"><a href="#OutcomeCountEvaluator-393"><span class="linenos">393</span></a>                    <span class="o">-</span><span class="n">order</span><span class="p">,</span> <span class="n">prev_alignment</span><span class="p">,</span> <span class="n">prev_generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-394"><a href="#OutcomeCountEvaluator-394"><span class="linenos">394</span></a>                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">iterators</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator-395"><a href="#OutcomeCountEvaluator-395"><span class="linenos">395</span></a>                    <span class="n">generators</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-396"><a href="#OutcomeCountEvaluator-396"><span class="linenos">396</span></a>                    <span class="n">counts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">counts</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-397"><a href="#OutcomeCountEvaluator-397"><span class="linenos">397</span></a>                    <span class="n">prod_weight</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-398"><a href="#OutcomeCountEvaluator-398"><span class="linenos">398</span></a>                    <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">prev_state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-399"><a href="#OutcomeCountEvaluator-399"><span class="linenos">399</span></a>                    <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-400"><a href="#OutcomeCountEvaluator-400"><span class="linenos">400</span></a>                        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="ow">not</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="OutcomeCountEvaluator-401"><a href="#OutcomeCountEvaluator-401"><span class="linenos">401</span></a>                               <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator-402"><a href="#OutcomeCountEvaluator-402"><span class="linenos">402</span></a>                            <span class="n">final_dist</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="OutcomeCountEvaluator-403"><a href="#OutcomeCountEvaluator-403"><span class="linenos">403</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-404"><a href="#OutcomeCountEvaluator-404"><span class="linenos">404</span></a>                            <span class="n">next_dist</span><span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-405"><a href="#OutcomeCountEvaluator-405"><span class="linenos">405</span></a>                                      <span class="n">generators</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">prod_weight</span>
</span><span id="OutcomeCountEvaluator-406"><a href="#OutcomeCountEvaluator-406"><span class="linenos">406</span></a>            <span class="n">dist</span> <span class="o">=</span> <span class="n">next_dist</span>
</span><span id="OutcomeCountEvaluator-407"><a href="#OutcomeCountEvaluator-407"><span class="linenos">407</span></a>        <span class="k">return</span> <span class="n">final_dist</span>
</span><span id="OutcomeCountEvaluator-408"><a href="#OutcomeCountEvaluator-408"><span class="linenos">408</span></a>
</span><span id="OutcomeCountEvaluator-409"><a href="#OutcomeCountEvaluator-409"><span class="linenos">409</span></a>    <span class="nd">@staticmethod</span>
</span><span id="OutcomeCountEvaluator-410"><a href="#OutcomeCountEvaluator-410"><span class="linenos">410</span></a>    <span class="k">def</span> <span class="nf">_pop_generators</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-411"><a href="#OutcomeCountEvaluator-411"><span class="linenos">411</span></a>        <span class="n">side</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">alignment</span><span class="p">:</span> <span class="n">Alignment</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator-412"><a href="#OutcomeCountEvaluator-412"><span class="linenos">412</span></a>        <span class="n">generators</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="OutcomeCountEvaluator-413"><a href="#OutcomeCountEvaluator-413"><span class="linenos">413</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Alignment</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;icepool.NextOutcomeCountGenerator&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">]]:</span>
</span><span id="OutcomeCountEvaluator-414"><a href="#OutcomeCountEvaluator-414"><span class="linenos">414</span></a>        <span class="sd">&quot;&quot;&quot;Pops a single outcome from the generators.</span>
</span><span id="OutcomeCountEvaluator-415"><a href="#OutcomeCountEvaluator-415"><span class="linenos">415</span></a>
</span><span id="OutcomeCountEvaluator-416"><a href="#OutcomeCountEvaluator-416"><span class="linenos">416</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator-417"><a href="#OutcomeCountEvaluator-417"><span class="linenos">417</span></a><span class="sd">            * The popped outcome.</span>
</span><span id="OutcomeCountEvaluator-418"><a href="#OutcomeCountEvaluator-418"><span class="linenos">418</span></a><span class="sd">            * The remaining alignment.</span>
</span><span id="OutcomeCountEvaluator-419"><a href="#OutcomeCountEvaluator-419"><span class="linenos">419</span></a><span class="sd">            * A tuple of iterators over the resulting generators, counts, and weights.</span>
</span><span id="OutcomeCountEvaluator-420"><a href="#OutcomeCountEvaluator-420"><span class="linenos">420</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-421"><a href="#OutcomeCountEvaluator-421"><span class="linenos">421</span></a>        <span class="n">alignment_and_generators</span> <span class="o">=</span> <span class="p">(</span><span class="n">alignment</span><span class="p">,)</span> <span class="o">+</span> <span class="n">generators</span>
</span><span id="OutcomeCountEvaluator-422"><a href="#OutcomeCountEvaluator-422"><span class="linenos">422</span></a>        <span class="k">if</span> <span class="n">side</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-423"><a href="#OutcomeCountEvaluator-423"><span class="linenos">423</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span>
</span><span id="OutcomeCountEvaluator-424"><a href="#OutcomeCountEvaluator-424"><span class="linenos">424</span></a>                          <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">alignment_and_generators</span>
</span><span id="OutcomeCountEvaluator-425"><a href="#OutcomeCountEvaluator-425"><span class="linenos">425</span></a>                          <span class="k">if</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="OutcomeCountEvaluator-426"><a href="#OutcomeCountEvaluator-426"><span class="linenos">426</span></a>
</span><span id="OutcomeCountEvaluator-427"><a href="#OutcomeCountEvaluator-427"><span class="linenos">427</span></a>            <span class="n">next_alignment</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">alignment</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-428"><a href="#OutcomeCountEvaluator-428"><span class="linenos">428</span></a>
</span><span id="OutcomeCountEvaluator-429"><a href="#OutcomeCountEvaluator-429"><span class="linenos">429</span></a>            <span class="k">return</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">next_alignment</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-430"><a href="#OutcomeCountEvaluator-430"><span class="linenos">430</span></a>                <span class="n">generator</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-431"><a href="#OutcomeCountEvaluator-431"><span class="linenos">431</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-432"><a href="#OutcomeCountEvaluator-432"><span class="linenos">432</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span>
</span><span id="OutcomeCountEvaluator-433"><a href="#OutcomeCountEvaluator-433"><span class="linenos">433</span></a>                          <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">alignment_and_generators</span>
</span><span id="OutcomeCountEvaluator-434"><a href="#OutcomeCountEvaluator-434"><span class="linenos">434</span></a>                          <span class="k">if</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="OutcomeCountEvaluator-435"><a href="#OutcomeCountEvaluator-435"><span class="linenos">435</span></a>
</span><span id="OutcomeCountEvaluator-436"><a href="#OutcomeCountEvaluator-436"><span class="linenos">436</span></a>            <span class="n">next_alignment</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">alignment</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-437"><a href="#OutcomeCountEvaluator-437"><span class="linenos">437</span></a>
</span><span id="OutcomeCountEvaluator-438"><a href="#OutcomeCountEvaluator-438"><span class="linenos">438</span></a>            <span class="k">return</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">next_alignment</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-439"><a href="#OutcomeCountEvaluator-439"><span class="linenos">439</span></a>                <span class="n">generator</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-440"><a href="#OutcomeCountEvaluator-440"><span class="linenos">440</span></a>
</span><span id="OutcomeCountEvaluator-441"><a href="#OutcomeCountEvaluator-441"><span class="linenos">441</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span> <span class="o">|</span>
</span><span id="OutcomeCountEvaluator-442"><a href="#OutcomeCountEvaluator-442"><span class="linenos">442</span></a>               <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator-443"><a href="#OutcomeCountEvaluator-443"><span class="linenos">443</span></a>        <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Samples one result from the generator(s) and evaluates the result.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator-444"><a href="#OutcomeCountEvaluator-444"><span class="linenos">444</span></a>        <span class="c1"># Convert non-`Pool` arguments to `Pool`.</span>
</span><span id="OutcomeCountEvaluator-445"><a href="#OutcomeCountEvaluator-445"><span class="linenos">445</span></a>        <span class="n">converted_generators</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-446"><a href="#OutcomeCountEvaluator-446"><span class="linenos">446</span></a>            <span class="n">generator</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span>
</span><span id="OutcomeCountEvaluator-447"><a href="#OutcomeCountEvaluator-447"><span class="linenos">447</span></a>                                   <span class="p">)</span> <span class="k">else</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-448"><a href="#OutcomeCountEvaluator-448"><span class="linenos">448</span></a>            <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator-449"><a href="#OutcomeCountEvaluator-449"><span class="linenos">449</span></a>
</span><span id="OutcomeCountEvaluator-450"><a href="#OutcomeCountEvaluator-450"><span class="linenos">450</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator-451"><a href="#OutcomeCountEvaluator-451"><span class="linenos">451</span></a>            <span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">converted_generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator-452"><a href="#OutcomeCountEvaluator-452"><span class="linenos">452</span></a>
</span><span id="OutcomeCountEvaluator-453"><a href="#OutcomeCountEvaluator-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator-454"><a href="#OutcomeCountEvaluator-454"><span class="linenos">454</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="OutcomeCountEvaluator-455"><a href="#OutcomeCountEvaluator-455"><span class="linenos">455</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator-456"><a href="#OutcomeCountEvaluator-456"><span class="linenos">456</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>An abstract, immutable, callable class for evaulating one or more <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>s.</p>

<p>There is one abstract method to implement: <code><a href="#OutcomeCountEvaluator.next_state">next_state()</a></code>.
This should incrementally calculate the result given one outcome at a time
along with how many of that outcome were produced.</p>

<p>An example sequence of calls, as far as <code><a href="#OutcomeCountEvaluator.next_state">next_state()</a></code> is concerned, is:</p>

<ol>
<li><code>state = next_state(state=None, outcome=1, count_of_1s)</code></li>
<li><code>state = next_state(state, 2, count_of_2s)</code></li>
<li><code>state = next_state(state, 3, count_of_3s)</code></li>
<li><code>state = next_state(state, 4, count_of_4s)</code></li>
<li><code>state = next_state(state, 5, count_of_5s)</code></li>
<li><code>state = next_state(state, 6, count_of_6s)</code></li>
<li><code>outcome = final_outcome(state, *generators)</code></li>
</ol>

<p>A few other methods can optionally be overridden to further customize behavior.</p>

<p>It is not expected that subclasses of <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code>
be able to handle arbitrary types or numbers of generators.
Indeed, most are expected to handle only a fixed number of generators,
and often even only generators with a particular type of <code><a href="#Die">Die</a></code>.</p>

<p>Instances cache all intermediate state distributions.
You should therefore reuse instances when possible.</p>

<p>Instances should not be modified after construction
in any way that affects the return values of these methods.
Otherwise, values in the cache may be incorrect.</p>
</div>


                            <div id="OutcomeCountEvaluator.next_state" class="classattr">
                                        <input id="OutcomeCountEvaluator.next_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">next_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span><span class="p">:</span> <span class="n">Hashable</span>, </span><span class="param"><span class="n">outcome</span>, </span><span class="param"><span class="o">/</span>, </span><span class="param"><span class="o">*</span><span class="n">counts</span></span><span class="return-annotation">) -> <span class="n">Hashable</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.next_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.next_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.next_state-59"><a href="#OutcomeCountEvaluator.next_state-59"><span class="linenos"> 59</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="OutcomeCountEvaluator.next_state-60"><a href="#OutcomeCountEvaluator.next_state-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hashable</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.next_state-61"><a href="#OutcomeCountEvaluator.next_state-61"><span class="linenos"> 61</span></a>        <span class="sd">&quot;&quot;&quot;State transition function.</span>
</span><span id="OutcomeCountEvaluator.next_state-62"><a href="#OutcomeCountEvaluator.next_state-62"><span class="linenos"> 62</span></a>
</span><span id="OutcomeCountEvaluator.next_state-63"><a href="#OutcomeCountEvaluator.next_state-63"><span class="linenos"> 63</span></a><span class="sd">        This should produce a state given the previous state, an outcome,</span>
</span><span id="OutcomeCountEvaluator.next_state-64"><a href="#OutcomeCountEvaluator.next_state-64"><span class="linenos"> 64</span></a><span class="sd">        and the number that outcome produced by each generator.</span>
</span><span id="OutcomeCountEvaluator.next_state-65"><a href="#OutcomeCountEvaluator.next_state-65"><span class="linenos"> 65</span></a>
</span><span id="OutcomeCountEvaluator.next_state-66"><a href="#OutcomeCountEvaluator.next_state-66"><span class="linenos"> 66</span></a><span class="sd">        `evaluate()` will always call this using only positional arguments.</span>
</span><span id="OutcomeCountEvaluator.next_state-67"><a href="#OutcomeCountEvaluator.next_state-67"><span class="linenos"> 67</span></a><span class="sd">        Furthermore, there is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator.next_state-68"><a href="#OutcomeCountEvaluator.next_state-68"><span class="linenos"> 68</span></a><span class="sd">        an arbitrary number of counts. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator.next_state-69"><a href="#OutcomeCountEvaluator.next_state-69"><span class="linenos"> 69</span></a><span class="sd">        the parameters in a subclass, or to replace `*counts` with a fixed set</span>
</span><span id="OutcomeCountEvaluator.next_state-70"><a href="#OutcomeCountEvaluator.next_state-70"><span class="linenos"> 70</span></a><span class="sd">        of parameters.</span>
</span><span id="OutcomeCountEvaluator.next_state-71"><a href="#OutcomeCountEvaluator.next_state-71"><span class="linenos"> 71</span></a>
</span><span id="OutcomeCountEvaluator.next_state-72"><a href="#OutcomeCountEvaluator.next_state-72"><span class="linenos"> 72</span></a><span class="sd">        Make sure to handle the base case where `state is None`.</span>
</span><span id="OutcomeCountEvaluator.next_state-73"><a href="#OutcomeCountEvaluator.next_state-73"><span class="linenos"> 73</span></a>
</span><span id="OutcomeCountEvaluator.next_state-74"><a href="#OutcomeCountEvaluator.next_state-74"><span class="linenos"> 74</span></a><span class="sd">        States must be hashable. At current, they do not have to be orderable.</span>
</span><span id="OutcomeCountEvaluator.next_state-75"><a href="#OutcomeCountEvaluator.next_state-75"><span class="linenos"> 75</span></a><span class="sd">        However, this may change in the future, and if they are not totally</span>
</span><span id="OutcomeCountEvaluator.next_state-76"><a href="#OutcomeCountEvaluator.next_state-76"><span class="linenos"> 76</span></a><span class="sd">        orderable, you must override `final_outcome` to create totally orderable</span>
</span><span id="OutcomeCountEvaluator.next_state-77"><a href="#OutcomeCountEvaluator.next_state-77"><span class="linenos"> 77</span></a><span class="sd">        final outcomes.</span>
</span><span id="OutcomeCountEvaluator.next_state-78"><a href="#OutcomeCountEvaluator.next_state-78"><span class="linenos"> 78</span></a>
</span><span id="OutcomeCountEvaluator.next_state-79"><a href="#OutcomeCountEvaluator.next_state-79"><span class="linenos"> 79</span></a><span class="sd">        The behavior of returning a `Die` from `next_state` is currently</span>
</span><span id="OutcomeCountEvaluator.next_state-80"><a href="#OutcomeCountEvaluator.next_state-80"><span class="linenos"> 80</span></a><span class="sd">        undefined.</span>
</span><span id="OutcomeCountEvaluator.next_state-81"><a href="#OutcomeCountEvaluator.next_state-81"><span class="linenos"> 81</span></a>
</span><span id="OutcomeCountEvaluator.next_state-82"><a href="#OutcomeCountEvaluator.next_state-82"><span class="linenos"> 82</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator.next_state-83"><a href="#OutcomeCountEvaluator.next_state-83"><span class="linenos"> 83</span></a><span class="sd">            state: A hashable object indicating the state before rolling the</span>
</span><span id="OutcomeCountEvaluator.next_state-84"><a href="#OutcomeCountEvaluator.next_state-84"><span class="linenos"> 84</span></a><span class="sd">                current outcome. If this is the first outcome being considered,</span>
</span><span id="OutcomeCountEvaluator.next_state-85"><a href="#OutcomeCountEvaluator.next_state-85"><span class="linenos"> 85</span></a><span class="sd">                `state` will be `None`.</span>
</span><span id="OutcomeCountEvaluator.next_state-86"><a href="#OutcomeCountEvaluator.next_state-86"><span class="linenos"> 86</span></a><span class="sd">            outcome: The current outcome.</span>
</span><span id="OutcomeCountEvaluator.next_state-87"><a href="#OutcomeCountEvaluator.next_state-87"><span class="linenos"> 87</span></a><span class="sd">                `next_state` will see all rolled outcomes in monotonic order;</span>
</span><span id="OutcomeCountEvaluator.next_state-88"><a href="#OutcomeCountEvaluator.next_state-88"><span class="linenos"> 88</span></a><span class="sd">                either ascending or descending depending on `order()`.</span>
</span><span id="OutcomeCountEvaluator.next_state-89"><a href="#OutcomeCountEvaluator.next_state-89"><span class="linenos"> 89</span></a><span class="sd">                If there are multiple generators, the set of outcomes is the</span>
</span><span id="OutcomeCountEvaluator.next_state-90"><a href="#OutcomeCountEvaluator.next_state-90"><span class="linenos"> 90</span></a><span class="sd">                union of the outcomes of the invididual generators. All outcomes</span>
</span><span id="OutcomeCountEvaluator.next_state-91"><a href="#OutcomeCountEvaluator.next_state-91"><span class="linenos"> 91</span></a><span class="sd">                with nonzero count will be seen. Outcomes with zero count</span>
</span><span id="OutcomeCountEvaluator.next_state-92"><a href="#OutcomeCountEvaluator.next_state-92"><span class="linenos"> 92</span></a><span class="sd">                may or may not be seen. If you need to enforce that certain</span>
</span><span id="OutcomeCountEvaluator.next_state-93"><a href="#OutcomeCountEvaluator.next_state-93"><span class="linenos"> 93</span></a><span class="sd">                outcomes are seen even if they have zero count, see</span>
</span><span id="OutcomeCountEvaluator.next_state-94"><a href="#OutcomeCountEvaluator.next_state-94"><span class="linenos"> 94</span></a><span class="sd">                `alignment()`.</span>
</span><span id="OutcomeCountEvaluator.next_state-95"><a href="#OutcomeCountEvaluator.next_state-95"><span class="linenos"> 95</span></a><span class="sd">            *counts: One value (usually an `int`) for each generator output</span>
</span><span id="OutcomeCountEvaluator.next_state-96"><a href="#OutcomeCountEvaluator.next_state-96"><span class="linenos"> 96</span></a><span class="sd">                indicating how many of the current outcome were produced.</span>
</span><span id="OutcomeCountEvaluator.next_state-97"><a href="#OutcomeCountEvaluator.next_state-97"><span class="linenos"> 97</span></a><span class="sd">                All outcomes with nonzero count are guaranteed to be seen.</span>
</span><span id="OutcomeCountEvaluator.next_state-98"><a href="#OutcomeCountEvaluator.next_state-98"><span class="linenos"> 98</span></a><span class="sd">                To guarantee that outcomes are seen even if they have zero</span>
</span><span id="OutcomeCountEvaluator.next_state-99"><a href="#OutcomeCountEvaluator.next_state-99"><span class="linenos"> 99</span></a><span class="sd">                count, override `alignment()`.</span>
</span><span id="OutcomeCountEvaluator.next_state-100"><a href="#OutcomeCountEvaluator.next_state-100"><span class="linenos">100</span></a>
</span><span id="OutcomeCountEvaluator.next_state-101"><a href="#OutcomeCountEvaluator.next_state-101"><span class="linenos">101</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator.next_state-102"><a href="#OutcomeCountEvaluator.next_state-102"><span class="linenos">102</span></a><span class="sd">            A hashable object indicating the next state.</span>
</span><span id="OutcomeCountEvaluator.next_state-103"><a href="#OutcomeCountEvaluator.next_state-103"><span class="linenos">103</span></a><span class="sd">            The special value `icepool.Reroll` can be used to immediately remove</span>
</span><span id="OutcomeCountEvaluator.next_state-104"><a href="#OutcomeCountEvaluator.next_state-104"><span class="linenos">104</span></a><span class="sd">            the state from consideration, effectively performing a full reroll.</span>
</span><span id="OutcomeCountEvaluator.next_state-105"><a href="#OutcomeCountEvaluator.next_state-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>State transition function.</p>

<p>This should produce a state given the previous state, an outcome,
and the number that outcome produced by each generator.</p>

<p><code><a href="#OutcomeCountEvaluator.evaluate">evaluate()</a></code> will always call this using only positional arguments.
Furthermore, there is no expectation that a subclass be able to handle
an arbitrary number of counts. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*counts</code> with a fixed set
of parameters.</p>

<p>Make sure to handle the base case where <code>state is None</code>.</p>

<p>States must be hashable. At current, they do not have to be orderable.
However, this may change in the future, and if they are not totally
orderable, you must override <code><a href="#OutcomeCountEvaluator.final_outcome">final_outcome</a></code> to create totally orderable
final outcomes.</p>

<p>The behavior of returning a <code><a href="#Die">Die</a></code> from <code><a href="#OutcomeCountEvaluator.next_state">next_state</a></code> is currently
undefined.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>state:</strong>  A hashable object indicating the state before rolling the
current outcome. If this is the first outcome being considered,
<code>state</code> will be <code>None</code>.</li>
<li><strong>outcome:</strong>  The current outcome.
<code><a href="#OutcomeCountEvaluator.next_state">next_state</a></code> will see all rolled outcomes in monotonic order;
either ascending or descending depending on <code><a href="#OutcomeCountEvaluator.order">order()</a></code>.
If there are multiple generators, the set of outcomes is the
union of the outcomes of the invididual generators. All outcomes
with nonzero count will be seen. Outcomes with zero count
may or may not be seen. If you need to enforce that certain
outcomes are seen even if they have zero count, see
<code><a href="#OutcomeCountEvaluator.alignment">alignment()</a></code>.</li>
<li><strong>*counts:</strong>  One value (usually an <code>int</code>) for each generator output
indicating how many of the current outcome were produced.
All outcomes with nonzero count are guaranteed to be seen.
To guarantee that outcomes are seen even if they have zero
count, override <code><a href="#OutcomeCountEvaluator.alignment">alignment()</a></code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A hashable object indicating the next state.
  The special value <code><a href="#Reroll">icepool.Reroll</a></code> can be used to immediately remove
  the state from consideration, effectively performing a full reroll.</p>
</blockquote>
</div>


                            </div>
                            <div id="OutcomeCountEvaluator.final_outcome" class="classattr">
                                        <input id="OutcomeCountEvaluator.final_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_outcome</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">final_state</span><span class="p">:</span> <span class="n">Hashable</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.final_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.final_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.final_outcome-107"><a href="#OutcomeCountEvaluator.final_outcome-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">:</span> <span class="n">Hashable</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator.final_outcome-108"><a href="#OutcomeCountEvaluator.final_outcome-108"><span class="linenos">108</span></a>                      <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.final_outcome-109"><a href="#OutcomeCountEvaluator.final_outcome-109"><span class="linenos">109</span></a>        <span class="sd">&quot;&quot;&quot;Optional function to generate a final outcome from a final state.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-110"><a href="#OutcomeCountEvaluator.final_outcome-110"><span class="linenos">110</span></a>
</span><span id="OutcomeCountEvaluator.final_outcome-111"><a href="#OutcomeCountEvaluator.final_outcome-111"><span class="linenos">111</span></a><span class="sd">        Tthere is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator.final_outcome-112"><a href="#OutcomeCountEvaluator.final_outcome-112"><span class="linenos">112</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator.final_outcome-113"><a href="#OutcomeCountEvaluator.final_outcome-113"><span class="linenos">113</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator.final_outcome-114"><a href="#OutcomeCountEvaluator.final_outcome-114"><span class="linenos">114</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-115"><a href="#OutcomeCountEvaluator.final_outcome-115"><span class="linenos">115</span></a>
</span><span id="OutcomeCountEvaluator.final_outcome-116"><a href="#OutcomeCountEvaluator.final_outcome-116"><span class="linenos">116</span></a><span class="sd">        By default, the final outcome is equal to the final state.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-117"><a href="#OutcomeCountEvaluator.final_outcome-117"><span class="linenos">117</span></a><span class="sd">        Note that `None` is not a valid outcome for a `Die`,</span>
</span><span id="OutcomeCountEvaluator.final_outcome-118"><a href="#OutcomeCountEvaluator.final_outcome-118"><span class="linenos">118</span></a><span class="sd">        and if there are no outcomes, the final state will be `None`.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-119"><a href="#OutcomeCountEvaluator.final_outcome-119"><span class="linenos">119</span></a><span class="sd">        Subclasses that want to handle this case should explicitly define what</span>
</span><span id="OutcomeCountEvaluator.final_outcome-120"><a href="#OutcomeCountEvaluator.final_outcome-120"><span class="linenos">120</span></a><span class="sd">        happens.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-121"><a href="#OutcomeCountEvaluator.final_outcome-121"><span class="linenos">121</span></a>
</span><span id="OutcomeCountEvaluator.final_outcome-122"><a href="#OutcomeCountEvaluator.final_outcome-122"><span class="linenos">122</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator.final_outcome-123"><a href="#OutcomeCountEvaluator.final_outcome-123"><span class="linenos">123</span></a><span class="sd">            final_state: A state after all outcomes have been processed.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-124"><a href="#OutcomeCountEvaluator.final_outcome-124"><span class="linenos">124</span></a><span class="sd">            *generators: One or more `OutcomeCountGenerator`s being evaluated.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-125"><a href="#OutcomeCountEvaluator.final_outcome-125"><span class="linenos">125</span></a><span class="sd">                Most subclasses will expect a fixed number of generators and</span>
</span><span id="OutcomeCountEvaluator.final_outcome-126"><a href="#OutcomeCountEvaluator.final_outcome-126"><span class="linenos">126</span></a><span class="sd">                can replace this variadic parameter with a fixed number of named</span>
</span><span id="OutcomeCountEvaluator.final_outcome-127"><a href="#OutcomeCountEvaluator.final_outcome-127"><span class="linenos">127</span></a><span class="sd">                parameters.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-128"><a href="#OutcomeCountEvaluator.final_outcome-128"><span class="linenos">128</span></a>
</span><span id="OutcomeCountEvaluator.final_outcome-129"><a href="#OutcomeCountEvaluator.final_outcome-129"><span class="linenos">129</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator.final_outcome-130"><a href="#OutcomeCountEvaluator.final_outcome-130"><span class="linenos">130</span></a><span class="sd">            A final outcome that will be used as part of constructing the result `Die`.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-131"><a href="#OutcomeCountEvaluator.final_outcome-131"><span class="linenos">131</span></a><span class="sd">            As usual for `Die()`, this could itself be a `Die` or `icepool.Reroll`.</span>
</span><span id="OutcomeCountEvaluator.final_outcome-132"><a href="#OutcomeCountEvaluator.final_outcome-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator.final_outcome-133"><a href="#OutcomeCountEvaluator.final_outcome-133"><span class="linenos">133</span></a>        <span class="k">return</span> <span class="n">final_state</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to generate a final outcome from a final state.</p>

<p>Tthere is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>By default, the final outcome is equal to the final state.
Note that <code>None</code> is not a valid outcome for a <code><a href="#Die">Die</a></code>,
and if there are no outcomes, the final state will be <code>None</code>.
Subclasses that want to handle this case should explicitly define what
happens.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>final_state:</strong>  A state after all outcomes have been processed.</li>
<li><strong>*generators:</strong>  One or more <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A final outcome that will be used as part of constructing the result <code><a href="#Die">Die</a></code>.
  As usual for <code><a href="#Die">Die()</a></code>, this could itself be a <code><a href="#Die">Die</a></code> or <code><a href="#Reroll">icepool.Reroll</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="OutcomeCountEvaluator.order" class="classattr">
                                        <input id="OutcomeCountEvaluator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Order">icepool.Order</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.order-135"><a href="#OutcomeCountEvaluator.order-135"><span class="linenos">135</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.order-136"><a href="#OutcomeCountEvaluator.order-136"><span class="linenos">136</span></a>        <span class="sd">&quot;&quot;&quot;Optional function to determine the order in which `next_state()` will see outcomes.</span>
</span><span id="OutcomeCountEvaluator.order-137"><a href="#OutcomeCountEvaluator.order-137"><span class="linenos">137</span></a>
</span><span id="OutcomeCountEvaluator.order-138"><a href="#OutcomeCountEvaluator.order-138"><span class="linenos">138</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator.order-139"><a href="#OutcomeCountEvaluator.order-139"><span class="linenos">139</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator.order-140"><a href="#OutcomeCountEvaluator.order-140"><span class="linenos">140</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator.order-141"><a href="#OutcomeCountEvaluator.order-141"><span class="linenos">141</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator.order-142"><a href="#OutcomeCountEvaluator.order-142"><span class="linenos">142</span></a>
</span><span id="OutcomeCountEvaluator.order-143"><a href="#OutcomeCountEvaluator.order-143"><span class="linenos">143</span></a><span class="sd">        The default is ascending order. This works well with mixed standard dice,</span>
</span><span id="OutcomeCountEvaluator.order-144"><a href="#OutcomeCountEvaluator.order-144"><span class="linenos">144</span></a><span class="sd">        and other dice that differ only by right-truncation.</span>
</span><span id="OutcomeCountEvaluator.order-145"><a href="#OutcomeCountEvaluator.order-145"><span class="linenos">145</span></a>
</span><span id="OutcomeCountEvaluator.order-146"><a href="#OutcomeCountEvaluator.order-146"><span class="linenos">146</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator.order-147"><a href="#OutcomeCountEvaluator.order-147"><span class="linenos">147</span></a><span class="sd">            *generators: One or more `OutcomeCountGenerator`s being evaluated.</span>
</span><span id="OutcomeCountEvaluator.order-148"><a href="#OutcomeCountEvaluator.order-148"><span class="linenos">148</span></a><span class="sd">                Most subclasses will expect a fixed number of generators and</span>
</span><span id="OutcomeCountEvaluator.order-149"><a href="#OutcomeCountEvaluator.order-149"><span class="linenos">149</span></a><span class="sd">                can replace this variadic parameter with a fixed number of named</span>
</span><span id="OutcomeCountEvaluator.order-150"><a href="#OutcomeCountEvaluator.order-150"><span class="linenos">150</span></a><span class="sd">                parameters.</span>
</span><span id="OutcomeCountEvaluator.order-151"><a href="#OutcomeCountEvaluator.order-151"><span class="linenos">151</span></a>
</span><span id="OutcomeCountEvaluator.order-152"><a href="#OutcomeCountEvaluator.order-152"><span class="linenos">152</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator.order-153"><a href="#OutcomeCountEvaluator.order-153"><span class="linenos">153</span></a><span class="sd">            * Order.Ascending (= 1)</span>
</span><span id="OutcomeCountEvaluator.order-154"><a href="#OutcomeCountEvaluator.order-154"><span class="linenos">154</span></a><span class="sd">                if `next_state()` should always see the outcomes in ascending order.</span>
</span><span id="OutcomeCountEvaluator.order-155"><a href="#OutcomeCountEvaluator.order-155"><span class="linenos">155</span></a><span class="sd">            * Order.Descending (= -1)</span>
</span><span id="OutcomeCountEvaluator.order-156"><a href="#OutcomeCountEvaluator.order-156"><span class="linenos">156</span></a><span class="sd">                if `next_state()` should always see the outcomes in descending order.</span>
</span><span id="OutcomeCountEvaluator.order-157"><a href="#OutcomeCountEvaluator.order-157"><span class="linenos">157</span></a><span class="sd">            * Order.Any (= 0)</span>
</span><span id="OutcomeCountEvaluator.order-158"><a href="#OutcomeCountEvaluator.order-158"><span class="linenos">158</span></a><span class="sd">                if the result of the evaluation is order-independent.</span>
</span><span id="OutcomeCountEvaluator.order-159"><a href="#OutcomeCountEvaluator.order-159"><span class="linenos">159</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator.order-160"><a href="#OutcomeCountEvaluator.order-160"><span class="linenos">160</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to determine the order in which <code><a href="#OutcomeCountEvaluator.next_state">next_state()</a></code> will see outcomes.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default is ascending order. This works well with mixed standard dice,
and other dice that differ only by right-truncation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*generators:</strong>  One or more <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <ul>
  <li><a href="#Order.Ascending">Order.Ascending</a> (= 1)
  if <code><a href="#OutcomeCountEvaluator.next_state">next_state()</a></code> should always see the outcomes in ascending order.</li>
  <li><a href="#Order.Descending">Order.Descending</a> (= -1)
  if <code><a href="#OutcomeCountEvaluator.next_state">next_state()</a></code> should always see the outcomes in descending order.</li>
  <li><a href="#Order.Any">Order.Any</a> (= 0)
  if the result of the evaluation is order-independent.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="OutcomeCountEvaluator.alignment" class="classattr">
                                        <input id="OutcomeCountEvaluator.alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">alignment</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span></span><span class="return-annotation">) -> <span class="n">Collection</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.alignment-162"><a href="#OutcomeCountEvaluator.alignment-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator.alignment-163"><a href="#OutcomeCountEvaluator.alignment-163"><span class="linenos">163</span></a>                  <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.alignment-164"><a href="#OutcomeCountEvaluator.alignment-164"><span class="linenos">164</span></a>        <span class="sd">&quot;&quot;&quot;Optional method to specify an collection of outcomes that should always be given to `next_state()` even if they have zero count.</span>
</span><span id="OutcomeCountEvaluator.alignment-165"><a href="#OutcomeCountEvaluator.alignment-165"><span class="linenos">165</span></a>
</span><span id="OutcomeCountEvaluator.alignment-166"><a href="#OutcomeCountEvaluator.alignment-166"><span class="linenos">166</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator.alignment-167"><a href="#OutcomeCountEvaluator.alignment-167"><span class="linenos">167</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator.alignment-168"><a href="#OutcomeCountEvaluator.alignment-168"><span class="linenos">168</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator.alignment-169"><a href="#OutcomeCountEvaluator.alignment-169"><span class="linenos">169</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator.alignment-170"><a href="#OutcomeCountEvaluator.alignment-170"><span class="linenos">170</span></a>
</span><span id="OutcomeCountEvaluator.alignment-171"><a href="#OutcomeCountEvaluator.alignment-171"><span class="linenos">171</span></a><span class="sd">        The default implementation returns `()`; this means outcomes with zero</span>
</span><span id="OutcomeCountEvaluator.alignment-172"><a href="#OutcomeCountEvaluator.alignment-172"><span class="linenos">172</span></a><span class="sd">        count may or may not be seen by `next_state`.</span>
</span><span id="OutcomeCountEvaluator.alignment-173"><a href="#OutcomeCountEvaluator.alignment-173"><span class="linenos">173</span></a>
</span><span id="OutcomeCountEvaluator.alignment-174"><a href="#OutcomeCountEvaluator.alignment-174"><span class="linenos">174</span></a><span class="sd">        If you want the outcomes seen by `next_state` to be consecutive</span>
</span><span id="OutcomeCountEvaluator.alignment-175"><a href="#OutcomeCountEvaluator.alignment-175"><span class="linenos">175</span></a><span class="sd">        `int`s, you can set `alignment = icepool.OutcomeCountEvaluator.range_alignment`.</span>
</span><span id="OutcomeCountEvaluator.alignment-176"><a href="#OutcomeCountEvaluator.alignment-176"><span class="linenos">176</span></a><span class="sd">        See `range_alignment()` below.</span>
</span><span id="OutcomeCountEvaluator.alignment-177"><a href="#OutcomeCountEvaluator.alignment-177"><span class="linenos">177</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator.alignment-178"><a href="#OutcomeCountEvaluator.alignment-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Optional method to specify an collection of outcomes that should always be given to <code><a href="#OutcomeCountEvaluator.next_state">next_state()</a></code> even if they have zero count.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default implementation returns <code>()</code>; this means outcomes with zero
count may or may not be seen by <code><a href="#OutcomeCountEvaluator.next_state">next_state</a></code>.</p>

<p>If you want the outcomes seen by <code><a href="#OutcomeCountEvaluator.next_state">next_state</a></code> to be consecutive
<code>int</code>s, you can set <code>alignment = <a href="#OutcomeCountEvaluator.range_alignment">icepool.OutcomeCountEvaluator.range_alignment</a></code>.
See <code><a href="#OutcomeCountEvaluator.range_alignment">range_alignment()</a></code> below.</p>
</div>


                            </div>
                            <div id="OutcomeCountEvaluator.range_alignment" class="classattr">
                                        <input id="OutcomeCountEvaluator.range_alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">range_alignment</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span></span><span class="return-annotation">) -> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.range_alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.range_alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.range_alignment-180"><a href="#OutcomeCountEvaluator.range_alignment-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">range_alignment</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.range_alignment-181"><a href="#OutcomeCountEvaluator.range_alignment-181"><span class="linenos">181</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator.range_alignment-182"><a href="#OutcomeCountEvaluator.range_alignment-182"><span class="linenos">182</span></a>            <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="OutcomeCountEvaluator.range_alignment-183"><a href="#OutcomeCountEvaluator.range_alignment-183"><span class="linenos">183</span></a>        <span class="sd">&quot;&quot;&quot;Example implementation of `alignment()` that produces consecutive `int` outcomes.</span>
</span><span id="OutcomeCountEvaluator.range_alignment-184"><a href="#OutcomeCountEvaluator.range_alignment-184"><span class="linenos">184</span></a>
</span><span id="OutcomeCountEvaluator.range_alignment-185"><a href="#OutcomeCountEvaluator.range_alignment-185"><span class="linenos">185</span></a><span class="sd">        There is no expectation that a subclass be able to handle</span>
</span><span id="OutcomeCountEvaluator.range_alignment-186"><a href="#OutcomeCountEvaluator.range_alignment-186"><span class="linenos">186</span></a><span class="sd">        an arbitrary number of generators. Thus, you are free to rename any of</span>
</span><span id="OutcomeCountEvaluator.range_alignment-187"><a href="#OutcomeCountEvaluator.range_alignment-187"><span class="linenos">187</span></a><span class="sd">        the parameters in a subclass, or to replace `*generators` with a fixed</span>
</span><span id="OutcomeCountEvaluator.range_alignment-188"><a href="#OutcomeCountEvaluator.range_alignment-188"><span class="linenos">188</span></a><span class="sd">        set of parameters.</span>
</span><span id="OutcomeCountEvaluator.range_alignment-189"><a href="#OutcomeCountEvaluator.range_alignment-189"><span class="linenos">189</span></a>
</span><span id="OutcomeCountEvaluator.range_alignment-190"><a href="#OutcomeCountEvaluator.range_alignment-190"><span class="linenos">190</span></a><span class="sd">        Set `alignment = icepool.OutcomeCountEvaluator.range_alignment` to use this.</span>
</span><span id="OutcomeCountEvaluator.range_alignment-191"><a href="#OutcomeCountEvaluator.range_alignment-191"><span class="linenos">191</span></a>
</span><span id="OutcomeCountEvaluator.range_alignment-192"><a href="#OutcomeCountEvaluator.range_alignment-192"><span class="linenos">192</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator.range_alignment-193"><a href="#OutcomeCountEvaluator.range_alignment-193"><span class="linenos">193</span></a><span class="sd">            All `int`s from the min outcome to the max outcome among the generators,</span>
</span><span id="OutcomeCountEvaluator.range_alignment-194"><a href="#OutcomeCountEvaluator.range_alignment-194"><span class="linenos">194</span></a><span class="sd">            inclusive.</span>
</span><span id="OutcomeCountEvaluator.range_alignment-195"><a href="#OutcomeCountEvaluator.range_alignment-195"><span class="linenos">195</span></a>
</span><span id="OutcomeCountEvaluator.range_alignment-196"><a href="#OutcomeCountEvaluator.range_alignment-196"><span class="linenos">196</span></a><span class="sd">        Raises:</span>
</span><span id="OutcomeCountEvaluator.range_alignment-197"><a href="#OutcomeCountEvaluator.range_alignment-197"><span class="linenos">197</span></a><span class="sd">            TypeError: if any generator has any non-`int` outcome.</span>
</span><span id="OutcomeCountEvaluator.range_alignment-198"><a href="#OutcomeCountEvaluator.range_alignment-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator.range_alignment-199"><a href="#OutcomeCountEvaluator.range_alignment-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">generators</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.range_alignment-200"><a href="#OutcomeCountEvaluator.range_alignment-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="p">()</span>
</span><span id="OutcomeCountEvaluator.range_alignment-201"><a href="#OutcomeCountEvaluator.range_alignment-201"><span class="linenos">201</span></a>
</span><span id="OutcomeCountEvaluator.range_alignment-202"><a href="#OutcomeCountEvaluator.range_alignment-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.range_alignment-203"><a href="#OutcomeCountEvaluator.range_alignment-203"><span class="linenos">203</span></a>                <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.range_alignment-204"><a href="#OutcomeCountEvaluator.range_alignment-204"><span class="linenos">204</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">generator</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="OutcomeCountEvaluator.range_alignment-205"><a href="#OutcomeCountEvaluator.range_alignment-205"><span class="linenos">205</span></a>                <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator.range_alignment-206"><a href="#OutcomeCountEvaluator.range_alignment-206"><span class="linenos">206</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.range_alignment-207"><a href="#OutcomeCountEvaluator.range_alignment-207"><span class="linenos">207</span></a>                <span class="s2">&quot;range_alignment cannot be used with outcomes of type other than &#39;int&#39;.&quot;</span>
</span><span id="OutcomeCountEvaluator.range_alignment-208"><a href="#OutcomeCountEvaluator.range_alignment-208"><span class="linenos">208</span></a>            <span class="p">)</span>
</span><span id="OutcomeCountEvaluator.range_alignment-209"><a href="#OutcomeCountEvaluator.range_alignment-209"><span class="linenos">209</span></a>
</span><span id="OutcomeCountEvaluator.range_alignment-210"><a href="#OutcomeCountEvaluator.range_alignment-210"><span class="linenos">210</span></a>        <span class="n">min_outcome</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.range_alignment-211"><a href="#OutcomeCountEvaluator.range_alignment-211"><span class="linenos">211</span></a>        <span class="n">max_outcome</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.range_alignment-212"><a href="#OutcomeCountEvaluator.range_alignment-212"><span class="linenos">212</span></a>        <span class="k">return</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">max_outcome</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Example implementation of <code><a href="#OutcomeCountEvaluator.alignment">alignment()</a></code> that produces consecutive <code>int</code> outcomes.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>Set <code>alignment = <a href="#OutcomeCountEvaluator.range_alignment">icepool.OutcomeCountEvaluator.range_alignment</a></code> to use this.</p>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>All <code>int</code>s from the min outcome to the max outcome among the generators,
  inclusive.</p>
</blockquote>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>TypeError:</strong>  if any generator has any non-<code>int</code> outcome.</li>
</ul>
</div>


                            </div>
                            <div id="OutcomeCountEvaluator.final_kwargs" class="classattr">
                                        <input id="OutcomeCountEvaluator.final_kwargs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_kwargs</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span></span><span class="return-annotation">) -> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.final_kwargs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.final_kwargs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.final_kwargs-214"><a href="#OutcomeCountEvaluator.final_kwargs-214"><span class="linenos">214</span></a>    <span class="k">def</span> <span class="nf">final_kwargs</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.final_kwargs-215"><a href="#OutcomeCountEvaluator.final_kwargs-215"><span class="linenos">215</span></a>            <span class="bp">self</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator.final_kwargs-216"><a href="#OutcomeCountEvaluator.final_kwargs-216"><span class="linenos">216</span></a>            <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="OutcomeCountEvaluator.final_kwargs-217"><a href="#OutcomeCountEvaluator.final_kwargs-217"><span class="linenos">217</span></a>        <span class="sd">&quot;&quot;&quot;Optional method to specify any extra keyword arguments to the final die constructor.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator.final_kwargs-218"><a href="#OutcomeCountEvaluator.final_kwargs-218"><span class="linenos">218</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span></pre></div>


            <div class="docstring"><p>Optional method to specify any extra keyword arguments to the final die constructor.</p>
</div>


                            </div>
                            <div id="OutcomeCountEvaluator.evaluate" class="classattr">
                                        <input id="OutcomeCountEvaluator.evaluate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">evaluate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Die">icepool.Die</a></span>:</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.evaluate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.evaluate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.evaluate-225"><a href="#OutcomeCountEvaluator.evaluate-225"><span class="linenos">225</span></a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.evaluate-226"><a href="#OutcomeCountEvaluator.evaluate-226"><span class="linenos">226</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span>
</span><span id="OutcomeCountEvaluator.evaluate-227"><a href="#OutcomeCountEvaluator.evaluate-227"><span class="linenos">227</span></a>        <span class="n">Sequence</span>
</span><span id="OutcomeCountEvaluator.evaluate-228"><a href="#OutcomeCountEvaluator.evaluate-228"><span class="linenos">228</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Die&#39;</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.evaluate-229"><a href="#OutcomeCountEvaluator.evaluate-229"><span class="linenos">229</span></a>        <span class="sd">&quot;&quot;&quot;Evaluates generator(s).</span>
</span><span id="OutcomeCountEvaluator.evaluate-230"><a href="#OutcomeCountEvaluator.evaluate-230"><span class="linenos">230</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-231"><a href="#OutcomeCountEvaluator.evaluate-231"><span class="linenos">231</span></a><span class="sd">        You can call the `OutcomeCountEvaluator` object directly for the same effect,</span>
</span><span id="OutcomeCountEvaluator.evaluate-232"><a href="#OutcomeCountEvaluator.evaluate-232"><span class="linenos">232</span></a><span class="sd">        e.g. `sum_evaluator(generator)` is an alias for `sum_evaluator.evaluate(generator)`.</span>
</span><span id="OutcomeCountEvaluator.evaluate-233"><a href="#OutcomeCountEvaluator.evaluate-233"><span class="linenos">233</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-234"><a href="#OutcomeCountEvaluator.evaluate-234"><span class="linenos">234</span></a><span class="sd">        Most evaluators will expect a fixed number of generators.</span>
</span><span id="OutcomeCountEvaluator.evaluate-235"><a href="#OutcomeCountEvaluator.evaluate-235"><span class="linenos">235</span></a><span class="sd">        The union of the outcomes of the generator(s) must be totally orderable.</span>
</span><span id="OutcomeCountEvaluator.evaluate-236"><a href="#OutcomeCountEvaluator.evaluate-236"><span class="linenos">236</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-237"><a href="#OutcomeCountEvaluator.evaluate-237"><span class="linenos">237</span></a><span class="sd">        Args:</span>
</span><span id="OutcomeCountEvaluator.evaluate-238"><a href="#OutcomeCountEvaluator.evaluate-238"><span class="linenos">238</span></a><span class="sd">            *generators: Each element may be one of the following:</span>
</span><span id="OutcomeCountEvaluator.evaluate-239"><a href="#OutcomeCountEvaluator.evaluate-239"><span class="linenos">239</span></a><span class="sd">                * A `OutcomeCountGenerator`.</span>
</span><span id="OutcomeCountEvaluator.evaluate-240"><a href="#OutcomeCountEvaluator.evaluate-240"><span class="linenos">240</span></a><span class="sd">                * A mappable mapping dice to the number of those dice.</span>
</span><span id="OutcomeCountEvaluator.evaluate-241"><a href="#OutcomeCountEvaluator.evaluate-241"><span class="linenos">241</span></a><span class="sd">                * A sequence of arguments to create a `Pool`.</span>
</span><span id="OutcomeCountEvaluator.evaluate-242"><a href="#OutcomeCountEvaluator.evaluate-242"><span class="linenos">242</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-243"><a href="#OutcomeCountEvaluator.evaluate-243"><span class="linenos">243</span></a><span class="sd">        Returns:</span>
</span><span id="OutcomeCountEvaluator.evaluate-244"><a href="#OutcomeCountEvaluator.evaluate-244"><span class="linenos">244</span></a><span class="sd">            A `Die` representing the distribution of the final score.</span>
</span><span id="OutcomeCountEvaluator.evaluate-245"><a href="#OutcomeCountEvaluator.evaluate-245"><span class="linenos">245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator.evaluate-246"><a href="#OutcomeCountEvaluator.evaluate-246"><span class="linenos">246</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-247"><a href="#OutcomeCountEvaluator.evaluate-247"><span class="linenos">247</span></a>        <span class="c1"># Convert non-`Pool` arguments to `Pool`.</span>
</span><span id="OutcomeCountEvaluator.evaluate-248"><a href="#OutcomeCountEvaluator.evaluate-248"><span class="linenos">248</span></a>        <span class="n">converted_generators</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.evaluate-249"><a href="#OutcomeCountEvaluator.evaluate-249"><span class="linenos">249</span></a>            <span class="n">generator</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span>
</span><span id="OutcomeCountEvaluator.evaluate-250"><a href="#OutcomeCountEvaluator.evaluate-250"><span class="linenos">250</span></a>                                   <span class="p">)</span> <span class="k">else</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.evaluate-251"><a href="#OutcomeCountEvaluator.evaluate-251"><span class="linenos">251</span></a>            <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.evaluate-252"><a href="#OutcomeCountEvaluator.evaluate-252"><span class="linenos">252</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-253"><a href="#OutcomeCountEvaluator.evaluate-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">_is_resolvable</span><span class="p">()</span>
</span><span id="OutcomeCountEvaluator.evaluate-254"><a href="#OutcomeCountEvaluator.evaluate-254"><span class="linenos">254</span></a>                   <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">converted_generators</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator.evaluate-255"><a href="#OutcomeCountEvaluator.evaluate-255"><span class="linenos">255</span></a>            <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">([])</span>
</span><span id="OutcomeCountEvaluator.evaluate-256"><a href="#OutcomeCountEvaluator.evaluate-256"><span class="linenos">256</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-257"><a href="#OutcomeCountEvaluator.evaluate-257"><span class="linenos">257</span></a>        <span class="n">algorithm</span><span class="p">,</span> <span class="n">order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_algorithm</span><span class="p">(</span><span class="o">*</span><span class="n">converted_generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.evaluate-258"><a href="#OutcomeCountEvaluator.evaluate-258"><span class="linenos">258</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-259"><a href="#OutcomeCountEvaluator.evaluate-259"><span class="linenos">259</span></a>        <span class="c1"># We use a separate class to guarantee all outcomes are visited.</span>
</span><span id="OutcomeCountEvaluator.evaluate-260"><a href="#OutcomeCountEvaluator.evaluate-260"><span class="linenos">260</span></a>        <span class="n">alignment</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">converted_generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator.evaluate-261"><a href="#OutcomeCountEvaluator.evaluate-261"><span class="linenos">261</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-262"><a href="#OutcomeCountEvaluator.evaluate-262"><span class="linenos">262</span></a>        <span class="n">dist</span> <span class="o">=</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">converted_generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator.evaluate-263"><a href="#OutcomeCountEvaluator.evaluate-263"><span class="linenos">263</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-264"><a href="#OutcomeCountEvaluator.evaluate-264"><span class="linenos">264</span></a>        <span class="n">final_outcomes</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="OutcomeCountEvaluator.evaluate-265"><a href="#OutcomeCountEvaluator.evaluate-265"><span class="linenos">265</span></a>        <span class="n">final_weights</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="OutcomeCountEvaluator.evaluate-266"><a href="#OutcomeCountEvaluator.evaluate-266"><span class="linenos">266</span></a>        <span class="k">for</span> <span class="n">state</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">dist</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator.evaluate-267"><a href="#OutcomeCountEvaluator.evaluate-267"><span class="linenos">267</span></a>            <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">*</span><span class="n">converted_generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.evaluate-268"><a href="#OutcomeCountEvaluator.evaluate-268"><span class="linenos">268</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.evaluate-269"><a href="#OutcomeCountEvaluator.evaluate-269"><span class="linenos">269</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.evaluate-270"><a href="#OutcomeCountEvaluator.evaluate-270"><span class="linenos">270</span></a>                    <span class="s2">&quot;None is not a valid final outcome. &quot;</span>
</span><span id="OutcomeCountEvaluator.evaluate-271"><a href="#OutcomeCountEvaluator.evaluate-271"><span class="linenos">271</span></a>                    <span class="s2">&quot;This may have resulted from supplying an empty generator to OutcomeCountEvaluator. &quot;</span>
</span><span id="OutcomeCountEvaluator.evaluate-272"><a href="#OutcomeCountEvaluator.evaluate-272"><span class="linenos">272</span></a>                    <span class="s2">&quot;If so, refrain from using empty generators, or override OutcomeCountEvaluator.final_outcome() to handle this case.&quot;</span>
</span><span id="OutcomeCountEvaluator.evaluate-273"><a href="#OutcomeCountEvaluator.evaluate-273"><span class="linenos">273</span></a>                <span class="p">)</span>
</span><span id="OutcomeCountEvaluator.evaluate-274"><a href="#OutcomeCountEvaluator.evaluate-274"><span class="linenos">274</span></a>            <span class="k">if</span> <span class="n">outcome</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Reroll</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.evaluate-275"><a href="#OutcomeCountEvaluator.evaluate-275"><span class="linenos">275</span></a>                <span class="n">final_outcomes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.evaluate-276"><a href="#OutcomeCountEvaluator.evaluate-276"><span class="linenos">276</span></a>                <span class="n">final_weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.evaluate-277"><a href="#OutcomeCountEvaluator.evaluate-277"><span class="linenos">277</span></a>
</span><span id="OutcomeCountEvaluator.evaluate-278"><a href="#OutcomeCountEvaluator.evaluate-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Die</span><span class="p">(</span><span class="n">final_outcomes</span><span class="p">,</span> <span class="n">final_weights</span><span class="p">,</span>
</span><span id="OutcomeCountEvaluator.evaluate-279"><a href="#OutcomeCountEvaluator.evaluate-279"><span class="linenos">279</span></a>                           <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">final_kwargs</span><span class="p">(</span><span class="o">*</span><span class="n">converted_generators</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Evaluates generator(s).</p>

<p>You can call the <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> object directly for the same effect,
e.g. <code>sum_evaluator(generator)</code> is an alias for <code>sum_evaluator.evaluate(generator)</code>.</p>

<p>Most evaluators will expect a fixed number of generators.
The union of the outcomes of the generator(s) must be totally orderable.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*generators:</strong>  Each element may be one of the following:
<ul>
<li>A <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>.</li>
<li>A mappable mapping dice to the number of those dice.</li>
<li>A sequence of arguments to create a <code><a href="#Pool">Pool</a></code>.</li>
</ul></li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A <code><a href="#Die">Die</a></code> representing the distribution of the final score.</p>
</blockquote>
</div>


                            </div>
                            <div id="OutcomeCountEvaluator.sample" class="classattr">
                                        <input id="OutcomeCountEvaluator.sample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sample</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span><span class="p">,</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="OutcomeCountEvaluator.sample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OutcomeCountEvaluator.sample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OutcomeCountEvaluator.sample-441"><a href="#OutcomeCountEvaluator.sample-441"><span class="linenos">441</span></a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span> <span class="o">|</span>
</span><span id="OutcomeCountEvaluator.sample-442"><a href="#OutcomeCountEvaluator.sample-442"><span class="linenos">442</span></a>               <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">):</span>
</span><span id="OutcomeCountEvaluator.sample-443"><a href="#OutcomeCountEvaluator.sample-443"><span class="linenos">443</span></a>        <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Samples one result from the generator(s) and evaluates the result.&quot;&quot;&quot;</span>
</span><span id="OutcomeCountEvaluator.sample-444"><a href="#OutcomeCountEvaluator.sample-444"><span class="linenos">444</span></a>        <span class="c1"># Convert non-`Pool` arguments to `Pool`.</span>
</span><span id="OutcomeCountEvaluator.sample-445"><a href="#OutcomeCountEvaluator.sample-445"><span class="linenos">445</span></a>        <span class="n">converted_generators</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.sample-446"><a href="#OutcomeCountEvaluator.sample-446"><span class="linenos">446</span></a>            <span class="n">generator</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span>
</span><span id="OutcomeCountEvaluator.sample-447"><a href="#OutcomeCountEvaluator.sample-447"><span class="linenos">447</span></a>                                   <span class="p">)</span> <span class="k">else</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">generator</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.sample-448"><a href="#OutcomeCountEvaluator.sample-448"><span class="linenos">448</span></a>            <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">generators</span><span class="p">)</span>
</span><span id="OutcomeCountEvaluator.sample-449"><a href="#OutcomeCountEvaluator.sample-449"><span class="linenos">449</span></a>
</span><span id="OutcomeCountEvaluator.sample-450"><a href="#OutcomeCountEvaluator.sample-450"><span class="linenos">450</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="o">*</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span>
</span><span id="OutcomeCountEvaluator.sample-451"><a href="#OutcomeCountEvaluator.sample-451"><span class="linenos">451</span></a>            <span class="n">generator</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span> <span class="k">for</span> <span class="n">generator</span> <span class="ow">in</span> <span class="n">converted_generators</span><span class="p">))</span>
</span><span id="OutcomeCountEvaluator.sample-452"><a href="#OutcomeCountEvaluator.sample-452"><span class="linenos">452</span></a>
</span><span id="OutcomeCountEvaluator.sample-453"><a href="#OutcomeCountEvaluator.sample-453"><span class="linenos">453</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
</span><span id="OutcomeCountEvaluator.sample-454"><a href="#OutcomeCountEvaluator.sample-454"><span class="linenos">454</span></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="OutcomeCountEvaluator.sample-455"><a href="#OutcomeCountEvaluator.sample-455"><span class="linenos">455</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="OutcomeCountEvaluator.sample-456"><a href="#OutcomeCountEvaluator.sample-456"><span class="linenos">456</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Samples one result from the generator(s) and evaluates the result.</p>
</div>


                            </div>
                </section>
                <section id="Order">
                            <input id="Order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Order</span><wbr>(<span class="base">enum.IntEnum</span>):

                <label class="view-source-button" for="Order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Order-20"><a href="#Order-20"><span class="linenos">20</span></a><span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span id="Order-21"><a href="#Order-21"><span class="linenos">21</span></a>    <span class="sd">&quot;&quot;&quot;Can be used to define what order outcomes are seen in by OutcomeCountEvaluators.&quot;&quot;&quot;</span>
</span><span id="Order-22"><a href="#Order-22"><span class="linenos">22</span></a>    <span class="n">Ascending</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Order-23"><a href="#Order-23"><span class="linenos">23</span></a>    <span class="n">Descending</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="Order-24"><a href="#Order-24"><span class="linenos">24</span></a>    <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Can be used to define what order outcomes are seen in by OutcomeCountEvaluators.</p>
</div>


                            <div id="Order.Ascending" class="classattr">
                                <div class="attr variable">
            <span class="name">Ascending</span><span class="default_value"> = &lt;<a href="#Order.Ascending">Order.Ascending</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#Order.Ascending"></a>
    
    

                            </div>
                            <div id="Order.Descending" class="classattr">
                                <div class="attr variable">
            <span class="name">Descending</span><span class="default_value"> = &lt;<a href="#Order.Descending">Order.Descending</a>: -1&gt;</span>

        
    </div>
    <a class="headerlink" href="#Order.Descending"></a>
    
    

                            </div>
                            <div id="Order.Any" class="classattr">
                                <div class="attr variable">
            <span class="name">Any</span><span class="default_value"> = &lt;<a href="#Order.Any">Order.Any</a>: 0&gt;</span>

        
    </div>
    <a class="headerlink" href="#Order.Any"></a>
    
    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="Order.name" class="variable">name</dd>
                <dd id="Order.value" class="variable">value</dd>

            </div>
            <div><dt>builtins.int</dt>
                                <dd id="Order.conjugate" class="function">conjugate</dd>
                <dd id="Order.bit_length" class="function">bit_length</dd>
                <dd id="Order.bit_count" class="function">bit_count</dd>
                <dd id="Order.to_bytes" class="function">to_bytes</dd>
                <dd id="Order.from_bytes" class="function">from_bytes</dd>
                <dd id="Order.as_integer_ratio" class="function">as_integer_ratio</dd>
                <dd id="Order.real" class="variable">real</dd>
                <dd id="Order.imag" class="variable">imag</dd>
                <dd id="Order.numerator" class="variable">numerator</dd>
                <dd id="Order.denominator" class="variable">denominator</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="JointEvaluator">
                            <input id="JointEvaluator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">JointEvaluator</span><wbr>(<span class="base"><a href="#OutcomeCountEvaluator">icepool.OutcomeCountEvaluator</a></span>):

                <label class="view-source-button" for="JointEvaluator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JointEvaluator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JointEvaluator-32"><a href="#JointEvaluator-32"><span class="linenos">32</span></a><span class="k">class</span> <span class="nc">JointEvaluator</span><span class="p">(</span><span class="n">OutcomeCountEvaluator</span><span class="p">):</span>
</span><span id="JointEvaluator-33"><a href="#JointEvaluator-33"><span class="linenos">33</span></a>    <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: An `OutcomeCountEvaluator` that jointly evaluates sub-evaluators on the same roll(s) of a generator.</span>
</span><span id="JointEvaluator-34"><a href="#JointEvaluator-34"><span class="linenos">34</span></a>
</span><span id="JointEvaluator-35"><a href="#JointEvaluator-35"><span class="linenos">35</span></a><span class="sd">    It may be more efficient to write the joint evaluation directly; this is</span>
</span><span id="JointEvaluator-36"><a href="#JointEvaluator-36"><span class="linenos">36</span></a><span class="sd">    provided as a convenience.</span>
</span><span id="JointEvaluator-37"><a href="#JointEvaluator-37"><span class="linenos">37</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="JointEvaluator-38"><a href="#JointEvaluator-38"><span class="linenos">38</span></a>
</span><span id="JointEvaluator-39"><a href="#JointEvaluator-39"><span class="linenos">39</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sub_evaluators</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">):</span>
</span><span id="JointEvaluator-40"><a href="#JointEvaluator-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span> <span class="o">=</span> <span class="n">sub_evaluators</span>
</span><span id="JointEvaluator-41"><a href="#JointEvaluator-41"><span class="linenos">41</span></a>
</span><span id="JointEvaluator-42"><a href="#JointEvaluator-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="JointEvaluator-43"><a href="#JointEvaluator-43"><span class="linenos">43</span></a>        <span class="sd">&quot;&quot;&quot;Runs `next_state` for all subevals.</span>
</span><span id="JointEvaluator-44"><a href="#JointEvaluator-44"><span class="linenos">44</span></a>
</span><span id="JointEvaluator-45"><a href="#JointEvaluator-45"><span class="linenos">45</span></a><span class="sd">        The state is a tuple of the substates.</span>
</span><span id="JointEvaluator-46"><a href="#JointEvaluator-46"><span class="linenos">46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JointEvaluator-47"><a href="#JointEvaluator-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="JointEvaluator-48"><a href="#JointEvaluator-48"><span class="linenos">48</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator-49"><a href="#JointEvaluator-49"><span class="linenos">49</span></a>                <span class="n">evaluator</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="JointEvaluator-50"><a href="#JointEvaluator-50"><span class="linenos">50</span></a>                <span class="k">for</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">)</span>
</span><span id="JointEvaluator-51"><a href="#JointEvaluator-51"><span class="linenos">51</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JointEvaluator-52"><a href="#JointEvaluator-52"><span class="linenos">52</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator-53"><a href="#JointEvaluator-53"><span class="linenos">53</span></a>                <span class="n">evaluator</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">substate</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="JointEvaluator-54"><a href="#JointEvaluator-54"><span class="linenos">54</span></a>                <span class="k">for</span> <span class="n">evaluator</span><span class="p">,</span> <span class="n">substate</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">,</span> <span class="n">state</span><span class="p">))</span>
</span><span id="JointEvaluator-55"><a href="#JointEvaluator-55"><span class="linenos">55</span></a>
</span><span id="JointEvaluator-56"><a href="#JointEvaluator-56"><span class="linenos">56</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span>
</span><span id="JointEvaluator-57"><a href="#JointEvaluator-57"><span class="linenos">57</span></a>                      <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">):</span>
</span><span id="JointEvaluator-58"><a href="#JointEvaluator-58"><span class="linenos">58</span></a>        <span class="sd">&quot;&quot;&quot;Runs `final_state` for all subevals.</span>
</span><span id="JointEvaluator-59"><a href="#JointEvaluator-59"><span class="linenos">59</span></a>
</span><span id="JointEvaluator-60"><a href="#JointEvaluator-60"><span class="linenos">60</span></a><span class="sd">        The final outcome is a tuple of the final suboutcomes.</span>
</span><span id="JointEvaluator-61"><a href="#JointEvaluator-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JointEvaluator-62"><a href="#JointEvaluator-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator-63"><a href="#JointEvaluator-63"><span class="linenos">63</span></a>            <span class="n">evaluator</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_substate</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span> <span class="k">for</span> <span class="n">evaluator</span><span class="p">,</span>
</span><span id="JointEvaluator-64"><a href="#JointEvaluator-64"><span class="linenos">64</span></a>            <span class="n">final_substate</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">,</span> <span class="n">final_state</span><span class="p">))</span>
</span><span id="JointEvaluator-65"><a href="#JointEvaluator-65"><span class="linenos">65</span></a>
</span><span id="JointEvaluator-66"><a href="#JointEvaluator-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="JointEvaluator-67"><a href="#JointEvaluator-67"><span class="linenos">67</span></a>        <span class="sd">&quot;&quot;&quot;Determines the common order of the subevals.</span>
</span><span id="JointEvaluator-68"><a href="#JointEvaluator-68"><span class="linenos">68</span></a>
</span><span id="JointEvaluator-69"><a href="#JointEvaluator-69"><span class="linenos">69</span></a><span class="sd">        Raises:</span>
</span><span id="JointEvaluator-70"><a href="#JointEvaluator-70"><span class="linenos">70</span></a><span class="sd">            ValueError: If subevals have conflicting orders, i.e. some are</span>
</span><span id="JointEvaluator-71"><a href="#JointEvaluator-71"><span class="linenos">71</span></a><span class="sd">                ascending and others are descending.</span>
</span><span id="JointEvaluator-72"><a href="#JointEvaluator-72"><span class="linenos">72</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JointEvaluator-73"><a href="#JointEvaluator-73"><span class="linenos">73</span></a>        <span class="n">suborders</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator-74"><a href="#JointEvaluator-74"><span class="linenos">74</span></a>            <span class="n">evaluator</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span> <span class="k">for</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">)</span>
</span><span id="JointEvaluator-75"><a href="#JointEvaluator-75"><span class="linenos">75</span></a>        <span class="n">ascending</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suborders</span><span class="p">)</span>
</span><span id="JointEvaluator-76"><a href="#JointEvaluator-76"><span class="linenos">76</span></a>        <span class="n">descending</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suborders</span><span class="p">)</span>
</span><span id="JointEvaluator-77"><a href="#JointEvaluator-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="n">ascending</span> <span class="ow">and</span> <span class="n">descending</span><span class="p">:</span>
</span><span id="JointEvaluator-78"><a href="#JointEvaluator-78"><span class="linenos">78</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Sub-evals have conflicting orders.&#39;</span><span class="p">)</span>
</span><span id="JointEvaluator-79"><a href="#JointEvaluator-79"><span class="linenos">79</span></a>        <span class="k">elif</span> <span class="n">ascending</span><span class="p">:</span>
</span><span id="JointEvaluator-80"><a href="#JointEvaluator-80"><span class="linenos">80</span></a>            <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="JointEvaluator-81"><a href="#JointEvaluator-81"><span class="linenos">81</span></a>        <span class="k">elif</span> <span class="n">descending</span><span class="p">:</span>
</span><span id="JointEvaluator-82"><a href="#JointEvaluator-82"><span class="linenos">82</span></a>            <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span>
</span><span id="JointEvaluator-83"><a href="#JointEvaluator-83"><span class="linenos">83</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JointEvaluator-84"><a href="#JointEvaluator-84"><span class="linenos">84</span></a>            <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: An <code><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></code> that jointly evaluates sub-evaluators on the same roll(s) of a generator.</p>

<p>It may be more efficient to write the joint evaluation directly; this is
provided as a convenience.</p>
</div>


                            <div id="JointEvaluator.__init__" class="classattr">
                                        <input id="JointEvaluator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">JointEvaluator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span><span class="n">sub_evaluators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountEvaluator">icepool.OutcomeCountEvaluator</a></span></span>)</span>

                <label class="view-source-button" for="JointEvaluator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JointEvaluator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JointEvaluator.__init__-39"><a href="#JointEvaluator.__init__-39"><span class="linenos">39</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">sub_evaluators</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">):</span>
</span><span id="JointEvaluator.__init__-40"><a href="#JointEvaluator.__init__-40"><span class="linenos">40</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span> <span class="o">=</span> <span class="n">sub_evaluators</span>
</span></pre></div>


    

                            </div>
                            <div id="JointEvaluator.next_state" class="classattr">
                                        <input id="JointEvaluator.next_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">outcome</span>, </span><span class="param"><span class="o">*</span><span class="n">counts</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="JointEvaluator.next_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JointEvaluator.next_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JointEvaluator.next_state-42"><a href="#JointEvaluator.next_state-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Hashable</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="JointEvaluator.next_state-43"><a href="#JointEvaluator.next_state-43"><span class="linenos">43</span></a>        <span class="sd">&quot;&quot;&quot;Runs `next_state` for all subevals.</span>
</span><span id="JointEvaluator.next_state-44"><a href="#JointEvaluator.next_state-44"><span class="linenos">44</span></a>
</span><span id="JointEvaluator.next_state-45"><a href="#JointEvaluator.next_state-45"><span class="linenos">45</span></a><span class="sd">        The state is a tuple of the substates.</span>
</span><span id="JointEvaluator.next_state-46"><a href="#JointEvaluator.next_state-46"><span class="linenos">46</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JointEvaluator.next_state-47"><a href="#JointEvaluator.next_state-47"><span class="linenos">47</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="JointEvaluator.next_state-48"><a href="#JointEvaluator.next_state-48"><span class="linenos">48</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator.next_state-49"><a href="#JointEvaluator.next_state-49"><span class="linenos">49</span></a>                <span class="n">evaluator</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="JointEvaluator.next_state-50"><a href="#JointEvaluator.next_state-50"><span class="linenos">50</span></a>                <span class="k">for</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">)</span>
</span><span id="JointEvaluator.next_state-51"><a href="#JointEvaluator.next_state-51"><span class="linenos">51</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JointEvaluator.next_state-52"><a href="#JointEvaluator.next_state-52"><span class="linenos">52</span></a>            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator.next_state-53"><a href="#JointEvaluator.next_state-53"><span class="linenos">53</span></a>                <span class="n">evaluator</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">substate</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="o">*</span><span class="n">counts</span><span class="p">)</span>
</span><span id="JointEvaluator.next_state-54"><a href="#JointEvaluator.next_state-54"><span class="linenos">54</span></a>                <span class="k">for</span> <span class="n">evaluator</span><span class="p">,</span> <span class="n">substate</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">,</span> <span class="n">state</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Runs <code><a href="#JointEvaluator.next_state">next_state</a></code> for all subevals.</p>

<p>The state is a tuple of the substates.</p>
</div>


                            </div>
                            <div id="JointEvaluator.final_outcome" class="classattr">
                                        <input id="JointEvaluator.final_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_outcome</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">final_state</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="JointEvaluator.final_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JointEvaluator.final_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JointEvaluator.final_outcome-56"><a href="#JointEvaluator.final_outcome-56"><span class="linenos">56</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span>
</span><span id="JointEvaluator.final_outcome-57"><a href="#JointEvaluator.final_outcome-57"><span class="linenos">57</span></a>                      <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">):</span>
</span><span id="JointEvaluator.final_outcome-58"><a href="#JointEvaluator.final_outcome-58"><span class="linenos">58</span></a>        <span class="sd">&quot;&quot;&quot;Runs `final_state` for all subevals.</span>
</span><span id="JointEvaluator.final_outcome-59"><a href="#JointEvaluator.final_outcome-59"><span class="linenos">59</span></a>
</span><span id="JointEvaluator.final_outcome-60"><a href="#JointEvaluator.final_outcome-60"><span class="linenos">60</span></a><span class="sd">        The final outcome is a tuple of the final suboutcomes.</span>
</span><span id="JointEvaluator.final_outcome-61"><a href="#JointEvaluator.final_outcome-61"><span class="linenos">61</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JointEvaluator.final_outcome-62"><a href="#JointEvaluator.final_outcome-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator.final_outcome-63"><a href="#JointEvaluator.final_outcome-63"><span class="linenos">63</span></a>            <span class="n">evaluator</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_substate</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span> <span class="k">for</span> <span class="n">evaluator</span><span class="p">,</span>
</span><span id="JointEvaluator.final_outcome-64"><a href="#JointEvaluator.final_outcome-64"><span class="linenos">64</span></a>            <span class="n">final_substate</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">,</span> <span class="n">final_state</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Runs <code>final_state</code> for all subevals.</p>

<p>The final outcome is a tuple of the final suboutcomes.</p>
</div>


                            </div>
                            <div id="JointEvaluator.order" class="classattr">
                                        <input id="JointEvaluator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span></span><span class="return-annotation">) -> <span class="n"><a href="#Order">icepool.Order</a></span>:</span></span>

                <label class="view-source-button" for="JointEvaluator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#JointEvaluator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="JointEvaluator.order-66"><a href="#JointEvaluator.order-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">:</span> <span class="n">icepool</span><span class="o">.</span><span class="n">OutcomeCountGenerator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
</span><span id="JointEvaluator.order-67"><a href="#JointEvaluator.order-67"><span class="linenos">67</span></a>        <span class="sd">&quot;&quot;&quot;Determines the common order of the subevals.</span>
</span><span id="JointEvaluator.order-68"><a href="#JointEvaluator.order-68"><span class="linenos">68</span></a>
</span><span id="JointEvaluator.order-69"><a href="#JointEvaluator.order-69"><span class="linenos">69</span></a><span class="sd">        Raises:</span>
</span><span id="JointEvaluator.order-70"><a href="#JointEvaluator.order-70"><span class="linenos">70</span></a><span class="sd">            ValueError: If subevals have conflicting orders, i.e. some are</span>
</span><span id="JointEvaluator.order-71"><a href="#JointEvaluator.order-71"><span class="linenos">71</span></a><span class="sd">                ascending and others are descending.</span>
</span><span id="JointEvaluator.order-72"><a href="#JointEvaluator.order-72"><span class="linenos">72</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="JointEvaluator.order-73"><a href="#JointEvaluator.order-73"><span class="linenos">73</span></a>        <span class="n">suborders</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
</span><span id="JointEvaluator.order-74"><a href="#JointEvaluator.order-74"><span class="linenos">74</span></a>            <span class="n">evaluator</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span> <span class="k">for</span> <span class="n">evaluator</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_evaluators</span><span class="p">)</span>
</span><span id="JointEvaluator.order-75"><a href="#JointEvaluator.order-75"><span class="linenos">75</span></a>        <span class="n">ascending</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suborders</span><span class="p">)</span>
</span><span id="JointEvaluator.order-76"><a href="#JointEvaluator.order-76"><span class="linenos">76</span></a>        <span class="n">descending</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">suborders</span><span class="p">)</span>
</span><span id="JointEvaluator.order-77"><a href="#JointEvaluator.order-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="n">ascending</span> <span class="ow">and</span> <span class="n">descending</span><span class="p">:</span>
</span><span id="JointEvaluator.order-78"><a href="#JointEvaluator.order-78"><span class="linenos">78</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Sub-evals have conflicting orders.&#39;</span><span class="p">)</span>
</span><span id="JointEvaluator.order-79"><a href="#JointEvaluator.order-79"><span class="linenos">79</span></a>        <span class="k">elif</span> <span class="n">ascending</span><span class="p">:</span>
</span><span id="JointEvaluator.order-80"><a href="#JointEvaluator.order-80"><span class="linenos">80</span></a>            <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Ascending</span>
</span><span id="JointEvaluator.order-81"><a href="#JointEvaluator.order-81"><span class="linenos">81</span></a>        <span class="k">elif</span> <span class="n">descending</span><span class="p">:</span>
</span><span id="JointEvaluator.order-82"><a href="#JointEvaluator.order-82"><span class="linenos">82</span></a>            <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Descending</span>
</span><span id="JointEvaluator.order-83"><a href="#JointEvaluator.order-83"><span class="linenos">83</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="JointEvaluator.order-84"><a href="#JointEvaluator.order-84"><span class="linenos">84</span></a>            <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span></pre></div>


            <div class="docstring"><p>Determines the common order of the subevals.</p>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If subevals have conflicting orders, i.e. some are
ascending and others are descending.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></dt>
                                <dd id="JointEvaluator.alignment" class="function"><a href="#OutcomeCountEvaluator.alignment">alignment</a></dd>
                <dd id="JointEvaluator.range_alignment" class="function"><a href="#OutcomeCountEvaluator.range_alignment">range_alignment</a></dd>
                <dd id="JointEvaluator.final_kwargs" class="function"><a href="#OutcomeCountEvaluator.final_kwargs">final_kwargs</a></dd>
                <dd id="JointEvaluator.evaluate" class="function"><a href="#OutcomeCountEvaluator.evaluate">evaluate</a></dd>
                <dd id="JointEvaluator.sample" class="function"><a href="#OutcomeCountEvaluator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SumEvaluator">
                            <input id="SumEvaluator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SumEvaluator</span><wbr>(<span class="base"><a href="#OutcomeCountEvaluator">icepool.OutcomeCountEvaluator</a></span>):

                <label class="view-source-button" for="SumEvaluator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SumEvaluator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SumEvaluator-87"><a href="#SumEvaluator-87"><span class="linenos"> 87</span></a><span class="k">class</span> <span class="nc">SumEvaluator</span><span class="p">(</span><span class="n">OutcomeCountEvaluator</span><span class="p">):</span>
</span><span id="SumEvaluator-88"><a href="#SumEvaluator-88"><span class="linenos"> 88</span></a>    <span class="sd">&quot;&quot;&quot;Sums all outcomes.&quot;&quot;&quot;</span>
</span><span id="SumEvaluator-89"><a href="#SumEvaluator-89"><span class="linenos"> 89</span></a>
</span><span id="SumEvaluator-90"><a href="#SumEvaluator-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SumEvaluator-91"><a href="#SumEvaluator-91"><span class="linenos"> 91</span></a>                 <span class="o">*</span><span class="p">,</span>
</span><span id="SumEvaluator-92"><a href="#SumEvaluator-92"><span class="linenos"> 92</span></a>                 <span class="n">sub</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="SumEvaluator-93"><a href="#SumEvaluator-93"><span class="linenos"> 93</span></a>
</span><span id="SumEvaluator-94"><a href="#SumEvaluator-94"><span class="linenos"> 94</span></a>        <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SumEvaluator-95"><a href="#SumEvaluator-95"><span class="linenos"> 95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">outcome</span>
</span><span id="SumEvaluator-96"><a href="#SumEvaluator-96"><span class="linenos"> 96</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">sub</span><span class="p">):</span>
</span><span id="SumEvaluator-97"><a href="#SumEvaluator-97"><span class="linenos"> 97</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span> <span class="o">=</span> <span class="n">sub</span>
</span><span id="SumEvaluator-98"><a href="#SumEvaluator-98"><span class="linenos"> 98</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SumEvaluator-99"><a href="#SumEvaluator-99"><span class="linenos"> 99</span></a>            <span class="c1"># sub is a mapping.</span>
</span><span id="SumEvaluator-100"><a href="#SumEvaluator-100"><span class="linenos">100</span></a>            <span class="k">def</span> <span class="nf">sub_final</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="SumEvaluator-101"><a href="#SumEvaluator-101"><span class="linenos">101</span></a>                <span class="k">return</span> <span class="n">sub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="SumEvaluator-102"><a href="#SumEvaluator-102"><span class="linenos">102</span></a>
</span><span id="SumEvaluator-103"><a href="#SumEvaluator-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span> <span class="o">=</span> <span class="n">sub_final</span>
</span><span id="SumEvaluator-104"><a href="#SumEvaluator-104"><span class="linenos">104</span></a>
</span><span id="SumEvaluator-105"><a href="#SumEvaluator-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="SumEvaluator-106"><a href="#SumEvaluator-106"><span class="linenos">106</span></a>        <span class="sd">&quot;&quot;&quot;Add the outcomes to the running total. &quot;&quot;&quot;</span>
</span><span id="SumEvaluator-107"><a href="#SumEvaluator-107"><span class="linenos">107</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="SumEvaluator-108"><a href="#SumEvaluator-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SumEvaluator-109"><a href="#SumEvaluator-109"><span class="linenos">109</span></a>            <span class="k">return</span> <span class="n">outcome</span> <span class="o">*</span> <span class="n">count</span>
</span><span id="SumEvaluator-110"><a href="#SumEvaluator-110"><span class="linenos">110</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SumEvaluator-111"><a href="#SumEvaluator-111"><span class="linenos">111</span></a>            <span class="k">return</span> <span class="n">state</span> <span class="o">+</span> <span class="n">outcome</span> <span class="o">*</span> <span class="n">count</span>
</span><span id="SumEvaluator-112"><a href="#SumEvaluator-112"><span class="linenos">112</span></a>
</span><span id="SumEvaluator-113"><a href="#SumEvaluator-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="SumEvaluator-114"><a href="#SumEvaluator-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">final_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SumEvaluator-115"><a href="#SumEvaluator-115"><span class="linenos">115</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="SumEvaluator-116"><a href="#SumEvaluator-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SumEvaluator-117"><a href="#SumEvaluator-117"><span class="linenos">117</span></a>            <span class="k">return</span> <span class="n">final_state</span>
</span><span id="SumEvaluator-118"><a href="#SumEvaluator-118"><span class="linenos">118</span></a>
</span><span id="SumEvaluator-119"><a href="#SumEvaluator-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="SumEvaluator-120"><a href="#SumEvaluator-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span></pre></div>


            <div class="docstring"><p>Sums all outcomes.</p>
</div>


                            <div id="SumEvaluator.__init__" class="classattr">
                                        <input id="SumEvaluator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SumEvaluator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">sub</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="SumEvaluator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SumEvaluator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SumEvaluator.__init__-90"><a href="#SumEvaluator.__init__-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="SumEvaluator.__init__-91"><a href="#SumEvaluator.__init__-91"><span class="linenos"> 91</span></a>                 <span class="o">*</span><span class="p">,</span>
</span><span id="SumEvaluator.__init__-92"><a href="#SumEvaluator.__init__-92"><span class="linenos"> 92</span></a>                 <span class="n">sub</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="SumEvaluator.__init__-93"><a href="#SumEvaluator.__init__-93"><span class="linenos"> 93</span></a>
</span><span id="SumEvaluator.__init__-94"><a href="#SumEvaluator.__init__-94"><span class="linenos"> 94</span></a>        <span class="k">if</span> <span class="n">sub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SumEvaluator.__init__-95"><a href="#SumEvaluator.__init__-95"><span class="linenos"> 95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">outcome</span><span class="p">:</span> <span class="n">outcome</span>
</span><span id="SumEvaluator.__init__-96"><a href="#SumEvaluator.__init__-96"><span class="linenos"> 96</span></a>        <span class="k">elif</span> <span class="n">callable</span><span class="p">(</span><span class="n">sub</span><span class="p">):</span>
</span><span id="SumEvaluator.__init__-97"><a href="#SumEvaluator.__init__-97"><span class="linenos"> 97</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span> <span class="o">=</span> <span class="n">sub</span>
</span><span id="SumEvaluator.__init__-98"><a href="#SumEvaluator.__init__-98"><span class="linenos"> 98</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SumEvaluator.__init__-99"><a href="#SumEvaluator.__init__-99"><span class="linenos"> 99</span></a>            <span class="c1"># sub is a mapping.</span>
</span><span id="SumEvaluator.__init__-100"><a href="#SumEvaluator.__init__-100"><span class="linenos">100</span></a>            <span class="k">def</span> <span class="nf">sub_final</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="SumEvaluator.__init__-101"><a href="#SumEvaluator.__init__-101"><span class="linenos">101</span></a>                <span class="k">return</span> <span class="n">sub</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span>
</span><span id="SumEvaluator.__init__-102"><a href="#SumEvaluator.__init__-102"><span class="linenos">102</span></a>
</span><span id="SumEvaluator.__init__-103"><a href="#SumEvaluator.__init__-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span> <span class="o">=</span> <span class="n">sub_final</span>
</span></pre></div>


    

                            </div>
                            <div id="SumEvaluator.next_state" class="classattr">
                                        <input id="SumEvaluator.next_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">outcome</span>, </span><span class="param"><span class="n">count</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SumEvaluator.next_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SumEvaluator.next_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SumEvaluator.next_state-105"><a href="#SumEvaluator.next_state-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="SumEvaluator.next_state-106"><a href="#SumEvaluator.next_state-106"><span class="linenos">106</span></a>        <span class="sd">&quot;&quot;&quot;Add the outcomes to the running total. &quot;&quot;&quot;</span>
</span><span id="SumEvaluator.next_state-107"><a href="#SumEvaluator.next_state-107"><span class="linenos">107</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="SumEvaluator.next_state-108"><a href="#SumEvaluator.next_state-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SumEvaluator.next_state-109"><a href="#SumEvaluator.next_state-109"><span class="linenos">109</span></a>            <span class="k">return</span> <span class="n">outcome</span> <span class="o">*</span> <span class="n">count</span>
</span><span id="SumEvaluator.next_state-110"><a href="#SumEvaluator.next_state-110"><span class="linenos">110</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SumEvaluator.next_state-111"><a href="#SumEvaluator.next_state-111"><span class="linenos">111</span></a>            <span class="k">return</span> <span class="n">state</span> <span class="o">+</span> <span class="n">outcome</span> <span class="o">*</span> <span class="n">count</span>
</span></pre></div>


            <div class="docstring"><p>Add the outcomes to the running total.</p>
</div>


                            </div>
                            <div id="SumEvaluator.final_outcome" class="classattr">
                                        <input id="SumEvaluator.final_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">final_state</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SumEvaluator.final_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SumEvaluator.final_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SumEvaluator.final_outcome-113"><a href="#SumEvaluator.final_outcome-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="SumEvaluator.final_outcome-114"><a href="#SumEvaluator.final_outcome-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">final_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SumEvaluator.final_outcome-115"><a href="#SumEvaluator.final_outcome-115"><span class="linenos">115</span></a>            <span class="k">return</span> <span class="mi">0</span>
</span><span id="SumEvaluator.final_outcome-116"><a href="#SumEvaluator.final_outcome-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SumEvaluator.final_outcome-117"><a href="#SumEvaluator.final_outcome-117"><span class="linenos">117</span></a>            <span class="k">return</span> <span class="n">final_state</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to generate a final outcome from a final state.</p>

<p>Tthere is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>By default, the final outcome is equal to the final state.
Note that <code>None</code> is not a valid outcome for a <code><a href="#Die">Die</a></code>,
and if there are no outcomes, the final state will be <code>None</code>.
Subclasses that want to handle this case should explicitly define what
happens.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>final_state:</strong>  A state after all outcomes have been processed.</li>
<li><strong>*generators:</strong>  One or more <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A final outcome that will be used as part of constructing the result <code><a href="#Die">Die</a></code>.
  As usual for <code><a href="#Die">Die()</a></code>, this could itself be a <code><a href="#Die">Die</a></code> or <code><a href="#Reroll">icepool.Reroll</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="SumEvaluator.order" class="classattr">
                                        <input id="SumEvaluator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SumEvaluator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SumEvaluator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SumEvaluator.order-119"><a href="#SumEvaluator.order-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="SumEvaluator.order-120"><a href="#SumEvaluator.order-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to determine the order in which <code><a href="#SumEvaluator.next_state">next_state()</a></code> will see outcomes.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default is ascending order. This works well with mixed standard dice,
and other dice that differ only by right-truncation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*generators:</strong>  One or more <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <ul>
  <li><a href="#Order.Ascending">Order.Ascending</a> (= 1)
  if <code><a href="#SumEvaluator.next_state">next_state()</a></code> should always see the outcomes in ascending order.</li>
  <li><a href="#Order.Descending">Order.Descending</a> (= -1)
  if <code><a href="#SumEvaluator.next_state">next_state()</a></code> should always see the outcomes in descending order.</li>
  <li><a href="#Order.Any">Order.Any</a> (= 0)
  if the result of the evaluation is order-independent.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></dt>
                                <dd id="SumEvaluator.alignment" class="function"><a href="#OutcomeCountEvaluator.alignment">alignment</a></dd>
                <dd id="SumEvaluator.range_alignment" class="function"><a href="#OutcomeCountEvaluator.range_alignment">range_alignment</a></dd>
                <dd id="SumEvaluator.final_kwargs" class="function"><a href="#OutcomeCountEvaluator.final_kwargs">final_kwargs</a></dd>
                <dd id="SumEvaluator.evaluate" class="function"><a href="#OutcomeCountEvaluator.evaluate">evaluate</a></dd>
                <dd id="SumEvaluator.sample" class="function"><a href="#OutcomeCountEvaluator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ExpandEvaluator">
                            <input id="ExpandEvaluator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ExpandEvaluator</span><wbr>(<span class="base"><a href="#OutcomeCountEvaluator">icepool.OutcomeCountEvaluator</a></span>):

                <label class="view-source-button" for="ExpandEvaluator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ExpandEvaluator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ExpandEvaluator-126"><a href="#ExpandEvaluator-126"><span class="linenos">126</span></a><span class="k">class</span> <span class="nc">ExpandEvaluator</span><span class="p">(</span><span class="n">OutcomeCountEvaluator</span><span class="p">):</span>
</span><span id="ExpandEvaluator-127"><a href="#ExpandEvaluator-127"><span class="linenos">127</span></a>    <span class="sd">&quot;&quot;&quot;Expands all results of a generator.</span>
</span><span id="ExpandEvaluator-128"><a href="#ExpandEvaluator-128"><span class="linenos">128</span></a>
</span><span id="ExpandEvaluator-129"><a href="#ExpandEvaluator-129"><span class="linenos">129</span></a><span class="sd">    This is expensive and not recommended unless there are few possibilities.</span>
</span><span id="ExpandEvaluator-130"><a href="#ExpandEvaluator-130"><span class="linenos">130</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ExpandEvaluator-131"><a href="#ExpandEvaluator-131"><span class="linenos">131</span></a>
</span><span id="ExpandEvaluator-132"><a href="#ExpandEvaluator-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ExpandEvaluator-133"><a href="#ExpandEvaluator-133"><span class="linenos">133</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ExpandEvaluator-134"><a href="#ExpandEvaluator-134"><span class="linenos">134</span></a><span class="sd">        Args:</span>
</span><span id="ExpandEvaluator-135"><a href="#ExpandEvaluator-135"><span class="linenos">135</span></a><span class="sd">            unique: Iff `True`, duplicate outcomes count only as one.</span>
</span><span id="ExpandEvaluator-136"><a href="#ExpandEvaluator-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ExpandEvaluator-137"><a href="#ExpandEvaluator-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span> <span class="o">=</span> <span class="n">unique</span>
</span><span id="ExpandEvaluator-138"><a href="#ExpandEvaluator-138"><span class="linenos">138</span></a>
</span><span id="ExpandEvaluator-139"><a href="#ExpandEvaluator-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="ExpandEvaluator-140"><a href="#ExpandEvaluator-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ExpandEvaluator-141"><a href="#ExpandEvaluator-141"><span class="linenos">141</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ExpandEvaluator-142"><a href="#ExpandEvaluator-142"><span class="linenos">142</span></a>                <span class="s1">&#39;EnumerateGenerator is not compatible with negative counts.&#39;</span><span class="p">)</span>
</span><span id="ExpandEvaluator-143"><a href="#ExpandEvaluator-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span><span class="p">:</span>
</span><span id="ExpandEvaluator-144"><a href="#ExpandEvaluator-144"><span class="linenos">144</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ExpandEvaluator-145"><a href="#ExpandEvaluator-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ExpandEvaluator-146"><a href="#ExpandEvaluator-146"><span class="linenos">146</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">outcome</span><span class="p">,)</span> <span class="o">*</span> <span class="n">count</span>
</span><span id="ExpandEvaluator-147"><a href="#ExpandEvaluator-147"><span class="linenos">147</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ExpandEvaluator-148"><a href="#ExpandEvaluator-148"><span class="linenos">148</span></a>            <span class="k">return</span> <span class="n">state</span> <span class="o">+</span> <span class="p">(</span><span class="n">outcome</span><span class="p">,)</span> <span class="o">*</span> <span class="n">count</span>
</span><span id="ExpandEvaluator-149"><a href="#ExpandEvaluator-149"><span class="linenos">149</span></a>
</span><span id="ExpandEvaluator-150"><a href="#ExpandEvaluator-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="ExpandEvaluator-151"><a href="#ExpandEvaluator-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span><span id="ExpandEvaluator-152"><a href="#ExpandEvaluator-152"><span class="linenos">152</span></a>
</span><span id="ExpandEvaluator-153"><a href="#ExpandEvaluator-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="ExpandEvaluator-154"><a href="#ExpandEvaluator-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">final_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ExpandEvaluator-155"><a href="#ExpandEvaluator-155"><span class="linenos">155</span></a>            <span class="k">return</span> <span class="p">()</span>
</span><span id="ExpandEvaluator-156"><a href="#ExpandEvaluator-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">final_state</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Expands all results of a generator.</p>

<p>This is expensive and not recommended unless there are few possibilities.</p>
</div>


                            <div id="ExpandEvaluator.__init__" class="classattr">
                                        <input id="ExpandEvaluator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ExpandEvaluator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span>, </span><span class="param"><span class="n">unique</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="ExpandEvaluator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ExpandEvaluator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ExpandEvaluator.__init__-132"><a href="#ExpandEvaluator.__init__-132"><span class="linenos">132</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="ExpandEvaluator.__init__-133"><a href="#ExpandEvaluator.__init__-133"><span class="linenos">133</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="ExpandEvaluator.__init__-134"><a href="#ExpandEvaluator.__init__-134"><span class="linenos">134</span></a><span class="sd">        Args:</span>
</span><span id="ExpandEvaluator.__init__-135"><a href="#ExpandEvaluator.__init__-135"><span class="linenos">135</span></a><span class="sd">            unique: Iff `True`, duplicate outcomes count only as one.</span>
</span><span id="ExpandEvaluator.__init__-136"><a href="#ExpandEvaluator.__init__-136"><span class="linenos">136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ExpandEvaluator.__init__-137"><a href="#ExpandEvaluator.__init__-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span> <span class="o">=</span> <span class="n">unique</span>
</span></pre></div>


            <div class="docstring"><h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>unique:</strong>  Iff <code>True</code>, duplicate outcomes count only as one.</li>
</ul>
</div>


                            </div>
                            <div id="ExpandEvaluator.next_state" class="classattr">
                                        <input id="ExpandEvaluator.next_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">outcome</span>, </span><span class="param"><span class="n">count</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ExpandEvaluator.next_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ExpandEvaluator.next_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ExpandEvaluator.next_state-139"><a href="#ExpandEvaluator.next_state-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="ExpandEvaluator.next_state-140"><a href="#ExpandEvaluator.next_state-140"><span class="linenos">140</span></a>        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ExpandEvaluator.next_state-141"><a href="#ExpandEvaluator.next_state-141"><span class="linenos">141</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ExpandEvaluator.next_state-142"><a href="#ExpandEvaluator.next_state-142"><span class="linenos">142</span></a>                <span class="s1">&#39;EnumerateGenerator is not compatible with negative counts.&#39;</span><span class="p">)</span>
</span><span id="ExpandEvaluator.next_state-143"><a href="#ExpandEvaluator.next_state-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unique</span><span class="p">:</span>
</span><span id="ExpandEvaluator.next_state-144"><a href="#ExpandEvaluator.next_state-144"><span class="linenos">144</span></a>            <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ExpandEvaluator.next_state-145"><a href="#ExpandEvaluator.next_state-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ExpandEvaluator.next_state-146"><a href="#ExpandEvaluator.next_state-146"><span class="linenos">146</span></a>            <span class="k">return</span> <span class="p">(</span><span class="n">outcome</span><span class="p">,)</span> <span class="o">*</span> <span class="n">count</span>
</span><span id="ExpandEvaluator.next_state-147"><a href="#ExpandEvaluator.next_state-147"><span class="linenos">147</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ExpandEvaluator.next_state-148"><a href="#ExpandEvaluator.next_state-148"><span class="linenos">148</span></a>            <span class="k">return</span> <span class="n">state</span> <span class="o">+</span> <span class="p">(</span><span class="n">outcome</span><span class="p">,)</span> <span class="o">*</span> <span class="n">count</span>
</span></pre></div>


            <div class="docstring"><p>State transition function.</p>

<p>This should produce a state given the previous state, an outcome,
and the number that outcome produced by each generator.</p>

<p><code><a href="#ExpandEvaluator.evaluate">evaluate()</a></code> will always call this using only positional arguments.
Furthermore, there is no expectation that a subclass be able to handle
an arbitrary number of counts. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*counts</code> with a fixed set
of parameters.</p>

<p>Make sure to handle the base case where <code>state is None</code>.</p>

<p>States must be hashable. At current, they do not have to be orderable.
However, this may change in the future, and if they are not totally
orderable, you must override <code><a href="#ExpandEvaluator.final_outcome">final_outcome</a></code> to create totally orderable
final outcomes.</p>

<p>The behavior of returning a <code><a href="#Die">Die</a></code> from <code><a href="#ExpandEvaluator.next_state">next_state</a></code> is currently
undefined.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>state:</strong>  A hashable object indicating the state before rolling the
current outcome. If this is the first outcome being considered,
<code>state</code> will be <code>None</code>.</li>
<li><strong>outcome:</strong>  The current outcome.
<code><a href="#ExpandEvaluator.next_state">next_state</a></code> will see all rolled outcomes in monotonic order;
either ascending or descending depending on <code><a href="#ExpandEvaluator.order">order()</a></code>.
If there are multiple generators, the set of outcomes is the
union of the outcomes of the invididual generators. All outcomes
with nonzero count will be seen. Outcomes with zero count
may or may not be seen. If you need to enforce that certain
outcomes are seen even if they have zero count, see
<code><a href="#ExpandEvaluator.alignment">alignment()</a></code>.</li>
<li><strong>*counts:</strong>  One value (usually an <code>int</code>) for each generator output
indicating how many of the current outcome were produced.
All outcomes with nonzero count are guaranteed to be seen.
To guarantee that outcomes are seen even if they have zero
count, override <code><a href="#ExpandEvaluator.alignment">alignment()</a></code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A hashable object indicating the next state.
  The special value <code><a href="#Reroll">icepool.Reroll</a></code> can be used to immediately remove
  the state from consideration, effectively performing a full reroll.</p>
</blockquote>
</div>


                            </div>
                            <div id="ExpandEvaluator.order" class="classattr">
                                        <input id="ExpandEvaluator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ExpandEvaluator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ExpandEvaluator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ExpandEvaluator.order-150"><a href="#ExpandEvaluator.order-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="ExpandEvaluator.order-151"><a href="#ExpandEvaluator.order-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">Order</span><span class="o">.</span><span class="n">Any</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to determine the order in which <code><a href="#ExpandEvaluator.next_state">next_state()</a></code> will see outcomes.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default is ascending order. This works well with mixed standard dice,
and other dice that differ only by right-truncation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*generators:</strong>  One or more <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <ul>
  <li><a href="#Order.Ascending">Order.Ascending</a> (= 1)
  if <code><a href="#ExpandEvaluator.next_state">next_state()</a></code> should always see the outcomes in ascending order.</li>
  <li><a href="#Order.Descending">Order.Descending</a> (= -1)
  if <code><a href="#ExpandEvaluator.next_state">next_state()</a></code> should always see the outcomes in descending order.</li>
  <li><a href="#Order.Any">Order.Any</a> (= 0)
  if the result of the evaluation is order-independent.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="ExpandEvaluator.final_outcome" class="classattr">
                                        <input id="ExpandEvaluator.final_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">final_state</span>, </span><span class="param"><span class="o">*</span><span class="n">_</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ExpandEvaluator.final_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ExpandEvaluator.final_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ExpandEvaluator.final_outcome-153"><a href="#ExpandEvaluator.final_outcome-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">):</span>
</span><span id="ExpandEvaluator.final_outcome-154"><a href="#ExpandEvaluator.final_outcome-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">final_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ExpandEvaluator.final_outcome-155"><a href="#ExpandEvaluator.final_outcome-155"><span class="linenos">155</span></a>            <span class="k">return</span> <span class="p">()</span>
</span><span id="ExpandEvaluator.final_outcome-156"><a href="#ExpandEvaluator.final_outcome-156"><span class="linenos">156</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">final_state</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to generate a final outcome from a final state.</p>

<p>Tthere is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>By default, the final outcome is equal to the final state.
Note that <code>None</code> is not a valid outcome for a <code><a href="#Die">Die</a></code>,
and if there are no outcomes, the final state will be <code>None</code>.
Subclasses that want to handle this case should explicitly define what
happens.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>final_state:</strong>  A state after all outcomes have been processed.</li>
<li><strong>*generators:</strong>  One or more <code><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A final outcome that will be used as part of constructing the result <code><a href="#Die">Die</a></code>.
  As usual for <code><a href="#Die">Die()</a></code>, this could itself be a <code><a href="#Die">Die</a></code> or <code><a href="#Reroll">icepool.Reroll</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#OutcomeCountEvaluator">OutcomeCountEvaluator</a></dt>
                                <dd id="ExpandEvaluator.alignment" class="function"><a href="#OutcomeCountEvaluator.alignment">alignment</a></dd>
                <dd id="ExpandEvaluator.range_alignment" class="function"><a href="#OutcomeCountEvaluator.range_alignment">range_alignment</a></dd>
                <dd id="ExpandEvaluator.final_kwargs" class="function"><a href="#OutcomeCountEvaluator.final_kwargs">final_kwargs</a></dd>
                <dd id="ExpandEvaluator.evaluate" class="function"><a href="#OutcomeCountEvaluator.evaluate">evaluate</a></dd>
                <dd id="ExpandEvaluator.sample" class="function"><a href="#OutcomeCountEvaluator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Deck">
                            <input id="Deck-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Deck</span><wbr>(<span class="base">abc.ABC</span>, <span class="base">typing.Mapping[typing.Any, int]</span>):

                <label class="view-source-button" for="Deck-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck-18"><a href="#Deck-18"><span class="linenos"> 18</span></a><span class="k">class</span> <span class="nc">Deck</span><span class="p">(</span><span class="n">Population</span><span class="p">):</span>
</span><span id="Deck-19"><a href="#Deck-19"><span class="linenos"> 19</span></a>    <span class="sd">&quot;&quot;&quot;Sampling without replacement (within a single evaluation).</span>
</span><span id="Deck-20"><a href="#Deck-20"><span class="linenos"> 20</span></a>
</span><span id="Deck-21"><a href="#Deck-21"><span class="linenos"> 21</span></a><span class="sd">    Quantities represent duplicates.</span>
</span><span id="Deck-22"><a href="#Deck-22"><span class="linenos"> 22</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Deck-23"><a href="#Deck-23"><span class="linenos"> 23</span></a>
</span><span id="Deck-24"><a href="#Deck-24"><span class="linenos"> 24</span></a>    <span class="n">_data</span><span class="p">:</span> <span class="n">Counts</span>
</span><span id="Deck-25"><a href="#Deck-25"><span class="linenos"> 25</span></a>    <span class="n">_deal</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Deck-26"><a href="#Deck-26"><span class="linenos"> 26</span></a>
</span><span id="Deck-27"><a href="#Deck-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="nf">_new_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">:</span>
</span><span id="Deck-28"><a href="#Deck-28"><span class="linenos"> 28</span></a>        <span class="k">return</span> <span class="n">Deck</span>
</span><span id="Deck-29"><a href="#Deck-29"><span class="linenos"> 29</span></a>
</span><span id="Deck-30"><a href="#Deck-30"><span class="linenos"> 30</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Deck-31"><a href="#Deck-31"><span class="linenos"> 31</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">,</span>
</span><span id="Deck-32"><a href="#Deck-32"><span class="linenos"> 32</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck&#39;</span><span class="p">:</span>
</span><span id="Deck-33"><a href="#Deck-33"><span class="linenos"> 33</span></a>        <span class="sd">&quot;&quot;&quot;Constructor for a `Deck`.</span>
</span><span id="Deck-34"><a href="#Deck-34"><span class="linenos"> 34</span></a>
</span><span id="Deck-35"><a href="#Deck-35"><span class="linenos"> 35</span></a><span class="sd">        Args:</span>
</span><span id="Deck-36"><a href="#Deck-36"><span class="linenos"> 36</span></a><span class="sd">            outcomes: The cards of the `Deck`. This can be one of the following:</span>
</span><span id="Deck-37"><a href="#Deck-37"><span class="linenos"> 37</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Deck-38"><a href="#Deck-38"><span class="linenos"> 38</span></a><span class="sd">                * A sequence of outcomes.</span>
</span><span id="Deck-39"><a href="#Deck-39"><span class="linenos"> 39</span></a>
</span><span id="Deck-40"><a href="#Deck-40"><span class="linenos"> 40</span></a><span class="sd">                Note that `Die` and `Deck` both count as `Mapping`s.</span>
</span><span id="Deck-41"><a href="#Deck-41"><span class="linenos"> 41</span></a>
</span><span id="Deck-42"><a href="#Deck-42"><span class="linenos"> 42</span></a><span class="sd">                Each card may be one of the following:</span>
</span><span id="Deck-43"><a href="#Deck-43"><span class="linenos"> 43</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Deck-44"><a href="#Deck-44"><span class="linenos"> 44</span></a><span class="sd">                    The outcomes of the `Mapping` will be &quot;flattened&quot; into the</span>
</span><span id="Deck-45"><a href="#Deck-45"><span class="linenos"> 45</span></a><span class="sd">                    result. This option will be taken in preference to treating</span>
</span><span id="Deck-46"><a href="#Deck-46"><span class="linenos"> 46</span></a><span class="sd">                    the `Mapping` itself as an outcome even if the `Mapping`</span>
</span><span id="Deck-47"><a href="#Deck-47"><span class="linenos"> 47</span></a><span class="sd">                    itself is hashable and totally orderable. This means that</span>
</span><span id="Deck-48"><a href="#Deck-48"><span class="linenos"> 48</span></a><span class="sd">                    `Die` and `Deck` will never be outcomes.</span>
</span><span id="Deck-49"><a href="#Deck-49"><span class="linenos"> 49</span></a><span class="sd">                * A tuple of outcomes.</span>
</span><span id="Deck-50"><a href="#Deck-50"><span class="linenos"> 50</span></a><span class="sd">                    Any tuple elements that are `Mapping`s will expand the</span>
</span><span id="Deck-51"><a href="#Deck-51"><span class="linenos"> 51</span></a><span class="sd">                    tuple according to their independent joint distribution.</span>
</span><span id="Deck-52"><a href="#Deck-52"><span class="linenos"> 52</span></a><span class="sd">                    For example, `(d6, d6)` will expand to 36 ordered tuples</span>
</span><span id="Deck-53"><a href="#Deck-53"><span class="linenos"> 53</span></a><span class="sd">                    with dup 1 each. Use this carefully since it may create a</span>
</span><span id="Deck-54"><a href="#Deck-54"><span class="linenos"> 54</span></a><span class="sd">                    large number of outcomes.</span>
</span><span id="Deck-55"><a href="#Deck-55"><span class="linenos"> 55</span></a><span class="sd">                * `str` or `bytes`, which will be treated as a single outcome.</span>
</span><span id="Deck-56"><a href="#Deck-56"><span class="linenos"> 56</span></a><span class="sd">                * Any other sequence. Each element will be weighted equally.</span>
</span><span id="Deck-57"><a href="#Deck-57"><span class="linenos"> 57</span></a><span class="sd">                * Anything else will be treated as a single outcome.</span>
</span><span id="Deck-58"><a href="#Deck-58"><span class="linenos"> 58</span></a><span class="sd">                    Each outcome must be hashable, and the</span>
</span><span id="Deck-59"><a href="#Deck-59"><span class="linenos"> 59</span></a><span class="sd">                    set of outcomes must be totally orderable (after expansion).</span>
</span><span id="Deck-60"><a href="#Deck-60"><span class="linenos"> 60</span></a><span class="sd">                    The same outcome can appear multiple times, in which case</span>
</span><span id="Deck-61"><a href="#Deck-61"><span class="linenos"> 61</span></a><span class="sd">                    the corresponding quantities will be accumulated.</span>
</span><span id="Deck-62"><a href="#Deck-62"><span class="linenos"> 62</span></a><span class="sd">            times: Multiplies the number of times each element of `outcomes`</span>
</span><span id="Deck-63"><a href="#Deck-63"><span class="linenos"> 63</span></a><span class="sd">                will be put into the `Deck`.</span>
</span><span id="Deck-64"><a href="#Deck-64"><span class="linenos"> 64</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Deck-65"><a href="#Deck-65"><span class="linenos"> 65</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Deck-66"><a href="#Deck-66"><span class="linenos"> 66</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Deck-67"><a href="#Deck-67"><span class="linenos"> 67</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-68"><a href="#Deck-68"><span class="linenos"> 68</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck-69"><a href="#Deck-69"><span class="linenos"> 69</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Deck-70"><a href="#Deck-70"><span class="linenos"> 70</span></a>                <span class="k">return</span> <span class="n">outcomes</span>
</span><span id="Deck-71"><a href="#Deck-71"><span class="linenos"> 71</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-72"><a href="#Deck-72"><span class="linenos"> 72</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="n">outcomes</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Deck-73"><a href="#Deck-73"><span class="linenos"> 73</span></a>
</span><span id="Deck-74"><a href="#Deck-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Deck-75"><a href="#Deck-75"><span class="linenos"> 75</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Again cannot be used with Decks.&#39;</span><span class="p">)</span>
</span><span id="Deck-76"><a href="#Deck-76"><span class="linenos"> 76</span></a>
</span><span id="Deck-77"><a href="#Deck-77"><span class="linenos"> 77</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck-78"><a href="#Deck-78"><span class="linenos"> 78</span></a>
</span><span id="Deck-79"><a href="#Deck-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Deck-80"><a href="#Deck-80"><span class="linenos"> 80</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck-81"><a href="#Deck-81"><span class="linenos"> 81</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Deck-82"><a href="#Deck-82"><span class="linenos"> 82</span></a>
</span><span id="Deck-83"><a href="#Deck-83"><span class="linenos"> 83</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_deck</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck-84"><a href="#Deck-84"><span class="linenos"> 84</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="o">.</span><span class="n">_new_deck</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="Deck-85"><a href="#Deck-85"><span class="linenos"> 85</span></a>
</span><span id="Deck-86"><a href="#Deck-86"><span class="linenos"> 86</span></a>    <span class="nd">@classmethod</span>
</span><span id="Deck-87"><a href="#Deck-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">_new_deck</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Counts</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck&#39;</span><span class="p">:</span>
</span><span id="Deck-88"><a href="#Deck-88"><span class="linenos"> 88</span></a>        <span class="sd">&quot;&quot;&quot;Creates a new `Deck` using already-processed arguments.</span>
</span><span id="Deck-89"><a href="#Deck-89"><span class="linenos"> 89</span></a>
</span><span id="Deck-90"><a href="#Deck-90"><span class="linenos"> 90</span></a><span class="sd">        Args:</span>
</span><span id="Deck-91"><a href="#Deck-91"><span class="linenos"> 91</span></a><span class="sd">            data: At this point, this is a Counts.</span>
</span><span id="Deck-92"><a href="#Deck-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-93"><a href="#Deck-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Population</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Deck-94"><a href="#Deck-94"><span class="linenos"> 94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
</span><span id="Deck-95"><a href="#Deck-95"><span class="linenos"> 95</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Deck-96"><a href="#Deck-96"><span class="linenos"> 96</span></a>
</span><span id="Deck-97"><a href="#Deck-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Deck-98"><a href="#Deck-98"><span class="linenos"> 98</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="Deck-99"><a href="#Deck-99"><span class="linenos"> 99</span></a>
</span><span id="Deck-100"><a href="#Deck-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Deck-101"><a href="#Deck-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span><span id="Deck-102"><a href="#Deck-102"><span class="linenos">102</span></a>
</span><span id="Deck-103"><a href="#Deck-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">:</span>
</span><span id="Deck-104"><a href="#Deck-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="Deck-105"><a href="#Deck-105"><span class="linenos">105</span></a>
</span><span id="Deck-106"><a href="#Deck-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-107"><a href="#Deck-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Deck-108"><a href="#Deck-108"><span class="linenos">108</span></a>
</span><span id="Deck-109"><a href="#Deck-109"><span class="linenos">109</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
</span><span id="Deck-110"><a href="#Deck-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="Deck-111"><a href="#Deck-111"><span class="linenos">111</span></a>
</span><span id="Deck-112"><a href="#Deck-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-113"><a href="#Deck-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
</span><span id="Deck-114"><a href="#Deck-114"><span class="linenos">114</span></a>
</span><span id="Deck-115"><a href="#Deck-115"><span class="linenos">115</span></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Population</span><span class="o">.</span><span class="n">denominator</span>
</span><span id="Deck-116"><a href="#Deck-116"><span class="linenos">116</span></a>
</span><span id="Deck-117"><a href="#Deck-117"><span class="linenos">117</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-118"><a href="#Deck-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">_popped_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-119"><a href="#Deck-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_deck</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_min</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Deck-120"><a href="#Deck-120"><span class="linenos">120</span></a>
</span><span id="Deck-121"><a href="#Deck-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="nf">_pop_min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-122"><a href="#Deck-122"><span class="linenos">122</span></a>        <span class="sd">&quot;&quot;&quot;A `Deck` with the min outcome removed.&quot;&quot;&quot;</span>
</span><span id="Deck-123"><a href="#Deck-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_min</span>
</span><span id="Deck-124"><a href="#Deck-124"><span class="linenos">124</span></a>
</span><span id="Deck-125"><a href="#Deck-125"><span class="linenos">125</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-126"><a href="#Deck-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">_popped_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-127"><a href="#Deck-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_deck</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">remove_max</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Deck-128"><a href="#Deck-128"><span class="linenos">128</span></a>
</span><span id="Deck-129"><a href="#Deck-129"><span class="linenos">129</span></a>    <span class="k">def</span> <span class="nf">_pop_max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="s1">&#39;Deck&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deck-130"><a href="#Deck-130"><span class="linenos">130</span></a>        <span class="sd">&quot;&quot;&quot;A `Deck` with the max outcome removed.&quot;&quot;&quot;</span>
</span><span id="Deck-131"><a href="#Deck-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_popped_max</span>
</span><span id="Deck-132"><a href="#Deck-132"><span class="linenos">132</span></a>
</span><span id="Deck-133"><a href="#Deck-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deal&#39;</span><span class="p">:</span>
</span><span id="Deck-134"><a href="#Deck-134"><span class="linenos">134</span></a>        <span class="sd">&quot;&quot;&quot;Creates a `Deal` object from this deck.</span>
</span><span id="Deck-135"><a href="#Deck-135"><span class="linenos">135</span></a>
</span><span id="Deck-136"><a href="#Deck-136"><span class="linenos">136</span></a><span class="sd">        See `Deal()` for details.</span>
</span><span id="Deck-137"><a href="#Deck-137"><span class="linenos">137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-138"><a href="#Deck-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">)</span>
</span><span id="Deck-139"><a href="#Deck-139"><span class="linenos">139</span></a>
</span><span id="Deck-140"><a href="#Deck-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repl</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck&#39;</span><span class="p">:</span>
</span><span id="Deck-141"><a href="#Deck-141"><span class="linenos">141</span></a>        <span class="sd">&quot;&quot;&quot;Changes outcomes of the `Deck` to other outcomes.</span>
</span><span id="Deck-142"><a href="#Deck-142"><span class="linenos">142</span></a>
</span><span id="Deck-143"><a href="#Deck-143"><span class="linenos">143</span></a><span class="sd">        You can think of this as `sub`stituting outcomes of this `Deck` for</span>
</span><span id="Deck-144"><a href="#Deck-144"><span class="linenos">144</span></a><span class="sd">        other outcomes.</span>
</span><span id="Deck-145"><a href="#Deck-145"><span class="linenos">145</span></a>
</span><span id="Deck-146"><a href="#Deck-146"><span class="linenos">146</span></a><span class="sd">        Args:</span>
</span><span id="Deck-147"><a href="#Deck-147"><span class="linenos">147</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Deck-148"><a href="#Deck-148"><span class="linenos">148</span></a><span class="sd">                * A callable returning a new outcome for each old outcome.</span>
</span><span id="Deck-149"><a href="#Deck-149"><span class="linenos">149</span></a><span class="sd">                * A map from old outcomes to new outcomes.</span>
</span><span id="Deck-150"><a href="#Deck-150"><span class="linenos">150</span></a><span class="sd">                    Unmapped old outcomes stay the same.</span>
</span><span id="Deck-151"><a href="#Deck-151"><span class="linenos">151</span></a><span class="sd">                The new outcomes may be `Deck`s, in which case one card is</span>
</span><span id="Deck-152"><a href="#Deck-152"><span class="linenos">152</span></a><span class="sd">                replaced with several. This is not recommended.</span>
</span><span id="Deck-153"><a href="#Deck-153"><span class="linenos">153</span></a><span class="sd">            star: If set to `True` or 1, outcomes of `self` will be unpacked as</span>
</span><span id="Deck-154"><a href="#Deck-154"><span class="linenos">154</span></a><span class="sd">                `*outcome` before giving it to the `repl` function. `extra_dice`</span>
</span><span id="Deck-155"><a href="#Deck-155"><span class="linenos">155</span></a><span class="sd">                are not unpacked. If `repl` is not a callable, this has no</span>
</span><span id="Deck-156"><a href="#Deck-156"><span class="linenos">156</span></a><span class="sd">                effect.</span>
</span><span id="Deck-157"><a href="#Deck-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck-158"><a href="#Deck-158"><span class="linenos">158</span></a>        <span class="c1"># Convert to a single-argument function.</span>
</span><span id="Deck-159"><a href="#Deck-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">repl</span><span class="p">):</span>
</span><span id="Deck-160"><a href="#Deck-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Deck-161"><a href="#Deck-161"><span class="linenos">161</span></a>
</span><span id="Deck-162"><a href="#Deck-162"><span class="linenos">162</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck-163"><a href="#Deck-163"><span class="linenos">163</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck-164"><a href="#Deck-164"><span class="linenos">164</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-165"><a href="#Deck-165"><span class="linenos">165</span></a>
</span><span id="Deck-166"><a href="#Deck-166"><span class="linenos">166</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck-167"><a href="#Deck-167"><span class="linenos">167</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck-168"><a href="#Deck-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-169"><a href="#Deck-169"><span class="linenos">169</span></a>            <span class="c1"># repl is a mapping.</span>
</span><span id="Deck-170"><a href="#Deck-170"><span class="linenos">170</span></a>            <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck-171"><a href="#Deck-171"><span class="linenos">171</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">repl</span><span class="p">:</span>
</span><span id="Deck-172"><a href="#Deck-172"><span class="linenos">172</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Deck-173"><a href="#Deck-173"><span class="linenos">173</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Deck-174"><a href="#Deck-174"><span class="linenos">174</span></a>                    <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Deck-175"><a href="#Deck-175"><span class="linenos">175</span></a>
</span><span id="Deck-176"><a href="#Deck-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span>
</span><span id="Deck-177"><a href="#Deck-177"><span class="linenos">177</span></a>            <span class="p">[</span><span class="n">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()],</span>
</span><span id="Deck-178"><a href="#Deck-178"><span class="linenos">178</span></a>            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span><span id="Deck-179"><a href="#Deck-179"><span class="linenos">179</span></a>
</span><span id="Deck-180"><a href="#Deck-180"><span class="linenos">180</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-181"><a href="#Deck-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">_key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Deck-182"><a href="#Deck-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Deck-183"><a href="#Deck-183"><span class="linenos">183</span></a>
</span><span id="Deck-184"><a href="#Deck-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Deck-185"><a href="#Deck-185"><span class="linenos">185</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck-186"><a href="#Deck-186"><span class="linenos">186</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Deck-187"><a href="#Deck-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_key_tuple</span>
</span><span id="Deck-188"><a href="#Deck-188"><span class="linenos">188</span></a>
</span><span id="Deck-189"><a href="#Deck-189"><span class="linenos">189</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deck-190"><a href="#Deck-190"><span class="linenos">190</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-191"><a href="#Deck-191"><span class="linenos">191</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span><span class="p">)</span>
</span><span id="Deck-192"><a href="#Deck-192"><span class="linenos">192</span></a>
</span><span id="Deck-193"><a href="#Deck-193"><span class="linenos">193</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck-194"><a href="#Deck-194"><span class="linenos">194</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="Deck-195"><a href="#Deck-195"><span class="linenos">195</span></a>
</span><span id="Deck-196"><a href="#Deck-196"><span class="linenos">196</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Deck-197"><a href="#Deck-197"><span class="linenos">197</span></a>        <span class="n">inner</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="Deck-198"><a href="#Deck-198"><span class="linenos">198</span></a>            <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">outcome</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="Deck-199"><a href="#Deck-199"><span class="linenos">199</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="s1">&#39;({&#39;</span> <span class="o">+</span> <span class="n">inner</span> <span class="o">+</span> <span class="s1">&#39;})&#39;</span>
</span></pre></div>


            <div class="docstring"><p>Sampling without replacement (within a single evaluation).</p>

<p>Quantities represent duplicates.</p>
</div>


                            <div id="Deck.__init__" class="classattr">
                                        <input id="Deck.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Deck</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">outcomes</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">]</span>,</span><span class="param">	<span class="n">times</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></span>)</span>

                <label class="view-source-button" for="Deck.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.__init__-30"><a href="#Deck.__init__-30"><span class="linenos">30</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
</span><span id="Deck.__init__-31"><a href="#Deck.__init__-31"><span class="linenos">31</span></a>                <span class="n">outcomes</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">,</span>
</span><span id="Deck.__init__-32"><a href="#Deck.__init__-32"><span class="linenos">32</span></a>                <span class="n">times</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck&#39;</span><span class="p">:</span>
</span><span id="Deck.__init__-33"><a href="#Deck.__init__-33"><span class="linenos">33</span></a>        <span class="sd">&quot;&quot;&quot;Constructor for a `Deck`.</span>
</span><span id="Deck.__init__-34"><a href="#Deck.__init__-34"><span class="linenos">34</span></a>
</span><span id="Deck.__init__-35"><a href="#Deck.__init__-35"><span class="linenos">35</span></a><span class="sd">        Args:</span>
</span><span id="Deck.__init__-36"><a href="#Deck.__init__-36"><span class="linenos">36</span></a><span class="sd">            outcomes: The cards of the `Deck`. This can be one of the following:</span>
</span><span id="Deck.__init__-37"><a href="#Deck.__init__-37"><span class="linenos">37</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Deck.__init__-38"><a href="#Deck.__init__-38"><span class="linenos">38</span></a><span class="sd">                * A sequence of outcomes.</span>
</span><span id="Deck.__init__-39"><a href="#Deck.__init__-39"><span class="linenos">39</span></a>
</span><span id="Deck.__init__-40"><a href="#Deck.__init__-40"><span class="linenos">40</span></a><span class="sd">                Note that `Die` and `Deck` both count as `Mapping`s.</span>
</span><span id="Deck.__init__-41"><a href="#Deck.__init__-41"><span class="linenos">41</span></a>
</span><span id="Deck.__init__-42"><a href="#Deck.__init__-42"><span class="linenos">42</span></a><span class="sd">                Each card may be one of the following:</span>
</span><span id="Deck.__init__-43"><a href="#Deck.__init__-43"><span class="linenos">43</span></a><span class="sd">                * A `Mapping` from outcomes to quantities.</span>
</span><span id="Deck.__init__-44"><a href="#Deck.__init__-44"><span class="linenos">44</span></a><span class="sd">                    The outcomes of the `Mapping` will be &quot;flattened&quot; into the</span>
</span><span id="Deck.__init__-45"><a href="#Deck.__init__-45"><span class="linenos">45</span></a><span class="sd">                    result. This option will be taken in preference to treating</span>
</span><span id="Deck.__init__-46"><a href="#Deck.__init__-46"><span class="linenos">46</span></a><span class="sd">                    the `Mapping` itself as an outcome even if the `Mapping`</span>
</span><span id="Deck.__init__-47"><a href="#Deck.__init__-47"><span class="linenos">47</span></a><span class="sd">                    itself is hashable and totally orderable. This means that</span>
</span><span id="Deck.__init__-48"><a href="#Deck.__init__-48"><span class="linenos">48</span></a><span class="sd">                    `Die` and `Deck` will never be outcomes.</span>
</span><span id="Deck.__init__-49"><a href="#Deck.__init__-49"><span class="linenos">49</span></a><span class="sd">                * A tuple of outcomes.</span>
</span><span id="Deck.__init__-50"><a href="#Deck.__init__-50"><span class="linenos">50</span></a><span class="sd">                    Any tuple elements that are `Mapping`s will expand the</span>
</span><span id="Deck.__init__-51"><a href="#Deck.__init__-51"><span class="linenos">51</span></a><span class="sd">                    tuple according to their independent joint distribution.</span>
</span><span id="Deck.__init__-52"><a href="#Deck.__init__-52"><span class="linenos">52</span></a><span class="sd">                    For example, `(d6, d6)` will expand to 36 ordered tuples</span>
</span><span id="Deck.__init__-53"><a href="#Deck.__init__-53"><span class="linenos">53</span></a><span class="sd">                    with dup 1 each. Use this carefully since it may create a</span>
</span><span id="Deck.__init__-54"><a href="#Deck.__init__-54"><span class="linenos">54</span></a><span class="sd">                    large number of outcomes.</span>
</span><span id="Deck.__init__-55"><a href="#Deck.__init__-55"><span class="linenos">55</span></a><span class="sd">                * `str` or `bytes`, which will be treated as a single outcome.</span>
</span><span id="Deck.__init__-56"><a href="#Deck.__init__-56"><span class="linenos">56</span></a><span class="sd">                * Any other sequence. Each element will be weighted equally.</span>
</span><span id="Deck.__init__-57"><a href="#Deck.__init__-57"><span class="linenos">57</span></a><span class="sd">                * Anything else will be treated as a single outcome.</span>
</span><span id="Deck.__init__-58"><a href="#Deck.__init__-58"><span class="linenos">58</span></a><span class="sd">                    Each outcome must be hashable, and the</span>
</span><span id="Deck.__init__-59"><a href="#Deck.__init__-59"><span class="linenos">59</span></a><span class="sd">                    set of outcomes must be totally orderable (after expansion).</span>
</span><span id="Deck.__init__-60"><a href="#Deck.__init__-60"><span class="linenos">60</span></a><span class="sd">                    The same outcome can appear multiple times, in which case</span>
</span><span id="Deck.__init__-61"><a href="#Deck.__init__-61"><span class="linenos">61</span></a><span class="sd">                    the corresponding quantities will be accumulated.</span>
</span><span id="Deck.__init__-62"><a href="#Deck.__init__-62"><span class="linenos">62</span></a><span class="sd">            times: Multiplies the number of times each element of `outcomes`</span>
</span><span id="Deck.__init__-63"><a href="#Deck.__init__-63"><span class="linenos">63</span></a><span class="sd">                will be put into the `Deck`.</span>
</span><span id="Deck.__init__-64"><a href="#Deck.__init__-64"><span class="linenos">64</span></a><span class="sd">                `times` can either be a sequence of the same length as</span>
</span><span id="Deck.__init__-65"><a href="#Deck.__init__-65"><span class="linenos">65</span></a><span class="sd">                `outcomes` or a single `int` to apply to all elements of</span>
</span><span id="Deck.__init__-66"><a href="#Deck.__init__-66"><span class="linenos">66</span></a><span class="sd">                `outcomes`.</span>
</span><span id="Deck.__init__-67"><a href="#Deck.__init__-67"><span class="linenos">67</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.__init__-68"><a href="#Deck.__init__-68"><span class="linenos">68</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck.__init__-69"><a href="#Deck.__init__-69"><span class="linenos">69</span></a>            <span class="k">if</span> <span class="n">times</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Deck.__init__-70"><a href="#Deck.__init__-70"><span class="linenos">70</span></a>                <span class="k">return</span> <span class="n">outcomes</span>
</span><span id="Deck.__init__-71"><a href="#Deck.__init__-71"><span class="linenos">71</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.__init__-72"><a href="#Deck.__init__-72"><span class="linenos">72</span></a>                <span class="n">outcomes</span> <span class="o">=</span> <span class="n">outcomes</span><span class="o">.</span><span class="n">_data</span>
</span><span id="Deck.__init__-73"><a href="#Deck.__init__-73"><span class="linenos">73</span></a>
</span><span id="Deck.__init__-74"><a href="#Deck.__init__-74"><span class="linenos">74</span></a>        <span class="k">if</span> <span class="n">icepool</span><span class="o">.</span><span class="n">again</span><span class="o">.</span><span class="n">contains_again</span><span class="p">(</span><span class="n">outcomes</span><span class="p">):</span>
</span><span id="Deck.__init__-75"><a href="#Deck.__init__-75"><span class="linenos">75</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Again cannot be used with Decks.&#39;</span><span class="p">)</span>
</span><span id="Deck.__init__-76"><a href="#Deck.__init__-76"><span class="linenos">76</span></a>
</span><span id="Deck.__init__-77"><a href="#Deck.__init__-77"><span class="linenos">77</span></a>        <span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">itemize</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck.__init__-78"><a href="#Deck.__init__-78"><span class="linenos">78</span></a>
</span><span id="Deck.__init__-79"><a href="#Deck.__init__-79"><span class="linenos">79</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
</span><span id="Deck.__init__-80"><a href="#Deck.__init__-80"><span class="linenos">80</span></a>                <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Deck</span><span class="p">):</span>
</span><span id="Deck.__init__-81"><a href="#Deck.__init__-81"><span class="linenos">81</span></a>            <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Deck.__init__-82"><a href="#Deck.__init__-82"><span class="linenos">82</span></a>
</span><span id="Deck.__init__-83"><a href="#Deck.__init__-83"><span class="linenos">83</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">creation_args</span><span class="o">.</span><span class="n">expand_args_for_deck</span><span class="p">(</span><span class="n">outcomes</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span id="Deck.__init__-84"><a href="#Deck.__init__-84"><span class="linenos">84</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="o">.</span><span class="n">_new_deck</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructor for a <code><a href="#Deck">Deck</a></code>.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><p><strong>outcomes:</strong>  The cards of the <code><a href="#Deck">Deck</a></code>. This can be one of the following:</p>

<ul>
<li>A <code>Mapping</code> from outcomes to quantities.</li>
<li>A sequence of outcomes.</li>
</ul>

<p>Note that <code><a href="#Die">Die</a></code> and <code><a href="#Deck">Deck</a></code> both count as <code>Mapping</code>s.</p>

<p>Each card may be one of the following:</p>

<ul>
<li>A <code>Mapping</code> from outcomes to quantities.
The outcomes of the <code>Mapping</code> will be "flattened" into the
result. This option will be taken in preference to treating
the <code>Mapping</code> itself as an outcome even if the <code>Mapping</code>
itself is hashable and totally orderable. This means that
<code><a href="#Die">Die</a></code> and <code><a href="#Deck">Deck</a></code> will never be outcomes.</li>
<li>A tuple of outcomes.
Any tuple elements that are <code>Mapping</code>s will expand the
tuple according to their independent joint distribution.
For example, <code>(d6, d6)</code> will expand to 36 ordered tuples
with dup 1 each. Use this carefully since it may create a
large number of outcomes.</li>
<li><code>str</code> or <code>bytes</code>, which will be treated as a single outcome.</li>
<li>Any other sequence. Each element will be weighted equally.</li>
<li>Anything else will be treated as a single outcome.
Each outcome must be hashable, and the
set of outcomes must be totally orderable (after expansion).
The same outcome can appear multiple times, in which case
the corresponding quantities will be accumulated.</li>
</ul></li>
<li><strong>times:</strong>  Multiplies the number of times each element of <code><a href="#Deck.outcomes">outcomes</a></code>
will be put into the <code><a href="#Deck">Deck</a></code>.
<code>times</code> can either be a sequence of the same length as
<code><a href="#Deck.outcomes">outcomes</a></code> or a single <code>int</code> to apply to all elements of
<code><a href="#Deck.outcomes">outcomes</a></code>.</li>
</ul>
</div>


                            </div>
                            <div id="Deck.keys" class="classattr">
                                        <input id="Deck.keys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">keys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">icepool.CountsKeysView</a></span>:</span></span>

                <label class="view-source-button" for="Deck.keys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.keys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.keys-97"><a href="#Deck.keys-97"><span class="linenos">97</span></a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Deck.keys-98"><a href="#Deck.keys-98"><span class="linenos">98</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes within the population in sorted order.</p>
</div>


                            </div>
                            <div id="Deck.values" class="classattr">
                                        <input id="Deck.values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsValuesView">icepool.CountsValuesView</a></span>:</span></span>

                <label class="view-source-button" for="Deck.values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.values-100"><a href="#Deck.values-100"><span class="linenos">100</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsValuesView</span><span class="p">:</span>
</span><span id="Deck.values-101"><a href="#Deck.values-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The quantities within the population in outcome order.</p>
</div>


                            </div>
                            <div id="Deck.items" class="classattr">
                                        <input id="Deck.items-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">items</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsItemsView">icepool.CountsItemsView</a></span>:</span></span>

                <label class="view-source-button" for="Deck.items-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.items"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.items-103"><a href="#Deck.items-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsItemsView</span><span class="p">:</span>
</span><span id="Deck.items-104"><a href="#Deck.items-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The (outcome, quantity)s of the population in sorted order.</p>
</div>


                            </div>
                            <div id="Deck.size" class="classattr">
                                        <input id="Deck.size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deck.size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.size-125"><a href="#Deck.size-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deck.size-126"><a href="#Deck.size-126"><span class="linenos">126</span></a>        <span class="sd">&quot;&quot;&quot;The sum of all quantities (e.g. weights or duplicates).</span>
</span><span id="Deck.size-127"><a href="#Deck.size-127"><span class="linenos">127</span></a>
</span><span id="Deck.size-128"><a href="#Deck.size-128"><span class="linenos">128</span></a><span class="sd">        For the number of unique outcomes, including those with zero quantity,</span>
</span><span id="Deck.size-129"><a href="#Deck.size-129"><span class="linenos">129</span></a><span class="sd">        use `len()`.</span>
</span><span id="Deck.size-130"><a href="#Deck.size-130"><span class="linenos">130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.size-131"><a href="#Deck.size-131"><span class="linenos">131</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denominator</span>
</span></pre></div>


            <div class="docstring"><p>The sum of all quantities (e.g. weights or duplicates).</p>

<p>For the number of unique outcomes, including those with zero quantity,
use <code>len()</code>.</p>
</div>


                            </div>
                            <div id="Deck.deal" class="classattr">
                                        <input id="Deck.deal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deal">icepool.Deal</a></span>:</span></span>

                <label class="view-source-button" for="Deck.deal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.deal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.deal-133"><a href="#Deck.deal-133"><span class="linenos">133</span></a>    <span class="k">def</span> <span class="nf">deal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deal&#39;</span><span class="p">:</span>
</span><span id="Deck.deal-134"><a href="#Deck.deal-134"><span class="linenos">134</span></a>        <span class="sd">&quot;&quot;&quot;Creates a `Deal` object from this deck.</span>
</span><span id="Deck.deal-135"><a href="#Deck.deal-135"><span class="linenos">135</span></a>
</span><span id="Deck.deal-136"><a href="#Deck.deal-136"><span class="linenos">136</span></a><span class="sd">        See `Deal()` for details.</span>
</span><span id="Deck.deal-137"><a href="#Deck.deal-137"><span class="linenos">137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.deal-138"><a href="#Deck.deal-138"><span class="linenos">138</span></a>        <span class="k">return</span> <span class="n">icepool</span><span class="o">.</span><span class="n">Deal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a <code><a href="#Deal">Deal</a></code> object from this deck.</p>

<p>See <code><a href="#Deal">Deal()</a></code> for details.</p>
</div>


                            </div>
                            <div id="Deck.sub" class="classattr">
                                        <input id="Deck.sub-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sub</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">repl</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">]</span>,</span><span class="param">	<span class="o">/</span>,</span><span class="param">	<span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">icepool.Deck</a></span>:</span></span>

                <label class="view-source-button" for="Deck.sub-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deck.sub"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deck.sub-140"><a href="#Deck.sub-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repl</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">,</span> <span class="o">/</span><span class="p">,</span> <span class="n">star</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Deck&#39;</span><span class="p">:</span>
</span><span id="Deck.sub-141"><a href="#Deck.sub-141"><span class="linenos">141</span></a>        <span class="sd">&quot;&quot;&quot;Changes outcomes of the `Deck` to other outcomes.</span>
</span><span id="Deck.sub-142"><a href="#Deck.sub-142"><span class="linenos">142</span></a>
</span><span id="Deck.sub-143"><a href="#Deck.sub-143"><span class="linenos">143</span></a><span class="sd">        You can think of this as `sub`stituting outcomes of this `Deck` for</span>
</span><span id="Deck.sub-144"><a href="#Deck.sub-144"><span class="linenos">144</span></a><span class="sd">        other outcomes.</span>
</span><span id="Deck.sub-145"><a href="#Deck.sub-145"><span class="linenos">145</span></a>
</span><span id="Deck.sub-146"><a href="#Deck.sub-146"><span class="linenos">146</span></a><span class="sd">        Args:</span>
</span><span id="Deck.sub-147"><a href="#Deck.sub-147"><span class="linenos">147</span></a><span class="sd">            repl: One of the following:</span>
</span><span id="Deck.sub-148"><a href="#Deck.sub-148"><span class="linenos">148</span></a><span class="sd">                * A callable returning a new outcome for each old outcome.</span>
</span><span id="Deck.sub-149"><a href="#Deck.sub-149"><span class="linenos">149</span></a><span class="sd">                * A map from old outcomes to new outcomes.</span>
</span><span id="Deck.sub-150"><a href="#Deck.sub-150"><span class="linenos">150</span></a><span class="sd">                    Unmapped old outcomes stay the same.</span>
</span><span id="Deck.sub-151"><a href="#Deck.sub-151"><span class="linenos">151</span></a><span class="sd">                The new outcomes may be `Deck`s, in which case one card is</span>
</span><span id="Deck.sub-152"><a href="#Deck.sub-152"><span class="linenos">152</span></a><span class="sd">                replaced with several. This is not recommended.</span>
</span><span id="Deck.sub-153"><a href="#Deck.sub-153"><span class="linenos">153</span></a><span class="sd">            star: If set to `True` or 1, outcomes of `self` will be unpacked as</span>
</span><span id="Deck.sub-154"><a href="#Deck.sub-154"><span class="linenos">154</span></a><span class="sd">                `*outcome` before giving it to the `repl` function. `extra_dice`</span>
</span><span id="Deck.sub-155"><a href="#Deck.sub-155"><span class="linenos">155</span></a><span class="sd">                are not unpacked. If `repl` is not a callable, this has no</span>
</span><span id="Deck.sub-156"><a href="#Deck.sub-156"><span class="linenos">156</span></a><span class="sd">                effect.</span>
</span><span id="Deck.sub-157"><a href="#Deck.sub-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deck.sub-158"><a href="#Deck.sub-158"><span class="linenos">158</span></a>        <span class="c1"># Convert to a single-argument function.</span>
</span><span id="Deck.sub-159"><a href="#Deck.sub-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">repl</span><span class="p">):</span>
</span><span id="Deck.sub-160"><a href="#Deck.sub-160"><span class="linenos">160</span></a>            <span class="k">if</span> <span class="n">star</span><span class="p">:</span>
</span><span id="Deck.sub-161"><a href="#Deck.sub-161"><span class="linenos">161</span></a>
</span><span id="Deck.sub-162"><a href="#Deck.sub-162"><span class="linenos">162</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck.sub-163"><a href="#Deck.sub-163"><span class="linenos">163</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="o">*</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck.sub-164"><a href="#Deck.sub-164"><span class="linenos">164</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.sub-165"><a href="#Deck.sub-165"><span class="linenos">165</span></a>
</span><span id="Deck.sub-166"><a href="#Deck.sub-166"><span class="linenos">166</span></a>                <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck.sub-167"><a href="#Deck.sub-167"><span class="linenos">167</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="Deck.sub-168"><a href="#Deck.sub-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.sub-169"><a href="#Deck.sub-169"><span class="linenos">169</span></a>            <span class="c1"># repl is a mapping.</span>
</span><span id="Deck.sub-170"><a href="#Deck.sub-170"><span class="linenos">170</span></a>            <span class="k">def</span> <span class="nf">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">):</span>
</span><span id="Deck.sub-171"><a href="#Deck.sub-171"><span class="linenos">171</span></a>                <span class="k">if</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">repl</span><span class="p">:</span>
</span><span id="Deck.sub-172"><a href="#Deck.sub-172"><span class="linenos">172</span></a>                    <span class="k">return</span> <span class="n">repl</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="Deck.sub-173"><a href="#Deck.sub-173"><span class="linenos">173</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Deck.sub-174"><a href="#Deck.sub-174"><span class="linenos">174</span></a>                    <span class="k">return</span> <span class="n">outcome</span>
</span><span id="Deck.sub-175"><a href="#Deck.sub-175"><span class="linenos">175</span></a>
</span><span id="Deck.sub-176"><a href="#Deck.sub-176"><span class="linenos">176</span></a>        <span class="k">return</span> <span class="n">Deck</span><span class="p">(</span>
</span><span id="Deck.sub-177"><a href="#Deck.sub-177"><span class="linenos">177</span></a>            <span class="p">[</span><span class="n">transition_function</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()],</span>
</span><span id="Deck.sub-178"><a href="#Deck.sub-178"><span class="linenos">178</span></a>            <span class="n">times</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quantities</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>Changes outcomes of the <code><a href="#Deck">Deck</a></code> to other outcomes.</p>

<p>You can think of this as <code><a href="#Deck.sub">sub</a></code>stituting outcomes of this <code><a href="#Deck">Deck</a></code> for
other outcomes.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>repl:</strong>  One of the following:
<ul>
<li>A callable returning a new outcome for each old outcome.</li>
<li>A map from old outcomes to new outcomes.
Unmapped old outcomes stay the same.
The new outcomes may be <code><a href="#Deck">Deck</a></code>s, in which case one card is
replaced with several. This is not recommended.</li>
</ul></li>
<li><strong>star:</strong>  If set to <code>True</code> or 1, outcomes of <code>self</code> will be unpacked as
<code>*outcome</code> before giving it to the <code>repl</code> function. <code>extra_dice</code>
are not unpacked. If <code>repl</code> is not a callable, this has no
effect.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Population">Population</a></dt>
                                <dd id="Deck.outcomes" class="function"><a href="#Population.outcomes">outcomes</a></dd>
                <dd id="Deck.outcome_len" class="function"><a href="#Population.outcome_len">outcome_len</a></dd>
                <dd id="Deck.is_empty" class="function"><a href="#Population.is_empty">is_empty</a></dd>
                <dd id="Deck.min_outcome" class="function"><a href="#Population.min_outcome">min_outcome</a></dd>
                <dd id="Deck.max_outcome" class="function"><a href="#Population.max_outcome">max_outcome</a></dd>
                <dd id="Deck.nearest_le" class="function"><a href="#Population.nearest_le">nearest_le</a></dd>
                <dd id="Deck.nearest_ge" class="function"><a href="#Population.nearest_ge">nearest_ge</a></dd>
                <dd id="Deck.quantities" class="function"><a href="#Population.quantities">quantities</a></dd>
                <dd id="Deck.denominator" class="function"><a href="#Population.denominator">denominator</a></dd>
                <dd id="Deck.has_zero_quantities" class="function"><a href="#Population.has_zero_quantities">has_zero_quantities</a></dd>
                <dd id="Deck.quantities_le" class="function"><a href="#Population.quantities_le">quantities_le</a></dd>
                <dd id="Deck.quantities_ge" class="function"><a href="#Population.quantities_ge">quantities_ge</a></dd>
                <dd id="Deck.quantity" class="function"><a href="#Population.quantity">quantity</a></dd>
                <dd id="Deck.quantity_ne" class="function"><a href="#Population.quantity_ne">quantity_ne</a></dd>
                <dd id="Deck.quantity_le" class="function"><a href="#Population.quantity_le">quantity_le</a></dd>
                <dd id="Deck.quantity_lt" class="function"><a href="#Population.quantity_lt">quantity_lt</a></dd>
                <dd id="Deck.quantity_ge" class="function"><a href="#Population.quantity_ge">quantity_ge</a></dd>
                <dd id="Deck.quantity_gt" class="function"><a href="#Population.quantity_gt">quantity_gt</a></dd>
                <dd id="Deck.probabilities" class="function"><a href="#Population.probabilities">probabilities</a></dd>
                <dd id="Deck.probabilities_le" class="function"><a href="#Population.probabilities_le">probabilities_le</a></dd>
                <dd id="Deck.probabilities_ge" class="function"><a href="#Population.probabilities_ge">probabilities_ge</a></dd>
                <dd id="Deck.probabilities_lt" class="function"><a href="#Population.probabilities_lt">probabilities_lt</a></dd>
                <dd id="Deck.probabilities_gt" class="function"><a href="#Population.probabilities_gt">probabilities_gt</a></dd>
                <dd id="Deck.probability" class="function"><a href="#Population.probability">probability</a></dd>
                <dd id="Deck.mode" class="function"><a href="#Population.mode">mode</a></dd>
                <dd id="Deck.modal_quantity" class="function"><a href="#Population.modal_quantity">modal_quantity</a></dd>
                <dd id="Deck.kolmogorov_smirnov" class="function"><a href="#Population.kolmogorov_smirnov">kolmogorov_smirnov</a></dd>
                <dd id="Deck.cramer_von_mises" class="function"><a href="#Population.cramer_von_mises">cramer_von_mises</a></dd>
                <dd id="Deck.median" class="function"><a href="#Population.median">median</a></dd>
                <dd id="Deck.median_left" class="function"><a href="#Population.median_left">median_left</a></dd>
                <dd id="Deck.median_right" class="function"><a href="#Population.median_right">median_right</a></dd>
                <dd id="Deck.quantile" class="function"><a href="#Population.quantile">quantile</a></dd>
                <dd id="Deck.quantile_left" class="function"><a href="#Population.quantile_left">quantile_left</a></dd>
                <dd id="Deck.quantile_right" class="function"><a href="#Population.quantile_right">quantile_right</a></dd>
                <dd id="Deck.mean" class="function"><a href="#Population.mean">mean</a></dd>
                <dd id="Deck.variance" class="function"><a href="#Population.variance">variance</a></dd>
                <dd id="Deck.standard_deviation" class="function"><a href="#Population.standard_deviation">standard_deviation</a></dd>
                <dd id="Deck.sd" class="function"><a href="#Population.sd">sd</a></dd>
                <dd id="Deck.standardized_moment" class="function"><a href="#Population.standardized_moment">standardized_moment</a></dd>
                <dd id="Deck.skewness" class="function"><a href="#Population.skewness">skewness</a></dd>
                <dd id="Deck.excess_kurtosis" class="function"><a href="#Population.excess_kurtosis">excess_kurtosis</a></dd>
                <dd id="Deck.marginals" class="variable"><a href="#Population.marginals">marginals</a></dd>
                <dd id="Deck.unary_op_non_elementwise" class="function"><a href="#Population.unary_op_non_elementwise">unary_op_non_elementwise</a></dd>
                <dd id="Deck.covariance" class="function"><a href="#Population.covariance">covariance</a></dd>
                <dd id="Deck.correlation" class="function"><a href="#Population.correlation">correlation</a></dd>
                <dd id="Deck.sample" class="function"><a href="#Population.sample">sample</a></dd>
                <dd id="Deck.format" class="function"><a href="#Population.format">format</a></dd>

            </div>
            <div><dt>collections.abc.Mapping</dt>
                                <dd id="Deck.get" class="function">get</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Deal">
                            <input id="Deal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Deal</span><wbr>(<span class="base"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span>):

                <label class="view-source-button" for="Deal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal-13"><a href="#Deal-13"><span class="linenos"> 13</span></a><span class="k">class</span> <span class="nc">Deal</span><span class="p">(</span><span class="n">OutcomeCountGenerator</span><span class="p">):</span>
</span><span id="Deal-14"><a href="#Deal-14"><span class="linenos"> 14</span></a>    <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: Represents an sorted/unordered deal of cards from a `Deck`. &quot;&quot;&quot;</span>
</span><span id="Deal-15"><a href="#Deal-15"><span class="linenos"> 15</span></a>
</span><span id="Deal-16"><a href="#Deal-16"><span class="linenos"> 16</span></a>    <span class="n">_deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck&#39;</span>
</span><span id="Deal-17"><a href="#Deal-17"><span class="linenos"> 17</span></a>    <span class="n">_hand_sizes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</span><span id="Deal-18"><a href="#Deal-18"><span class="linenos"> 18</span></a>
</span><span id="Deal-19"><a href="#Deal-19"><span class="linenos"> 19</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Deal-20"><a href="#Deal-20"><span class="linenos"> 20</span></a>        <span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="Deal-21"><a href="#Deal-21"><span class="linenos"> 21</span></a>
</span><span id="Deal-22"><a href="#Deal-22"><span class="linenos"> 22</span></a><span class="sd">        For algorithmic reasons, you must pre-commit to the number of cards to</span>
</span><span id="Deal-23"><a href="#Deal-23"><span class="linenos"> 23</span></a><span class="sd">        deal for each hand.</span>
</span><span id="Deal-24"><a href="#Deal-24"><span class="linenos"> 24</span></a>
</span><span id="Deal-25"><a href="#Deal-25"><span class="linenos"> 25</span></a><span class="sd">        Args:</span>
</span><span id="Deal-26"><a href="#Deal-26"><span class="linenos"> 26</span></a><span class="sd">            deck: The `Deck` to deal from.</span>
</span><span id="Deal-27"><a href="#Deal-27"><span class="linenos"> 27</span></a><span class="sd">            *hand_sizes: How many cards to deal. If multiple `hand_sizes` are</span>
</span><span id="Deal-28"><a href="#Deal-28"><span class="linenos"> 28</span></a><span class="sd">                provided, `OutcomeCountEvaluator.next_state` will recieve one count</span>
</span><span id="Deal-29"><a href="#Deal-29"><span class="linenos"> 29</span></a><span class="sd">                per hand in order. Try to keep the number of hands to a minimum</span>
</span><span id="Deal-30"><a href="#Deal-30"><span class="linenos"> 30</span></a><span class="sd">                as this can be computationally intensive.</span>
</span><span id="Deal-31"><a href="#Deal-31"><span class="linenos"> 31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal-32"><a href="#Deal-32"><span class="linenos"> 32</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">hand</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">hand_sizes</span><span class="p">):</span>
</span><span id="Deal-33"><a href="#Deal-33"><span class="linenos"> 33</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;hand_sizes cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Deal-34"><a href="#Deal-34"><span class="linenos"> 34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="Deal-35"><a href="#Deal-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span> <span class="o">=</span> <span class="n">hand_sizes</span>
</span><span id="Deal-36"><a href="#Deal-36"><span class="linenos"> 36</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="Deal-37"><a href="#Deal-37"><span class="linenos"> 37</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Deal-38"><a href="#Deal-38"><span class="linenos"> 38</span></a>                <span class="s1">&#39;The total number of cards dealt cannot exceed the size of the deck.&#39;</span>
</span><span id="Deal-39"><a href="#Deal-39"><span class="linenos"> 39</span></a>            <span class="p">)</span>
</span><span id="Deal-40"><a href="#Deal-40"><span class="linenos"> 40</span></a>
</span><span id="Deal-41"><a href="#Deal-41"><span class="linenos"> 41</span></a>    <span class="k">def</span> <span class="nf">deck</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deck&#39;</span><span class="p">:</span>
</span><span id="Deal-42"><a href="#Deal-42"><span class="linenos"> 42</span></a>        <span class="sd">&quot;&quot;&quot;The `Deck` the cards are dealt from.&quot;&quot;&quot;</span>
</span><span id="Deal-43"><a href="#Deal-43"><span class="linenos"> 43</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span>
</span><span id="Deal-44"><a href="#Deal-44"><span class="linenos"> 44</span></a>
</span><span id="Deal-45"><a href="#Deal-45"><span class="linenos"> 45</span></a>    <span class="k">def</span> <span class="nf">hand_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Deal-46"><a href="#Deal-46"><span class="linenos"> 46</span></a>        <span class="sd">&quot;&quot;&quot;The number of cards dealt to each hand as a tuple.&quot;&quot;&quot;</span>
</span><span id="Deal-47"><a href="#Deal-47"><span class="linenos"> 47</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span>
</span><span id="Deal-48"><a href="#Deal-48"><span class="linenos"> 48</span></a>
</span><span id="Deal-49"><a href="#Deal-49"><span class="linenos"> 49</span></a>    <span class="k">def</span> <span class="nf">total_cards_dealt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-50"><a href="#Deal-50"><span class="linenos"> 50</span></a>        <span class="sd">&quot;&quot;&quot;The total number of cards dealt.&quot;&quot;&quot;</span>
</span><span id="Deal-51"><a href="#Deal-51"><span class="linenos"> 51</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">())</span>
</span><span id="Deal-52"><a href="#Deal-52"><span class="linenos"> 52</span></a>
</span><span id="Deal-53"><a href="#Deal-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Deal-54"><a href="#Deal-54"><span class="linenos"> 54</span></a>        <span class="sd">&quot;&quot;&quot;The outcomes of the `Deck` in sorted order.</span>
</span><span id="Deal-55"><a href="#Deal-55"><span class="linenos"> 55</span></a>
</span><span id="Deal-56"><a href="#Deal-56"><span class="linenos"> 56</span></a><span class="sd">        These are also the `keys` of the `Deck` as a `Mapping`.</span>
</span><span id="Deal-57"><a href="#Deal-57"><span class="linenos"> 57</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Deal-58"><a href="#Deal-58"><span class="linenos"> 58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal-59"><a href="#Deal-59"><span class="linenos"> 59</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span><span id="Deal-60"><a href="#Deal-60"><span class="linenos"> 60</span></a>
</span><span id="Deal-61"><a href="#Deal-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-62"><a href="#Deal-62"><span class="linenos"> 62</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span><span class="p">)</span>
</span><span id="Deal-63"><a href="#Deal-63"><span class="linenos"> 63</span></a>
</span><span id="Deal-64"><a href="#Deal-64"><span class="linenos"> 64</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Deal-65"><a href="#Deal-65"><span class="linenos"> 65</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="Deal-66"><a href="#Deal-66"><span class="linenos"> 66</span></a>
</span><span id="Deal-67"><a href="#Deal-67"><span class="linenos"> 67</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deal-68"><a href="#Deal-68"><span class="linenos"> 68</span></a>    <span class="k">def</span> <span class="nf">_denomiator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-69"><a href="#Deal-69"><span class="linenos"> 69</span></a>        <span class="n">d_total</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span>
</span><span id="Deal-70"><a href="#Deal-70"><span class="linenos"> 70</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">())</span>
</span><span id="Deal-71"><a href="#Deal-71"><span class="linenos"> 71</span></a>        <span class="n">d_split</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span>
</span><span id="Deal-72"><a href="#Deal-72"><span class="linenos"> 72</span></a>            <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">(),</span> <span class="n">h</span><span class="p">)</span>
</span><span id="Deal-73"><a href="#Deal-73"><span class="linenos"> 73</span></a>            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="Deal-74"><a href="#Deal-74"><span class="linenos"> 74</span></a>        <span class="k">return</span> <span class="n">d_total</span> <span class="o">*</span> <span class="n">d_split</span>
</span><span id="Deal-75"><a href="#Deal-75"><span class="linenos"> 75</span></a>
</span><span id="Deal-76"><a href="#Deal-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-77"><a href="#Deal-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denomiator</span>
</span><span id="Deal-78"><a href="#Deal-78"><span class="linenos"> 78</span></a>
</span><span id="Deal-79"><a href="#Deal-79"><span class="linenos"> 79</span></a>    <span class="k">def</span> <span class="nf">_generate_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">popped_deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck&#39;</span><span class="p">,</span>
</span><span id="Deal-80"><a href="#Deal-80"><span class="linenos"> 80</span></a>                         <span class="n">deck_count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="Deal-81"><a href="#Deal-81"><span class="linenos"> 81</span></a>        <span class="sd">&quot;&quot;&quot;Common implementation for _generate_min and _generate_max.&quot;&quot;&quot;</span>
</span><span id="Deal-82"><a href="#Deal-82"><span class="linenos"> 82</span></a>        <span class="n">min_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
</span><span id="Deal-83"><a href="#Deal-83"><span class="linenos"> 83</span></a>            <span class="mi">0</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">())</span>
</span><span id="Deal-84"><a href="#Deal-84"><span class="linenos"> 84</span></a>        <span class="n">max_count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">())</span>
</span><span id="Deal-85"><a href="#Deal-85"><span class="linenos"> 85</span></a>        <span class="k">for</span> <span class="n">count_total</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_count</span><span class="p">,</span> <span class="n">max_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Deal-86"><a href="#Deal-86"><span class="linenos"> 86</span></a>            <span class="n">weight_total</span> <span class="o">=</span> <span class="n">icepool</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">deck_count</span><span class="p">,</span> <span class="n">count_total</span><span class="p">)</span>
</span><span id="Deal-87"><a href="#Deal-87"><span class="linenos"> 87</span></a>            <span class="c1"># The &quot;deck&quot; is the hand sizes.</span>
</span><span id="Deal-88"><a href="#Deal-88"><span class="linenos"> 88</span></a>            <span class="k">for</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weight_split</span> <span class="ow">in</span> <span class="n">iter_hypergeom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">(),</span>
</span><span id="Deal-89"><a href="#Deal-89"><span class="linenos"> 89</span></a>                                                       <span class="n">count_total</span><span class="p">):</span>
</span><span id="Deal-90"><a href="#Deal-90"><span class="linenos"> 90</span></a>                <span class="n">popped_deal</span> <span class="o">=</span> <span class="n">Deal</span><span class="p">(</span>
</span><span id="Deal-91"><a href="#Deal-91"><span class="linenos"> 91</span></a>                    <span class="n">popped_deck</span><span class="p">,</span>
</span><span id="Deal-92"><a href="#Deal-92"><span class="linenos"> 92</span></a>                    <span class="o">*</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">c</span> <span class="k">for</span> <span class="n">h</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">(),</span> <span class="n">counts</span><span class="p">)))</span>
</span><span id="Deal-93"><a href="#Deal-93"><span class="linenos"> 93</span></a>                <span class="n">weight</span> <span class="o">=</span> <span class="n">weight_total</span> <span class="o">*</span> <span class="n">weight_split</span>
</span><span id="Deal-94"><a href="#Deal-94"><span class="linenos"> 94</span></a>                <span class="k">yield</span> <span class="n">popped_deal</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="Deal-95"><a href="#Deal-95"><span class="linenos"> 95</span></a>
</span><span id="Deal-96"><a href="#Deal-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="Deal-97"><a href="#Deal-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">min_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">():</span>
</span><span id="Deal-98"><a href="#Deal-98"><span class="linenos"> 98</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="mi">1</span>
</span><span id="Deal-99"><a href="#Deal-99"><span class="linenos"> 99</span></a>            <span class="k">return</span>
</span><span id="Deal-100"><a href="#Deal-100"><span class="linenos">100</span></a>
</span><span id="Deal-101"><a href="#Deal-101"><span class="linenos">101</span></a>        <span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">_pop_min</span><span class="p">()</span>
</span><span id="Deal-102"><a href="#Deal-102"><span class="linenos">102</span></a>
</span><span id="Deal-103"><a href="#Deal-103"><span class="linenos">103</span></a>        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_common</span><span class="p">(</span><span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span><span class="p">)</span>
</span><span id="Deal-104"><a href="#Deal-104"><span class="linenos">104</span></a>
</span><span id="Deal-105"><a href="#Deal-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="Deal-106"><a href="#Deal-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">max_outcome</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">():</span>
</span><span id="Deal-107"><a href="#Deal-107"><span class="linenos">107</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="mi">1</span>
</span><span id="Deal-108"><a href="#Deal-108"><span class="linenos">108</span></a>            <span class="k">return</span>
</span><span id="Deal-109"><a href="#Deal-109"><span class="linenos">109</span></a>
</span><span id="Deal-110"><a href="#Deal-110"><span class="linenos">110</span></a>        <span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">_pop_max</span><span class="p">()</span>
</span><span id="Deal-111"><a href="#Deal-111"><span class="linenos">111</span></a>
</span><span id="Deal-112"><a href="#Deal-112"><span class="linenos">112</span></a>        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_common</span><span class="p">(</span><span class="n">popped_deck</span><span class="p">,</span> <span class="n">deck_count</span><span class="p">)</span>
</span><span id="Deal-113"><a href="#Deal-113"><span class="linenos">113</span></a>
</span><span id="Deal-114"><a href="#Deal-114"><span class="linenos">114</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Deal-115"><a href="#Deal-115"><span class="linenos">115</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">())</span>
</span><span id="Deal-116"><a href="#Deal-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">result</span>
</span><span id="Deal-117"><a href="#Deal-117"><span class="linenos">117</span></a>
</span><span id="Deal-118"><a href="#Deal-118"><span class="linenos">118</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deal-119"><a href="#Deal-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">_key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="Deal-120"><a href="#Deal-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="n">Deal</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()</span>
</span><span id="Deal-121"><a href="#Deal-121"><span class="linenos">121</span></a>
</span><span id="Deal-122"><a href="#Deal-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Deal-123"><a href="#Deal-123"><span class="linenos">123</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Deal</span><span class="p">):</span>
</span><span id="Deal-124"><a href="#Deal-124"><span class="linenos">124</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Deal-125"><a href="#Deal-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_key_tuple</span>
</span><span id="Deal-126"><a href="#Deal-126"><span class="linenos">126</span></a>
</span><span id="Deal-127"><a href="#Deal-127"><span class="linenos">127</span></a>    <span class="nd">@cached_property</span>
</span><span id="Deal-128"><a href="#Deal-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-129"><a href="#Deal-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span><span class="p">)</span>
</span><span id="Deal-130"><a href="#Deal-130"><span class="linenos">130</span></a>
</span><span id="Deal-131"><a href="#Deal-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal-132"><a href="#Deal-132"><span class="linenos">132</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="Deal-133"><a href="#Deal-133"><span class="linenos">133</span></a>
</span><span id="Deal-134"><a href="#Deal-134"><span class="linenos">134</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Deal-135"><a href="#Deal-135"><span class="linenos">135</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span>
</span><span id="Deal-136"><a href="#Deal-136"><span class="linenos">136</span></a>            <span class="bp">self</span>
</span><span id="Deal-137"><a href="#Deal-137"><span class="linenos">137</span></a>        <span class="p">)</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">())</span><span class="si">}</span><span class="s1">, hand_sizes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()</span><span class="si">}</span><span class="s1">)&#39;</span>
</span><span id="Deal-138"><a href="#Deal-138"><span class="linenos">138</span></a>
</span><span id="Deal-139"><a href="#Deal-139"><span class="linenos">139</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Deal-140"><a href="#Deal-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Deal of hand_sizes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">()</span><span class="si">}</span><span class="s1"> from deck:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="Deal-141"><a href="#Deal-141"><span class="linenos">141</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: Represents an sorted/unordered deal of cards from a <code><a href="#Deck">Deck</a></code>.</p>
</div>


                            <div id="Deal.__init__" class="classattr">
                                        <input id="Deal.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Deal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">deck</span><span class="p">:</span> <span class="n"><a href="#Deck">icepool.Deck</a></span>, </span><span class="param"><span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="Deal.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.__init__-19"><a href="#Deal.__init__-19"><span class="linenos">19</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">deck</span><span class="p">:</span> <span class="s1">&#39;icepool.Deck&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">hand_sizes</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Deal.__init__-20"><a href="#Deal.__init__-20"><span class="linenos">20</span></a>        <span class="sd">&quot;&quot;&quot;Constructor.</span>
</span><span id="Deal.__init__-21"><a href="#Deal.__init__-21"><span class="linenos">21</span></a>
</span><span id="Deal.__init__-22"><a href="#Deal.__init__-22"><span class="linenos">22</span></a><span class="sd">        For algorithmic reasons, you must pre-commit to the number of cards to</span>
</span><span id="Deal.__init__-23"><a href="#Deal.__init__-23"><span class="linenos">23</span></a><span class="sd">        deal for each hand.</span>
</span><span id="Deal.__init__-24"><a href="#Deal.__init__-24"><span class="linenos">24</span></a>
</span><span id="Deal.__init__-25"><a href="#Deal.__init__-25"><span class="linenos">25</span></a><span class="sd">        Args:</span>
</span><span id="Deal.__init__-26"><a href="#Deal.__init__-26"><span class="linenos">26</span></a><span class="sd">            deck: The `Deck` to deal from.</span>
</span><span id="Deal.__init__-27"><a href="#Deal.__init__-27"><span class="linenos">27</span></a><span class="sd">            *hand_sizes: How many cards to deal. If multiple `hand_sizes` are</span>
</span><span id="Deal.__init__-28"><a href="#Deal.__init__-28"><span class="linenos">28</span></a><span class="sd">                provided, `OutcomeCountEvaluator.next_state` will recieve one count</span>
</span><span id="Deal.__init__-29"><a href="#Deal.__init__-29"><span class="linenos">29</span></a><span class="sd">                per hand in order. Try to keep the number of hands to a minimum</span>
</span><span id="Deal.__init__-30"><a href="#Deal.__init__-30"><span class="linenos">30</span></a><span class="sd">                as this can be computationally intensive.</span>
</span><span id="Deal.__init__-31"><a href="#Deal.__init__-31"><span class="linenos">31</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal.__init__-32"><a href="#Deal.__init__-32"><span class="linenos">32</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">hand</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">hand</span> <span class="ow">in</span> <span class="n">hand_sizes</span><span class="p">):</span>
</span><span id="Deal.__init__-33"><a href="#Deal.__init__-33"><span class="linenos">33</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;hand_sizes cannot be negative.&#39;</span><span class="p">)</span>
</span><span id="Deal.__init__-34"><a href="#Deal.__init__-34"><span class="linenos">34</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span> <span class="o">=</span> <span class="n">deck</span>
</span><span id="Deal.__init__-35"><a href="#Deal.__init__-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span> <span class="o">=</span> <span class="n">hand_sizes</span>
</span><span id="Deal.__init__-36"><a href="#Deal.__init__-36"><span class="linenos">36</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_cards_dealt</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">size</span><span class="p">():</span>
</span><span id="Deal.__init__-37"><a href="#Deal.__init__-37"><span class="linenos">37</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Deal.__init__-38"><a href="#Deal.__init__-38"><span class="linenos">38</span></a>                <span class="s1">&#39;The total number of cards dealt cannot exceed the size of the deck.&#39;</span>
</span><span id="Deal.__init__-39"><a href="#Deal.__init__-39"><span class="linenos">39</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructor.</p>

<p>For algorithmic reasons, you must pre-commit to the number of cards to
deal for each hand.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>deck:</strong>  The <code><a href="#Deck">Deck</a></code> to deal from.</li>
<li><strong>*hand_sizes:</strong>  How many cards to deal. If multiple <code><a href="#Deal.hand_sizes">hand_sizes</a></code> are
provided, <code><a href="#OutcomeCountEvaluator.next_state">OutcomeCountEvaluator.next_state</a></code> will recieve one count
per hand in order. Try to keep the number of hands to a minimum
as this can be computationally intensive.</li>
</ul>
</div>


                            </div>
                            <div id="Deal.deck" class="classattr">
                                        <input id="Deal.deck-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deck</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#Deck">icepool.Deck</a></span>:</span></span>

                <label class="view-source-button" for="Deal.deck-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.deck"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.deck-41"><a href="#Deal.deck-41"><span class="linenos">41</span></a>    <span class="k">def</span> <span class="nf">deck</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;icepool.Deck&#39;</span><span class="p">:</span>
</span><span id="Deal.deck-42"><a href="#Deal.deck-42"><span class="linenos">42</span></a>        <span class="sd">&quot;&quot;&quot;The `Deck` the cards are dealt from.&quot;&quot;&quot;</span>
</span><span id="Deal.deck-43"><a href="#Deal.deck-43"><span class="linenos">43</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deck</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#Deck">Deck</a></code> the cards are dealt from.</p>
</div>


                            </div>
                            <div id="Deal.hand_sizes" class="classattr">
                                        <input id="Deal.hand_sizes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hand_sizes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Deal.hand_sizes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.hand_sizes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.hand_sizes-45"><a href="#Deal.hand_sizes-45"><span class="linenos">45</span></a>    <span class="k">def</span> <span class="nf">hand_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Deal.hand_sizes-46"><a href="#Deal.hand_sizes-46"><span class="linenos">46</span></a>        <span class="sd">&quot;&quot;&quot;The number of cards dealt to each hand as a tuple.&quot;&quot;&quot;</span>
</span><span id="Deal.hand_sizes-47"><a href="#Deal.hand_sizes-47"><span class="linenos">47</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span>
</span></pre></div>


            <div class="docstring"><p>The number of cards dealt to each hand as a tuple.</p>
</div>


                            </div>
                            <div id="Deal.total_cards_dealt" class="classattr">
                                        <input id="Deal.total_cards_dealt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">total_cards_dealt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deal.total_cards_dealt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.total_cards_dealt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.total_cards_dealt-49"><a href="#Deal.total_cards_dealt-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="nf">total_cards_dealt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal.total_cards_dealt-50"><a href="#Deal.total_cards_dealt-50"><span class="linenos">50</span></a>        <span class="sd">&quot;&quot;&quot;The total number of cards dealt.&quot;&quot;&quot;</span>
</span><span id="Deal.total_cards_dealt-51"><a href="#Deal.total_cards_dealt-51"><span class="linenos">51</span></a>        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hand_sizes</span><span class="p">())</span>
</span></pre></div>


            <div class="docstring"><p>The total number of cards dealt.</p>
</div>


                            </div>
                            <div id="Deal.outcomes" class="classattr">
                                        <input id="Deal.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#CountsKeysView">icepool.CountsKeysView</a></span>:</span></span>

                <label class="view-source-button" for="Deal.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.outcomes-53"><a href="#Deal.outcomes-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CountsKeysView</span><span class="p">:</span>
</span><span id="Deal.outcomes-54"><a href="#Deal.outcomes-54"><span class="linenos">54</span></a>        <span class="sd">&quot;&quot;&quot;The outcomes of the `Deck` in sorted order.</span>
</span><span id="Deal.outcomes-55"><a href="#Deal.outcomes-55"><span class="linenos">55</span></a>
</span><span id="Deal.outcomes-56"><a href="#Deal.outcomes-56"><span class="linenos">56</span></a><span class="sd">        These are also the `keys` of the `Deck` as a `Mapping`.</span>
</span><span id="Deal.outcomes-57"><a href="#Deal.outcomes-57"><span class="linenos">57</span></a><span class="sd">        Prefer to use the name `outcomes`.</span>
</span><span id="Deal.outcomes-58"><a href="#Deal.outcomes-58"><span class="linenos">58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Deal.outcomes-59"><a href="#Deal.outcomes-59"><span class="linenos">59</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck</span><span class="p">()</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The outcomes of the <code><a href="#Deck">Deck</a></code> in sorted order.</p>

<p>These are also the <code>keys</code> of the <code><a href="#Deck">Deck</a></code> as a <code>Mapping</code>.
Prefer to use the name <code><a href="#Deal.outcomes">outcomes</a></code>.</p>
</div>


                            </div>
                            <div id="Deal.counts_len" class="classattr">
                                        <input id="Deal.counts_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">counts_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deal.counts_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.counts_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.counts_len-61"><a href="#Deal.counts_len-61"><span class="linenos">61</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal.counts_len-62"><a href="#Deal.counts_len-62"><span class="linenos">62</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hand_sizes</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The number of counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="Deal.denominator" class="classattr">
                                        <input id="Deal.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="Deal.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Deal.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Deal.denominator-76"><a href="#Deal.denominator-76"><span class="linenos">76</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Deal.denominator-77"><a href="#Deal.denominator-77"><span class="linenos">77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_denomiator</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></dt>
                                <dd id="Deal.evaluate" class="function"><a href="#OutcomeCountGenerator.evaluate">evaluate</a></dd>
                <dd id="Deal.min_outcome" class="function"><a href="#OutcomeCountGenerator.min_outcome">min_outcome</a></dd>
                <dd id="Deal.max_outcome" class="function"><a href="#OutcomeCountGenerator.max_outcome">max_outcome</a></dd>
                <dd id="Deal.expand" class="function"><a href="#OutcomeCountGenerator.expand">expand</a></dd>
                <dd id="Deal.sum" class="function"><a href="#OutcomeCountGenerator.sum">sum</a></dd>
                <dd id="Deal.count" class="function"><a href="#OutcomeCountGenerator.count">count</a></dd>
                <dd id="Deal.count_in" class="function"><a href="#OutcomeCountGenerator.count_in">count_in</a></dd>
                <dd id="Deal.count_unique" class="function"><a href="#OutcomeCountGenerator.count_unique">count_unique</a></dd>
                <dd id="Deal.contains_subset" class="function"><a href="#OutcomeCountGenerator.contains_subset">contains_subset</a></dd>
                <dd id="Deal.intersection_size" class="function"><a href="#OutcomeCountGenerator.intersection_size">intersection_size</a></dd>
                <dd id="Deal.best_matching_set" class="function"><a href="#OutcomeCountGenerator.best_matching_set">best_matching_set</a></dd>
                <dd id="Deal.best_straight" class="function"><a href="#OutcomeCountGenerator.best_straight">best_straight</a></dd>
                <dd id="Deal.sample" class="function"><a href="#OutcomeCountGenerator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SuitGenerator">
                            <input id="SuitGenerator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SuitGenerator</span><wbr>(<span class="base"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span>):

                <label class="view-source-button" for="SuitGenerator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SuitGenerator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SuitGenerator-12"><a href="#SuitGenerator-12"><span class="linenos"> 12</span></a><span class="k">class</span> <span class="nc">SuitGenerator</span><span class="p">(</span><span class="n">OutcomeCountGenerator</span><span class="p">):</span>
</span><span id="SuitGenerator-13"><a href="#SuitGenerator-13"><span class="linenos"> 13</span></a>    <span class="sd">&quot;&quot;&quot;EXPERIMENTAL: A meta-generator that groups 2-tuple outcomes from a source generator.</span>
</span><span id="SuitGenerator-14"><a href="#SuitGenerator-14"><span class="linenos"> 14</span></a>
</span><span id="SuitGenerator-15"><a href="#SuitGenerator-15"><span class="linenos"> 15</span></a><span class="sd">    This wraps a generator whose outcomes are of the form `(face, suit)`,</span>
</span><span id="SuitGenerator-16"><a href="#SuitGenerator-16"><span class="linenos"> 16</span></a><span class="sd">    and yields `outcomes` equal to `face` and `counts` that are mappings</span>
</span><span id="SuitGenerator-17"><a href="#SuitGenerator-17"><span class="linenos"> 17</span></a><span class="sd">    from `suit` to the count of that face and suit.</span>
</span><span id="SuitGenerator-18"><a href="#SuitGenerator-18"><span class="linenos"> 18</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SuitGenerator-19"><a href="#SuitGenerator-19"><span class="linenos"> 19</span></a>
</span><span id="SuitGenerator-20"><a href="#SuitGenerator-20"><span class="linenos"> 20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">OutcomeCountGenerator</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span id="SuitGenerator-21"><a href="#SuitGenerator-21"><span class="linenos"> 21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="n">src</span>
</span><span id="SuitGenerator-22"><a href="#SuitGenerator-22"><span class="linenos"> 22</span></a>
</span><span id="SuitGenerator-23"><a href="#SuitGenerator-23"><span class="linenos"> 23</span></a>    <span class="nd">@cached_property</span>
</span><span id="SuitGenerator-24"><a href="#SuitGenerator-24"><span class="linenos"> 24</span></a>    <span class="k">def</span> <span class="nf">_outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="SuitGenerator-25"><a href="#SuitGenerator-25"><span class="linenos"> 25</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">outcome</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">outcomes</span><span class="p">())</span>
</span><span id="SuitGenerator-26"><a href="#SuitGenerator-26"><span class="linenos"> 26</span></a>
</span><span id="SuitGenerator-27"><a href="#SuitGenerator-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="SuitGenerator-28"><a href="#SuitGenerator-28"><span class="linenos"> 28</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span><span id="SuitGenerator-29"><a href="#SuitGenerator-29"><span class="linenos"> 29</span></a>
</span><span id="SuitGenerator-30"><a href="#SuitGenerator-30"><span class="linenos"> 30</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SuitGenerator-31"><a href="#SuitGenerator-31"><span class="linenos"> 31</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">counts_len</span><span class="p">()</span>
</span><span id="SuitGenerator-32"><a href="#SuitGenerator-32"><span class="linenos"> 32</span></a>
</span><span id="SuitGenerator-33"><a href="#SuitGenerator-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="nf">_is_resolvable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SuitGenerator-34"><a href="#SuitGenerator-34"><span class="linenos"> 34</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">_is_resolvable</span><span class="p">()</span>
</span><span id="SuitGenerator-35"><a href="#SuitGenerator-35"><span class="linenos"> 35</span></a>
</span><span id="SuitGenerator-36"><a href="#SuitGenerator-36"><span class="linenos"> 36</span></a>    <span class="k">def</span> <span class="nf">_generate_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="SuitGenerator-37"><a href="#SuitGenerator-37"><span class="linenos"> 37</span></a>        <span class="n">blank_counts</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">defaultdict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SuitGenerator-38"><a href="#SuitGenerator-38"><span class="linenos"> 38</span></a>            <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts_len</span><span class="p">())</span>
</span><span id="SuitGenerator-39"><a href="#SuitGenerator-39"><span class="linenos"> 39</span></a>        <span class="p">]</span>
</span><span id="SuitGenerator-40"><a href="#SuitGenerator-40"><span class="linenos"> 40</span></a>        <span class="k">for</span> <span class="n">popped_src</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span> <span class="ow">in</span> <span class="n">SuitGenerator</span><span class="o">.</span><span class="n">_generate_min_internal</span><span class="p">(</span>
</span><span id="SuitGenerator-41"><a href="#SuitGenerator-41"><span class="linenos"> 41</span></a>                <span class="n">min_outcome</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">,</span> <span class="n">blank_counts</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SuitGenerator-42"><a href="#SuitGenerator-42"><span class="linenos"> 42</span></a>            <span class="k">yield</span> <span class="n">SuitGenerator</span><span class="p">(</span><span class="n">popped_src</span><span class="p">),</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span>
</span><span id="SuitGenerator-43"><a href="#SuitGenerator-43"><span class="linenos"> 43</span></a>
</span><span id="SuitGenerator-44"><a href="#SuitGenerator-44"><span class="linenos"> 44</span></a>    <span class="k">def</span> <span class="nf">_generate_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_outcome</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NextOutcomeCountGenerator</span><span class="p">:</span>
</span><span id="SuitGenerator-45"><a href="#SuitGenerator-45"><span class="linenos"> 45</span></a>        <span class="n">blank_counts</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">defaultdict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="SuitGenerator-46"><a href="#SuitGenerator-46"><span class="linenos"> 46</span></a>            <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">counts_len</span><span class="p">())</span>
</span><span id="SuitGenerator-47"><a href="#SuitGenerator-47"><span class="linenos"> 47</span></a>        <span class="p">]</span>
</span><span id="SuitGenerator-48"><a href="#SuitGenerator-48"><span class="linenos"> 48</span></a>        <span class="k">for</span> <span class="n">popped_src</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span> <span class="ow">in</span> <span class="n">SuitGenerator</span><span class="o">.</span><span class="n">_generate_max_internal</span><span class="p">(</span>
</span><span id="SuitGenerator-49"><a href="#SuitGenerator-49"><span class="linenos"> 49</span></a>                <span class="n">max_outcome</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="p">,</span> <span class="n">blank_counts</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="SuitGenerator-50"><a href="#SuitGenerator-50"><span class="linenos"> 50</span></a>            <span class="k">yield</span> <span class="n">SuitGenerator</span><span class="p">(</span><span class="n">popped_src</span><span class="p">),</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weights</span>
</span><span id="SuitGenerator-51"><a href="#SuitGenerator-51"><span class="linenos"> 51</span></a>
</span><span id="SuitGenerator-52"><a href="#SuitGenerator-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="nf">_estimate_order_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="SuitGenerator-53"><a href="#SuitGenerator-53"><span class="linenos"> 53</span></a>        <span class="c1"># We might consider up-costing this.</span>
</span><span id="SuitGenerator-54"><a href="#SuitGenerator-54"><span class="linenos"> 54</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">_estimate_order_costs</span><span class="p">()</span>
</span><span id="SuitGenerator-55"><a href="#SuitGenerator-55"><span class="linenos"> 55</span></a>
</span><span id="SuitGenerator-56"><a href="#SuitGenerator-56"><span class="linenos"> 56</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SuitGenerator-57"><a href="#SuitGenerator-57"><span class="linenos"> 57</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span><span id="SuitGenerator-58"><a href="#SuitGenerator-58"><span class="linenos"> 58</span></a>
</span><span id="SuitGenerator-59"><a href="#SuitGenerator-59"><span class="linenos"> 59</span></a>    <span class="nd">@cached_property</span>
</span><span id="SuitGenerator-60"><a href="#SuitGenerator-60"><span class="linenos"> 60</span></a>    <span class="k">def</span> <span class="nf">_key_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="SuitGenerator-61"><a href="#SuitGenerator-61"><span class="linenos"> 61</span></a>        <span class="k">return</span> <span class="n">SuitGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span>
</span><span id="SuitGenerator-62"><a href="#SuitGenerator-62"><span class="linenos"> 62</span></a>
</span><span id="SuitGenerator-63"><a href="#SuitGenerator-63"><span class="linenos"> 63</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SuitGenerator-64"><a href="#SuitGenerator-64"><span class="linenos"> 64</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SuitGenerator</span><span class="p">):</span>
</span><span id="SuitGenerator-65"><a href="#SuitGenerator-65"><span class="linenos"> 65</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="SuitGenerator-66"><a href="#SuitGenerator-66"><span class="linenos"> 66</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_key_tuple</span>
</span><span id="SuitGenerator-67"><a href="#SuitGenerator-67"><span class="linenos"> 67</span></a>
</span><span id="SuitGenerator-68"><a href="#SuitGenerator-68"><span class="linenos"> 68</span></a>    <span class="nd">@cached_property</span>
</span><span id="SuitGenerator-69"><a href="#SuitGenerator-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="nf">_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SuitGenerator-70"><a href="#SuitGenerator-70"><span class="linenos"> 70</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_key_tuple</span><span class="p">)</span>
</span><span id="SuitGenerator-71"><a href="#SuitGenerator-71"><span class="linenos"> 71</span></a>
</span><span id="SuitGenerator-72"><a href="#SuitGenerator-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SuitGenerator-73"><a href="#SuitGenerator-73"><span class="linenos"> 73</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hash</span>
</span><span id="SuitGenerator-74"><a href="#SuitGenerator-74"><span class="linenos"> 74</span></a>
</span><span id="SuitGenerator-75"><a href="#SuitGenerator-75"><span class="linenos"> 75</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SuitGenerator-76"><a href="#SuitGenerator-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">_generate_min_internal</span><span class="p">(</span><span class="n">min_outcome</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">OutcomeCountGenerator</span><span class="p">,</span>
</span><span id="SuitGenerator-77"><a href="#SuitGenerator-77"><span class="linenos"> 77</span></a>                               <span class="n">counts</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">defaultdict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span>
</span><span id="SuitGenerator-78"><a href="#SuitGenerator-78"><span class="linenos"> 78</span></a>                                                            <span class="nb">int</span><span class="p">]],</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="SuitGenerator-79"><a href="#SuitGenerator-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">src</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">src</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">min_outcome</span><span class="p">:</span>
</span><span id="SuitGenerator-80"><a href="#SuitGenerator-80"><span class="linenos"> 80</span></a>            <span class="k">yield</span> <span class="n">src</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="SuitGenerator-81"><a href="#SuitGenerator-81"><span class="linenos"> 81</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SuitGenerator-82"><a href="#SuitGenerator-82"><span class="linenos"> 82</span></a>            <span class="k">for</span> <span class="n">sub_src</span><span class="p">,</span> <span class="n">sub_counts</span><span class="p">,</span> <span class="n">sub_weight</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">_generate_min</span><span class="p">(</span>
</span><span id="SuitGenerator-83"><a href="#SuitGenerator-83"><span class="linenos"> 83</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()):</span>
</span><span id="SuitGenerator-84"><a href="#SuitGenerator-84"><span class="linenos"> 84</span></a>                <span class="n">next_counts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SuitGenerator-85"><a href="#SuitGenerator-85"><span class="linenos"> 85</span></a>                <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">sub_count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">sub_counts</span><span class="p">):</span>
</span><span id="SuitGenerator-86"><a href="#SuitGenerator-86"><span class="linenos"> 86</span></a>                    <span class="n">next_count</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="SuitGenerator-87"><a href="#SuitGenerator-87"><span class="linenos"> 87</span></a>                    <span class="n">next_count</span><span class="p">[</span><span class="n">src</span><span class="o">.</span><span class="n">min_outcome</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sub_count</span>
</span><span id="SuitGenerator-88"><a href="#SuitGenerator-88"><span class="linenos"> 88</span></a>                    <span class="n">next_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_count</span><span class="p">)</span>
</span><span id="SuitGenerator-89"><a href="#SuitGenerator-89"><span class="linenos"> 89</span></a>                <span class="k">yield from</span> <span class="n">SuitGenerator</span><span class="o">.</span><span class="n">_generate_min_internal</span><span class="p">(</span>
</span><span id="SuitGenerator-90"><a href="#SuitGenerator-90"><span class="linenos"> 90</span></a>                    <span class="n">min_outcome</span><span class="p">,</span> <span class="n">sub_src</span><span class="p">,</span> <span class="n">next_counts</span><span class="p">,</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">sub_weight</span><span class="p">)</span>
</span><span id="SuitGenerator-91"><a href="#SuitGenerator-91"><span class="linenos"> 91</span></a>
</span><span id="SuitGenerator-92"><a href="#SuitGenerator-92"><span class="linenos"> 92</span></a>    <span class="nd">@staticmethod</span>
</span><span id="SuitGenerator-93"><a href="#SuitGenerator-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="nf">_generate_max_internal</span><span class="p">(</span><span class="n">max_outcome</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">OutcomeCountGenerator</span><span class="p">,</span>
</span><span id="SuitGenerator-94"><a href="#SuitGenerator-94"><span class="linenos"> 94</span></a>                               <span class="n">counts</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">defaultdict</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span>
</span><span id="SuitGenerator-95"><a href="#SuitGenerator-95"><span class="linenos"> 95</span></a>                                                            <span class="nb">int</span><span class="p">]],</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="SuitGenerator-96"><a href="#SuitGenerator-96"><span class="linenos"> 96</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">src</span><span class="o">.</span><span class="n">outcomes</span><span class="p">()</span> <span class="ow">or</span> <span class="n">src</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">max_outcome</span><span class="p">:</span>
</span><span id="SuitGenerator-97"><a href="#SuitGenerator-97"><span class="linenos"> 97</span></a>            <span class="k">yield</span> <span class="n">src</span><span class="p">,</span> <span class="n">counts</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="SuitGenerator-98"><a href="#SuitGenerator-98"><span class="linenos"> 98</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SuitGenerator-99"><a href="#SuitGenerator-99"><span class="linenos"> 99</span></a>            <span class="k">for</span> <span class="n">sub_src</span><span class="p">,</span> <span class="n">sub_counts</span><span class="p">,</span> <span class="n">sub_weight</span> <span class="ow">in</span> <span class="n">src</span><span class="o">.</span><span class="n">_generate_max</span><span class="p">(</span>
</span><span id="SuitGenerator-100"><a href="#SuitGenerator-100"><span class="linenos">100</span></a>                    <span class="n">src</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()):</span>
</span><span id="SuitGenerator-101"><a href="#SuitGenerator-101"><span class="linenos">101</span></a>                <span class="n">next_counts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SuitGenerator-102"><a href="#SuitGenerator-102"><span class="linenos">102</span></a>                <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">sub_count</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">sub_counts</span><span class="p">):</span>
</span><span id="SuitGenerator-103"><a href="#SuitGenerator-103"><span class="linenos">103</span></a>                    <span class="n">next_count</span> <span class="o">=</span> <span class="n">count</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="SuitGenerator-104"><a href="#SuitGenerator-104"><span class="linenos">104</span></a>                    <span class="n">next_count</span><span class="p">[</span><span class="n">src</span><span class="o">.</span><span class="n">max_outcome</span><span class="p">()[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sub_count</span>
</span><span id="SuitGenerator-105"><a href="#SuitGenerator-105"><span class="linenos">105</span></a>                    <span class="n">next_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_count</span><span class="p">)</span>
</span><span id="SuitGenerator-106"><a href="#SuitGenerator-106"><span class="linenos">106</span></a>                <span class="k">yield from</span> <span class="n">SuitGenerator</span><span class="o">.</span><span class="n">_generate_max_internal</span><span class="p">(</span>
</span><span id="SuitGenerator-107"><a href="#SuitGenerator-107"><span class="linenos">107</span></a>                    <span class="n">max_outcome</span><span class="p">,</span> <span class="n">sub_src</span><span class="p">,</span> <span class="n">next_counts</span><span class="p">,</span> <span class="n">weight</span> <span class="o">*</span> <span class="n">sub_weight</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>EXPERIMENTAL: A meta-generator that groups 2-tuple outcomes from a source generator.</p>

<p>This wraps a generator whose outcomes are of the form <code>(face, suit)</code>,
and yields <code><a href="#SuitGenerator.outcomes">outcomes</a></code> equal to <code>face</code> and <code>counts</code> that are mappings
from <code>suit</code> to the count of that face and suit.</p>
</div>


                            <div id="SuitGenerator.__init__" class="classattr">
                                        <input id="SuitGenerator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SuitGenerator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">src</span><span class="p">:</span> <span class="n"><a href="#OutcomeCountGenerator">icepool.OutcomeCountGenerator</a></span>, </span><span class="param"><span class="o">/</span></span>)</span>

                <label class="view-source-button" for="SuitGenerator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SuitGenerator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SuitGenerator.__init__-20"><a href="#SuitGenerator.__init__-20"><span class="linenos">20</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src</span><span class="p">:</span> <span class="n">OutcomeCountGenerator</span><span class="p">,</span> <span class="o">/</span><span class="p">):</span>
</span><span id="SuitGenerator.__init__-21"><a href="#SuitGenerator.__init__-21"><span class="linenos">21</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_src</span> <span class="o">=</span> <span class="n">src</span>
</span></pre></div>


    

                            </div>
                            <div id="SuitGenerator.outcomes" class="classattr">
                                        <input id="SuitGenerator.outcomes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">outcomes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Sequence</span>:</span></span>

                <label class="view-source-button" for="SuitGenerator.outcomes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SuitGenerator.outcomes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SuitGenerator.outcomes-27"><a href="#SuitGenerator.outcomes-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="nf">outcomes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">:</span>
</span><span id="SuitGenerator.outcomes-28"><a href="#SuitGenerator.outcomes-28"><span class="linenos">28</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outcomes</span>
</span></pre></div>


            <div class="docstring"><p>The set of outcomes, in sorted order.</p>
</div>


                            </div>
                            <div id="SuitGenerator.counts_len" class="classattr">
                                        <input id="SuitGenerator.counts_len-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">counts_len</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="SuitGenerator.counts_len-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SuitGenerator.counts_len"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SuitGenerator.counts_len-30"><a href="#SuitGenerator.counts_len-30"><span class="linenos">30</span></a>    <span class="k">def</span> <span class="nf">counts_len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SuitGenerator.counts_len-31"><a href="#SuitGenerator.counts_len-31"><span class="linenos">31</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">counts_len</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The number of counts generated. Must be constant.</p>
</div>


                            </div>
                            <div id="SuitGenerator.denominator" class="classattr">
                                        <input id="SuitGenerator.denominator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">denominator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="SuitGenerator.denominator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SuitGenerator.denominator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SuitGenerator.denominator-56"><a href="#SuitGenerator.denominator-56"><span class="linenos">56</span></a>    <span class="k">def</span> <span class="nf">denominator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SuitGenerator.denominator-57"><a href="#SuitGenerator.denominator-57"><span class="linenos">57</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">denominator</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>The total weight of all paths through this generator.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#OutcomeCountGenerator">OutcomeCountGenerator</a></dt>
                                <dd id="SuitGenerator.evaluate" class="function"><a href="#OutcomeCountGenerator.evaluate">evaluate</a></dd>
                <dd id="SuitGenerator.min_outcome" class="function"><a href="#OutcomeCountGenerator.min_outcome">min_outcome</a></dd>
                <dd id="SuitGenerator.max_outcome" class="function"><a href="#OutcomeCountGenerator.max_outcome">max_outcome</a></dd>
                <dd id="SuitGenerator.expand" class="function"><a href="#OutcomeCountGenerator.expand">expand</a></dd>
                <dd id="SuitGenerator.sum" class="function"><a href="#OutcomeCountGenerator.sum">sum</a></dd>
                <dd id="SuitGenerator.count" class="function"><a href="#OutcomeCountGenerator.count">count</a></dd>
                <dd id="SuitGenerator.count_in" class="function"><a href="#OutcomeCountGenerator.count_in">count_in</a></dd>
                <dd id="SuitGenerator.count_unique" class="function"><a href="#OutcomeCountGenerator.count_unique">count_unique</a></dd>
                <dd id="SuitGenerator.contains_subset" class="function"><a href="#OutcomeCountGenerator.contains_subset">contains_subset</a></dd>
                <dd id="SuitGenerator.intersection_size" class="function"><a href="#OutcomeCountGenerator.intersection_size">intersection_size</a></dd>
                <dd id="SuitGenerator.best_matching_set" class="function"><a href="#OutcomeCountGenerator.best_matching_set">best_matching_set</a></dd>
                <dd id="SuitGenerator.best_straight" class="function"><a href="#OutcomeCountGenerator.best_straight">best_straight</a></dd>
                <dd id="SuitGenerator.sample" class="function"><a href="#OutcomeCountGenerator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="clear_pool_cache">
                            <input id="clear_pool_cache-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear_pool_cache</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="clear_pool_cache-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#clear_pool_cache"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="clear_pool_cache-35"><a href="#clear_pool_cache-35"><span class="linenos">35</span></a><span class="k">def</span> <span class="nf">clear_pool_cache</span><span class="p">():</span>
</span><span id="clear_pool_cache-36"><a href="#clear_pool_cache-36"><span class="linenos">36</span></a>    <span class="sd">&quot;&quot;&quot;Clears the global pool cache.&quot;&quot;&quot;</span>
</span><span id="clear_pool_cache-37"><a href="#clear_pool_cache-37"><span class="linenos">37</span></a>    <span class="n">new_pool_cached</span><span class="o">.</span><span class="n">cache_clear</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Clears the global pool cache.</p>
</div>


                </section>
    </main>
</body>
</html>