<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>icepool.evaluator.adjust API documentation</title>
            <link rel="icon" href="favicon.png"/>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../evaluator.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;icepool.evaluator</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="variable" href="#T_contra">T_contra</a>
            </li>
            <li>
                    <a class="variable" href="#U_co">U_co</a>
            </li>
            <li>
                    <a class="variable" href="#Q_contra">Q_contra</a>
            </li>
            <li>
                    <a class="variable" href="#V">V</a>
            </li>
            <li>
                    <a class="class" href="#AdjustIntCountEvaluator">AdjustIntCountEvaluator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AdjustIntCountEvaluator.__init__">AdjustIntCountEvaluator</a>
                        </li>
                        <li>
                                <a class="function" href="#AdjustIntCountEvaluator.next_state">next_state</a>
                        </li>
                        <li>
                                <a class="function" href="#AdjustIntCountEvaluator.final_outcome">final_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#AdjustIntCountEvaluator.order">order</a>
                        </li>
                        <li>
                                <a class="function" href="#AdjustIntCountEvaluator.alignment">alignment</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FinalOutcomeMapEvaluator">FinalOutcomeMapEvaluator</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FinalOutcomeMapEvaluator.__init__">FinalOutcomeMapEvaluator</a>
                        </li>
                        <li>
                                <a class="function" href="#FinalOutcomeMapEvaluator.next_state">next_state</a>
                        </li>
                        <li>
                                <a class="function" href="#FinalOutcomeMapEvaluator.final_outcome">final_outcome</a>
                        </li>
                        <li>
                                <a class="function" href="#FinalOutcomeMapEvaluator.order">order</a>
                        </li>
                        <li>
                                <a class="function" href="#FinalOutcomeMapEvaluator.alignment">alignment</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../icepool.html">icepool</a><wbr>.<a href="./../evaluator.html">evaluator</a><wbr>.adjust    </h1>

                        <div class="docstring"><p>Meta-evaluators that adjust counts or outcomes before sending them to an inner evaluator.</p>
</div>

                        <input id="mod-adjust-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-adjust-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&quot;&quot;&quot;Meta-evaluators that adjust counts or outcomes before sending them to an inner evaluator.&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;google&#39;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span> <span class="nn">icepool.evaluator.outcome_count_evaluator</span> <span class="kn">import</span> <span class="n">OutcomeCountEvaluator</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">icepool.typing</span> <span class="kn">import</span> <span class="n">Outcome</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Collection</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">TypeVar</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="n">T_contra</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T_contra&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Outcome</span><span class="p">,</span> <span class="n">contravariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">&quot;&quot;&quot;Type variable representing the input outcome type.&quot;&quot;&quot;</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="n">U_co</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;U_co&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Outcome</span><span class="p">,</span> <span class="n">covariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="sd">&quot;&quot;&quot;Type variable representing the final outcome type.&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="n">Q_contra</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;Q_contra&#39;</span><span class="p">,</span> <span class="n">contravariant</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">&quot;&quot;&quot;Type variable representing the count type. This may be replaced with a `TypeVarTuple` in the future.&quot;&quot;&quot;</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="n">V</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Outcome</span><span class="p">)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">&quot;&quot;&quot;Invariant intermediate outcome type.&quot;&quot;&quot;</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="k">class</span> <span class="nc">AdjustIntCountEvaluator</span><span class="p">(</span><span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies a standard set of possible adjustments to `int` counts.&quot;&quot;&quot;</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="n">_inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    <span class="n">_adjust_count</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>    <span class="c1"># May return inner unmodified.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="n">inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="n">target</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Outcome</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Set</span><span class="p">[</span><span class="n">Outcome</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Outcome</span><span class="p">]</span> <span class="o">|</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="n">min_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="n">div_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="n">max_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor. This wraps an inner evaluator.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        May return inner unmodified.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        The args are applied in the order presented above and below.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">        Args:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a><span class="sd">            inner: The evaluator to call after adjustment.</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="sd">            target: If provided, an intersection or difference will be taken</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="sd">                with this. Possible types:</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="sd">                * A `Mapping` from outcomes to `int`s, representing a multiset</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="sd">                    with counts as the values.</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a><span class="sd">                * A `Set` of outcomes. All outcomes in the target effectively</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="sd">                    have unlimited multiplicity.</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="sd">                * Any other `Collection`, which will be treated as a multiset.</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a><span class="sd">            invert: If `False` (default), the intersection will be taken with</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="sd">                `target`. Otherwise, the difference will be taken. If `target`</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="sd">                is not provided, this value is ignored.</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="sd">            min_count: If provided, any outcome with less than this count will</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">                produce a 0 count. For example, `min_count=2` will ignore</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="sd">                anything that&#39;s not a matching pair or better.</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">            div_count: If provided, counts will be divided by this value</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">                (rounding down). For example, `floordiv=2` will count the number</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">                of matching pairs.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">            max_count: Any outcome with greater than this count will be treated</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">                as having this count. For example, `max_count=1` will count</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">                duplicates only once.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">                `max_count` can be less than `min_count`. For example,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">                `min_count=2, max_count=1` will count outcomes that are pairs</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">                or better, but only contributing a count of 1 per pair.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">div_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>            <span class="k">return</span> <span class="n">inner</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AdjustIntCountEvaluator</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span> <span class="o">=</span> <span class="n">inner</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>            <span class="n">invert</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Set</span><span class="p">):</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">target</span><span class="p">}</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>            <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>                <span class="n">target_dict</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="k">def</span> <span class="nf">adjust_count</span><span class="p">(</span><span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Adjusts the count based on arguments to a constructed TargetSetEvaluator.&quot;&quot;&quot;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>            <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>                <span class="c1"># Set difference.</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>                <span class="c1"># Set intersection.</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>            <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">min_count</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="k">if</span> <span class="n">div_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>                <span class="n">count</span> <span class="o">//=</span> <span class="n">div_count</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="k">if</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">max_count</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>            <span class="k">return</span> <span class="n">count</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_count</span> <span class="o">=</span> <span class="n">adjust_count</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_count</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="k">class</span> <span class="nc">FinalOutcomeMapEvaluator</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">,</span> <span class="n">V</span><span class="p">],</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>                               <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">]):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maps outcomes to other outcomes before sending them to an inner evaluator.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">    Note that the outcomes will be seen in their original order, and outcomes</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">    that map to the same value will still be considered in separate calls to</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">    `next_state`. For this reason it&#39;s best to nest it inside</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">    `AdjustIntCountEvaluator`, and the `map` argument should be presented last.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="n">_inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">]</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="n">_map</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">V</span><span class="p">]</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="c1"># May return inner unmodified.</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>        <span class="n">inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">],</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="nb">map</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">V</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">V</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">]:</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor. This wraps an inner evaluator.</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">        May return inner unmodified.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">        Args:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">            inner: The evaluator to wrap.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">            map: A `Callable` or `Mapping` that takes an original outcome and</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a><span class="sd">                produces the outcome that should be sent to the inner evaluator.</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="c1"># Here V = T_contra.</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>            <span class="k">return</span> <span class="n">inner</span>  <span class="c1"># type: ignore</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">FinalOutcomeMapEvaluator</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span> <span class="o">=</span> <span class="n">inner</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">map</span><span class="p">):</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="nb">map</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">map_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>            <span class="k">def</span> <span class="nf">map_func</span><span class="p">(</span><span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                <span class="k">return</span> <span class="n">map_dict</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="n">map_func</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="T_contra">
                    <div class="attr variable">
            <span class="name">T_contra</span><span class="default_value"> = -T_contra</span>

        
    </div>
    <a class="headerlink" href="#T_contra"></a>
    
            <div class="docstring"><p>Type variable representing the input outcome type.</p>
</div>


                </section>
                <section id="U_co">
                    <div class="attr variable">
            <span class="name">U_co</span><span class="default_value"> = +U_co</span>

        
    </div>
    <a class="headerlink" href="#U_co"></a>
    
            <div class="docstring"><p>Type variable representing the final outcome type.</p>
</div>


                </section>
                <section id="Q_contra">
                    <div class="attr variable">
            <span class="name">Q_contra</span><span class="default_value"> = -Q_contra</span>

        
    </div>
    <a class="headerlink" href="#Q_contra"></a>
    
            <div class="docstring"><p>Type variable representing the count type. This may be replaced with a <code>TypeVarTuple</code> in the future.</p>
</div>


                </section>
                <section id="V">
                    <div class="attr variable">
            <span class="name">V</span><span class="default_value"> = ~V</span>

        
    </div>
    <a class="headerlink" href="#V"></a>
    
            <div class="docstring"><p>Invariant intermediate outcome type.</p>
</div>


                </section>
                <section id="AdjustIntCountEvaluator">
                            <input id="AdjustIntCountEvaluator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AdjustIntCountEvaluator</span><wbr>(<span class="base"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator">icepool.evaluator.outcome_count_evaluator.OutcomeCountEvaluator[-T_contra, +U_co, int]</a></span>):

                <label class="view-source-button" for="AdjustIntCountEvaluator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AdjustIntCountEvaluator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AdjustIntCountEvaluator-27"><a href="#AdjustIntCountEvaluator-27"><span class="linenos"> 27</span></a><span class="k">class</span> <span class="nc">AdjustIntCountEvaluator</span><span class="p">(</span><span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]):</span>
</span><span id="AdjustIntCountEvaluator-28"><a href="#AdjustIntCountEvaluator-28"><span class="linenos"> 28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies a standard set of possible adjustments to `int` counts.&quot;&quot;&quot;</span>
</span><span id="AdjustIntCountEvaluator-29"><a href="#AdjustIntCountEvaluator-29"><span class="linenos"> 29</span></a>
</span><span id="AdjustIntCountEvaluator-30"><a href="#AdjustIntCountEvaluator-30"><span class="linenos"> 30</span></a>    <span class="n">_inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="AdjustIntCountEvaluator-31"><a href="#AdjustIntCountEvaluator-31"><span class="linenos"> 31</span></a>    <span class="n">_adjust_count</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]</span>
</span><span id="AdjustIntCountEvaluator-32"><a href="#AdjustIntCountEvaluator-32"><span class="linenos"> 32</span></a>
</span><span id="AdjustIntCountEvaluator-33"><a href="#AdjustIntCountEvaluator-33"><span class="linenos"> 33</span></a>    <span class="c1"># May return inner unmodified.</span>
</span><span id="AdjustIntCountEvaluator-34"><a href="#AdjustIntCountEvaluator-34"><span class="linenos"> 34</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="AdjustIntCountEvaluator-35"><a href="#AdjustIntCountEvaluator-35"><span class="linenos"> 35</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator-36"><a href="#AdjustIntCountEvaluator-36"><span class="linenos"> 36</span></a>        <span class="n">inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="AdjustIntCountEvaluator-37"><a href="#AdjustIntCountEvaluator-37"><span class="linenos"> 37</span></a>        <span class="n">target</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Outcome</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Set</span><span class="p">[</span><span class="n">Outcome</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Outcome</span><span class="p">]</span> <span class="o">|</span>
</span><span id="AdjustIntCountEvaluator-38"><a href="#AdjustIntCountEvaluator-38"><span class="linenos"> 38</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator-39"><a href="#AdjustIntCountEvaluator-39"><span class="linenos"> 39</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator-40"><a href="#AdjustIntCountEvaluator-40"><span class="linenos"> 40</span></a>        <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator-41"><a href="#AdjustIntCountEvaluator-41"><span class="linenos"> 41</span></a>        <span class="n">min_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator-42"><a href="#AdjustIntCountEvaluator-42"><span class="linenos"> 42</span></a>        <span class="n">div_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator-43"><a href="#AdjustIntCountEvaluator-43"><span class="linenos"> 43</span></a>        <span class="n">max_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span>
</span><span id="AdjustIntCountEvaluator-44"><a href="#AdjustIntCountEvaluator-44"><span class="linenos"> 44</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="AdjustIntCountEvaluator-45"><a href="#AdjustIntCountEvaluator-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor. This wraps an inner evaluator.</span>
</span><span id="AdjustIntCountEvaluator-46"><a href="#AdjustIntCountEvaluator-46"><span class="linenos"> 46</span></a>
</span><span id="AdjustIntCountEvaluator-47"><a href="#AdjustIntCountEvaluator-47"><span class="linenos"> 47</span></a><span class="sd">        May return inner unmodified.</span>
</span><span id="AdjustIntCountEvaluator-48"><a href="#AdjustIntCountEvaluator-48"><span class="linenos"> 48</span></a>
</span><span id="AdjustIntCountEvaluator-49"><a href="#AdjustIntCountEvaluator-49"><span class="linenos"> 49</span></a><span class="sd">        The args are applied in the order presented above and below.</span>
</span><span id="AdjustIntCountEvaluator-50"><a href="#AdjustIntCountEvaluator-50"><span class="linenos"> 50</span></a>
</span><span id="AdjustIntCountEvaluator-51"><a href="#AdjustIntCountEvaluator-51"><span class="linenos"> 51</span></a><span class="sd">        Args:</span>
</span><span id="AdjustIntCountEvaluator-52"><a href="#AdjustIntCountEvaluator-52"><span class="linenos"> 52</span></a><span class="sd">            inner: The evaluator to call after adjustment.</span>
</span><span id="AdjustIntCountEvaluator-53"><a href="#AdjustIntCountEvaluator-53"><span class="linenos"> 53</span></a><span class="sd">            target: If provided, an intersection or difference will be taken</span>
</span><span id="AdjustIntCountEvaluator-54"><a href="#AdjustIntCountEvaluator-54"><span class="linenos"> 54</span></a><span class="sd">                with this. Possible types:</span>
</span><span id="AdjustIntCountEvaluator-55"><a href="#AdjustIntCountEvaluator-55"><span class="linenos"> 55</span></a><span class="sd">                * A `Mapping` from outcomes to `int`s, representing a multiset</span>
</span><span id="AdjustIntCountEvaluator-56"><a href="#AdjustIntCountEvaluator-56"><span class="linenos"> 56</span></a><span class="sd">                    with counts as the values.</span>
</span><span id="AdjustIntCountEvaluator-57"><a href="#AdjustIntCountEvaluator-57"><span class="linenos"> 57</span></a><span class="sd">                * A `Set` of outcomes. All outcomes in the target effectively</span>
</span><span id="AdjustIntCountEvaluator-58"><a href="#AdjustIntCountEvaluator-58"><span class="linenos"> 58</span></a><span class="sd">                    have unlimited multiplicity.</span>
</span><span id="AdjustIntCountEvaluator-59"><a href="#AdjustIntCountEvaluator-59"><span class="linenos"> 59</span></a><span class="sd">                * Any other `Collection`, which will be treated as a multiset.</span>
</span><span id="AdjustIntCountEvaluator-60"><a href="#AdjustIntCountEvaluator-60"><span class="linenos"> 60</span></a><span class="sd">            invert: If `False` (default), the intersection will be taken with</span>
</span><span id="AdjustIntCountEvaluator-61"><a href="#AdjustIntCountEvaluator-61"><span class="linenos"> 61</span></a><span class="sd">                `target`. Otherwise, the difference will be taken. If `target`</span>
</span><span id="AdjustIntCountEvaluator-62"><a href="#AdjustIntCountEvaluator-62"><span class="linenos"> 62</span></a><span class="sd">                is not provided, this value is ignored.</span>
</span><span id="AdjustIntCountEvaluator-63"><a href="#AdjustIntCountEvaluator-63"><span class="linenos"> 63</span></a><span class="sd">            min_count: If provided, any outcome with less than this count will</span>
</span><span id="AdjustIntCountEvaluator-64"><a href="#AdjustIntCountEvaluator-64"><span class="linenos"> 64</span></a><span class="sd">                produce a 0 count. For example, `min_count=2` will ignore</span>
</span><span id="AdjustIntCountEvaluator-65"><a href="#AdjustIntCountEvaluator-65"><span class="linenos"> 65</span></a><span class="sd">                anything that&#39;s not a matching pair or better.</span>
</span><span id="AdjustIntCountEvaluator-66"><a href="#AdjustIntCountEvaluator-66"><span class="linenos"> 66</span></a><span class="sd">            div_count: If provided, counts will be divided by this value</span>
</span><span id="AdjustIntCountEvaluator-67"><a href="#AdjustIntCountEvaluator-67"><span class="linenos"> 67</span></a><span class="sd">                (rounding down). For example, `floordiv=2` will count the number</span>
</span><span id="AdjustIntCountEvaluator-68"><a href="#AdjustIntCountEvaluator-68"><span class="linenos"> 68</span></a><span class="sd">                of matching pairs.</span>
</span><span id="AdjustIntCountEvaluator-69"><a href="#AdjustIntCountEvaluator-69"><span class="linenos"> 69</span></a><span class="sd">            max_count: Any outcome with greater than this count will be treated</span>
</span><span id="AdjustIntCountEvaluator-70"><a href="#AdjustIntCountEvaluator-70"><span class="linenos"> 70</span></a><span class="sd">                as having this count. For example, `max_count=1` will count</span>
</span><span id="AdjustIntCountEvaluator-71"><a href="#AdjustIntCountEvaluator-71"><span class="linenos"> 71</span></a><span class="sd">                duplicates only once.</span>
</span><span id="AdjustIntCountEvaluator-72"><a href="#AdjustIntCountEvaluator-72"><span class="linenos"> 72</span></a>
</span><span id="AdjustIntCountEvaluator-73"><a href="#AdjustIntCountEvaluator-73"><span class="linenos"> 73</span></a><span class="sd">                `max_count` can be less than `min_count`. For example,</span>
</span><span id="AdjustIntCountEvaluator-74"><a href="#AdjustIntCountEvaluator-74"><span class="linenos"> 74</span></a><span class="sd">                `min_count=2, max_count=1` will count outcomes that are pairs</span>
</span><span id="AdjustIntCountEvaluator-75"><a href="#AdjustIntCountEvaluator-75"><span class="linenos"> 75</span></a><span class="sd">                or better, but only contributing a count of 1 per pair.</span>
</span><span id="AdjustIntCountEvaluator-76"><a href="#AdjustIntCountEvaluator-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AdjustIntCountEvaluator-77"><a href="#AdjustIntCountEvaluator-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">div_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-78"><a href="#AdjustIntCountEvaluator-78"><span class="linenos"> 78</span></a>            <span class="k">return</span> <span class="n">inner</span>
</span><span id="AdjustIntCountEvaluator-79"><a href="#AdjustIntCountEvaluator-79"><span class="linenos"> 79</span></a>
</span><span id="AdjustIntCountEvaluator-80"><a href="#AdjustIntCountEvaluator-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AdjustIntCountEvaluator</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-81"><a href="#AdjustIntCountEvaluator-81"><span class="linenos"> 81</span></a>
</span><span id="AdjustIntCountEvaluator-82"><a href="#AdjustIntCountEvaluator-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span> <span class="o">=</span> <span class="n">inner</span>
</span><span id="AdjustIntCountEvaluator-83"><a href="#AdjustIntCountEvaluator-83"><span class="linenos"> 83</span></a>
</span><span id="AdjustIntCountEvaluator-84"><a href="#AdjustIntCountEvaluator-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-85"><a href="#AdjustIntCountEvaluator-85"><span class="linenos"> 85</span></a>            <span class="n">invert</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AdjustIntCountEvaluator-86"><a href="#AdjustIntCountEvaluator-86"><span class="linenos"> 86</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AdjustIntCountEvaluator-87"><a href="#AdjustIntCountEvaluator-87"><span class="linenos"> 87</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator-88"><a href="#AdjustIntCountEvaluator-88"><span class="linenos"> 88</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="AdjustIntCountEvaluator-89"><a href="#AdjustIntCountEvaluator-89"><span class="linenos"> 89</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Set</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator-90"><a href="#AdjustIntCountEvaluator-90"><span class="linenos"> 90</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">target</span><span class="p">}</span>
</span><span id="AdjustIntCountEvaluator-91"><a href="#AdjustIntCountEvaluator-91"><span class="linenos"> 91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-92"><a href="#AdjustIntCountEvaluator-92"><span class="linenos"> 92</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-93"><a href="#AdjustIntCountEvaluator-93"><span class="linenos"> 93</span></a>            <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-94"><a href="#AdjustIntCountEvaluator-94"><span class="linenos"> 94</span></a>                <span class="n">target_dict</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AdjustIntCountEvaluator-95"><a href="#AdjustIntCountEvaluator-95"><span class="linenos"> 95</span></a>
</span><span id="AdjustIntCountEvaluator-96"><a href="#AdjustIntCountEvaluator-96"><span class="linenos"> 96</span></a>        <span class="k">def</span> <span class="nf">adjust_count</span><span class="p">(</span><span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-97"><a href="#AdjustIntCountEvaluator-97"><span class="linenos"> 97</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Adjusts the count based on arguments to a constructed TargetSetEvaluator.&quot;&quot;&quot;</span>
</span><span id="AdjustIntCountEvaluator-98"><a href="#AdjustIntCountEvaluator-98"><span class="linenos"> 98</span></a>            <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-99"><a href="#AdjustIntCountEvaluator-99"><span class="linenos"> 99</span></a>                <span class="c1"># Set difference.</span>
</span><span id="AdjustIntCountEvaluator-100"><a href="#AdjustIntCountEvaluator-100"><span class="linenos">100</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-101"><a href="#AdjustIntCountEvaluator-101"><span class="linenos">101</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-102"><a href="#AdjustIntCountEvaluator-102"><span class="linenos">102</span></a>                <span class="c1"># Set intersection.</span>
</span><span id="AdjustIntCountEvaluator-103"><a href="#AdjustIntCountEvaluator-103"><span class="linenos">103</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="AdjustIntCountEvaluator-104"><a href="#AdjustIntCountEvaluator-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">min_count</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-105"><a href="#AdjustIntCountEvaluator-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="mi">0</span>
</span><span id="AdjustIntCountEvaluator-106"><a href="#AdjustIntCountEvaluator-106"><span class="linenos">106</span></a>            <span class="k">if</span> <span class="n">div_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-107"><a href="#AdjustIntCountEvaluator-107"><span class="linenos">107</span></a>                <span class="n">count</span> <span class="o">//=</span> <span class="n">div_count</span>
</span><span id="AdjustIntCountEvaluator-108"><a href="#AdjustIntCountEvaluator-108"><span class="linenos">108</span></a>            <span class="k">if</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator-109"><a href="#AdjustIntCountEvaluator-109"><span class="linenos">109</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">max_count</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-110"><a href="#AdjustIntCountEvaluator-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="n">count</span>
</span><span id="AdjustIntCountEvaluator-111"><a href="#AdjustIntCountEvaluator-111"><span class="linenos">111</span></a>
</span><span id="AdjustIntCountEvaluator-112"><a href="#AdjustIntCountEvaluator-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_count</span> <span class="o">=</span> <span class="n">adjust_count</span>
</span><span id="AdjustIntCountEvaluator-113"><a href="#AdjustIntCountEvaluator-113"><span class="linenos">113</span></a>
</span><span id="AdjustIntCountEvaluator-114"><a href="#AdjustIntCountEvaluator-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="AdjustIntCountEvaluator-115"><a href="#AdjustIntCountEvaluator-115"><span class="linenos">115</span></a>
</span><span id="AdjustIntCountEvaluator-116"><a href="#AdjustIntCountEvaluator-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator-117"><a href="#AdjustIntCountEvaluator-117"><span class="linenos">117</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_count</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-118"><a href="#AdjustIntCountEvaluator-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-119"><a href="#AdjustIntCountEvaluator-119"><span class="linenos">119</span></a>
</span><span id="AdjustIntCountEvaluator-120"><a href="#AdjustIntCountEvaluator-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator-121"><a href="#AdjustIntCountEvaluator-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-122"><a href="#AdjustIntCountEvaluator-122"><span class="linenos">122</span></a>
</span><span id="AdjustIntCountEvaluator-123"><a href="#AdjustIntCountEvaluator-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator-124"><a href="#AdjustIntCountEvaluator-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator-125"><a href="#AdjustIntCountEvaluator-125"><span class="linenos">125</span></a>
</span><span id="AdjustIntCountEvaluator-126"><a href="#AdjustIntCountEvaluator-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator-127"><a href="#AdjustIntCountEvaluator-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Applies a standard set of possible adjustments to <code>int</code> counts.</p>
</div>


                            <div id="AdjustIntCountEvaluator.__init__" class="classattr">
                                        <input id="AdjustIntCountEvaluator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AdjustIntCountEvaluator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">inner</span><span class="p">:</span> <span class="n"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator">icepool.evaluator.outcome_count_evaluator.OutcomeCountEvaluator</a></span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">+</span><span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">Outcome</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Set</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">Outcome</span><span class="p">],</span> <span class="n">Collection</span><span class="p">[</span><span class="n">icepool</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">Outcome</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">min_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">div_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="AdjustIntCountEvaluator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AdjustIntCountEvaluator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AdjustIntCountEvaluator.__init__-34"><a href="#AdjustIntCountEvaluator.__init__-34"><span class="linenos"> 34</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="AdjustIntCountEvaluator.__init__-35"><a href="#AdjustIntCountEvaluator.__init__-35"><span class="linenos"> 35</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator.__init__-36"><a href="#AdjustIntCountEvaluator.__init__-36"><span class="linenos"> 36</span></a>        <span class="n">inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="AdjustIntCountEvaluator.__init__-37"><a href="#AdjustIntCountEvaluator.__init__-37"><span class="linenos"> 37</span></a>        <span class="n">target</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Outcome</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="n">Set</span><span class="p">[</span><span class="n">Outcome</span><span class="p">]</span> <span class="o">|</span> <span class="n">Collection</span><span class="p">[</span><span class="n">Outcome</span><span class="p">]</span> <span class="o">|</span>
</span><span id="AdjustIntCountEvaluator.__init__-38"><a href="#AdjustIntCountEvaluator.__init__-38"><span class="linenos"> 38</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator.__init__-39"><a href="#AdjustIntCountEvaluator.__init__-39"><span class="linenos"> 39</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator.__init__-40"><a href="#AdjustIntCountEvaluator.__init__-40"><span class="linenos"> 40</span></a>        <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator.__init__-41"><a href="#AdjustIntCountEvaluator.__init__-41"><span class="linenos"> 41</span></a>        <span class="n">min_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator.__init__-42"><a href="#AdjustIntCountEvaluator.__init__-42"><span class="linenos"> 42</span></a>        <span class="n">div_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AdjustIntCountEvaluator.__init__-43"><a href="#AdjustIntCountEvaluator.__init__-43"><span class="linenos"> 43</span></a>        <span class="n">max_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span>
</span><span id="AdjustIntCountEvaluator.__init__-44"><a href="#AdjustIntCountEvaluator.__init__-44"><span class="linenos"> 44</span></a>        <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="AdjustIntCountEvaluator.__init__-45"><a href="#AdjustIntCountEvaluator.__init__-45"><span class="linenos"> 45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor. This wraps an inner evaluator.</span>
</span><span id="AdjustIntCountEvaluator.__init__-46"><a href="#AdjustIntCountEvaluator.__init__-46"><span class="linenos"> 46</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-47"><a href="#AdjustIntCountEvaluator.__init__-47"><span class="linenos"> 47</span></a><span class="sd">        May return inner unmodified.</span>
</span><span id="AdjustIntCountEvaluator.__init__-48"><a href="#AdjustIntCountEvaluator.__init__-48"><span class="linenos"> 48</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-49"><a href="#AdjustIntCountEvaluator.__init__-49"><span class="linenos"> 49</span></a><span class="sd">        The args are applied in the order presented above and below.</span>
</span><span id="AdjustIntCountEvaluator.__init__-50"><a href="#AdjustIntCountEvaluator.__init__-50"><span class="linenos"> 50</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-51"><a href="#AdjustIntCountEvaluator.__init__-51"><span class="linenos"> 51</span></a><span class="sd">        Args:</span>
</span><span id="AdjustIntCountEvaluator.__init__-52"><a href="#AdjustIntCountEvaluator.__init__-52"><span class="linenos"> 52</span></a><span class="sd">            inner: The evaluator to call after adjustment.</span>
</span><span id="AdjustIntCountEvaluator.__init__-53"><a href="#AdjustIntCountEvaluator.__init__-53"><span class="linenos"> 53</span></a><span class="sd">            target: If provided, an intersection or difference will be taken</span>
</span><span id="AdjustIntCountEvaluator.__init__-54"><a href="#AdjustIntCountEvaluator.__init__-54"><span class="linenos"> 54</span></a><span class="sd">                with this. Possible types:</span>
</span><span id="AdjustIntCountEvaluator.__init__-55"><a href="#AdjustIntCountEvaluator.__init__-55"><span class="linenos"> 55</span></a><span class="sd">                * A `Mapping` from outcomes to `int`s, representing a multiset</span>
</span><span id="AdjustIntCountEvaluator.__init__-56"><a href="#AdjustIntCountEvaluator.__init__-56"><span class="linenos"> 56</span></a><span class="sd">                    with counts as the values.</span>
</span><span id="AdjustIntCountEvaluator.__init__-57"><a href="#AdjustIntCountEvaluator.__init__-57"><span class="linenos"> 57</span></a><span class="sd">                * A `Set` of outcomes. All outcomes in the target effectively</span>
</span><span id="AdjustIntCountEvaluator.__init__-58"><a href="#AdjustIntCountEvaluator.__init__-58"><span class="linenos"> 58</span></a><span class="sd">                    have unlimited multiplicity.</span>
</span><span id="AdjustIntCountEvaluator.__init__-59"><a href="#AdjustIntCountEvaluator.__init__-59"><span class="linenos"> 59</span></a><span class="sd">                * Any other `Collection`, which will be treated as a multiset.</span>
</span><span id="AdjustIntCountEvaluator.__init__-60"><a href="#AdjustIntCountEvaluator.__init__-60"><span class="linenos"> 60</span></a><span class="sd">            invert: If `False` (default), the intersection will be taken with</span>
</span><span id="AdjustIntCountEvaluator.__init__-61"><a href="#AdjustIntCountEvaluator.__init__-61"><span class="linenos"> 61</span></a><span class="sd">                `target`. Otherwise, the difference will be taken. If `target`</span>
</span><span id="AdjustIntCountEvaluator.__init__-62"><a href="#AdjustIntCountEvaluator.__init__-62"><span class="linenos"> 62</span></a><span class="sd">                is not provided, this value is ignored.</span>
</span><span id="AdjustIntCountEvaluator.__init__-63"><a href="#AdjustIntCountEvaluator.__init__-63"><span class="linenos"> 63</span></a><span class="sd">            min_count: If provided, any outcome with less than this count will</span>
</span><span id="AdjustIntCountEvaluator.__init__-64"><a href="#AdjustIntCountEvaluator.__init__-64"><span class="linenos"> 64</span></a><span class="sd">                produce a 0 count. For example, `min_count=2` will ignore</span>
</span><span id="AdjustIntCountEvaluator.__init__-65"><a href="#AdjustIntCountEvaluator.__init__-65"><span class="linenos"> 65</span></a><span class="sd">                anything that&#39;s not a matching pair or better.</span>
</span><span id="AdjustIntCountEvaluator.__init__-66"><a href="#AdjustIntCountEvaluator.__init__-66"><span class="linenos"> 66</span></a><span class="sd">            div_count: If provided, counts will be divided by this value</span>
</span><span id="AdjustIntCountEvaluator.__init__-67"><a href="#AdjustIntCountEvaluator.__init__-67"><span class="linenos"> 67</span></a><span class="sd">                (rounding down). For example, `floordiv=2` will count the number</span>
</span><span id="AdjustIntCountEvaluator.__init__-68"><a href="#AdjustIntCountEvaluator.__init__-68"><span class="linenos"> 68</span></a><span class="sd">                of matching pairs.</span>
</span><span id="AdjustIntCountEvaluator.__init__-69"><a href="#AdjustIntCountEvaluator.__init__-69"><span class="linenos"> 69</span></a><span class="sd">            max_count: Any outcome with greater than this count will be treated</span>
</span><span id="AdjustIntCountEvaluator.__init__-70"><a href="#AdjustIntCountEvaluator.__init__-70"><span class="linenos"> 70</span></a><span class="sd">                as having this count. For example, `max_count=1` will count</span>
</span><span id="AdjustIntCountEvaluator.__init__-71"><a href="#AdjustIntCountEvaluator.__init__-71"><span class="linenos"> 71</span></a><span class="sd">                duplicates only once.</span>
</span><span id="AdjustIntCountEvaluator.__init__-72"><a href="#AdjustIntCountEvaluator.__init__-72"><span class="linenos"> 72</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-73"><a href="#AdjustIntCountEvaluator.__init__-73"><span class="linenos"> 73</span></a><span class="sd">                `max_count` can be less than `min_count`. For example,</span>
</span><span id="AdjustIntCountEvaluator.__init__-74"><a href="#AdjustIntCountEvaluator.__init__-74"><span class="linenos"> 74</span></a><span class="sd">                `min_count=2, max_count=1` will count outcomes that are pairs</span>
</span><span id="AdjustIntCountEvaluator.__init__-75"><a href="#AdjustIntCountEvaluator.__init__-75"><span class="linenos"> 75</span></a><span class="sd">                or better, but only contributing a count of 1 per pair.</span>
</span><span id="AdjustIntCountEvaluator.__init__-76"><a href="#AdjustIntCountEvaluator.__init__-76"><span class="linenos"> 76</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AdjustIntCountEvaluator.__init__-77"><a href="#AdjustIntCountEvaluator.__init__-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">div_count</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-78"><a href="#AdjustIntCountEvaluator.__init__-78"><span class="linenos"> 78</span></a>            <span class="k">return</span> <span class="n">inner</span>
</span><span id="AdjustIntCountEvaluator.__init__-79"><a href="#AdjustIntCountEvaluator.__init__-79"><span class="linenos"> 79</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-80"><a href="#AdjustIntCountEvaluator.__init__-80"><span class="linenos"> 80</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">AdjustIntCountEvaluator</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator.__init__-81"><a href="#AdjustIntCountEvaluator.__init__-81"><span class="linenos"> 81</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-82"><a href="#AdjustIntCountEvaluator.__init__-82"><span class="linenos"> 82</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span> <span class="o">=</span> <span class="n">inner</span>
</span><span id="AdjustIntCountEvaluator.__init__-83"><a href="#AdjustIntCountEvaluator.__init__-83"><span class="linenos"> 83</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-84"><a href="#AdjustIntCountEvaluator.__init__-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-85"><a href="#AdjustIntCountEvaluator.__init__-85"><span class="linenos"> 85</span></a>            <span class="n">invert</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AdjustIntCountEvaluator.__init__-86"><a href="#AdjustIntCountEvaluator.__init__-86"><span class="linenos"> 86</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AdjustIntCountEvaluator.__init__-87"><a href="#AdjustIntCountEvaluator.__init__-87"><span class="linenos"> 87</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator.__init__-88"><a href="#AdjustIntCountEvaluator.__init__-88"><span class="linenos"> 88</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="AdjustIntCountEvaluator.__init__-89"><a href="#AdjustIntCountEvaluator.__init__-89"><span class="linenos"> 89</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">Set</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator.__init__-90"><a href="#AdjustIntCountEvaluator.__init__-90"><span class="linenos"> 90</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">target</span><span class="p">}</span>
</span><span id="AdjustIntCountEvaluator.__init__-91"><a href="#AdjustIntCountEvaluator.__init__-91"><span class="linenos"> 91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-92"><a href="#AdjustIntCountEvaluator.__init__-92"><span class="linenos"> 92</span></a>            <span class="n">target_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator.__init__-93"><a href="#AdjustIntCountEvaluator.__init__-93"><span class="linenos"> 93</span></a>            <span class="k">for</span> <span class="n">outcome</span> <span class="ow">in</span> <span class="n">target</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-94"><a href="#AdjustIntCountEvaluator.__init__-94"><span class="linenos"> 94</span></a>                <span class="n">target_dict</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="AdjustIntCountEvaluator.__init__-95"><a href="#AdjustIntCountEvaluator.__init__-95"><span class="linenos"> 95</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-96"><a href="#AdjustIntCountEvaluator.__init__-96"><span class="linenos"> 96</span></a>        <span class="k">def</span> <span class="nf">adjust_count</span><span class="p">(</span><span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-97"><a href="#AdjustIntCountEvaluator.__init__-97"><span class="linenos"> 97</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Adjusts the count based on arguments to a constructed TargetSetEvaluator.&quot;&quot;&quot;</span>
</span><span id="AdjustIntCountEvaluator.__init__-98"><a href="#AdjustIntCountEvaluator.__init__-98"><span class="linenos"> 98</span></a>            <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-99"><a href="#AdjustIntCountEvaluator.__init__-99"><span class="linenos"> 99</span></a>                <span class="c1"># Set difference.</span>
</span><span id="AdjustIntCountEvaluator.__init__-100"><a href="#AdjustIntCountEvaluator.__init__-100"><span class="linenos">100</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator.__init__-101"><a href="#AdjustIntCountEvaluator.__init__-101"><span class="linenos">101</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-102"><a href="#AdjustIntCountEvaluator.__init__-102"><span class="linenos">102</span></a>                <span class="c1"># Set intersection.</span>
</span><span id="AdjustIntCountEvaluator.__init__-103"><a href="#AdjustIntCountEvaluator.__init__-103"><span class="linenos">103</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="AdjustIntCountEvaluator.__init__-104"><a href="#AdjustIntCountEvaluator.__init__-104"><span class="linenos">104</span></a>            <span class="k">if</span> <span class="n">min_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="n">min_count</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-105"><a href="#AdjustIntCountEvaluator.__init__-105"><span class="linenos">105</span></a>                <span class="k">return</span> <span class="mi">0</span>
</span><span id="AdjustIntCountEvaluator.__init__-106"><a href="#AdjustIntCountEvaluator.__init__-106"><span class="linenos">106</span></a>            <span class="k">if</span> <span class="n">div_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-107"><a href="#AdjustIntCountEvaluator.__init__-107"><span class="linenos">107</span></a>                <span class="n">count</span> <span class="o">//=</span> <span class="n">div_count</span>
</span><span id="AdjustIntCountEvaluator.__init__-108"><a href="#AdjustIntCountEvaluator.__init__-108"><span class="linenos">108</span></a>            <span class="k">if</span> <span class="n">max_count</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AdjustIntCountEvaluator.__init__-109"><a href="#AdjustIntCountEvaluator.__init__-109"><span class="linenos">109</span></a>                <span class="n">count</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">max_count</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator.__init__-110"><a href="#AdjustIntCountEvaluator.__init__-110"><span class="linenos">110</span></a>            <span class="k">return</span> <span class="n">count</span>
</span><span id="AdjustIntCountEvaluator.__init__-111"><a href="#AdjustIntCountEvaluator.__init__-111"><span class="linenos">111</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-112"><a href="#AdjustIntCountEvaluator.__init__-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_count</span> <span class="o">=</span> <span class="n">adjust_count</span>
</span><span id="AdjustIntCountEvaluator.__init__-113"><a href="#AdjustIntCountEvaluator.__init__-113"><span class="linenos">113</span></a>
</span><span id="AdjustIntCountEvaluator.__init__-114"><a href="#AdjustIntCountEvaluator.__init__-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Constructor. This wraps an inner evaluator.</p>

<p>May return inner unmodified.</p>

<p>The args are applied in the order presented above and below.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>inner:</strong>  The evaluator to call after adjustment.</li>
<li><strong>target:</strong>  If provided, an intersection or difference will be taken
with this. Possible types:
<ul>
<li>A <code>Mapping</code> from outcomes to <code>int</code>s, representing a multiset
with counts as the values.</li>
<li>A <code>Set</code> of outcomes. All outcomes in the target effectively
have unlimited multiplicity.</li>
<li>Any other <code>Collection</code>, which will be treated as a multiset.</li>
</ul></li>
<li><strong>invert:</strong>  If <code>False</code> (default), the intersection will be taken with
<code>target</code>. Otherwise, the difference will be taken. If <code>target</code>
is not provided, this value is ignored.</li>
<li><strong>min_count:</strong>  If provided, any outcome with less than this count will
produce a 0 count. For example, <code>min_count=2</code> will ignore
anything that's not a matching pair or better.</li>
<li><strong>div_count:</strong>  If provided, counts will be divided by this value
(rounding down). For example, <code>floordiv=2</code> will count the number
of matching pairs.</li>
<li><p><strong>max_count:</strong>  Any outcome with greater than this count will be treated
as having this count. For example, <code>max_count=1</code> will count
duplicates only once.</p>

<p><code>max_count</code> can be less than <code>min_count</code>. For example,
<code>min_count=2, max_count=1</code> will count outcomes that are pairs
or better, but only contributing a count of 1 per pair.</p></li>
</ul>
</div>


                            </div>
                            <div id="AdjustIntCountEvaluator.next_state" class="classattr">
                                        <input id="AdjustIntCountEvaluator.next_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">outcome</span>, </span><span class="param"><span class="n">count</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AdjustIntCountEvaluator.next_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AdjustIntCountEvaluator.next_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AdjustIntCountEvaluator.next_state-116"><a href="#AdjustIntCountEvaluator.next_state-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator.next_state-117"><a href="#AdjustIntCountEvaluator.next_state-117"><span class="linenos">117</span></a>        <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_adjust_count</span><span class="p">(</span><span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="AdjustIntCountEvaluator.next_state-118"><a href="#AdjustIntCountEvaluator.next_state-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>State transition function.</p>

<p>This should produce a state given the previous state, an outcome,
and the number that outcome produced by each generator.</p>

<p><code><a href="#AdjustIntCountEvaluator.evaluate">evaluate()</a></code> will always call this using only positional arguments.
Furthermore, there is no expectation that a subclass be able to handle
an arbitrary number of counts. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*counts</code> with a fixed set
of parameters.</p>

<p>Make sure to handle the base case where <code>state is None</code>.</p>

<p>States must be hashable. At current, they do not have to be orderable.
However, this may change in the future, and if they are not totally
orderable, you must override <code><a href="#AdjustIntCountEvaluator.final_outcome">final_outcome</a></code> to create totally orderable
final outcomes.</p>

<p>The behavior of returning a <code>Die</code> from <code><a href="#AdjustIntCountEvaluator.next_state">next_state</a></code> is currently
undefined.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>state:</strong>  A hashable object indicating the state before rolling the
current outcome. If this is the first outcome being considered,
<code>state</code> will be <code>None</code>.</li>
<li><strong>outcome:</strong>  The current outcome.
<code><a href="#AdjustIntCountEvaluator.next_state">next_state</a></code> will see all rolled outcomes in monotonic order;
either ascending or descending depending on <code><a href="#AdjustIntCountEvaluator.order">order()</a></code>.
If there are multiple generators, the set of outcomes is the
union of the outcomes of the invididual generators. All outcomes
with nonzero count will be seen. Outcomes with zero count
may or may not be seen. If you need to enforce that certain
outcomes are seen even if they have zero count, see
<code><a href="#AdjustIntCountEvaluator.alignment">alignment()</a></code>.</li>
<li><strong>*counts:</strong>  One value (usually an <code>int</code>) for each generator output
indicating how many of the current outcome were produced.
All outcomes with nonzero count are guaranteed to be seen.
To guarantee that outcomes are seen even if they have zero
count, override <code><a href="#AdjustIntCountEvaluator.alignment">alignment()</a></code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A hashable object indicating the next state.
  The special value <code><a href="../../icepool.html#Reroll">icepool.Reroll</a></code> can be used to immediately remove
  the state from consideration, effectively performing a full reroll.</p>
</blockquote>
</div>


                            </div>
                            <div id="AdjustIntCountEvaluator.final_outcome" class="classattr">
                                        <input id="AdjustIntCountEvaluator.final_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">final_state</span>, </span><span class="param"><span class="o">*</span><span class="n">generators</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AdjustIntCountEvaluator.final_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AdjustIntCountEvaluator.final_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AdjustIntCountEvaluator.final_outcome-120"><a href="#AdjustIntCountEvaluator.final_outcome-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator.final_outcome-121"><a href="#AdjustIntCountEvaluator.final_outcome-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to generate a final outcome from a final state.</p>

<p>Tthere is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>By default, the final outcome is equal to the final state.
Note that <code>None</code> is not a valid outcome for a <code>Die</code>,
and if there are no outcomes, the final state will be <code>None</code>.
Subclasses that want to handle this case should explicitly define what
happens.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>final_state:</strong>  A state after all outcomes have been processed.</li>
<li><strong>*generators:</strong>  One or more <code>OutcomeCountGenerator</code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A final outcome that will be used as part of constructing the result <code>Die</code>.
  As usual for <code>Die()</code>, this could itself be a <code>Die</code> or <code><a href="../../icepool.html#Reroll">icepool.Reroll</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="AdjustIntCountEvaluator.order" class="classattr">
                                        <input id="AdjustIntCountEvaluator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">generators</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AdjustIntCountEvaluator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AdjustIntCountEvaluator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AdjustIntCountEvaluator.order-123"><a href="#AdjustIntCountEvaluator.order-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator.order-124"><a href="#AdjustIntCountEvaluator.order-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to determine the order in which <code><a href="#AdjustIntCountEvaluator.next_state">next_state()</a></code> will see outcomes.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default is ascending order. This works well with mixed standard dice,
and other dice that differ only by right-truncation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*generators:</strong>  One or more <code>OutcomeCountGenerator</code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <ul>
  <li>Order.Ascending (= 1)
  if <code><a href="#AdjustIntCountEvaluator.next_state">next_state()</a></code> should always see the outcomes in ascending order.</li>
  <li>Order.Descending (= -1)
  if <code><a href="#AdjustIntCountEvaluator.next_state">next_state()</a></code> should always see the outcomes in descending order.</li>
  <li>Order.Any (= 0)
  if the result of the evaluation is order-independent.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="AdjustIntCountEvaluator.alignment" class="classattr">
                                        <input id="AdjustIntCountEvaluator.alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">alignment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">generators</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AdjustIntCountEvaluator.alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AdjustIntCountEvaluator.alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AdjustIntCountEvaluator.alignment-126"><a href="#AdjustIntCountEvaluator.alignment-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="AdjustIntCountEvaluator.alignment-127"><a href="#AdjustIntCountEvaluator.alignment-127"><span class="linenos">127</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Optional method to specify an collection of outcomes that should always be given to <code><a href="#AdjustIntCountEvaluator.next_state">next_state()</a></code> even if they have zero count.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default implementation returns <code>()</code>; this means outcomes with zero
count may or may not be seen by <code><a href="#AdjustIntCountEvaluator.next_state">next_state</a></code>.</p>

<p>If you want the outcomes seen by <code><a href="#AdjustIntCountEvaluator.next_state">next_state</a></code> to be consecutive
<code>int</code>s, you can set <code>alignment = <a href="../../icepool.html#OutcomeCountEvaluator.range_alignment">icepool.OutcomeCountEvaluator.range_alignment</a></code>.
See <code><a href="#AdjustIntCountEvaluator.range_alignment">range_alignment()</a></code> below.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="outcome_count_evaluator.html#OutcomeCountEvaluator">icepool.evaluator.outcome_count_evaluator.OutcomeCountEvaluator</a></dt>
                                <dd id="AdjustIntCountEvaluator.range_alignment" class="function"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator.range_alignment">range_alignment</a></dd>
                <dd id="AdjustIntCountEvaluator.evaluate" class="function"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator.evaluate">evaluate</a></dd>
                <dd id="AdjustIntCountEvaluator.sample" class="function"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="FinalOutcomeMapEvaluator">
                            <input id="FinalOutcomeMapEvaluator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FinalOutcomeMapEvaluator</span><wbr>(<span class="base">typing.Generic[-T_contra, +U_co, -Q_contra, ~V]</span>, <span class="base"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator">icepool.evaluator.outcome_count_evaluator.OutcomeCountEvaluator[-T_contra, +U_co, -Q_contra]</a></span>):

                <label class="view-source-button" for="FinalOutcomeMapEvaluator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FinalOutcomeMapEvaluator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FinalOutcomeMapEvaluator-130"><a href="#FinalOutcomeMapEvaluator-130"><span class="linenos">130</span></a><span class="k">class</span> <span class="nc">FinalOutcomeMapEvaluator</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">,</span> <span class="n">V</span><span class="p">],</span>
</span><span id="FinalOutcomeMapEvaluator-131"><a href="#FinalOutcomeMapEvaluator-131"><span class="linenos">131</span></a>                               <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">]):</span>
</span><span id="FinalOutcomeMapEvaluator-132"><a href="#FinalOutcomeMapEvaluator-132"><span class="linenos">132</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Maps outcomes to other outcomes before sending them to an inner evaluator.</span>
</span><span id="FinalOutcomeMapEvaluator-133"><a href="#FinalOutcomeMapEvaluator-133"><span class="linenos">133</span></a>
</span><span id="FinalOutcomeMapEvaluator-134"><a href="#FinalOutcomeMapEvaluator-134"><span class="linenos">134</span></a><span class="sd">    Note that the outcomes will be seen in their original order, and outcomes</span>
</span><span id="FinalOutcomeMapEvaluator-135"><a href="#FinalOutcomeMapEvaluator-135"><span class="linenos">135</span></a><span class="sd">    that map to the same value will still be considered in separate calls to</span>
</span><span id="FinalOutcomeMapEvaluator-136"><a href="#FinalOutcomeMapEvaluator-136"><span class="linenos">136</span></a><span class="sd">    `next_state`. For this reason it&#39;s best to nest it inside</span>
</span><span id="FinalOutcomeMapEvaluator-137"><a href="#FinalOutcomeMapEvaluator-137"><span class="linenos">137</span></a><span class="sd">    `AdjustIntCountEvaluator`, and the `map` argument should be presented last.</span>
</span><span id="FinalOutcomeMapEvaluator-138"><a href="#FinalOutcomeMapEvaluator-138"><span class="linenos">138</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FinalOutcomeMapEvaluator-139"><a href="#FinalOutcomeMapEvaluator-139"><span class="linenos">139</span></a>
</span><span id="FinalOutcomeMapEvaluator-140"><a href="#FinalOutcomeMapEvaluator-140"><span class="linenos">140</span></a>    <span class="n">_inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">]</span>
</span><span id="FinalOutcomeMapEvaluator-141"><a href="#FinalOutcomeMapEvaluator-141"><span class="linenos">141</span></a>    <span class="n">_map</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">V</span><span class="p">]</span>
</span><span id="FinalOutcomeMapEvaluator-142"><a href="#FinalOutcomeMapEvaluator-142"><span class="linenos">142</span></a>
</span><span id="FinalOutcomeMapEvaluator-143"><a href="#FinalOutcomeMapEvaluator-143"><span class="linenos">143</span></a>    <span class="c1"># May return inner unmodified.</span>
</span><span id="FinalOutcomeMapEvaluator-144"><a href="#FinalOutcomeMapEvaluator-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="FinalOutcomeMapEvaluator-145"><a href="#FinalOutcomeMapEvaluator-145"><span class="linenos">145</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="FinalOutcomeMapEvaluator-146"><a href="#FinalOutcomeMapEvaluator-146"><span class="linenos">146</span></a>        <span class="n">inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">],</span>
</span><span id="FinalOutcomeMapEvaluator-147"><a href="#FinalOutcomeMapEvaluator-147"><span class="linenos">147</span></a>        <span class="nb">map</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">V</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">V</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FinalOutcomeMapEvaluator-148"><a href="#FinalOutcomeMapEvaluator-148"><span class="linenos">148</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">]:</span>
</span><span id="FinalOutcomeMapEvaluator-149"><a href="#FinalOutcomeMapEvaluator-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor. This wraps an inner evaluator.</span>
</span><span id="FinalOutcomeMapEvaluator-150"><a href="#FinalOutcomeMapEvaluator-150"><span class="linenos">150</span></a>
</span><span id="FinalOutcomeMapEvaluator-151"><a href="#FinalOutcomeMapEvaluator-151"><span class="linenos">151</span></a><span class="sd">        May return inner unmodified.</span>
</span><span id="FinalOutcomeMapEvaluator-152"><a href="#FinalOutcomeMapEvaluator-152"><span class="linenos">152</span></a>
</span><span id="FinalOutcomeMapEvaluator-153"><a href="#FinalOutcomeMapEvaluator-153"><span class="linenos">153</span></a><span class="sd">        Args:</span>
</span><span id="FinalOutcomeMapEvaluator-154"><a href="#FinalOutcomeMapEvaluator-154"><span class="linenos">154</span></a><span class="sd">            inner: The evaluator to wrap.</span>
</span><span id="FinalOutcomeMapEvaluator-155"><a href="#FinalOutcomeMapEvaluator-155"><span class="linenos">155</span></a><span class="sd">            map: A `Callable` or `Mapping` that takes an original outcome and</span>
</span><span id="FinalOutcomeMapEvaluator-156"><a href="#FinalOutcomeMapEvaluator-156"><span class="linenos">156</span></a><span class="sd">                produces the outcome that should be sent to the inner evaluator.</span>
</span><span id="FinalOutcomeMapEvaluator-157"><a href="#FinalOutcomeMapEvaluator-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FinalOutcomeMapEvaluator-158"><a href="#FinalOutcomeMapEvaluator-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator-159"><a href="#FinalOutcomeMapEvaluator-159"><span class="linenos">159</span></a>            <span class="c1"># Here V = T_contra.</span>
</span><span id="FinalOutcomeMapEvaluator-160"><a href="#FinalOutcomeMapEvaluator-160"><span class="linenos">160</span></a>            <span class="k">return</span> <span class="n">inner</span>  <span class="c1"># type: ignore</span>
</span><span id="FinalOutcomeMapEvaluator-161"><a href="#FinalOutcomeMapEvaluator-161"><span class="linenos">161</span></a>
</span><span id="FinalOutcomeMapEvaluator-162"><a href="#FinalOutcomeMapEvaluator-162"><span class="linenos">162</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">FinalOutcomeMapEvaluator</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="FinalOutcomeMapEvaluator-163"><a href="#FinalOutcomeMapEvaluator-163"><span class="linenos">163</span></a>
</span><span id="FinalOutcomeMapEvaluator-164"><a href="#FinalOutcomeMapEvaluator-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span> <span class="o">=</span> <span class="n">inner</span>
</span><span id="FinalOutcomeMapEvaluator-165"><a href="#FinalOutcomeMapEvaluator-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">map</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator-166"><a href="#FinalOutcomeMapEvaluator-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="nb">map</span>
</span><span id="FinalOutcomeMapEvaluator-167"><a href="#FinalOutcomeMapEvaluator-167"><span class="linenos">167</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FinalOutcomeMapEvaluator-168"><a href="#FinalOutcomeMapEvaluator-168"><span class="linenos">168</span></a>            <span class="n">map_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="FinalOutcomeMapEvaluator-169"><a href="#FinalOutcomeMapEvaluator-169"><span class="linenos">169</span></a>
</span><span id="FinalOutcomeMapEvaluator-170"><a href="#FinalOutcomeMapEvaluator-170"><span class="linenos">170</span></a>            <span class="k">def</span> <span class="nf">map_func</span><span class="p">(</span><span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span>
</span><span id="FinalOutcomeMapEvaluator-171"><a href="#FinalOutcomeMapEvaluator-171"><span class="linenos">171</span></a>                <span class="k">return</span> <span class="n">map_dict</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="FinalOutcomeMapEvaluator-172"><a href="#FinalOutcomeMapEvaluator-172"><span class="linenos">172</span></a>
</span><span id="FinalOutcomeMapEvaluator-173"><a href="#FinalOutcomeMapEvaluator-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="n">map_func</span>
</span><span id="FinalOutcomeMapEvaluator-174"><a href="#FinalOutcomeMapEvaluator-174"><span class="linenos">174</span></a>
</span><span id="FinalOutcomeMapEvaluator-175"><a href="#FinalOutcomeMapEvaluator-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="FinalOutcomeMapEvaluator-176"><a href="#FinalOutcomeMapEvaluator-176"><span class="linenos">176</span></a>
</span><span id="FinalOutcomeMapEvaluator-177"><a href="#FinalOutcomeMapEvaluator-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator-178"><a href="#FinalOutcomeMapEvaluator-178"><span class="linenos">178</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="FinalOutcomeMapEvaluator-179"><a href="#FinalOutcomeMapEvaluator-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span><span id="FinalOutcomeMapEvaluator-180"><a href="#FinalOutcomeMapEvaluator-180"><span class="linenos">180</span></a>
</span><span id="FinalOutcomeMapEvaluator-181"><a href="#FinalOutcomeMapEvaluator-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator-182"><a href="#FinalOutcomeMapEvaluator-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="FinalOutcomeMapEvaluator-183"><a href="#FinalOutcomeMapEvaluator-183"><span class="linenos">183</span></a>
</span><span id="FinalOutcomeMapEvaluator-184"><a href="#FinalOutcomeMapEvaluator-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator-185"><a href="#FinalOutcomeMapEvaluator-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span><span id="FinalOutcomeMapEvaluator-186"><a href="#FinalOutcomeMapEvaluator-186"><span class="linenos">186</span></a>
</span><span id="FinalOutcomeMapEvaluator-187"><a href="#FinalOutcomeMapEvaluator-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator-188"><a href="#FinalOutcomeMapEvaluator-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Maps outcomes to other outcomes before sending them to an inner evaluator.</p>

<p>Note that the outcomes will be seen in their original order, and outcomes
that map to the same value will still be considered in separate calls to
<code><a href="#FinalOutcomeMapEvaluator.next_state">next_state</a></code>. For this reason it's best to nest it inside
<code><a href="#AdjustIntCountEvaluator">AdjustIntCountEvaluator</a></code>, and the <code>map</code> argument should be presented last.</p>
</div>


                            <div id="FinalOutcomeMapEvaluator.__init__" class="classattr">
                                        <input id="FinalOutcomeMapEvaluator.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">FinalOutcomeMapEvaluator</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">inner</span><span class="p">:</span> <span class="n"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator">icepool.evaluator.outcome_count_evaluator.OutcomeCountEvaluator</a></span><span class="p">[</span><span class="o">~</span><span class="n">V</span><span class="p">,</span> <span class="o">+</span><span class="n">U_co</span><span class="p">,</span> <span class="o">-</span><span class="n">Q_contra</span><span class="p">]</span>,</span><span class="param">	<span class="nb">map</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">[[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">],</span> <span class="o">~</span><span class="n">V</span><span class="p">],</span> <span class="n">Mapping</span><span class="p">[</span><span class="o">-</span><span class="n">T_contra</span><span class="p">,</span> <span class="o">~</span><span class="n">V</span><span class="p">],</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="FinalOutcomeMapEvaluator.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FinalOutcomeMapEvaluator.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FinalOutcomeMapEvaluator.__init__-144"><a href="#FinalOutcomeMapEvaluator.__init__-144"><span class="linenos">144</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-145"><a href="#FinalOutcomeMapEvaluator.__init__-145"><span class="linenos">145</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-146"><a href="#FinalOutcomeMapEvaluator.__init__-146"><span class="linenos">146</span></a>        <span class="n">inner</span><span class="p">:</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">V</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">],</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-147"><a href="#FinalOutcomeMapEvaluator.__init__-147"><span class="linenos">147</span></a>        <span class="nb">map</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">T_contra</span><span class="p">],</span> <span class="n">V</span><span class="p">]</span> <span class="o">|</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">V</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-148"><a href="#FinalOutcomeMapEvaluator.__init__-148"><span class="linenos">148</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OutcomeCountEvaluator</span><span class="p">[</span><span class="n">T_contra</span><span class="p">,</span> <span class="n">U_co</span><span class="p">,</span> <span class="n">Q_contra</span><span class="p">]:</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-149"><a href="#FinalOutcomeMapEvaluator.__init__-149"><span class="linenos">149</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor. This wraps an inner evaluator.</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-150"><a href="#FinalOutcomeMapEvaluator.__init__-150"><span class="linenos">150</span></a>
</span><span id="FinalOutcomeMapEvaluator.__init__-151"><a href="#FinalOutcomeMapEvaluator.__init__-151"><span class="linenos">151</span></a><span class="sd">        May return inner unmodified.</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-152"><a href="#FinalOutcomeMapEvaluator.__init__-152"><span class="linenos">152</span></a>
</span><span id="FinalOutcomeMapEvaluator.__init__-153"><a href="#FinalOutcomeMapEvaluator.__init__-153"><span class="linenos">153</span></a><span class="sd">        Args:</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-154"><a href="#FinalOutcomeMapEvaluator.__init__-154"><span class="linenos">154</span></a><span class="sd">            inner: The evaluator to wrap.</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-155"><a href="#FinalOutcomeMapEvaluator.__init__-155"><span class="linenos">155</span></a><span class="sd">            map: A `Callable` or `Mapping` that takes an original outcome and</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-156"><a href="#FinalOutcomeMapEvaluator.__init__-156"><span class="linenos">156</span></a><span class="sd">                produces the outcome that should be sent to the inner evaluator.</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-157"><a href="#FinalOutcomeMapEvaluator.__init__-157"><span class="linenos">157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-158"><a href="#FinalOutcomeMapEvaluator.__init__-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="nb">map</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">callable</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="nb">map</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-159"><a href="#FinalOutcomeMapEvaluator.__init__-159"><span class="linenos">159</span></a>            <span class="c1"># Here V = T_contra.</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-160"><a href="#FinalOutcomeMapEvaluator.__init__-160"><span class="linenos">160</span></a>            <span class="k">return</span> <span class="n">inner</span>  <span class="c1"># type: ignore</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-161"><a href="#FinalOutcomeMapEvaluator.__init__-161"><span class="linenos">161</span></a>
</span><span id="FinalOutcomeMapEvaluator.__init__-162"><a href="#FinalOutcomeMapEvaluator.__init__-162"><span class="linenos">162</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">FinalOutcomeMapEvaluator</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-163"><a href="#FinalOutcomeMapEvaluator.__init__-163"><span class="linenos">163</span></a>
</span><span id="FinalOutcomeMapEvaluator.__init__-164"><a href="#FinalOutcomeMapEvaluator.__init__-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span> <span class="o">=</span> <span class="n">inner</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-165"><a href="#FinalOutcomeMapEvaluator.__init__-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="nb">map</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-166"><a href="#FinalOutcomeMapEvaluator.__init__-166"><span class="linenos">166</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="nb">map</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-167"><a href="#FinalOutcomeMapEvaluator.__init__-167"><span class="linenos">167</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-168"><a href="#FinalOutcomeMapEvaluator.__init__-168"><span class="linenos">168</span></a>            <span class="n">map_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">map</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-169"><a href="#FinalOutcomeMapEvaluator.__init__-169"><span class="linenos">169</span></a>
</span><span id="FinalOutcomeMapEvaluator.__init__-170"><a href="#FinalOutcomeMapEvaluator.__init__-170"><span class="linenos">170</span></a>            <span class="k">def</span> <span class="nf">map_func</span><span class="p">(</span><span class="n">outcome</span><span class="p">:</span> <span class="n">T_contra</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">V</span><span class="p">:</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-171"><a href="#FinalOutcomeMapEvaluator.__init__-171"><span class="linenos">171</span></a>                <span class="k">return</span> <span class="n">map_dict</span><span class="p">[</span><span class="n">outcome</span><span class="p">]</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-172"><a href="#FinalOutcomeMapEvaluator.__init__-172"><span class="linenos">172</span></a>
</span><span id="FinalOutcomeMapEvaluator.__init__-173"><a href="#FinalOutcomeMapEvaluator.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="n">map_func</span>
</span><span id="FinalOutcomeMapEvaluator.__init__-174"><a href="#FinalOutcomeMapEvaluator.__init__-174"><span class="linenos">174</span></a>
</span><span id="FinalOutcomeMapEvaluator.__init__-175"><a href="#FinalOutcomeMapEvaluator.__init__-175"><span class="linenos">175</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Constructor. This wraps an inner evaluator.</p>

<p>May return inner unmodified.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>inner:</strong>  The evaluator to wrap.</li>
<li><strong>map:</strong>  A <code>Callable</code> or <code>Mapping</code> that takes an original outcome and
produces the outcome that should be sent to the inner evaluator.</li>
</ul>
</div>


                            </div>
                            <div id="FinalOutcomeMapEvaluator.next_state" class="classattr">
                                        <input id="FinalOutcomeMapEvaluator.next_state-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">next_state</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">state</span>, </span><span class="param"><span class="n">outcome</span>, </span><span class="param"><span class="n">count</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FinalOutcomeMapEvaluator.next_state-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FinalOutcomeMapEvaluator.next_state"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FinalOutcomeMapEvaluator.next_state-177"><a href="#FinalOutcomeMapEvaluator.next_state-177"><span class="linenos">177</span></a>    <span class="k">def</span> <span class="nf">next_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator.next_state-178"><a href="#FinalOutcomeMapEvaluator.next_state-178"><span class="linenos">178</span></a>        <span class="n">outcome</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="p">(</span><span class="n">outcome</span><span class="p">)</span>
</span><span id="FinalOutcomeMapEvaluator.next_state-179"><a href="#FinalOutcomeMapEvaluator.next_state-179"><span class="linenos">179</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">next_state</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">outcome</span><span class="p">,</span> <span class="n">count</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>State transition function.</p>

<p>This should produce a state given the previous state, an outcome,
and the number that outcome produced by each generator.</p>

<p><code><a href="#FinalOutcomeMapEvaluator.evaluate">evaluate()</a></code> will always call this using only positional arguments.
Furthermore, there is no expectation that a subclass be able to handle
an arbitrary number of counts. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*counts</code> with a fixed set
of parameters.</p>

<p>Make sure to handle the base case where <code>state is None</code>.</p>

<p>States must be hashable. At current, they do not have to be orderable.
However, this may change in the future, and if they are not totally
orderable, you must override <code><a href="#FinalOutcomeMapEvaluator.final_outcome">final_outcome</a></code> to create totally orderable
final outcomes.</p>

<p>The behavior of returning a <code>Die</code> from <code><a href="#FinalOutcomeMapEvaluator.next_state">next_state</a></code> is currently
undefined.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>state:</strong>  A hashable object indicating the state before rolling the
current outcome. If this is the first outcome being considered,
<code>state</code> will be <code>None</code>.</li>
<li><strong>outcome:</strong>  The current outcome.
<code><a href="#FinalOutcomeMapEvaluator.next_state">next_state</a></code> will see all rolled outcomes in monotonic order;
either ascending or descending depending on <code><a href="#FinalOutcomeMapEvaluator.order">order()</a></code>.
If there are multiple generators, the set of outcomes is the
union of the outcomes of the invididual generators. All outcomes
with nonzero count will be seen. Outcomes with zero count
may or may not be seen. If you need to enforce that certain
outcomes are seen even if they have zero count, see
<code><a href="#FinalOutcomeMapEvaluator.alignment">alignment()</a></code>.</li>
<li><strong>*counts:</strong>  One value (usually an <code>int</code>) for each generator output
indicating how many of the current outcome were produced.
All outcomes with nonzero count are guaranteed to be seen.
To guarantee that outcomes are seen even if they have zero
count, override <code><a href="#FinalOutcomeMapEvaluator.alignment">alignment()</a></code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A hashable object indicating the next state.
  The special value <code><a href="../../icepool.html#Reroll">icepool.Reroll</a></code> can be used to immediately remove
  the state from consideration, effectively performing a full reroll.</p>
</blockquote>
</div>


                            </div>
                            <div id="FinalOutcomeMapEvaluator.final_outcome" class="classattr">
                                        <input id="FinalOutcomeMapEvaluator.final_outcome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">final_outcome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">final_state</span>, </span><span class="param"><span class="o">*</span><span class="n">generators</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FinalOutcomeMapEvaluator.final_outcome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FinalOutcomeMapEvaluator.final_outcome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FinalOutcomeMapEvaluator.final_outcome-181"><a href="#FinalOutcomeMapEvaluator.final_outcome-181"><span class="linenos">181</span></a>    <span class="k">def</span> <span class="nf">final_outcome</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator.final_outcome-182"><a href="#FinalOutcomeMapEvaluator.final_outcome-182"><span class="linenos">182</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">final_outcome</span><span class="p">(</span><span class="n">final_state</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to generate a final outcome from a final state.</p>

<p>Tthere is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>By default, the final outcome is equal to the final state.
Note that <code>None</code> is not a valid outcome for a <code>Die</code>,
and if there are no outcomes, the final state will be <code>None</code>.
Subclasses that want to handle this case should explicitly define what
happens.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>final_state:</strong>  A state after all outcomes have been processed.</li>
<li><strong>*generators:</strong>  One or more <code>OutcomeCountGenerator</code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>A final outcome that will be used as part of constructing the result <code>Die</code>.
  As usual for <code>Die()</code>, this could itself be a <code>Die</code> or <code><a href="../../icepool.html#Reroll">icepool.Reroll</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="FinalOutcomeMapEvaluator.order" class="classattr">
                                        <input id="FinalOutcomeMapEvaluator.order-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">order</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">generators</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FinalOutcomeMapEvaluator.order-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FinalOutcomeMapEvaluator.order"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FinalOutcomeMapEvaluator.order-184"><a href="#FinalOutcomeMapEvaluator.order-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator.order-185"><a href="#FinalOutcomeMapEvaluator.order-185"><span class="linenos">185</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">order</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Optional function to determine the order in which <code><a href="#FinalOutcomeMapEvaluator.next_state">next_state()</a></code> will see outcomes.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default is ascending order. This works well with mixed standard dice,
and other dice that differ only by right-truncation.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>*generators:</strong>  One or more <code>OutcomeCountGenerator</code>s being evaluated.
Most subclasses will expect a fixed number of generators and
can replace this variadic parameter with a fixed number of named
parameters.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <ul>
  <li>Order.Ascending (= 1)
  if <code><a href="#FinalOutcomeMapEvaluator.next_state">next_state()</a></code> should always see the outcomes in ascending order.</li>
  <li>Order.Descending (= -1)
  if <code><a href="#FinalOutcomeMapEvaluator.next_state">next_state()</a></code> should always see the outcomes in descending order.</li>
  <li>Order.Any (= 0)
  if the result of the evaluation is order-independent.</li>
  </ul>
</blockquote>
</div>


                            </div>
                            <div id="FinalOutcomeMapEvaluator.alignment" class="classattr">
                                        <input id="FinalOutcomeMapEvaluator.alignment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">alignment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">generators</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FinalOutcomeMapEvaluator.alignment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FinalOutcomeMapEvaluator.alignment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FinalOutcomeMapEvaluator.alignment-187"><a href="#FinalOutcomeMapEvaluator.alignment-187"><span class="linenos">187</span></a>    <span class="k">def</span> <span class="nf">alignment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">generators</span><span class="p">):</span>
</span><span id="FinalOutcomeMapEvaluator.alignment-188"><a href="#FinalOutcomeMapEvaluator.alignment-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inner</span><span class="o">.</span><span class="n">alignment</span><span class="p">(</span><span class="o">*</span><span class="n">generators</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Optional method to specify an collection of outcomes that should always be given to <code><a href="#FinalOutcomeMapEvaluator.next_state">next_state()</a></code> even if they have zero count.</p>

<p>There is no expectation that a subclass be able to handle
an arbitrary number of generators. Thus, you are free to rename any of
the parameters in a subclass, or to replace <code>*generators</code> with a fixed
set of parameters.</p>

<p>The default implementation returns <code>()</code>; this means outcomes with zero
count may or may not be seen by <code><a href="#FinalOutcomeMapEvaluator.next_state">next_state</a></code>.</p>

<p>If you want the outcomes seen by <code><a href="#FinalOutcomeMapEvaluator.next_state">next_state</a></code> to be consecutive
<code>int</code>s, you can set <code>alignment = <a href="../../icepool.html#OutcomeCountEvaluator.range_alignment">icepool.OutcomeCountEvaluator.range_alignment</a></code>.
See <code><a href="#FinalOutcomeMapEvaluator.range_alignment">range_alignment()</a></code> below.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="outcome_count_evaluator.html#OutcomeCountEvaluator">icepool.evaluator.outcome_count_evaluator.OutcomeCountEvaluator</a></dt>
                                <dd id="FinalOutcomeMapEvaluator.range_alignment" class="function"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator.range_alignment">range_alignment</a></dd>
                <dd id="FinalOutcomeMapEvaluator.evaluate" class="function"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator.evaluate">evaluate</a></dd>
                <dd id="FinalOutcomeMapEvaluator.sample" class="function"><a href="outcome_count_evaluator.html#OutcomeCountEvaluator.sample">sample</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>