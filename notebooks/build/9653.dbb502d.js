"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9653],{59653:(e,t,s)=>{s.r(t),s.d(t,{BLOCK_SIZE:()=>E,BaseExporter:()=>W,BaseKernel:()=>T,BrowserStorageDrive:()=>g,ContentsAPI:()=>P,DIR_MODE:()=>_,DRIVE_NAME:()=>u,DRIVE_SEPARATOR:()=>k,DriveContentsProcessor:()=>N,DriveFS:()=>R,DriveFSEmscriptenNodeOps:()=>I,DriveFSEmscriptenStreamOps:()=>M,Exporters:()=>G,FALLBACK_KERNEL:()=>D,FILE:()=>r,FILE_MODE:()=>w,IKernelClient:()=>A,IKernelSpecClient:()=>U,IKernelSpecs:()=>j,INbConvertExporters:()=>Q,KernelSpecs:()=>$,LiteKernelClient:()=>V,LiteKernelSpecClient:()=>K,LiteNbConvertManager:()=>Z,LiteSessionClient:()=>te,MIME:()=>n,NotebookExporter:()=>Y,SEEK_CUR:()=>y,SEEK_END:()=>v,ScriptExporter:()=>X,ServiceWorkerContentsAPI:()=>O,Settings:()=>re,instanceOfStream:()=>S});var n,r,i=s(5379),a=s(57633),o=s(72215),l=s(46257),c=s(9879),h=s.n(c);!function(e){e.JSON="application/json",e.PLAIN_TEXT="text/plain",e.OCTET_STREAM="octet/stream"}(n||(n={})),function(e){const t=JSON.parse(i.PageConfig.getOption("fileTypes")||"{}");e.getType=function(e,s=null){e=e.toLowerCase();for(const s of Object.values(t))for(const t of s.extensions||[])if(t===e&&s.mimeTypes&&s.mimeTypes.length)return s.mimeTypes[0];return h().getType(e)||s||n.OCTET_STREAM},e.hasFormat=function(e,s){e=e.toLowerCase();for(const n of Object.values(t))if(n.fileFormat===s)for(const t of n.extensions||[])if(t===e)return!0;return!1}}(r||(r={}));const d="JupyterLite Storage",u="BrowserStorage",p=new TextEncoder,m=new TextDecoder("utf-8");class g{constructor(e){var t;this.reduceBytesToString=(e,t)=>e+String.fromCharCode(t),this._serverContents=new Map,this._isDisposed=!1,this._fileChanged=new l.Signal(this),this._storageName=d,this._storageDrivers=null,this._localforage=e.localforage,this._storageName=e.storageName||d,this._storageDrivers=e.storageDrivers||null,this._serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:a.ServerConnection.makeSettings(),this._ready=new o.PromiseDelegate,this.initialize().catch(console.warn)}dispose(){this.isDisposed||(this._isDisposed=!0,l.Signal.clearData(this))}get isDisposed(){return this._isDisposed}get name(){return u}get serverSettings(){return this._serverSettings}get fileChanged(){return this._fileChanged}async getDownloadUrl(e){e=decodeURIComponent(e.replace(/^\//,""));const t=await this.storage,s=await t.getItem(e);if(s&&null!==s.content){let e;if("base64"===s.format){const t=atob(s.content),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);e=new Blob([n],{type:s.mimetype})}else if("json"===s.format){const t=JSON.stringify(s.content);e=new Blob([t],{type:s.mimetype})}else e=new Blob([s.content],{type:s.mimetype});return URL.createObjectURL(e)}const n=this.serverSettings.baseUrl;return i.URLExt.join(n,"files",i.URLExt.encodeParts(e))}async initialize(){await this.initStorage(),this._ready.resolve(void 0)}async initStorage(){this._storage=this.createDefaultStorage(),this._counters=this.createDefaultCounters(),this._checkpoints=this.createDefaultCheckpoints()}get ready(){return this._ready.promise}get storage(){return this.ready.then((()=>this._storage))}get counters(){return this.ready.then((()=>this._counters))}get checkpoints(){return this.ready.then((()=>this._checkpoints))}get defaultStorageOptions(){const e=this._storageDrivers&&this._storageDrivers.length?this._storageDrivers:null;return{version:1,name:this._storageName,...e?{driver:e}:{}}}createDefaultStorage(){return this._localforage.createInstance({description:"Offline Storage for Notebooks and Files",storeName:"files",...this.defaultStorageOptions})}createDefaultCounters(){return this._localforage.createInstance({description:"Store the current file suffix counters",storeName:"counters",...this.defaultStorageOptions})}createDefaultCheckpoints(){return this._localforage.createInstance({description:"Offline Storage for Checkpoints",storeName:"checkpoints",...this.defaultStorageOptions})}async clearStorage(){await Promise.all([(await this.storage).clear(),(await this.counters).clear(),(await this.checkpoints).clear()])}async newUntitled(e){var t,s,a;const o=null!==(t=null==e?void 0:e.path)&&void 0!==t?t:"",l=null!==(s=null==e?void 0:e.type)&&void 0!==s?s:"notebook",c=(new Date).toISOString();let h=i.PathExt.dirname(o);const d=i.PathExt.basename(o),u=i.PathExt.extname(o),m=await this.get(h).catch((()=>null));let g,_="";switch(o&&!u&&m?(h=`${o}/`,_=""):h&&d?(h=`${h}/`,_=d):(h="",_=o),l){case"directory":_=`Untitled Folder${await this._incrementCounter("directory")||""}`,g={name:_,path:`${h}${_}`,last_modified:c,created:c,format:"json",mimetype:"",content:null,size:0,writable:!0,type:"directory"};break;case"notebook":{const e=await this._incrementCounter("notebook");_=_||`Untitled${e||""}.ipynb`,g={name:_,path:`${h}${_}`,last_modified:c,created:c,format:"json",mimetype:n.JSON,content:f.EMPTY_NB,size:p.encode(JSON.stringify(f.EMPTY_NB)).length,writable:!0,type:"notebook"};break}default:{let t=null!==(a=null==e?void 0:e.ext)&&void 0!==a?a:".txt";t.startsWith(".")||(t=`.${t}`);const s=await this._incrementCounter("file"),i=r.getType(t)||n.OCTET_STREAM;let o;o=r.hasFormat(t,"text")||-1!==i.indexOf("text")?"text":-1!==t.indexOf("json")||-1!==t.indexOf("ipynb")?"json":"base64",_=_||`untitled${s||""}${t}`,g={name:_,path:`${h}${_}`,last_modified:c,created:c,format:o,mimetype:i,content:"",size:0,writable:!0,type:"file"};break}}const w=g.path;return await(await this.storage).setItem(w,g),this._fileChanged.emit({type:"new",oldValue:null,newValue:g}),g}async copy(e,t){let s=i.PathExt.basename(e);for(t=""===t?"":`${i.PathExt.removeSlash(t)}/`;await this.get(`${t}${s}`,{content:!0}).then((()=>!0)).catch((()=>!1));){const e=i.PathExt.extname(s),t=s.replace(e,"");s=`${t} (copy)${e}`}const n=`${t}${s}`;let r=await this.get(e,{content:!0}).catch((()=>null));if(!r)throw Error(`Could not find file with path ${e}`);return r={...r,name:s,path:n},await(await this.storage).setItem(n,r),this._fileChanged.emit({type:"new",oldValue:null,newValue:r}),r}async get(e,t){if(""===(e=decodeURIComponent(e.replace(/^\//,"")))){const t=await this._getFolder(e);if(null===t)throw Error(`Could not find file with path ${e}`);return t}const s=await this.storage,r=await s.getItem(e),a=await this._getServerContents(e,t),o=r||a;if(!o)throw Error(`Could not find content with path ${e}`);if(!(null==t?void 0:t.content))return{size:0,...o,content:null};if("directory"===o.type){const t=new Map;await s.iterate(((s,n)=>{n===`${e}/${s.name}`&&t.set(s.name,s)}));const r=a?a.content:Array.from((await this._getServerDirectory(e)).values());for(const e of r)t.has(e.name)||t.set(e.name,e);const l=[...t.values()];return{name:i.PathExt.basename(e),path:e,last_modified:o.last_modified,created:o.created,format:"json",mimetype:n.JSON,content:l,size:0,writable:!0,type:"directory"}}return o}async rename(e,t){const s=decodeURIComponent(e),n=await this.get(s,{content:!0}).catch((()=>null));if(!n)throw Error(`Could not find file with path ${s}`);const r=(new Date).toISOString(),a=i.PathExt.basename(t),o={...n,name:a,path:t,last_modified:r},l=await this.storage;if(await l.setItem(t,o),await l.removeItem(s),await(await this.checkpoints).removeItem(s),"directory"===n.type){let s;for(s of n.content)await this.rename(i.URLExt.join(e,s.name),i.URLExt.join(t,s.name))}return this._fileChanged.emit({type:"rename",oldValue:{path:e},newValue:o}),o}async save(e,t={}){var s;e=decodeURIComponent(e);const n=i.PathExt.extname(null!==(s=t.name)&&void 0!==s?s:""),a=t.chunk,o=!!a&&(a>1||-1===a);let l=await this.get(e,{content:o}).catch((()=>null));if(l||(l=await this.newUntitled({path:e,ext:n,type:"file"})),!l)throw Error(`Could not find file with path ${e}`);const c=l.content,h=(new Date).toISOString();if(l={...l,...t,last_modified:h},t.content&&"base64"===t.format){const e=!a||-1===a,s=this._handleUploadChunk(t.content,c,o);if(".ipynb"===n){const t=e?JSON.parse(m.decode(this._binaryStringToBytes(s))):s;l={...l,content:t,format:"json",type:"notebook",size:s.length}}else if(r.hasFormat(n,"json")){const t=e?JSON.parse(m.decode(this._binaryStringToBytes(s))):s;l={...l,content:t,format:"json",type:"file",size:s.length}}else if(r.hasFormat(n,"text")){const t=e?m.decode(this._binaryStringToBytes(s)):s;l={...l,content:t,format:"text",type:"file",size:s.length}}else{const t=e?btoa(s):s;l={...l,content:t,format:"base64",type:"file",size:s.length}}}if(l.content)switch(t.format){case"json":l={...l,size:p.encode(JSON.stringify(l.content)).length};break;case"text":l={...l,size:p.encode(l.content).length};break;case"base64":break;default:l={...l,size:0}}else l={...l,size:0};return await(await this.storage).setItem(e,l),this._fileChanged.emit({type:"save",oldValue:null,newValue:l}),l}async delete(e){const t=`${e=decodeURIComponent(e)}/`,s=(await(await this.storage).keys()).filter((s=>s===e||s.startsWith(t)));await Promise.all(s.map(this.forgetPath,this)),this._fileChanged.emit({type:"delete",oldValue:{path:e},newValue:null})}async forgetPath(e){await Promise.all([(await this.storage).removeItem(e),(await this.checkpoints).removeItem(e)])}async createCheckpoint(e){var t;const s=await this.checkpoints;e=decodeURIComponent(e);const n=await this.get(e,{content:!0}).catch((()=>null));if(!n)throw Error(`Could not find file with path ${e}`);const r=(null!==(t=await s.getItem(e))&&void 0!==t?t:[]).filter(Boolean);return r.push(n),r.length>5&&r.splice(0,r.length-5),await s.setItem(e,r),{id:""+(r.length-1),last_modified:n.last_modified}}async listCheckpoints(e){return(await(await this.checkpoints).getItem(e)||[]).filter(Boolean).map(this.normalizeCheckpoint,this)}normalizeCheckpoint(e,t){return{id:t.toString(),last_modified:e.last_modified}}async restoreCheckpoint(e,t){e=decodeURIComponent(e);const s=(await(await this.checkpoints).getItem(e)||[])[parseInt(t)];await(await this.storage).setItem(e,s)}async deleteCheckpoint(e,t){e=decodeURIComponent(e);const s=await(await this.checkpoints).getItem(e)||[],n=parseInt(t);s.splice(n,1),await(await this.checkpoints).setItem(e,s)}_handleUploadChunk(e,t,s){const n=atob(e);return s?t+n:n}_binaryStringToBytes(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}async _getFolder(e){const t=new Map,s=await this.storage;await s.iterate(((e,s)=>{s.includes("/")||t.set(e.path,e)}));for(const s of(await this._getServerDirectory(e)).values())t.has(s.path)||t.set(s.path,s);return e&&0===t.size?null:{name:"",path:e,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"json",mimetype:n.JSON,content:Array.from(t.values()),size:0,writable:!0,type:"directory"}}async _getServerContents(e,t){const s=i.PathExt.basename(e);let a=(await this._getServerDirectory(i.URLExt.join(e,".."))).get(s);if(!a)return null;if(a=a||{name:s,path:e,last_modified:new Date(0).toISOString(),created:new Date(0).toISOString(),format:"text",mimetype:n.PLAIN_TEXT,type:"file",writable:!0,size:0,content:""},null==t?void 0:t.content)if("directory"===a.type){const t=await this._getServerDirectory(e);a={...a,content:Array.from(t.values())}}else{const t=i.URLExt.join(i.PageConfig.getBaseUrl(),"files",e),o=await fetch(t);if(!o.ok)return null;const l=a.mimetype||o.headers.get("Content-Type"),c=i.PathExt.extname(s);if("notebook"===a.type||r.hasFormat(c,"json")||-1!==(null==l?void 0:l.indexOf("json"))||e.match(/\.(ipynb|[^/]*json[^/]*)$/)){const e=await o.text();a={...a,content:JSON.parse(e),format:"json",mimetype:a.mimetype||n.JSON,size:p.encode(e).length}}else if(r.hasFormat(c,"text")||-1!==l.indexOf("text")){const e=await o.text();a={...a,content:e,format:"text",mimetype:l||n.PLAIN_TEXT,size:p.encode(e).length}}else{const e=await o.arrayBuffer(),t=new Uint8Array(e);a={...a,content:btoa(t.reduce(this.reduceBytesToString,"")),format:"base64",mimetype:l||n.OCTET_STREAM,size:t.length}}}return a}async _getServerDirectory(e){const t=this._serverContents.get(e)||new Map;if(!this._serverContents.has(e)){const s=i.URLExt.join(i.PageConfig.getBaseUrl(),"api/contents",e,"all.json");try{const e=await fetch(s),n=JSON.parse(await e.text());for(const e of n.content)t.set(e.name,e)}catch(e){console.warn(`don't worry, about ${e}... nothing's broken. If there had been a\n          file at ${s}, you might see some more files.`)}this._serverContents.set(e,t)}return t}async _incrementCounter(e){var t;const s=await this.counters,n=(null!==(t=await s.getItem(e))&&void 0!==t?t:-1)+1;return await s.setItem(e,n),n}}var f;!function(e){e.EMPTY_NB={metadata:{orig_nbformat:4},nbformat_minor:5,nbformat:4,cells:[]}}(f||(f={}));const _=16895,w=33206,y=1,v=2;function S(e){return"node"in e}const k=":",E=4096,C=new TextEncoder,b=new TextDecoder("utf-8"),x={0:!1,1:!0,2:!0,64:!0,65:!0,66:!0,129:!0,193:!0,514:!0,577:!0,578:!0,705:!0,706:!0,1024:!0,1025:!0,1026:!0,1089:!0,1090:!0,1153:!0,1154:!0,1217:!0,1218:!0,4096:!0,4098:!0};class M{constructor(e){this.fs=e}open(e){var t;const s=this.fs.realPath(e.node);if(this.fs.FS.isFile(e.node.mode))try{const t=this.fs.API.get(s);e.file=t}catch(n){const r=null!==(t=e.flags)&&void 0!==t?t:e.shared.flags;let i="string"==typeof r?parseInt(r,10):r;i&=8191;let a=!0;if(i in x&&(a=x[i]),!a)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);{e.node=this.fs.node_ops.mknod(e.node.parent,e.node.name,e.node.mode,0);const t=this.fs.API.get(s);e.file=t}}}close(e){var t;if(!this.fs.FS.isFile(e.node.mode)||!e.file)return;const s=this.fs.realPath(e.node),n=null!==(t=e.flags)&&void 0!==t?t:e.shared.flags;let r="string"==typeof n?parseInt(n,10):n;r&=8191;let i=!0;r in x&&(i=x[r]),i&&this.fs.API.put(s,e.file),e.file=void 0}read(e,t,s,n,r){if(n<=0||void 0===e.file||r>=(e.file.data.length||0))return 0;const i=Math.min(e.file.data.length-r,n);return t.set(e.file.data.subarray(r,r+i),s),i}write(e,t,s,n,r){var i;if(n<=0||void 0===e.file)return 0;const a=Date.now();if(e.node.timestamp=a,e.node.atime=a,e.node.mtime=a,e.node.ctime=a,r+n>((null===(i=e.file)||void 0===i?void 0:i.data.length)||0)){const t=e.file.data?e.file.data:new Uint8Array;e.file.data=new Uint8Array(r+n),e.file.data.set(t)}return e.file.data.set(t.subarray(s,s+n),r),n}llseek(e,t,s){var n;let r=t;if(s===y)r+=null!==(n=e.position)&&void 0!==n?n:e.shared.position;else if(s===v&&this.fs.FS.isFile(e.node.mode)){if(void 0===e.file)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);r+=e.file.data.length}if(r<0)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);return r}}class I{constructor(e){this.node=e=>S(e)?e.node:e,this.getattr=e=>{const t=this.node(e);return{...this.fs.API.getattr(this.fs.realPath(t)),mode:t.mode,ino:t.id}},this.setattr=(e,t)=>{const s=this.node(e);for(const[e,n]of Object.entries(t))switch(e){case"mode":s.mode=n;break;case"timestamp":s.timestamp=n;break;case"atime":s.atime=n;break;case"mtime":s.mtime=n;break;case"ctime":s.ctime=n;break;case"size":{const e=n,t=this.fs.realPath(s);if(this.fs.FS.isFile(s.mode)&&e>=0){let s;try{s=this.fs.API.get(t)}catch(e){break}const n=s.data?s.data:new Uint8Array;e!==n.length&&(e<n.length?s.data=s.data.slice(0,e):(s.data=new Uint8Array(e),s.data.set(n)),this.fs.API.put(t,s))}else console.warn("setattr size of",e,"on",s,"not yet implemented");break}case"dontFollow":break;default:console.warn("setattr",e,"of",n,"on",s,"not yet implemented")}},this.lookup=(e,t)=>{const s=this.node(e),n=this.fs.PATH.join2(this.fs.realPath(s),t),r=this.fs.API.lookup(n);if(!r.ok)throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.ENOENT);return this.fs.createNode(s,t,r.mode,0)},this.mknod=(e,t,s,n)=>{const r=this.node(e),i=this.fs.PATH.join2(this.fs.realPath(r),t);return this.fs.API.mknod(i,s),this.fs.createNode(r,t,s,n)},this.rename=(e,t,s)=>{const n=this.node(e),r=this.node(t);this.fs.API.rename(n.parent?this.fs.PATH.join2(this.fs.realPath(n.parent),n.name):n.name,this.fs.PATH.join2(this.fs.realPath(r),s)),n.name=s,n.parent=r},this.unlink=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.rmdir=(e,t)=>this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(e)),t)),this.readdir=e=>this.fs.API.readdir(this.fs.realPath(this.node(e))),this.symlink=(e,t,s)=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM)},this.readlink=e=>{throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL)},this.fs=e}}class P{constructor(e){this._driveName=e.driveName,this._mountpoint=e.mountpoint,this.FS=e.FS,this.ERRNO_CODES=e.ERRNO_CODES}lookup(e){return this.request({method:"lookup",path:this.normalizePath(e)})}getmode(e){return this.request({method:"getmode",path:this.normalizePath(e)})}mknod(e,t){return this.request({method:"mknod",path:this.normalizePath(e),data:{mode:t}})}rename(e,t){return this.request({method:"rename",path:this.normalizePath(e),data:{newPath:this.normalizePath(t)}})}readdir(e){const t=this.request({method:"readdir",path:this.normalizePath(e)});return t.push("."),t.push(".."),t}rmdir(e){return this.request({method:"rmdir",path:this.normalizePath(e)})}get(e){const t=this.request({method:"get",path:this.normalizePath(e)});if(!t)throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT);const s=t.content,n=t.format;switch(n){case"json":case"text":return{data:C.encode(s),format:n};case"base64":{const e=atob(s),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return{data:r,format:n}}default:throw new this.FS.ErrnoError(this.ERRNO_CODES.ENOENT)}}put(e,t){switch(t.format){case"json":case"text":return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:b.decode(t.data)}});case"base64":{let s="";for(let e=0;e<t.data.byteLength;e++)s+=String.fromCharCode(t.data[e]);return this.request({method:"put",path:this.normalizePath(e),data:{format:t.format,data:btoa(s)}})}}}getattr(e){const t=this.request({method:"getattr",path:this.normalizePath(e)}),s=new Date(0);return t.atime=t.atime?new Date(t.atime):s,t.mtime=t.mtime?new Date(t.mtime):s,t.ctime=t.ctime?new Date(t.ctime):s,t.size=t.size||0,t}normalizePath(e){return e.startsWith(this._mountpoint)&&(e=e.slice(this._mountpoint.length)),this._driveName&&(e=`${this._driveName}${k}${e}`),e}}class O extends P{constructor(e){super(e),this._baseUrl=e.baseUrl,this._browsingContextId=e.browsingContextId||""}request(e){const t=new XMLHttpRequest;t.open("POST",encodeURI(this.endpoint),!1);const s=o.UUID.uuid4(),n={data:{...e,requestId:s},browsingContextId:this._browsingContextId,requestId:s};try{t.send(JSON.stringify(n))}catch(e){console.error(e)}if(t.status>=400)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return JSON.parse(t.responseText)}get endpoint(){return`${this._baseUrl}api/drive`}}class R{constructor(e){this.FS=e.FS,this.PATH=e.PATH,this.ERRNO_CODES=e.ERRNO_CODES,this.API=this.createAPI(e),this.driveName=e.driveName,this.node_ops=new I(this),this.stream_ops=new M(this)}createAPI(e){if(!e.browsingContextId||!e.baseUrl)throw new Error("Cannot create service-worker API without current browsingContextId");return new O(e)}mount(e){return this.createNode(null,e.mountpoint,511|_,0)}createNode(e,t,s,n){const r=this.FS;if(!r.isDir(s)&&!r.isFile(s))throw new r.ErrnoError(this.ERRNO_CODES.EINVAL);const i=r.createNode(e,t,s,n);return i.node_ops=this.node_ops,i.stream_ops=this.stream_ops,i}getMode(e){return this.API.getmode(e)}realPath(e){const t=[];let s=e;for(t.push(s.name);s.parent!==s;)s=s.parent,t.push(s.name);return t.reverse(),this.PATH.join.apply(null,t)}}class N{constructor(e){this.contentsManager=e.contentsManager}async processDriveRequest(e){switch(e.method){case"readdir":return this.readdir(e);case"rmdir":return this.rmdir(e);case"rename":return this.rename(e);case"getmode":return this.getmode(e);case"lookup":return this.lookup(e);case"mknod":return this.mknod(e);case"getattr":return this.getattr(e);case"get":return this.get(e);case"put":return this.put(e)}throw`Drive request ${e.method} does not exist.`}async readdir(e){const t=await this.contentsManager.get(e.path,{content:!0});let s=[];return"directory"===t.type&&t.content&&(s=t.content.map((e=>e.name))),s}async rmdir(e){return await this.contentsManager.delete(e.path),null}async rename(e){return await this.contentsManager.rename(e.path,e.data.newPath),null}async getmode(e){let t;return t="directory"===(await this.contentsManager.get(e.path)).type?_:w,t}async lookup(e){let t;try{t={ok:!0,mode:"directory"===(await this.contentsManager.get(e.path)).type?_:w}}catch(e){t={ok:!1}}return t}async mknod(e){const t=await this.contentsManager.newUntitled({path:i.PathExt.dirname(e.path),type:e.data.mode===_?"directory":"file",ext:i.PathExt.extname(e.path)});return await this.contentsManager.rename(t.path,e.path),null}async getattr(e){const t=await this.contentsManager.get(e.path),s=new Date(0).toISOString();return{dev:1,nlink:1,uid:0,gid:0,rdev:0,size:t.size||0,blksize:E,blocks:Math.ceil(t.size||0/E),atime:t.last_modified||s,mtime:t.last_modified||s,ctime:t.created||s,timestamp:0}}async get(e){let t;try{t=await this.contentsManager.get(e.path,{content:!0})}catch(e){return null}let s=null;return"directory"!==t.type&&(s={content:"json"===t.format?JSON.stringify(t.content):t.content,format:t.format}),s}async put(e){return await this.contentsManager.save(e.path,{content:"json"===e.data.format&&e.data.data?JSON.parse(e.data.data):e.data.data,type:"file",format:e.data.format}),null}}class T{constructor(e){this._history=[],this._executionCount=0,this._isDisposed=!1,this._disposed=new l.Signal(this),this._parentHeader=void 0,this._parent=void 0;const{id:t,name:s,location:n,sendMessage:r}=e;this._id=t,this._name=s,this._location=n,this._sendMessage=r}get ready(){return Promise.resolve()}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}get id(){return this._id}get name(){return this._name}get location(){return this._location}get executionCount(){return this._executionCount}get parentHeader(){return this._parentHeader}get parent(){return this._parent}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(void 0))}async handleMessage(e){switch(this._busy(e),this._parent=e,e.header.msg_type){case"kernel_info_request":await this._kernelInfo(e);break;case"execute_request":await this._execute(e);break;case"input_reply":this.inputReply(e.content);break;case"inspect_request":await this._inspect(e);break;case"is_complete_request":await this._isCompleteRequest(e);break;case"complete_request":await this._complete(e);break;case"history_request":await this._historyRequest(e);break;case"comm_open":await this.commOpen(e);break;case"comm_msg":await this.commMsg(e);break;case"comm_close":await this.commClose(e)}this._idle(e)}stream(e,t=void 0){var s;const n=void 0!==t?t:this._parentHeader,r=a.KernelMessage.createMessage({channel:"iopub",msgType:"stream",session:null!==(s=null==n?void 0:n.session)&&void 0!==s?s:"",parentHeader:n,content:e});this._sendMessage(r)}displayData(e,t=void 0){var s,n;const r=void 0!==t?t:this._parentHeader;e.metadata=null!==(s=e.metadata)&&void 0!==s?s:{};const i=a.KernelMessage.createMessage({channel:"iopub",msgType:"display_data",session:null!==(n=null==r?void 0:r.session)&&void 0!==n?n:"",parentHeader:r,content:e});this._sendMessage(i)}inputRequest(e,t=void 0){var s;const n=void 0!==t?t:this._parentHeader,r=a.KernelMessage.createMessage({channel:"stdin",msgType:"input_request",session:null!==(s=null==n?void 0:n.session)&&void 0!==s?s:"",parentHeader:n,content:e});this._sendMessage(r)}publishExecuteResult(e,t=void 0){var s;const n=void 0!==t?t:this._parentHeader,r=a.KernelMessage.createMessage({channel:"iopub",msgType:"execute_result",session:null!==(s=null==n?void 0:n.session)&&void 0!==s?s:"",parentHeader:n,content:e});this._sendMessage(r)}publishExecuteError(e,t=void 0){var s;const n=void 0!==t?t:this._parentHeader,r=a.KernelMessage.createMessage({channel:"iopub",msgType:"error",session:null!==(s=null==n?void 0:n.session)&&void 0!==s?s:"",parentHeader:n,content:e});this._sendMessage(r)}updateDisplayData(e,t=void 0){var s;const n=void 0!==t?t:this._parentHeader,r=a.KernelMessage.createMessage({channel:"iopub",msgType:"update_display_data",session:null!==(s=null==n?void 0:n.session)&&void 0!==s?s:"",parentHeader:n,content:e});this._sendMessage(r)}clearOutput(e,t=void 0){var s;const n=void 0!==t?t:this._parentHeader,r=a.KernelMessage.createMessage({channel:"iopub",msgType:"clear_output",session:null!==(s=null==n?void 0:n.session)&&void 0!==s?s:"",parentHeader:n,content:e});this._sendMessage(r)}handleComm(e,t,s,n,r=void 0){var i;const o=void 0!==r?r:this._parentHeader,l=a.KernelMessage.createMessage({channel:"iopub",msgType:e,session:null!==(i=null==o?void 0:o.session)&&void 0!==i?i:"",parentHeader:o,content:t,metadata:s,buffers:n});this._sendMessage(l)}_idle(e){const t=a.KernelMessage.createMessage({msgType:"status",session:e.header.session,parentHeader:e.header,channel:"iopub",content:{execution_state:"idle"}});this._sendMessage(t)}_busy(e){const t=a.KernelMessage.createMessage({msgType:"status",session:e.header.session,parentHeader:e.header,channel:"iopub",content:{execution_state:"busy"}});this._sendMessage(t)}async _kernelInfo(e){const t=await this.kernelInfoRequest(),s=a.KernelMessage.createMessage({msgType:"kernel_info_reply",channel:"shell",session:e.header.session,parentHeader:e.header,content:t});this._sendMessage(s)}async _historyRequest(e){const t=e,s=a.KernelMessage.createMessage({msgType:"history_reply",channel:"shell",parentHeader:t.header,session:e.header.session,content:{status:"ok",history:this._history}});this._sendMessage(s)}_executeInput(e){const t=e,s=t.content.code,n=a.KernelMessage.createMessage({msgType:"execute_input",parentHeader:t.header,channel:"iopub",session:e.header.session,content:{code:s,execution_count:this._executionCount}});this._sendMessage(n)}async _execute(e){const t=e,s=t.content;s.store_history&&this._executionCount++,this._parentHeader=t.header,this._executeInput(t),s.store_history&&this._history.push([0,0,s.code]);const n=await this.executeRequest(t.content),r=a.KernelMessage.createMessage({msgType:"execute_reply",channel:"shell",parentHeader:t.header,session:e.header.session,content:n});this._sendMessage(r)}async _complete(e){const t=e,s=await this.completeRequest(t.content),n=a.KernelMessage.createMessage({msgType:"complete_reply",parentHeader:t.header,channel:"shell",session:e.header.session,content:s});this._sendMessage(n)}async _inspect(e){const t=e,s=await this.inspectRequest(t.content),n=a.KernelMessage.createMessage({msgType:"inspect_reply",parentHeader:t.header,channel:"shell",session:e.header.session,content:s});this._sendMessage(n)}async _isCompleteRequest(e){const t=e,s=await this.isCompleteRequest(t.content),n=a.KernelMessage.createMessage({msgType:"is_complete_reply",parentHeader:t.header,channel:"shell",session:e.header.session,content:s});this._sendMessage(n)}}const D="javascript",A=new o.Token("@jupyterlite/services:IKernelClient"),U=new o.Token("@jupyterlite/services:IKernelSpecClient"),j=new o.Token("@jupyterlite/services:IKernelSpecs");class ${constructor(){this._specs=new Map,this._factories=new Map,this._changed=new l.Signal(this)}get specs(){return 0===this._specs.size?null:{default:this.defaultKernelName,kernelspecs:Object.fromEntries(this._specs)}}get defaultKernelName(){let e=i.PageConfig.getOption("defaultKernelName");if(!e&&this._specs.size){const t=Array.from(this._specs.keys());t.sort(),e=t[0]}return e||D}get factories(){return this._factories}get changed(){return this._changed}register(e){const{spec:t,create:s}=e;this._specs.set(t.name,t),this._factories.set(t.name,s),this._changed.emit(this.specs)}}const z={default:"",kernelspecs:{}};class K{constructor(e){var t;this._kernelspecs=e.kernelSpecs,this._serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:a.ServerConnection.makeSettings()}get serverSettings(){return this._serverSettings}async get(){var e;return Promise.resolve(null!==(e=this._kernelspecs.specs)&&void 0!==e?e:z)}}var F=s(12087),L=s(81259),H=s(70552),q=s(188),B=s(76555);const J=H.supportedKernelWebSocketProtocols.v1KernelWebsocketJupyterOrg;class V{constructor(e){var t;this._kernels=new F.ObservableMap,this._clients=new F.ObservableMap,this._mutexMap=new Map,this._kernelClients=new F.ObservableMap,this._changed=new l.Signal(this),this._kernelSends=new F.ObservableMap,this._cancelReason=new WeakMap;const{kernelSpecs:s}=e;this._kernelspecs=s,this._serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:a.ServerConnection.makeSettings(),this._kernels.changed.connect(((e,t)=>{this._changed.emit(t)}))}get serverSettings(){return this._serverSettings}get changed(){return this._changed}async startNew(e){const{id:t,name:s,location:n}=e,r=null!=s?s:D,l=this._kernelspecs.factories.get(r);if(!l)throw Error(`No factory for kernel ${r}`);const c=new q.WU,h=(e,t,s)=>{var n;const r=this._kernels.get(e);if(!r)throw Error(`No kernel ${e}`);this._clients.set(t,s),this._mutexMap.set(e,c),null===(n=this._kernelClients.get(e))||void 0===n||n.add(t);const i=async s=>{try{await c.runExclusive((async()=>{await r.ready,await r.handleMessage(s)}))}catch(n){if(!(n instanceof Error&&n.message.includes("request for lock canceled")))throw n;{const n=this._cancelReason.get(c);if(("interrupt"===n||"interrupt-subsequent"===n)&&"execute_request"===s.header.msg_type){"interrupt"===n&&this._cancelReason.set(c,"interrupt-subsequent"),await c.waitForUnlock();const r={status:"error",ename:"Kernel Interrupt",evalue:"Interrupted",traceback:[]},i=this._kernelSends.get(e);if(void 0===i)return void console.warn("Did not find kernel send method");"interrupt"===n&&i(a.KernelMessage.createMessage({channel:"iopub",session:t,parentHeader:s.header,msgType:"error",content:r})),i(a.KernelMessage.createMessage({channel:"shell",session:t,parentHeader:s.header,msgType:"execute_reply",content:{...r,execution_count:0},metadata:{cause:"interrupt"}})),i(a.KernelMessage.createMessage({channel:"iopub",session:t,parentHeader:s.header,msgType:"status",content:{execution_state:"idle"}}))}}}};s.on("message",(async e=>{let t;if(e instanceof ArrayBuffer)e=new Uint8Array(e).buffer,t=(0,L.deserialize)(e,J);else{if("string"!=typeof e)return;{const s=(new TextEncoder).encode(e);t=(0,L.deserialize)(s.buffer,J)}}"input_reply"===t.header.msg_type?void 0!==this._stdinPromise?this._stdinPromise.resolve(t):r.handleMessage(t):i(t)}));const o=()=>{var s;this._clients.delete(t),null===(s=this._kernelClients.get(e))||void 0===s||s.delete(t)};r.disposed.connect(o),s.onclose=o},d=null!=t?t:o.UUID.uuid4(),u=i.URLExt.join(V.WS_BASE_URL,a.KernelAPI.KERNEL_SERVICE_URL,encodeURIComponent(d),"channels"),p=this._kernels.get(d);if(p)return{id:p.id,name:p.name};const m=e=>{const t="stdin"===e.channel?e.parent_header.session:e.header.session,s=this._clients.get(t);if(!s)return void console.warn(`Trying to send message on removed socket for kernel ${d}`);const n=(0,L.serialize)(e,J);if("iopub"!==e.channel){if("execute_reply"===e.header.msg_type){const t=e;"error"===t.content.status&&"interrupt"!==t.metadata.cause&&(this._cancelReason.set(c,"error"),c.cancel())}s.send(n)}else{const e=this._kernelClients.get(d);null==e||e.forEach((e=>{var t;null===(t=this._clients.get(e))||void 0===t||t.send(n)}))}},g=await l({id:d,sendMessage:m,name:r,location:null!=n?n:""});this._kernels.set(d,g),this._kernelClients.set(d,new Set),this._kernelSends.set(d,m);const f=new B.Server(u,{mock:!1,selectProtocol:()=>J});return f.on("connection",(e=>{var t;const s=null!==(t=new URL(e.url).searchParams.get("session_id"))&&void 0!==t?t:"";h(d,s,e)})),f.on("close",(()=>{this._clients.keys().forEach((e=>{var t;const s=this._clients.get(e);(null==s?void 0:s.readyState)===WebSocket.CLOSED&&(this._clients.delete(e),null===(t=this._kernelClients.get(d))||void 0===t||t.delete(e))}))})),g.disposed.connect((()=>{f.close(),this._kernels.delete(d),this._kernelClients.delete(d),this._mutexMap.delete(d),this._kernelSends.delete(d)})),{id:g.id,name:g.name}}async restart(e){const t=this._kernels.get(e);if(!t)throw Error(`Kernel ${e} does not exist`);const{id:s,name:n,location:r}=t;t.dispose(),await this.startNew({id:s,name:n,location:r})}async interrupt(e){const t=this._kernels.get(e);if(!t)throw Error(`Kernel ${e} does not exist`);await t.ready;const s=this._mutexMap.get(e);s?(this._cancelReason.set(s,"interrupt"),s.cancel()):console.warn("No mutex to cancel")}async listRunning(){return[...this._kernels.values()].map((e=>({id:e.id,name:e.name})))}async shutdown(e){var t;null===(t=this._kernels.delete(e))||void 0===t||t.dispose(),this._kernelClients.delete(e),this._kernelSends.delete(e)}async shutdownAll(){this._kernels.keys().forEach((e=>{this.shutdown(e)}))}async getModel(e){return this._kernels.get(e)}async handleStdin(e){this._stdinPromise=new o.PromiseDelegate;const t=e.parent_header.session,s=this._getClientKernel(t);if(void 0!==s){const t=this._kernelSends.get(s);void 0!==t&&t(e)}return this._stdinPromise.promise}_getClientKernel(e){return this._kernelClients.keys().find((t=>this._kernelClients.get(t).has(e)))}}!function(e){e.WS_BASE_URL=i.PageConfig.getBaseUrl().replace(/^http/,"ws")}(V||(V={}));class W{triggerDownload(e,t,s){const n=document.createElement("a");n.href=`data:${t};charset=utf-8,${encodeURIComponent(e)}`,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n)}}class Y extends W{constructor(){super(...arguments),this.mimeType="application/x-ipynb+json"}async export(e,t){var s;const n=null!==(s=e.mimetype)&&void 0!==s?s:"application/json",r=JSON.stringify(e.content,null,2);this.triggerDownload(r,n,t)}}class X extends W{constructor(){super(...arguments),this.mimeType="text/x-script"}async export(e,t){const{content:s,extension:n}=this.convertToScript(e.content),r=t.replace(/\.ipynb$/,n);this.triggerDownload(s,"text/plain",r)}convertToScript(e){var t;const s=null===(t=e.metadata)||void 0===t?void 0:t.language_info,n=(null==s?void 0:s.name)||"python",r=(null==s?void 0:s.file_extension)||".py",i=e.cells||[],a=[];for(const e of i)if("code"===e.cell_type){const t=Array.isArray(e.source)?e.source.join(""):e.source;a.push(t),a.push("")}else if("markdown"===e.cell_type||"raw"===e.cell_type){const t=Array.isArray(e.source)?e.source.join(""):e.source,s=this.commentLines(t,n);a.push(s),a.push("")}return{content:a.join("\n")+"\n",extension:r}}commentLines(e,t){const s=e.split("\n"),n=this.getCommentChar(t);return s.map((e=>`${n} ${e}`)).join("\n")}getCommentChar(e){return{python:"#",r:"#",julia:"#",ruby:"#",bash:"#",shell:"#",perl:"#",javascript:"//",typescript:"//",java:"//",c:"//",cpp:"//","c++":"//",scala:"//",go:"//",rust:"//",swift:"//",kotlin:"//",matlab:"%",octave:"%",lua:"--",sql:"--",haskell:"--"}[e.toLowerCase()]||"#"}}class Z extends a.NbConvertManager{constructor(e){super(e),this._contentsManager=e.contentsManager,this._exporters=e.exporters}async getExportFormats(){return this._exporters.getExportFormats()}async exportAs(e){const{format:t,path:s}=e,n=await this._contentsManager.get(s,{content:!0}),r=this._exporters.get(t);if(!r)throw new Error(`Unknown export format: ${t}`);await r.export(n,s)}}class G{constructor(){this._exporters=new Map}register(e,t){this._exporters.set(e,t)}get(e){return this._exporters.get(e)}getExportFormats(){const e={};for(const[t,s]of this._exporters)e[t]={output_mimetype:s.mimeType};return e}}const Q=new o.Token("@jupyterlite/services:INbConvertExporters","A service for managing notebook exporters in JupyterLite");var ee=s(78839);class te{constructor(e){var t;this._sessions=[],this._pendingRestarts=new Set,this._kernelClient=e.kernelClient,this._serverSettings=null!==(t=e.serverSettings)&&void 0!==t?t:a.ServerConnection.makeSettings(),this._kernelClient.changed.connect(((e,t)=>{var s,n;switch(t.type){case"remove":{const e=null===(s=t.oldValue)||void 0===s?void 0:s.id;if(!e)return;const n=this._sessions.find((t=>{var s;return(null===(s=t.kernel)||void 0===s?void 0:s.id)===e}));if(!n)return;this._pendingRestarts.add(e),setTimeout((async()=>{this._pendingRestarts.has(e)&&(this._pendingRestarts.delete(e),await this.shutdown(n.id))}),100);break}case"add":{const e=null===(n=t.newValue)||void 0===n?void 0:n.id;if(!e)return;this._pendingRestarts.delete(e);break}}}))}get serverSettings(){return this._serverSettings}async getModel(e){const t=this._sessions.find((t=>t.id===e));if(!t)throw Error(`Session ${e} not found`);return t}async listRunning(){return this._sessions}async update(e){const{id:t,path:s,name:n,kernel:r}=e,a=this._sessions.findIndex((e=>e.id===t)),l=this._sessions[a];if(!l)throw Error(`Session ${t} not found`);const c={...l,path:null!=s?s:l.path,name:null!=n?n:l.name};if(r)if(r.id){const e=this._sessions.find((e=>{var t;return(null===(t=e.kernel)||void 0===t?void 0:t.id)===(null==r?void 0:r.id)}));e&&(c.kernel=e.kernel)}else if(r.name){const e=await this._kernelClient.startNew({id:o.UUID.uuid4(),name:r.name,location:i.PathExt.dirname(c.path)});e&&(c.kernel=e),this._handleKernelShutdown({kernelId:e.id,sessionId:l.id})}return this._sessions[a]=c,c}async startNew(e){var t,s,n;const{path:r,name:a}=e,l=this._sessions.find((e=>e.name===a));if(l)return l;const c=null!==(s=null===(t=e.kernel)||void 0===t?void 0:t.name)&&void 0!==s?s:"",h=o.UUID.uuid4(),d=null!==(n=e.name)&&void 0!==n?n:e.path,u=i.PathExt.dirname(e.name)||i.PathExt.dirname(e.path),p=d.includes(":")?d.split(":")[0]:"",m=u.includes(p)?u:`${p}:${u}`,g=await this._kernelClient.startNew({id:h,name:c,location:m}),f={id:h,path:r,name:null!=a?a:r,type:"notebook",kernel:{id:g.id,name:g.name}};return this._sessions.push(f),this._handleKernelShutdown({kernelId:h,sessionId:f.id}),f}async shutdown(e){var t;const s=this._sessions.find((t=>t.id===e));if(!s)throw Error(`Session ${e} not found`);const n=null===(t=s.kernel)||void 0===t?void 0:t.id;n&&await this._kernelClient.shutdown(n),ee.ArrayExt.removeFirstOf(this._sessions,s)}async shutdownAll(){await Promise.all(this._sessions.map((e=>this.shutdown(e.id))))}async _handleKernelShutdown({kernelId:e,sessionId:t}){}}var se=s(60850);const ne="JupyterLite Storage";class re extends a.SettingManager{constructor(e){super({serverSettings:e.serverSettings}),this._storageName=ne,this._storageDrivers=null,this._localforage=e.localforage,this._storageName=e.storageName||ne,this._storageDrivers=e.storageDrivers||null,this._ready=new o.PromiseDelegate,this.initialize().catch(console.warn)}get ready(){return this._ready.promise}get storage(){return this.ready.then((()=>this._storage))}async initialize(){await this.initStorage(),this._ready.resolve(void 0)}async initStorage(){this._storage=this.defaultSettingsStorage()}get defaultStorageOptions(){var e;const t=(null===(e=this._storageDrivers)||void 0===e?void 0:e.length)?this._storageDrivers:null;return{version:1,name:this._storageName,...t?{driver:t}:{}}}defaultSettingsStorage(){return this._localforage.createInstance({description:"Offline Storage for Settings",storeName:"settings",...this.defaultStorageOptions})}async fetch(e){const t=(await this.list()).values.find((t=>t.id===e));if(!t)throw new Error(`Setting ${e} not found`);return t}async list(e){var t,s;const n=await this._getAll("all.json");let r=[];try{r=await this._getAll("all_federated.json")}catch{}const i=n.concat(r),a=await this.storage,o=await Promise.all(i.map((async e=>{var t;const{id:s}=e,n=null!==(t=await a.getItem(s))&&void 0!==t?t:e.raw;return{...ie.override(e),raw:n,settings:se.parse(n)}}))),l=null!==(t=o.map((e=>e.id)))&&void 0!==t?t:[];let c=[];return e||(c=null!==(s=o.map((e=>(e.data={composite:{},user:{}},e))))&&void 0!==s?s:[]),{ids:l,values:c}}async save(e,t){await(await this.storage).setItem(e,t)}async clear(){await(await this.storage).clear()}async _getAll(e){var t;const s=null!==(t=i.PageConfig.getOption("settingsUrl"))&&void 0!==t?t:"/";return await(await fetch(i.URLExt.join(s,e))).json()}}var ie;!function(e){const t=JSON.parse(i.PageConfig.getOption("settingsOverrides")||"{}");e.override=function(e){if(t[e.id]){e.schema.properties||(e.schema.properties={});for(const[s,n]of Object.entries(t[e.id]||{}))e.schema.properties[s].default=n}return e}}(ie||(ie={}))}}]);
//# sourceMappingURL=9653.dbb502d.js.map