"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9380,7835],{25840:(e,r,i)=>{i.r(r),i.d(r,{IServiceWorkerManager:()=>n,ServiceWorkerManager:()=>g,WORKER_NAME:()=>o});var t=i(21961);const s=i.p+"service-worker.js",n=new t.Token("@jupyterlite/server:IServiceWorkerManager"),o=`${s}`.split("/").slice(-1)[0];var a=i(2159),c=i(64649);const l=c.PageConfig.getOption("appVersion");class g{constructor(e){var r;this.unregisterOldServiceWorkers=async e=>{const r=`${e}-version`,i=localStorage.getItem(r);if(i&&i!==l||!i){console.info("New version, unregistering existing service workers.");const e=await navigator.serviceWorker.getRegistrations();await Promise.all(e.map((e=>e.unregister()))),console.info("All existing service workers have been unregistered.")}localStorage.setItem(r,l)},this._pingServiceWorker=async()=>{const e=await fetch("/api/service-worker-heartbeat");"ok"===await e.text()&&setTimeout(this._pingServiceWorker,2e4)},this._registration=null,this._registrationChanged=new a.Signal(this),this._ready=new t.PromiseDelegate;const i=null!==(r=null==e?void 0:e.workerUrl)&&void 0!==r?r:c.URLExt.join(c.PageConfig.getBaseUrl(),o),s=new URL(i,window.location.href),n=c.PageConfig.getOption("enableServiceWorkerCache")||"false";s.searchParams.set("enableCache",n),this.initialize(s.href).catch(console.warn)}get registrationChanged(){return this._registrationChanged}get enabled(){return null!==this._registration}get ready(){return this._ready.promise}async initialize(e){const{serviceWorker:r}=navigator;let i=null;if(r){if(r.controller){const e=r.controller.scriptURL;await this.unregisterOldServiceWorkers(e),i=await r.getRegistration(e)||null,console.info("JupyterLite ServiceWorker was already registered")}}else console.warn("ServiceWorkers not supported in this browser");if(!i&&r)try{console.info("Registering new JupyterLite ServiceWorker",e),i=await r.register(e),console.info("JupyterLite ServiceWorker was sucessfully registered")}catch(e){console.warn(e),console.warn(`JupyterLite ServiceWorker registration unexpectedly failed: ${e}`)}this._setRegistration(i),i?(this._ready.resolve(void 0),setTimeout(this._pingServiceWorker,2e4)):this._ready.reject(void 0)}_setRegistration(e){this._registration=e,this._registrationChanged.emit(this._registration)}}}}]);
//# sourceMappingURL=9380.73d5d3b.js.map